From p.gaffron at tuhh.de  Tue Oct  1 03:26:37 2013
From: p.gaffron at tuhh.de (Philine Gaffron)
Date: Mon, 30 Sep 2013 18:26:37 -0700
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
	package
In-Reply-To: <alpine.LRH.2.03.1309302058400.27490@reclus.nhh.no>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
	<alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
	<5249C850.9080604@tu-harburg.de>
	<alpine.LRH.2.03.1309302058400.27490@reclus.nhh.no>
Message-ID: <524A24CD.8010407@tuhh.de>

Thank you for the Geographical Analysis reference, very helpful. I have 
deduced that the method argument should be "Matrix" for my data rather 
than "LU", since the "W" weights are symmetric. However, I am still 
getting the warnings on non convergence and since you state that this 
maybe a specification problem, I would like to find the error. I did 
eliminate all polygons without neighbours for all my datasets before 
calling errorsarlm, so this should not be the problem. I include a full 
code example inline below (including documentation of the intermediate 
objects and the R outputs) for one dataset with warning and one without 
below in case you have time to look at it and find a possible error 
source that I have not identified.

comments on crash also inline

Am 30.09.2013 12:31, schrieb Roger Bivand:
> On Mon, 30 Sep 2013, Philine Gaffron wrote:
>
>> Thank you for the response, Roger. My answers below. I have also 
>> added a question on a warning message I have received and would be 
>> glad to find out whether this means I need to change the analysis 
>> approach or just have to take it as additional information.
>
> Thanks for reporting back: some points for clarification inline.
>
>>
>> Am 25.09.2013 00:53, schrieb Roger Bivand:
>>> On Wed, 25 Sep 2013, Philine Gaffron wrote:
>>>
>>>> Hello,
>>>>
>>>> I am trying to run a spatial regression analysis using the errorsarlm
>>>> function in the sdpep package. I first ran into memory problems (on a
>>>> larger dataset than the one described below) but have adjusted the
>>>> memory size limit:
>>>>
>>>>> memory.limit(size = 800000)
>>>> [1] 8e+05
>>>
>>> Which sets your memory limit under Windows to 781 Gb (size is in Mb) -
>>> that probably explains the error exit unless you have a lot of memory.
>>> Best avoid making any changes from the default in a fresh session
>>> unless you know exactly what you are doing.
>>
>> I did up the virtual memory of the machine to 800Gb first (it has 1Tb 
>> in total and there is currently nothing else running on it) so I hope 
>> that that was not the problem. Thanks for the hint, though.
>>
>>>
>>>>
>>>> However, when I try to execute the following code in R Studio, I
>>>> receive the message "R Session aborted - R encountered a fatal error
>>>> - The session was terminated"
>>>
>>> Always rerun any code with problems outside R Studio, because it can
>>> interfere with the reporting of warnings and errors. Certainly
>>> errorsarlm() has no reason to cause R to crash - and this is what you
>>> are suggesting. If you can reproduce this outside R Studio, and
>>> without setting memory limits, I may need to see your data to try to
>>> reproduce any error exit from the R session.
>>
>> I tried this and had no more crashes - especially after I made the 
>> changes suggested/outlined below
>
> Does this mean that the R error exit occurred when you used R Studio, 
> and did not occur when R was run directly, using exactly the same data 
> and code? If so, please also let the R Studio people know, so that 
> they can continue debugging.

I will try to reproduce this once I have understood / solved my 
non-convergence problem. If and when I do, I will send the code and data 
to the RStudio people and cc you (?).
>
>>
>>>
>>>>
>>>>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =
>>>>> ElDorado_urban, listw=ElDoU_listw)
>>>
>>> Did you read the advice on ?errorsarlm about the use of alternative
>>> methods, such as "LU" or "Matrix" for larger data sets? You are using
>>> the default "eigen" method, but this should certainly have worked for
>>> the modest n=2081. Can you reproduce the problem with a built-in data
>>> set, such as elect80?
>>
>> I opted for the "LU" method and changed the weights style (see 
>> below). Is there any documentation that tells me the implications of 
>> using method ="LU"? I only found the note in the spdep documentation 
>> "LU_order default FALSE; used in ?LU_prepermutate?, note warnings 
>> given for lu method" but nothing further. I did receive warnings in 
>> the output, though (for several but not all of my datasets) and I am 
>> not sure what they mean / what their implications are for the 
>> results. Do I need to choose another method? The warnings in every 
>> case were:
>>
>
> See Bivand, Hauke & Kossowski (2013) Geographical Analysis for some 
> details; LU_prepermutate emulates the implementation by finding an 
> initial fill-in re-ordering, but in R has little speed-up effect, 
> hence it is turned off by default.
>
>> 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,:
>> not converged within order iterations
>>
>> 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,:
>> not converged within order iterations
>
> These are unusual, and may signal a mis-specified setting. The default 
> number of powers is 250, and lambda^250 is a very small number unless 
> lambda is close to its (probably upper) limit. The computation in fact 
> only affects the accuracy of the Hausman test on the difference 
> between OLS and spatial error coefficients, so may be adjusted if 
> lambda is close to limits by setting control argument pWOrder to a 
> larger value than 250, see ?powerWeights. As a symptom of lambda close 
> to its limits, it suggests mis-specification, possibly in terms of 
> observation support, with neighbouring properties sharing important 
> drivers. This may be suggested by your data scenario described below; 
> scrutinising the intermediate objects in your script may also put you 
> on the track of things behaving in unexpected ways. I would expect 
> many observations to have no neighbours with a 150m threshold, but you 
> don't show no-neighbour control being turned off.
I removed all polygons without neighbours prior to calling errorsarlm - 
see example below.
>
> Hope the helps,
>
> Roger
>
Here is the worked example of the two different datasets. No warning for 
the first one, warnings received for the second one included (sorry, 
this is a bit lengthy but I did not want to leave out anything that 
might be relevant).

####READING IN ArcGIS SHAPEFILE###############################

Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
Parcels2008_UNinc_POP <- readOGR(".", "Parcels_2008_UNinc_pop")


########EXTRACT SUBSETS OF Parcels2008 SpatialPolygonsDataframe####
ElDorado_rural <- subset(Parcels2008_UNinc_POP, COUNTYFP10 == "017")
ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")


##############TO CREATE A DISTANCE BASED NEIGHBOURS LIST IN 
R########################

# FIRST, calculate coords of feature centroids####

Eld_R_coords <- coordinates(ElDorado_rural)
Eld_U_coords <- coordinates(ElDorado_urban)


##SECOND, create vector with row names ####

Eld_R_IDs <- row.names(ElDorado_rural)
Eld_U_IDs <- row.names(ElDorado_urban)


###THIRD, creating the nb objects for calculating spatial weights####

##DATASET ONE: NO WARNING FROM errorsarlm (see below)####
ElDoR_nb <- dnearneigh(Eld_R_coords, d1 = 0, d2 = 984, row.names = 
Eld_R_IDs)
ElDoR_nb
# Neighbour list object:
# Number of regions: 26863
# Number of nonzero links: 1591926
# Percentage nonzero weights: 0.2206042
# Average number of links: 59.26092
# 34 regions with no links:
# 0 83 872 993 2301 2420 7518 12579 14649 17136 17148 18526 18601 18786 
20413
# 20427 20662 21445 21824 22497 23309 23421 23535 24366 24743 24784 
25007 25009
# 25107 25184 25203 25229 25421 25465

#remove parcels/regions with no links
ElDorado_rural <- subset(ElDorado_rural, subset=card(ElDoR_nb) > 0)

Eld_R_coords <- coordinates(ElDorado_rural)
summary(Eld_R_coords)
# V1 V2
# Min. :6816265 Min. :1953502
# 1st Qu.:6845579 1st Qu.:2007471
# Median :6876165 Median :2016977
# Mean :6884229 Mean :2021703
# 3rd Qu.:6918361 3rd Qu.:2034467
# Max. :7091505 Max. :2108970

Eld_R_IDs <- row.names(ElDorado_rural)
summary(Eld_R_IDs)
# Length Class Mode
# 26829 character character
ElDoR_nb <- dnearneigh(Eld_R_coords, d1 = 0, d2 = 984, row.names = 
Eld_R_IDs)
ElDoR_nb
# Neighbour list object:
# Number of regions: 26829
# Number of nonzero links: 1591926
# Percentage nonzero weights: 0.2211637
# Average number of links: 59.33602

is.symmetric.nb(ElDoR_nb)
# [1] TRUE


##DATASET TWO:NON-CONVERGENCE WARNING FROM errorsarlm (see below)########
ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names = 
Eld_U_IDs)
ElDoU_nb
# Neighbour list object:
# Number of regions: 2094
# Number of nonzero links: 57172
# Percentage nonzero weights: 1.303857
# Average number of links: 27.30277
# 13 regions with no links:
# 425 468 628 929 1216 1218 1224 1252 1363 1416 1927 2007 2088

#remove parcels/regions with no links
ElDorado_urban <- subset(ElDorado_urban, subset=card(ElDoU_nb) > 0)
Eld_U_coords <- coordinates(ElDorado_urban)
summary(Eld_U_coords)
# V1 V2
# Min. :6892551 Min. :2024721
# 1st Qu.:6901757 1st Qu.:2028604
# Median :6904635 Median :2030283
# Mean :6905218 Mean :2030021
# 3rd Qu.:6908098 3rd Qu.:2031299
# Max. :6916815 Max. :2035333

Eld_U_IDs <- row.names(ElDorado_urban)
summary(Eld_U_IDs)
# Length Class Mode
# 2081 character characte

ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names = 
Eld_U_IDs)
ElDoU_nb
# Neighbour list object:
# Number of regions: 2081
# Number of nonzero links: 57172
# Percentage nonzero weights: 1.320198
# Average number of links: 27.47333
is.symmetric.nb(ElDoU_nb)
# [1] TRUE



####WEIGHTS######################################

#ElDorado rural
ElDoR_listw <- nb2listw(ElDoR_nb, glist=NULL, style="W", zero.policy=NULL)
names(ElDoR_listw)
# [1] "style" "neighbours" "weights"
summary(ElDoR_listw)
# Characteristics of weights list object:
# Neighbour list object:
# Number of regions: 26829
# Number of nonzero links: 1591926
# Percentage nonzero weights: 0.2211637
# Average number of links: 59.33602
# Link number distribution:
#
# 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22
# 85 160 267 454 692 870 1007 1016 940 802 751 583 541 457 377 347 301 
261 209 221 234 193
# 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44
# 191 207 216 183 185 185 161 184 175 209 189 163 178 155 164 138 138 
151 134 135 116 125
# 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66
# 96 97 106 101 107 116 100 122 110 103 125 103 105 105 107 112 77 101 
95 95 102 102
# 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88
# 69 102 110 87 90 96 135 94 107 90 111 98 99 96 135 125 98 118 110 123 
94 76
# 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 
109 110
# 101 113 95 105 84 99 89 102 94 98 114 107 91 104 116 90 98 97 110 93 
103 97
# 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 
128 129 130 131 132
# 107 98 114 111 93 100 77 103 101 95 109 96 79 103 99 80 78 86 83 93 84 80
# 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 
150 151 152 153 154
# 72 90 91 93 82 81 82 71 77 70 84 67 57 74 69 87 74 74 77 52 76 70
# 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 
172 173 174 175 176
# 49 60 52 42 62 57 56 47 56 45 59 58 53 53 61 47 32 26 39 37 35 39
# 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 
194 195 196 197 198
# 30 28 32 17 26 22 16 14 16 18 7 13 9 12 15 13 18 6 7 18 12 11
# 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 
216 217 218 219 220
# 13 13 13 16 13 10 17 12 12 11 8 9 1 4 8 6 2 7 6 8 5 3
# 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 
238 239 240 241 242
# 8 7 4 7 3 10 1 2 4 2 6 9 1 6 6 9 7 4 7 6 1 5
# 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 
261 262 263 264 265
# 4 2 5 3 5 4 3 2 5 4 1 2 5 2 4 5 4 2 3 4 2 3
# 266 267 268 269 270 272 273 274 275 276 278 279 280 282 283 284 285 
286 287 289 290 292
# 2 2 2 4 6 2 1 3 1 1 4 1 2 6 4 8 6 5 2 3 1 3
# 293 295 297
# 7 2 1
# 85 least connected regions:
# 37 261 262 263 268 334 585 1011 1012 1035 2419 2546 2621 2659 3258 
4544 4557 5501 5502 5859 10005 10006 10007 12577 12578 16301 17256 17257 
18697 18788 19339 19445 20499 20658 21104 21105 21440 21441 21494 21829 
21981 21982 22039 22056 22154 22208 22310 22315 22316 22396 22397 22398 
22423 22816 22823 22989 22990 23121 23133 23554 23621 23771 23772 23823 
23891 23903 24313 24348 24437 24464 24676 24802 24803 24886 25008 25306 
25354 25466 25634 26060 26432 26433 26452 26453 26509 with 1 link
# 1 most connected region:
# 9783 with 297 links
#
# Weights style: W
# Weights constants summary:
# n nn S0 S1 S2
# W 26829 719795241 26829 3194.683 108332.1
summary(sapply(ElDoR_listw$weights, sum))
# Min. 1st Qu. Median Mean 3rd Qu. Max.
# 1 1 1 1 1 1



#El Dorado urban
ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="W", zero.policy=NULL)
summary(ElDoU_listw)
# Characteristics of weights list object:
# Neighbour list object:
# Number of regions: 2081
# Number of nonzero links: 57172
# Percentage nonzero weights: 1.320198
# Average number of links: 27.47333
# Link number distribution:
#
# 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
27 28 29 30 31 32 33 34 35 36 37
# 14 15 29 29 21 27 34 36 35 32 43 58 46 44 49 53 60 40 56 42 56 49 50 
58 54 46 48 40 49 45 45 38 31 38 37 26 29
# 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 
61 62 63 64 65 66
# 32 37 33 38 32 32 33 31 34 34 43 28 26 15 17 17 18 16 14 5 14 9 3 4 5 
3 2 3 1
# 14 least connected regions:
# 147 148 159 378 466 467 596 629 642 1217 1705 1710 2074 2087 with 1 link
# 1 most connected region:
# 865 with 66 links
#
# Weights style: W
# Weights constants summary:
# n nn S0 S1 S2
# W 2081 4330561 2081 260.5586 8405.665
summary(sapply(ElDoU_listw$weights, sum))
# Min. 1st Qu. Median Mean 3rd Qu. Max.
# 1 1 1 1 1 1




####SPATIAL REGRESSION ANALYSIS#####


##El Dorado rural################################
ElDR.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data = 
ElDorado_rural, listw=ElDoR_listw, method = "Matrix")
ElDR.PM25.white <- summary(ElDR.slm.PM25.white, Nagelkerke = TRUE, 
digits = 4, signif.stars = TRUE)
ElDR.PM25.white
# Call:errorsarlm(formula = PM_PM25 ~ race_white, data = ElDorado_rural,
# listw = ElDoR_listw, method = "Matrix")
#
# Residuals:
# Min 1Q Median 3Q Max
# -0.37948413 -0.00236403 -0.00096381 0.00088396 0.69478272
#
# Type: error
# Coefficients: (asymptotic standard errors)
# Estimate Std. Error z value Pr(>|z|)
# (Intercept) 3.0372e-02 3.0068e-03 10.1013 < 2.2e-16
# race_white -5.7658e-05 1.4887e-05 -3.8731 0.0001074
#
# Lambda: 0.94999, LR test value: 32485, p-value: < 2.22e-16
# Approximate (numerical Hessian) standard error: 0.0022514
# z-value: 421.96, p-value: < 2.22e-16
# Wald statistic: 178050, p-value: < 2.22e-16
#
# Log likelihood: 62497.7 for error model
# ML residual variance (sigma squared): 0.00049093, (sigma: 0.022157)
# Nagelkerke pseudo-R-squared: 0.70418
# Number of observations: 26829
# Number of parameters estimated: 4
# AIC: -124990, (AIC for lm: -92505)



##El Dorado urban####################################
ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data = 
ElDorado_urban, listw=ElDoU_listw, method = "Matrix")
# Warning messages:
# 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B, :
# not converged within order iterations
# 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C, :
# not converged within order iterations
ElDU.PM25.white <- summary(ElDU.slm.PM25.white, Nagelkerke = TRUE, 
digits = 4, signif.stars = TRUE)
ElDU.PM25.white
# Call:errorsarlm(formula = PM_PM25 ~ race_white, data = ElDorado_urban,
# listw = ElDoU_listw, method = "Matrix")
#
# Residuals:
# Min 1Q Median 3Q Max
# -0.1277026 -0.0080154 -0.0023227 0.0049338 0.3288472
#
# Type: error
# Coefficients: (asymptotic standard errors)
# Estimate Std. Error z value Pr(>|z|)
# (Intercept) 5.3598e-02 1.5882e-02 3.3747 0.0007389
# race_white -2.8711e-05 8.8431e-05 -0.3247 0.7454294
#
# Lambda: 0.95004, LR test value: 2875.6, p-value: < 2.22e-16
# Approximate (numerical Hessian) standard error: 0.0070736
# z-value: 134.31, p-value: < 2.22e-16
# Wald statistic: 18039, p-value: < 2.22e-16
#
# Log likelihood: 4093.031 for error model
# ML residual variance (sigma squared): 0.00099886, (sigma: 0.031605)
# Nagelkerke pseudo-R-squared: 0.74927
# Number of observations: 2081
# Number of parameters estimated: 4
# AIC: -8178.1, (AIC for lm: -5304.5)



###Session Info######
# R Studio version 0.97.551

sessionInfo()
# R version 3.0.1 (2013-05-16)
# Platform: x86_64-w64-mingw32/x64 (64-bit)
#
# locale:
# [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United 
States.1252
# [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C
# [5] LC_TIME=English_United States.1252
#
# attached base packages:
# [1] stats graphics grDevices utils datasets methods base
#
# other attached packages:
# [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
#
# loaded via a namespace (and not attached):
# [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12 
MASS_7.3-26
# [7] nlme_3.1-109 splines_3.0.1 tools_3.0.1

>>
>>
>> I have not tried reproducing the error with the built-in dataset but 
>> if that is of interest to you from the point of view of spdep 
>> development, I could give it a try.
>>
>>>
>>>>
>>>> The data was imported from an ArcGIS shape file:
>>>>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>>>>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>>>>
>>>> The subset contains data from 2081 polygons
>>>>
>>>> The listw object was created as follows:
>>>>
>>>>> Eld_U_coords <- coordinates(ElDorado_urban)
>>>>> Eld_U_IDs <- row.names(ElDorado_urban)
>>>>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names =
>>>>> Eld_U_IDs)
>>>
>>> Is 492 a well-chosen upper distance threshold? I assume that the input
>>> data are projected, so that these are measures in the units of the
>>> projection - metres? If Eld_U_coords are actually geographical
>>> coordinates, but longlat=NULL, d2 is taken as a planar measure, if you
>>> declare longlat=TRUE, it is in km. There is no easy way to trap
>>> undeclared geographical coordinates.
>>
>> The distance thresholds are in feet 
>> (NAD_1983_StatePlane_California_II_FIPS_0402_Feet) and are related to 
>> dispersion distances for road traffic emissions. For explanation: my 
>> polygons are land use parcels for which I have calculated emission 
>> loads in grams/area from traffic loads on a road network. Since I am 
>> assuming a dispersion distance of 492 feet / 150 m of emissions away 
>> from the network in the example above, I am further assuming, that 
>> parcels which are within that distance of one another are affected by 
>> the same emission sources (i.e. traffic loads on the network).
>>
>>>
>>>>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S",
>>>>> zero.policy=NULL)
>>>>
>>>
>>> Does choosing a different style make a difference ("S" is not often
>>> used)?
>>
>> I chose "S" as a variance stabilising coding schemes following 
>> Bivand, Pebesma et al. (2008), p. 253 but have now switched back to 
>> "W". Apart from the warnings cited above I encountered no more issues.
>>
>> Thank you for your help and for making this package available.
>>
>> Philine
>>
>>>
>>> Roger
>>>
>>>> Is there anything inherent in my approach that could cause this
>>>> problem or would one need to look at the data? I include the session
>>>> info below.
>>>>
>>>> Thanks for any help,
>>>>
>>>> Philine
>>>>
>>>>> sessionInfo()
>>>> R version 3.0.1 (2013-05-16)
>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>
>>>> locale:
>>>> [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United
>>>> States.1252 LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>>> [5] LC_TIME=English_United States.1252
>>>>
>>>> attached base packages:
>>>> [1] stats graphics grDevices utils datasets methods base
>>>>
>>>> other attached packages:
>>>> [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
>>>>
>>>> loaded via a namespace (and not attached):
>>>> [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12
>>>> MASS_7.3-26 nlme_3.1-109 splines_3.0.1 tools_3.0.1
>>>>
>>>>> library(help=spdep)
>>>> Information on package ?spdep?
>>>>
>>>> Description:
>>>>
>>>> Package: spdep
>>>> Version: 0.5-65
>>>> Date: 2013-09-04
>>>>
>>>>
>>>
>>
>>
>


From Roger.Bivand at nhh.no  Tue Oct  1 13:12:07 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 1 Oct 2013 13:12:07 +0200
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
 package
In-Reply-To: <524A24CD.8010407@tuhh.de>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
	<alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
	<5249C850.9080604@tu-harburg.de>
	<alpine.LRH.2.03.1309302058400.27490@reclus.nhh.no>
	<524A24CD.8010407@tuhh.de>
Message-ID: <alpine.LRH.2.03.1310011255250.30580@reclus.nhh.no>

On Tue, 1 Oct 2013, Philine Gaffron wrote:

> Thank you for the Geographical Analysis reference, very helpful. I have 
> deduced that the method argument should be "Matrix" for my data rather than 
> "LU", since the "W" weights are symmetric. However, I am still getting the 
> warnings on non convergence and since you state that this maybe a 
> specification problem, I would like to find the error.

I think that, unless you need the Hausman test from errorsarlm, just turn 
it off with errorsarlm(..., control=list(returnHcov=FALSE)); the ML fit is 
quite OK, it is only the Hausman test component that is giving the 
warnings for the spatial coefficient close to its limits, and when using 
other methods than "eigen". If you do need it and cannot use 
method="eigen", increase the order until the warning (it is a warning, not 
an error) goes away with errorsarlm(..., control=list(pWOrder=<big 
integer>)). I have had win-builder roll up a Windows binary of the 
development version with more details on the problem, on:

http://win-builder.r-project.org/5IVvaH0M3Qsj

See the examples for powerWeight, and look at the returned component for 
the warnining-displaying errorsarlm fit called $pWinternal showing how 
convergence failed; series needs to fall below tol for convergence.

As your n is not large, you can compare the "eigen" and "Matrix" methods 
to see how the Hausman test output diverges as the approximation to the 
term needed deteriorates.

The underlying problem that you have touched is (as in the sections in 
Bivand et al. 2013 on approximations) that using power series to generate 
the product of the inverse of the nxn (I - \rho W) matrix and an arbitrary 
vector also deteriotates when \rho is near its limits.

Thanks for the detailed results; I've deleted them in this reply to save 
space.

Roger

> I did eliminate all 
> polygons without neighbours for all my datasets before calling errorsarlm, so 
> this should not be the problem. I include a full code example inline below 
> (including documentation of the intermediate objects and the R outputs) for 
> one dataset with warning and one without below in case you have time to look 
> at it and find a possible error source that I have not identified.
>
> comments on crash also inline
>
> Am 30.09.2013 12:31, schrieb Roger Bivand:
>> On Mon, 30 Sep 2013, Philine Gaffron wrote:
>> 
>>> Thank you for the response, Roger. My answers below. I have also added a 
>>> question on a warning message I have received and would be glad to find 
>>> out whether this means I need to change the analysis approach or just have 
>>> to take it as additional information.
>> 
>> Thanks for reporting back: some points for clarification inline.
>> 
>>> 
>>> Am 25.09.2013 00:53, schrieb Roger Bivand:
>>>> On Wed, 25 Sep 2013, Philine Gaffron wrote:
>>>> 
>>>>> Hello,
>>>>> 
>>>>> I am trying to run a spatial regression analysis using the errorsarlm
>>>>> function in the sdpep package. I first ran into memory problems (on a
>>>>> larger dataset than the one described below) but have adjusted the
>>>>> memory size limit:
>>>>> 
>>>>>> memory.limit(size = 800000)
>>>>> [1] 8e+05
>>>> 
>>>> Which sets your memory limit under Windows to 781 Gb (size is in Mb) -
>>>> that probably explains the error exit unless you have a lot of memory.
>>>> Best avoid making any changes from the default in a fresh session
>>>> unless you know exactly what you are doing.
>>> 
>>> I did up the virtual memory of the machine to 800Gb first (it has 1Tb in 
>>> total and there is currently nothing else running on it) so I hope that 
>>> that was not the problem. Thanks for the hint, though.
>>> 
>>>> 
>>>>> 
>>>>> However, when I try to execute the following code in R Studio, I
>>>>> receive the message "R Session aborted - R encountered a fatal error
>>>>> - The session was terminated"
>>>> 
>>>> Always rerun any code with problems outside R Studio, because it can
>>>> interfere with the reporting of warnings and errors. Certainly
>>>> errorsarlm() has no reason to cause R to crash - and this is what you
>>>> are suggesting. If you can reproduce this outside R Studio, and
>>>> without setting memory limits, I may need to see your data to try to
>>>> reproduce any error exit from the R session.
>>> 
>>> I tried this and had no more crashes - especially after I made the changes 
>>> suggested/outlined below
>> 
>> Does this mean that the R error exit occurred when you used R Studio, and 
>> did not occur when R was run directly, using exactly the same data and 
>> code? If so, please also let the R Studio people know, so that they can 
>> continue debugging.
>
> I will try to reproduce this once I have understood / solved my 
> non-convergence problem. If and when I do, I will send the code and data to 
> the RStudio people and cc you (?).
>> 
>>> 
>>>> 
>>>>> 
>>>>>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =
>>>>>> ElDorado_urban, listw=ElDoU_listw)
>>>> 
>>>> Did you read the advice on ?errorsarlm about the use of alternative
>>>> methods, such as "LU" or "Matrix" for larger data sets? You are using
>>>> the default "eigen" method, but this should certainly have worked for
>>>> the modest n=2081. Can you reproduce the problem with a built-in data
>>>> set, such as elect80?
>>> 
>>> I opted for the "LU" method and changed the weights style (see below). Is 
>>> there any documentation that tells me the implications of using method 
>>> ="LU"? I only found the note in the spdep documentation "LU_order default 
>>> FALSE; used in ?LU_prepermutate?, note warnings given for lu method" but 
>>> nothing further. I did receive warnings in the output, though (for several 
>>> but not all of my datasets) and I am not sure what they mean / what their 
>>> implications are for the results. Do I need to choose another method? The 
>>> warnings in every case were:
>>> 
>> 
>> See Bivand, Hauke & Kossowski (2013) Geographical Analysis for some 
>> details; LU_prepermutate emulates the implementation by finding an initial 
>> fill-in re-ordering, but in R has little speed-up effect, hence it is 
>> turned off by default.
>> 
>>> 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,:
>>> not converged within order iterations
>>> 
>>> 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,:
>>> not converged within order iterations
>> 
>> These are unusual, and may signal a mis-specified setting. The default 
>> number of powers is 250, and lambda^250 is a very small number unless 
>> lambda is close to its (probably upper) limit. The computation in fact only 
>> affects the accuracy of the Hausman test on the difference between OLS and 
>> spatial error coefficients, so may be adjusted if lambda is close to limits 
>> by setting control argument pWOrder to a larger value than 250, see 
>> ?powerWeights. As a symptom of lambda close to its limits, it suggests 
>> mis-specification, possibly in terms of observation support, with 
>> neighbouring properties sharing important drivers. This may be suggested by 
>> your data scenario described below; scrutinising the intermediate objects 
>> in your script may also put you on the track of things behaving in 
>> unexpected ways. I would expect many observations to have no neighbours 
>> with a 150m threshold, but you don't show no-neighbour control being turned 
>> off.
> I removed all polygons without neighbours prior to calling errorsarlm - see 
> example below.
>> 
>> Hope the helps,
>> 
>> Roger
>> 
>>> 
>>> I have not tried reproducing the error with the built-in dataset but if 
>>> that is of interest to you from the point of view of spdep development, I 
>>> could give it a try.
>>> 
>>>> 
>>>>> 
>>>>> The data was imported from an ArcGIS shape file:
>>>>>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>>>>>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>>>>> 
>>>>> The subset contains data from 2081 polygons
>>>>> 
>>>>> The listw object was created as follows:
>>>>> 
>>>>>> Eld_U_coords <- coordinates(ElDorado_urban)
>>>>>> Eld_U_IDs <- row.names(ElDorado_urban)
>>>>>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names =
>>>>>> Eld_U_IDs)
>>>> 
>>>> Is 492 a well-chosen upper distance threshold? I assume that the input
>>>> data are projected, so that these are measures in the units of the
>>>> projection - metres? If Eld_U_coords are actually geographical
>>>> coordinates, but longlat=NULL, d2 is taken as a planar measure, if you
>>>> declare longlat=TRUE, it is in km. There is no easy way to trap
>>>> undeclared geographical coordinates.
>>> 
>>> The distance thresholds are in feet 
>>> (NAD_1983_StatePlane_California_II_FIPS_0402_Feet) and are related to 
>>> dispersion distances for road traffic emissions. For explanation: my 
>>> polygons are land use parcels for which I have calculated emission loads 
>>> in grams/area from traffic loads on a road network. Since I am assuming a 
>>> dispersion distance of 492 feet / 150 m of emissions away from the network 
>>> in the example above, I am further assuming, that parcels which are within 
>>> that distance of one another are affected by the same emission sources 
>>> (i.e. traffic loads on the network).
>>> 
>>>> 
>>>>>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S",
>>>>>> zero.policy=NULL)
>>>>> 
>>>> 
>>>> Does choosing a different style make a difference ("S" is not often
>>>> used)?
>>> 
>>> I chose "S" as a variance stabilising coding schemes following Bivand, 
>>> Pebesma et al. (2008), p. 253 but have now switched back to "W". Apart 
>>> from the warnings cited above I encountered no more issues.
>>> 
>>> Thank you for your help and for making this package available.
>>> 
>>> Philine
>>> 
>>>> 
>>>> Roger
>>>> 
>>>>> Is there anything inherent in my approach that could cause this
>>>>> problem or would one need to look at the data? I include the session
>>>>> info below.
>>>>> 
>>>>> Thanks for any help,
>>>>> 
>>>>> Philine
>>>>> 
>>>>>> sessionInfo()
>>>>> R version 3.0.1 (2013-05-16)
>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>> 
>>>>> locale:
>>>>> [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United
>>>>> States.1252 LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>>>> [5] LC_TIME=English_United States.1252
>>>>> 
>>>>> attached base packages:
>>>>> [1] stats graphics grDevices utils datasets methods base
>>>>> 
>>>>> other attached packages:
>>>>> [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
>>>>> 
>>>>> loaded via a namespace (and not attached):
>>>>> [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12
>>>>> MASS_7.3-26 nlme_3.1-109 splines_3.0.1 tools_3.0.1
>>>>> 
>>>>>> library(help=spdep)
>>>>> Information on package ?spdep?
>>>>> 
>>>>> Description:
>>>>> 
>>>>> Package: spdep
>>>>> Version: 0.5-65
>>>>> Date: 2013-09-04
>>>>> 
>>>>> 
>>>> 
>>> 
>>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From jbechara at lri-lb.org  Tue Oct  1 13:25:25 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Tue, 1 Oct 2013 14:25:25 +0300
Subject: [R-sig-Geo] merge Shape file
Message-ID: <009e01cebe98$edc59b20$c950d160$@lri-lb.org>

I'm looking for a function to merge 2 shapefiles keeping them as
"spatialPolygonsDataframe" class.

Any clue?

 

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/dbac90b9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/dbac90b9/attachment.jpe>

From b.rowlingson at lancaster.ac.uk  Tue Oct  1 15:03:52 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 1 Oct 2013 14:03:52 +0100
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/cdf67118/attachment.pl>

From Amelie.LESCROEL at cefe.cnrs.fr  Tue Oct  1 15:26:05 2013
From: Amelie.LESCROEL at cefe.cnrs.fr (Amelie LESCROEL)
Date: Tue, 1 Oct 2013 15:26:05 +0200
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
	lat-long coordinates
Message-ID: <EC2C4198CBEFB14F9B8661B1614106F30134C18AEC01@ZZMAIL.newcefe.newage.fr>

Dear all,
I'm having trouble creating a map with lat-long coordinates from a (supposedly?) GeoTIFF file and I would gratefully welcome any suggestion of more advanced users. This file is a satellite image of the southern Ross Sea, Antarctica, which can be found here: http://lance-modis.eosdis.nasa.gov/imagery/subsets/?project=antarctica&subset=RossSea.2004356.aqua.500m
As proposed on this page, I downloaded the .tif file as well as the .prj file, then tried to import and plot it in R.

> library(raster)
Le chargement a n?cessit? le package : sp
> library(rgdal)
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.9.2, released 2012/10/08
Path to GDAL shared files: C:/Users/lescroel/Documents/R/win-library/2.15/rgdal/gdal
GDAL does not use iconv for recoding strings.
Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
Path to PROJ.4 shared files: C:/Users/lescroel/Documents/R/win-library/2.15/rgdal/proj
> setwd(./.)
> sat <- raster("RossSea_2004356_aqua_500m.tif")
> sat
class       : RasterLayer 
band        : 1  (of  3  bands)
dimensions  : 1800, 1400, 2520000  (nrow, ncol, ncell)
resolution  : 1, 1  (x, y)
extent      : 0, 1400, 0, 1800  (xmin, xmax, ymin, ymax)
coord. ref. : NA 
data source : F:\Mes Documents\Postdoc\Articles\Phenotypic plasticity of foraging efficiency\PLOS ONE\RossSea_2004356_aqua_500m.tif 
names       : RossSea_2004356_aqua_500m 
values      : 0, 255  (min, max)
> plot(sat, col=grey(0:255/255))

It works but all the projection info is lost. And when I plot it, I end up with axes going from 0 to 1400 for x and 0 to 1800 for y (as specified in the extent of the sat object), not lat-long coordinates.
I tried reading the .tif file with readGDAL but I get an error message:

> sat2<-readGDAL("C:/Users/lescroel/Desktop/RossSea.2004356.aqua.500m.tif")
C:/Users/lescroel/Desktop/RossSea.2004356.aqua.500m.tif has GDAL driver GTiff 
and has 1800 rows and 1400 columns
Message d'avis :
In readGDAL("C:/Users/lescroel/Desktop/RossSea.2004356.aqua.500m.tif") :
  GeoTransform values not available

I tried specifying a projection from what I could see of the .prj file (PROJCS["Lambert Azimuthal Sphere",GEOGCS["GCS_Sphere",DATUM["D_Sphere",SPHEROID["Sphere",6371000,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",-170.0],PARAMETER["Latitude_Of_Origin",-75.0],UNIT["Meter",1.0]]), but I'm not even sure that I "translated" it correctly:

> sat.geo <- CRS("+proj=laea +lat_0=-75 +lon_0=-170 +a=6371000 +units=m +no_defs")
> proj4string(sat) <- sat.geo
> sat
class       : RasterLayer 
band        : 1  (of  3  bands)
dimensions  : 1800, 1400, 2520000  (nrow, ncol, ncell)
resolution  : 1, 1  (x, y)
extent      : 0, 1400, 0, 1800  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=laea +lat_0=-75 +lon_0=-170 +a=6371000 +units=m +no_defs 
data source : F:\Mes Documents\Postdoc\Articles\Phenotypic plasticity of foraging efficiency\PLOS ONE\RossSea_2004356_aqua_500m.tif 
names       : RossSea_2004356_aqua_500m 
values      : 0, 255  (min, max)

Is there a way to read the .prj directly from R? How should I do to be able to map this image with long-lat coordinates? I guess that lots of the required information to do this could be gathered from the metadata of this file (http://lance-modis.eosdis.nasa.gov/imagery/subsets/?project=antarctica&subset=RossSea.2004356.aqua.500m.met) but I'm not sure how to implement this and all my previous attempts failed.

Thanks in advance for your help and do not hesitate to direct me towards an online resource / reading material that I could have overlooked.

Best regards,

Am?lie

> sessionInfo()
R version 2.15.3 (2013-03-01)
Platform: x86_64-w64-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252    LC_MONETARY=French_France.1252 LC_NUMERIC=C                  
[5] LC_TIME=French_France.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] rgdal_0.8-11  raster_2.1-49 sp_1.0-13    

loaded via a namespace (and not attached):
[1] grid_2.15.3     lattice_0.20-13 tools_2.15.3
_______________________________________________ 
Am?lie Lescro?l 
Centre d'Ecologie Fonctionnelle et Evolutive 
CNRS - UMR 5175 
1919 Route de Mende 
F-34293 Montpellier Cedex 05 


From jbechara at lri-lb.org  Tue Oct  1 15:25:54 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Tue, 1 Oct 2013 16:25:54 +0300
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
Message-ID: <00e701cebea9$c2d718b0$48854a10$@lri-lb.org>

Dear Bary, 

 

Actually I have to do a geometrical merge operation.

I'm looking for the equivalent of "merge" in ArcGIS.

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf Of
Barry Rowlingson
Sent: Tuesday, October 01, 2013 4:04 PM
To: Joseph Bechara
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] merge Shape file

 

 

 

On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

I'm looking for a function to merge 2 shapefiles keeping them as
"spatialPolygonsDataframe" class.

Any clue?

 

 

 

What do you mean by merge? If the two shapefiles have the same set of
attributes then just read them into SpatialPolygonsDataFrames and do s12 =
rbind(s1,s2), and you end up with a SPDF which has all the features from s1
and s2.

Or do you want to do some geometrical merge operation?

Barry

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/b278da93/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/b278da93/attachment.jpe>

From roman.lustrik at gmail.com  Tue Oct  1 15:31:35 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 1 Oct 2013 15:31:35 +0200
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
Message-ID: <CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/c92c7145/attachment.pl>

From jbechara at lri-lb.org  Tue Oct  1 15:35:31 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Tue, 1 Oct 2013 16:35:31 +0300
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
Message-ID: <011601cebeab$1ab88b30$5029a190$@lri-lb.org>

Thanks Roman, 

 

I know the rgeos package but I?m not able to identify which tools can replace the merge of ArcGIS.

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: romunov at gmail.com [mailto:romunov at gmail.com] On Behalf Of Roman Lu?trik
Sent: Tuesday, October 01, 2013 4:32 PM
To: Joseph Bechara
Cc: R-sig-geo mailing list
Subject: Re: [R-sig-Geo] merge Shape file

 

I think you want the `rgeos` package that offers a plethora of functions to work with "features".

 

Cheers,

Roman

 

 

On Tue, Oct 1, 2013 at 3:25 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

Dear Bary, 

 

Actually I have to do a geometrical merge operation.

I?m looking for the equivalent of ?merge? in ArcGIS.

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

 

 

From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson
Sent: Tuesday, October 01, 2013 4:04 PM
To: Joseph Bechara
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] merge Shape file

 

 

 

On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

I?m looking for a function to merge 2 shapefiles keeping them as ?spatialPolygonsDataframe? class.

Any clue?

 

 

 

What do you mean by merge? If the two shapefiles have the same set of attributes then just read them into SpatialPolygonsDataFrames and do s12 = rbind(s1,s2), and you end up with a SPDF which has all the features from s1 and s2.

Or do you want to do some geometrical merge operation?

Barry

 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo







-- 
In God we trust, all others bring data. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/20249b00/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/20249b00/attachment.jpe>

From edzer.pebesma at uni-muenster.de  Tue Oct  1 16:09:18 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 01 Oct 2013 16:09:18 +0200
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <011601cebeab$1ab88b30$5029a190$@lri-lb.org>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
	<011601cebeab$1ab88b30$5029a190$@lri-lb.org>
Message-ID: <524AD78E.7090206@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 10/01/2013 03:35 PM, Joseph Bechara wrote:
> Thanks Roman,
> 
> 
> 
> I know the rgeos package but I?m not able to identify which tools
> can replace the merge of ArcGIS.

What does "merge" in ArcGIS do?

Note that package sp has a merge method that merges a Spatial object
with a data.frame, based on the attribute table, similar to base::merge.

> 
> 
> 
> 
> 
> JOSEPH BECHARA
> 
> Wildfire Management Program Coordinator
> 
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
> 
> Tel.: +961 (1) 426630-1-2
> 
> Fax: +961 (1) 426631
> 
> Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org
> 
> <http://www.lri-lb.org/> www.lri-lb.org
> 
> Description: Description: LRI-logo-Email
> 
> 
> 
> 
> 
> From: romunov at gmail.com [mailto:romunov at gmail.com] On Behalf Of
> Roman Lu?trik Sent: Tuesday, October 01, 2013 4:32 PM To: Joseph
> Bechara Cc: R-sig-geo mailing list Subject: Re: [R-sig-Geo] merge
> Shape file
> 
> 
> 
> I think you want the `rgeos` package that offers a plethora of
> functions to work with "features".
> 
> 
> 
> Cheers,
> 
> Roman
> 
> 
> 
> 
> 
> On Tue, Oct 1, 2013 at 3:25 PM, Joseph Bechara
> <jbechara at lri-lb.org> wrote:
> 
> Dear Bary,
> 
> 
> 
> Actually I have to do a geometrical merge operation.
> 
> I?m looking for the equivalent of ?merge? in ArcGIS.
> 
> 
> 
> JOSEPH BECHARA
> 
> Wildfire Management Program Coordinator
> 
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon
> 
> Tel.: +961 (1) 426630-1-2
> 
> Fax: +961 (1) 426631
> 
> Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org
> 
> <http://www.lri-lb.org/> www.lri-lb.org
> 
> 
> 
> 
> 
> From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On
> Behalf Of Barry Rowlingson Sent: Tuesday, October 01, 2013 4:04 PM 
> To: Joseph Bechara Cc: R-sig-Geo at r-project.org Subject: Re:
> [R-sig-Geo] merge Shape file
> 
> 
> 
> 
> 
> 
> 
> On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara
> <jbechara at lri-lb.org> wrote:
> 
> I?m looking for a function to merge 2 shapefiles keeping them as
> ?spatialPolygonsDataframe? class.
> 
> Any clue?
> 
> 
> 
> 
> 
> 
> 
> What do you mean by merge? If the two shapefiles have the same set
> of attributes then just read them into SpatialPolygonsDataFrames
> and do s12 = rbind(s1,s2), and you end up with a SPDF which has all
> the features from s1 and s2.
> 
> Or do you want to do some geometrical merge operation?
> 
> Barry
> 
> 
> 
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> 
> 
> 
> 
> 
> 
> 
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSSteOAAoJEM1OCHCtOnfxOpEIAIisuqODm1YEfgYq4MgZGb03
raqQaIYC4PVeNwej+0P3regFWPd53+Y5DxqA2tS8zZ3eda1UK0KMvJFP4bJukk+U
5I37k4lZane+r89KtgCi7RFhvhM+U8VY10fN/y/Qr+P/3GTqukBNovI+8Q9xts3T
Jq19oC+GGztyyGS6y4+c25qZEDJUXSiHs69frCoEYRoV5HSGM1SDwf1eZ7O7FslH
Pq4ZPy62cXwbDrsrRZms1juuqkrn3JCN91sd9k3QVkiYJrcDimfnepGWbMwmpfs+
gP4eMw9jFQ8MO/TDjlMtgpYI7kXKCLoQHWtsX9FIadlGHXdZsfsMOgS6+T40KcM=
=Bv1v
-----END PGP SIGNATURE-----


From b.rowlingson at lancaster.ac.uk  Tue Oct  1 17:03:25 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 1 Oct 2013 16:03:25 +0100
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <b0a873cf3a51459e8a71cbafc6154ed4@EX-1-HT0.lancs.local>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
	<011601cebeab$1ab88b30$5029a190$@lri-lb.org>
	<b0a873cf3a51459e8a71cbafc6154ed4@EX-1-HT0.lancs.local>
Message-ID: <CANVKczM6oMpMAWZ0iUau3UaP6_Coy51xVsG0xd=JdGVvgcfyrg@mail.gmail.com>

On Tue, Oct 1, 2013 at 3:09 PM, Edzer Pebesma
<edzer.pebesma at uni-muenster.de> wrote:

> What does "merge" in ArcGIS do?

 Its 18 years since I last used ESRI products. I know what "merge" in
Arc/Info v4 used to do - crash the workstations.

 plus ca change?

Barry


From b.rowlingson at lancaster.ac.uk  Tue Oct  1 17:42:54 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 1 Oct 2013 16:42:54 +0100
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates
In-Reply-To: <8d7282c24de04eb58c538473e323b874@EX-1-HT0.lancs.local>
References: <8d7282c24de04eb58c538473e323b874@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOm8j6RczYu=Qbx-=u2VJ5VG5B8aRVs1kdiZqN1uff4NQ@mail.gmail.com>

On Tue, Oct 1, 2013 at 2:26 PM, Amelie LESCROEL
<Amelie.LESCROEL at cefe.cnrs.fr> wrote:


> Is there a way to read the .prj directly from R? How should I do to be able to map this image with long-lat coordinates? I guess that lots of the required information to do this could be gathered from the metadata of this file (http://lance-modis.eosdis.nasa.gov/imagery/subsets/?project=antarctica&subset=RossSea.2004356.aqua.500m.met) but I'm not sure how to implement this and all my previous attempts failed.
>
> Thanks in advance for your help and do not hesitate to direct me towards an online resource / reading material that I could have overlooked.

 If you get the "Download JPG image with ancillary files (.zip)" and
unzip it as well as the tif you'll get a .jpg, a .jgw, and a .prj
file. Gdal will use those to give the JPG file a coordinate system:

 > j=stack("./RossSea.2004356.aqua.500m.jpg")
 > projection(j)
[1] "+proj=laea +lat_0=-75 +lon_0=-170 +x_0=0 +y_0=0 +a=6371000
+b=6371000 +units=m +no_defs"

 but as you noticed this doesn't work for GeoTIFFs:

> t=stack("./RossSea.2004356.aqua.500m.tif")
> projection(t)
[1] "NA"

never mind, as long as they have the same projection, we can just:

projection(t)=projection(j)
plotRGB(t)

and we don't need 'j' any more.

There's probably a proper way to do this, but this works.

Note that converting to long-lat is going to need a warp operation. I
normally do this in two steps:

1. compute the extent in the new coords:

e=projectExtent(t,CRS("+init=epsg:4326"))

2. do it:

tl=projectRaster(t,e,method="ngb")

[ngb is a bit quicker than the default, read the docs and decide]

plotRGB(tl)

should then have it in lat-long. Its not much of a stretch since its a
smallish area.

Barry


From Roger.Bivand at nhh.no  Tue Oct  1 20:58:33 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 1 Oct 2013 20:58:33 +0200
Subject: [R-sig-Geo] R encounters fatal error in errorsarlm - sdpep
 package
In-Reply-To: <alpine.LRH.2.03.1310011255250.30580@reclus.nhh.no>
References: <20130925031256.Horde.qsxGeD1l-NpSQjiYJzG2u4A@webmail.tu-harburg.de>
	<alpine.LRH.2.03.1309250933070.15434@reclus.nhh.no>
	<5249C850.9080604@tu-harburg.de>
	<alpine.LRH.2.03.1309302058400.27490@reclus.nhh.no>
	<524A24CD.8010407@tuhh.de>
	<alpine.LRH.2.03.1310011255250.30580@reclus.nhh.no>
Message-ID: <alpine.LRH.2.03.1310012056310.3726@reclus.nhh.no>

On Tue, 1 Oct 2013, Roger Bivand wrote:

> On Tue, 1 Oct 2013, Philine Gaffron wrote:
>
>> Thank you for the Geographical Analysis reference, very helpful. I have 
>> deduced that the method argument should be "Matrix" for my data rather than 
>> "LU", since the "W" weights are symmetric. However, I am still getting the 
>> warnings on non convergence and since you state that this maybe a 
>> specification problem, I would like to find the error.
>
> I think that, unless you need the Hausman test from errorsarlm, just turn it 
> off with errorsarlm(..., control=list(returnHcov=FALSE)); the ML fit is quite 
> OK, it is only the Hausman test component that is giving the warnings for the 
> spatial coefficient close to its limits, and when using other methods than 
> "eigen". If you do need it and cannot use method="eigen", increase the order 
> until the warning (it is a warning, not an error) goes away with 
> errorsarlm(..., control=list(pWOrder=<big integer>)). I have had win-builder 
> roll up a Windows binary of the development version with more details on the 
> problem, on:
>
> http://win-builder.r-project.org/5IVvaH0M3Qsj

Use rather:

http://win-builder.r-project.org/21E63UI6JzHH

as the first attempt was not completely though through.

Roger

>
> See the examples for powerWeight, and look at the returned component for the 
> warnining-displaying errorsarlm fit called $pWinternal showing how 
> convergence failed; series needs to fall below tol for convergence.
>
> As your n is not large, you can compare the "eigen" and "Matrix" methods to 
> see how the Hausman test output diverges as the approximation to the term 
> needed deteriorates.
>
> The underlying problem that you have touched is (as in the sections in Bivand 
> et al. 2013 on approximations) that using power series to generate the 
> product of the inverse of the nxn (I - \rho W) matrix and an arbitrary vector 
> also deteriotates when \rho is near its limits.
>
> Thanks for the detailed results; I've deleted them in this reply to save 
> space.
>
> Roger
>
>> I did eliminate all polygons without neighbours for all my datasets before 
>> calling errorsarlm, so this should not be the problem. I include a full 
>> code example inline below (including documentation of the intermediate 
>> objects and the R outputs) for one dataset with warning and one without 
>> below in case you have time to look at it and find a possible error source 
>> that I have not identified.
>> 
>> comments on crash also inline
>> 
>> Am 30.09.2013 12:31, schrieb Roger Bivand:
>>> On Mon, 30 Sep 2013, Philine Gaffron wrote:
>>> 
>>>> Thank you for the response, Roger. My answers below. I have also added a 
>>>> question on a warning message I have received and would be glad to find 
>>>> out whether this means I need to change the analysis approach or just 
>>>> have to take it as additional information.
>>> 
>>> Thanks for reporting back: some points for clarification inline.
>>> 
>>>> 
>>>> Am 25.09.2013 00:53, schrieb Roger Bivand:
>>>>> On Wed, 25 Sep 2013, Philine Gaffron wrote:
>>>>> 
>>>>>> Hello,
>>>>>> 
>>>>>> I am trying to run a spatial regression analysis using the errorsarlm
>>>>>> function in the sdpep package. I first ran into memory problems (on a
>>>>>> larger dataset than the one described below) but have adjusted the
>>>>>> memory size limit:
>>>>>> 
>>>>>>> memory.limit(size = 800000)
>>>>>> [1] 8e+05
>>>>> 
>>>>> Which sets your memory limit under Windows to 781 Gb (size is in Mb) -
>>>>> that probably explains the error exit unless you have a lot of memory.
>>>>> Best avoid making any changes from the default in a fresh session
>>>>> unless you know exactly what you are doing.
>>>> 
>>>> I did up the virtual memory of the machine to 800Gb first (it has 1Tb in 
>>>> total and there is currently nothing else running on it) so I hope that 
>>>> that was not the problem. Thanks for the hint, though.
>>>> 
>>>>> 
>>>>>> 
>>>>>> However, when I try to execute the following code in R Studio, I
>>>>>> receive the message "R Session aborted - R encountered a fatal error
>>>>>> - The session was terminated"
>>>>> 
>>>>> Always rerun any code with problems outside R Studio, because it can
>>>>> interfere with the reporting of warnings and errors. Certainly
>>>>> errorsarlm() has no reason to cause R to crash - and this is what you
>>>>> are suggesting. If you can reproduce this outside R Studio, and
>>>>> without setting memory limits, I may need to see your data to try to
>>>>> reproduce any error exit from the R session.
>>>> 
>>>> I tried this and had no more crashes - especially after I made the 
>>>> changes suggested/outlined below
>>> 
>>> Does this mean that the R error exit occurred when you used R Studio, and 
>>> did not occur when R was run directly, using exactly the same data and 
>>> code? If so, please also let the R Studio people know, so that they can 
>>> continue debugging.
>> 
>> I will try to reproduce this once I have understood / solved my 
>> non-convergence problem. If and when I do, I will send the code and data to 
>> the RStudio people and cc you (?).
>>> 
>>>> 
>>>>> 
>>>>>> 
>>>>>>> ElDU.slm.PM25.white <- errorsarlm(PM_PM25 ~ race_white, data =
>>>>>>> ElDorado_urban, listw=ElDoU_listw)
>>>>> 
>>>>> Did you read the advice on ?errorsarlm about the use of alternative
>>>>> methods, such as "LU" or "Matrix" for larger data sets? You are using
>>>>> the default "eigen" method, but this should certainly have worked for
>>>>> the modest n=2081. Can you reproduce the problem with a built-in data
>>>>> set, such as elect80?
>>>> 
>>>> I opted for the "LU" method and changed the weights style (see below). Is 
>>>> there any documentation that tells me the implications of using method 
>>>> ="LU"? I only found the note in the spdep documentation "LU_order default 
>>>> FALSE; used in ?LU_prepermutate?, note warnings given for lu method" but 
>>>> nothing further. I did receive warnings in the output, though (for 
>>>> several but not all of my datasets) and I am not sure what they mean / 
>>>> what their implications are for the results. Do I need to choose another 
>>>> method? The warnings in every case were:
>>>> 
>>> 
>>> See Bivand, Hauke & Kossowski (2013) Geographical Analysis for some 
>>> details; LU_prepermutate emulates the implementation by finding an initial 
>>> fill-in re-ordering, but in R has little speed-up effect, hence it is 
>>> turned off by default.
>>> 
>>>> 1: In powerWeights(W = W, rho = lambda, order = con$pWOrder, X = B,:
>>>> not converged within order iterations
>>>> 
>>>> 2: In powerWeights(W = t(W), rho = lambda, order = con$pWOrder, X = C,:
>>>> not converged within order iterations
>>> 
>>> These are unusual, and may signal a mis-specified setting. The default 
>>> number of powers is 250, and lambda^250 is a very small number unless 
>>> lambda is close to its (probably upper) limit. The computation in fact 
>>> only affects the accuracy of the Hausman test on the difference between 
>>> OLS and spatial error coefficients, so may be adjusted if lambda is close 
>>> to limits by setting control argument pWOrder to a larger value than 250, 
>>> see ?powerWeights. As a symptom of lambda close to its limits, it suggests 
>>> mis-specification, possibly in terms of observation support, with 
>>> neighbouring properties sharing important drivers. This may be suggested 
>>> by your data scenario described below; scrutinising the intermediate 
>>> objects in your script may also put you on the track of things behaving in 
>>> unexpected ways. I would expect many observations to have no neighbours 
>>> with a 150m threshold, but you don't show no-neighbour control being 
>>> turned off.
>> I removed all polygons without neighbours prior to calling errorsarlm - see 
>> example below.
>>> 
>>> Hope the helps,
>>> 
>>> Roger
>>> 
>>>> 
>>>> I have not tried reproducing the error with the built-in dataset but if 
>>>> that is of interest to you from the point of view of spdep development, I 
>>>> could give it a try.
>>>> 
>>>>> 
>>>>>> 
>>>>>> The data was imported from an ArcGIS shape file:
>>>>>>> Parcels2008_inc_POP <- readOGR(".", "Parcels_2008_inc_pop")
>>>>>>> ElDorado_urban <- subset(Parcels2008_inc_POP, COUNTYFP10 == "017")
>>>>>> 
>>>>>> The subset contains data from 2081 polygons
>>>>>> 
>>>>>> The listw object was created as follows:
>>>>>> 
>>>>>>> Eld_U_coords <- coordinates(ElDorado_urban)
>>>>>>> Eld_U_IDs <- row.names(ElDorado_urban)
>>>>>>> ElDoU_nb <- dnearneigh(Eld_U_coords, d1 = 0, d2 = 492, row.names =
>>>>>>> Eld_U_IDs)
>>>>> 
>>>>> Is 492 a well-chosen upper distance threshold? I assume that the input
>>>>> data are projected, so that these are measures in the units of the
>>>>> projection - metres? If Eld_U_coords are actually geographical
>>>>> coordinates, but longlat=NULL, d2 is taken as a planar measure, if you
>>>>> declare longlat=TRUE, it is in km. There is no easy way to trap
>>>>> undeclared geographical coordinates.
>>>> 
>>>> The distance thresholds are in feet 
>>>> (NAD_1983_StatePlane_California_II_FIPS_0402_Feet) and are related to 
>>>> dispersion distances for road traffic emissions. For explanation: my 
>>>> polygons are land use parcels for which I have calculated emission loads 
>>>> in grams/area from traffic loads on a road network. Since I am assuming a 
>>>> dispersion distance of 492 feet / 150 m of emissions away from the 
>>>> network in the example above, I am further assuming, that parcels which 
>>>> are within that distance of one another are affected by the same emission 
>>>> sources (i.e. traffic loads on the network).
>>>> 
>>>>> 
>>>>>>> ElDoU_listw <- nb2listw(ElDoU_nb, glist=NULL, style="S",
>>>>>>> zero.policy=NULL)
>>>>>> 
>>>>> 
>>>>> Does choosing a different style make a difference ("S" is not often
>>>>> used)?
>>>> 
>>>> I chose "S" as a variance stabilising coding schemes following Bivand, 
>>>> Pebesma et al. (2008), p. 253 but have now switched back to "W". Apart 
>>>> from the warnings cited above I encountered no more issues.
>>>> 
>>>> Thank you for your help and for making this package available.
>>>> 
>>>> Philine
>>>> 
>>>>> 
>>>>> Roger
>>>>> 
>>>>>> Is there anything inherent in my approach that could cause this
>>>>>> problem or would one need to look at the data? I include the session
>>>>>> info below.
>>>>>> 
>>>>>> Thanks for any help,
>>>>>> 
>>>>>> Philine
>>>>>> 
>>>>>>> sessionInfo()
>>>>>> R version 3.0.1 (2013-05-16)
>>>>>> Platform: x86_64-w64-mingw32/x64 (64-bit)
>>>>>> 
>>>>>> locale:
>>>>>> [1] LC_COLLATE=English_United States.1252 LC_CTYPE=English_United
>>>>>> States.1252 LC_MONETARY=English_United States.1252 LC_NUMERIC=C
>>>>>> [5] LC_TIME=English_United States.1252
>>>>>> 
>>>>>> attached base packages:
>>>>>> [1] stats graphics grDevices utils datasets methods base
>>>>>> 
>>>>>> other attached packages:
>>>>>> [1] spdep_0.5-65 Matrix_1.0-12 lattice_0.20-15 rgdal_0.8-11 sp_1.0-13
>>>>>> 
>>>>>> loaded via a namespace (and not attached):
>>>>>> [1] boot_1.3-9 coda_0.16-1 deldir_0.0-22 grid_3.0.1 LearnBayes_2.12
>>>>>> MASS_7.3-26 nlme_3.1-109 splines_3.0.1 tools_3.0.1
>>>>>> 
>>>>>>> library(help=spdep)
>>>>>> Information on package ?spdep?
>>>>>> 
>>>>>> Description:
>>>>>> 
>>>>>> Package: spdep
>>>>>> Version: 0.5-65
>>>>>> Date: 2013-09-04
>>>>>> 
>>>>>> 
>>>>> 
>>>> 
>>>> 
>>> 
>> 
>> 
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.hijmans at gmail.com  Tue Oct  1 23:26:21 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 1 Oct 2013 14:26:21 -0700
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <011601cebeab$1ab88b30$5029a190$@lri-lb.org>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
	<011601cebeab$1ab88b30$5029a190$@lri-lb.org>
Message-ID: <CANtt_hw1=nq_G-TLi=0fYA_cfy4quUC75tS0HSuiD=N5yK_9Kw@mail.gmail.com>

Joseph,
The merge in ArcGIS is actually the similar to sp::rbind as Barry pointed
out. You probably want 'union'. rgeos has gUnion, and sptools (on R-Forge)
has 'union' and other functions that extend rgeos by adding attribute table
handling.
Robert


On Tue, Oct 1, 2013 at 6:35 AM, Joseph Bechara <jbechara at lri-lb.org> wrote:

> Thanks Roman, ****
>
> ** **
>
> I know the rgeos package but I?m not able to identify which tools can
> replace the merge of ArcGIS.****
>
> ** **
>
> ** **
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Program Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon**
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> [image: Description: Description: LRI-logo-Email]****
>
> ** **
>
> ** **
>
> *From:* romunov at gmail.com [mailto:romunov at gmail.com] *On Behalf Of *Roman
> Lu?trik
> *Sent:* Tuesday, October 01, 2013 4:32 PM
> *To:* Joseph Bechara
> *Cc:* R-sig-geo mailing list
>
> *Subject:* Re: [R-sig-Geo] merge Shape file****
>
> ** **
>
> I think you want the `rgeos` package that offers a plethora of functions
> to work with "features".****
>
> ** **
>
> Cheers,****
>
> Roman****
>
> ** **
>
> ** **
>
> On Tue, Oct 1, 2013 at 3:25 PM, Joseph Bechara <jbechara at lri-lb.org>
> wrote:****
>
> Dear Bary, ****
>
>  ****
>
> Actually I have to do a geometrical merge operation.****
>
> I?m looking for the equivalent of ?merge? in ArcGIS.****
>
>  ****
>
> *JOSEPH BECHARA*****
>
> *Wildfire Management Program Coordinator*****
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon****
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> ****
>
>  ****
>
>  ****
>
> *From:* b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] *On Behalf
> Of *Barry Rowlingson
>
> *Sent:* Tuesday, October 01, 2013 4:04 PM
> *To:* Joseph Bechara
> *Cc:* R-sig-Geo at r-project.org
> *Subject:* Re: [R-sig-Geo] merge Shape file
> ****
>
>  ****
>
>  ****
>
>  ****
>
> On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara <jbechara at lri-lb.org>
> wrote:****
>
> I?m looking for a function to merge 2 shapefiles keeping them as
> ?spatialPolygonsDataframe? class.****
>
> Any clue?****
>
>  ****
>
>  ****
>
>  ****
>
> What do you mean by merge? If the two shapefiles have the same set of
> attributes then just read them into SpatialPolygonsDataFrames and do s12 =
> rbind(s1,s2), and you end up with a SPDF which has all the features from s1
> and s2.****
>
> Or do you want to do some geometrical merge operation?****
>
> Barry****
>
>  ****
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo****
>
>
>
> ****
>
> ** **
>
> --
> In God we trust, all others bring data. ****
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/0ff1ecff/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131001/0ff1ecff/attachment.jpe>

From jbechara at lri-lb.org  Wed Oct  2 10:39:11 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Wed, 2 Oct 2013 11:39:11 +0300
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <CANtt_hw1=nq_G-TLi=0fYA_cfy4quUC75tS0HSuiD=N5yK_9Kw@mail.gmail.com>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>	<011601cebeab$1ab88b30$5029a190$@lri-lb.org>
	<CANtt_hw1=nq_G-TLi=0fYA_cfy4quUC75tS0HSuiD=N5yK_9Kw@mail.gmail.com>
Message-ID: <004601cebf4a$df6ed1b0$9e4c7510$@lri-lb.org>

Hi Robert, 

 

   I wanted to use the union but my shapefiles are not intersecting.

I want to combine 10 adjacent shapefiles.

Will ?union? work in this case?

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: Robert J. Hijmans [mailto:r.hijmans at gmail.com] 
Sent: Wednesday, October 02, 2013 12:26 AM
To: Joseph Bechara
Cc: Roman Lu?trik; R-sig-geo mailing list
Subject: Re: [R-sig-Geo] merge Shape file

 

Joseph, 

The merge in ArcGIS is actually the similar to sp::rbind as Barry pointed out. You probably want 'union'. rgeos has gUnion, and sptools (on R-Forge) has 'union' and other functions that extend rgeos by adding attribute table handling.

Robert

 

On Tue, Oct 1, 2013 at 6:35 AM, Joseph Bechara <jbechara at lri-lb.org> wrote:

Thanks Roman, 

 

I know the rgeos package but I?m not able to identify which tools can replace the merge of ArcGIS.

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: romunov at gmail.com [mailto:romunov at gmail.com] On Behalf Of Roman Lu?trik
Sent: Tuesday, October 01, 2013 4:32 PM
To: Joseph Bechara
Cc: R-sig-geo mailing list


Subject: Re: [R-sig-Geo] merge Shape file

 

I think you want the `rgeos` package that offers a plethora of functions to work with "features".

 

Cheers,

Roman

 

 

On Tue, Oct 1, 2013 at 3:25 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

Dear Bary, 

 

Actually I have to do a geometrical merge operation.

I?m looking for the equivalent of ?merge? in ArcGIS.

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

 

 

From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson


Sent: Tuesday, October 01, 2013 4:04 PM
To: Joseph Bechara
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] merge Shape file

 

 

 

On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara <jbechara at lri-lb.org> wrote:

I?m looking for a function to merge 2 shapefiles keeping them as ?spatialPolygonsDataframe? class.

Any clue?

 

 

 

What do you mean by merge? If the two shapefiles have the same set of attributes then just read them into SpatialPolygonsDataFrames and do s12 = rbind(s1,s2), and you end up with a SPDF which has all the features from s1 and s2.

Or do you want to do some geometrical merge operation?

Barry

 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo







-- 
In God we trust, all others bring data. 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/b8659be8/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/b8659be8/attachment.jpe>

From joshgray at bu.edu  Wed Oct  2 13:28:48 2013
From: joshgray at bu.edu (joshgray)
Date: Wed, 2 Oct 2013 04:28:48 -0700 (PDT)
Subject: [R-sig-Geo] stackApply and clusterR
Message-ID: <1380713328212-7584760.post@n2.nabble.com>

I'd like to use /stackApply/ with /clusterR/ to parallelize /RasterStack/
operations. For example, to run some time-series analysis function over the
"z-dimension" of a RasterStack comprised of many large images. I'd
previously accomplished this with the /parallel/ and /rgdal/ packages along
with the /parApply/ function. However, the stacks have gotten a lot bigger
and I can no longer read the entire stack into memory to perform these
operations. So, I'd like to take a /raster/ approach.

/clusterR/ says that it supports most functions that take a /Raster*/ object
as the first argument. Since /stackApply/ conforms to this requirement, I
thought it'd be easy. However, I can't seem to get this to work. My
computing environment is a Linux cluster running Sun Grid Engine.

Here's a toy example that tries to count the number of non-NA values in the
z-dimension of a /RasterStack/. This is just for demo purposes, the actual
operations are more complex.

require(raster)
beginCluster(n=8)

my.f1 <- function(x) length(!is.na(x))

set.seed(42)
x1 <- runif(100)
x2 <- x1
x3 <- x1
x1[sample(1:100, 30)] <- NA
x2[sample(1:100, 30)] <- NA
x3[sample(1:100, 30)] <- NA
r1 <- raster(matrix(x1, nrow=10, ncol=10))
r2 <- raster(matrix(x2, nrow=10, ncol=10))
r3 <- raster(matrix(x3, nrow=10, ncol=10))
s <- stack(r1, r2, r3)

s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
fails
s.out <- clusterR(s, fun=my.f1) # fails

endCluster()


The first attempt at creating /s.out/ fails with this message:
> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
> fails
Error in checkForRemoteErrors(lapply(cl, recvResult)) : 
  6 nodes produced errors; first error: unused argument(s) (na.rm = TRUE)

And then running it again:
> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
> fails
Error in cellFromRowCol(out, tr$row[j], 1) : subscript out of bounds

And once more:
> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
> fails
Error in checkForRemoteErrors(lapply(cl, recvResult)) : 
  one node produced an error: unused argument(s) (na.rm = TRUE)

Any ideas?




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/stackApply-and-clusterR-tp7584760.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From milan.cisty at stuba.sk  Wed Oct  2 13:53:20 2013
From: milan.cisty at stuba.sk (Milan Cisty)
Date: Wed, 2 Oct 2013 13:53:20 +0200
Subject: [R-sig-Geo] voronoi (thiessen) polygons inside irregular area
Message-ID: <002d01cebf65$fd57b9b0$f8072d10$@stuba.sk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/79eb01a1/attachment.pl>

From joshgray at bu.edu  Wed Oct  2 14:15:02 2013
From: joshgray at bu.edu (joshgray)
Date: Wed, 2 Oct 2013 05:15:02 -0700 (PDT)
Subject: [R-sig-Geo] stackApply and clusterR
In-Reply-To: <1380713328212-7584760.post@n2.nabble.com>
References: <1380713328212-7584760.post@n2.nabble.com>
Message-ID: <1380716102291-7584762.post@n2.nabble.com>

Sorry, I ignored the detail for /stackApply/ that specified that /fun/ should
have accept an na.rm argument. I also had monkeyed up the function and
indices specification. In case anyone is interested, this works:

require(raster)

set.seed(42)
x1 <- runif(100)
x2 <- x1
x3 <- x1
x1[sample(1:100, 30)] <- NA
x2[sample(1:100, 30)] <- NA
x3[sample(1:100, 30)] <- NA
r1 <- raster(matrix(x1, nrow=10, ncol=10))
r2 <- raster(matrix(x2, nrow=10, ncol=10))
r3 <- raster(matrix(x3, nrow=10, ncol=10))
s <- stack(r1, r2, r3)

beginCluster(n=8)

my.f1 <- function(x, na.rm=T){
	sum(!is.na(x))
}

s.out <- clusterR(s, stackApply, args=list(indices=rep(1, 3), fun=my.f1))

# > s[1]
#      layer.1  layer.2  layer.3
# [1,]      NA 0.914806 0.914806
# > s[2]
#        layer.1 layer.2 layer.3
# [1,] 0.4577418      NA      NA
# > s.out[1] 
# 2 
# > s.out[2]
# 1 

endCluster()



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/stackApply-and-clusterR-tp7584760p7584762.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mathieu.rajerison at gmail.com  Wed Oct  2 15:45:08 2013
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 2 Oct 2013 15:45:08 +0200
Subject: [R-sig-Geo] voronoi (thiessen) polygons inside irregular area
In-Reply-To: <002d01cebf65$fd57b9b0$f8072d10$@stuba.sk>
References: <002d01cebf65$fd57b9b0$f8072d10$@stuba.sk>
Message-ID: <CAGfc75kur4T3SqgZbSjvLjhGUe0cWv3m=krVGfO2c_OevFxkbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/49d8437e/attachment.pl>

From r.hijmans at gmail.com  Wed Oct  2 21:32:20 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 2 Oct 2013 12:32:20 -0700
Subject: [R-sig-Geo] merge Shape file
In-Reply-To: <004601cebf4a$df6ed1b0$9e4c7510$@lri-lb.org>
References: <069715e318084f0daf3ab53c67e52b32@EX-0-HT0.lancs.local>
	<CANVKczOLiHoxiAAbAP=BbS+YrRNj0+njwFV1MJF=W7YUU-6NTw@mail.gmail.com>
	<00e701cebea9$c2d718b0$48854a10$@lri-lb.org>
	<CAHT1vpghEBFyCEWOyHM3cesYt9kadYRA_MO1vOax3SETYpCkNw@mail.gmail.com>
	<011601cebeab$1ab88b30$5029a190$@lri-lb.org>
	<CANtt_hw1=nq_G-TLi=0fYA_cfy4quUC75tS0HSuiD=N5yK_9Kw@mail.gmail.com>
	<004601cebf4a$df6ed1b0$9e4c7510$@lri-lb.org>
Message-ID: <CANtt_hwAywkBMqyjTtHu3xnC55vycueG2+cGM07L80TFr4RiDQ@mail.gmail.com>

In that case I would use "combine".


On Wed, Oct 2, 2013 at 1:39 AM, Joseph Bechara <jbechara at lri-lb.org> wrote:

> Hi Robert, ****
>
> ** **
>
>    I wanted to use the union but my shapefiles are not intersecting.****
>
> I want to combine 10 adjacent shapefiles.****
>
> Will "union" work in this case?****
>
> ** **
>
> ** **
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Program Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon**
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> [image: Description: Description: LRI-logo-Email]****
>
> ** **
>
> ** **
>
> *From:* Robert J. Hijmans [mailto:r.hijmans at gmail.com]
> *Sent:* Wednesday, October 02, 2013 12:26 AM
> *To:* Joseph Bechara
> *Cc:* Roman Lu?trik; R-sig-geo mailing list
>
> *Subject:* Re: [R-sig-Geo] merge Shape file****
>
> ** **
>
> Joseph, ****
>
> The merge in ArcGIS is actually the similar to sp::rbind as Barry pointed
> out. You probably want 'union'. rgeos has gUnion, and sptools (on R-Forge)
> has 'union' and other functions that extend rgeos by adding attribute table
> handling.****
>
> Robert****
>
> ** **
>
> On Tue, Oct 1, 2013 at 6:35 AM, Joseph Bechara <jbechara at lri-lb.org>
> wrote:****
>
> Thanks Roman, ****
>
>  ****
>
> I know the rgeos package but I'm not able to identify which tools can
> replace the merge of ArcGIS.****
>
>  ****
>
>  ****
>
> *JOSEPH BECHARA*****
>
> *Wildfire Management Program Coordinator*****
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon****
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> [image: Description: Description: LRI-logo-Email]****
>
>  ****
>
>  ****
>
> *From:* romunov at gmail.com [mailto:romunov at gmail.com] *On Behalf Of *Roman
> Lu?trik
> *Sent:* Tuesday, October 01, 2013 4:32 PM
> *To:* Joseph Bechara
> *Cc:* R-sig-geo mailing list****
>
>
> *Subject:* Re: [R-sig-Geo] merge Shape file****
>
>  ****
>
> I think you want the `rgeos` package that offers a plethora of functions
> to work with "features".****
>
>  ****
>
> Cheers,****
>
> Roman****
>
>  ****
>
>  ****
>
> On Tue, Oct 1, 2013 at 3:25 PM, Joseph Bechara <jbechara at lri-lb.org>
> wrote:****
>
> Dear Bary, ****
>
>  ****
>
> Actually I have to do a geometrical merge operation.****
>
> I'm looking for the equivalent of "merge" in ArcGIS.****
>
>  ****
>
> *JOSEPH BECHARA*****
>
> *Wildfire Management Program Coordinator*****
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon****
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
>  ****
>
>  ****
>
> *From:* b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] *On Behalf
> Of *Barry Rowlingson****
>
>
> *Sent:* Tuesday, October 01, 2013 4:04 PM
> *To:* Joseph Bechara
> *Cc:* R-sig-Geo at r-project.org
> *Subject:* Re: [R-sig-Geo] merge Shape file****
>
>  ****
>
>  ****
>
>  ****
>
> On Tue, Oct 1, 2013 at 12:25 PM, Joseph Bechara <jbechara at lri-lb.org>
> wrote:****
>
> I'm looking for a function to merge 2 shapefiles keeping them as
> "spatialPolygonsDataframe" class.****
>
> Any clue?****
>
>  ****
>
>  ****
>
>  ****
>
> What do you mean by merge? If the two shapefiles have the same set of
> attributes then just read them into SpatialPolygonsDataFrames and do s12 =
> rbind(s1,s2), and you end up with a SPDF which has all the features from s1
> and s2.****
>
> Or do you want to do some geometrical merge operation?****
>
> Barry****
>
>  ****
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo****
>
>
>
> ****
>
>  ****
>
> --
> In God we trust, all others bring data. ****
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo****
>
> ** **
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/0a94b8c9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131002/0a94b8c9/attachment.jpe>

From r.hijmans at gmail.com  Wed Oct  2 21:35:45 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 2 Oct 2013 12:35:45 -0700
Subject: [R-sig-Geo] stackApply and clusterR
In-Reply-To: <1380713328212-7584760.post@n2.nabble.com>
References: <1380713328212-7584760.post@n2.nabble.com>
Message-ID: <CANtt_hyEdU9iXo+L1n337yK8Ntd9rOc9oJ2qOkre9yXCVa_D9Q@mail.gmail.com>

Well, you get the same error when you do:

> stackApply(s, indices=c(1:3), fun=my.f1)
Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)

The problem is that the function needs to take an na.rm argument,
perhaps via the dots (which it may ignore). So you can do:

> my.f1 <- function(x, ...) length(!is.na(x))
> stackApply(s, indices=c(1:3), fun=my.f1)
class       : RasterBrick
dimensions  : 10, 10, 100, 3  (nrow, ncol, ncell, nlayers)
resolution  : 0.1, 0.1  (x, y)
extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
coord. ref. : NA
data source : in memory
names       : layer.1, layer.2, layer.3
min values  :       1,       1,       1
max values  :       1,       1,       1




On Wed, Oct 2, 2013 at 4:28 AM, joshgray <joshgray at bu.edu> wrote:
> I'd like to use /stackApply/ with /clusterR/ to parallelize /RasterStack/
> operations. For example, to run some time-series analysis function over the
> "z-dimension" of a RasterStack comprised of many large images. I'd
> previously accomplished this with the /parallel/ and /rgdal/ packages along
> with the /parApply/ function. However, the stacks have gotten a lot bigger
> and I can no longer read the entire stack into memory to perform these
> operations. So, I'd like to take a /raster/ approach.
>
> /clusterR/ says that it supports most functions that take a /Raster*/ object
> as the first argument. Since /stackApply/ conforms to this requirement, I
> thought it'd be easy. However, I can't seem to get this to work. My
> computing environment is a Linux cluster running Sun Grid Engine.
>
> Here's a toy example that tries to count the number of non-NA values in the
> z-dimension of a /RasterStack/. This is just for demo purposes, the actual
> operations are more complex.
>
> require(raster)
> beginCluster(n=8)
>
> my.f1 <- function(x) length(!is.na(x))
>
> set.seed(42)
> x1 <- runif(100)
> x2 <- x1
> x3 <- x1
> x1[sample(1:100, 30)] <- NA
> x2[sample(1:100, 30)] <- NA
> x3[sample(1:100, 30)] <- NA
> r1 <- raster(matrix(x1, nrow=10, ncol=10))
> r2 <- raster(matrix(x2, nrow=10, ncol=10))
> r3 <- raster(matrix(x3, nrow=10, ncol=10))
> s <- stack(r1, r2, r3)
>
> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
> fails
> s.out <- clusterR(s, fun=my.f1) # fails
>
> endCluster()
>
>
> The first attempt at creating /s.out/ fails with this message:
>> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
>> fails
> Error in checkForRemoteErrors(lapply(cl, recvResult)) :
>   6 nodes produced errors; first error: unused argument(s) (na.rm = TRUE)
>
> And then running it again:
>> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
>> fails
> Error in cellFromRowCol(out, tr$row[j], 1) : subscript out of bounds
>
> And once more:
>> s.out <- clusterR(s, stackApply, args=list(indices=c(1:3), fun=my.f1)) #
>> fails
> Error in checkForRemoteErrors(lapply(cl, recvResult)) :
>   one node produced an error: unused argument(s) (na.rm = TRUE)
>
> Any ideas?
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/stackApply-and-clusterR-tp7584760.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From joshgray at bu.edu  Wed Oct  2 21:40:16 2013
From: joshgray at bu.edu (joshgray)
Date: Wed, 2 Oct 2013 12:40:16 -0700 (PDT)
Subject: [R-sig-Geo] stackApply and clusterR
In-Reply-To: <CANtt_hyEdU9iXo+L1n337yK8Ntd9rOc9oJ2qOkre9yXCVa_D9Q@mail.gmail.com>
References: <1380713328212-7584760.post@n2.nabble.com>
	<CANtt_hyEdU9iXo+L1n337yK8Ntd9rOc9oJ2qOkre9yXCVa_D9Q@mail.gmail.com>
Message-ID: <1380742816360-7584766.post@n2.nabble.com>

Thanks, Robert. I actually figured that out very soon after posting, and
posted a reply which shows up for me, but perhaps not for others?



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/stackApply-and-clusterR-tp7584760p7584766.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Thu Oct  3 01:06:47 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 3 Oct 2013 00:06:47 +0100
Subject: [R-sig-Geo] invalid geometries from negative buffering in rgeos/sp
Message-ID: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>

Using scot_BNG from the rgdal package:

dsn <- system.file("vectors", package = "rgdal")[1]
scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")

and buffering with a sufficiently large negative width:

b=gBuffer(scot_BNG,width=-10000,byid=TRUE)

produces an object that gives an error on plot:

 > plot(b)
Error in checkSlotAssignment(object, name, value) :
  assignment of an object of class ?NULL? is not valid for slot
"coords" in an object of class ?Line?; is(value, "matrix") is not TRUE

 Which I think is because the negative buffer has shrunk a feature to nothing.

b[1,] is fine but:

> b[2,]
Error in SpatialPolygons(x at polygons[i], proj4string = CRS(proj4string(x))) :
  INTEGER() can only be applied to a 'integer', not a 'NULL'

I'm not sure what the right thing to do here is. Either return a valid
zero-area polygon (if that's not a contradiction in terms) or drop the
degenerate cases?

Barry


From Amelie.LESCROEL at cefe.cnrs.fr  Thu Oct  3 11:04:25 2013
From: Amelie.LESCROEL at cefe.cnrs.fr (Amelie LESCROEL)
Date: Thu, 3 Oct 2013 11:04:25 +0200
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - RESOLVED
Message-ID: <EC2C4198CBEFB14F9B8661B1614106F30134C18AEC97@ZZMAIL.newcefe.newage.fr>

Thanks a lot for your solution, which works perfectly well, Barry. I should have worked with the .jpg rather than the .tif file to be able to read the projection and explore the function projectRaster(). Now, I just have to fiddle with the graphical parameters so that the y axis is not too far on the left from the image border.
Am?lie

-----Message d'origine-----
De?: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] De la part de Barry Rowlingson
Envoy??: mardi 1 octobre 2013 17:43
??: Amelie LESCROEL
Cc?: r-sig-geo at r-project.org
Objet?: Re: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with lat-long coordinates

On Tue, Oct 1, 2013 at 2:26 PM, Amelie LESCROEL <Amelie.LESCROEL at cefe.cnrs.fr> wrote:


> Is there a way to read the .prj directly from R? How should I do to be able to map this image with long-lat coordinates? I guess that lots of the required information to do this could be gathered from the metadata of this file (http://lance-modis.eosdis.nasa.gov/imagery/subsets/?project=antarctica&subset=RossSea.2004356.aqua.500m.met) but I'm not sure how to implement this and all my previous attempts failed.
>
> Thanks in advance for your help and do not hesitate to direct me towards an online resource / reading material that I could have overlooked.

 If you get the "Download JPG image with ancillary files (.zip)" and unzip it as well as the tif you'll get a .jpg, a .jgw, and a .prj file. Gdal will use those to give the JPG file a coordinate system:

 > j=stack("./RossSea.2004356.aqua.500m.jpg")
 > projection(j)
[1] "+proj=laea +lat_0=-75 +lon_0=-170 +x_0=0 +y_0=0 +a=6371000
+b=6371000 +units=m +no_defs"

 but as you noticed this doesn't work for GeoTIFFs:

> t=stack("./RossSea.2004356.aqua.500m.tif")
> projection(t)
[1] "NA"

never mind, as long as they have the same projection, we can just:

projection(t)=projection(j)
plotRGB(t)

and we don't need 'j' any more.

There's probably a proper way to do this, but this works.

Note that converting to long-lat is going to need a warp operation. I normally do this in two steps:

1. compute the extent in the new coords:

e=projectExtent(t,CRS("+init=epsg:4326"))

2. do it:

tl=projectRaster(t,e,method="ngb")

[ngb is a bit quicker than the default, read the docs and decide]

plotRGB(tl)

should then have it in lat-long. Its not much of a stretch since its a smallish area.

Barry


From b.rowlingson at lancaster.ac.uk  Thu Oct  3 11:31:59 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 3 Oct 2013 10:31:59 +0100
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - RESOLVED
In-Reply-To: <6ab2a91516f9480e99c13bf67d34c97b@EX-0-HT0.lancs.local>
References: <6ab2a91516f9480e99c13bf67d34c97b@EX-0-HT0.lancs.local>
Message-ID: <CANVKczN-x3=qSYeinypmP_8WK0eDqUPTYpcfn_8BzM2+w0sODQ@mail.gmail.com>

On Thu, Oct 3, 2013 at 10:04 AM, Amelie LESCROEL
<Amelie.LESCROEL at cefe.cnrs.fr> wrote:
> Thanks a lot for your solution, which works perfectly well, Barry. I should have worked with the .jpg rather than the .tif file to be able to read the projection and explore the function projectRaster(). Now, I just have to fiddle with the graphical parameters so that the y axis is not too far on the left from the image border.

The jpg is likely to be 'lossy', so if you care about the raw data
values you probably need to work with the tiff data (unless thats been
compressed with a lossy algorithm!).

Barry


From Amelie.LESCROEL at cefe.cnrs.fr  Thu Oct  3 12:02:16 2013
From: Amelie.LESCROEL at cefe.cnrs.fr (Amelie LESCROEL)
Date: Thu, 3 Oct 2013 12:02:16 +0200
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - RESOLVED
In-Reply-To: <CANVKczN-x3=qSYeinypmP_8WK0eDqUPTYpcfn_8BzM2+w0sODQ@mail.gmail.com>
References: <6ab2a91516f9480e99c13bf67d34c97b@EX-0-HT0.lancs.local>
	<CANVKczN-x3=qSYeinypmP_8WK0eDqUPTYpcfn_8BzM2+w0sODQ@mail.gmail.com>
Message-ID: <EC2C4198CBEFB14F9B8661B1614106F30134C18AECA4@ZZMAIL.newcefe.newage.fr>

Right, this is actually what I did, following your code. I used the .jpg file to get the projection and applied it to the .tif file.
Am?lie

-----Message d'origine-----
De?: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] De la part de Barry Rowlingson
Envoy??: jeudi 3 octobre 2013 11:32
??: Amelie LESCROEL
Cc?: r-sig-geo at r-project.org
Objet?: Re: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with lat-long coordinates - RESOLVED

On Thu, Oct 3, 2013 at 10:04 AM, Amelie LESCROEL <Amelie.LESCROEL at cefe.cnrs.fr> wrote:
> Thanks a lot for your solution, which works perfectly well, Barry. I should have worked with the .jpg rather than the .tif file to be able to read the projection and explore the function projectRaster(). Now, I just have to fiddle with the graphical parameters so that the y axis is not too far on the left from the image border.

The jpg is likely to be 'lossy', so if you care about the raw data values you probably need to work with the tiff data (unless thats been compressed with a lossy algorithm!).

Barry


From b.rowlingson at lancaster.ac.uk  Thu Oct  3 12:37:48 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 3 Oct 2013 11:37:48 +0100
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - RESOLVED
In-Reply-To: <5cd5ccea939543d8ad53da7d816806c6@EX-1-HT0.lancs.local>
References: <6ab2a91516f9480e99c13bf67d34c97b@EX-0-HT0.lancs.local>
	<CANVKczN-x3=qSYeinypmP_8WK0eDqUPTYpcfn_8BzM2+w0sODQ@mail.gmail.com>
	<5cd5ccea939543d8ad53da7d816806c6@EX-1-HT0.lancs.local>
Message-ID: <CANVKczPfRft43fG0DSpdFgQ=xh+QN8g82c2ujS2kCfTSLnuOpg@mail.gmail.com>

On Thu, Oct 3, 2013 at 11:02 AM, Amelie LESCROEL
<Amelie.LESCROEL at cefe.cnrs.fr> wrote:
> Right, this is actually what I did, following your code. I used the .jpg file to get the projection and applied it to the .tif file.

 I think if you then save the tiff with writeGDAL or writeRaster you
can write a tiff with the projection info in the metadata. But
obviously the real solution is to persuade the data provider to put it
in the metadata in the first place! Not that that will happen.

 Actually, you can do this on the command line with gdal_translate:

gdal_translate  -a_srs RossSea.2004356.aqua.500m.prj
RossSea.2004356.aqua.500m.tif RossSea-prj.tif

and that takes the projection data from the .prj file, adds it to the
.tif, and writes a new .tif with the metadata!

I did think one of the gdal command tools would do it, didnt realise
it was this easy!

Barry


From mdsumner at gmail.com  Thu Oct  3 13:41:53 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 3 Oct 2013 21:41:53 +1000
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - RESOLVED
In-Reply-To: <CANVKczPfRft43fG0DSpdFgQ=xh+QN8g82c2ujS2kCfTSLnuOpg@mail.gmail.com>
References: <6ab2a91516f9480e99c13bf67d34c97b@EX-0-HT0.lancs.local>
	<CANVKczN-x3=qSYeinypmP_8WK0eDqUPTYpcfn_8BzM2+w0sODQ@mail.gmail.com>
	<5cd5ccea939543d8ad53da7d816806c6@EX-1-HT0.lancs.local>
	<CANVKczPfRft43fG0DSpdFgQ=xh+QN8g82c2ujS2kCfTSLnuOpg@mail.gmail.com>
Message-ID: <CAAcGz9-jRaDHY_A3uaFNqskfu=_4Kto+8sUSHZPRh8HzLjfDoQ@mail.gmail.com>

Also also consider the "creation options" -co TILED=YES and -co
COMPRESS=LZW which really help efficiency and storage (for some tools)
(if they support it) (and so it depends on the target as usual). These
are available via arguments to writeRaster and writeGDAL.

Cheers, Mike.

On Thu, Oct 3, 2013 at 8:37 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> On Thu, Oct 3, 2013 at 11:02 AM, Amelie LESCROEL
> <Amelie.LESCROEL at cefe.cnrs.fr> wrote:
>> Right, this is actually what I did, following your code. I used the .jpg file to get the projection and applied it to the .tif file.
>
>  I think if you then save the tiff with writeGDAL or writeRaster you
> can write a tiff with the projection info in the metadata. But
> obviously the real solution is to persuade the data provider to put it
> in the metadata in the first place! Not that that will happen.
>
>  Actually, you can do this on the command line with gdal_translate:
>
> gdal_translate  -a_srs RossSea.2004356.aqua.500m.prj
> RossSea.2004356.aqua.500m.tif RossSea-prj.tif
>
> and that takes the projection data from the .prj file, adds it to the
> .tif, and writes a new .tif with the metadata!
>
> I did think one of the gdal command tools would do it, didnt realise
> it was this easy!
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From Roger.Bivand at nhh.no  Thu Oct  3 15:29:15 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 3 Oct 2013 15:29:15 +0200
Subject: [R-sig-Geo] invalid geometries from negative buffering in
 rgeos/sp
In-Reply-To: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>

On Thu, 3 Oct 2013, Barry Rowlingson wrote:

> Using scot_BNG from the rgdal package:
>
> dsn <- system.file("vectors", package = "rgdal")[1]
> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
>
> and buffering with a sufficiently large negative width:
>
> b=gBuffer(scot_BNG,width=-10000,byid=TRUE)
>
> produces an object that gives an error on plot:

Yes, but ...

The user gets a SpatialPolygonsDataFrame object with the data slot intact, 
but some of the polygons are clearly now invalid. Should we do 
book-keeping to only retain the data slot rows for valid polygons, only 
return the subset of valid polygons, or proceed as now, and have the user 
do:

plot(b[gArea(b, byid=TRUE) > 0,])

What makes more sense? I'm open to suggestions ...

Roger

>
> > plot(b)
> Error in checkSlotAssignment(object, name, value) :
>  assignment of an object of class ?NULL? is not valid for slot
> "coords" in an object of class ?Line?; is(value, "matrix") is not TRUE
>
> Which I think is because the negative buffer has shrunk a feature to nothing.
>
> b[1,] is fine but:
>
>> b[2,]
> Error in SpatialPolygons(x at polygons[i], proj4string = CRS(proj4string(x))) :
>  INTEGER() can only be applied to a 'integer', not a 'NULL'
>
> I'm not sure what the right thing to do here is. Either return a valid
> zero-area polygon (if that's not a contradiction in terms) or drop the
> degenerate cases?
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From b.rowlingson at lancaster.ac.uk  Thu Oct  3 15:45:17 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 3 Oct 2013 14:45:17 +0100
Subject: [R-sig-Geo] invalid geometries from negative buffering in
	rgeos/sp
In-Reply-To: <0ab7c5a899cb4a85ab3d2d452f92c036@EX-1-HT0.lancs.local>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<0ab7c5a899cb4a85ab3d2d452f92c036@EX-1-HT0.lancs.local>
Message-ID: <CANVKczOTQx6z-zynptngqSjZNEE3piciUFnF0fvZeU0B1iH0ew@mail.gmail.com>

On Thu, Oct 3, 2013 at 2:29 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> Yes, but ...
>
> The user gets a SpatialPolygonsDataFrame object with the data slot intact,
> but some of the polygons are clearly now invalid. Should we do
> book-keeping to only retain the data slot rows for valid polygons, only
> return the subset of valid polygons, or proceed as now, and have the user
> do:
>
> plot(b[gArea(b, byid=TRUE) > 0,])
>
> What makes more sense? I'm open to suggestions ...

 I'm first wondering what the source of the invalidity is here. What
does the underlying GEOS code return from one of these operations?
Does it have a valid NULL polygon feature concept? If so, then I'd
like to see that carried through into sp-class objects.

 Its not a sufficient condition that the area = 0 - a polygon of three
coincident points has area=0, but a big negative buffer should be a
geometry without even points in it...

Barry


From berman.jesse at gmail.com  Thu Oct  3 17:54:32 2013
From: berman.jesse at gmail.com (Jesse Berman)
Date: Thu, 3 Oct 2013 08:54:32 -0700 (PDT)
Subject: [R-sig-Geo] overlay a "ppp" object and a SpatialPolygon
In-Reply-To: <1380642678872-7584755.post@n2.nabble.com>
References: <1380642678872-7584755.post@n2.nabble.com>
Message-ID: <1380815672271-7584775.post@n2.nabble.com>

Hi Laetitia,

Try turning your .ppp object into a spatial grid data frame, then convert it
to a raster.  The 'extract' function should then work if your projections
are correct.

Jesse  

your.ppp.object<-as.SpatialGridDataFrame.im(your.ppp.object)
rast.ppp.object<- raster(your.ppp.object) #Convert to a raster grid

output<- extract(rast.ppp.object, polys)



-----
--------------------------------------------------------
Jesse D Berman, PhD
Yale University
School of Forestry and Environmental Studies
Post-Doc Fellow
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/overlay-a-ppp-object-and-a-SpatialPolygon-tp7584755p7584775.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From eddieatr at gmail.com  Thu Oct  3 18:55:01 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Thu, 3 Oct 2013 17:55:01 +0100
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
Message-ID: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/11f8519d/attachment.pl>

From vitale232 at gmail.com  Thu Oct  3 19:14:38 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 3 Oct 2013 10:14:38 -0700
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
Message-ID: <CAFTcopfbQJBhDgqKg6HGmcE=7ejV=TcbqBn6_ETo9HDG9TEJNA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/f86d2c6d/attachment.pl>

From eddieatr at gmail.com  Thu Oct  3 19:48:21 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Thu, 3 Oct 2013 18:48:21 +0100
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAFTcopfbQJBhDgqKg6HGmcE=7ejV=TcbqBn6_ETo9HDG9TEJNA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAFTcopfbQJBhDgqKg6HGmcE=7ejV=TcbqBn6_ETo9HDG9TEJNA@mail.gmail.com>
Message-ID: <CABaJH796pQkynZVoBXyRcdtZRoY0tTzn3EEF=RUUW04AEBBSDw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/75dda3de/attachment.pl>

From vitale232 at gmail.com  Thu Oct  3 19:54:57 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Thu, 3 Oct 2013 10:54:57 -0700
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CABaJH796pQkynZVoBXyRcdtZRoY0tTzn3EEF=RUUW04AEBBSDw@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAFTcopfbQJBhDgqKg6HGmcE=7ejV=TcbqBn6_ETo9HDG9TEJNA@mail.gmail.com>
	<CABaJH796pQkynZVoBXyRcdtZRoY0tTzn3EEF=RUUW04AEBBSDw@mail.gmail.com>
Message-ID: <CAFTcopfxyiOiU6LNdn_11mHYGCNEgraiaWzBqmvTSDYG0vUbMA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/7dbd1dc5/attachment.pl>

From eddieatr at gmail.com  Thu Oct  3 20:37:29 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Thu, 3 Oct 2013 19:37:29 +0100
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAFTcopfxyiOiU6LNdn_11mHYGCNEgraiaWzBqmvTSDYG0vUbMA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAFTcopfbQJBhDgqKg6HGmcE=7ejV=TcbqBn6_ETo9HDG9TEJNA@mail.gmail.com>
	<CABaJH796pQkynZVoBXyRcdtZRoY0tTzn3EEF=RUUW04AEBBSDw@mail.gmail.com>
	<CAFTcopfxyiOiU6LNdn_11mHYGCNEgraiaWzBqmvTSDYG0vUbMA@mail.gmail.com>
Message-ID: <CABaJH7_WZxBWmpX-QFhVzQo9rO6DPP=cDev3s=acHWBB6ZruZg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/7a707be9/attachment.pl>

From villers.alexandre at gmail.com  Thu Oct  3 22:25:28 2013
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Thu, 3 Oct 2013 22:25:28 +0200
Subject: [R-sig-Geo] spplot.points: one panel per level of a factor
Message-ID: <CAFrtd2Nf4je-ZpkU_jX=E=gQyO8hBX7R4MhQVfYpnbt2oK0QoA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131003/980a0c76/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Oct  4 11:56:01 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 04 Oct 2013 11:56:01 +0200
Subject: [R-sig-Geo] spplot.points: one panel per level of a factor
In-Reply-To: <CAFrtd2Nf4je-ZpkU_jX=E=gQyO8hBX7R4MhQVfYpnbt2oK0QoA@mail.gmail.com>
References: <CAFrtd2Nf4je-ZpkU_jX=E=gQyO8hBX7R4MhQVfYpnbt2oK0QoA@mail.gmail.com>
Message-ID: <524E90B1.7050603@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I don't think you are missing something here -- spplot doesn't do that
much more than the underlying lattice functions, and in particular it
tries to plot attributes of spatial features, using panels for
different attributes. Your question seems to only address plotting
points, sth that spplot does not try to.

You did not say which spplot options you want to take advantage of,
but suppose you want to add some referencing (a polygon), and remove
axis labels and tics, you might want to use:

library(sp)
demo(meuse, ask = FALSE)
xyplot(y~x|ffreq, as(meuse, "data.frame"), asp="iso",
	panel = function(x,y,...) {
		sp.polygons(meuse.riv)
		# anything else you want to do in every panel
		panel.xyplot(x,y,...)
	},
	scales = list(draw = FALSE),
	xlab = NULL, ylab = NULL
)

Hth,

On 10/03/2013 10:25 PM, Alexandre Villers wrote:
> Good evening,
> 
> I'm sure I'm missing something really obvious but I couldn't figure
> it out (or find the solution on the Internet). Is there a way to
> produce the same type of graph as
> 
> library(lattice) data(meuse) xyplot(y~x|ffreq, meuse, asp=1)
> 
> with spplot.points and a SpatialPointsDataFrame ?
> 
> I would like to represent the locations of different individuals
> on different panels but still  taking advantage of the spplot
> options.
> 
> Thanks in advance and sorry if this is a trivial question
> 
> Alex
> 
> [[alternative HTML version deleted]]
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081, Fax: +49 251 8339763 http://ifgi.uni-muenster.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSTpCxAAoJEM1OCHCtOnfxc1cH/0+uuzPASfCHPv8FJoTI0rZL
gG2Jt1mKHWXe8XZo8aBLN8SBRRrATlabtwoJ3GKDOunLgZ0x2DiWR387J/KoqI0c
NmNNq2dijkv1pJEWrK6gBYW+yVU90US6lSs23wG1sLaAcq/yhalg2wNbgf2zhsGN
6RqIihAEvu7EQk/mDMsG5websyUT5llA+Dt9eO5jamAvmBO58xKghcAz0oB5OLEI
hkNy2du2Uy5/GG+RGNwP9cUQWO2gQ8PbfAlxxp+YiGnERhyCdQ8vcFGdhCD0iFJB
Vk8iFL4GJ9Z+ubmU5EoK6+Syo/r2Ki8yLT4bcbLV7A/ZSyCYBV3ljn1uDshJ1rI=
=3epv
-----END PGP SIGNATURE-----


From villers.alexandre at gmail.com  Fri Oct  4 12:09:43 2013
From: villers.alexandre at gmail.com (Alexandre Villers)
Date: Fri, 4 Oct 2013 12:09:43 +0200
Subject: [R-sig-Geo] spplot.points: one panel per level of a factor
In-Reply-To: <524E90B1.7050603@uni-muenster.de>
References: <CAFrtd2Nf4je-ZpkU_jX=E=gQyO8hBX7R4MhQVfYpnbt2oK0QoA@mail.gmail.com>
	<524E90B1.7050603@uni-muenster.de>
Message-ID: <CAFrtd2ODP0zz4qpz3cew7mwKKRVrMoBMnBUMJwD6CZ=yH5NgyA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131004/06e01515/attachment.pl>

From Mauricio.Parra at fao.org  Fri Oct  4 14:06:44 2013
From: Mauricio.Parra at fao.org (Parra, Mauricio (AGPM))
Date: Fri, 4 Oct 2013 14:06:44 +0200
Subject: [R-sig-Geo] Complementary areas analysis
Message-ID: <7FAA73D70AEE6B4BA5BE48F8BD97BC9A07EEC878E3@HQEXDB02.hq.un.fao.org>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131004/64f243cf/attachment.html>

From Amelie.LESCROEL at cefe.cnrs.fr  Fri Oct  4 15:19:38 2013
From: Amelie.LESCROEL at cefe.cnrs.fr (Amelie LESCROEL)
Date: Fri, 4 Oct 2013 15:19:38 +0200
Subject: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with
 lat-long coordinates - NOT QUITE RESOLVED?
Message-ID: <EC2C4198CBEFB14F9B8661B1614106F30134C18AED27@ZZMAIL.newcefe.newage.fr>

Actually, now that I'm trying (unsuccessfully) to add a SpatialPolygon to my plotted raster, I realize that something went wrong in the reading or projection process of the .tif file, which is why you said " since its a smallish area". Well, it's not: it should go from about 70 to 80?S and from 160?E to 170?W. But when I do plotRGB(tl, axes=TRUE), the axes go only from -75.00000 to -74.98381 and from -170.0000 to -169.9514. Yikes!
I guess there is something wrong with the extent: 

> extent(t)
class       : Extent 
xmin        : 0 
xmax        : 1400 
ymin        : 0 
ymax        : 1800 
> extent(j)
class       : Extent 
xmin        : -948250 
xmax        : -248250 
ymin        : -618000 
ymax        : 282000 
> extent(tl)
class       : Extent 
xmin        : -170 
xmax        : -169.9514 
ymin        : -75 
ymax        : -74.98381

The metadata of the .tif file say:

projection center lon: -170.0000
projection center lat: -75.0000
image center lon: +168
image center lat: -75.5
UL lon: +163.5539
UL lat: -70.5374
UR lon: -177.3704
UR lat: -72.3252
LR lon: +176.6394
LR lat: -80.3056
LL lon: +147.4332
LL lat: -77.3404
UL easting (km): -948.2500
UL northing (km): +282.0000

Any hint about how I could get this right?

Thanks for your consideration,

Am?lie

-----Message d'origine-----
De?: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] De la part de Barry Rowlingson
Envoy??: mardi 1 octobre 2013 17:43
??: Amelie LESCROEL
Cc?: r-sig-geo at r-project.org
Objet?: Re: [R-sig-Geo] Import a GeoTIFF file and plot it on a map with lat-long coordinates

On Tue, Oct 1, 2013 at 2:26 PM, Amelie LESCROEL <Amelie.LESCROEL at cefe.cnrs.fr> wrote:


> Is there a way to read the .prj directly from R? How should I do to be able to map this image with long-lat coordinates? I guess that lots of the required information to do this could be gathered from the metadata of this file (http://lance-modis.eosdis.nasa.gov/imagery/subsets/?project=antarctica&subset=RossSea.2004356.aqua.500m.met) but I'm not sure how to implement this and all my previous attempts failed.
>
> Thanks in advance for your help and do not hesitate to direct me towards an online resource / reading material that I could have overlooked.

 If you get the "Download JPG image with ancillary files (.zip)" and unzip it as well as the tif you'll get a .jpg, a .jgw, and a .prj file. Gdal will use those to give the JPG file a coordinate system:

 > j=stack("./RossSea.2004356.aqua.500m.jpg")
 > projection(j)
[1] "+proj=laea +lat_0=-75 +lon_0=-170 +x_0=0 +y_0=0 +a=6371000
+b=6371000 +units=m +no_defs"

 but as you noticed this doesn't work for GeoTIFFs:

> t=stack("./RossSea.2004356.aqua.500m.tif")
> projection(t)
[1] "NA"

never mind, as long as they have the same projection, we can just:

projection(t)=projection(j)
plotRGB(t)

and we don't need 'j' any more.

There's probably a proper way to do this, but this works.

Note that converting to long-lat is going to need a warp operation. I normally do this in two steps:

1. compute the extent in the new coords:

e=projectExtent(t,CRS("+init=epsg:4326"))

2. do it:

tl=projectRaster(t,e,method="ngb")

[ngb is a bit quicker than the default, read the docs and decide]

plotRGB(tl)

should then have it in lat-long. Its not much of a stretch since its a smallish area.

Barry


From r.hijmans at gmail.com  Fri Oct  4 17:39:08 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 4 Oct 2013 08:39:08 -0700
Subject: [R-sig-Geo] Complementary areas analysis
In-Reply-To: <7FAA73D70AEE6B4BA5BE48F8BD97BC9A07EEC878E3@HQEXDB02.hq.un.fao.org>
References: <7FAA73D70AEE6B4BA5BE48F8BD97BC9A07EEC878E3@HQEXDB02.hq.un.fao.org>
Message-ID: <CANtt_hzVKh4=-BKFO0vbadJfXKk2+hgDMJKkUTn_g+anPpL-vw@mail.gmail.com>

Maurico,

There is hidden function in the dismo package that does this. There is
a bug in it, so here it is the fixed version:

https://r-forge.r-project.org/scm/viewvc.php/pkg/dismo/R/reserves.R?view=markup&revision=518&root=dismo&sortby=date

You can copy and paste it and do

.rebelo(x)

Where x  is a matrix with sites (e.g. grid cells) as columns and
species presences/absence as rows. It will return a matrix with select
sites and number of species. I could easily expand this to work with
points and Raster objects, add more options etc. but perhaps it works
for you as is. I am not sure if I have ever tested it, so pls do so.

> set.seed(0)
> x = matrix(round(runif(1000)), nrow=100,ncol=10)
> .rebelo(x)
     Site nSpecies
[1,]    6       56
[2,]    2       23
[3,]    5       11
[4,]    8        6
[5,]    1        2
[6,]    9        2
>


Robert

On Fri, Oct 4, 2013 at 5:06 AM, Parra, Mauricio (AGPM)
<Mauricio.Parra at fao.org> wrote:
> Dear friends,
>
> I wonder if complementary areas analysis (algorithm by Rebelo 1994) is
> implemented in any R package. This analysis is useful to prioritize areas
> for in situ biodiversity conservation based on species ocurrence within
> areas/cells.  One could expect some packages which manage raster format may
> include it. However after browse on them, I couldn't find it. Anyone knows
> something about it? Any alternative?
>
> Thanks in advance,
>
> Mauricio
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Mauricio.Parra at fao.org  Fri Oct  4 19:36:24 2013
From: Mauricio.Parra at fao.org (Parra, Mauricio (AGPM))
Date: Fri, 4 Oct 2013 19:36:24 +0200
Subject: [R-sig-Geo] Complementary areas analysis
In-Reply-To: <CANtt_hzVKh4=-BKFO0vbadJfXKk2+hgDMJKkUTn_g+anPpL-vw@mail.gmail.com>
References: <7FAA73D70AEE6B4BA5BE48F8BD97BC9A07EEC878E3@HQEXDB02.hq.un.fao.org>,
	<CANtt_hzVKh4=-BKFO0vbadJfXKk2+hgDMJKkUTn_g+anPpL-vw@mail.gmail.com>
Message-ID: <7FAA73D70AEE6B4BA5BE48F8BD97BC9A07EEC878E4@HQEXDB02.hq.un.fao.org>

Thanks a lot Robert, I will test .rebelo function and let you know. I could insert this function after "over" (sp package) or "extract" (raster package) functions (depending on the areas' format) in order to obtain the matrix needed for rebelo. For future dismo/raster versions, a complementary function for (directly) points and raster would be very useful. 

Thanks again,

Mauricio 

________________________________________
From: Robert J. Hijmans [r.hijmans at gmail.com]
Sent: Friday, October 04, 2013 5:39 PM
To: Parra, Mauricio (AGPM)
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Complementary areas analysis

Maurico,

There is hidden function in the dismo package that does this. There is
a bug in it, so here it is the fixed version:

https://r-forge.r-project.org/scm/viewvc.php/pkg/dismo/R/reserves.R?view=markup&revision=518&root=dismo&sortby=date

You can copy and paste it and do

.rebelo(x)

Where x  is a matrix with sites (e.g. grid cells) as columns and
species presences/absence as rows. It will return a matrix with select
sites and number of species. I could easily expand this to work with
points and Raster objects, add more options etc. but perhaps it works
for you as is. I am not sure if I have ever tested it, so pls do so.

> set.seed(0)
> x = matrix(round(runif(1000)), nrow=100,ncol=10)
> .rebelo(x)
     Site nSpecies
[1,]    6       56
[2,]    2       23
[3,]    5       11
[4,]    8        6
[5,]    1        2
[6,]    9        2
>


Robert

On Fri, Oct 4, 2013 at 5:06 AM, Parra, Mauricio (AGPM)
<Mauricio.Parra at fao.org> wrote:
> Dear friends,
>
> I wonder if complementary areas analysis (algorithm by Rebelo 1994) is
> implemented in any R package. This analysis is useful to prioritize areas
> for in situ biodiversity conservation based on species ocurrence within
> areas/cells.  One could expect some packages which manage raster format may
> include it. However after browse on them, I couldn't find it. Anyone knows
> something about it? Any alternative?
>
> Thanks in advance,
>
> Mauricio
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

From Roger.Bivand at nhh.no  Sun Oct  6 21:53:17 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 6 Oct 2013 21:53:17 +0200
Subject: [R-sig-Geo] invalid geometries from negative buffering in
 rgeos/sp
In-Reply-To: <CANVKczOTQx6z-zynptngqSjZNEE3piciUFnF0fvZeU0B1iH0ew@mail.gmail.com>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<0ab7c5a899cb4a85ab3d2d452f92c036@EX-1-HT0.lancs.local>
	<CANVKczOTQx6z-zynptngqSjZNEE3piciUFnF0fvZeU0B1iH0ew@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310062146510.4046@reclus.nhh.no>

On Thu, 3 Oct 2013, Barry Rowlingson wrote:

> On Thu, Oct 3, 2013 at 2:29 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> Yes, but ...
>>
>> The user gets a SpatialPolygonsDataFrame object with the data slot intact,
>> but some of the polygons are clearly now invalid. Should we do
>> book-keeping to only retain the data slot rows for valid polygons, only
>> return the subset of valid polygons, or proceed as now, and have the user
>> do:
>>
>> plot(b[gArea(b, byid=TRUE) > 0,])
>>
>> What makes more sense? I'm open to suggestions ...
>

rgeos 0.3-2 is now on CRAN, and the CRAN Windows and OSX binary packages 
should be built soon. The changes made in rgeos should now prevent invalid 
geometries without valid representation in sp classes, such as empty 
polygons with no coordinates, being built. In gBuffer(), any output GEOM 
empty objects are removed before their conversion back to sp form, 
retaining the ids of the non-empty objects.

Please report back if these changes cause untoward effects in production 
code.

Roger

> I'm first wondering what the source of the invalidity is here. What
> does the underlying GEOS code return from one of these operations?
> Does it have a valid NULL polygon feature concept? If so, then I'd
> like to see that carried through into sp-class objects.
>
> Its not a sufficient condition that the area = 0 - a polygon of three
> coincident points has area=0, but a big negative buffer should be a
> geometry without even points in it...
>
> Barry
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From tephilippi at gmail.com  Mon Oct  7 05:28:06 2013
From: tephilippi at gmail.com (Tom Philippi)
Date: Sun, 6 Oct 2013 20:28:06 -0700
Subject: [R-sig-Geo] invalid geometries from negative buffering in
	rgeos/sp
In-Reply-To: <alpine.LRH.2.03.1310062146510.4046@reclus.nhh.no>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<0ab7c5a899cb4a85ab3d2d452f92c036@EX-1-HT0.lancs.local>
	<CANVKczOTQx6z-zynptngqSjZNEE3piciUFnF0fvZeU0B1iH0ew@mail.gmail.com>
	<alpine.LRH.2.03.1310062146510.4046@reclus.nhh.no>
Message-ID: <CALyPt8yW50Da-YoR_DOtHk=T2JA38XDX6TNnGEPJ3xa4mYDNCQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131006/d6cc547d/attachment.pl>

From eddieatr at gmail.com  Mon Oct  7 11:29:32 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 7 Oct 2013 10:29:32 +0100
Subject: [R-sig-Geo] Error message in calc()
Message-ID: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131007/3582a17e/attachment.pl>

From grothered at gmail.com  Mon Oct  7 12:47:55 2013
From: grothered at gmail.com (GD)
Date: Mon, 7 Oct 2013 03:47:55 -0700 (PDT)
Subject: [R-sig-Geo] Error message in calc()
In-Reply-To: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>
References: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>
Message-ID: <1381142875257-7584796.post@n2.nabble.com>

For RasterLayer objects, I think you need to use 'maxValue' and 'minValue'
instead of max and min



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-message-in-calc-tp7584795p7584796.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From j.garcia-pintado at reading.ac.uk  Mon Oct  7 12:56:37 2013
From: j.garcia-pintado at reading.ac.uk (Javier Garcia-Pintado)
Date: Mon, 7 Oct 2013 10:56:37 +0000
Subject: [R-sig-Geo] R package gstat segmentation fault
Message-ID: <E82BBC061BBD7448BC7905721F497B07700CE59C@vime-mbx6.rdg.ac.uk>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131007/91bac51e/attachment.html>

From grothered at gmail.com  Mon Oct  7 13:06:44 2013
From: grothered at gmail.com (GD)
Date: Mon, 7 Oct 2013 04:06:44 -0700 (PDT)
Subject: [R-sig-Geo] Error message in calc()
In-Reply-To: <1381142875257-7584796.post@n2.nabble.com>
References: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>
	<1381142875257-7584796.post@n2.nabble.com>
Message-ID: <1381144004562-7584798.post@n2.nabble.com>

Apologies the last suggestion was totally wrong, since 'calc' applies the
function to each cell (represented as a vector).

However, the problem might be that the 'which' function inside your 'fun1'
is sometimes returning more than one value. In that case, you might try
forcing 'w' to have the same length every time. See the following code:
 
> library(raster)
Loading required package: sp
> 
> # Original function
> fun1 <- function(x){
+           m <- max(x)
+           w <- which(x==m)
+           return(c(m,w))
+           } 
> 
> # Function that only outputs the first element of 'w', and also gives the
> length of w
> fun2 <- function(x){
+           m <- max(x)
+           w <- which(x==m)
+           return(c(m,w[1],length(w)))
+           } 
> 
> # A stack
> slogo <- stack(system.file("external/rlogo.grd", package="raster")) 
> 
> s2 <- calc(slogo, fun = fun1) # This fails
Error in .local(x, values, ...) : 
  values must be numeric, integer or logical.
> 
> 
> s3 <- calc(slogo, fun = fun2) # This works -- and note that length(w) is
> not constant
> s3
class       : RasterBrick 
dimensions  : 77, 101, 7777, 3  (nrow, ncol, ncell, nlayers)
resolution  : 1, 1  (x, y)
extent      : 0, 101, 0, 77  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=merc 
data source : in memory
names       : layer.1, layer.2, layer.3 
min values  :       0,       1,       1 
max values  :     255,       3,       3 





--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Error-message-in-calc-tp7584795p7584798.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Mon Oct  7 13:44:23 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 7 Oct 2013 04:44:23 -0700
Subject: [R-sig-Geo] Error message in calc()
In-Reply-To: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>
References: <CABaJH7_ScAQSFTiW8BYZysnU9Z7CPk3JsMN4dEzrOL6xG4kGYg@mail.gmail.com>
Message-ID: <CANtt_hwbSdDCj2_oh+10oZSc_ASDMMUtKADm=+1LqCY8nYH4bw@mail.gmail.com>

The problem, I think, is that there are NA values on your raster. You
have not considered the effect of NA values on what is returned by
fun1. You can fix fun1, but in this case I would do:

library(raster)
s <- stack(system.file("external/rlogo.grd", package="raster"))
s[1:10] <- NA

m <- max(s)
w <- which.max(s)

Robert

On Mon, Oct 7, 2013 at 2:29 AM, Eddie Smith <eddieatr at gmail.com> wrote:
> Dear list,
>
> I have a RasterLayer as follows
>
> class       : RasterLayer
> band        : 1  (of  365  bands)
> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0
> data source : ...\2012.tif
> names       : X2012
> values      : 16.75, 34.35  (min, max)
>
>
> I tried to extract the annual maximum image using :
> fun1 <- function(x){
>          m <- max(x)
>          w <- which(max(x) == x)
>          return(c(m, w))
>          }
> s2 <- calc(stack, fun = fun1)
>
> but end up with this error message :
> Error in setValues(out, x) :
>   values must be numeric, integer, logical or factor
>
> I am not sure where I went wrong as the min and max values are 1.75 and
> 34.35.
>
> Anybody?
>
> Thanks in advance.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Mon Oct  7 14:11:00 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 7 Oct 2013 05:11:00 -0700
Subject: [R-sig-Geo] invalid geometries from negative buffering in
	rgeos/sp
In-Reply-To: <alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>
Message-ID: <CANtt_hy5P+JqGchpNknbadPP=2EUWoVYd3jXLoc-m8Q3DioV4Q@mail.gmail.com>

A more general fix might be to support NULL geometries in Spatial objects.
Robert

On Thu, Oct 3, 2013 at 6:29 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 3 Oct 2013, Barry Rowlingson wrote:
>
>> Using scot_BNG from the rgdal package:
>>
>> dsn <- system.file("vectors", package = "rgdal")[1]
>> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
>>
>> and buffering with a sufficiently large negative width:
>>
>> b=gBuffer(scot_BNG,width=-10000,byid=TRUE)
>>
>> produces an object that gives an error on plot:
>
>
> Yes, but ...
>
> The user gets a SpatialPolygonsDataFrame object with the data slot intact,
> but some of the polygons are clearly now invalid. Should we do book-keeping
> to only retain the data slot rows for valid polygons, only return the subset
> of valid polygons, or proceed as now, and have the user do:
>
> plot(b[gArea(b, byid=TRUE) > 0,])
>
> What makes more sense? I'm open to suggestions ...
>
> Roger
>
>
>>
>> > plot(b)
>> Error in checkSlotAssignment(object, name, value) :
>>  assignment of an object of class ?NULL? is not valid for slot
>> "coords" in an object of class ?Line?; is(value, "matrix") is not TRUE
>>
>> Which I think is because the negative buffer has shrunk a feature to
>> nothing.
>>
>> b[1,] is fine but:
>>
>>> b[2,]
>>
>> Error in SpatialPolygons(x at polygons[i], proj4string = CRS(proj4string(x)))
>> :
>>  INTEGER() can only be applied to a 'integer', not a 'NULL'
>>
>> I'm not sure what the right thing to do here is. Either return a valid
>> zero-area polygon (if that's not a contradiction in terms) or drop the
>> degenerate cases?
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From Roger.Bivand at nhh.no  Mon Oct  7 14:51:44 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 7 Oct 2013 14:51:44 +0200
Subject: [R-sig-Geo] invalid geometries from negative buffering in
 rgeos/sp
In-Reply-To: <CANtt_hy5P+JqGchpNknbadPP=2EUWoVYd3jXLoc-m8Q3DioV4Q@mail.gmail.com>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>
	<CANtt_hy5P+JqGchpNknbadPP=2EUWoVYd3jXLoc-m8Q3DioV4Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310071445150.6576@reclus.nhh.no>

On Mon, 7 Oct 2013, Robert J. Hijmans wrote:

> A more general fix might be to support NULL geometries in Spatial objects.

Maybe, but we do not have in sp a class for mixed types of geometries 
either, so we would have to define NULL of everything. OGC SFS has NULL, 
but I would argue that NULL geometries have no analytical meaning, like a 
point with no coordinate values - so we don't know where it is. It doesn't 
fit the Spatial class, unless we open for a bounding box with NA corners. 
In rgeos, the typical output if there is no positional data is the R NULL 
value. One might go towards objects with mixed geometries (GDAL is 
permitting them for the drivers that have them in the development 
version), but I don't see an analytical need. How often does, for example, 
newdata for predicting from a geostatistical model include both points and 
lines?

Roger

> Robert
>
> On Thu, Oct 3, 2013 at 6:29 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Thu, 3 Oct 2013, Barry Rowlingson wrote:
>>
>>> Using scot_BNG from the rgdal package:
>>>
>>> dsn <- system.file("vectors", package = "rgdal")[1]
>>> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
>>>
>>> and buffering with a sufficiently large negative width:
>>>
>>> b=gBuffer(scot_BNG,width=-10000,byid=TRUE)
>>>
>>> produces an object that gives an error on plot:
>>
>>
>> Yes, but ...
>>
>> The user gets a SpatialPolygonsDataFrame object with the data slot intact,
>> but some of the polygons are clearly now invalid. Should we do book-keeping
>> to only retain the data slot rows for valid polygons, only return the subset
>> of valid polygons, or proceed as now, and have the user do:
>>
>> plot(b[gArea(b, byid=TRUE) > 0,])
>>
>> What makes more sense? I'm open to suggestions ...
>>
>> Roger
>>
>>
>>>
>>>> plot(b)
>>> Error in checkSlotAssignment(object, name, value) :
>>>  assignment of an object of class ?NULL? is not valid for slot
>>> "coords" in an object of class ?Line?; is(value, "matrix") is not TRUE
>>>
>>> Which I think is because the negative buffer has shrunk a feature to
>>> nothing.
>>>
>>> b[1,] is fine but:
>>>
>>>> b[2,]
>>>
>>> Error in SpatialPolygons(x at polygons[i], proj4string = CRS(proj4string(x)))
>>> :
>>>  INTEGER() can only be applied to a 'integer', not a 'NULL'
>>>
>>> I'm not sure what the right thing to do here is. Either return a valid
>>> zero-area polygon (if that's not a contradiction in terms) or drop the
>>> degenerate cases?
>>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From edzer.pebesma at uni-muenster.de  Mon Oct  7 15:19:51 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 07 Oct 2013 15:19:51 +0200
Subject: [R-sig-Geo] R package gstat segmentation fault
In-Reply-To: <E82BBC061BBD7448BC7905721F497B07700CE59C@vime-mbx6.rdg.ac.uk>
References: <E82BBC061BBD7448BC7905721F497B07700CE59C@vime-mbx6.rdg.ac.uk>
Message-ID: <5252B4F7.9070908@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Interesting - it might have to do sth with the platform, AIX, on which
you are running. Could you send me (off-list) the full output you see
when you install package gstat from source?

Do other packages with compiled C code (such as rgeos) install, and
load, and work without problems?

On 10/07/2013 12:56 PM, Javier Garcia-Pintado wrote:
> Dear all,
> 
> I am having a segmentation fault when loading the package gstat:
> 
> I am using:
> 
> R version 3.0.1 (2013-05-16) -- "Good Sport" R_PLATFORM:
> "powerpc-ibm-aix7.1.0.0"
> 
> gstat package version is 1.0-17, and I can't see any error in its
> dependences: "methods, lattice, sp (>= 0.9-72), zoo, spacetime (>=
> 1.0-0)"
> 
> The error report is:
> 
> *** caught segfault *** address 9000000009276c8, cause 'invalid
> permissions'
> 
> Traceback: 1: .Call(gstat_init, as.integer(1)) 2: fun(libname,
> pkgname) 3: doTryCatch(return(expr), name, parentenv, handler) 4:
> tryCatchOne(expr, names, parentenv, handlers[[1L]]) 5:
> tryCatchList(expr, classes, parentenv, handlers) 6:
> tryCatch(fun(libname, pkgname), error = identity) 7:
> runHook(".onLoad", env, package.lib, package) 8:
> loadNamespace(package, c(which.lib.loc, lib.loc)) 9:
> doTryCatch(return(expr), name, parentenv, handler) 10:
> tryCatchOne(expr, names, parentenv, handlers[[1L]]) 11:
> tryCatchList(expr, classes, parentenv, handlers) 12: tryCatch(expr,
> error = function(e) {    call <- conditionCall(e)    if 
> (!is.null(call)) {        if (identical(call[[1L]], 
> quote(doTryCatch)))             call <- sys.call(-4L)        dcall
> <- deparse(call)[1L]        prefix <- paste("Error in", dcall, ":
> ")        LONG <- 75L        msg <- conditionMessage(e)        sm
> <- strsplit(msg, "\n")[[1L]]        w <- 14L + nchar(dcall, type =
> "w") + nchar(sm[1L], type = "w")        if (is.na(w))             w
> <- 14L + nchar(dcall, type = "b") + nchar(sm[1L], type = "b")
> if (w > LONG)             prefix <- paste0(prefix, "\n  ")    }
> else prefix <- "Error : "    msg <- paste0(prefix,
> conditionMessage(e), "\n") .Internal(seterrmessage(msg[1L]))    if
> (!silent && identical(getOption("show.error.messages"), TRUE)) {
> cat(msg, file = stderr())        .Internal(printDeferredWarnings())
> } invisible(structure(msg, class = "try-error", condition = e))}) 
> 13: try({    ns <- loadNamespace(package, c(which.lib.loc,
> lib.loc))    env <- attachNamespace(ns, pos = pos, deps)}) 14:
> library(gstat)
> 
> Possible actions: 1: abort (with core dump, if enabled) 2: normal R
> exit 3: exit R without saving workspace 4: exit R saving workspace
> 
> Please, could you advise about what we could do to overcome this?
> 
> Many thanks, Javier
> 
> --- Dr. Javier Garc?a-Pintado National Centre for Earth Observation
> (ESSC-NCEO) School of Mathematical and Physical Sciences University
> of Reading Tel: +44(0)1183787722 j.garcia-pintado at reading.ac.uk 
> http://www.nceo.ac.uk/
> 
> 
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSUrT3AAoJEM1OCHCtOnfxVfgH/2i6RTZbmkWX8jTrvJnI0NVJ
sMbZztjJL6e4+syjOHypSUJ1GsLBdY4K5T3v7SuNHjoLD/SnY713YRwAomvWsEn0
GA8UV5CAPZW0akhUnzFysw38lBNssICe2Su3Sp6a7GPUFiZ0DAVHruKuqToJb5ZV
ID/Yl6ww9v3FpANdlHz6Nf0ILxkURCKAuFJGxEqd502oYGf1HsCO/LNLcCQpRHL/
v6nwlLtYMxG21tzETSqpZ6c9krz6tOgzb0pJpOAWtKgipOy0/NJfjw5CZMTnpcf5
KaDKNAjoI/6fNWcYLOPq8Gjc0DuTPl+wNLjtgM6MIiZ+0oR/vZPaq+aNvzXBfmc=
=HbY7
-----END PGP SIGNATURE-----


From alobolistas at gmail.com  Mon Oct  7 17:41:14 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 7 Oct 2013 17:41:14 +0200
Subject: [R-sig-Geo] problem reading hdf image
Message-ID: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>

Hi!

I get the following error when try to read an hdf image (release 4):

> modisima <- stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
Path to GDAL shared files: /usr/share/gdal/1.10
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: (autodetected)
Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
returnCategoryNames = RAT) :
  object 'RATlist' not found
Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
  Cannot create a RasterLayer object from this file.
In addition: Warning message:
In dim(x) : no bands in dataset

Also:

> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
Error in GDALinfo(file.path(modisdir,
"MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
  object 'scaleOffset' not found
In addition: Warning messages:
1: In dim(x) : no bands in dataset
2: In GDALinfo(file.path(modisdir,
"MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
  GeoTransform values not available

Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
terminal, I do get
output from gdalinfo (quite long, let me know if I should send it).
Also, I can display the
image in Qgis with no problem.

Any idea on where the problem could be?
Thanks,
Agus

> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=es_ES.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13

loaded via a namespace (and not attached):
[1] grid_3.0.2      lattice_0.20-23 tools_3.0.2


From r.hijmans at gmail.com  Mon Oct  7 19:11:31 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 7 Oct 2013 10:11:31 -0700
Subject: [R-sig-Geo] invalid geometries from negative buffering in
	rgeos/sp
In-Reply-To: <alpine.LRH.2.03.1310071445150.6576@reclus.nhh.no>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>
	<alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>
	<CANtt_hy5P+JqGchpNknbadPP=2EUWoVYd3jXLoc-m8Q3DioV4Q@mail.gmail.com>
	<alpine.LRH.2.03.1310071445150.6576@reclus.nhh.no>
Message-ID: <CANtt_hwDmTs19WqepVr+BvQVusPzv4MbijKbD2cX4y2iASSw9A@mail.gmail.com>

On Mon, Oct 7, 2013 at 5:51 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Mon, 7 Oct 2013, Robert J. Hijmans wrote:
>
>> A more general fix might be to support NULL geometries in Spatial objects.
>
>
> Maybe, but we do not have in sp a class for mixed types of geometries
> either,

True, but that is a different issue.

> so we would have to define NULL of everything. OGC SFS has NULL, but
> I would argue that NULL geometries have no analytical meaning, like a point
> with no coordinate values - so we don't know where it is. It doesn't fit the
> Spatial class, unless we open for a bounding box with NA corners.

There have been cases where I thought it would have been handy, for
example when geometries (e.g. point locations) are known for some, but
not for all records in a data set.
However, addition this type of support would add a significant amount
of overhead to all functions (check for / remove NULL values; NA
bounding box vaues).

> In rgeos,
> the typical output if there is no positional data is the R NULL value. One
> might go towards objects with mixed geometries (GDAL is permitting them for
> the drivers that have them in the development version), but I don't see an
> analytical need.

Me neither

> How often does, for example, newdata for predicting from a
> geostatistical model include both points and lines?
>
> Roger
>
>
>> Robert
>>
>> On Thu, Oct 3, 2013 at 6:29 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>
>>> On Thu, 3 Oct 2013, Barry Rowlingson wrote:
>>>
>>>> Using scot_BNG from the rgdal package:
>>>>
>>>> dsn <- system.file("vectors", package = "rgdal")[1]
>>>> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
>>>>
>>>> and buffering with a sufficiently large negative width:
>>>>
>>>> b=gBuffer(scot_BNG,width=-10000,byid=TRUE)
>>>>
>>>> produces an object that gives an error on plot:
>>>
>>>
>>>
>>> Yes, but ...
>>>
>>> The user gets a SpatialPolygonsDataFrame object with the data slot
>>> intact,
>>> but some of the polygons are clearly now invalid. Should we do
>>> book-keeping
>>> to only retain the data slot rows for valid polygons, only return the
>>> subset
>>> of valid polygons, or proceed as now, and have the user do:
>>>
>>> plot(b[gArea(b, byid=TRUE) > 0,])
>>>
>>> What makes more sense? I'm open to suggestions ...
>>>
>>> Roger
>>>
>>>
>>>>
>>>>> plot(b)
>>>>
>>>> Error in checkSlotAssignment(object, name, value) :
>>>>  assignment of an object of class ?NULL? is not valid for slot
>>>> "coords" in an object of class ?Line?; is(value, "matrix") is not TRUE
>>>>
>>>> Which I think is because the negative buffer has shrunk a feature to
>>>> nothing.
>>>>
>>>> b[1,] is fine but:
>>>>
>>>>> b[2,]
>>>>
>>>>
>>>> Error in SpatialPolygons(x at polygons[i], proj4string =
>>>> CRS(proj4string(x)))
>>>> :
>>>>  INTEGER() can only be applied to a 'integer', not a 'NULL'
>>>>
>>>> I'm not sure what the right thing to do here is. Either return a valid
>>>> zero-area polygon (if that's not a contradiction in terms) or drop the
>>>> degenerate cases?
>>>>
>>>> Barry
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, NHH Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>> e-mail: Roger.Bivand at nhh.no
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no


From edzer.pebesma at uni-muenster.de  Mon Oct  7 20:12:28 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 07 Oct 2013 20:12:28 +0200
Subject: [R-sig-Geo] invalid geometries from negative buffering in
	rgeos/sp
In-Reply-To: <CANtt_hwDmTs19WqepVr+BvQVusPzv4MbijKbD2cX4y2iASSw9A@mail.gmail.com>
References: <CANVKczMLhsvgb+wtvmGm56SFKe5Jzu4-0ieCA884O1=PwZb5DQ@mail.gmail.com>	<alpine.LRH.2.03.1310031520490.20617@reclus.nhh.no>	<CANtt_hy5P+JqGchpNknbadPP=2EUWoVYd3jXLoc-m8Q3DioV4Q@mail.gmail.com>	<alpine.LRH.2.03.1310071445150.6576@reclus.nhh.no>
	<CANtt_hwDmTs19WqepVr+BvQVusPzv4MbijKbD2cX4y2iASSw9A@mail.gmail.com>
Message-ID: <5252F98C.2050405@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 10/07/2013 07:11 PM, Robert J. Hijmans wrote:
> On Mon, Oct 7, 2013 at 5:51 AM, Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
>> On Mon, 7 Oct 2013, Robert J. Hijmans wrote:
>> 
>>> A more general fix might be to support NULL geometries in
>>> Spatial objects.
>> 
>> 
>> Maybe, but we do not have in sp a class for mixed types of
>> geometries either,
> 
> True, but that is a different issue.
> 
>> so we would have to define NULL of everything. OGC SFS has NULL,
>> but I would argue that NULL geometries have no analytical
>> meaning, like a point with no coordinate values - so we don't
>> know where it is. It doesn't fit the Spatial class, unless we
>> open for a bounding box with NA corners.
> 
> There have been cases where I thought it would have been handy,
> for example when geometries (e.g. point locations) are known for
> some, but not for all records in a data set. However, addition this
> type of support would add a significant amount of overhead to all
> functions (check for / remove NULL values; NA bounding box vaues).

Since the launch of what would later become sp [1], nearly 10 years
ago, I haven't regretted the decision to not allow missing values in
geometries a single second.

[1] https://stat.ethz.ch/pipermail/r-sig-geo/2003-October/000028.html

> 
>> In rgeos, the typical output if there is no positional data is
>> the R NULL value. One might go towards objects with mixed
>> geometries (GDAL is permitting them for the drivers that have
>> them in the development version), but I don't see an analytical
>> need.
> 
> Me neither
> 
>> How often does, for example, newdata for predicting from a 
>> geostatistical model include both points and lines?
>> 
>> Roger
>> 
>> 
>>> Robert
>>> 
>>> On Thu, Oct 3, 2013 at 6:29 AM, Roger Bivand
>>> <Roger.Bivand at nhh.no> wrote:
>>>> 
>>>> On Thu, 3 Oct 2013, Barry Rowlingson wrote:
>>>> 
>>>>> Using scot_BNG from the rgdal package:
>>>>> 
>>>>> dsn <- system.file("vectors", package = "rgdal")[1] 
>>>>> scot_BNG <- readOGR(dsn=dsn, layer="scot_BNG")
>>>>> 
>>>>> and buffering with a sufficiently large negative width:
>>>>> 
>>>>> b=gBuffer(scot_BNG,width=-10000,byid=TRUE)
>>>>> 
>>>>> produces an object that gives an error on plot:
>>>> 
>>>> 
>>>> 
>>>> Yes, but ...
>>>> 
>>>> The user gets a SpatialPolygonsDataFrame object with the data
>>>> slot intact, but some of the polygons are clearly now
>>>> invalid. Should we do book-keeping to only retain the data
>>>> slot rows for valid polygons, only return the subset of valid
>>>> polygons, or proceed as now, and have the user do:
>>>> 
>>>> plot(b[gArea(b, byid=TRUE) > 0,])
>>>> 
>>>> What makes more sense? I'm open to suggestions ...
>>>> 
>>>> Roger
>>>> 
>>>> 
>>>>> 
>>>>>> plot(b)
>>>>> 
>>>>> Error in checkSlotAssignment(object, name, value) : 
>>>>> assignment of an object of class ?NULL? is not valid for
>>>>> slot "coords" in an object of class ?Line?; is(value,
>>>>> "matrix") is not TRUE
>>>>> 
>>>>> Which I think is because the negative buffer has shrunk a
>>>>> feature to nothing.
>>>>> 
>>>>> b[1,] is fine but:
>>>>> 
>>>>>> b[2,]
>>>>> 
>>>>> 
>>>>> Error in SpatialPolygons(x at polygons[i], proj4string = 
>>>>> CRS(proj4string(x))) : INTEGER() can only be applied to a
>>>>> 'integer', not a 'NULL'
>>>>> 
>>>>> I'm not sure what the right thing to do here is. Either
>>>>> return a valid zero-area polygon (if that's not a
>>>>> contradiction in terms) or drop the degenerate cases?
>>>>> 
>>>>> Barry
>>>>> 
>>>>> _______________________________________________ R-sig-Geo
>>>>> mailing list R-sig-Geo at r-project.org 
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> 
>>>> 
>>>> -- Roger Bivand Department of Economics, NHH Norwegian School
>>>> of Economics, Helleveien 30, N-5045 Bergen, Norway. voice:
>>>> +47 55 95 93 55; fax +47 55 95 95 43 e-mail:
>>>> Roger.Bivand at nhh.no
>>>> 
>>>> _______________________________________________ R-sig-Geo
>>>> mailing list R-sig-Geo at r-project.org 
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>> 
>> -- Roger Bivand Department of Economics, NHH Norwegian School of
>> Economics, Helleveien 30, N-5045 Bergen, Norway. voice: +47 55 95
>> 93 55; fax +47 55 95 95 43 e-mail: Roger.Bivand at nhh.no
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSUvmMAAoJEM1OCHCtOnfxkpcH/R4stGxSSR/5kqHFyrgotsff
2HX5c3rAwi3gfFG/a/NbU9B+5+6XEDPaNV4qd9MgvOd6mMX7IwPKjpiJEUj3CBft
X8Z1fDb1RD5U3BKyr0ggroTOq2PNdpfgdvVWRKd0Q9+wprZ1/u09aQMOQIqrdVt4
p+0Gy+f510T28gQ99ceRgjLiI1a1dZGnxZb2gV0n0DRU6szAyjhK+y3tyZTfFoKz
UUPoH/BumUH3+7wbHseexHMgwQm6P31GX6mrLxDmXzzIk7Zszp19YM8DfXc4KR6W
3TmuXrehit+7c/HI9iKEhUKGCmMfqhQ7hhygQU8kGRoRrtUY54LDt6c59S2oLoo=
=ZXtJ
-----END PGP SIGNATURE-----


From alobolistas at gmail.com  Mon Oct  7 20:18:45 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 7 Oct 2013 20:18:45 +0200
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
Message-ID: <CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>

What about this:
r1 <- raster(matrix(rnorm(100,5,10),10,10))
r2 <- raster(matrix(rnorm(100,2,30),10,10))
s <- stack(r1,r2)
mx <- stackApply(s,max)

which.max() fails because raster requires the na.rm argument (I think, Robert?)

mxd <- stackApply(s,indices=c(1,1),which.max)
Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)

so make your own function icluding the na.rm argument:

miwhichmax <- function(x,na.rm=TRUE) which.max(x)
mxd <- stackApply(s,indices=c(1,1),miwhichmax)

Agus


On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com> wrote:
> Dear list,
>
> I have a RasterLayer that contains 365 bands with a dimension of 1032,
> 1656, 1708992  (nrow, ncol, ncell).
>
> library(raster)
> img <- list.files(pattern='\\.img$')
> stack <- stack(img)
> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
> overwrite=TRUE)
>
> 1. How could I produce a raster layer that contains a maximum value from
> 365 bands for each pixel?
> I tried maxValue() but that only give me a maximum value for each band.
>
> 2. If I manage to do step 1, is it possible to know from which band is
> actually the maximum value originate?
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Mon Oct  7 20:20:31 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 7 Oct 2013 20:20:31 +0200
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
Message-ID: <CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>

oops, copied the wrong line,
it must be
mx <- stackApply(s,indices=c(1,1),max)

Agus


On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> What about this:
> r1 <- raster(matrix(rnorm(100,5,10),10,10))
> r2 <- raster(matrix(rnorm(100,2,30),10,10))
> s <- stack(r1,r2)
> mx <- stackApply(s,max)
>
> which.max() fails because raster requires the na.rm argument (I think, Robert?)
>
> mxd <- stackApply(s,indices=c(1,1),which.max)
> Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>
> so make your own function icluding the na.rm argument:
>
> miwhichmax <- function(x,na.rm=TRUE) which.max(x)
> mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>
> Agus
>
>
> On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com> wrote:
>> Dear list,
>>
>> I have a RasterLayer that contains 365 bands with a dimension of 1032,
>> 1656, 1708992  (nrow, ncol, ncell).
>>
>> library(raster)
>> img <- list.files(pattern='\\.img$')
>> stack <- stack(img)
>> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>> overwrite=TRUE)
>>
>> 1. How could I produce a raster layer that contains a maximum value from
>> 365 bands for each pixel?
>> I tried maxValue() but that only give me a maximum value for each band.
>>
>> 2. If I manage to do step 1, is it possible to know from which band is
>> actually the maximum value originate?
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From pierluigi.derosa at gmail.com  Tue Oct  8 12:28:53 2013
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 8 Oct 2013 12:28:53 +0200
Subject: [R-sig-Geo] ggmap error
Message-ID: <CAAgsrZimfAz3imC4004+Odpj2MeEWbbsC819kdqoqW36h63gEw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/a518b262/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Oct  8 12:40:29 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 8 Oct 2013 11:40:29 +0100
Subject: [R-sig-Geo] ggmap error
In-Reply-To: <a89eaca8156c44ca852b40b3d783e565@EX-1-HT0.lancs.local>
References: <a89eaca8156c44ca852b40b3d783e565@EX-1-HT0.lancs.local>
Message-ID: <CANVKczODrZbRSBPMi4KLHTSe40-QoVJuRjeWXAXW4m4X-uaDYQ@mail.gmail.com>

What version of R do you have? The paste0 function has been in R for a
while now...

On Tue, Oct 8, 2013 at 11:28 AM, pierluigi de rosa
<pierluigi.derosa at gmail.com> wrote:
> Dear R-Geo user
> I have a trouble when using any function from ggmap package...
> It tells me
> Error in message(paste0("Map from URL : ", url)) :
>   not finding function  "paste0"
>
> Some one experienced the same issue?
> thanks
> P
>
> --
> Ing. Pierluigi De Rosa (PhD)
> tel: 075 791 0278 / fax: 075 7823038
> cel: 3497558268
> skype: pierluigi.derosa
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matteo.mattiuzzi at boku.ac.at  Tue Oct  8 13:34:09 2013
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Tue, 08 Oct 2013 13:34:09 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
Message-ID: <525409D1020000270001CD49@gwia2.boku.ac.at>

Dear Agus,

yes please send the output of gdalinfo (close to the end is the string you have to use). 


Matteo





>>> Agustin Lobo <alobolistas at gmail.com> 10/07/13 5:42 PM >>>
Hi!

I get the following error when try to read an hdf image (release 4):

> modisima <- stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
rgdal: version: 0.8-11, (SVN revision 479M)
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
Path to GDAL shared files: /usr/share/gdal/1.10
Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
Path to PROJ.4 shared files: (autodetected)
Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
returnCategoryNames = RAT) :
  object 'RATlist' not found
Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
  Cannot create a RasterLayer object from this file.
In addition: Warning message:
In dim(x) : no bands in dataset

Also:

> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
Error in GDALinfo(file.path(modisdir,
"MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
  object 'scaleOffset' not found
In addition: Warning messages:
1: In dim(x) : no bands in dataset
2: In GDALinfo(file.path(modisdir,
"MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
  GeoTransform values not available

Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
terminal, I do get
output from gdalinfo (quite long, let me know if I should send it).
Also, I can display the
image in Qgis with no problem.

Any idea on where the problem could be?
Thanks,
Agus

> sessionInfo()
R version 3.0.2 (2013-09-25)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
LC_PAPER=es_ES.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13

loaded via a namespace (and not attached):
[1] grid_3.0.2      lattice_0.20-23 tools_3.0.2

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Tue Oct  8 13:45:41 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 8 Oct 2013 13:45:41 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <525409D1020000270001CD49@gwia2.boku.ac.at>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
	<525409D1020000270001CD49@gwia2.boku.ac.at>
Message-ID: <CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>

Here it goes, thaks a lot for your help:

$ gdalinfo MOD09A1.A2011289.h11v11.005.2011298101214.hdf
Driver: HDF4/Hierarchical Data Format Release 4
Files: MOD09A1.A2011289.h11v11.005.2011298101214.hdf
Size is 512, 512
Coordinate System is `'
Metadata:
  ASSOCIATEDINSTRUMENTSHORTNAME=MODIS
  ASSOCIATEDPLATFORMSHORTNAME=Terra
  ASSOCIATEDSENSORSHORTNAME=MODIS
  AUTOMATICQUALITYFLAG=Passed
  AUTOMATICQUALITYFLAGEXPLANATION=Always Passed
  CHARACTERISTICBINANGULARSIZE250M=7.5
  CHARACTERISTICBINANGULARSIZE500M=15.0
  CHARACTERISTICBINSIZE250M=231.656358263889
  CHARACTERISTICBINSIZE500M=463.312716527778
  DATACOLUMNS250M=4800
  DATACOLUMNS500M=2400
  DATAROWS250M=4800
  DATAROWS500M=2400
  DAYNIGHTFLAG=Day
  DESCRREVISION=5.1
  EASTBOUNDINGCOORDINATE=-63.8417981939892
  EQUATORCROSSINGDATE=2011-10-16
  EQUATORCROSSINGDATE=2011-10-16
  EQUATORCROSSINGDATE=2011-10-17
  EQUATORCROSSINGDATE=2011-10-17
  EQUATORCROSSINGDATE=2011-10-18
  EQUATORCROSSINGDATE=2011-10-19
  EQUATORCROSSINGDATE=2011-10-19
  EQUATORCROSSINGDATE=2011-10-20
  EQUATORCROSSINGDATE=2011-10-21
  EQUATORCROSSINGDATE=2011-10-21
  EQUATORCROSSINGDATE=2011-10-22
  EQUATORCROSSINGDATE=2011-10-23
  EQUATORCROSSINGDATE=2011-10-23
  EQUATORCROSSINGLONGITUDE=-50.6540495500062
  EQUATORCROSSINGLONGITUDE=-52.2073110490786
  EQUATORCROSSINGLONGITUDE=-55.295882063234
  EQUATORCROSSINGLONGITUDE=-58.3832333779475
  EQUATORCROSSINGLONGITUDE=-61.4709999916156
  EQUATORCROSSINGLONGITUDE=-66.1122213699271
  EQUATORCROSSINGLONGITUDE=-69.2001737045505
  EQUATORCROSSINGLONGITUDE=-72.2878369750113
  EQUATORCROSSINGLONGITUDE=-75.3752441195227
  EQUATORCROSSINGLONGITUDE=-76.9284675895243
  EQUATORCROSSINGLONGITUDE=-80.0171825878646
  EQUATORCROSSINGLONGITUDE=-83.1045607322162
  EQUATORCROSSINGLONGITUDE=-86.1925733248845
  EQUATORCROSSINGTIME=13:52:00.296015
  EQUATORCROSSINGTIME=13:58:11.783455
  EQUATORCROSSINGTIME=14:10:33.050881
  EQUATORCROSSINGTIME=14:22:54.072603
  EQUATORCROSSINGTIME=14:35:15.964468
  EQUATORCROSSINGTIME=14:53:48.976317
  EQUATORCROSSINGTIME=15:06:10.109374
  EQUATORCROSSINGTIME=15:18:31.590110
  EQUATORCROSSINGTIME=15:30:53.380135
  EQUATORCROSSINGTIME=15:37:04.883419
  EQUATORCROSSINGTIME=15:49:26.174422
  EQUATORCROSSINGTIME=16:01:47.186363
  EQUATORCROSSINGTIME=16:14:09.091656
  EXCLUSIONGRINGFLAG=N
  GEOANYABNORMAL=False
  GEOESTMAXRMSERROR=50.0
  GLOBALGRIDCOLUMNS250M=172800
  GLOBALGRIDCOLUMNS500M=86400
  GLOBALGRIDROWS250M=86400
  GLOBALGRIDROWS500M=43200
  GRANULEBEGINNINGDATETIME=2011-10-16T13:55:00.000000Z,
2011-10-17T14:40:00.000000Z, 2011-10-18T15:20:00.000000Z,
2011-10-19T14:25:00.000000Z, 2011-10-20T15:10:00.000000Z,
2011-10-21T14:15:00.000000Z, 2011-10-22T14:55:00.000000Z,
2011-10-23T14:00:00.000000Z
  GRANULEDAYNIGHTFLAG=Day, Day, Day, Day, Day, Day, Day, Day
  GRANULEDAYOFYEAR=289, 290, 291, 292, 293, 294, 295, 296
  GRANULEENDINGDATETIME=2011-10-16T15:40:00.000000Z,
2011-10-17T16:25:00.000000Z, 2011-10-18T15:30:00.000000Z,
2011-10-19T16:10:00.000000Z, 2011-10-20T15:15:00.000000Z,
2011-10-21T16:00:00.000000Z, 2011-10-22T15:05:00.000000Z,
2011-10-23T15:50:00.000000Z
  GRINGPOINTLATITUDE=-29.9999999973059, -19.900618521232,
-19.931832012974, -30.0325512403038
  GRINGPOINTLONGITUDE=-80.8290376770946, -74.4810824411033,
-63.597163215181, -69.0095124954365
  GRINGPOINTSEQUENCENO=1, 2, 3, 4
  HDFEOSVersion=HDFEOS_V2.9
  HORIZONTALTILENUMBER=11
  INPUTPOINTER=MOD09GQ.A2011289.h11v11.005.2011291223308.hdf,
MOD09GQ.A2011290.h11v11.005.2011292054307.hdf,
MOD09GQ.A2011291.h11v11.005.2011293071509.hdf,
MOD09GQ.A2011292.h11v11.005.2011294224418.hdf,
MOD09GQ.A2011293.h11v11.005.2011295051850.hdf,
MOD09GQ.A2011294.h11v11.005.2011296053736.hdf,
MOD09GQ.A2011295.h11v11.005.2011297053810.hdf,
MOD09GQ.A2011296.h11v11.005.2011298095713.hdf,
MOD09GA.A2011289.h11v11.005.2011291223308.hdf,
MOD09GA.A2011290.h11v11.005.2011292054307.hdf,
MOD09GA.A2011291.h11v11.005.2011293071509.hdf,
MOD09GA.A2011292.h11v11.005.2011294224418.hdf,
MOD09GA.A2011293.h11v11.005.2011295051850.hdf,
MOD09GA.A2011294.h11v11.005.2011296053736.hdf,
MOD09GA.A2011295.h11v11.005.2011297053810.hdf,
MOD09GA.A2011296.h11v11.005.2011298095713.hdf
  LOCALGRANULEID=MOD09A1.A2011289.h11v11.005.2011298101214.hdf
  LOCALVERSIONID=5.0.11
  LONGNAME=MODIS/Terra Surface Reflectance 8-Day L3 Global 500m SIN Grid
  NADIRDATARESOLUTION250M=250m
  NADIRDATARESOLUTION500M=500m
  NORTHBOUNDINGCOORDINATE=-19.9999999982039
  NUMBEROFGRANULES=8
  NUMBEROFORBITS=13
  ORBITNUMBER=62913
  ORBITNUMBER=62914
  ORBITNUMBER=62928
  ORBITNUMBER=62929
  ORBITNUMBER=62943
  ORBITNUMBER=62957
  ORBITNUMBER=62958
  ORBITNUMBER=62972
  ORBITNUMBER=62986
  ORBITNUMBER=62987
  ORBITNUMBER=63001
  ORBITNUMBER=63015
  ORBITNUMBER=63016
  PARAMETERNAME=MOD09A1
  PERCENTCLOUDY=15
  PERCENTLAND=39
  PERCENTLANDSEAMASKCLASS=1, 39, 0, 0, 0, 0, 0, 59
  PERCENTLOWSUN=0
  PERCENTPROCESSED=100
  PERCENTSHADOW=4
  PGEVERSION=5.0.11
  PROCESSINGCENTER=MODAPS
  PROCESSINGENVIRONMENT=Linux minion5550 2.6.18-274.3.1.el5PAE #1 SMP
Tue Sep 6 20:56:05 EDT 2011 i686 i686 i386 GNU/Linux
  PROCESSVERSION=5.0.11
  PRODUCTIONDATETIME=2011-10-25T10:12:15.000Z
  QAPERCENTGOODQUALITY=95
  QAPERCENTINTERPOLATEDDATA=0
  QAPERCENTMISSINGDATA=0
  QAPERCENTNOTPRODUCEDCLOUD=0
  QAPERCENTNOTPRODUCEDOTHER=0
  QAPERCENTOTHERQUALITY=4
  QAPERCENTOUTOFBOUNDSDATA=0
  QAPERCENTPOOROUTPUT500MBAND1=7
  QAPERCENTPOOROUTPUT500MBAND2=20
  QAPERCENTPOOROUTPUT500MBAND3=0
  QAPERCENTPOOROUTPUT500MBAND4=0
  QAPERCENTPOOROUTPUT500MBAND5=0
  QAPERCENTPOOROUTPUT500MBAND6=0
  QAPERCENTPOOROUTPUT500MBAND7=2
  QUALITYCLASSPERCENTAGE500MBAND1=93, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 7, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND2=80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 20, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND3=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND4=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND5=95, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND6=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND7=96, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 2, 2, 0
  RANGEBEGINNINGDATE=2011-10-16
  RANGEBEGINNINGTIME=00:00:00.000000
  RANGEENDINGDATE=2011-10-23
  RANGEENDINGTIME=23:59:59.000000
  REPROCESSINGACTUAL=reprocessed
  REPROCESSINGPLANNED=further update is anticipated
  RESOLUTIONBANDS1AND2=500
  SCIENCEQUALITYFLAG=Not Investigated
  SCIENCEQUALITYFLAGEXPLANATION=See
http://landweb.nascom.nasa.gov/cgi-bin/QA_WWW/qaFlagPage.cgi?sat=terra
for the product Science Quality status.
  SHORTNAME=MOD09A1
  SOUTHBOUNDINGCOORDINATE=-29.9999999973059
  SPSOPARAMETERS=2015
  SYSTEMFILENAME=MOD09GQ.A2011289.h11v11.005.2011291223308.hdf,
MOD09GQ.A2011290.h11v11.005.2011292054307.hdf,
MOD09GQ.A2011291.h11v11.005.2011293071509.hdf,
MOD09GQ.A2011292.h11v11.005.2011294224418.hdf,
MOD09GQ.A2011293.h11v11.005.2011295051850.hdf,
MOD09GQ.A2011294.h11v11.005.2011296053736.hdf,
MOD09GQ.A2011295.h11v11.005.2011297053810.hdf,
MOD09GQ.A2011296.h11v11.005.2011298095713.hdf,
MOD09GA.A2011289.h11v11.005.2011291223308.hdf,
MOD09GA.A2011290.h11v11.005.2011292054307.hdf,
MOD09GA.A2011291.h11v11.005.2011293071509.hdf,
MOD09GA.A2011292.h11v11.005.2011294224418.hdf,
MOD09GA.A2011293.h11v11.005.2011295051850.hdf,
MOD09GA.A2011294.h11v11.005.2011296053736.hdf,
MOD09GA.A2011295.h11v11.005.2011297053810.hdf,
MOD09GA.A2011296.h11v11.005.2011298095713.hdf
  TileID=51011011
  VERSIONID=5
  VERTICALTILENUMBER=11
  WESTBOUNDINGCOORDINATE=-80.8290376770946
Subdatasets:
  SUBDATASET_1_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01
  SUBDATASET_1_DESC=[2400x2400] sur_refl_b01
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_2_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b02
  SUBDATASET_2_DESC=[2400x2400] sur_refl_b02
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_3_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b03
  SUBDATASET_3_DESC=[2400x2400] sur_refl_b03
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_4_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b04
  SUBDATASET_4_DESC=[2400x2400] sur_refl_b04
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_5_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b05
  SUBDATASET_5_DESC=[2400x2400] sur_refl_b05
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_6_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b06
  SUBDATASET_6_DESC=[2400x2400] sur_refl_b06
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_7_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b07
  SUBDATASET_7_DESC=[2400x2400] sur_refl_b07
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_8_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_qc_500m
  SUBDATASET_8_DESC=[2400x2400] sur_refl_qc_500m
MOD_Grid_500m_Surface_Reflectance (32-bit unsigned integer)
  SUBDATASET_9_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_szen
  SUBDATASET_9_DESC=[2400x2400] sur_refl_szen
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_10_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_vzen
  SUBDATASET_10_DESC=[2400x2400] sur_refl_vzen
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_11_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_raz
  SUBDATASET_11_DESC=[2400x2400] sur_refl_raz
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_12_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_state_500m
  SUBDATASET_12_DESC=[2400x2400] sur_refl_state_500m
MOD_Grid_500m_Surface_Reflectance (16-bit unsigned integer)
  SUBDATASET_13_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_day_of_year
  SUBDATASET_13_DESC=[2400x2400] sur_refl_day_of_year
MOD_Grid_500m_Surface_Reflectance (16-bit unsigned integer)
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)


On Tue, Oct 8, 2013 at 1:34 PM, Matteo Mattiuzzi
<matteo.mattiuzzi at boku.ac.at> wrote:
> Dear Agus,
>
> yes please send the output of gdalinfo (close to the end is the string you have to use).
>
>
> Matteo
>
>
>
>
>
>>>> Agustin Lobo <alobolistas at gmail.com> 10/07/13 5:42 PM >>>
> Hi!
>
> I get the following error when try to read an hdf image (release 4):
>
>> modisima <- stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
> Path to GDAL shared files: /usr/share/gdal/1.10
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
> Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
> returnCategoryNames = RAT) :
>   object 'RATlist' not found
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>   Cannot create a RasterLayer object from this file.
> In addition: Warning message:
> In dim(x) : no bands in dataset
>
> Also:
>
>> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
> Error in GDALinfo(file.path(modisdir,
> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>   object 'scaleOffset' not found
> In addition: Warning messages:
> 1: In dim(x) : no bands in dataset
> 2: In GDALinfo(file.path(modisdir,
> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>   GeoTransform values not available
>
> Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
> terminal, I do get
> output from gdalinfo (quite long, let me know if I should send it).
> Also, I can display the
> image in Qgis with no problem.
>
> Any idea on where the problem could be?
> Thanks,
> Agus
>
>> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=es_ES.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From alessandrosamuel at yahoo.com.br  Tue Oct  8 13:45:30 2013
From: alessandrosamuel at yahoo.com.br (Alessandro Samuel Rosa)
Date: Tue, 8 Oct 2013 04:45:30 -0700 (PDT)
Subject: [R-sig-Geo] Questions about creation of spsurvey.analysis object
Message-ID: <1381232730.16854.YahooMailNeo@web141405.mail.bf1.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/e0ed693f/attachment.pl>

From jmbarriosg at gmail.com  Tue Oct  8 13:58:12 2013
From: jmbarriosg at gmail.com (=?ISO-8859-1?Q?Jos=E9_Miguel_Barrios?=)
Date: Tue, 8 Oct 2013 13:58:12 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
	<525409D1020000270001CD49@gwia2.boku.ac.at>
	<CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
Message-ID: <CAKAdxrXZvyuXuUk7jJTER6cRdsL23C-zgs43EW5nb3RjhhqY=w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/920b5782/attachment.pl>

From matteo.mattiuzzi at boku.ac.at  Tue Oct  8 14:09:47 2013
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Tue, 08 Oct 2013 14:09:47 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
	<525409D1020000270001CD49@gwia2.boku.ac.at>
	<CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
Message-ID: <5254122B020000270001CD7D@gwia2.boku.ac.at>

Section 'Subdatasets'ie:
SUBDATASET_1_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01


# this should work if R is in the HDF directory! if not redo gdalinfo with the file absolute path:  gdalinfo /path/to/MOD09A1.A2011289.h11v11.005.2011298101214.hdf
r <- raster("HDF4_EOS:EOS_GRID:MOD09A1.A2011289.h11v11.005.2011298101214.hdf:MOD_Grid_500m_Surface_Reflectance:sur_refl_b01")


Take care about the quotation marks! You can do:
r <- raster("HDF4_EOS:EOS_GRID:MOD09A1.A2011289.h11v11.005.2011298101214.hdf:MOD_Grid_500m_Surface_Reflectance:sur_refl_b01") # removed

# or 
r <- raster('HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01') # not removed



# The MODIS Package contains the function 'getSds' that extracts the SDS name, may you find something usable in there.


I hope this works as I am writing without testing!
Matteo


>>> Agustin Lobo <alobolistas at gmail.com> 10/08/13 1:45 PM >>>
Here it goes, thaks a lot for your help:

$ gdalinfo MOD09A1.A2011289.h11v11.005.2011298101214.hdf
Driver: HDF4/Hierarchical Data Format Release 4
Files: MOD09A1.A2011289.h11v11.005.2011298101214.hdf
Size is 512, 512
Coordinate System is `'
Metadata:
  ASSOCIATEDINSTRUMENTSHORTNAME=MODIS
  ASSOCIATEDPLATFORMSHORTNAME=Terra
  ASSOCIATEDSENSORSHORTNAME=MODIS
  AUTOMATICQUALITYFLAG=Passed
  AUTOMATICQUALITYFLAGEXPLANATION=Always Passed
  CHARACTERISTICBINANGULARSIZE250M=7.5
  CHARACTERISTICBINANGULARSIZE500M=15.0
  CHARACTERISTICBINSIZE250M=231.656358263889
  CHARACTERISTICBINSIZE500M=463.312716527778
  DATACOLUMNS250M=4800
  DATACOLUMNS500M=2400
  DATAROWS250M=4800
  DATAROWS500M=2400
  DAYNIGHTFLAG=Day
  DESCRREVISION=5.1
  EASTBOUNDINGCOORDINATE=-63.8417981939892
  EQUATORCROSSINGDATE=2011-10-16
  EQUATORCROSSINGDATE=2011-10-16
  EQUATORCROSSINGDATE=2011-10-17
  EQUATORCROSSINGDATE=2011-10-17
  EQUATORCROSSINGDATE=2011-10-18
  EQUATORCROSSINGDATE=2011-10-19
  EQUATORCROSSINGDATE=2011-10-19
  EQUATORCROSSINGDATE=2011-10-20
  EQUATORCROSSINGDATE=2011-10-21
  EQUATORCROSSINGDATE=2011-10-21
  EQUATORCROSSINGDATE=2011-10-22
  EQUATORCROSSINGDATE=2011-10-23
  EQUATORCROSSINGDATE=2011-10-23
  EQUATORCROSSINGLONGITUDE=-50.6540495500062
  EQUATORCROSSINGLONGITUDE=-52.2073110490786
  EQUATORCROSSINGLONGITUDE=-55.295882063234
  EQUATORCROSSINGLONGITUDE=-58.3832333779475
  EQUATORCROSSINGLONGITUDE=-61.4709999916156
  EQUATORCROSSINGLONGITUDE=-66.1122213699271
  EQUATORCROSSINGLONGITUDE=-69.2001737045505
  EQUATORCROSSINGLONGITUDE=-72.2878369750113
  EQUATORCROSSINGLONGITUDE=-75.3752441195227
  EQUATORCROSSINGLONGITUDE=-76.9284675895243
  EQUATORCROSSINGLONGITUDE=-80.0171825878646
  EQUATORCROSSINGLONGITUDE=-83.1045607322162
  EQUATORCROSSINGLONGITUDE=-86.1925733248845
  EQUATORCROSSINGTIME=13:52:00.296015
  EQUATORCROSSINGTIME=13:58:11.783455
  EQUATORCROSSINGTIME=14:10:33.050881
  EQUATORCROSSINGTIME=14:22:54.072603
  EQUATORCROSSINGTIME=14:35:15.964468
  EQUATORCROSSINGTIME=14:53:48.976317
  EQUATORCROSSINGTIME=15:06:10.109374
  EQUATORCROSSINGTIME=15:18:31.590110
  EQUATORCROSSINGTIME=15:30:53.380135
  EQUATORCROSSINGTIME=15:37:04.883419
  EQUATORCROSSINGTIME=15:49:26.174422
  EQUATORCROSSINGTIME=16:01:47.186363
  EQUATORCROSSINGTIME=16:14:09.091656
  EXCLUSIONGRINGFLAG=N
  GEOANYABNORMAL=False
  GEOESTMAXRMSERROR=50.0
  GLOBALGRIDCOLUMNS250M=172800
  GLOBALGRIDCOLUMNS500M=86400
  GLOBALGRIDROWS250M=86400
  GLOBALGRIDROWS500M=43200
  GRANULEBEGINNINGDATETIME=2011-10-16T13:55:00.000000Z,
2011-10-17T14:40:00.000000Z, 2011-10-18T15:20:00.000000Z,
2011-10-19T14:25:00.000000Z, 2011-10-20T15:10:00.000000Z,
2011-10-21T14:15:00.000000Z, 2011-10-22T14:55:00.000000Z,
2011-10-23T14:00:00.000000Z
  GRANULEDAYNIGHTFLAG=Day, Day, Day, Day, Day, Day, Day, Day
  GRANULEDAYOFYEAR=289, 290, 291, 292, 293, 294, 295, 296
  GRANULEENDINGDATETIME=2011-10-16T15:40:00.000000Z,
2011-10-17T16:25:00.000000Z, 2011-10-18T15:30:00.000000Z,
2011-10-19T16:10:00.000000Z, 2011-10-20T15:15:00.000000Z,
2011-10-21T16:00:00.000000Z, 2011-10-22T15:05:00.000000Z,
2011-10-23T15:50:00.000000Z
  GRINGPOINTLATITUDE=-29.9999999973059, -19.900618521232,
-19.931832012974, -30.0325512403038
  GRINGPOINTLONGITUDE=-80.8290376770946, -74.4810824411033,
-63.597163215181, -69.0095124954365
  GRINGPOINTSEQUENCENO=1, 2, 3, 4
  HDFEOSVersion=HDFEOS_V2.9
  HORIZONTALTILENUMBER=11
  INPUTPOINTER=MOD09GQ.A2011289.h11v11.005.2011291223308.hdf,
MOD09GQ.A2011290.h11v11.005.2011292054307.hdf,
MOD09GQ.A2011291.h11v11.005.2011293071509.hdf,
MOD09GQ.A2011292.h11v11.005.2011294224418.hdf,
MOD09GQ.A2011293.h11v11.005.2011295051850.hdf,
MOD09GQ.A2011294.h11v11.005.2011296053736.hdf,
MOD09GQ.A2011295.h11v11.005.2011297053810.hdf,
MOD09GQ.A2011296.h11v11.005.2011298095713.hdf,
MOD09GA.A2011289.h11v11.005.2011291223308.hdf,
MOD09GA.A2011290.h11v11.005.2011292054307.hdf,
MOD09GA.A2011291.h11v11.005.2011293071509.hdf,
MOD09GA.A2011292.h11v11.005.2011294224418.hdf,
MOD09GA.A2011293.h11v11.005.2011295051850.hdf,
MOD09GA.A2011294.h11v11.005.2011296053736.hdf,
MOD09GA.A2011295.h11v11.005.2011297053810.hdf,
MOD09GA.A2011296.h11v11.005.2011298095713.hdf
  LOCALGRANULEID=MOD09A1.A2011289.h11v11.005.2011298101214.hdf
  LOCALVERSIONID=5.0.11
  LONGNAME=MODIS/Terra Surface Reflectance 8-Day L3 Global 500m SIN Grid
  NADIRDATARESOLUTION250M=250m
  NADIRDATARESOLUTION500M=500m
  NORTHBOUNDINGCOORDINATE=-19.9999999982039
  NUMBEROFGRANULES=8
  NUMBEROFORBITS=13
  ORBITNUMBER=62913
  ORBITNUMBER=62914
  ORBITNUMBER=62928
  ORBITNUMBER=62929
  ORBITNUMBER=62943
  ORBITNUMBER=62957
  ORBITNUMBER=62958
  ORBITNUMBER=62972
  ORBITNUMBER=62986
  ORBITNUMBER=62987
  ORBITNUMBER=63001
  ORBITNUMBER=63015
  ORBITNUMBER=63016
  PARAMETERNAME=MOD09A1
  PERCENTCLOUDY=15
  PERCENTLAND=39
  PERCENTLANDSEAMASKCLASS=1, 39, 0, 0, 0, 0, 0, 59
  PERCENTLOWSUN=0
  PERCENTPROCESSED=100
  PERCENTSHADOW=4
  PGEVERSION=5.0.11
  PROCESSINGCENTER=MODAPS
  PROCESSINGENVIRONMENT=Linux minion5550 2.6.18-274.3.1.el5PAE #1 SMP
Tue Sep 6 20:56:05 EDT 2011 i686 i686 i386 GNU/Linux
  PROCESSVERSION=5.0.11
  PRODUCTIONDATETIME=2011-10-25T10:12:15.000Z
  QAPERCENTGOODQUALITY=95
  QAPERCENTINTERPOLATEDDATA=0
  QAPERCENTMISSINGDATA=0
  QAPERCENTNOTPRODUCEDCLOUD=0
  QAPERCENTNOTPRODUCEDOTHER=0
  QAPERCENTOTHERQUALITY=4
  QAPERCENTOUTOFBOUNDSDATA=0
  QAPERCENTPOOROUTPUT500MBAND1=7
  QAPERCENTPOOROUTPUT500MBAND2=20
  QAPERCENTPOOROUTPUT500MBAND3=0
  QAPERCENTPOOROUTPUT500MBAND4=0
  QAPERCENTPOOROUTPUT500MBAND5=0
  QAPERCENTPOOROUTPUT500MBAND6=0
  QAPERCENTPOOROUTPUT500MBAND7=2
  QUALITYCLASSPERCENTAGE500MBAND1=93, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 7, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND2=80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 20, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND3=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND4=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND5=95, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0,
0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND6=100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0
  QUALITYCLASSPERCENTAGE500MBAND7=96, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 2, 2, 0
  RANGEBEGINNINGDATE=2011-10-16
  RANGEBEGINNINGTIME=00:00:00.000000
  RANGEENDINGDATE=2011-10-23
  RANGEENDINGTIME=23:59:59.000000
  REPROCESSINGACTUAL=reprocessed
  REPROCESSINGPLANNED=further update is anticipated
  RESOLUTIONBANDS1AND2=500
  SCIENCEQUALITYFLAG=Not Investigated
  SCIENCEQUALITYFLAGEXPLANATION=See
http://landweb.nascom.nasa.gov/cgi-bin/QA_WWW/qaFlagPage.cgi?sat=terra
for the product Science Quality status.
  SHORTNAME=MOD09A1
  SOUTHBOUNDINGCOORDINATE=-29.9999999973059
  SPSOPARAMETERS=2015
  SYSTEMFILENAME=MOD09GQ.A2011289.h11v11.005.2011291223308.hdf,
MOD09GQ.A2011290.h11v11.005.2011292054307.hdf,
MOD09GQ.A2011291.h11v11.005.2011293071509.hdf,
MOD09GQ.A2011292.h11v11.005.2011294224418.hdf,
MOD09GQ.A2011293.h11v11.005.2011295051850.hdf,
MOD09GQ.A2011294.h11v11.005.2011296053736.hdf,
MOD09GQ.A2011295.h11v11.005.2011297053810.hdf,
MOD09GQ.A2011296.h11v11.005.2011298095713.hdf,
MOD09GA.A2011289.h11v11.005.2011291223308.hdf,
MOD09GA.A2011290.h11v11.005.2011292054307.hdf,
MOD09GA.A2011291.h11v11.005.2011293071509.hdf,
MOD09GA.A2011292.h11v11.005.2011294224418.hdf,
MOD09GA.A2011293.h11v11.005.2011295051850.hdf,
MOD09GA.A2011294.h11v11.005.2011296053736.hdf,
MOD09GA.A2011295.h11v11.005.2011297053810.hdf,
MOD09GA.A2011296.h11v11.005.2011298095713.hdf
  TileID=51011011
  VERSIONID=5
  VERTICALTILENUMBER=11
  WESTBOUNDINGCOORDINATE=-80.8290376770946
Subdatasets:
  SUBDATASET_1_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01
  SUBDATASET_1_DESC=[2400x2400] sur_refl_b01
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_2_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b02
  SUBDATASET_2_DESC=[2400x2400] sur_refl_b02
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_3_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b03
  SUBDATASET_3_DESC=[2400x2400] sur_refl_b03
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_4_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b04
  SUBDATASET_4_DESC=[2400x2400] sur_refl_b04
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_5_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b05
  SUBDATASET_5_DESC=[2400x2400] sur_refl_b05
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_6_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b06
  SUBDATASET_6_DESC=[2400x2400] sur_refl_b06
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_7_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b07
  SUBDATASET_7_DESC=[2400x2400] sur_refl_b07
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_8_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_qc_500m
  SUBDATASET_8_DESC=[2400x2400] sur_refl_qc_500m
MOD_Grid_500m_Surface_Reflectance (32-bit unsigned integer)
  SUBDATASET_9_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_szen
  SUBDATASET_9_DESC=[2400x2400] sur_refl_szen
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_10_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_vzen
  SUBDATASET_10_DESC=[2400x2400] sur_refl_vzen
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_11_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_raz
  SUBDATASET_11_DESC=[2400x2400] sur_refl_raz
MOD_Grid_500m_Surface_Reflectance (16-bit integer)
  SUBDATASET_12_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_state_500m
  SUBDATASET_12_DESC=[2400x2400] sur_refl_state_500m
MOD_Grid_500m_Surface_Reflectance (16-bit unsigned integer)
  SUBDATASET_13_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_day_of_year
  SUBDATASET_13_DESC=[2400x2400] sur_refl_day_of_year
MOD_Grid_500m_Surface_Reflectance (16-bit unsigned integer)
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0,  512.0)
Upper Right (  512.0,    0.0)
Lower Right (  512.0,  512.0)
Center      (  256.0,  256.0)


On Tue, Oct 8, 2013 at 1:34 PM, Matteo Mattiuzzi
<matteo.mattiuzzi at boku.ac.at> wrote:
> Dear Agus,
>
> yes please send the output of gdalinfo (close to the end is the string you have to use).
>
>
> Matteo
>
>
>
>
>
>>>> Agustin Lobo <alobolistas at gmail.com> 10/07/13 5:42 PM >>>
> Hi!
>
> I get the following error when try to read an hdf image (release 4):
>
>> modisima <- stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
> rgdal: version: 0.8-11, (SVN revision 479M)
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
> Path to GDAL shared files: /usr/share/gdal/1.10
> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
> Path to PROJ.4 shared files: (autodetected)
> Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
> returnCategoryNames = RAT) :
>   object 'RATlist' not found
> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>   Cannot create a RasterLayer object from this file.
> In addition: Warning message:
> In dim(x) : no bands in dataset
>
> Also:
>
>> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
> Error in GDALinfo(file.path(modisdir,
> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>   object 'scaleOffset' not found
> In addition: Warning messages:
> 1: In dim(x) : no bands in dataset
> 2: In GDALinfo(file.path(modisdir,
> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>   GeoTransform values not available
>
> Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
> terminal, I do get
> output from gdalinfo (quite long, let me know if I should send it).
> Also, I can display the
> image in Qgis with no problem.
>
> Any idea on where the problem could be?
> Thanks,
> Agus
>
>> sessionInfo()
> R version 3.0.2 (2013-09-25)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
> LC_PAPER=es_ES.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13
>
> loaded via a namespace (and not attached):
> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>


From jari.oksanen at oulu.fi  Tue Oct  8 14:11:33 2013
From: jari.oksanen at oulu.fi (Jari Oksanen)
Date: Tue, 8 Oct 2013 12:11:33 +0000
Subject: [R-sig-Geo] ggmap error
In-Reply-To: <CANVKczODrZbRSBPMi4KLHTSe40-QoVJuRjeWXAXW4m4X-uaDYQ@mail.gmail.com>
References: <a89eaca8156c44ca852b40b3d783e565@EX-1-HT0.lancs.local>
	<CANVKczODrZbRSBPMi4KLHTSe40-QoVJuRjeWXAXW4m4X-uaDYQ@mail.gmail.com>
Message-ID: <1DE7F010-A051-4CCB-94F3-64930AB7AD71@oulu.fi>


On 08/10/2013, at 13:40 PM, Barry Rowlingson wrote:

> What version of R do you have? The paste0 function has been in R for a
> while now...

More exactly, paste0() has been in R release since April 2012. It was introduced in R 2.15.0 which was released on March 30, 2012. In my book that is such a recent feature that I would not use it in a released package.

Would this help in R < 2.15.0?

paste0 <- function(..., collapse = NULL) paste(..., sep = "", collapse = collapse)

Cheers, Jari Oksanen

> 
> On Tue, Oct 8, 2013 at 11:28 AM, pierluigi de rosa
> <pierluigi.derosa at gmail.com> wrote:
>> Dear R-Geo user
>> I have a trouble when using any function from ggmap package...
>> It tells me
>> Error in message(paste0("Map from URL : ", url)) :
>>  not finding function  "paste0"
>> 
>> Some one experienced the same issue?
>> thanks
>> P
>> 
>> --
>> Ing. Pierluigi De Rosa (PhD)
>> tel: 075 791 0278 / fax: 075 7823038
>> cel: 3497558268
>> skype: pierluigi.derosa
>> 
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Tue Oct  8 14:54:56 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 8 Oct 2013 14:54:56 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <CAKAdxrXZvyuXuUk7jJTER6cRdsL23C-zgs43EW5nb3RjhhqY=w@mail.gmail.com>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
	<525409D1020000270001CD49@gwia2.boku.ac.at>
	<CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
	<CAKAdxrXZvyuXuUk7jJTER6cRdsL23C-zgs43EW5nb3RjhhqY=w@mail.gmail.com>
Message-ID: <CAG4NReKP6MBVaWsQhUjmR6O=OTVM4eKTrA=Me2v6f2tqsSjARw@mail.gmail.com>

Yes, no problem from that side. I've used
gdal_translate -sds

and get all subdatasets saved as individual tif layers.
But we should know what's wrong with the hdf flle as there are many
thousands of files like this on the
modis distribution data servers.

Agus

On Tue, Oct 8, 2013 at 1:58 PM, Jos? Miguel Barrios
<jmbarriosg at gmail.com> wrote:
> Have you tried converting the layer(s) of interest to something like ".tif"
> by using gdal_translate?
>
>

>>
>> On Tue, Oct 8, 2013 at 1:34 PM, Matteo Mattiuzzi
>> <matteo.mattiuzzi at boku.ac.at> wrote:
>> > Dear Agus,
>> >
>> > yes please send the output of gdalinfo (close to the end is the string
>> you have to use).
>> >
>> >
>> > Matteo
>> >
>> >
>> >
>> >
>> >
>> >>>> Agustin Lobo <alobolistas at gmail.com> 10/07/13 5:42 PM >>>
>> > Hi!
>> >
>> > I get the following error when try to read an hdf image (release 4):
>> >
>> >> modisima <-
>> stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
>> > rgdal: version: 0.8-11, (SVN revision 479M)
>> > Geospatial Data Abstraction Library extensions to R successfully loaded
>> > Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
>> > Path to GDAL shared files: /usr/share/gdal/1.10
>> > Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>> > Path to PROJ.4 shared files: (autodetected)
>> > Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
>> > returnCategoryNames = RAT) :
>> >   object 'RATlist' not found
>> > Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>> >   Cannot create a RasterLayer object from this file.
>> > In addition: Warning message:
>> > In dim(x) : no bands in dataset
>> >
>> > Also:
>> >
>> >>
>> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
>> > Error in GDALinfo(file.path(modisdir,
>> > "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>> >   object 'scaleOffset' not found
>> > In addition: Warning messages:
>> > 1: In dim(x) : no bands in dataset
>> > 2: In GDALinfo(file.path(modisdir,
>> > "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>> >   GeoTransform values not available
>> >
>> > Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
>> > terminal, I do get
>> > output from gdalinfo (quite long, let me know if I should send it).
>> > Also, I can display the
>> > image in Qgis with no problem.
>> >
>> > Any idea on where the problem could be?
>> > Thanks,
>> > Agus
>> >
>> >> sessionInfo()
>> > R version 3.0.2 (2013-09-25)
>> > Platform: x86_64-pc-linux-gnu (64-bit)
>> >
>> > locale:
>> >  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> > LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>> >  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
>> > LC_PAPER=es_ES.UTF-8       LC_NAME=C
>> >  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> > LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>> >
>> > attached base packages:
>> > [1] stats     graphics  grDevices utils     datasets  methods   base
>> >
>> > other attached packages:
>> > [1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13
>> >
>> > loaded via a namespace (and not attached):
>> > [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Tue Oct  8 15:15:14 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 8 Oct 2013 15:15:14 +0200
Subject: [R-sig-Geo] problem reading hdf image
In-Reply-To: <5254122B020000270001CD7D@gwia2.boku.ac.at>
References: <CAG4NRe+tvBZ+JRu=i0w-bFVEcAE+HyYLMS7Ezqv5pTPK0f0U-A@mail.gmail.com>
	<525409D1020000270001CD49@gwia2.boku.ac.at>
	<CAG4NReL7Ju0H=rea9YTcboCpKuPFc8m8Ozcu9G-z01LQE34vDA@mail.gmail.com>
	<5254122B020000270001CD7D@gwia2.boku.ac.at>
Message-ID: <CAG4NReLrFtdxYQhBNKgk73KyUGbrhX2PP_93Et6f_OBdAA6NwQ@mail.gmail.com>

Thanks!
The following works:
r <- raster("HDF4_EOS:EOS_GRID:/media/Iomega_HDD/VOLCAN/Modis_adls_MOD09A1/MOD09A1.A2011289.h11v11.005.2011298101214.hdf:MOD_Grid_500m_Surface_Reflectance:sur_refl_b01")

And much beter, the following works as well:
modislista <- getSds(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
length(modislista$SDS4gdal)
s <- stack(modislista$SDS4gdal)
names(s) <- modislista$SDS4names
inMemory(s)
[1] FALSE
show(s)
class       : RasterStack
dimensions  : 2400, 2400, 5760000, 13  (nrow, ncol, ncell, nlayers)
resolution  : 463.3127, 463.3127  (x, y)
extent      : -7783654, -6671703, -3335852, -2223901  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181
+b=6371007.181 +units=m +no_defs
names       : layer.1, layer.2, layer.3, layer.4, layer.5, layer.6,
layer.7, layer.8, layer.9, layer.10, layer.11, layer.12, layer.13
min values  :  -32768,  -32768,  -32768,  -32768,  -32768,  -32768,
 -16,      NA,  -32768,   -32768,   -32768,        0,        0
max values  :   32767,   32767,   32767,   32767,   32767,   32767,
7753,      NA,   32767,    32767,    32767,    65535,    65535

Note the result of inMemory(s), which is critical for all this to be
operational (thanks Robert!!).
I think we should have a wrap function (ie. readMODIS) in package
MODIS doing this. Then the user can just discard those layers in s
that would be of no interest.

Agus

On Tue, Oct 8, 2013 at 2:09 PM, Matteo Mattiuzzi
<matteo.mattiuzzi at boku.ac.at> wrote:
> Section 'Subdatasets'ie:
> SUBDATASET_1_NAME=HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01
>
>
> # this should work if R is in the HDF directory! if not redo gdalinfo with the file absolute path:  gdalinfo /path/to/MOD09A1.A2011289.h11v11.005.2011298101214.hdf
> r <- raster("HDF4_EOS:EOS_GRID:MOD09A1.A2011289.h11v11.005.2011298101214.hdf:MOD_Grid_500m_Surface_Reflectance:sur_refl_b01")
>
>
> Take care about the quotation marks! You can do:
> r <- raster("HDF4_EOS:EOS_GRID:MOD09A1.A2011289.h11v11.005.2011298101214.hdf:MOD_Grid_500m_Surface_Reflectance:sur_refl_b01") # removed
>
> # or
> r <- raster('HDF4_EOS:EOS_GRID:"MOD09A1.A2011289.h11v11.005.2011298101214.hdf":MOD_Grid_500m_Surface_Reflectance:sur_refl_b01') # not removed
>
>
>
> # The MODIS Package contains the function 'getSds' that extracts the SDS name, may you find something usable in there.
>
>
> I hope this works as I am writing without testing!
> Matteo
>
>

>>>>> Agustin Lobo <alobolistas at gmail.com> 10/07/13 5:42 PM >>>
>> Hi!
>>
>> I get the following error when try to read an hdf image (release 4):
>>
>>> modisima <- stack(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
>> rgdal: version: 0.8-11, (SVN revision 479M)
>> Geospatial Data Abstraction Library extensions to R successfully loaded
>> Loaded GDAL runtime: GDAL 1.10.0, released 2013/04/24
>> Path to GDAL shared files: /usr/share/gdal/1.10
>> Loaded PROJ.4 runtime: Rel. 4.8.0, 6 March 2012, [PJ_VERSION: 480]
>> Path to PROJ.4 shared files: (autodetected)
>> Error in GDALinfo(filename, silent = silent, returnRAT = RAT,
>> returnCategoryNames = RAT) :
>>   object 'RATlist' not found
>> Error in .rasterObjectFromFile(x, objecttype = "RasterBrick", ...) :
>>   Cannot create a RasterLayer object from this file.
>> In addition: Warning message:
>> In dim(x) : no bands in dataset
>>
>> Also:
>>
>>> GDALinfo(file.path(modisdir,"MOD09A1.A2011289.h11v11.005.2011298101214.hdf"))
>> Error in GDALinfo(file.path(modisdir,
>> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>>   object 'scaleOffset' not found
>> In addition: Warning messages:
>> 1: In dim(x) : no bands in dataset
>> 2: In GDALinfo(file.path(modisdir,
>> "MOD09A1.A2011289.h11v11.005.2011298101214.hdf")) :
>>   GeoTransform values not available
>>
>> Nevertheless, hdf4 and 5 are listed by gdalDrivers() and, on the linux
>> terminal, I do get
>> output from gdalinfo (quite long, let me know if I should send it).
>> Also, I can display the
>> image in Qgis with no problem.
>>
>> Any idea on where the problem could be?
>> Thanks,
>> Agus
>>
>>> sessionInfo()
>> R version 3.0.2 (2013-09-25)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
>> LC_TIME=es_ES.UTF-8        LC_COLLATE=en_US.UTF-8
>>  [5] LC_MONETARY=es_ES.UTF-8    LC_MESSAGES=en_US.UTF-8
>> LC_PAPER=es_ES.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> LC_MEASUREMENT=es_ES.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] rgdal_0.8-11  MODIS_0.10-8  raster_2.1-49 sp_1.0-13
>>
>> loaded via a namespace (and not attached):
>> [1] grid_3.0.2      lattice_0.20-23 tools_3.0.2
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>
>
>
>
>


From cpadwick at hotmail.com  Tue Oct  8 16:56:15 2013
From: cpadwick at hotmail.com (cpadwick padwick)
Date: Tue, 8 Oct 2013 07:56:15 -0700
Subject: [R-sig-Geo] unable to load shared object
Message-ID: <BAY167-W23D2F080AAE659F809A87FCF1C0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/97ce021b/attachment.pl>

From ortiz-bobea at rff.org  Tue Oct  8 17:53:13 2013
From: ortiz-bobea at rff.org (Ariel Ortiz-Bobea)
Date: Tue, 8 Oct 2013 08:53:13 -0700 (PDT)
Subject: [R-sig-Geo] problem reading large ncdf on windows 7 64 bits
In-Reply-To: <1360718493.33962.YahooMailNeo@web133106.mail.ir2.yahoo.com>
References: <1360718493.33962.YahooMailNeo@web133106.mail.ir2.yahoo.com>
Message-ID: <1381247593802-7584819.post@n2.nabble.com>

I also ran into this problem.

It was solved by installing the "ncdf4" package. 

Instructions can be found here: http://cirrus.ucsd.edu/~pierce/ncdf/



-----
Ariel Ortiz-Bobea
Fellow at Resources for the Future
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/problem-reading-large-ncdf-on-windows-7-64-bits-tp7582596p7584819.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From pierluigi.derosa at gmail.com  Tue Oct  8 18:33:26 2013
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 8 Oct 2013 18:33:26 +0200
Subject: [R-sig-Geo] change color palette to ggmap
Message-ID: <CAAgsrZhP5bdtv52i_o=bedENzZs6ER5RSPspycoXzLMH=0Cn9A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/d28c943e/attachment.pl>

From pierluigi.derosa at gmail.com  Tue Oct  8 18:54:48 2013
From: pierluigi.derosa at gmail.com (pierluigi de rosa)
Date: Tue, 8 Oct 2013 18:54:48 +0200
Subject: [R-sig-Geo] openmap on multiple plot
Message-ID: <CAAgsrZjWoKeKtbyCtaDMH6cUYrW8acKSsJsgxNxwtNGLrTCX5w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131008/1f5da844/attachment.pl>

From alobolistas at gmail.com  Tue Oct  8 22:17:32 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 8 Oct 2013 22:17:32 +0200
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
Message-ID: <CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>

Eddie,
(I'm answering through the list, perhaps somebody else is interested)

You need one element in "indices" for each input layer, so if you have
5 layers you should use
mx <- stackApply(s,indices=c(1,1,1,1,1),max)
The actual value of each index indicates to which output layer that
input layer is contributing.
In your case, there is only one output layer, thus all values must be
1. But see the
help page for an example with different index values.

Agus

On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es> wrote:
> ---------- Forwarded message ----------
> From: Eddie Smith <eddieatr at gmail.com>
> Date: Tue, Oct 8, 2013 at 7:40 PM
> Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
> To: Agustin.Lobo at ictja.csic.es
>
>
> Dear Agus,
>
> Thank you very much for your reply. Your script below is working
> however, would you mind if I ask a basic question on what is the
> purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
> and the error message is
>> mx <- stackApply(s,indices=c(1,1),max)
> Warning message:
> In stackApply(s, indices = c(1, 1), max) :
>   number of items to replace is not a multiple of replacement length
>
> I am sorry if my question is too basic. I am new to R.
>
> Thank you.
>
> library(raster)
> r1 <- raster(matrix(rnorm(100,5,10),10,10))
> r2 <- raster(matrix(rnorm(100,2,30),10,10))
> s <- stack(r1,r2)
> mx <- stackApply(s,indices=c(1,1),max)
> miwhichmax <- function(x,na.rm=TRUE) which.max(x)
> mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>
>
> On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>
>> oops, copied the wrong line,
>> it must be
>> mx <- stackApply(s,indices=c(1,1),max)
>>
>> Agus
>>
>>
>> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> > What about this:
>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>> > s <- stack(r1,r2)
>> > mx <- stackApply(s,max)
>> >
>> > which.max() fails because raster requires the na.rm argument (I think, Robert?)
>> >
>> > mxd <- stackApply(s,indices=c(1,1),which.max)
>> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>> >
>> > so make your own function icluding the na.rm argument:
>> >
>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>> >
>> > Agus
>> >
>> >
>> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com> wrote:
>> >> Dear list,
>> >>
>> >> I have a RasterLayer that contains 365 bands with a dimension of 1032,
>> >> 1656, 1708992  (nrow, ncol, ncell).
>> >>
>> >> library(raster)
>> >> img <- list.files(pattern='\\.img$')
>> >> stack <- stack(img)
>> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>> >> overwrite=TRUE)
>> >>
>> >> 1. How could I produce a raster layer that contains a maximum value from
>> >> 365 bands for each pixel?
>> >> I tried maxValue() but that only give me a maximum value for each band.
>> >>
>> >> 2. If I manage to do step 1, is it possible to know from which band is
>> >> actually the maximum value originate?
>> >>
>> >>         [[alternative HTML version deleted]]
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> --
> Dr. Agustin Lobo
> Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
> Lluis Sole Sabaris s/n
> 08028 Barcelona
> Spain
> Tel. 34 934095410
> Fax. 34 934110012
> e-mail Agustin.Lobo at ictja.csic.es


From stevenhuyi at gmail.com  Wed Oct  9 05:23:56 2013
From: stevenhuyi at gmail.com (=?UTF-8?B?6IOh6Im6?=)
Date: Wed, 9 Oct 2013 11:23:56 +0800
Subject: [R-sig-Geo] some problems with krigeST
Message-ID: <CAFYSUoMfo6t_vumYgb-F=KJR0=nA1uyFWpmA07Aijb7XKEZSig@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131009/cfbfc411/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct  9 08:45:21 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 09 Oct 2013 08:45:21 +0200
Subject: [R-sig-Geo] some problems with krigeST
In-Reply-To: <CAFYSUoMfo6t_vumYgb-F=KJR0=nA1uyFWpmA07Aijb7XKEZSig@mail.gmail.com>
References: <CAFYSUoMfo6t_vumYgb-F=KJR0=nA1uyFWpmA07Aijb7XKEZSig@mail.gmail.com>
Message-ID: <5254FB81.70200@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1



On 10/09/2013 05:23 AM, ?? wrote:
> Dear all,
> 
> I'm a newer to spatio-temporal analysis though I am quite familiar
> with spatial one. When coming to spatio-temoral prediction using
> krigeST, I have some queries as follows:
> 
> 1. it seems that the krigeST can only deal with data with full
> layout format (e.g., STFDF class), however our data in practice,
> which is often the case, come with sparse format (e.g., STSDF
> class) because of different No. of samples in each time point or
> missing values. Under this circumstance, I mean only with STSDF
> class, what I can do if I still want to make spatio-temporal
> prediction? just sort out a  STFDF format from the available data?
> or else
> 

please look at the development version of gstat at
https://r-forge.r-project.org/R/?group_id=378
and in particular demo(localKrigeST) -- we addressed this issue on a
hackaton three weeks ago, and you're welcome to test ;-)

> 2. I happened to see a replying email by Edzer to someone which
> said krigeST was designed to exploit separaility of spatio-temporal
> covariance models. If this is the case, what dose other types of
> spatio-temporal variogram (e.g., productSum, sumMetric, and
> simpleSumMetric) mean? Do them predict with a jiont spatio-temporal
> covariance? if so, why one needs to specify purely spatial and
> temporal variogram if the jiont spatio-temporal covariance is
> specified?

This was true for the first incarnation of krigeST; now it supports
more ST variogram model classes, many of which are non-separable. Look
at (the examples of) ?vgmST to see how they work.

> 
> 3. In terms of specification of arguments in vgmST, it seems to be
> too subjective to specify arguments for varigram of space and time,
> for example, time = vgm(1, "Exp", 1.5 * 3600 * 24)). How could I
> know range, sill, or nugget for the varigram?

This is a modelling / inference question. I will not go any further
here than saying that this is not trivial. Some hints at what you can
do with gstat are found in the package vignette("st"). Please don't
complain about the lack of options, but write working and readable
code. If you would contribute it, we will include it and acknowledge you!

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSVPuBAAoJEM1OCHCtOnfxzycH/38pUdCuUY19ijIzgDZuRawk
oLLWEPjlQ8ZiXUjyy6ezUhymL5Lo8n+eVzaoGslm4S7xGesgO9AsfadoiwMRVpX7
yMDRZcrMJ6ZhSOjQv1gCwZsXZnMUkEe75rkxsEjFd2uJDmYXmmUaTQ8EwpXF3L7s
yQSwJ5AQPjB0sIpbl9Q+iiqplNDGLt/dPrnPPVGlC5PpcIcgZIU+Tb2KuIIryzu/
7aW/jdG18aM3z0Ofj7sok6h6UmyoZXASiOTM+Jdc411/OQHRPgYZV+Eo4lQTU+3y
sZS6yVvGw/F4qG2fhkAdGlZg/n6OL3T6EpH2dBkIsm5gY+jToQAGlRBK+gFgkUg=
=gwcm
-----END PGP SIGNATURE-----


From dorothea.lemke at uni-muenster.de  Wed Oct  9 09:40:05 2013
From: dorothea.lemke at uni-muenster.de (Dorothea Lemke)
Date: Wed, 09 Oct 2013 09:40:05 +0200 (CEST)
Subject: [R-sig-Geo] Empirical Bayes smoothing (DCluster)
Message-ID: <permail-201310090740058954262000005762-dlemk_01@message-id.uni-muenster.de>

Dear list,


I have used both of the empirical Bayes smoothing models (Poisson-Gamma and
Log-normal) implemented in the package DCLuster for smoothing disease risk
in
a study region.
But I wonder if there is a function where the local mean can be used
instead of
the global mean in order to smooth the estimates.

Many thanks in advance.
Dorothea

-- 
Dorothea Lemke
Institute for Epidemiology and Social Medicine
Albert-Schweitzer-Campus 1, Building D3
D-48149 M?nster

Fon: +49(0)251/83 58338
Email: dorothea.lemke at uni-muenster.de


From seth at swbigelow.net  Wed Oct  9 13:32:36 2013
From: seth at swbigelow.net (Seth Bigelow)
Date: Wed, 9 Oct 2013 07:32:36 -0400
Subject: [R-sig-Geo] random sampling along contour
Message-ID: <000301cec4e3$418664b0$c4932e10$@net>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131009/168a938c/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Wed Oct  9 14:18:17 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 9 Oct 2013 13:18:17 +0100
Subject: [R-sig-Geo] random sampling along contour
In-Reply-To: <2873d3801be147779c79b0483f2c00cd@EX-1-HT0.lancs.local>
References: <2873d3801be147779c79b0483f2c00cd@EX-1-HT0.lancs.local>
Message-ID: <CANVKczM5oELtJjDbSBqO+iNg+RVN4RDzxErzrhusWDsh3PpMqg@mail.gmail.com>

On Wed, Oct 9, 2013 at 12:32 PM, Seth Bigelow <seth at swbigelow.net> wrote:
> Hello all:
>
>
>
> I wish to place sampling plots at regular elevation intervals up a mountain.
> Plot centers should be placed at random within a 100 m wide transect along
> the contour. Can anyone suggest an efficient way of doing this? Code below
> places plots on a single transect on the volcano dataset, but does not do
> the 'along the contour' randomization.

 I'm not clear what you mean here, the plot is a big help though and
+1 for that.

 By "a 100m wide transect along the contour" do you mean plus or minus
up to 50m either side of the points created by your plot, but along
the contour line? In other words, I go to each of those points on your
plot, choose a runif(1,-50,50) and traverse that distance on the
contour line to get my sampling point?

 What if the contour line at that point is a loop less than 100m long?
Do I go around? The other edge case is literally an edge case - when
the contour line hits the edge...

Barry


From seth at swbigelow.net  Wed Oct  9 15:01:10 2013
From: seth at swbigelow.net (Seth Bigelow)
Date: Wed, 9 Oct 2013 09:01:10 -0400
Subject: [R-sig-Geo] random sampling along contour
In-Reply-To: <CANVKczM5oELtJjDbSBqO+iNg+RVN4RDzxErzrhusWDsh3PpMqg@mail.gmail.com>
References: <2873d3801be147779c79b0483f2c00cd@EX-1-HT0.lancs.local>
	<CANVKczM5oELtJjDbSBqO+iNg+RVN4RDzxErzrhusWDsh3PpMqg@mail.gmail.com>
Message-ID: <000801cec4ef$a21e36c0$e65aa440$@net>

Barry,

I do mean exactly what you have stated, i.e., "plus or minus up to 50m
either side of the points created by your plot, but along the contour line?
In other words, I go to each of those points on your plot, choose a
runif(1,-50,50) and traverse that distance on the contour line to get my
sampling point?"

In my real-world application, there do not seem to be either of the 'edge'
issues you raise, since the flank of the mountain I am sampling is not
highly dissected. But if the contour line is a loop, it would be fine to 'go
around', or just throw an 'NA'. Similarly, if the contour line ends, an 'NA'
would be ok.

Thanks for thinking about this!

-Seth Bigelow


-----Original Message-----
From: b.rowlingson at gmail.com [mailto:b.rowlingson at gmail.com] On Behalf Of
Barry Rowlingson
Sent: Wednesday, October 09, 2013 8:18 AM
To: Seth Bigelow
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] random sampling along contour

On Wed, Oct 9, 2013 at 12:32 PM, Seth Bigelow <seth at swbigelow.net> wrote:
> Hello all:
>
>
>
> I wish to place sampling plots at regular elevation intervals up a
mountain.
> Plot centers should be placed at random within a 100 m wide transect 
> along the contour. Can anyone suggest an efficient way of doing this? 
> Code below places plots on a single transect on the volcano dataset, 
> but does not do the 'along the contour' randomization.

 I'm not clear what you mean here, the plot is a big help though and
+1 for that.

 By "a 100m wide transect along the contour" do you mean plus or minus up to
50m either side of the points created by your plot, but along the contour
line? In other words, I go to each of those points on your plot, choose a
runif(1,-50,50) and traverse that distance on the contour line to get my
sampling point?

 What if the contour line at that point is a loop less than 100m long?
Do I go around? The other edge case is literally an edge case - when the
contour line hits the edge...

Barry


From valentina.lauria at nuigalway.ie  Wed Oct  9 15:10:18 2013
From: valentina.lauria at nuigalway.ie (Lauria, Valentina)
Date: Wed, 9 Oct 2013 13:10:18 +0000
Subject: [R-sig-Geo] habitat mapping of sharks
Message-ID: <B11DE93D7F439D4BA1E942572BA750308BC5C917@UDSMBX02.uds.nuigalway.ie>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131009/9276af51/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct  9 16:27:54 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 09 Oct 2013 16:27:54 +0200
Subject: [R-sig-Geo] random sampling along contour
In-Reply-To: <000801cec4ef$a21e36c0$e65aa440$@net>
References: <2873d3801be147779c79b0483f2c00cd@EX-1-HT0.lancs.local>	<CANVKczM5oELtJjDbSBqO+iNg+RVN4RDzxErzrhusWDsh3PpMqg@mail.gmail.com>
	<000801cec4ef$a21e36c0$e65aa440$@net>
Message-ID: <525567EA.8070906@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Seth, after running your script, I tried:

b = gBuffer(t.sl, width = .1, byid=FALSE)
plot(b, col='#ff000088', add=TRUE)
i = gIntersection(b, v.sldf, byid = TRUE)
plot(i, col = 'blue', add=TRUE)
pts = spsample(i[1], n=1, type='random')
l = lapply(1:length(i), function(x) spsample(i[x], n=1, type='random'))
npts = do.call(rbind, l[!sapply(l, is.null)])
plot(npts, add=TRUE, col = 'green')

which goes a fixed distance from the transect, but not a fixed
distance along each contour. Note that you get one point per unique
contour level.


On 10/09/2013 03:01 PM, Seth Bigelow wrote:
> Barry,
> 
> I do mean exactly what you have stated, i.e., "plus or minus up to
> 50m either side of the points created by your plot, but along the
> contour line? In other words, I go to each of those points on your
> plot, choose a runif(1,-50,50) and traverse that distance on the
> contour line to get my sampling point?"
> 
> In my real-world application, there do not seem to be either of the
> 'edge' issues you raise, since the flank of the mountain I am
> sampling is not highly dissected. But if the contour line is a
> loop, it would be fine to 'go around', or just throw an 'NA'.
> Similarly, if the contour line ends, an 'NA' would be ok.
> 
> Thanks for thinking about this!
> 
> -Seth Bigelow
> 
> 
> -----Original Message----- From: b.rowlingson at gmail.com
> [mailto:b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson Sent:
> Wednesday, October 09, 2013 8:18 AM To: Seth Bigelow Cc:
> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] random sampling
> along contour
> 
> On Wed, Oct 9, 2013 at 12:32 PM, Seth Bigelow <seth at swbigelow.net>
> wrote:
>> Hello all:
>> 
>> 
>> 
>> I wish to place sampling plots at regular elevation intervals up
>> a
> mountain.
>> Plot centers should be placed at random within a 100 m wide
>> transect along the contour. Can anyone suggest an efficient way
>> of doing this? Code below places plots on a single transect on
>> the volcano dataset, but does not do the 'along the contour'
>> randomization.
> 
> I'm not clear what you mean here, the plot is a big help though
> and +1 for that.
> 
> By "a 100m wide transect along the contour" do you mean plus or
> minus up to 50m either side of the points created by your plot, but
> along the contour line? In other words, I go to each of those
> points on your plot, choose a runif(1,-50,50) and traverse that
> distance on the contour line to get my sampling point?
> 
> What if the contour line at that point is a loop less than 100m
> long? Do I go around? The other edge case is literally an edge case
> - when the contour line hits the edge...
> 
> Barry
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSVWfqAAoJEM1OCHCtOnfxDnsIAIapaJ3hiSN5D1Y7e4uUEYeH
rg8vvTCCzQjQxc1472wyUZYfK552kUugA+C0IYP97HWAEzMQkkPVI1EFCm2f3Cpo
6OBkSMvfaU+TM/Q7WMnDJqry0AKXXc576fgpAnYXktavgzzuEDbaFg5yAg717ZYz
SBrThQ8b0148DtWEHGsXQbBJvfxQY6ymhlPWBNQD2hKsqN+A/j27RADCdehmDnNk
ZkMUGN2ehxKrX9MrkdNU0JFLr41diKzNeqsULzr4YH2yyzTiQqKsPdF7PvmuEdqK
2tGNpOi2SWimLWcXpdXQ2NqGVhKkPzC5Pj0K4fXBs4n4QES2Q6cc2XgKJOeCaKU=
=qGv9
-----END PGP SIGNATURE-----


From seth at swbigelow.net  Wed Oct  9 17:05:07 2013
From: seth at swbigelow.net (Seth Bigelow)
Date: Wed, 9 Oct 2013 11:05:07 -0400
Subject: [R-sig-Geo] random sampling along contour
In-Reply-To: <525567EA.8070906@uni-muenster.de>
References: <2873d3801be147779c79b0483f2c00cd@EX-1-HT0.lancs.local>	<CANVKczM5oELtJjDbSBqO+iNg+RVN4RDzxErzrhusWDsh3PpMqg@mail.gmail.com>	<000801cec4ef$a21e36c0$e65aa440$@net>
	<525567EA.8070906@uni-muenster.de>
Message-ID: <000301cec500$f23981d0$d6ac8570$@net>

Edzer, totally cool script. Fixed distance from the transect rather than
along contour is absolutely fine. Works like a charm -- thanks a million!

--Seth


-----Original Message-----
From: r-sig-geo-bounces at r-project.org
[mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Wednesday, October 09, 2013 10:28 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] random sampling along contour

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Seth, after running your script, I tried:

b = gBuffer(t.sl, width = .1, byid=FALSE) plot(b, col='#ff000088', add=TRUE)
i = gIntersection(b, v.sldf, byid = TRUE) plot(i, col = 'blue', add=TRUE)
pts = spsample(i[1], n=1, type='random') l = lapply(1:length(i), function(x)
spsample(i[x], n=1, type='random')) npts = do.call(rbind, l[!sapply(l,
is.null)]) plot(npts, add=TRUE, col = 'green')

which goes a fixed distance from the transect, but not a fixed distance
along each contour. Note that you get one point per unique contour level.


On 10/09/2013 03:01 PM, Seth Bigelow wrote:
> Barry,
> 
> I do mean exactly what you have stated, i.e., "plus or minus up to 50m 
> either side of the points created by your plot, but along the contour 
> line? In other words, I go to each of those points on your plot, 
> choose a runif(1,-50,50) and traverse that distance on the contour 
> line to get my sampling point?"
> 
> In my real-world application, there do not seem to be either of the 
> 'edge' issues you raise, since the flank of the mountain I am sampling 
> is not highly dissected. But if the contour line is a loop, it would 
> be fine to 'go around', or just throw an 'NA'.
> Similarly, if the contour line ends, an 'NA' would be ok.
> 
> Thanks for thinking about this!
> 
> -Seth Bigelow
> 
> 
> -----Original Message----- From: b.rowlingson at gmail.com 
> [mailto:b.rowlingson at gmail.com] On Behalf Of Barry Rowlingson Sent:
> Wednesday, October 09, 2013 8:18 AM To: Seth Bigelow Cc:
> r-sig-geo at r-project.org Subject: Re: [R-sig-Geo] random sampling along 
> contour
> 
> On Wed, Oct 9, 2013 at 12:32 PM, Seth Bigelow <seth at swbigelow.net>
> wrote:
>> Hello all:
>> 
>> 
>> 
>> I wish to place sampling plots at regular elevation intervals up a
> mountain.
>> Plot centers should be placed at random within a 100 m wide transect 
>> along the contour. Can anyone suggest an efficient way of doing this? 
>> Code below places plots on a single transect on the volcano dataset, 
>> but does not do the 'along the contour'
>> randomization.
> 
> I'm not clear what you mean here, the plot is a big help though and +1 
> for that.
> 
> By "a 100m wide transect along the contour" do you mean plus or minus 
> up to 50m either side of the points created by your plot, but along 
> the contour line? In other words, I go to each of those points on your 
> plot, choose a runif(1,-50,50) and traverse that distance on the 
> contour line to get my sampling point?
> 
> What if the contour line at that point is a loop less than 100m long? 
> Do I go around? The other edge case is literally an edge case
> - when the contour line hits the edge...
> 
> Barry
> 
> _______________________________________________ R-sig-Geo mailing list 
> R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- --
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Heisenbergstra?e
2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1 -----BEGIN PGP
SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iQEcBAEBAgAGBQJSVWfqAAoJEM1OCHCtOnfxDnsIAIapaJ3hiSN5D1Y7e4uUEYeH
rg8vvTCCzQjQxc1472wyUZYfK552kUugA+C0IYP97HWAEzMQkkPVI1EFCm2f3Cpo
6OBkSMvfaU+TM/Q7WMnDJqry0AKXXc576fgpAnYXktavgzzuEDbaFg5yAg717ZYz
SBrThQ8b0148DtWEHGsXQbBJvfxQY6ymhlPWBNQD2hKsqN+A/j27RADCdehmDnNk
ZkMUGN2ehxKrX9MrkdNU0JFLr41diKzNeqsULzr4YH2yyzTiQqKsPdF7PvmuEdqK
2tGNpOi2SWimLWcXpdXQ2NqGVhKkPzC5Pj0K4fXBs4n4QES2Q6cc2XgKJOeCaKU=
=qGv9
-----END PGP SIGNATURE-----

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From 538280 at gmail.com  Wed Oct  9 17:16:07 2013
From: 538280 at gmail.com (Greg Snow)
Date: Wed, 9 Oct 2013 09:16:07 -0600
Subject: [R-sig-Geo] random sampling along contour
In-Reply-To: <000301cec4e3$418664b0$c4932e10$@net>
References: <000301cec4e3$418664b0$c4932e10$@net>
Message-ID: <CAFEqCdy2w1gh0-Wnbga1FcZY0LEfZfXk622suci5LQAsCTkuCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131009/8d417195/attachment.pl>

From jgrn at illinois.edu  Thu Oct 10 00:28:21 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 9 Oct 2013 17:28:21 -0500
Subject: [R-sig-Geo] Error in SpatialPointsDataFrame(...,match.ID=TRUE)?
Message-ID: <CABG0rfuh7ZUum767LKjWaXpoS3-pvvsxtf5YhaWS9fqW3qzswg@mail.gmail.com>

I am trying to figure out if I'm missing something very obvious, or if
I came across a potentially serious bug.  I'm using examples from
"Applied Spatial Data Analysis with R" to create a
SpatialPointsDataFrame from the (attached) text file which is from
http://www.asdar-book.org/data2ed.php?chapter=1

The issue I'm having is in the creation of
"CRAN_SpatialPointsDataFrame2" which uses a re-ordered dataframe, but
continues to have the same rownames.  You'll see from the final step
that the coordinates are no longer "in sync" (joined properly) to the
data frame.

Ideas?

###

input_file <- "CRAN051001a.txt" # Attached to this message or from
http://www.asdar-book.org/data2ed.php?chapter=1

# import the file
CRAN_df <- read.table(cran_file,header=TRUE)

# Create a coordinate matrix:
CRAN_mat <- cbind(CRAN_df$long, CRAN_df$lat)

# Add rownames:
row.names(CRAN_mat) <- 1:nrow(CRAN_mat)

# Define a CRS:
CRAN_CRS <- CRS("+proj=longlat +ellps=WGS84")

# Create SpatialPointsDataFrame:
CRAN_SpatialPointsDataFrame1 <-
SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df,
proj4string=CRAN_CRS,match.ID=TRUE)

# SpatialPoints coords match the dataframe long and lat:
CRAN_SpatialPointsDataFrame1[1,]

# Reorder the dataframe:
s <- sample(nrow(CRAN_df))
CRAN_df_reordered <- CRAN_df[s,]
rownames(CRAN_df_reordered)
rownames(CRAN_df_reordered["1",])

# Now join using match.ID=TRUE:
CRAN_SpatialPointsDataFrame2 <-
SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df_reordered,
proj4string=CRAN_CRS,match.ID=TRUE)
CRAN_SpatialPointsDataFrame2["1",]
# Not matching!

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
-------------- next part --------------
"place" "north" "east" "loc" "long" "lat"
"Brisbane" "27d28'S" "153d02'E" "Australia" 153.033333333333 -27.4666666666667
"Melbourne" "37d49'S" "144d58'E" "Australia" 144.966666666667 -37.8166666666667
"Wien" "48d13'N" "16d20'E" "Austria" 16.3333333333333 48.2166666666667
"Curitiba" "25d25'S" "49d16'W" "Brazil" -49.2666666666667 -25.4166666666667
"Vi?oza" "20d45'S" "42d52'W" "Brazil" -42.8666666666667 -20.75
"Rio de Janeiro" "22d54'S" "43d12'W" "Brazil" -43.2 -22.9
"Piracicaba" "22d43'S" "47d38'W" "Brazil" -47.6333333333333 -22.7166666666667
"Sa? Paulo" "23d32'S" "46d38'W" "Brazil" -46.6333333333333 -23.5333333333333
"Burnaby" "49d15'N" "122d57'W" "British Columbia (CAN)" -122.95 49.25
"Toronto" "43d39'N" "79d23'W" "Ontario (CAN)" -79.3833333333333 43.65
"Nanjing" "32d03'N" "118d47'E" "China" 118.783333333333 32.05
"Aalborg" "57d03'N" "9d56'E" "Denmark" 9.93333333333333 57.05
"Toulouse" "43d36'N" "1d26'E" "France" 1.43333333333333 43.6
"Lyon" "45d45'N" "4d51'E" "France" 4.85 45.75
"Paris" "48d52'N" "2d20'E" "France" 2.33333333333333 48.8666666666667
"Berlin" "52d30'N" "13d22'E" "Germany" 13.3666666666667 52.5
"Hamburg" "53d33'N" "9d59'E" "Germany" 9.98333333333333 53.55
"K?ln" "50d56'N" "6d59'E" "Germany" 6.98333333333333 50.9333333333333
"Mainz" "50d01'N" "8d16'E" "Germany" 8.26666666666667 50.0166666666667
"M?nchen" "48d08'N" "11d34'E" "Germany" 11.5666666666667 48.1333333333333
"Budapest" "47d30'N" "19d05'E" "Hungary" 19.0833333333333 47.5
"Arezzo" "43d25'N" "11d53'E" "Italy" 11.8833333333333 43.4166666666667
"Ferrara" "44d50'N" "11d35'E" "Italy" 11.5833333333333 44.8333333333333
"Milano" "45d28'N" "9d12'E" "Italy" 9.2 45.4666666666667
"Palermo" "38d07'N" "13d22'E" "Italy" 13.3666666666667 38.1166666666667
"Aizu" "37d30'N" "139d56'E" "Japan" 139.933333333333 37.5
"Tsukuba" "36d13'N" "140d06'E" "Japan" 140.1 36.2166666666667
"Seoul" "37d33'N" "126d58'E" "Korea" 126.966666666667 37.55
"Lublin" "51d15'N" "22d35'E" "Poland" 22.5833333333333 51.25
"Wroclaw" "51d06'N" "17d0'E" "Poland" 17 51.1
"Porto" "41d11'N" "8d36'W" "Portugal" -8.6 41.1833333333333
"Besnica" "46d02'N" "14d49'E" "Slovenia" 14.8166666666667 46.0333333333333
"Ljubljana" "46d03'N" "14d31'E" "Slovenia" 14.5166666666667 46.05
"Cape Town" "33d55'S" "18d22'E" "South Africa" 18.3666666666667 -33.9166666666667
"Grahamstown" "33d19'S" "26d31'E" "South Africa" 26.5166666666667 -33.3166666666667
"Madrid" "40d24'N" "3d41'W" "Spain" -3.68333333333333 40.4
"Z?rich" "47d23'N" "8d32'E" "Switzerland" 8.53333333333333 47.3833333333333
"Bern" "46d57'N" "7d26'E" "Switzerland" 7.43333333333333 46.95
"Bern" "46d57'N" "7d26'E" "Switzerland" 7.43333333333333 46.95
"Istanbul" "41d01'N" "28d58'E" "Turkey" 28.9666666666667 41.0166666666667
"Taichung" "24d09'N" "120d41'E" "Taiwan" 120.683333333333 24.15
"Taipei" "25d03'N" "121d31'E" "Taiwan" 121.516666666667 25.05
"Bristol" "51d27'N" "2d35'W" "England" -2.58333333333333 51.45
"London" "51d30'N" "0d10'W" "England" -0.166666666666667 51.5
"Berkeley, CA" "37d52'N" "122d16'W" "California" -122.266666666667 37.8666666666667
"Los Angeles, CA" "34d03'N" "118d15'W" "California" -118.25 34.05
"Ames, IA" "42d02'N" "93d37'W" "Iowa" -93.6166666666667 42.0333333333333
"Houghton, MI" "47d07'N" "88d34'W" "Michigan" -88.5666666666667 47.1166666666667
"St. Louis, MO" "38d38'N" "90d12'W" "Missouri" -90.2 38.6333333333333
"Chapel Hill, NC" "35d55'N" "79d03'W" "North Carolina" -79.05 35.9166666666667
"Pittsburgh, PA" "40d26'N" "80d0'W" "Pennsylvania" -80 40.4333333333333
"Pittsburgh, PA" "40d26'N" "80d0'W" "Pennsylvania" -80 40.4333333333333
"Dallas, TX" "32d47'N" "96d48'W" "Texas" -96.8 32.7833333333333
"Seattle, WA" "47d36'N" "122d20'W" "Washington" -122.333333333333 47.6

From jgrn at illinois.edu  Thu Oct 10 00:52:13 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 9 Oct 2013 17:52:13 -0500
Subject: [R-sig-Geo] Error in SpatialPointsDataFrame(..., match.ID=TRUE)?
In-Reply-To: <CABG0rfuh7ZUum767LKjWaXpoS3-pvvsxtf5YhaWS9fqW3qzswg@mail.gmail.com>
References: <CABG0rfuh7ZUum767LKjWaXpoS3-pvvsxtf5YhaWS9fqW3qzswg@mail.gmail.com>
Message-ID: <CABG0rft66HaTKjfxONgKtxxPtY6QxO9=H1jk3md4kBLx_CPS7A@mail.gmail.com>

As a follow-up, it appears that the requirement in
SpatialPointsDataFrame is not that the rownames not be NULL, but that
it be a character.  The line that appears to be causing the issue is:

if (match.ID && is.character(attr(data, "row.names"))) {


Note that in the above example:

is.character(attr(CRAN_df_reordered, "row.names"))
# is FALSE, but:
is.character(rownames(CRAN_df_reordered))
# is TRUE

It appears that data.frames have numeric row names that are allowed to
be re-ordered just like a character row name, so it seems like this
error could be fixed by modding SpatialPointsDataFrame to be:

if (match.ID && is.character(rownames(data)) {

--j

On Wed, Oct 9, 2013 at 5:28 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> I am trying to figure out if I'm missing something very obvious, or if
> I came across a potentially serious bug.  I'm using examples from
> "Applied Spatial Data Analysis with R" to create a
> SpatialPointsDataFrame from the (attached) text file which is from
> http://www.asdar-book.org/data2ed.php?chapter=1
>
> The issue I'm having is in the creation of
> "CRAN_SpatialPointsDataFrame2" which uses a re-ordered dataframe, but
> continues to have the same rownames.  You'll see from the final step
> that the coordinates are no longer "in sync" (joined properly) to the
> data frame.
>
> Ideas?
>
> ###
>
> input_file <- "CRAN051001a.txt" # Attached to this message or from
> http://www.asdar-book.org/data2ed.php?chapter=1
>
> # import the file
> CRAN_df <- read.table(cran_file,header=TRUE)
>
> # Create a coordinate matrix:
> CRAN_mat <- cbind(CRAN_df$long, CRAN_df$lat)
>
> # Add rownames:
> row.names(CRAN_mat) <- 1:nrow(CRAN_mat)
>
> # Define a CRS:
> CRAN_CRS <- CRS("+proj=longlat +ellps=WGS84")
>
> # Create SpatialPointsDataFrame:
> CRAN_SpatialPointsDataFrame1 <-
> SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df,
> proj4string=CRAN_CRS,match.ID=TRUE)
>
> # SpatialPoints coords match the dataframe long and lat:
> CRAN_SpatialPointsDataFrame1[1,]
>
> # Reorder the dataframe:
> s <- sample(nrow(CRAN_df))
> CRAN_df_reordered <- CRAN_df[s,]
> rownames(CRAN_df_reordered)
> rownames(CRAN_df_reordered["1",])
>
> # Now join using match.ID=TRUE:
> CRAN_SpatialPointsDataFrame2 <-
> SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df_reordered,
> proj4string=CRAN_CRS,match.ID=TRUE)
> CRAN_SpatialPointsDataFrame2["1",]
> # Not matching!
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From Roger.Bivand at nhh.no  Thu Oct 10 10:19:10 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 10 Oct 2013 10:19:10 +0200
Subject: [R-sig-Geo] Error in SpatialPointsDataFrame(..., match.ID=TRUE)?
In-Reply-To: <CABG0rft66HaTKjfxONgKtxxPtY6QxO9=H1jk3md4kBLx_CPS7A@mail.gmail.com>
References: <CABG0rfuh7ZUum767LKjWaXpoS3-pvvsxtf5YhaWS9fqW3qzswg@mail.gmail.com>
	<CABG0rft66HaTKjfxONgKtxxPtY6QxO9=H1jk3md4kBLx_CPS7A@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310100957280.1741@reclus.nhh.no>

On Thu, 10 Oct 2013, Jonathan Greenberg wrote:

> As a follow-up, it appears that the requirement in
> SpatialPointsDataFrame is not that the rownames not be NULL, but that
> it be a character.  The line that appears to be causing the issue is:
>
> if (match.ID && is.character(attr(data, "row.names"))) {
>
>
> Note that in the above example:
>
> is.character(attr(CRAN_df_reordered, "row.names"))
> # is FALSE, but:
> is.character(rownames(CRAN_df_reordered))
> # is TRUE
>
> It appears that data.frames have numeric row names that are allowed to
> be re-ordered just like a character row name, so it seems like this
> error could be fixed by modding SpatialPointsDataFrame to be:
>
> if (match.ID && is.character(rownames(data)) {

OK. Only use row.names() unless the object is a matrix, rownames() are by 
intention for matrices only.

This is handled in R-forge SVN revision 1470 of September 18. Always state 
your sessionInfo() when reporting a problem, until sp 1.0-13, the code on 
p. 34 of the book worked correctly, and should work correctly if you 
install the development version:

install.packages("sp", repos="http://R-Forge.R-project.org")

For details see:

https://r-forge.r-project.org/scm/viewvc.php/pkg/sp/R/SpatialPointsDataFrame-methods.R?root=rspatial&r1=1461&r2=1470

I've added an erratum on the book website to explain.

Roger

>
> --j
>
> On Wed, Oct 9, 2013 at 5:28 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
>> I am trying to figure out if I'm missing something very obvious, or if
>> I came across a potentially serious bug.  I'm using examples from
>> "Applied Spatial Data Analysis with R" to create a
>> SpatialPointsDataFrame from the (attached) text file which is from
>> http://www.asdar-book.org/data2ed.php?chapter=1
>>
>> The issue I'm having is in the creation of
>> "CRAN_SpatialPointsDataFrame2" which uses a re-ordered dataframe, but
>> continues to have the same rownames.  You'll see from the final step
>> that the coordinates are no longer "in sync" (joined properly) to the
>> data frame.
>>
>> Ideas?
>>
>> ###
>>
>> input_file <- "CRAN051001a.txt" # Attached to this message or from
>> http://www.asdar-book.org/data2ed.php?chapter=1
>>
>> # import the file
>> CRAN_df <- read.table(cran_file,header=TRUE)
>>
>> # Create a coordinate matrix:
>> CRAN_mat <- cbind(CRAN_df$long, CRAN_df$lat)
>>
>> # Add rownames:
>> row.names(CRAN_mat) <- 1:nrow(CRAN_mat)
>>
>> # Define a CRS:
>> CRAN_CRS <- CRS("+proj=longlat +ellps=WGS84")
>>
>> # Create SpatialPointsDataFrame:
>> CRAN_SpatialPointsDataFrame1 <-
>> SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df,
>> proj4string=CRAN_CRS,match.ID=TRUE)
>>
>> # SpatialPoints coords match the dataframe long and lat:
>> CRAN_SpatialPointsDataFrame1[1,]
>>
>> # Reorder the dataframe:
>> s <- sample(nrow(CRAN_df))
>> CRAN_df_reordered <- CRAN_df[s,]
>> rownames(CRAN_df_reordered)
>> rownames(CRAN_df_reordered["1",])
>>
>> # Now join using match.ID=TRUE:
>> CRAN_SpatialPointsDataFrame2 <-
>> SpatialPointsDataFrame(coords=CRAN_mat,data=CRAN_df_reordered,
>> proj4string=CRAN_CRS,match.ID=TRUE)
>> CRAN_SpatialPointsDataFrame2["1",]
>> # Not matching!
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Bastien.Ferland-Raymond at mrn.gouv.qc.ca  Thu Oct 10 14:29:34 2013
From: Bastien.Ferland-Raymond at mrn.gouv.qc.ca (Bastien.Ferland-Raymond at mrn.gouv.qc.ca)
Date: Thu, 10 Oct 2013 08:29:34 -0400
Subject: [R-sig-Geo] as.data.frame excluding NA in raster package
Message-ID: <161DC602615F6943A19BAEA3DBF2E4B901B21676EA23@HARFANG.intranet.mrn.gouv>

Dear R Geoer,

This is more a request than a question as I already succeeded at doing what I wanted to do. However, I'm open to suggestion to do it better, but I really think is would be a nice feature to add the the as.data.frame() function in the raster package.

I've been using the as.data.frame() function recently to extract data from rasterbrick to be incorporated into different models (knn, lm, kmeans, etc.).  My raster is usually full of NA (the border and exclusion inside) which I have to remove before doing my models.  The problem is that my raster is so big that I often cannot just do a simple :

tab <- as.data.frame(r)
tab <- tab[!is.na(tab[,1]]

as it break at the first line for lack of memory.  Therefore, I think it would be useful to have a new argument to as.data.frame() like "exclude.na=T" so it already ignore the NA while creating the data.frame.  In some situations, it may allow us to work with raster a little bigger.

As I said, I did manage to do that (see code below).  However my code is probably not as efficient as if a pro-coder would have done it and I still think it would be a great addition the the as.data.frame() function:

###
library(raster)

# preparing the raster
r <- raster(nrow=1000, ncol=1000, xmn=0, xmx=1000, ymn=0, ymx=1000, crs=NA)
dat <- rep(NA, 1e+06)
dat[sample(1:1e+06, 2000)] <- runif(2000,0,1)
values(r) <- dat
plot(r)

# the traditional function
tab1 <- as.data.frame(r)
object.size(tab1)

# my modified as.data.frame function
# I have to tile the territory because if I don't, I have the same problem as the as.data.frame() function
as.df.no.na <- function(ras, nb.tuile){
tabfin <- as.data.frame(matrix(NA, 0,nlayers(ras), dimnames=list(NULL,names(ras))))
coupe <- c(0,round(nrow(ras)/nb.tuile)*(1:(nb.tuile-1)),nrow(ras))
for(i in 1:nb.tuile){
  mat <- getValues(ras, coupe[i]+1,coupe[i+1]-coupe[i])
  tab <- data.frame(mat,row.names=(coupe[i]*ncol(ras)+1):(coupe[i+1]*ncol(ras)))
  tabfin <- rbind(tabfin,tab[!is.na(tab[,1]),,drop=F])
}
tabfin
}

tab2 <- as.df.no.na(ras=r, nb.tuile=10)
object.size(tab2)
###

There!  Anybody thinks it like me that it would be a great addition or knows a better way to do it?  Could it be implemented in the raster package? Robert?  Thanks!

Bastien Ferland-Raymond, M.Sc. Stat., M.Sc. Biol.
Division des orientations et projets sp?ciaux
Direction des inventaires forestiers
Minist?re des Ressources naturelles


From virgilio.gomez at uclm.es  Thu Oct 10 20:00:37 2013
From: virgilio.gomez at uclm.es (Virgilio =?ISO-8859-1?Q?G=F3mez-Rubio?=)
Date: Thu, 10 Oct 2013 20:00:37 +0200
Subject: [R-sig-Geo] Empirical Bayes smoothing (DCluster)
In-Reply-To: <permail-201310090740058954262000005762-dlemk_01@message-id.uni-muenster.de>
References: <permail-201310090740058954262000005762-dlemk_01@message-id.uni-muenster.de>
Message-ID: <1381428037.5179.26.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>

Dear Dorothea,


> I have used both of the empirical Bayes smoothing models (Poisson-Gamma and
> Log-normal) implemented in the package DCLuster for smoothing disease risk
> in
> a study region.
> But I wonder if there is a function where the local mean can be used
> instead of
> the global mean in order to smooth the estimates.

You can use EBlocal() in spdep to achieve local smoothing.

Best wishes,

Virgilio


From rahmannorthampton at gmail.com  Fri Oct 11 15:33:19 2013
From: rahmannorthampton at gmail.com (Lutfor)
Date: Fri, 11 Oct 2013 06:33:19 -0700 (PDT)
Subject: [R-sig-Geo] KernelUD image scale bar
In-Reply-To: <5246067E.1000700@ase-research.org>
References: <1380318268984-7584738.post@n2.nabble.com>
	<5246067E.1000700@ase-research.org>
Message-ID: <1381498399503-7584838.post@n2.nabble.com>

Dear Mathieu,

Thank you very much for your kind help.
That's really help me.
However, I would like create contour map as shown in the image (which I
managed to do). Here, I would like to put scale bar onto the image to show
what are distance between points.



<http://r-sig-geo.2731867.n2.nabble.com/file/n7584838/Contour_Map.jpg> 


Would it be possible to help me in this regard.

Kind regards
Lutfor



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/KernelUD-image-scale-bar-tp7584738p7584838.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From basille.web at ase-research.org  Fri Oct 11 16:39:08 2013
From: basille.web at ase-research.org (Mathieu Basille)
Date: Fri, 11 Oct 2013 10:39:08 -0400
Subject: [R-sig-Geo] KernelUD image scale bar
In-Reply-To: <1381498399503-7584838.post@n2.nabble.com>
References: <1380318268984-7584738.post@n2.nabble.com>	<5246067E.1000700@ase-research.org>
	<1381498399503-7584838.post@n2.nabble.com>
Message-ID: <52580D8C.1020701@ase-research.org>

Maybe have a look at the sp.layout argument, together with the key.space 
argument. For example:

http://rspatial.r-forge.r-project.org/gallery/#fig03.R

But I'm definitely no sp expert... Not sure I can help more than that.
Mathieu.


Le 10/11/2013 09:33 AM, Lutfor a ?crit :
> Dear Mathieu,
>
> Thank you very much for your kind help.
> That's really help me.
> However, I would like create contour map as shown in the image (which I
> managed to do). Here, I would like to put scale bar onto the image to show
> what are distance between points.
>
>
>
> <http://r-sig-geo.2731867.n2.nabble.com/file/n7584838/Contour_Map.jpg>
>
>
> Would it be possible to help me in this regard.
>
> Kind regards
> Lutfor
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/KernelUD-image-scale-bar-tp7584738p7584838.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 

~$ whoami
Mathieu Basille, PhD

~$ locate --details
University of Florida \\
Fort Lauderdale Research and Education Center
(+1) 954-577-6314
http://ase-research.org/basille

~$ fortune
? Le tout est de tout dire, et je manque de mots
Et je manque de temps, et je manque d'audace. ?
  -- Paul ?luard


From mspinola10 at gmail.com  Fri Oct 11 18:13:16 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 11 Oct 2013 10:13:16 -0600
Subject: [R-sig-Geo] How can I see all the levels of my shapefile with the
	function summary?
Message-ID: <CABkCotQMSquytieociydLfiuY++oS+_MBACsbE5Z8BTC+nyiZQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131011/2049e831/attachment.pl>

From tephilippi at gmail.com  Fri Oct 11 18:27:39 2013
From: tephilippi at gmail.com (Tom Philippi)
Date: Fri, 11 Oct 2013 09:27:39 -0700
Subject: [R-sig-Geo] How can I see all the levels of my shapefile with
 the function summary?
In-Reply-To: <CABkCotQMSquytieociydLfiuY++oS+_MBACsbE5Z8BTC+nyiZQ@mail.gmail.com>
References: <CABkCotQMSquytieociydLfiuY++oS+_MBACsbE5Z8BTC+nyiZQ@mail.gmail.com>
Message-ID: <CALyPt8zF_cFEJNTYQeQGmJ9RVRAghJx6e+FNCr-gqtD5U5vFCQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131011/8b0870c1/attachment.pl>

From mspinola10 at gmail.com  Fri Oct 11 18:53:42 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Fri, 11 Oct 2013 10:53:42 -0600
Subject: [R-sig-Geo] How can I see all the levels of my shapefile with
 the function summary?
In-Reply-To: <CALyPt8zF_cFEJNTYQeQGmJ9RVRAghJx6e+FNCr-gqtD5U5vFCQ@mail.gmail.com>
References: <CABkCotQMSquytieociydLfiuY++oS+_MBACsbE5Z8BTC+nyiZQ@mail.gmail.com>
	<CALyPt8zF_cFEJNTYQeQGmJ9RVRAghJx6e+FNCr-gqtD5U5vFCQ@mail.gmail.com>
Message-ID: <CABkCotQO3Hi_=Tm2pO4T0kRNRML9JybO4-k9EKviy1fGo2MTLQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131011/dd719e21/attachment.pl>

From simone.ruzza12 at gmail.com  Sun Oct 13 12:48:57 2013
From: simone.ruzza12 at gmail.com (Simone Ruzza)
Date: Sun, 13 Oct 2013 12:48:57 +0200
Subject: [R-sig-Geo] Moran's correlogram for spatio-temporal data
Message-ID: <CADZVqoYtw0bbfurnuJNAQeATZFteSsEf_VY659VA0h7ggWqk4g@mail.gmail.com>

Dear list,

apologies for the total beginner's question. I was wondering whether
there is some function to compute the Moran's correlogram (e.g.
sp.correlogram) for spatio-temporal data?

thanks in advance,

Simone


From abdelrazek at uni-bonn.de  Sun Oct 13 15:45:00 2013
From: abdelrazek at uni-bonn.de (Mohammad Abdel-Razek)
Date: Sun, 13 Oct 2013 15:45:00 +0200
Subject: [R-sig-Geo] MODIS EVI time series missing data interpolation
	(linear or whittaker.raster)
Message-ID: <525AA3DC.8090609@uni-bonn.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131013/1e161db3/attachment.pl>

From milan.cisty at stuba.sk  Mon Oct 14 14:08:21 2013
From: milan.cisty at stuba.sk (Milan Cisty)
Date: Mon, 14 Oct 2013 14:08:21 +0200
Subject: [R-sig-Geo] slope length
Message-ID: <006001cec8d6$13823520$3a869f60$@stuba.sk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/c89a21a0/attachment.pl>

From dorothea.lemke at uni-muenster.de  Mon Oct 14 14:53:39 2013
From: dorothea.lemke at uni-muenster.de (Dorothea Lemke)
Date: Mon, 14 Oct 2013 14:53:39 +0200 (CEST)
Subject: [R-sig-Geo] Empirical Bayes smoothing (DCluster)
In-Reply-To: <1381428037.5179.26.camel@virgil-HP-Compaq-8000-Elite-USDT-PC>
Message-ID: <permail-20131014125339fe5316b600000c6b-dlemk_01@message-id.uni-muenster.de>

Dear Virgilio,

many thanks for your fast response - this helps a lot. I have another
question concerning the
EBlocal-function: Is there a way to calculate the confidence interval
for the risk estimates?

Thank you very much in advance
Dorothea

Virgilio G?mez-Rubio schrieb am 2013-10-10:
> Dear Dorothea,


> > I have used both of the empirical Bayes smoothing models
> > (Poisson-Gamma and
> > Log-normal) implemented in the package DCLuster for smoothing
> > disease risk
> > in
> > a study region.
> > But I wonder if there is a function where the local mean can be
> > used
> > instead of
> > the global mean in order to smooth the estimates.

> You can use EBlocal() in spdep to achieve local smoothing.

> Best wishes,

> Virgilio

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dorothea Lemke
Institute for Epidemiology and Social Medicine
Albert-Schweitzer-Campus 1, Building D3
D-48149 M?nster

Fon: +49(0)251/83 58338
Email: dorothea.lemke at uni-muenster.de


From eddieatr at gmail.com  Mon Oct 14 18:13:46 2013
From: eddieatr at gmail.com (Eddie Smith)
Date: Mon, 14 Oct 2013 17:13:46 +0100
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
Message-ID: <CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/977b56a6/attachment.pl>

From r.hijmans at gmail.com  Mon Oct 14 19:06:20 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 14 Oct 2013 10:06:20 -0700
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
	<CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
Message-ID: <CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>

Eddie,

stackApply is not the appropriate function in this case (stackApply is
equivalent to tapply or aggregate for a matrix; see the manual),
although you could make it do what you want trough
"indices=1:nlayers(s)", but that is rather inefficient. Instead, to
get the max value of cells across layers, you can do:

s <- stack(system.file("external/rlogo.grd", package="raster"))
m <- max(s, na.rm=TRUE)

or

m2 <-  calc(s, max, na.rm=TRUE)

Robert



On Mon, Oct 14, 2013 at 9:13 AM, Eddie Smith <eddieatr at gmail.com> wrote:
> Thanks again Agustin.
>
> The code works fine for 5 raster layers.
>
> library(raster)
> img <- list.files(pattern='\\.img$')
> s <- stack(img)
> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>
> class       : RasterLayer
> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0
> data source : in memory
> names       : layer
> values      : 12.48, 34.35  (min, max)
>
>
> Just wondering if I have hundreds of raster layer in a folder.
>
> I tried mx <- stackApply(s,indices=c(1:5),max) but it gave me different
> result
>
> class       : RasterBrick
> dimensions  : 1032, 1656, 1708992, 5  (nrow, ncol, ncell, nlayers)
> resolution  : 0.04166667, 0.04166667  (x, y)
> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0
> data source : in memory
> names       : layer.1, layer.2, layer.3, layer.4, layer.5
> min values  :   16.75,   16.26,   15.00,   12.48,   15.00
> max values  :   34.35,   34.02,   32.88,   33.48,   34.05
>
> Anyone?
>
> Thanks in advance.
>
>
>
>
>
>
>
> On Tue, Oct 8, 2013 at 9:17 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> Eddie,
>> (I'm answering through the list, perhaps somebody else is interested)
>>
>> You need one element in "indices" for each input layer, so if you have
>> 5 layers you should use
>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>> The actual value of each index indicates to which output layer that
>> input layer is contributing.
>> In your case, there is only one output layer, thus all values must be
>> 1. But see the
>> help page for an example with different index values.
>>
>> Agus
>>
>> On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es>
>> wrote:
>> > ---------- Forwarded message ----------
>> > From: Eddie Smith <eddieatr at gmail.com>
>> > Date: Tue, Oct 8, 2013 at 7:40 PM
>> > Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
>> > To: Agustin.Lobo at ictja.csic.es
>> >
>> >
>> > Dear Agus,
>> >
>> > Thank you very much for your reply. Your script below is working
>> > however, would you mind if I ask a basic question on what is the
>> > purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
>> > and the error message is
>> >> mx <- stackApply(s,indices=c(1,1),max)
>> > Warning message:
>> > In stackApply(s, indices = c(1, 1), max) :
>> >   number of items to replace is not a multiple of replacement length
>> >
>> > I am sorry if my question is too basic. I am new to R.
>> >
>> > Thank you.
>> >
>> > library(raster)
>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>> > s <- stack(r1,r2)
>> > mx <- stackApply(s,indices=c(1,1),max)
>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>> >
>> >
>> > On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com>
>> wrote:
>> >>
>> >> oops, copied the wrong line,
>> >> it must be
>> >> mx <- stackApply(s,indices=c(1,1),max)
>> >>
>> >> Agus
>> >>
>> >>
>> >> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com>
>> wrote:
>> >> > What about this:
>> >> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>> >> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>> >> > s <- stack(r1,r2)
>> >> > mx <- stackApply(s,max)
>> >> >
>> >> > which.max() fails because raster requires the na.rm argument (I
>> think, Robert?)
>> >> >
>> >> > mxd <- stackApply(s,indices=c(1,1),which.max)
>> >> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>> >> >
>> >> > so make your own function icluding the na.rm argument:
>> >> >
>> >> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>> >> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>> >> >
>> >> > Agus
>> >> >
>> >> >
>> >> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com>
>> wrote:
>> >> >> Dear list,
>> >> >>
>> >> >> I have a RasterLayer that contains 365 bands with a dimension of
>> 1032,
>> >> >> 1656, 1708992  (nrow, ncol, ncell).
>> >> >>
>> >> >> library(raster)
>> >> >> img <- list.files(pattern='\\.img$')
>> >> >> stack <- stack(img)
>> >> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>> >> >> overwrite=TRUE)
>> >> >>
>> >> >> 1. How could I produce a raster layer that contains a maximum value
>> from
>> >> >> 365 bands for each pixel?
>> >> >> I tried maxValue() but that only give me a maximum value for each
>> band.
>> >> >>
>> >> >> 2. If I manage to do step 1, is it possible to know from which band
>> is
>> >> >> actually the maximum value originate?
>> >> >>
>> >> >>         [[alternative HTML version deleted]]
>> >> >>
>> >> >> _______________________________________________
>> >> >> R-sig-Geo mailing list
>> >> >> R-sig-Geo at r-project.org
>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> >
>> >
>> >
>> > --
>> > --
>> > Dr. Agustin Lobo
>> > Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>> > Lluis Sole Sabaris s/n
>> > 08028 Barcelona
>> > Spain
>> > Tel. 34 934095410
>> > Fax. 34 934110012
>> > e-mail Agustin.Lobo at ictja.csic.es
>>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jbechara at lri-lb.org  Mon Oct 14 19:25:06 2013
From: jbechara at lri-lb.org (jbechara)
Date: Mon, 14 Oct 2013 20:25:06 +0300
Subject: [R-sig-Geo] Shape file big size
Message-ID: <9mjlmtcibqkcncf7yvvvy59m.1381771506499@email.android.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/14d3ac4c/attachment.pl>

From geponce at gmail.com  Mon Oct 14 20:04:58 2013
From: geponce at gmail.com (Guillermo E. Ponce-Campos)
Date: Mon, 14 Oct 2013 11:04:58 -0700
Subject: [R-sig-Geo] Plotting NetCDF layer over a map as a raster...
Message-ID: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/31092d5b/attachment.pl>

From danielvdelatorre at gmail.com  Mon Oct 14 22:17:16 2013
From: danielvdelatorre at gmail.com (=?ISO-8859-1?Q?Daniel_Varaj=E3o_de_Latorre?=)
Date: Mon, 14 Oct 2013 17:17:16 -0300
Subject: [R-sig-Geo] Mollweide Raster projection
Message-ID: <CAOtDXvAtT+Vi8-0mP7H5+v_2FphGFW7BXRNn5MjwQUs0d0pOAw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/c3b205b4/attachment.pl>

From r.hijmans at gmail.com  Tue Oct 15 06:51:31 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 14 Oct 2013 21:51:31 -0700
Subject: [R-sig-Geo] Mollweide Raster projection
In-Reply-To: <CAOtDXvAtT+Vi8-0mP7H5+v_2FphGFW7BXRNn5MjwQUs0d0pOAw@mail.gmail.com>
References: <CAOtDXvAtT+Vi8-0mP7H5+v_2FphGFW7BXRNn5MjwQUs0d0pOAw@mail.gmail.com>
Message-ID: <CANtt_hzMuJE08j3CU5X235wTTVumtfbf7FJQ3KDxkpgRCqJaQg@mail.gmail.com>

Daniel,

You can fix this with the "over" argument

grid_moll<-projectRaster(grid, crs=moll_crs, over=T)

On Mon, Oct 14, 2013 at 1:17 PM, Daniel Varaj?o de Latorre
<danielvdelatorre at gmail.com> wrote:
> Hi all,
>
> I've been trying to use mollweide projection on a raster of the world and
> something is going weird.
> The problem (which can be seen in the plot) is that there are cells out of
> the map bounds (extent?).
> Probably due to the warning I get on the projectRaster() function:
>
> In rgdal:::.gd_transform(projto_int, projfrom, nrow(xy), xy[, 1],  :
>   3730 projected point(s) not finite
>
> I used the following code:
>
> library(raster)
> library(mapproj)
> library(maptools)
> library(rgdal)
> data(wrld_simpl)
>
> r<-raster(nrows=180, ncols=360, xmn=-180, xmx=180, ymn=-90, ymx=90)
> r[]<-1:ncell(r)
>
> r[]<-0
>
> grid<-rasterize(x=wrld_simpl, y=r)
> grid[grid>=1]<-1
> grid[grid==0]<-NA
>
> moll_crs<-"+proj=moll +ellps=WGS84"
> grid_moll<-projectRaster(grid, crs=moll_crs)
> plot(grid_moll)
> plot(wrld_simpl_Mollweide, add=T)
>
> Is there any mistake??
>
> Thanks in advance
> Daniel
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From r.hijmans at gmail.com  Tue Oct 15 07:08:26 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Mon, 14 Oct 2013 22:08:26 -0700
Subject: [R-sig-Geo] Plotting NetCDF layer over a map as a raster...
In-Reply-To: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>
References: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>
Message-ID: <CANtt_hykupC58+khVLyfGCB1xuJiDVmFJD2qMsHQB=TdmvpTTw@mail.gmail.com>

It seems that the files has other variables than lon & lat that are
used. It looks like a projection is used, but then again, the axes
range suggests lon/lat. Can you show more info about the file contents
(e.g.  print(varRaster) ) or str(ex.nc).
Even better if you can make the file available to me. In principle you
can of course make a RasterLayer from your x, y and z, particularly if
x and y are regularly spaced.
Robert

On Mon, Oct 14, 2013 at 11:04 AM, Guillermo E. Ponce-Campos
<geponce at gmail.com> wrote:
> Hello:
>
> I have been trying to plot a netcdf layer as a raster and have found one
> single issue that I'd like know if I'm doing something wrong.  If I use the
> function "image" from raster package there's no problem at all, the thing
> is that I would like to handle this layer as a raster and be able to map it
> correctly or save it as a geotif.
>
> This is an example using both approaches to map the netcdf layer: as a
> raster and using "image(x,y,z...).
>
> library(ncdf)
>
> library(maptools)
>
> library(raster)
>
> varRaster<-raster("SMOS_File.nc", varname="Soil_Moisture")
>
> plot(varRaster)
> data(wrld_simpl)
> plot(wrld_simpl, add = TRUE)
>
> # Resulting plot (some offset is occurring by opening the layer as a raster
>  --> http://bit.ly/19IFfA2
>
>
> #Using "image" there's no problem...
>
> ex.nc = open.ncdf("SMOS_File.nc")
>
> print(ex.nc)
> summary(ex.nc)
> y = get.var.ncdf( ex.nc, "lat")
> x = get.var.ncdf( ex.nc, "lon")
> z = get.var.ncdf( ex.nc, "Soil_Moisture")
>
> image(x,y,z, zlim=c(-0.9,1), col = heat.colors(37))
> plot(wrld_simpl, add = TRUE)
>
> # Resulting plot --> http://bit.ly/1cJ0vXo
>
> Is there anyway to handle the netcdf layer as a raster and be able to map
> it correctly.  I already tried to write the raster as a geotif and open it
> in other software such as GRASS or ArcMap and is still showing up with the
> offset.
>
>
> Thanks for any help with this.
> Guillermo
>
> --
> *Guillermo E. Ponce-Campos*
> *PGP Key ID*: 0x57EDC060
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From geponce at gmail.com  Tue Oct 15 08:22:44 2013
From: geponce at gmail.com (Guillermo E. Ponce-Campos)
Date: Mon, 14 Oct 2013 23:22:44 -0700
Subject: [R-sig-Geo] Plotting NetCDF layer over a map as a raster...
In-Reply-To: <CANtt_hykupC58+khVLyfGCB1xuJiDVmFJD2qMsHQB=TdmvpTTw@mail.gmail.com>
References: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>
	<CANtt_hykupC58+khVLyfGCB1xuJiDVmFJD2qMsHQB=TdmvpTTw@mail.gmail.com>
Message-ID: <CAGKzJ7oAnjdtCWa0Tbesjk1HBbp5_=kGTKzmCHQdVCy6DXgC9w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131014/b039fe10/attachment.pl>

From alobolistas at gmail.com  Tue Oct 15 10:06:17 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 15 Oct 2013 10:06:17 +0200
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
	<CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
	<CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>
Message-ID: <CAG4NReLFGV9R2UeybCxrLF00JVGfy-d==F6TM==QDP5g+h5Ohg@mail.gmail.com>

Eddie:

Please note "You need one element in "indices" for each input layer"
and do read the help page.

Robert: yo made a typo right? it is not "indices=1:nlayers(s)", but
"indices=rep(1,nlayers(s))" ?

i.e:
r1 <- raster(matrix((1:9),3,3))
r2 <- raster(matrix(sample(1:9,9),3,3))
r3 <- raster(matrix(sample(1:9,9),3,3))
s <- stack(r1,r2,r3)
as.array(s)
mx <- stackApply(s,indices=c(1,1,1),max)
plot(round(mx))
as.matrix(mx)

I understand Eddie wants one single layer with the maximum value for
each pixel across layers
and the layer with the actual maximum:
miwhichmax <- function(x,na.rm=TRUE) which.max(x)
mxd <- stackApply(s,indices=c(1,1,1),miwhichmax)
as.matrix(mxd)

Regarding performance, you know better of course.

Agus


On Mon, Oct 14, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Eddie,
>
> stackApply is not the appropriate function in this case (stackApply is
> equivalent to tapply or aggregate for a matrix; see the manual),
> although you could make it do what you want trough
> "indices=1:nlayers(s)", but that is rather inefficient. Instead, to
> get the max value of cells across layers, you can do:
>
> s <- stack(system.file("external/rlogo.grd", package="raster"))
> m <- max(s, na.rm=TRUE)
>
> or
>
> m2 <-  calc(s, max, na.rm=TRUE)
>
> Robert
>
>
>
> On Mon, Oct 14, 2013 at 9:13 AM, Eddie Smith <eddieatr at gmail.com> wrote:
>> Thanks again Agustin.
>>
>> The code works fine for 5 raster layers.
>>
>> library(raster)
>> img <- list.files(pattern='\\.img$')
>> s <- stack(img)
>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>
>> class       : RasterLayer
>> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
>> resolution  : 0.04166667, 0.04166667  (x, y)
>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>> +towgs84=0,0,0
>> data source : in memory
>> names       : layer
>> values      : 12.48, 34.35  (min, max)
>>
>>
>> Just wondering if I have hundreds of raster layer in a folder.
>>
>> I tried mx <- stackApply(s,indices=c(1:5),max) but it gave me different
>> result
>>
>> class       : RasterBrick
>> dimensions  : 1032, 1656, 1708992, 5  (nrow, ncol, ncell, nlayers)
>> resolution  : 0.04166667, 0.04166667  (x, y)
>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>> +towgs84=0,0,0
>> data source : in memory
>> names       : layer.1, layer.2, layer.3, layer.4, layer.5
>> min values  :   16.75,   16.26,   15.00,   12.48,   15.00
>> max values  :   34.35,   34.02,   32.88,   33.48,   34.05
>>
>> Anyone?
>>
>> Thanks in advance.
>>
>>
>>
>>
>>
>>
>>
>> On Tue, Oct 8, 2013 at 9:17 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>
>>> Eddie,
>>> (I'm answering through the list, perhaps somebody else is interested)
>>>
>>> You need one element in "indices" for each input layer, so if you have
>>> 5 layers you should use
>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>> The actual value of each index indicates to which output layer that
>>> input layer is contributing.
>>> In your case, there is only one output layer, thus all values must be
>>> 1. But see the
>>> help page for an example with different index values.
>>>
>>> Agus
>>>
>>> On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es>
>>> wrote:
>>> > ---------- Forwarded message ----------
>>> > From: Eddie Smith <eddieatr at gmail.com>
>>> > Date: Tue, Oct 8, 2013 at 7:40 PM
>>> > Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
>>> > To: Agustin.Lobo at ictja.csic.es
>>> >
>>> >
>>> > Dear Agus,
>>> >
>>> > Thank you very much for your reply. Your script below is working
>>> > however, would you mind if I ask a basic question on what is the
>>> > purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
>>> > and the error message is
>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>> > Warning message:
>>> > In stackApply(s, indices = c(1, 1), max) :
>>> >   number of items to replace is not a multiple of replacement length
>>> >
>>> > I am sorry if my question is too basic. I am new to R.
>>> >
>>> > Thank you.
>>> >
>>> > library(raster)
>>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>> > s <- stack(r1,r2)
>>> > mx <- stackApply(s,indices=c(1,1),max)
>>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>> >
>>> >
>>> > On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>> >>
>>> >> oops, copied the wrong line,
>>> >> it must be
>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>> >>
>>> >> Agus
>>> >>
>>> >>
>>> >> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>> >> > What about this:
>>> >> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>> >> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>> >> > s <- stack(r1,r2)
>>> >> > mx <- stackApply(s,max)
>>> >> >
>>> >> > which.max() fails because raster requires the na.rm argument (I
>>> think, Robert?)
>>> >> >
>>> >> > mxd <- stackApply(s,indices=c(1,1),which.max)
>>> >> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>>> >> >
>>> >> > so make your own function icluding the na.rm argument:
>>> >> >
>>> >> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>> >> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>> >> >
>>> >> > Agus
>>> >> >
>>> >> >
>>> >> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com>
>>> wrote:
>>> >> >> Dear list,
>>> >> >>
>>> >> >> I have a RasterLayer that contains 365 bands with a dimension of
>>> 1032,
>>> >> >> 1656, 1708992  (nrow, ncol, ncell).
>>> >> >>
>>> >> >> library(raster)
>>> >> >> img <- list.files(pattern='\\.img$')
>>> >> >> stack <- stack(img)
>>> >> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>>> >> >> overwrite=TRUE)
>>> >> >>
>>> >> >> 1. How could I produce a raster layer that contains a maximum value
>>> from
>>> >> >> 365 bands for each pixel?
>>> >> >> I tried maxValue() but that only give me a maximum value for each
>>> band.
>>> >> >>
>>> >> >> 2. If I manage to do step 1, is it possible to know from which band
>>> is
>>> >> >> actually the maximum value originate?
>>> >> >>
>>> >> >>         [[alternative HTML version deleted]]
>>> >> >>
>>> >> >> _______________________________________________
>>> >> >> R-sig-Geo mailing list
>>> >> >> R-sig-Geo at r-project.org
>>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>> >
>>> >
>>> >
>>> > --
>>> > --
>>> > Dr. Agustin Lobo
>>> > Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>> > Lluis Sole Sabaris s/n
>>> > 08028 Barcelona
>>> > Spain
>>> > Tel. 34 934095410
>>> > Fax. 34 934110012
>>> > e-mail Agustin.Lobo at ictja.csic.es
>>>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From milan.cisty at stuba.sk  Tue Oct 15 13:26:01 2013
From: milan.cisty at stuba.sk (Milan Cisty)
Date: Tue, 15 Oct 2013 13:26:01 +0200
Subject: [R-sig-Geo] interfacing GRASS and R with spgrass6
Message-ID: <000f01cec999$53cdd260$fb697720$@stuba.sk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131015/a57087a2/attachment.pl>

From Roger.Bivand at nhh.no  Tue Oct 15 13:48:33 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 15 Oct 2013 13:48:33 +0200
Subject: [R-sig-Geo] interfacing GRASS and R with spgrass6
In-Reply-To: <000f01cec999$53cdd260$fb697720$@stuba.sk>
References: <000f01cec999$53cdd260$fb697720$@stuba.sk>
Message-ID: <alpine.LRH.2.03.1310151332080.7479@reclus.nhh.no>

On Tue, 15 Oct 2013, Milan Cisty wrote:

> Dear list members.
>
> I am trying to interface GRASS and R with spgras6. I am on Windows 7 64 bit,
> and I have R 3.02, GRASS 6.4 and I am running things from RStudio.

Repeat this outside R Studio. R Studio interposes things between R and its 
environment without checking the consequences adequately. If the problem 
persists, remove all GRASS environment variables from your working 
environment.

Consider posting on the statgrass list, which is the correct list for this 
kind of question.

There is no reason why spgrass6 should not load successfully, unless 
Sys.getenv("GISRC") returns an erroneous string, or the correct string but 
other GRASS environment variables are not set correctly (never set them 
yourself unless you are quite sure you understand). If you are not running 
R "inside" GRASS - see the documentation in the package:

system(paste(options("pdfviewer"),
  system.file("doc/OSGeo_vol1_GRASS-R.pdf", package="spgrass6")))
system(paste(options("pdfviewer"), system.file("doc/spgrass6_0.3.pdf",
  package="spgrass6")))

(untried). If you set GISRC but are not running R inside GRASS, expect 
trouble.

Roger

>
> I installed spgrass6, but when I am loading it, I get this message:
>
>> library("spgrass6", lib.loc="C:/Program Files/R/R-3.0.2/library")
>
> Loading required package: sp
>
> Loading required package: XML
>
> Error : .onAttach failed in attachNamespace() for 'spgrass6', details:
>
>  call: system(paste("g.version", get("addEXE", envir = .GRASS_CACHE),
>
>  error: 'g.version.exe' not found
>
> Error: package or namespace load failed for 'spgrass6'
>
>
>
> I googled a little, and I set some environmental variables on my comuter
> according one www:
>
> GISBASE to C:\GRASS64   (where I have it)
>
> GISRC to C:\Users\Cisty\AppData\Roaming\GRASS6  (where I have file grassrc6.
> In my Windows it is grassrc6, not .grassrc6)
>
> And I added to path variable this two paths: C:\GRASS64\bin;
> C:\GRASS64\scripts;
>
>
>
> One thing - on GRASS download page I read that i tis for 64 and 32 bit
> systems, but during instalation it never asks, if I want to instal 64-bit or
> 32-bit version of GRASS, so I am not sure which version I have. All other
> software I have for 64-bit architecture. Because of this I tryed to load
> spgrass6 also from pure 32 bit R 3.02, but it produced exactly the same
> error. I do not know if spgrass6 needs to be reinstaled for using in 32-bit
> R.
>
> Thanks for any advice,
>
> Milan
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From mspinola10 at gmail.com  Tue Oct 15 18:49:50 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Tue, 15 Oct 2013 10:49:50 -0600
Subject: [R-sig-Geo] Selecting cells in a raster
Message-ID: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131015/2212bfff/attachment.pl>

From r.hijmans at gmail.com  Tue Oct 15 19:03:38 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 15 Oct 2013 10:03:38 -0700
Subject: [R-sig-Geo] Plotting NetCDF layer over a map as a raster...
In-Reply-To: <CAGKzJ7oAnjdtCWa0Tbesjk1HBbp5_=kGTKzmCHQdVCy6DXgC9w@mail.gmail.com>
References: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>
	<CANtt_hykupC58+khVLyfGCB1xuJiDVmFJD2qMsHQB=TdmvpTTw@mail.gmail.com>
	<CAGKzJ7oAnjdtCWa0Tbesjk1HBbp5_=kGTKzmCHQdVCy6DXgC9w@mail.gmail.com>
Message-ID: <CANtt_hwOJ6o8yzZXTybqi-5e5X9Xe9TRNgBd6+LXUTz_s_dLBg@mail.gmail.com>

Guillermo,

I think there is a problem with the file. The file specifies that it
uses the "CF-1.4" convention, but I do not think this is true.

The ncdf file also specifies that the data have an "ease_projection:
cylindrical"
This projection is described here:
http://nsidc.org/data/ease/ease_grid.html#global_map
and this is probably the corresponding proj.4:
http://www.spatialreference.org/ref/epsg/3410/proj4/

However, the file does not provide the actual x an y values of the
cells (as it should do), instead it provides the lon/lat values (which
would normally be an optional bonus).

So what you could do is (a) write the data provider and (b) transform
the lon/lat values to the projection used, and use that to make a
raster.

Robert

On Mon, Oct 14, 2013 at 11:22 PM, Guillermo E. Ponce-Campos
<geponce at gmail.com> wrote:
> Hi Robert:
>
> Thank you for the answer.
>
> Here is a link to the file...  http://bit.ly/15xryk1
>
> The file have several layers...   I think the issue is that x and y are not
> regularly spaced.
> I tried to do this, following your suggestion with the rasterFromXYZ
> function:
>
> l<-list(x,y,z)  # referring to x,y,z from the initial code
> varMatrix<-do.call(rbind,l)
> varRaster2 <- rasterFromXYZ(varMatrix)
>
> And got this message...
> Error in rasterFromXYZ(varMatrix) : x cell sizes are not regular
>
> #Using the variable "varRaster" from the initial code
>
> res(varRaster)
> [1] 0.2603037 0.2916659
>
> Gives the not regular spaced data set...
>
> If I add "useRaster=TRUE" to the 'image' function I get similar error
> regarding non-regular grid...
>
> Guillermo
>
>
> On Mon, Oct 14, 2013 at 10:08 PM, Robert J. Hijmans <r.hijmans at gmail.com>
> wrote:
>>
>> It seems that the files has other variables than lon & lat that are
>> used. It looks like a projection is used, but then again, the axes
>> range suggests lon/lat. Can you show more info about the file contents
>> (e.g.  print(varRaster) ) or str(ex.nc).
>> Even better if you can make the file available to me. In principle you
>> can of course make a RasterLayer from your x, y and z, particularly if
>> x and y are regularly spaced.
>> Robert
>>
>> On Mon, Oct 14, 2013 at 11:04 AM, Guillermo E. Ponce-Campos
>> <geponce at gmail.com> wrote:
>> > Hello:
>> >
>> > I have been trying to plot a netcdf layer as a raster and have found one
>> > single issue that I'd like know if I'm doing something wrong.  If I use
>> > the
>> > function "image" from raster package there's no problem at all, the
>> > thing
>> > is that I would like to handle this layer as a raster and be able to map
>> > it
>> > correctly or save it as a geotif.
>> >
>> > This is an example using both approaches to map the netcdf layer: as a
>> > raster and using "image(x,y,z...).
>> >
>> > library(ncdf)
>> >
>> > library(maptools)
>> >
>> > library(raster)
>> >
>> > varRaster<-raster("SMOS_File.nc", varname="Soil_Moisture")
>> >
>> > plot(varRaster)
>> > data(wrld_simpl)
>> > plot(wrld_simpl, add = TRUE)
>> >
>> > # Resulting plot (some offset is occurring by opening the layer as a
>> > raster
>> >  --> http://bit.ly/19IFfA2
>> >
>> >
>> > #Using "image" there's no problem...
>> >
>> > ex.nc = open.ncdf("SMOS_File.nc")
>> >
>> > print(ex.nc)
>> > summary(ex.nc)
>> > y = get.var.ncdf( ex.nc, "lat")
>> > x = get.var.ncdf( ex.nc, "lon")
>> > z = get.var.ncdf( ex.nc, "Soil_Moisture")
>> >
>> > image(x,y,z, zlim=c(-0.9,1), col = heat.colors(37))
>> > plot(wrld_simpl, add = TRUE)
>> >
>> > # Resulting plot --> http://bit.ly/1cJ0vXo
>> >
>> > Is there anyway to handle the netcdf layer as a raster and be able to
>> > map
>> > it correctly.  I already tried to write the raster as a geotif and open
>> > it
>> > in other software such as GRASS or ArcMap and is still showing up with
>> > the
>> > offset.
>> >
>> >
>> > Thanks for any help with this.
>> > Guillermo
>> >
>> > --
>> > *Guillermo E. Ponce-Campos*
>> > *PGP Key ID*: 0x57EDC060
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
> --
> Guillermo E. Ponce-Campos
> PGP Key ID: 0x57EDC060
> Ph. (520) 261-8486


From r.hijmans at gmail.com  Tue Oct 15 19:06:34 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 15 Oct 2013 10:06:34 -0700
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAG4NReLFGV9R2UeybCxrLF00JVGfy-d==F6TM==QDP5g+h5Ohg@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
	<CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
	<CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>
	<CAG4NReLFGV9R2UeybCxrLF00JVGfy-d==F6TM==QDP5g+h5Ohg@mail.gmail.com>
Message-ID: <CANtt_hw5mZ_++ge3Xw5ariR4ZmzarYeVLm8WPehtrPHfEoS9Ww@mail.gmail.com>

Agus, yes, that was a mistake, thank you for pointing that out. And
yes, you can use stackApply (just as you could always use tapply
instead of apply), but there are simpler, more direct, and faster,
approaches such as

which.max(s)
max(s)

calc(s, max)

Robert


On Tue, Oct 15, 2013 at 1:06 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Eddie:
>
> Please note "You need one element in "indices" for each input layer"
> and do read the help page.
>
> Robert: yo made a typo right? it is not "indices=1:nlayers(s)", but
> "indices=rep(1,nlayers(s))" ?
>
> i.e:
> r1 <- raster(matrix((1:9),3,3))
> r2 <- raster(matrix(sample(1:9,9),3,3))
> r3 <- raster(matrix(sample(1:9,9),3,3))
> s <- stack(r1,r2,r3)
> as.array(s)
> mx <- stackApply(s,indices=c(1,1,1),max)
> plot(round(mx))
> as.matrix(mx)
>
> I understand Eddie wants one single layer with the maximum value for
> each pixel across layers
> and the layer with the actual maximum:
> miwhichmax <- function(x,na.rm=TRUE) which.max(x)
> mxd <- stackApply(s,indices=c(1,1,1),miwhichmax)
> as.matrix(mxd)
>
> Regarding performance, you know better of course.
>
> Agus
>
>
> On Mon, Oct 14, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>> Eddie,
>>
>> stackApply is not the appropriate function in this case (stackApply is
>> equivalent to tapply or aggregate for a matrix; see the manual),
>> although you could make it do what you want trough
>> "indices=1:nlayers(s)", but that is rather inefficient. Instead, to
>> get the max value of cells across layers, you can do:
>>
>> s <- stack(system.file("external/rlogo.grd", package="raster"))
>> m <- max(s, na.rm=TRUE)
>>
>> or
>>
>> m2 <-  calc(s, max, na.rm=TRUE)
>>
>> Robert
>>
>>
>>
>> On Mon, Oct 14, 2013 at 9:13 AM, Eddie Smith <eddieatr at gmail.com> wrote:
>>> Thanks again Agustin.
>>>
>>> The code works fine for 5 raster layers.
>>>
>>> library(raster)
>>> img <- list.files(pattern='\\.img$')
>>> s <- stack(img)
>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>
>>> class       : RasterLayer
>>> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>> +towgs84=0,0,0
>>> data source : in memory
>>> names       : layer
>>> values      : 12.48, 34.35  (min, max)
>>>
>>>
>>> Just wondering if I have hundreds of raster layer in a folder.
>>>
>>> I tried mx <- stackApply(s,indices=c(1:5),max) but it gave me different
>>> result
>>>
>>> class       : RasterBrick
>>> dimensions  : 1032, 1656, 1708992, 5  (nrow, ncol, ncell, nlayers)
>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>> +towgs84=0,0,0
>>> data source : in memory
>>> names       : layer.1, layer.2, layer.3, layer.4, layer.5
>>> min values  :   16.75,   16.26,   15.00,   12.48,   15.00
>>> max values  :   34.35,   34.02,   32.88,   33.48,   34.05
>>>
>>> Anyone?
>>>
>>> Thanks in advance.
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Tue, Oct 8, 2013 at 9:17 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>
>>>> Eddie,
>>>> (I'm answering through the list, perhaps somebody else is interested)
>>>>
>>>> You need one element in "indices" for each input layer, so if you have
>>>> 5 layers you should use
>>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>> The actual value of each index indicates to which output layer that
>>>> input layer is contributing.
>>>> In your case, there is only one output layer, thus all values must be
>>>> 1. But see the
>>>> help page for an example with different index values.
>>>>
>>>> Agus
>>>>
>>>> On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es>
>>>> wrote:
>>>> > ---------- Forwarded message ----------
>>>> > From: Eddie Smith <eddieatr at gmail.com>
>>>> > Date: Tue, Oct 8, 2013 at 7:40 PM
>>>> > Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
>>>> > To: Agustin.Lobo at ictja.csic.es
>>>> >
>>>> >
>>>> > Dear Agus,
>>>> >
>>>> > Thank you very much for your reply. Your script below is working
>>>> > however, would you mind if I ask a basic question on what is the
>>>> > purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
>>>> > and the error message is
>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>> > Warning message:
>>>> > In stackApply(s, indices = c(1, 1), max) :
>>>> >   number of items to replace is not a multiple of replacement length
>>>> >
>>>> > I am sorry if my question is too basic. I am new to R.
>>>> >
>>>> > Thank you.
>>>> >
>>>> > library(raster)
>>>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>> > s <- stack(r1,r2)
>>>> > mx <- stackApply(s,indices=c(1,1),max)
>>>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>> >
>>>> >
>>>> > On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com>
>>>> wrote:
>>>> >>
>>>> >> oops, copied the wrong line,
>>>> >> it must be
>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>> >>
>>>> >> Agus
>>>> >>
>>>> >>
>>>> >> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com>
>>>> wrote:
>>>> >> > What about this:
>>>> >> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>> >> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>> >> > s <- stack(r1,r2)
>>>> >> > mx <- stackApply(s,max)
>>>> >> >
>>>> >> > which.max() fails because raster requires the na.rm argument (I
>>>> think, Robert?)
>>>> >> >
>>>> >> > mxd <- stackApply(s,indices=c(1,1),which.max)
>>>> >> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>>>> >> >
>>>> >> > so make your own function icluding the na.rm argument:
>>>> >> >
>>>> >> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>> >> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>> >> >
>>>> >> > Agus
>>>> >> >
>>>> >> >
>>>> >> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com>
>>>> wrote:
>>>> >> >> Dear list,
>>>> >> >>
>>>> >> >> I have a RasterLayer that contains 365 bands with a dimension of
>>>> 1032,
>>>> >> >> 1656, 1708992  (nrow, ncol, ncell).
>>>> >> >>
>>>> >> >> library(raster)
>>>> >> >> img <- list.files(pattern='\\.img$')
>>>> >> >> stack <- stack(img)
>>>> >> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>>>> >> >> overwrite=TRUE)
>>>> >> >>
>>>> >> >> 1. How could I produce a raster layer that contains a maximum value
>>>> from
>>>> >> >> 365 bands for each pixel?
>>>> >> >> I tried maxValue() but that only give me a maximum value for each
>>>> band.
>>>> >> >>
>>>> >> >> 2. If I manage to do step 1, is it possible to know from which band
>>>> is
>>>> >> >> actually the maximum value originate?
>>>> >> >>
>>>> >> >>         [[alternative HTML version deleted]]
>>>> >> >>
>>>> >> >> _______________________________________________
>>>> >> >> R-sig-Geo mailing list
>>>> >> >> R-sig-Geo at r-project.org
>>>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >
>>>> >
>>>> >
>>>> >
>>>> > --
>>>> > --
>>>> > Dr. Agustin Lobo
>>>> > Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>> > Lluis Sole Sabaris s/n
>>>> > 08028 Barcelona
>>>> > Spain
>>>> > Tel. 34 934095410
>>>> > Fax. 34 934110012
>>>> > e-mail Agustin.Lobo at ictja.csic.es
>>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From geponce at gmail.com  Tue Oct 15 19:33:26 2013
From: geponce at gmail.com (Guillermo E. Ponce-Campos)
Date: Tue, 15 Oct 2013 10:33:26 -0700
Subject: [R-sig-Geo] Plotting NetCDF layer over a map as a raster...
In-Reply-To: <CANtt_hwOJ6o8yzZXTybqi-5e5X9Xe9TRNgBd6+LXUTz_s_dLBg@mail.gmail.com>
References: <CAGKzJ7pRrcfOku+kjpUnGDh8tqu_6n3uuhdDm8LugNqQLqNhTA@mail.gmail.com>
	<CANtt_hykupC58+khVLyfGCB1xuJiDVmFJD2qMsHQB=TdmvpTTw@mail.gmail.com>
	<CAGKzJ7oAnjdtCWa0Tbesjk1HBbp5_=kGTKzmCHQdVCy6DXgC9w@mail.gmail.com>
	<CANtt_hwOJ6o8yzZXTybqi-5e5X9Xe9TRNgBd6+LXUTz_s_dLBg@mail.gmail.com>
Message-ID: <CAGKzJ7oC4a4HC+uAdYTS+mDsDeMoZFEM_bWw7gnnmpFHxQv7fQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131015/89ad21f3/attachment.pl>

From hughsturrock at hotmail.com  Tue Oct 15 22:29:56 2013
From: hughsturrock at hotmail.com (Hugh Sturrock)
Date: Tue, 15 Oct 2013 21:29:56 +0100
Subject: [R-sig-Geo] Selecting cells in a raster
In-Reply-To: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
References: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
Message-ID: <DUB116-W92675E035FE2551121E4C5C81B0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131015/446e6716/attachment.pl>

From mspinola10 at gmail.com  Wed Oct 16 00:56:05 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Tue, 15 Oct 2013 16:56:05 -0600
Subject: [R-sig-Geo] How to make a raster (from a shapefile) with cells with
	forest cover percent.
Message-ID: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131015/4804fc2a/attachment.pl>

From r.hijmans at gmail.com  Wed Oct 16 05:42:36 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Tue, 15 Oct 2013 20:42:36 -0700
Subject: [R-sig-Geo] Selecting cells in a raster
In-Reply-To: <DUB116-W92675E035FE2551121E4C5C81B0@phx.gbl>
References: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
	<DUB116-W92675E035FE2551121E4C5C81B0@phx.gbl>
Message-ID: <CANtt_hx731FqhUFL+1uG25RhtJTdUjap_qwveJ80bKw16ofr6g@mail.gmail.com>

Hugh,
You really should not use raster[] because that will fail with large
objects, and it is not necessary. Manuel's
 forest <- cob_r == 1
is correct.
Robert

On Tue, Oct 15, 2013 at 1:29 PM, Hugh Sturrock <hughsturrock at hotmail.com> wrote:
> Hi Manuel,
> raster[] will give you a vector of the raster values so
>
> #create a new raster of the same red and extent as cob_r
> forest_raster<-cob_r
>
> # assuming forest pixels have a value of 1
> forest_raster[forest_raster[]!=1]<-0
> plot(forest_raster)
>
> Does that work?
>
> Date: Tue, 15 Oct 2013 10:49:50 -0600
> From: mspinola10 at gmail.com
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] Selecting cells in a raster
>
> Dear list members,
>
> I have a raster with land use data (with values from 1 to 9).  I want to
> select the cells with value 1 wich belong to forest.  How can I do that?  I
> was trying:
>
> forest <- cob_r ==1
> plot(forest)
>
> but it didn?t work
>
>> cob_r
> class       : RasterLayer
> dimensions  : 314, 236, 74104  (nrow, ncol, ncell)
> resolution  : 300, 300  (x, y)
> extent      : 447181, 517981, 1121851, 1216051  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=tmerc +lat_0=0 +lon_0=-84 +k=0.9999 +x_0=500000 +y_0=0
> +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : layer
> values      : 1, 9  (min, max)
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mtreglia at gmail.com  Wed Oct 16 07:33:00 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Wed, 16 Oct 2013 00:33:00 -0500
Subject: [R-sig-Geo] How to make a raster (from a shapefile) with cells
 with forest cover percent.
In-Reply-To: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>
References: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>
Message-ID: <CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/bcba038b/attachment.pl>

From roosbeh.nowrouzian at gmail.com  Wed Oct 16 07:46:36 2013
From: roosbeh.nowrouzian at gmail.com (Roosbeh Nowrouzian)
Date: Wed, 16 Oct 2013 01:46:36 -0400
Subject: [R-sig-Geo] Package GWmodel Mixed GWR estimation
Message-ID: <CAJw-hPZqyX7Uc4eB333MhJgGMyDP3HC1MyjSwfc1k3+WZ+O7sA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/fde209fe/attachment.pl>

From alobolistas at gmail.com  Wed Oct 16 08:36:28 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 16 Oct 2013 08:36:28 +0200
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CANtt_hw5mZ_++ge3Xw5ariR4ZmzarYeVLm8WPehtrPHfEoS9Ww@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
	<CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
	<CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>
	<CAG4NReLFGV9R2UeybCxrLF00JVGfy-d==F6TM==QDP5g+h5Ohg@mail.gmail.com>
	<CANtt_hw5mZ_++ge3Xw5ariR4ZmzarYeVLm8WPehtrPHfEoS9Ww@mail.gmail.com>
Message-ID: <CAG4NReK2UtwRphHoh=SzT5aCrvWVYM_x+A6BTFpWq4Tj0m4ECg@mail.gmail.com>

Robert,
I keep on because this is an important point for the analysis of time
series of image:

Actually I get stackApply() faster than max() if the nb of layers increases:

Example with 3 larger layers:
r1 <- raster(matrix((1:9000000),3000,3000))
r2 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
r3 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
s <- stack(r1,r2,r3)
system.time(mx <- stackApply(s,indices=c(1,1,1),max))
   user  system elapsed
  2.052   0.508   2.566
system.time(mx3 <- max(s, na.rm=TRUE))
   user  system elapsed
  1.892   0.400   2.300

But with 24 layers:

s <- stack(r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3)
system.time(mx <- stackApply(s,indices=c(1,1,1),max))
   user  system elapsed
 17.896   0.744  18.694
system.time(mx3 <- max(s, na.rm=TRUE))
   user  system elapsed
 37.948  17.436  55.519


Agus

On Tue, Oct 15, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> Agus, yes, that was a mistake, thank you for pointing that out. And
> yes, you can use stackApply (just as you could always use tapply
> instead of apply), but there are simpler, more direct, and faster,
> approaches such as
>
> which.max(s)
> max(s)
>
> calc(s, max)
>
> Robert
>
>
> On Tue, Oct 15, 2013 at 1:06 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Eddie:
>>
>> Please note "You need one element in "indices" for each input layer"
>> and do read the help page.
>>
>> Robert: yo made a typo right? it is not "indices=1:nlayers(s)", but
>> "indices=rep(1,nlayers(s))" ?
>>
>> i.e:
>> r1 <- raster(matrix((1:9),3,3))
>> r2 <- raster(matrix(sample(1:9,9),3,3))
>> r3 <- raster(matrix(sample(1:9,9),3,3))
>> s <- stack(r1,r2,r3)
>> as.array(s)
>> mx <- stackApply(s,indices=c(1,1,1),max)
>> plot(round(mx))
>> as.matrix(mx)
>>
>> I understand Eddie wants one single layer with the maximum value for
>> each pixel across layers
>> and the layer with the actual maximum:
>> miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>> mxd <- stackApply(s,indices=c(1,1,1),miwhichmax)
>> as.matrix(mxd)
>>
>> Regarding performance, you know better of course.
>>
>> Agus
>>
>>
>> On Mon, Oct 14, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>>> Eddie,
>>>
>>> stackApply is not the appropriate function in this case (stackApply is
>>> equivalent to tapply or aggregate for a matrix; see the manual),
>>> although you could make it do what you want trough
>>> "indices=1:nlayers(s)", but that is rather inefficient. Instead, to
>>> get the max value of cells across layers, you can do:
>>>
>>> s <- stack(system.file("external/rlogo.grd", package="raster"))
>>> m <- max(s, na.rm=TRUE)
>>>
>>> or
>>>
>>> m2 <-  calc(s, max, na.rm=TRUE)
>>>
>>> Robert
>>>
>>>
>>>
>>> On Mon, Oct 14, 2013 at 9:13 AM, Eddie Smith <eddieatr at gmail.com> wrote:
>>>> Thanks again Agustin.
>>>>
>>>> The code works fine for 5 raster layers.
>>>>
>>>> library(raster)
>>>> img <- list.files(pattern='\\.img$')
>>>> s <- stack(img)
>>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>>
>>>> class       : RasterLayer
>>>> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
>>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>>> +towgs84=0,0,0
>>>> data source : in memory
>>>> names       : layer
>>>> values      : 12.48, 34.35  (min, max)
>>>>
>>>>
>>>> Just wondering if I have hundreds of raster layer in a folder.
>>>>
>>>> I tried mx <- stackApply(s,indices=c(1:5),max) but it gave me different
>>>> result
>>>>
>>>> class       : RasterBrick
>>>> dimensions  : 1032, 1656, 1708992, 5  (nrow, ncol, ncell, nlayers)
>>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>>> +towgs84=0,0,0
>>>> data source : in memory
>>>> names       : layer.1, layer.2, layer.3, layer.4, layer.5
>>>> min values  :   16.75,   16.26,   15.00,   12.48,   15.00
>>>> max values  :   34.35,   34.02,   32.88,   33.48,   34.05
>>>>
>>>> Anyone?
>>>>
>>>> Thanks in advance.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Tue, Oct 8, 2013 at 9:17 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>>
>>>>> Eddie,
>>>>> (I'm answering through the list, perhaps somebody else is interested)
>>>>>
>>>>> You need one element in "indices" for each input layer, so if you have
>>>>> 5 layers you should use
>>>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>>> The actual value of each index indicates to which output layer that
>>>>> input layer is contributing.
>>>>> In your case, there is only one output layer, thus all values must be
>>>>> 1. But see the
>>>>> help page for an example with different index values.
>>>>>
>>>>> Agus
>>>>>
>>>>> On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es>
>>>>> wrote:
>>>>> > ---------- Forwarded message ----------
>>>>> > From: Eddie Smith <eddieatr at gmail.com>
>>>>> > Date: Tue, Oct 8, 2013 at 7:40 PM
>>>>> > Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
>>>>> > To: Agustin.Lobo at ictja.csic.es
>>>>> >
>>>>> >
>>>>> > Dear Agus,
>>>>> >
>>>>> > Thank you very much for your reply. Your script below is working
>>>>> > however, would you mind if I ask a basic question on what is the
>>>>> > purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
>>>>> > and the error message is
>>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>>> > Warning message:
>>>>> > In stackApply(s, indices = c(1, 1), max) :
>>>>> >   number of items to replace is not a multiple of replacement length
>>>>> >
>>>>> > I am sorry if my question is too basic. I am new to R.
>>>>> >
>>>>> > Thank you.
>>>>> >
>>>>> > library(raster)
>>>>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>>> > s <- stack(r1,r2)
>>>>> > mx <- stackApply(s,indices=c(1,1),max)
>>>>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>>> >
>>>>> >
>>>>> > On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>> >>
>>>>> >> oops, copied the wrong line,
>>>>> >> it must be
>>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>>> >>
>>>>> >> Agus
>>>>> >>
>>>>> >>
>>>>> >> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>> >> > What about this:
>>>>> >> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>>> >> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>>> >> > s <- stack(r1,r2)
>>>>> >> > mx <- stackApply(s,max)
>>>>> >> >
>>>>> >> > which.max() fails because raster requires the na.rm argument (I
>>>>> think, Robert?)
>>>>> >> >
>>>>> >> > mxd <- stackApply(s,indices=c(1,1),which.max)
>>>>> >> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>>>>> >> >
>>>>> >> > so make your own function icluding the na.rm argument:
>>>>> >> >
>>>>> >> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>>> >> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>>> >> >
>>>>> >> > Agus
>>>>> >> >
>>>>> >> >
>>>>> >> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com>
>>>>> wrote:
>>>>> >> >> Dear list,
>>>>> >> >>
>>>>> >> >> I have a RasterLayer that contains 365 bands with a dimension of
>>>>> 1032,
>>>>> >> >> 1656, 1708992  (nrow, ncol, ncell).
>>>>> >> >>
>>>>> >> >> library(raster)
>>>>> >> >> img <- list.files(pattern='\\.img$')
>>>>> >> >> stack <- stack(img)
>>>>> >> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>>>>> >> >> overwrite=TRUE)
>>>>> >> >>
>>>>> >> >> 1. How could I produce a raster layer that contains a maximum value
>>>>> from
>>>>> >> >> 365 bands for each pixel?
>>>>> >> >> I tried maxValue() but that only give me a maximum value for each
>>>>> band.
>>>>> >> >>
>>>>> >> >> 2. If I manage to do step 1, is it possible to know from which band
>>>>> is
>>>>> >> >> actually the maximum value originate?
>>>>> >> >>
>>>>> >> >>         [[alternative HTML version deleted]]
>>>>> >> >>
>>>>> >> >> _______________________________________________
>>>>> >> >> R-sig-Geo mailing list
>>>>> >> >> R-sig-Geo at r-project.org
>>>>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> > --
>>>>> > --
>>>>> > Dr. Agustin Lobo
>>>>> > Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>>> > Lluis Sole Sabaris s/n
>>>>> > 08028 Barcelona
>>>>> > Spain
>>>>> > Tel. 34 934095410
>>>>> > Fax. 34 934110012
>>>>> > e-mail Agustin.Lobo at ictja.csic.es
>>>>>
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lubinbin220 at gmail.com  Wed Oct 16 12:12:26 2013
From: lubinbin220 at gmail.com (binbin lu)
Date: Wed, 16 Oct 2013 18:12:26 +0800
Subject: [R-sig-Geo] Package GWmodel Mixed GWR estimation
In-Reply-To: <CANuoaEEh9051T_nJ6bYNnbYyd+XRZR1VkjYJVPoc8anML+vgww@mail.gmail.com>
References: <CAJw-hPZqyX7Uc4eB333MhJgGMyDP3HC1MyjSwfc1k3+WZ+O7sA@mail.gmail.com>
	<CANuoaEEh9051T_nJ6bYNnbYyd+XRZR1VkjYJVPoc8anML+vgww@mail.gmail.com>
Message-ID: <CANuoaEHqusyMvtXGhLCDLr9GX+2ZZtRmipwwi7k5bE4OQEfuGg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/4722c030/attachment.pl>

From pmassicotte at hotmail.com  Wed Oct 16 17:18:50 2013
From: pmassicotte at hotmail.com (philippe massicotte)
Date: Wed, 16 Oct 2013 15:18:50 +0000
Subject: [R-sig-Geo] Long time to load shapefiles
Message-ID: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/4a2fe02a/attachment.pl>

From tephilippi at gmail.com  Wed Oct 16 18:51:24 2013
From: tephilippi at gmail.com (Tom Philippi)
Date: Wed, 16 Oct 2013 09:51:24 -0700
Subject: [R-sig-Geo] How to make a raster (from a shapefile) with cells
 with forest cover percent.
In-Reply-To: <CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>
References: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>
	<CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>
Message-ID: <CALyPt8zd=nDqHSTjv9aU3bCKvHuyr3T2obCh5+MEWJxfOcH5VQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/54f9ce64/attachment.pl>

From alobolistas at gmail.com  Wed Oct 16 19:21:08 2013
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 16 Oct 2013 19:21:08 +0200
Subject: [R-sig-Geo] Selecting cells in a raster
In-Reply-To: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
References: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
Message-ID: <CAG4NReJJKcH0SZ95+WLZUZx32hW7WZuf3X1s-jss-Fn7fbZ6bw@mail.gmail.com>

Manuel,
What do you mean by "it didn't work?
You should have got an object named forest,
post the same info as for cob_r

Agus

On Tue, Oct 15, 2013 at 6:49 PM, Manuel Sp?nola <mspinola10 at gmail.com> wrote:
> Dear list members,
>
> I have a raster with land use data (with values from 1 to 9).  I want to
> select the cells with value 1 wich belong to forest.  How can I do that?  I
> was trying:
>
> forest <- cob_r ==1
> plot(forest)
>
> but it didn?t work
>
>> cob_r
> class       : RasterLayer
> dimensions  : 314, 236, 74104  (nrow, ncol, ncell)
> resolution  : 300, 300  (x, y)
> extent      : 447181, 517981, 1121851, 1216051  (xmin, xmax, ymin, ymax)
> coord. ref. : +proj=tmerc +lat_0=0 +lon_0=-84 +k=0.9999 +x_0=500000 +y_0=0
> +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0
> data source : in memory
> names       : layer
> values      : 1, 9  (min, max)
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mspinola10 at gmail.com  Wed Oct 16 21:22:12 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 16 Oct 2013 13:22:12 -0600
Subject: [R-sig-Geo] Selecting cells in a raster
In-Reply-To: <CAG4NReJJKcH0SZ95+WLZUZx32hW7WZuf3X1s-jss-Fn7fbZ6bw@mail.gmail.com>
References: <CABkCotRtRA7pxgya8f=bwecBt_v+hLn6yrkz+dMXQ8pEs1RyCg@mail.gmail.com>
	<CAG4NReJJKcH0SZ95+WLZUZx32hW7WZuf3X1s-jss-Fn7fbZ6bw@mail.gmail.com>
Message-ID: <CABkCotS_9KbJWz0+mjbdpFYnrbqochQbbB509mNW2DZi2DLRMQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131016/3c534111/attachment.pl>

From grothered at gmail.com  Thu Oct 17 05:55:33 2013
From: grothered at gmail.com (GD)
Date: Wed, 16 Oct 2013 20:55:33 -0700 (PDT)
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>
Message-ID: <1381982133431-7584873.post@n2.nabble.com>

Hi Phil,

I have also found readOGR to be very slow when reading a large shapefile (in
my case, a shapefile with 85000 polygons and ~ 200 columns in the attribute
table).

In my case, I would repeatedly re-read the shapefile each time I was working
on the script. 

To speed things up, I found it best to use readOGR to get the file into R
the first time, but then save the resulting object as an RDS file (using
saveRDS). From then on, you can load the object with readRDS. In my case,
that would happen in about 10s, whereas it might take 20min for readOGR to
directly read the shapefile. 

Cheers,
Gareth.   



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-to-load-shapefiles-tp7584869p7584873.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Thu Oct 17 06:09:46 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 16 Oct 2013 21:09:46 -0700
Subject: [R-sig-Geo] Creating a maximum raster layer from RasterStack
In-Reply-To: <CAG4NReK2UtwRphHoh=SzT5aCrvWVYM_x+A6BTFpWq4Tj0m4ECg@mail.gmail.com>
References: <CABaJH7-L=WJZV_xQLXqiZ89KwKdCbn0gJiUbFA7EapVfBWqB6w@mail.gmail.com>
	<CAG4NReLGEAwsgw6uZHfiG4YA-2TBwiTU+1YF7DML6xD_GBsjaA@mail.gmail.com>
	<CAG4NReKL_wi8TWbJHUbpczVNa0Mu6Y-1=7+fB915yHrG8KMbog@mail.gmail.com>
	<CABaJH7_6jo5pNA1n36fVuWCVjP8Eg1X1gU=TPQ9GS_tw7qgBLQ@mail.gmail.com>
	<CALPC6DMxB4NzYpC2=P8wizjJss+bZ=y9VGxS+41KrzcYV9FBCA@mail.gmail.com>
	<CAG4NReKGKU1+LPE+KxBDXvbvzX9AwNgYJdfe6EuTXrwWMyyQBg@mail.gmail.com>
	<CABaJH7-70Q_r8T1CjDEagqU3iOby2kTERtM0VvjEqTsrFqcoHA@mail.gmail.com>
	<CANtt_hyExJspGK_hZ1=QDOD-icFV2n4uHnOHHByd4RTkYm9+bA@mail.gmail.com>
	<CAG4NReLFGV9R2UeybCxrLF00JVGfy-d==F6TM==QDP5g+h5Ohg@mail.gmail.com>
	<CANtt_hw5mZ_++ge3Xw5ariR4ZmzarYeVLm8WPehtrPHfEoS9Ww@mail.gmail.com>
	<CAG4NReK2UtwRphHoh=SzT5aCrvWVYM_x+A6BTFpWq4Tj0m4ECg@mail.gmail.com>
Message-ID: <CANtt_hz1cJ6rD980vOvQ9q2vYryGo44K7TYh5i4pP25TOW3shw@mail.gmail.com>

Hi Agus,

Yes, you are right, in that case stackApply is faster (but note that
you had a mistake in the indices argument that further increased the
difference ---- but is another reason why I would not use stackAppy
unless I really needed it).  I did not think it would be possible that
a more generic function could be faster.  This helped me to find an
inefficiency that occurs when using 'max', that does not occur in
'stackApply'. I have now fixed that (raster version 2.1-59) such that
I get:

> library(raster)
Loading required package: sp
> r1 <- raster(matrix((1:9000000),3000,3000))
> r2 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
> r3 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
> s <- stack(r1,r2,r3)
>
> system.time(mx <- stackApply(s,indices=rep(1, nlayers(s)),max))
   user  system elapsed
   1.56    0.28    1.84
> system.time(mx3 <- max(s, na.rm=TRUE))
   user  system elapsed
   1.25    0.29    1.54
>
> s <- stack(r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3)
> system.time(mx <- stackApply(s,indices=rep(1, nlayers(s)),max))
   user  system elapsed
  13.22    2.22   16.48
> system.time(mx3 <- max(s))
   user  system elapsed
  12.15    2.03   14.29

That is, speeds are still about the same. That is disappointing.
Thanks for pointing this out.

Robert



On Tue, Oct 15, 2013 at 11:36 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Robert,
> I keep on because this is an important point for the analysis of time
> series of image:
>
> Actually I get stackApply() faster than max() if the nb of layers increases:
>
> Example with 3 larger layers:
> r1 <- raster(matrix((1:9000000),3000,3000))
> r2 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
> r3 <- raster(matrix(sample(1:9000000,9000000),3000,3000))
> s <- stack(r1,r2,r3)
> system.time(mx <- stackApply(s,indices=c(1,1,1),max))
>    user  system elapsed
>   2.052   0.508   2.566
> system.time(mx3 <- max(s, na.rm=TRUE))
>    user  system elapsed
>   1.892   0.400   2.300
>
> But with 24 layers:
>
> s <- stack(r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3,r1,r2,r3)
> system.time(mx <- stackApply(s,indices=c(1,1,1),max))
>    user  system elapsed
>  17.896   0.744  18.694
> system.time(mx3 <- max(s, na.rm=TRUE))
>    user  system elapsed
>  37.948  17.436  55.519
>
>
> Agus
>
> On Tue, Oct 15, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>> Agus, yes, that was a mistake, thank you for pointing that out. And
>> yes, you can use stackApply (just as you could always use tapply
>> instead of apply), but there are simpler, more direct, and faster,
>> approaches such as
>>
>> which.max(s)
>> max(s)
>>
>> calc(s, max)
>>
>> Robert
>>
>>
>> On Tue, Oct 15, 2013 at 1:06 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>> Eddie:
>>>
>>> Please note "You need one element in "indices" for each input layer"
>>> and do read the help page.
>>>
>>> Robert: yo made a typo right? it is not "indices=1:nlayers(s)", but
>>> "indices=rep(1,nlayers(s))" ?
>>>
>>> i.e:
>>> r1 <- raster(matrix((1:9),3,3))
>>> r2 <- raster(matrix(sample(1:9,9),3,3))
>>> r3 <- raster(matrix(sample(1:9,9),3,3))
>>> s <- stack(r1,r2,r3)
>>> as.array(s)
>>> mx <- stackApply(s,indices=c(1,1,1),max)
>>> plot(round(mx))
>>> as.matrix(mx)
>>>
>>> I understand Eddie wants one single layer with the maximum value for
>>> each pixel across layers
>>> and the layer with the actual maximum:
>>> miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>> mxd <- stackApply(s,indices=c(1,1,1),miwhichmax)
>>> as.matrix(mxd)
>>>
>>> Regarding performance, you know better of course.
>>>
>>> Agus
>>>
>>>
>>> On Mon, Oct 14, 2013 at 7:06 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
>>>> Eddie,
>>>>
>>>> stackApply is not the appropriate function in this case (stackApply is
>>>> equivalent to tapply or aggregate for a matrix; see the manual),
>>>> although you could make it do what you want trough
>>>> "indices=1:nlayers(s)", but that is rather inefficient. Instead, to
>>>> get the max value of cells across layers, you can do:
>>>>
>>>> s <- stack(system.file("external/rlogo.grd", package="raster"))
>>>> m <- max(s, na.rm=TRUE)
>>>>
>>>> or
>>>>
>>>> m2 <-  calc(s, max, na.rm=TRUE)
>>>>
>>>> Robert
>>>>
>>>>
>>>>
>>>> On Mon, Oct 14, 2013 at 9:13 AM, Eddie Smith <eddieatr at gmail.com> wrote:
>>>>> Thanks again Agustin.
>>>>>
>>>>> The code works fine for 5 raster layers.
>>>>>
>>>>> library(raster)
>>>>> img <- list.files(pattern='\\.img$')
>>>>> s <- stack(img)
>>>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>>>
>>>>> class       : RasterLayer
>>>>> dimensions  : 1032, 1656, 1708992  (nrow, ncol, ncell)
>>>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>>>> +towgs84=0,0,0
>>>>> data source : in memory
>>>>> names       : layer
>>>>> values      : 12.48, 34.35  (min, max)
>>>>>
>>>>>
>>>>> Just wondering if I have hundreds of raster layer in a folder.
>>>>>
>>>>> I tried mx <- stackApply(s,indices=c(1:5),max) but it gave me different
>>>>> result
>>>>>
>>>>> class       : RasterBrick
>>>>> dimensions  : 1032, 1656, 1708992, 5  (nrow, ncol, ncell, nlayers)
>>>>> resolution  : 0.04166667, 0.04166667  (x, y)
>>>>> extent      : 96.5, 165.5, -16.5, 26.5  (xmin, xmax, ymin, ymax)
>>>>> coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>>>>> +towgs84=0,0,0
>>>>> data source : in memory
>>>>> names       : layer.1, layer.2, layer.3, layer.4, layer.5
>>>>> min values  :   16.75,   16.26,   15.00,   12.48,   15.00
>>>>> max values  :   34.35,   34.02,   32.88,   33.48,   34.05
>>>>>
>>>>> Anyone?
>>>>>
>>>>> Thanks in advance.
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Tue, Oct 8, 2013 at 9:17 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>>>>
>>>>>> Eddie,
>>>>>> (I'm answering through the list, perhaps somebody else is interested)
>>>>>>
>>>>>> You need one element in "indices" for each input layer, so if you have
>>>>>> 5 layers you should use
>>>>>> mx <- stackApply(s,indices=c(1,1,1,1,1),max)
>>>>>> The actual value of each index indicates to which output layer that
>>>>>> input layer is contributing.
>>>>>> In your case, there is only one output layer, thus all values must be
>>>>>> 1. But see the
>>>>>> help page for an example with different index values.
>>>>>>
>>>>>> Agus
>>>>>>
>>>>>> On Tue, Oct 8, 2013 at 9:41 PM, Agustin Lobo <Agustin.Lobo at ictja.csic.es>
>>>>>> wrote:
>>>>>> > ---------- Forwarded message ----------
>>>>>> > From: Eddie Smith <eddieatr at gmail.com>
>>>>>> > Date: Tue, Oct 8, 2013 at 7:40 PM
>>>>>> > Subject: Re: [R-sig-Geo] Creating a maximum raster layer from RasterStack
>>>>>> > To: Agustin.Lobo at ictja.csic.es
>>>>>> >
>>>>>> >
>>>>>> > Dear Agus,
>>>>>> >
>>>>>> > Thank you very much for your reply. Your script below is working
>>>>>> > however, would you mind if I ask a basic question on what is the
>>>>>> > purpose of [indices=c(1,1)] ? I tried this code with 5 raster layers
>>>>>> > and the error message is
>>>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>>>> > Warning message:
>>>>>> > In stackApply(s, indices = c(1, 1), max) :
>>>>>> >   number of items to replace is not a multiple of replacement length
>>>>>> >
>>>>>> > I am sorry if my question is too basic. I am new to R.
>>>>>> >
>>>>>> > Thank you.
>>>>>> >
>>>>>> > library(raster)
>>>>>> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>>>> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>>>> > s <- stack(r1,r2)
>>>>>> > mx <- stackApply(s,indices=c(1,1),max)
>>>>>> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>>>> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>>>> >
>>>>>> >
>>>>>> > On Mon, Oct 7, 2013 at 7:20 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>>> wrote:
>>>>>> >>
>>>>>> >> oops, copied the wrong line,
>>>>>> >> it must be
>>>>>> >> mx <- stackApply(s,indices=c(1,1),max)
>>>>>> >>
>>>>>> >> Agus
>>>>>> >>
>>>>>> >>
>>>>>> >> On Mon, Oct 7, 2013 at 8:18 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>>> wrote:
>>>>>> >> > What about this:
>>>>>> >> > r1 <- raster(matrix(rnorm(100,5,10),10,10))
>>>>>> >> > r2 <- raster(matrix(rnorm(100,2,30),10,10))
>>>>>> >> > s <- stack(r1,r2)
>>>>>> >> > mx <- stackApply(s,max)
>>>>>> >> >
>>>>>> >> > which.max() fails because raster requires the na.rm argument (I
>>>>>> think, Robert?)
>>>>>> >> >
>>>>>> >> > mxd <- stackApply(s,indices=c(1,1),which.max)
>>>>>> >> > Error in FUN(newX[, i], ...) : unused argument (na.rm = TRUE)
>>>>>> >> >
>>>>>> >> > so make your own function icluding the na.rm argument:
>>>>>> >> >
>>>>>> >> > miwhichmax <- function(x,na.rm=TRUE) which.max(x)
>>>>>> >> > mxd <- stackApply(s,indices=c(1,1),miwhichmax)
>>>>>> >> >
>>>>>> >> > Agus
>>>>>> >> >
>>>>>> >> >
>>>>>> >> > On Thu, Oct 3, 2013 at 6:55 PM, Eddie Smith <eddieatr at gmail.com>
>>>>>> wrote:
>>>>>> >> >> Dear list,
>>>>>> >> >>
>>>>>> >> >> I have a RasterLayer that contains 365 bands with a dimension of
>>>>>> 1032,
>>>>>> >> >> 1656, 1708992  (nrow, ncol, ncell).
>>>>>> >> >>
>>>>>> >> >> library(raster)
>>>>>> >> >> img <- list.files(pattern='\\.img$')
>>>>>> >> >> stack <- stack(img)
>>>>>> >> >> data2002 <- writeRaster(stack, filename="2002.tif", format="GTiff",
>>>>>> >> >> overwrite=TRUE)
>>>>>> >> >>
>>>>>> >> >> 1. How could I produce a raster layer that contains a maximum value
>>>>>> from
>>>>>> >> >> 365 bands for each pixel?
>>>>>> >> >> I tried maxValue() but that only give me a maximum value for each
>>>>>> band.
>>>>>> >> >>
>>>>>> >> >> 2. If I manage to do step 1, is it possible to know from which band
>>>>>> is
>>>>>> >> >> actually the maximum value originate?
>>>>>> >> >>
>>>>>> >> >>         [[alternative HTML version deleted]]
>>>>>> >> >>
>>>>>> >> >> _______________________________________________
>>>>>> >> >> R-sig-Geo mailing list
>>>>>> >> >> R-sig-Geo at r-project.org
>>>>>> >> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> >
>>>>>> >
>>>>>> >
>>>>>> >
>>>>>> > --
>>>>>> > --
>>>>>> > Dr. Agustin Lobo
>>>>>> > Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
>>>>>> > Lluis Sole Sabaris s/n
>>>>>> > 08028 Barcelona
>>>>>> > Spain
>>>>>> > Tel. 34 934095410
>>>>>> > Fax. 34 934110012
>>>>>> > e-mail Agustin.Lobo at ictja.csic.es
>>>>>>
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Thu Oct 17 08:19:39 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 17 Oct 2013 17:19:39 +1100
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>
Message-ID: <CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>

I have a similar spec to yours, with i7 instead.

I have successfully read it, but first time it crashed (I think
because memory was exhausted).

It took about 20min.

I would work on subsetting the part you want with an ogr2ogr
incantation if you want to stay away from GIS:
http://www.gdal.org/ogr2ogr.html

QGIS or similar would be able to read / crop this no-sweat, but it
depends on exactly how you want to subset it, and that may be a topic
for another forum

Cheers, Mike

On Thu, Oct 17, 2013 at 2:18 AM, philippe massicotte
<pmassicotte at hotmail.com> wrote:
> Hi everyone.
> I'm trying to open some shapefiles, but the process is still not complete after 25 minutes.  Looking at the shapefiles in ArcGIS, I find that these files have roughly 500K entries. I was wondering if this processing time to open the shapefiles is normal. Here is my configuration:
> Intel i5-2500 @ 3.3 GHz16 GB of RAMWindows 7 (64 bits)
> For information, you can download the shapefiles here:
> http://www.usna.edu/Users/oceano/pguth/srtm/rivers.zip
> Here is my code:
> library(rgdal)shape=readOGR("af_riv_15s.shp", layer="af_riv_15s")
>
> Thank you for your help,Phil
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com


From stevenhuyi at gmail.com  Thu Oct 17 10:53:04 2013
From: stevenhuyi at gmail.com (=?UTF-8?B?6IOh6Im6?=)
Date: Thu, 17 Oct 2013 16:53:04 +0800
Subject: [R-sig-Geo] space-time clustering
Message-ID: <CAFYSUoP+kqjc0nsD-mcXjKUkom78uH-gZDkbLhyfFEneTSa+mQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/957d8484/attachment.pl>

From efisio.solazzo at jrc.ec.europa.eu  Thu Oct 17 11:47:38 2013
From: efisio.solazzo at jrc.ec.europa.eu (efisio solazzo)
Date: Thu, 17 Oct 2013 11:47:38 +0200
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of experiment
	and model
Message-ID: <525FB23A.9080008@jrc.ec.europa.eu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/130ff620/attachment.pl>

From simone.ruzza12 at gmail.com  Thu Oct 17 11:58:51 2013
From: simone.ruzza12 at gmail.com (Simone Ruzza)
Date: Thu, 17 Oct 2013 11:58:51 +0200
Subject: [R-sig-Geo] space-time clustering
In-Reply-To: <CAFYSUoP+kqjc0nsD-mcXjKUkom78uH-gZDkbLhyfFEneTSa+mQ@mail.gmail.com>
References: <CAFYSUoP+kqjc0nsD-mcXjKUkom78uH-gZDkbLhyfFEneTSa+mQ@mail.gmail.com>
Message-ID: <CADZVqobiby6y9GEG9QCLtnXdv2yPmE4EA+bCg6EBrwZ13ZLnAg@mail.gmail.com>

I have asked for the same thing a few days ago. Let's see whether they
reply to you.

Cheers,

Simone


On Thu, Oct 17, 2013 at 10:53 AM, ?? <stevenhuyi at gmail.com> wrote:
> Dear all,
>
> I would like to ask whether there is a package in R that can calculate
> global space-time Moran's I and visualize the local space-time Moran's I.
> Or please recommend any package that explore spatio-temporal clustering
> (for lattice and geostatistical process) . Thanks very much
>
> Best
>
> Yi
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From sarah.goslee at gmail.com  Thu Oct 17 13:14:28 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Thu, 17 Oct 2013 07:14:28 -0400
Subject: [R-sig-Geo] space-time clustering
In-Reply-To: <CADZVqobiby6y9GEG9QCLtnXdv2yPmE4EA+bCg6EBrwZ13ZLnAg@mail.gmail.com>
References: <CAFYSUoP+kqjc0nsD-mcXjKUkom78uH-gZDkbLhyfFEneTSa+mQ@mail.gmail.com>
	<CADZVqobiby6y9GEG9QCLtnXdv2yPmE4EA+bCg6EBrwZ13ZLnAg@mail.gmail.com>
Message-ID: <CAM_vjumH9E=VU_ggy3wdt+hw=j0B6XrK_=SaX-v4j7mGrNZGsw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/8bacc39c/attachment.pl>

From ashton at msu.edu  Thu Oct 17 14:05:16 2013
From: ashton at msu.edu (Ashton Shortridge)
Date: Thu, 17 Oct 2013 08:05:16 -0400
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of
	experiment and model
In-Reply-To: <525FB23A.9080008@jrc.ec.europa.eu>
References: <525FB23A.9080008@jrc.ec.europa.eu>
Message-ID: <2369899.cjO6JZN5Xj@erebus>

Just a thought, but how about using the 'regular' plotting system, and not the 
lattice plotting system?

Then something like:
par(mfrow=c(2,3))
for (i in 6): {
	PLOT EMPIRICAL VARIOGRAM i
	OVERLAY MODEL i
}

Might do the trick? I suggest this because, being efficient (lazy!), I have 
often found it easier to avoiding lattice than to spend time figuring out how 
to use it properly.

Ashton

On Thursday, October 17, 2013 11:47:38 AM efisio solazzo wrote:
> Dear,
> I would like to create a multipanel plot of anisotropic variogram and
> relative model.
> So far I have managed to create either 1. individual plot showing
> experiment and model, or 2. multipanel directional plots where all the
> panels show the correct experiment but the same model.
> 
> Say "vm" is the results of variogram function (six horizontal
> directions) and "auto_Sph" is the result of fitting.
> 
> The function: plot(vm, group.id=TRUE, auto.key=TRUE) returns multipanel
> plots of experimental data, and that is fine.
> 
> Now I'd like to overlay to each panel the respective fitted model. I
> tried with
> 
> for (i in 1:6){  plot(vm,model=auto_Sph[[i]]$var_model, ..., 
> multipanel=TRUE, auto.key=TRUE)},
> 
> but in this case the last model curve (auto_Sph[[6]]$var_model) is
> overlaid to all panels.
> I then tried with:
> 
> vms <- split(vm,vm$dir.hor)
> 
> for (i in 1:6){  plot(vms[[i]],model=auto_Sph[[i]]$var_model, ..., 
> multipanel=TRUE, auto.key=TRUE)},
> 
> but still got the same results.
> 
> I can create each plot separately and then combine them, but I'd like to
> know if there a more efficient way.
> 
> Thanks.
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From pmassicotte at hotmail.com  Thu Oct 17 14:37:59 2013
From: pmassicotte at hotmail.com (philippe massicotte)
Date: Thu, 17 Oct 2013 12:37:59 +0000
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>,
	<CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>
Message-ID: <COL127-W42E43F2B63999F54C53DE5B3050@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/ed0ff2bb/attachment.pl>

From Roger.Bivand at nhh.no  Thu Oct 17 14:51:24 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 17 Oct 2013 14:51:24 +0200
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <COL127-W42E43F2B63999F54C53DE5B3050@phx.gbl>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>,
	<CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>
	<COL127-W42E43F2B63999F54C53DE5B3050@phx.gbl>
Message-ID: <alpine.LRH.2.03.1310171445350.30072@reclus.nhh.no>

On Thu, 17 Oct 2013, philippe massicotte wrote:

> Thank you everyone for your answers. I think I'll just load it and save 
> the workspace for further uses. I still wonder why this is taking such 
> long time to load whereas in QGIS or ArcGIS it is a matter of seconds.

Why do you wonder? You could check instead, taking subsets of the fields, 
and subsets of the features in your object. You could also use alternative 
formats, but I don't think that the choice of driver is important here. 
Note that few statisticians would consider global analysis of data sets 
this large sensible unless very specific conditions were met; the 
additional variability after the first several thousand observations 
probably doesn't tell you much. Once the data are converted to sp classes, 
things go rather faster, as has been pointed out.

Roger

> Have a great day,Phil
>
>> Date: Thu, 17 Oct 2013 17:19:39 +1100
>> Subject: Re: [R-sig-Geo] Long time to load shapefiles
>> From: mdsumner at gmail.com
>> To: pmassicotte at hotmail.com
>> CC: r-sig-geo at r-project.org
>>
>> I have a similar spec to yours, with i7 instead.
>>
>> I have successfully read it, but first time it crashed (I think
>> because memory was exhausted).
>>
>> It took about 20min.
>>
>> I would work on subsetting the part you want with an ogr2ogr
>> incantation if you want to stay away from GIS:
>> http://www.gdal.org/ogr2ogr.html
>>
>> QGIS or similar would be able to read / crop this no-sweat, but it
>> depends on exactly how you want to subset it, and that may be a topic
>> for another forum
>>
>> Cheers, Mike
>>
>> On Thu, Oct 17, 2013 at 2:18 AM, philippe massicotte
>> <pmassicotte at hotmail.com> wrote:
>>> Hi everyone.
>>> I'm trying to open some shapefiles, but the process is still not complete after 25 minutes.  Looking at the shapefiles in ArcGIS, I find that these files have roughly 500K entries. I was wondering if this processing time to open the shapefiles is normal. Here is my configuration:
>>> Intel i5-2500 @ 3.3 GHz16 GB of RAMWindows 7 (64 bits)
>>> For information, you can download the shapefiles here:
>>> http://www.usna.edu/Users/oceano/pguth/srtm/rivers.zip
>>> Here is my code:
>>> library(rgdal)shape=readOGR("af_riv_15s.shp", layer="af_riv_15s")
>>>
>>> Thank you for your help,Phil
>>>
>>>
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>
>> --
>> Michael Sumner
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From pmassicotte at hotmail.com  Thu Oct 17 15:42:16 2013
From: pmassicotte at hotmail.com (philippe massicotte)
Date: Thu, 17 Oct 2013 13:42:16 +0000
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <alpine.LRH.2.03.1310171445350.30072@reclus.nhh.no>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>,
	<CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>
	<COL127-W42E43F2B63999F54C53DE5B3050@phx.gbl>,
	<alpine.LRH.2.03.1310171445350.30072@reclus.nhh.no>
Message-ID: <COL127-W404EECD2CC99D98B60ABCCB3050@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/930d808e/attachment.pl>

From mspinola10 at gmail.com  Thu Oct 17 19:40:42 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 17 Oct 2013 11:40:42 -0600
Subject: [R-sig-Geo] How to make a raster (from a shapefile) with cells
 with forest cover percent.
In-Reply-To: <CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>
References: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>
	<CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>
Message-ID: <CABkCotT1skd5Yr+X-+13mh9Wtuv=_MjVtiLUUhJgno_tPE4BsA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/01aef4ef/attachment.pl>

From mspinola10 at gmail.com  Thu Oct 17 19:43:04 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Thu, 17 Oct 2013 11:43:04 -0600
Subject: [R-sig-Geo] How to make a raster (from a shapefile) with cells
 with forest cover percent.
In-Reply-To: <CALyPt8zd=nDqHSTjv9aU3bCKvHuyr3T2obCh5+MEWJxfOcH5VQ@mail.gmail.com>
References: <CABkCotR9hT6_96ydr=6WkaQJ+SQutYdACwHGffcDNfR_6atx4w@mail.gmail.com>
	<CAPKp32sYV3ooZ9m-hbrbHoBFo7_9xb7x6bhr0w-1AH_tcpcMnA@mail.gmail.com>
	<CALyPt8zd=nDqHSTjv9aU3bCKvHuyr3T2obCh5+MEWJxfOcH5VQ@mail.gmail.com>
Message-ID: <CABkCotQ3ziumaCZKSEcAHn0kSurOV0UyJnDvXh_b38qjruqdBQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/0e141969/attachment.pl>

From tkeitt at utexas.edu  Thu Oct 17 20:53:20 2013
From: tkeitt at utexas.edu (Tim Keitt)
Date: Thu, 17 Oct 2013 13:53:20 -0500
Subject: [R-sig-Geo] Long time to load shapefiles
In-Reply-To: <COL127-W404EECD2CC99D98B60ABCCB3050@phx.gbl>
References: <COL127-W2396CA37881D7B55DD974FB3040@phx.gbl>
	<CAAcGz9_8ZxDrg4Dx8g9yYpW1SHsd-6YTVno9qkyf9tPiU5+Vog@mail.gmail.com>
	<COL127-W42E43F2B63999F54C53DE5B3050@phx.gbl>
	<alpine.LRH.2.03.1310171445350.30072@reclus.nhh.no>
	<COL127-W404EECD2CC99D98B60ABCCB3050@phx.gbl>
Message-ID: <CANnL8gqebE8Lzy+HbZQsqSfsaN6Pj+h4JqkZ=eShMWTfYGDYVw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/4d884501/attachment.pl>

From vincenzoaellis at gmail.com  Fri Oct 18 00:12:52 2013
From: vincenzoaellis at gmail.com (Vincenzo Ellis)
Date: Thu, 17 Oct 2013 17:12:52 -0500
Subject: [R-sig-Geo] projection/coordinate system question
Message-ID: <CAGekO=08_XiMo14bF4hCw9Hk1kqCRPDG8Bj8T1oFNBu=d0S2zA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/147b9a31/attachment.pl>

From michajairos at gmail.com  Fri Oct 18 06:52:05 2013
From: michajairos at gmail.com (Michael Ndwiga)
Date: Fri, 18 Oct 2013 07:52:05 +0300
Subject: [R-sig-Geo] Spatial Panel Multinomial Probit
Message-ID: <CAM9OQr8yvmFJHPZQUO6r9kRXefcZRYDufh1uK_d4_ov3OLYNSg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131018/329def84/attachment.pl>

From Roger.Bivand at nhh.no  Fri Oct 18 08:58:16 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 18 Oct 2013 08:58:16 +0200
Subject: [R-sig-Geo] Spatial Panel Multinomial Probit
In-Reply-To: <CAM9OQr8yvmFJHPZQUO6r9kRXefcZRYDufh1uK_d4_ov3OLYNSg@mail.gmail.com>
References: <CAM9OQr8yvmFJHPZQUO6r9kRXefcZRYDufh1uK_d4_ov3OLYNSg@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310180845180.557@reclus.nhh.no>

Please do read Sarah Goslee's sensible reply to a different thread:

https://stat.ethz.ch/pipermail/r-sig-geo/2013-October/019577.html

see:

https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131017/8bacc39c/attachment.pl

because the thread was in HTML.

Although it is flattering that users seem to believe that all new methods 
are implemented first by "somebody" in R and released as packages, this is 
not the case. Many methods are still unfortunately published as working 
papers or published articles with no implementation (so would nevver be 
published in statistics journals). Those who also write and provide code 
are often sceptical when faced with methods proposals with no way of 
checking whether an implementation actually matches the method.

When asking about new and speculative methods, look first in the usual 
search mechanisms, and if asking on the list, do provide clear and 
complete references to papers/articles so that it is clear what you are 
asking about. Showing whether there is anything like what you ask about is 
also sensible, spatial probit is in the McSpatial and spatialprobit 
packages, but they are neither panel nor multinomial. My guess is that you 
are looking at land use change, but there you probably also need to worry 
about the units of observation, and possible non-linear covariates. A 
brief description (one sentence) of why you are asking also helps.

Hope this clarifies,

Roger

On Fri, 18 Oct 2013, Michael Ndwiga wrote:

> Dear Members,
>
> I am new in R and would like to run a Spatial Panel Multinomial Probit
> model, could someone help me know which package to use in R!
>
> Thank you in advance.
>
> Regards,
> Michael
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jgrn at illinois.edu  Fri Oct 18 22:16:14 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 18 Oct 2013 15:16:14 -0500
Subject: [R-sig-Geo] Any reason to not use brick() on a single-band raster?
Message-ID: <CABG0rfvPs0eh+=TBvSCixwrmR4Ktr0d=wNfoxj4ybFFq2OWfoA@mail.gmail.com>

R-sig-geo'ers:

I was curious: is there any practical reason to not use brick() on a
single-band raster (efficiency hits, for instance)?  The reason I'm
asking is that I'm working on some functions that return a single or a
multi-band output, and rather than doing an if(nlayers(x)==1)
raster(x) else brick(x); I was going to make it easier and just always
returning brick(x).

--j

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From rhijmans at ucdavis.edu  Fri Oct 18 23:49:17 2013
From: rhijmans at ucdavis.edu (Robert J. Hijmans)
Date: Fri, 18 Oct 2013 14:49:17 -0700
Subject: [R-sig-Geo] Any reason to not use brick() on a single-band
	raster?
In-Reply-To: <CABG0rfvPs0eh+=TBvSCixwrmR4Ktr0d=wNfoxj4ybFFq2OWfoA@mail.gmail.com>
References: <CABG0rfvPs0eh+=TBvSCixwrmR4Ktr0d=wNfoxj4ybFFq2OWfoA@mail.gmail.com>
Message-ID: <CANtt_hyZAWHF7uoT_RamVH001ip24yXgVOD9zFqHx8e8TDsWLg@mail.gmail.com>

Jonathan,
I do not thing it would matter much. But there are a few functions
that only work on for a RasterLayer (e.g. focal, distance); so you
would need to coerce the object to a RasterLayer first to use these.
The raster package started with RasterLayer and RasterStack.
RasterBrick was added later. You could argue that this made
RasterLayer obsolete and perhaps it is about time to start
de-emphasizing RasterLayer, i.e. have functions return RasterBrick
objects even if there is only 1 layer, such as you are proposing to
do.
Robert

On Fri, Oct 18, 2013 at 1:16 PM, Jonathan Greenberg <jgrn at illinois.edu> wrote:
> R-sig-geo'ers:
>
> I was curious: is there any practical reason to not use brick() on a
> single-band raster (efficiency hits, for instance)?  The reason I'm
> asking is that I'm working on some functions that return a single or a
> multi-band output, and rather than doing an if(nlayers(x)==1)
> raster(x) else brick(x); I was going to make it easier and just always
> returning brick(x).
>
> --j
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Professor
> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
> Department of Geography and Geographic Information Science
> University of Illinois at Urbana-Champaign
> 259 Computing Applications Building, MC-150
> 605 East Springfield Avenue
> Champaign, IL  61820-6371
> Phone: 217-300-1924
> http://www.geog.illinois.edu/~jgrn/
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Robert J. Hijmans
Associate Professor, Department of Environmental Science and Policy
University of California, Davis
2001 Wickson Hall
(530) 752-6555


From Scott.Waichler at pnnl.gov  Fri Oct 18 23:56:24 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Fri, 18 Oct 2013 14:56:24 -0700
Subject: [R-sig-Geo] Use a PNG image as background for lattice plotting with
	rasterVis
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>

Hi,

I've learned the basics of using RgoogleMaps and rasterVis, and now I want to combine their capabilities to use levelplot() with a georeferenced PNG image as a background in the lattice panel.  And, I want to plot to the normal R graphics devices, not the web as package plotGoogleMaps does.  Can anyone provide an example of how to use the result of RgoogleMaps' GetMap.bbox() as a background image in a plot produced with the rasterVis version of lattice graphics?

Thanks,
Scott Waichler
Pacific Northwest National Laboratory
Richland, WA USA
scott.waichler at pnnl.gov


From r.hijmans at gmail.com  Sat Oct 19 00:34:45 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 18 Oct 2013 15:34:45 -0700
Subject: [R-sig-Geo] Use a PNG image as background for lattice plotting
 with rasterVis
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
Message-ID: <CANtt_hwWiO5ZYE-8FnpJiQR4+jLFoMOaN5EcttRp3EZMrJc50A@mail.gmail.com>

Scott, Here is an Incomplete answer but perhaps useful anyway. You can do:

library(dismo)
g <- gmap("Pacific Northwest National Laboratory, Richland, WA, USA")
plot(g)

# and now you can add points, polygons, lines.
# you can also do

library(rasterVis)
levelplot(g)

This "works" but not as desired; I do not know how to get the colors
come out right; probably something that should be fixed in rasterVis
if this can be done with levelplot.
Robert


On Fri, Oct 18, 2013 at 2:56 PM, Waichler, Scott R
<Scott.Waichler at pnnl.gov> wrote:
> Hi,
>
> I've learned the basics of using RgoogleMaps and rasterVis, and now I want to combine their capabilities to use levelplot() with a georeferenced PNG image as a background in the lattice panel.  And, I want to plot to the normal R graphics devices, not the web as package plotGoogleMaps does.  Can anyone provide an example of how to use the result of RgoogleMaps' GetMap.bbox() as a background image in a plot produced with the rasterVis version of lattice graphics?
>
> Thanks,
> Scott Waichler
> Pacific Northwest National Laboratory
> Richland, WA USA
> scott.waichler at pnnl.gov
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From istazahn at gmail.com  Sat Oct 19 04:18:18 2013
From: istazahn at gmail.com (Ista Zahn)
Date: Fri, 18 Oct 2013 22:18:18 -0400
Subject: [R-sig-Geo] Use a PNG image as background for lattice plotting
 with rasterVis
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
Message-ID: <CA+vqiLGre4f9FGcHi=tyDkG+N_CRfZwvdBGe+B663SHt7ks1rQ@mail.gmail.com>

Hi Scott,

You may be interested in the ggmap package; see
http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf

Best,
Ista

On Fri, Oct 18, 2013 at 5:56 PM, Waichler, Scott R
<Scott.Waichler at pnnl.gov> wrote:
> Hi,
>
> I've learned the basics of using RgoogleMaps and rasterVis, and now I want to combine their capabilities to use levelplot() with a georeferenced PNG image as a background in the lattice panel.  And, I want to plot to the normal R graphics devices, not the web as package plotGoogleMaps does.  Can anyone provide an example of how to use the result of RgoogleMaps' GetMap.bbox() as a background image in a plot produced with the rasterVis version of lattice graphics?
>
> Thanks,
> Scott Waichler
> Pacific Northwest National Laboratory
> Richland, WA USA
> scott.waichler at pnnl.gov
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From oscar.perpinan at gmail.com  Sat Oct 19 10:05:49 2013
From: oscar.perpinan at gmail.com (=?ISO-8859-1?Q?Oscar_Perpi=F1an?=)
Date: Sat, 19 Oct 2013 10:05:49 +0200
Subject: [R-sig-Geo] Use a PNG image as background for lattice plotting
 with rasterVis
In-Reply-To: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
References: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
Message-ID: <CAMLL7bnf+wM7vU5GbUSi=+Ytn4ZY39tbOWCtb09rh_W=ghH6Bw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131019/fb774f7c/attachment.pl>

From cyndyh at nmsu.edu  Sat Oct 19 15:36:07 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Sat, 19 Oct 2013 06:36:07 -0700 (PDT)
Subject: [R-sig-Geo] gpsurvey in R - any users?
Message-ID: <1382189767308-7584897.post@n2.nabble.com>

Hi folks -

Before I go into particulars of my current issues, I thought I would ask -
are there others here using the 'gpsurvey' package in R; particularly the
functions for random spatially balanced sampling?  I am attempting to, and
having difficulties.  Please let me know if you are a user of this package. 
Many thanks!

Cyndy



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gpsurvey-in-R-any-users-tp7584897.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Sat Oct 19 17:08:34 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 19 Oct 2013 10:08:34 -0500
Subject: [R-sig-Geo] Early version of gdalUtils (GDAL Utility Wrappers) now
	on R-forge
Message-ID: <CABG0rfvd=KG7Y+MaWeiBT5ouUL1KyqeCbc4-=ZOAFJ1PU+b43w@mail.gmail.com>

r-sig-geo'ers:

I wanted to draw your attention to the initial release of gdalUtils at:
install.packages("gdalUtils", repos="http://R-Forge.R-project.org")

(https://r-forge.r-project.org/R/?group_id=1695)

Matteo Mattiuzzi and I have been working to provide R wrappers for all
gdal utility programs.  Right now, we have gdal_translate, gdalinfo,
gdalwarp, and gdalsrsinfo completed.

This package uses an *already-installed* GDAL on your system.  You
will need to install one before using this package.  gdalUtils will
search for your GDAL installation the first time you run it.

In the case of Windows boxes, this package provides an easy way to
work with HDF4/5 files if you have had issues with this previously.

For GDAL installations, check out:
http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries

Note that the latest QGIS release
(http://www.qgis.org/en/site/forusers/download.html) provides, as far
as I know, the most up-to-date GDAL binaries for Windows boxes that
also support HDF files.

For Macs, we recommend William Kyngesburye's GDAL Complete Framework:
http://www.kyngchaos.com/software:frameworks

This is not designed to be a replacement for rgdal in any way, rather,
provides direct access to the various GDAL utility programs
(http://gdal.org/gdal_utilities.html).

Please let us know if you have any suggestions/bug reports.  While we
will eventually wrap all of the utility programs up, but if there is
one you would like us to prioritize, let us know that as well!

--jonathan

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From moshersteven at gmail.com  Sun Oct 20 06:16:13 2013
From: moshersteven at gmail.com (steven mosher)
Date: Sat, 19 Oct 2013 21:16:13 -0700
Subject: [R-sig-Geo] Early version of gdalUtils (GDAL Utility Wrappers)
 now on R-forge
In-Reply-To: <CABG0rfvd=KG7Y+MaWeiBT5ouUL1KyqeCbc4-=ZOAFJ1PU+b43w@mail.gmail.com>
References: <CABG0rfvd=KG7Y+MaWeiBT5ouUL1KyqeCbc4-=ZOAFJ1PU+b43w@mail.gmail.com>
Message-ID: <CAFFLneR_GeHq-T6FXH=hSO35f+85FXEq1Ky1AR9QdNS6OcpQEA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131019/8fa02587/attachment.pl>

From jgrn at illinois.edu  Sun Oct 20 18:32:40 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sun, 20 Oct 2013 11:32:40 -0500
Subject: [R-sig-Geo] Early version of gdalUtils (GDAL Utility Wrappers)
 now on R-forge
In-Reply-To: <CAFFLneR_GeHq-T6FXH=hSO35f+85FXEq1Ky1AR9QdNS6OcpQEA@mail.gmail.com>
References: <CABG0rfvd=KG7Y+MaWeiBT5ouUL1KyqeCbc4-=ZOAFJ1PU+b43w@mail.gmail.com>
	<CAFFLneR_GeHq-T6FXH=hSO35f+85FXEq1Ky1AR9QdNS6OcpQEA@mail.gmail.com>
Message-ID: <CABG0rfsYOJTEoqLi0z1NHEGscCzSeapCmVCcrsRxq5NP48wt=w@mail.gmail.com>

For MODIS users (which was, in many ways, the main reason to develop
this package -- Matteo is also one of the developers of the modis
package, incidentally), take a look at:
?get_subdatasets
for use with ?gdal_translate via the sd_index parameter (this is a
value-added parameter, not one that came with the command-line
gdal_translate).

I haven't tested these yet with HDF5 and NetCDF files but, in theory,
they should work since they use the same subdataset naming scheme
(SUBDATASET_n_NAME, where n is the value to pass to sd_index).

As a small note, as requested by a user who contacted me, I added
gdal_rasterize and gdaldem to the list of ported functions last night
(version 0.0.6 or later).  Again, if anyone has a GDAL function they'd
REALLY like to see ported ASAP, kick me an email -- it only takes
about 10-20 minutes to port/document each function at this point (we
wrote some helper functions to build the wrappers).  We'll eventually
get through all of them, but not in the next week.

We'd like to push the initial version to CRAN in a week or so, so let
us know ASAP if there are any bugs!  In particular, we'd really like
to know if our GDAL installation search tool is working (if you have
GDAL installed on your local system, this should search out the latest
version and use it, without you having to do anything).

--j

On Sat, Oct 19, 2013 at 11:16 PM, steven mosher <moshersteven at gmail.com> wrote:
>  Thanks so much for this, I'd managed to rework the runGDAL code from R
> Modis  so that I could work with Glass Albedo
> http://glcf.umd.edu/data/abd/  but it was just an ugly hack, worked, but
> ugly. Looking forward to the package.
>
>
> On Sat, Oct 19, 2013 at 8:08 AM, Jonathan Greenberg <jgrn at illinois.edu>
> wrote:
>>
>> r-sig-geo'ers:
>>
>> I wanted to draw your attention to the initial release of gdalUtils at:
>> install.packages("gdalUtils", repos="http://R-Forge.R-project.org")
>>
>> (https://r-forge.r-project.org/R/?group_id=1695)
>>
>> Matteo Mattiuzzi and I have been working to provide R wrappers for all
>> gdal utility programs.  Right now, we have gdal_translate, gdalinfo,
>> gdalwarp, and gdalsrsinfo completed.
>>
>> This package uses an *already-installed* GDAL on your system.  You
>> will need to install one before using this package.  gdalUtils will
>> search for your GDAL installation the first time you run it.
>>
>> In the case of Windows boxes, this package provides an easy way to
>> work with HDF4/5 files if you have had issues with this previously.
>>
>> For GDAL installations, check out:
>> http://trac.osgeo.org/gdal/wiki/DownloadingGdalBinaries
>>
>> Note that the latest QGIS release
>> (http://www.qgis.org/en/site/forusers/download.html) provides, as far
>> as I know, the most up-to-date GDAL binaries for Windows boxes that
>> also support HDF files.
>>
>> For Macs, we recommend William Kyngesburye's GDAL Complete Framework:
>> http://www.kyngchaos.com/software:frameworks
>>
>> This is not designed to be a replacement for rgdal in any way, rather,
>> provides direct access to the various GDAL utility programs
>> (http://gdal.org/gdal_utilities.html).
>>
>> Please let us know if you have any suggestions/bug reports.  While we
>> will eventually wrap all of the utility programs up, but if there is
>> one you would like us to prioritize, let us know that as well!
>>
>> --jonathan
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Professor
>> Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
>> Department of Geography and Geographic Information Science
>> University of Illinois at Urbana-Champaign
>> 259 Computing Applications Building, MC-150
>> 605 East Springfield Avenue
>> Champaign, IL  61820-6371
>> Phone: 217-300-1924
>> http://www.geog.illinois.edu/~jgrn/
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007


From jmblanco at ub.edu  Sun Oct 20 20:07:11 2013
From: jmblanco at ub.edu (=?ISO-8859-1?Q?=22Jos=E9_M=2E_Blanco_Moreno=22?=)
Date: Sun, 20 Oct 2013 20:07:11 +0200
Subject: [R-sig-Geo] alltypes function in spatstats
Message-ID: <52641BCF.2050100@ub.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131020/9b21934f/attachment.pl>

From roman.lustrik at gmail.com  Sun Oct 20 20:31:17 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sun, 20 Oct 2013 20:31:17 +0200
Subject: [R-sig-Geo] alltypes function in spatstats
In-Reply-To: <52641BCF.2050100@ub.edu>
References: <52641BCF.2050100@ub.edu>
Message-ID: <CAHT1vpg03rATsAkgh14rgCPvxv_rWJJBdUaYCN+SsAnSP0muZA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131020/c3041da8/attachment.pl>

From r.turner at auckland.ac.nz  Sun Oct 20 21:40:33 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 21 Oct 2013 08:40:33 +1300
Subject: [R-sig-Geo] alltypes function in spatstats
In-Reply-To: <52641BCF.2050100@ub.edu>
References: <52641BCF.2050100@ub.edu>
Message-ID: <526431B1.2030902@auckland.ac.nz>


As Roman Lustrik said in another reply to your message, please make your
example ***reproducible***.

That being said, I *was* able to reproduce your error with the pattern 
"demopat"
(after assigning  a value to "nsim" which you did not do in your example).
> check <- alltypes(demopat,fun="Lcross", nsim=99, envelope=T, global = 
> T, verb=T, ginterval=c(0, 12.62), correction='border', rbord=5)

gives

> Error in envelopeEngine(X = X, fun = fun, simul = simrecipe, nsim = 
> nsim,  :
>   object 'csr.theo' not found

just as in your example.

We'll look into it.

     cheers,

     Rolf  Turner

P. S.  This is not relevant to the error given, but it is ***bad 
practice*** to use "T", when
"TRUE" is meant.  The availability of the use of "T" is there just for 
compatibility with Splus,
but such use should be avoided.  The reason is that "T" can be 
overwritten (whereas "TRUE"
cannot) --- with possibly disastrous consequences.  E.g. "T <- FALSE" !!!

     R. T.




On 10/21/13 07:07, "Jos? M. Blanco Moreno" wrote:
> Dear useRs and guRus,
>
> I am trying to rerun an analysis that was previously working (under R2.15 if I recall properly) but when updating to 3.0.1 stopped working, with an error message that I cannot diagnose:
>
> all.nests.hom <- alltypes(ppp.nests, fun="Lcross", nsim=nsim, envelope=T, global = T, verb=T, ginterval=c(0, 12.62), correction='border', rbord=5)
>
> Error in envelopeEngine(X = X, fun = fun, simul = simrecipe, nsim = nsim,  :
>    object 'csr.theo' not found
>
> As far as the code was concerned, I have not changed it a comma; and diving into the envelopeEngine function I cannot tell what is wrong...
>
> Any hint? I have read the documentation (OK, admittedly quickly) but no reference to having to supply anywhere a "crs.theo" object.
>
> Cheers,
>
> Jos?? M. Blanco
>
>> sessionInfo()
> R version 3.0.1 (2013-05-16)
> Platform: x86_64-w64-mingw32/x64 (64-bit)
>
> locale:
> [1] LC_COLLATE=Spanish_Spain.1252  LC_CTYPE=Spanish_Spain.1252
> [3] LC_MONETARY=Spanish_Spain.1252 LC_NUMERIC=C
> [5] LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] grid      stats     graphics  grDevices utils     datasets
> [7] methods   base
>
> other attached packages:
> [1] maptools_0.8-25 lattice_0.20-15 foreign_0.8-56
> [4] spatstat_1.31-3 deldir_0.0-22   mgcv_1.7-24
> [7] rgeos_0.2-19    sp_1.0-11
>
> loaded via a namespace (and not attached):
> [1] Matrix_1.0-12 nlme_3.1-110  tools_3.0.1
>


From tephilippi at gmail.com  Mon Oct 21 06:07:03 2013
From: tephilippi at gmail.com (Tom Philippi)
Date: Sun, 20 Oct 2013 21:07:03 -0700
Subject: [R-sig-Geo] gpsurvey in R - any users?
In-Reply-To: <1382189767308-7584897.post@n2.nabble.com>
References: <1382189767308-7584897.post@n2.nabble.com>
Message-ID: <CALyPt8yY=+J87dMHyGYar149r3LKUZpSz9qa6-_rz0qOqo_58A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131020/a167f7c0/attachment.pl>

From r.turner at auckland.ac.nz  Mon Oct 21 06:26:34 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Mon, 21 Oct 2013 17:26:34 +1300
Subject: [R-sig-Geo] alltypes function in spatstats
In-Reply-To: <52641BCF.2050100@ub.edu>
References: <52641BCF.2050100@ub.edu>
Message-ID: <5264ACFA.4010005@auckland.ac.nz>

On 10/21/13 07:07, "Jos? M. Blanco Moreno" wrote:
> Dear useRs and guRus,
>
> I am trying to rerun an analysis that was previously working (under R2.15 if I recall properly) but when updating to 3.0.1 stopped working, with an error message that I cannot diagnose:
>
> all.nests.hom <- alltypes(ppp.nests, fun="Lcross", nsim=nsim, envelope=T, global = T, verb=T, ginterval=c(0, 12.62), correction='border', rbord=5)
>
> Error in envelopeEngine(X = X, fun = fun, simul = simrecipe, nsim = nsim,  :
>    object 'csr.theo' not found
>
> As far as the code was concerned, I have not changed it a comma; and diving into the envelopeEngine function I cannot tell what is wrong...
>
> Any hint? I have read the documentation (OK, admittedly quickly) but no reference to having to supply anywhere a "crs.theo" object.

We have investigated.  A bug was introduced by some recent revisions to 
the suite of
envelope functions.  The bug is somewhat subtle; it has now been 
repaired (in the latest
version of spatstat  --- 1.34-0) which will be released soon.

     cheers,

     Rolf Turner


From efisio.solazzo at jrc.ec.europa.eu  Mon Oct 21 10:13:16 2013
From: efisio.solazzo at jrc.ec.europa.eu (solazef)
Date: Mon, 21 Oct 2013 01:13:16 -0700 (PDT)
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of
	experiment and model
In-Reply-To: <2369899.cjO6JZN5Xj@erebus>
References: <525FB23A.9080008@jrc.ec.europa.eu> <2369899.cjO6JZN5Xj@erebus>
Message-ID: <1382343196318-7584906.post@n2.nabble.com>

HI, thanks for the tip, but it doesn't apply to my case (at least I have not
been able to make it works), as I need to plot a model. 

After further trying with: 

xyplot(gamma~dist | dir.hor, data = vm, model=auto_Sph_h[[i]]$var_model)

still I cannot produce what I am after, as the model's curves are not
overlayed to the multipanel data.

Possibly I need to resort to some lattice panel function...any suggestions
please?

thanks. 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gstat-anisotropy-multipanel-plotting-of-experiment-and-model-tp7584877p7584906.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Mon Oct 21 11:06:03 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 21 Oct 2013 11:06:03 +0200
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of
 experiment and model
In-Reply-To: <1382343196318-7584906.post@n2.nabble.com>
References: <525FB23A.9080008@jrc.ec.europa.eu> <2369899.cjO6JZN5Xj@erebus>
	<1382343196318-7584906.post@n2.nabble.com>
Message-ID: <5264EE7B.5000303@uni-muenster.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

did you try:

library(gstat)
example(plot.gstatVariogram)

what, relative to the plots produced there, are you missing?

On 10/21/2013 10:13 AM, solazef wrote:
> HI, thanks for the tip, but it doesn't apply to my case (at least I
> have not been able to make it works), as I need to plot a model.
> 
> After further trying with:
> 
> xyplot(gamma~dist | dir.hor, data = vm,
> model=auto_Sph_h[[i]]$var_model)
> 
> still I cannot produce what I am after, as the model's curves are
> not overlayed to the multipanel data.
> 
> Possibly I need to resort to some lattice panel function...any
> suggestions please?
> 
> thanks.
> 
> 
> 
> -- View this message in context:
> http://r-sig-geo.2731867.n2.nabble.com/gstat-anisotropy-multipanel-plotting-of-experiment-and-model-tp7584877p7584906.html
>
> 
Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________ R-sig-Geo mailing
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

- -- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.17 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - http://www.enigmail.net/

iJwEAQECAAYFAlJk7nsACgkQwuBcK7U/OXPTUQP/cWDGcFsEsuJZpdyI3X0/6mIO
JBqfMYjTvfE1pjvjR9wHeW1waecNYYFu3y0Qp/7qP/IvovtPLETUJOG3dRrrHYCF
ZdTwJcBUuz4YcotYuQBlf0W5drZGH25A/JafoDKlwynKzj7OBACMnzAkEuRiFF6m
anRmQY0x0njJ9ufSHUw=
=uXQ2
-----END PGP SIGNATURE-----


From matteo.mattiuzzi at boku.ac.at  Mon Oct 21 12:49:22 2013
From: matteo.mattiuzzi at boku.ac.at (Matteo Mattiuzzi)
Date: Mon, 21 Oct 2013 12:49:22 +0200
Subject: [R-sig-Geo] MODIS EVI time series missing data interpolation
 (linear or whittaker.raster)
In-Reply-To: <525AA3DC.8090609@uni-bonn.de>
References: <525AA3DC.8090609@uni-bonn.de>
Message-ID: <526522D2020000270001D1E7@gwia2.boku.ac.at>

Mohammad,read answers inline

>>> Mohammad Abdel-Razek <abdelrazek at uni-bonn.de> 10/13/13 3:46 PM >>>
Dear All,
I am analyzing MODIS EVI time sereis for 2004-2010. Preprocessing 
included: reprojecting to WGS84 and export EVI to Geotiff (along with 
blue reflectance and view zenith angel). Then I filtered out cloudy  
(blue reflectance more than 10%) and off-nadir (angel > 32.5) pixels. 
Now, I am trying to interpolate the missing values, so I tried the 
following:

- MODIS EVI (MOD13Q1??) eventually has quality layers with a good cloud info! (see the MODIS:::detectBitinfo function:  detectBitInfo("MOD13Q1") # the VI usefulness. and MODIS:::extractBits to access this info.

#first linear interpolation
#convert Tiffs to points (rasterToPoints)
 > r01 <- raster("2004001_evi_filtered.tif")/10000
 >r01_p <- rasterToPoints(r89,fun=function(x){x>-0.9999})
#Then bind EVI columns, along with X,Y coordinates:
 >evi <- rbind ( EVI2004_1_1=r01_p[,3], EVI2004_1_17=r02_p[,3], 
.......,X= r153_p[,1], Y= r153_p[,2] )
#set 0 values to NA
 >evi[evi == 0] <- NA
 >evi=interpNA(evi, method = "linear")

- please be precise, in which package is 'interpNA'

then I transposed the evi to plot it with plotKML


Now I am trying to use alternative interpolation method for better 
results. MODIS package offer whittaker.raster filtering algorithm

 >evi2 = preStack(pattern = "*.tif", path = "path/to/file")
 >timeInfo <- orgTime(evi2,nDays=16,begin="2004001",end="2010241",pillow=40)
 >evi2 <- preStack(files=evi2,timeInfo=timeInfo)
 >beginCluster(type="SOCK",exclude="MODIS") # See: ?beginCluster
 >system.time(whittaker.raster(evi2,timeInfo=timeInfo,lambda=1000))

My questions are:
1. Is the modified whittaker filter functionreally suitable for 
interpolation in my case?
- yes the whittaker implementation in the MODIS package is suitable for all (?) time series where the bias is negative, where you can expect that if data is of bad quality (ie some clouds) the error is negatively biased, or that data with higher values is probably of better quality than lower values. For more details please check the publication in ?whittaker.raster. 

2. How to destack the resulting GeoTiffs (from whittaker.raster)? I want 
to plot the series using plotKML to visualize the results
- yes I know this should be possible, but isn't implemented, but you could do writeRaster(...,bylayer=T) after filtering.   


3. Some researchers suggested wavelet transformation to smooth the data, 
is that comprable to whittaker function?
- Sorry I don't know, but I think recent publications are going more in direction of spline like methods (whittaker, savitzky-golay, smooth spline,...).

Thank you in advance

Mohammad

p.s. I am new to r and would appreciate simple explanations!

Good luck
Matteo



-- 
PhD Candidate
Institute of Crop Science and Resource Protection
Crop Science Research Group
Katzenburgweg 5 - 53115 Bonn - Germany
Tel.: +49 (0) 228 73 2030     Fax: +49 (0) 228 73 2870
abdelrazek at uni-bonn.de        http://www.lap.uni-bonn.de


    [[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From cyndyh at nmsu.edu  Mon Oct 21 14:02:14 2013
From: cyndyh at nmsu.edu (cyndy-jer)
Date: Mon, 21 Oct 2013 05:02:14 -0700 (PDT)
Subject: [R-sig-Geo] gpsurvey in R - any users?
In-Reply-To: <1382189767308-7584897.post@n2.nabble.com>
References: <1382189767308-7584897.post@n2.nabble.com>
Message-ID: <1382356934046-7584909.post@n2.nabble.com>

Tom - This is precisely the kind of info I was looking for; yes I am using
spsurvey upon recommendation of my boss.  I managed to find the package, but
somehow my Googling did not turn up the links you provided.  This should
help tremendously; thank you!

Cyndy



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gpsurvey-in-R-any-users-tp7584897p7584909.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jbechara at lri-lb.org  Mon Oct 21 17:08:07 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Mon, 21 Oct 2013 18:08:07 +0300
Subject: [R-sig-Geo] crop
Message-ID: <003801cece6f$5be689d0$13b39d70$@lri-lb.org>

Can we crop a shapefile using and extent?

I mean without creating a blank shapefile with the extent.

 

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/596b09fa/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/596b09fa/attachment.jpe>

From vitale232 at gmail.com  Mon Oct 21 20:03:48 2013
From: vitale232 at gmail.com (Andrew Vitale)
Date: Mon, 21 Oct 2013 11:03:48 -0700
Subject: [R-sig-Geo] projection/coordinate system question
In-Reply-To: <CAGekO=08_XiMo14bF4hCw9Hk1kqCRPDG8Bj8T1oFNBu=d0S2zA@mail.gmail.com>
References: <CAGekO=08_XiMo14bF4hCw9Hk1kqCRPDG8Bj8T1oFNBu=d0S2zA@mail.gmail.com>
Message-ID: <CAFTcopcEEdDDzawjs2fneCMj2FhEBujFGjJVJoSEKbz3MKskSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/10ab7e66/attachment.pl>

From Scott.Waichler at pnnl.gov  Mon Oct 21 20:15:52 2013
From: Scott.Waichler at pnnl.gov (Waichler, Scott R)
Date: Mon, 21 Oct 2013 11:15:52 -0700
Subject: [R-sig-Geo] Use a PNG image as background for lattice plotting
 with rasterVis
In-Reply-To: <CAMLL7bnf+wM7vU5GbUSi=+Ytn4ZY39tbOWCtb09rh_W=ghH6Bw@mail.gmail.com>
References: <A632B3F93D861843A3C966F3962C3F840148B25E94E3@EMAIL05.pnl.gov>
	<CAMLL7bnf+wM7vU5GbUSi=+Ytn4ZY39tbOWCtb09rh_W=ghH6Bw@mail.gmail.com>
Message-ID: <A632B3F93D861843A3C966F3962C3F840148B25E9568@EMAIL05.pnl.gov>

Thank you, Oscar.  The use of sp.layout in your web example was the key for me.  I hadn't worked with ggmap until now, but the added features it has over RgoogleMaps are quite helpful, and unlike RgoogleMaps, all of the arguments for ggmap functions are explained in the help.  

Regards,
Scott Waichler


> -----Original Message-----
> From: Oscar Perpi?an [mailto:oscar.perpinan at gmail.com]
> Sent: Saturday, October 19, 2013 1:06 AM
> To: Waichler, Scott R
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Use a PNG image as background for lattice
> plotting with rasterVis
> 
> Hello,
> Let's suppose that 'gmap' is the image resulting from a GetMap.bbox() call
> and 'r' is your Raster*.? A suitable solution is:
> library(rasterVis)
> levelplot(r) + layer_(grid.raster(gmap,
> ???????????????????????????????????????????????????????????? x=lonCenter,
> y=latCenter,
> ???????????????????????????????????????????????????????????? width=width,
> height=height,
> 
> default.units='native'))
> The 'lonCenter', 'latCenter', 'width' and 'height' parameters have to be
> extracted from the image attributes. In the next links you will find an
> example using ggmap (which is built upon RgoogleMaps). Between lines 17
> and 25 you will find details to extract them:
> https://gist.github.com/oscarperpinan/5451682
> http://procomun.wordpress.com/2013/04/24/stamen-maps-with-spplot/
> 
> Perhaps you will have to play with the 'alpha' values to mix the result of
> levelplot and grid.raster.
> Best,
> Oscar Perpi??n Lamigueiro
> Grupo de Sistemas Fotovoltaicos (IES-UPM)
> Dpto. Ingenier?a El?ctrica (EUITI-UPM)
> URL: http://oscarperpinan.github.io
> Twitter: @oscarperpinan
> LinkedIn: http://es.linkedin.com/in/oscarperpinan
> El 18/10/2013 23:56, "Waichler, Scott R" <Scott.Waichler at pnnl.gov>
> escribi?:
> Hi,
> 
> I've learned the basics of using RgoogleMaps and rasterVis, and now I want
> to combine their capabilities to use levelplot() with a georeferenced PNG
> image as a background in the lattice panel. ?And, I want to plot to the
> normal R graphics devices, not the web as package plotGoogleMaps does.
> ?Can anyone provide an example of how to use the result of RgoogleMaps'
> GetMap.bbox() as a background image in a plot produced with the rasterVis
> version of lattice graphics?
> 
> Thanks,
> Scott Waichler
> Pacific Northwest National Laboratory
> Richland, WA USA
> scott.waichler at pnnl.gov
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From avi3187 at gmail.com  Mon Oct 21 21:20:49 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Mon, 21 Oct 2013 13:20:49 -0600
Subject: [R-sig-Geo] Problems with Kcross.inhom
Message-ID: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/ebb6430e/attachment.pl>

From juliachacon at gmail.com  Mon Oct 21 21:25:13 2013
From: juliachacon at gmail.com (Julia Chacon Labella)
Date: Mon, 21 Oct 2013 21:25:13 +0200
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
Message-ID: <CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/0b6e391a/attachment.pl>

From rhurlin at gwdg.de  Mon Oct 21 21:27:59 2013
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Mon, 21 Oct 2013 21:27:59 +0200
Subject: [R-sig-Geo] Does sp::coordinates() behave correct?
Message-ID: <5265803F.4090302@gwdg.de>

I am using  'coordinates(x) <- ~x+y'  to convert data.frames into
SpatialPointsDataFrames.

It seems, that some coordinates will be rounded(?), when they are
transformed by coordinates():


library(maptools)

# Defining some Datapoints with coordinates
gis.k <- data.frame(name=c("K0001","K0002","K0016","K0020"),
                    rsoll=c(3469125,3469375,3471875,3472500),
                    hsoll=c(5521625,5521125,5522875,5524510))

# Converting them into a SpatialPointsDataFrame
gis.k$x <- gis.k$rsoll
gis.k$y <- gis.k$hsoll
coordinates(gis.k) <- ~x+y

# Show contents of new SpatialPointsDataFrame
gis.k
         coordinates  name   rsoll   hsoll
1 (3469120, 5521620) K0001 3469125 5521625
2 (3469380, 5521120) K0002 3469375 5521125
3 (3471880, 5522880) K0016 3471875 5522875
4 (3472500, 5524510) K0020 3472500 5524510


In lines 1 to 3 the coordinates from rsoll and hsoll are rounded, for
example 3469125 into 3469120 and 3471875 into 3471880. (In some cases
they are rounded up, in others round down?) Only coordinates with last
digit =0 are not changed.

Is this an expected behaviour and if this is right, why? If not, what
would be the correct solution to convert these coordinates? Or do I
missunderstand something here.

Any help is appreciated. Thanks in advance,
Rainer Hurling


From sarah.goslee at gmail.com  Mon Oct 21 21:31:43 2013
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Mon, 21 Oct 2013 15:31:43 -0400
Subject: [R-sig-Geo] Does sp::coordinates() behave correct?
In-Reply-To: <5265803F.4090302@gwdg.de>
References: <5265803F.4090302@gwdg.de>
Message-ID: <CAM_vju=oTObMV3zu1PRJn2HEz_gZOcbJuPkL5ysD1oFEK+poAw@mail.gmail.com>

Hi,

It's purely a printing issue; the coordinates are unchanged:

> coordinates(gis.k)
           x       y
[1,] 3469125 5521625
[2,] 3469375 5521125
[3,] 3471875 5522875
[4,] 3472500 5524510

A number of print methods in R round things to 'look nice', which can
lead to unexpected side-effects, like confused users.

Thanks for the short reproducible example; much appreciated.

Sarah

On Mon, Oct 21, 2013 at 3:27 PM, Rainer Hurling <rhurlin at gwdg.de> wrote:
> I am using  'coordinates(x) <- ~x+y'  to convert data.frames into
> SpatialPointsDataFrames.
>
> It seems, that some coordinates will be rounded(?), when they are
> transformed by coordinates():
>
>
> library(maptools)
>
> # Defining some Datapoints with coordinates
> gis.k <- data.frame(name=c("K0001","K0002","K0016","K0020"),
>                     rsoll=c(3469125,3469375,3471875,3472500),
>                     hsoll=c(5521625,5521125,5522875,5524510))
>
> # Converting them into a SpatialPointsDataFrame
> gis.k$x <- gis.k$rsoll
> gis.k$y <- gis.k$hsoll
> coordinates(gis.k) <- ~x+y
>
> # Show contents of new SpatialPointsDataFrame
> gis.k
>          coordinates  name   rsoll   hsoll
> 1 (3469120, 5521620) K0001 3469125 5521625
> 2 (3469380, 5521120) K0002 3469375 5521125
> 3 (3471880, 5522880) K0016 3471875 5522875
> 4 (3472500, 5524510) K0020 3472500 5524510
>
>
> In lines 1 to 3 the coordinates from rsoll and hsoll are rounded, for
> example 3469125 into 3469120 and 3471875 into 3471880. (In some cases
> they are rounded up, in others round down?) Only coordinates with last
> digit =0 are not changed.
>
> Is this an expected behaviour and if this is right, why? If not, what
> would be the correct solution to convert these coordinates? Or do I
> missunderstand something here.
>
> Any help is appreciated. Thanks in advance,
> Rainer Hurling
>

-- 
Sarah Goslee
http://www.functionaldiversity.org


From rhurlin at gwdg.de  Mon Oct 21 21:41:38 2013
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Mon, 21 Oct 2013 21:41:38 +0200
Subject: [R-sig-Geo] Does sp::coordinates() behave correct?
In-Reply-To: <CAM_vju=oTObMV3zu1PRJn2HEz_gZOcbJuPkL5ysD1oFEK+poAw@mail.gmail.com>
References: <5265803F.4090302@gwdg.de>
	<CAM_vju=oTObMV3zu1PRJn2HEz_gZOcbJuPkL5ysD1oFEK+poAw@mail.gmail.com>
Message-ID: <52658372.1020700@gwdg.de>

Hi Sarah,

thanks for clearing this up and the very fast answer.

Greetings from G?ttingen in Germany,
Rainer


Am 21.10.2013 21:31, schrieb Sarah Goslee:
> Hi,
> 
> It's purely a printing issue; the coordinates are unchanged:
> 
>> coordinates(gis.k)
>            x       y
> [1,] 3469125 5521625
> [2,] 3469375 5521125
> [3,] 3471875 5522875
> [4,] 3472500 5524510
> 
> A number of print methods in R round things to 'look nice', which can
> lead to unexpected side-effects, like confused users.
> 
> Thanks for the short reproducible example; much appreciated.
> 
> Sarah
> 
> On Mon, Oct 21, 2013 at 3:27 PM, Rainer Hurling <rhurlin at gwdg.de> wrote:
>> I am using  'coordinates(x) <- ~x+y'  to convert data.frames into
>> SpatialPointsDataFrames.
>>
>> It seems, that some coordinates will be rounded(?), when they are
>> transformed by coordinates():
>>
>>
>> library(maptools)
>>
>> # Defining some Datapoints with coordinates
>> gis.k <- data.frame(name=c("K0001","K0002","K0016","K0020"),
>>                     rsoll=c(3469125,3469375,3471875,3472500),
>>                     hsoll=c(5521625,5521125,5522875,5524510))
>>
>> # Converting them into a SpatialPointsDataFrame
>> gis.k$x <- gis.k$rsoll
>> gis.k$y <- gis.k$hsoll
>> coordinates(gis.k) <- ~x+y
>>
>> # Show contents of new SpatialPointsDataFrame
>> gis.k
>>          coordinates  name   rsoll   hsoll
>> 1 (3469120, 5521620) K0001 3469125 5521625
>> 2 (3469380, 5521120) K0002 3469375 5521125
>> 3 (3471880, 5522880) K0016 3471875 5522875
>> 4 (3472500, 5524510) K0020 3472500 5524510
>>
>>
>> In lines 1 to 3 the coordinates from rsoll and hsoll are rounded, for
>> example 3469125 into 3469120 and 3471875 into 3471880. (In some cases
>> they are rounded up, in others round down?) Only coordinates with last
>> digit =0 are not changed.
>>
>> Is this an expected behaviour and if this is right, why? If not, what
>> would be the correct solution to convert these coordinates? Or do I
>> missunderstand something here.
>>
>> Any help is appreciated. Thanks in advance,
>> Rainer Hurling
>>
>


From r.turner at auckland.ac.nz  Mon Oct 21 22:52:55 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 22 Oct 2013 09:52:55 +1300
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
Message-ID: <52659427.3050700@auckland.ac.nz>



Please provide a self-contained reproducible example.

     cheers,

     Rolf Turner

On 10/22/13 08:20, David Villalobos wrote:
> Hi everyone, I have two questions
>
> First: Some one can help me with an error with Kcross.inhom function. The
> error message is the following: "Error in Kwtsum(dclose, bI, weight, b,
> 1/lambdaI, breaks) :  Weights in K-function were infinite or NA". I really
> apreciate any advise.
>
> Second: Can I apply a simulation envelopes of a summary function for a
> Kcross.inhom analysis?.


From mspinola10 at gmail.com  Mon Oct 21 23:11:00 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Mon, 21 Oct 2013 15:11:00 -0600
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
Message-ID: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/843f881e/attachment.pl>

From avi3187 at gmail.com  Mon Oct 21 23:16:13 2013
From: avi3187 at gmail.com (david.villalobos)
Date: Mon, 21 Oct 2013 14:16:13 -0700 (PDT)
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
Message-ID: <1382390173833-7584920.post@n2.nabble.com>

Sure Julia, 

First: 

I have the following object called "Z" 

> Z <- ppp(north, west,window=W,marks=tipo)

> summary(Z)
Marked planar point pattern: 201 points
Average intensity 4.46e-05 points per square unit  

Coordinates are integers 
i.e. rounded to the nearest 1 unit  

Multitype:
       frequency proportion intensity
ficus        131      0.652  2.90e-05
tienda        70      0.348  1.55e-05

Window: polygonal boundary
single connected closed polygon with 1716 vertices
enclosing rectangle: [484546.8, 487897.4] x [1147521.3, 1153682.9] units 
Window area =  4509680 square units 

Second: 

I calculated the bandwidth sigma for the kernel estimator of point process
intensity with a Cross Validated Bandwidth Selection for Kernel Density
(bw.diggle)

> attach(split(Z))
> f<-bw.diggle(ficus)
> t<-bw.diggle(tienda)

Third:

I calculated with the Kernel Smoothed Intensity of Point Pattern
(density.ppp) the values of the the estimated intensity of the sub-process
of points of type i and j: 

> lambdaf<-density.ppp(ficus,f,at="points")
> lambdat<-density.ppp(tienda,t,at="points")

and Finally:

I ran the script for Kcross.inhom for the method (1): estimate intensities
by nonparametric smoothing, but I had the error.

> K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) : 
  Weights in K-function were infinite or NA

I tryed the method (2): leave-one-out, but I had the same problems

Any help is appreciated. A lot of thanks.






--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jmblanco at ub.edu  Mon Oct 21 23:37:07 2013
From: jmblanco at ub.edu (=?ISO-8859-1?Q?=22Jos=E9_M=2E_Blanco_Moreno=22?=)
Date: Mon, 21 Oct 2013 23:37:07 +0200
Subject: [R-sig-Geo] alltypes function in spatstats
In-Reply-To: <5264ACFA.4010005@auckland.ac.nz>
References: <52641BCF.2050100@ub.edu> <5264ACFA.4010005@auckland.ac.nz>
Message-ID: <52659E83.6050503@ub.edu>

Dear Rolf, Roman, and list-Users,

First of all accept my most sincere excuses: I tend to be cautious when
asking to the list, but somehow (well, I know how: being hasty and not
careful enough) I forgot attaching the example dataset.
I'm glad to know that the problem was not in the data being used,
because when I tested again the procedure I thought that I had done
something wrong.
Furthermore, thank you very much for your bona fide advice on the use of
T and TRUE; I will try to incorporate it, although many years of *bad
practice* may be difficult to straighten.

Best wishes,

Jos? M.

--
---------------------------------------
Jos? M. Blanco-Moreno
Dept. de Biologia Vegetal (Bot?nica)
Facultat de Biologia
Universitat de Barcelona
Av. Diagonal 643
08028 Barcelonat
SPAIN
---------------------------------------
phone: (+34) 934 039 863
fax: (+34) 934 112 842
---------------------------------------



Aquest correu electr?nic i els annexos poden contenir informaci? confidencial o protegida legalment i est? adre?at exclusivament a la persona o entitat destinat?ria. Si no sou el destinatari final o la persona encarregada de rebre?l, no esteu autoritzat a llegir-lo, retenir-lo, modificar-lo, distribuir-lo, copiar-lo ni a revelar-ne el contingut. Si heu rebut aquest correu electr?nic per error, us preguem que n?informeu al remitent i que elimineu del sistema el missatge i el material annex que pugui contenir. Gr?cies per la vostra col?laboraci?.

Este correo electr?nico y sus anexos pueden contener informaci?n confidencial o legalmente protegida y est? exclusivamente dirigido a la persona o entidad destinataria. Si usted no es el destinatario final o la persona encargada de recibirlo, no est? autorizado a leerlo, retenerlo, modificarlo, distribuirlo, copiarlo ni a revelar su contenido. Si ha recibido este mensaje electr?nico por error, le rogamos que informe al remitente y elimine del sistema el mensaje y el material anexo que pueda contener. Gracias por su colaboraci?n.

This email message and any documents attached to it may contain confidential or legally protected material and are intended solely for the use of the individual or organization to whom they are addressed. We remind you that if you are not the intended recipient of this email message or the person responsible for processing it, then you are not authorized to read, save, modify, send, copy or disclose any of its contents. If you have received this email message by mistake, we kindly ask you to inform the sender of this and to eliminate both the message and any attachments it carries from your account. Thank you for your collaboration.


From mdsumner at gmail.com  Tue Oct 22 00:04:49 2013
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 22 Oct 2013 09:04:49 +1100
Subject: [R-sig-Geo] crop
In-Reply-To: <003801cece6f$5be689d0$13b39d70$@lri-lb.org>
References: <003801cece6f$5be689d0$13b39d70$@lri-lb.org>
Message-ID: <CAAcGz99Ze=HY96sNxxV=4ehN0dbKGcZsTteY8HXAY3uWvLaKqw@mail.gmail.com>

You can crop SpatialPolygons/Lines/Points* object using gIntersection in
the rgeos package. You cannot crop a "shapefile" without reading it into sp
classes, and re-writing (or overwriting) a new file. (These objects are
*not* 'shapefiles' once they are in R.)

If you just mean to crop with a bounding box, raster gives a
fast/convenient way to generate the object by coercing from an extent():

Here's an untested hint
library(rgdal)
library(raster)
library(rgeos)

## the rgdal part
d <- readOGR("/path/to/shpdir", "shpname")

## the raster part
## define a crop bounds with xmin/xmax/ymin/ymax
epoly <- as(extent(xmin, xmax, ymin, ymax), "SpatialPolygons")

## (assuming your extents really are in d's projection)
proj4string(epoly) <- CRS(proj4string(d))

## the rgeos part
cropped <- gIntersection(d, epoly, byid = TRUE)

Otherwise there are too many options and vagaries of different scenarios to
cover in the abstract, I suggest trying something like this and then come
back with details about what you tried, what you have and expect.

HTH

Cheers, Mike.



On Tue, Oct 22, 2013 at 2:08 AM, Joseph Bechara <jbechara at lri-lb.org> wrote:

> Can we crop a shapefile using and extent?****
>
> I mean without creating a blank shapefile with the extent.****
>
> ** **
>
> ** **
>
> ** **
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Program Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon**
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> [image: Description: Description: LRI-logo-Email]****
>
> ** **
>
> ** **
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


-- 
Michael Sumner
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/3662e2e1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/3662e2e1/attachment.jpe>

From geotheory1 at gmail.com  Tue Oct 22 00:07:09 2013
From: geotheory1 at gmail.com (Robin Edwards)
Date: Mon, 21 Oct 2013 15:07:09 -0700 (PDT)
Subject: [R-sig-Geo] Reading multiple layer/geometry KML into R
Message-ID: <1382393229600-7584922.post@n2.nabble.com>

I'm vaguely aware there is an issue with reading KML files into R that have
contain layers/geometries - e.g. as Barry describes in  this r-sig-geo post
<http://r-sig-geo.2731867.n2.nabble.com/convert-KML-file-into-shape-file-or-CSV-file-td4136757.html> 
, listing one particular problem as arising when "the individual KMZ files
which do contain the data have multiple layers".  Is there any way around
this, or is it insurmountable with rgeos as it stands?

A reproducible example:

library(rgdal)
setwd( {SPECIFY A FOLDER} )
download.file("http://www.scribblemaps.com/maps/kml/shackleton.kml",
"file.kml")
(lyr = ogrListLayers("file.kml"))
map = readOGR ("file.kml", layer=lyr, verbose = TRUE,
drop_unsupported_fields=T, dropNULLGeometries=T)

yields errors in Windows & Mac:

Windows: Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
use_iconv = use_iconv) : 
  Cannot open layer
OSX: Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
use_iconv = use_iconv) : 
  Multiple incompatible geometries: 1:2

Thanks in advance.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Reading-multiple-layer-geometry-KML-into-R-tp7584922.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.turner at auckland.ac.nz  Tue Oct 22 00:48:05 2013
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 22 Oct 2013 11:48:05 +1300
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <1382390173833-7584920.post@n2.nabble.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
	<1382390173833-7584920.post@n2.nabble.com>
Message-ID: <5265AF25.3010407@auckland.ac.nz>



Again, your problem is not reproducible.  We do not have the objects
"north", "west", "W" and "tipo" which are necessary to duplicate your
steps.

I tried to reproduce your problem with an artificial example:

W <- owin(c(0,3350),c(0,6150))
set.seed(42)
Z <- runifpoint(201,win=W)
m <- sample(rep(c("ficus","tienda"),c(131,70)),201)
marks(Z) <- factor(m)
ff <- with(split(Z),bw.diggle(ficus))
tt <- with(split(Z),bw.diggle(tienda))
lambdaf <- with(split(Z),density(ficus,ff,at="points"))
lambdat <- with(split(Z),density(tienda,tt,at="points"))
K <- Kcross.inhom(Z,"ficus","tienda",lambdaf,lambdat)

No problema.

It is possible that the error has something to do with the rather intricate
(1716 vertices) boundary of your observation window.  However since I don't
have that window I can't tell.

cheers,

Rolf Turner


On 10/22/13 10:16, david.villalobos wrote:
> Sure Julia,
>
> First:
>
> I have the following object called "Z"
>
>> Z <- ppp(north, west,window=W,marks=tipo)
>> summary(Z)
> Marked planar point pattern: 201 points
> Average intensity 4.46e-05 points per square unit
>
> Coordinates are integers
> i.e. rounded to the nearest 1 unit
>
> Multitype:
>         frequency proportion intensity
> ficus        131      0.652  2.90e-05
> tienda        70      0.348  1.55e-05
>
> Window: polygonal boundary
> single connected closed polygon with 1716 vertices
> enclosing rectangle: [484546.8, 487897.4] x [1147521.3, 1153682.9] units
> Window area =  4509680 square units
>
> Second:
>
> I calculated the bandwidth sigma for the kernel estimator of point process
> intensity with a Cross Validated Bandwidth Selection for Kernel Density
> (bw.diggle)
>
>> attach(split(Z))
>> f<-bw.diggle(ficus)
>> t<-bw.diggle(tienda)
> Third:
>
> I calculated with the Kernel Smoothed Intensity of Point Pattern
> (density.ppp) the values of the the estimated intensity of the sub-process
> of points of type i and j:
>
>> lambdaf<-density.ppp(ficus,f,at="points")
>> lambdat<-density.ppp(tienda,t,at="points")
> and Finally:
>
> I ran the script for Kcross.inhom for the method (1): estimate intensities
> by nonparametric smoothing, but I had the error.
>
>> K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
> Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) :
>    Weights in K-function were infinite or NA
>
> I tryed the method (2): leave-one-out, but I had the same problems
>
> Any help is appreciated. A lot of thanks.
>
>
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Tue Oct 22 00:49:48 2013
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 21 Oct 2013 23:49:48 +0100
Subject: [R-sig-Geo] Reading multiple layer/geometry KML into R
In-Reply-To: <9cc042be506e4fdfbfddf924276b0c1c@EX-0-HT0.lancs.local>
References: <9cc042be506e4fdfbfddf924276b0c1c@EX-0-HT0.lancs.local>
Message-ID: <CANVKczOr1Oo_h-3hgPwqXF82XbRpA7gKFD=Boe-psyfAA3QsZw@mail.gmail.com>

On Mon, Oct 21, 2013 at 11:07 PM, Robin Edwards <geotheory1 at gmail.com> wrote:
> I'm vaguely aware there is an issue with reading KML files into R that have
> contain layers/geometries - e.g. as Barry describes in  this r-sig-geo post
> <http://r-sig-geo.2731867.n2.nabble.com/convert-KML-file-into-shape-file-or-CSV-file-td4136757.html>
> , listing one particular problem as arising when "the individual KMZ files
> which do contain the data have multiple layers".  Is there any way around
> this, or is it insurmountable with rgeos as it stands?
>
> A reproducible example:
>
> library(rgdal)
> setwd( {SPECIFY A FOLDER} )
> download.file("http://www.scribblemaps.com/maps/kml/shackleton.kml",
> "file.kml")
> (lyr = ogrListLayers("file.kml"))
> map = readOGR ("file.kml", layer=lyr, verbose = TRUE,
> drop_unsupported_fields=T, dropNULLGeometries=T)
>
> yields errors in Windows & Mac:
>
> Windows: Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
> use_iconv = use_iconv) :
>   Cannot open layer
> OSX: Error in ogrInfo(dsn = dsn, layer = layer, encoding = encoding,
> use_iconv = use_iconv) :
>   Multiple incompatible geometries: 1:2

 The problem here is that the one layer has both points and line features.

 If you edit the KML with a text editor you'll see <point> tags and a
<linestring> tag. R's spatial classes can't handle data that mixes
points, lines, or polygons and so it fails.

 This one is quite easy to fix by hand - just cut out the one
linestring feature from the KML, and then you are left with just the
points. You can also use ogr2ogr on the command line to convert to a
shapefile, dropping the line features by using -skipfailures on the
line:

ogr2ogr -skipfailures -f "ESRI Shapefile"  shack.shp shackleton.kml

that writes a points-only shapefile called shack.shp/dbf/shx.

Given that KML is XML, you could also write some XML parser code to
read the KML and remove the non-point features, or convert the
linestrings or polygons to a centroid....

Barry


From juliachacon at gmail.com  Tue Oct 22 01:11:09 2013
From: juliachacon at gmail.com (Julia Chacon Labella)
Date: Tue, 22 Oct 2013 01:11:09 +0200
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <5265AF25.3010407@auckland.ac.nz>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
	<1382390173833-7584920.post@n2.nabble.com>
	<5265AF25.3010407@auckland.ac.nz>
Message-ID: <CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/3570b89b/attachment.pl>

From mtreglia at gmail.com  Tue Oct 22 06:25:55 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Mon, 21 Oct 2013 23:25:55 -0500
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
In-Reply-To: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
References: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
Message-ID: <CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/a6f0ea6b/attachment.pl>

From mtreglia at gmail.com  Tue Oct 22 06:35:37 2013
From: mtreglia at gmail.com (Michael Treglia)
Date: Mon, 21 Oct 2013 23:35:37 -0500
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
In-Reply-To: <CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
References: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
	<CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
Message-ID: <CAPKp32tv2yQ98id4T7ujU8+R72SQe6tPfUVd2Wf3_eq8RSsSZA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131021/91a684dc/attachment.pl>

From edzer.pebesma at uni-muenster.de  Tue Oct 22 08:58:54 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 22 Oct 2013 08:58:54 +0200
Subject: [R-sig-Geo] Does sp::coordinates() behave correct?
In-Reply-To: <52658372.1020700@gwdg.de>
References: <5265803F.4090302@gwdg.de>	<CAM_vju=oTObMV3zu1PRJn2HEz_gZOcbJuPkL5ysD1oFEK+poAw@mail.gmail.com>
	<52658372.1020700@gwdg.de>
Message-ID: <5266222E.2000101@uni-muenster.de>

yes, and

print(gis.k, digits=7)

gives:

> print(gis.k, digits=7)
         coordinates  name   rsoll   hsoll
1 (3469125, 5521625) K0001 3469125 5521625
2 (3469375, 5521125) K0002 3469375 5521125
3 (3471875, 5522875) K0016 3471875 5522875
4 (3472500, 5524510) K0020 3472500 5524510

I will update the print methods for Spatial objects in sp to use

> getOption("digits")
[1] 7

as a default for digits, instead of 6.

On 10/21/2013 09:41 PM, Rainer Hurling wrote:
> Hi Sarah,
> 
> thanks for clearing this up and the very fast answer.
> 
> Greetings from G?ttingen in Germany, Rainer
> 
> 
> Am 21.10.2013 21:31, schrieb Sarah Goslee:
>> Hi,
>> 
>> It's purely a printing issue; the coordinates are unchanged:
>> 
>>> coordinates(gis.k)
>> x       y [1,] 3469125 5521625 [2,] 3469375 5521125 [3,] 3471875 
>> 5522875 [4,] 3472500 5524510
>> 
>> A number of print methods in R round things to 'look nice',
>> which can lead to unexpected side-effects, like confused users.
>> 
>> Thanks for the short reproducible example; much appreciated.
>> 
>> Sarah
>> 
>> On Mon, Oct 21, 2013 at 3:27 PM, Rainer Hurling
>> <rhurlin at gwdg.de> wrote:
>>> I am using  'coordinates(x) <- ~x+y'  to convert data.frames 
>>> into SpatialPointsDataFrames.
>>> 
>>> It seems, that some coordinates will be rounded(?), when they 
>>> are transformed by coordinates():
>>> 
>>> 
>>> library(maptools)
>>> 
>>> # Defining some Datapoints with coordinates gis.k <- 
>>> data.frame(name=c("K0001","K0002","K0016","K0020"), 
>>> rsoll=c(3469125,3469375,3471875,3472500), 
>>> hsoll=c(5521625,5521125,5522875,5524510))
>>> 
>>> # Converting them into a SpatialPointsDataFrame gis.k$x <- 
>>> gis.k$rsoll gis.k$y <- gis.k$hsoll coordinates(gis.k) <- ~x+y
>>> 
>>> # Show contents of new SpatialPointsDataFrame gis.k
>>> coordinates name   rsoll   hsoll 1 (3469120, 5521620) K0001
>>> 3469125 5521625 2 (3469380, 5521120) K0002 3469375 5521125 3
>>> (3471880, 5522880) K0016 3471875 5522875 4 (3472500, 5524510)
>>> K0020 3472500 5524510
>>> 
>>> 
>>> In lines 1 to 3 the coordinates from rsoll and hsoll are 
>>> rounded, for example 3469125 into 3469120 and 3471875 into 
>>> 3471880. (In some cases they are rounded up, in others round 
>>> down?) Only coordinates with last digit =0 are not changed.
>>> 
>>> Is this an expected behaviour and if this is right, why? If 
>>> not, what would be the correct solution to convert these 
>>> coordinates? Or do I missunderstand something here.
>>> 
>>> Any help is appreciated. Thanks in advance, Rainer Hurling
>>> 
>> 
> 
> _______________________________________________ R-sig-Geo mailing 
> list R-sig-Geo at r-project.org 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAD3A77F1


From rhurlin at gwdg.de  Tue Oct 22 10:04:33 2013
From: rhurlin at gwdg.de (Rainer Hurling)
Date: Tue, 22 Oct 2013 10:04:33 +0200
Subject: [R-sig-Geo] Does sp::coordinates() behave correct?
In-Reply-To: <5266222E.2000101@uni-muenster.de>
References: <5265803F.4090302@gwdg.de>	<CAM_vju=oTObMV3zu1PRJn2HEz_gZOcbJuPkL5ysD1oFEK+poAw@mail.gmail.com>	<52658372.1020700@gwdg.de>
	<5266222E.2000101@uni-muenster.de>
Message-ID: <52663191.6060807@gwdg.de>

Am 22.10.2013 08:58 (UTC+1) schrieb Edzer Pebesma:
> yes, and
> 
> print(gis.k, digits=7)

After Sarah's answer I remembered, that this is only a printing issue.
Thanks for your further example to print exact coordinates.

> 
> gives:
> 
>> print(gis.k, digits=7)
>          coordinates  name   rsoll   hsoll
> 1 (3469125, 5521625) K0001 3469125 5521625
> 2 (3469375, 5521125) K0002 3469375 5521125
> 3 (3471875, 5522875) K0016 3471875 5522875
> 4 (3472500, 5524510) K0020 3472500 5524510
> 
> I will update the print methods for Spatial objects in sp to use
> 
>> getOption("digits")
> [1] 7
> 
> as a default for digits, instead of 6.

That would be very nice! Until now we always have to remember, when
print spatial objects directly [= print(gis.k)], that there could be
some 'pretty printing at work' ;)

Just a small thought: Do 7 digits will fit all usual cases of coordinate
types? Or would it be better to calculate the longest value (number of
digits) before printing coordinates? But I fear, this would slow down
printing to much ...

Thanks for your very good and important sp package. We almost daily use
it heavily,
Rainer

> 
> On 10/21/2013 09:41 PM, Rainer Hurling wrote:
>> Hi Sarah,
>>
>> thanks for clearing this up and the very fast answer.
>>
>> Greetings from G?ttingen in Germany, Rainer
>>
>>
>> Am 21.10.2013 21:31, schrieb Sarah Goslee:
>>> Hi,
>>>
>>> It's purely a printing issue; the coordinates are unchanged:
>>>
>>>> coordinates(gis.k)
>>> x       y [1,] 3469125 5521625 [2,] 3469375 5521125 [3,] 3471875 
>>> 5522875 [4,] 3472500 5524510
>>>
>>> A number of print methods in R round things to 'look nice',
>>> which can lead to unexpected side-effects, like confused users.
>>>
>>> Thanks for the short reproducible example; much appreciated.
>>>
>>> Sarah
>>>
>>> On Mon, Oct 21, 2013 at 3:27 PM, Rainer Hurling
>>> <rhurlin at gwdg.de> wrote:
>>>> I am using  'coordinates(x) <- ~x+y'  to convert data.frames 
>>>> into SpatialPointsDataFrames.
>>>>
>>>> It seems, that some coordinates will be rounded(?), when they 
>>>> are transformed by coordinates():
>>>>
>>>>
>>>> library(maptools)
>>>>
>>>> # Defining some Datapoints with coordinates gis.k <- 
>>>> data.frame(name=c("K0001","K0002","K0016","K0020"), 
>>>> rsoll=c(3469125,3469375,3471875,3472500), 
>>>> hsoll=c(5521625,5521125,5522875,5524510))
>>>>
>>>> # Converting them into a SpatialPointsDataFrame gis.k$x <- 
>>>> gis.k$rsoll gis.k$y <- gis.k$hsoll coordinates(gis.k) <- ~x+y
>>>>
>>>> # Show contents of new SpatialPointsDataFrame gis.k
>>>> coordinates name   rsoll   hsoll 1 (3469120, 5521620) K0001
>>>> 3469125 5521625 2 (3469380, 5521120) K0002 3469375 5521125 3
>>>> (3471880, 5522880) K0016 3471875 5522875 4 (3472500, 5524510)
>>>> K0020 3472500 5524510
>>>>
>>>>
>>>> In lines 1 to 3 the coordinates from rsoll and hsoll are 
>>>> rounded, for example 3469125 into 3469120 and 3471875 into 
>>>> 3471880. (In some cases they are rounded up, in others round 
>>>> down?) Only coordinates with last digit =0 are not changed.
>>>>
>>>> Is this an expected behaviour and if this is right, why? If 
>>>> not, what would be the correct solution to convert these 
>>>> coordinates? Or do I missunderstand something here.
>>>>
>>>> Any help is appreciated. Thanks in advance, Rainer Hurling
>>>>
>>>
>>
>> _______________________________________________ R-sig-Geo mailing 
>> list R-sig-Geo at r-project.org 
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From jbechara at lri-lb.org  Tue Oct 22 12:03:34 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Tue, 22 Oct 2013 13:03:34 +0300
Subject: [R-sig-Geo] R not responding
Message-ID: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>

R is not running.

Whenever I open it, it run for few seconds and the close with an error
message "not responding".

Any clue?

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/af474b40/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/af474b40/attachment.jpe>

From avi3187 at gmail.com  Tue Oct 22 14:37:12 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Tue, 22 Oct 2013 06:37:12 -0600
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
	<1382390173833-7584920.post@n2.nabble.com>
	<5265AF25.3010407@auckland.ac.nz>
	<CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>
Message-ID: <CA+78ZtFi6wuggx6nGji-xgsS9u6EDwFncfT2oTXc4s1_wuFMMg@mail.gmail.com>

Hi Rolf and Julia


Many thanks for your help, I appreciate that. I am sorry for the
inconvenient, I am new in these things.


Just to clarify, my window is complex because is created from a "shapefile"
that delimit my study area.  This study area (called "W" in the analysis)
have the spatial locations of my data ("ficus" and "tienda").


With the purpose of reproduce the analysis and try to find the problem, in
the attachment documents you can find the "shapefile" of my study area, a
"txt" document of my data and my R script (Kcrossinhom(DV)).


Again, I really appreciate your help. Thank you.


Cheers


2013/10/21 Julia Chacon Labella <juliachacon at gmail.com>

> Yes, I tried to reproduced your example, and I didn?t have any problem.
> Have you check how are your lambdas?? Why are you using "at points" instead
> of the default "by pixel"??
>
> It seems that could be the lambda values what is wrong. Try to visualized
> them, and try with the pixel image.
>
> Other option is to built a new window for your pattern. How did you built
> it?
>
>
>
> 2013/10/22 Rolf Turner <r.turner at auckland.ac.nz>
>
>>
>>
>> Again, your problem is not reproducible.  We do not have the objects
>> "north", "west", "W" and "tipo" which are necessary to duplicate your
>> steps.
>>
>> I tried to reproduce your problem with an artificial example:
>>
>> W <- owin(c(0,3350),c(0,6150))
>> set.seed(42)
>> Z <- runifpoint(201,win=W)
>> m <- sample(rep(c("ficus","tienda")**,c(131,70)),201)
>> marks(Z) <- factor(m)
>> ff <- with(split(Z),bw.diggle(ficus)**)
>> tt <- with(split(Z),bw.diggle(**tienda))
>> lambdaf <- with(split(Z),density(ficus,**ff,at="points"))
>> lambdat <- with(split(Z),density(tienda,**tt,at="points"))
>>
>> K <- Kcross.inhom(Z,"ficus","**tienda",lambdaf,lambdat)
>>
>> No problema.
>>
>> It is possible that the error has something to do with the rather
>> intricate
>> (1716 vertices) boundary of your observation window.  However since I
>> don't
>> have that window I can't tell.
>>
>> cheers,
>>
>> Rolf Turner
>>
>>
>>
>> On 10/22/13 10:16, david.villalobos wrote:
>>
>>> Sure Julia,
>>>
>>> First:
>>>
>>> I have the following object called "Z"
>>>
>>>  Z <- ppp(north, west,window=W,marks=tipo)
>>>> summary(Z)
>>>>
>>> Marked planar point pattern: 201 points
>>> Average intensity 4.46e-05 points per square unit
>>>
>>> Coordinates are integers
>>> i.e. rounded to the nearest 1 unit
>>>
>>> Multitype:
>>>         frequency proportion intensity
>>> ficus        131      0.652  2.90e-05
>>> tienda        70      0.348  1.55e-05
>>>
>>> Window: polygonal boundary
>>> single connected closed polygon with 1716 vertices
>>> enclosing rectangle: [484546.8, 487897.4] x [1147521.3, 1153682.9] units
>>> Window area =  4509680 square units
>>>
>>> Second:
>>>
>>> I calculated the bandwidth sigma for the kernel estimator of point
>>> process
>>> intensity with a Cross Validated Bandwidth Selection for Kernel Density
>>> (bw.diggle)
>>>
>>>  attach(split(Z))
>>>> f<-bw.diggle(ficus)
>>>> t<-bw.diggle(tienda)
>>>>
>>> Third:
>>>
>>> I calculated with the Kernel Smoothed Intensity of Point Pattern
>>> (density.ppp) the values of the the estimated intensity of the
>>> sub-process
>>> of points of type i and j:
>>>
>>>  lambdaf<-density.ppp(ficus,f,**at="points")
>>>> lambdat<-density.ppp(tienda,t,**at="points")
>>>>
>>> and Finally:
>>>
>>> I ran the script for Kcross.inhom for the method (1): estimate
>>> intensities
>>> by nonparametric smoothing, but I had the error.
>>>
>>>  K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
>>>>
>>> Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) :
>>>    Weights in K-function were infinite or NA
>>>
>>> I tryed the method (2): leave-one-out, but I had the same problems
>>>
>>> Any help is appreciated. A lot of thanks.
>>>
>>>
>>>
>>>
>>>
>>>
>>> --
>>> View this message in context: http://r-sig-geo.2731867.n2.**
>>> nabble.com/Problems-with-**Kcross-inhom-**tp7584914p7584920.html<http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html>
>>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>
>
>
> --
> Julia
>



-- 

Saludos

David Villalobos Chaves
Maestr?a Acad?mica en Biolog?a
Universidad de Costa Rica
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/c0f82834/attachment.html>
-------------- next part --------------
tipo	X	Y
tienda	486080	1149670
tienda	486142	1149690
tienda	486111	1150020
tienda	486135	1150010
tienda	486186	1150030
tienda	486126	1150040
tienda	486080	1150010
tienda	486051	1150020
tienda	486038	1149990
tienda	486036	1149990
tienda	486036	1149990
tienda	486049	1150000
tienda	485907	1149910
tienda	485813	1149900
tienda	485788	1149860
tienda	485808	1149870
tienda	485888	1149900
tienda	486016	1149980
tienda	486113	1150200
tienda	486115	1150200
tienda	486109	1150200
tienda	486093	1150170
tienda	486082	1150140
tienda	486076	1150140
tienda	486058	1150110
tienda	485971	1150120
tienda	485971	1150120
tienda	485971	1150120
tienda	486005	1150070
tienda	485523	1149580
tienda	485724	1149800
tienda	486487	1151010
tienda	486544	1150890
tienda	486531	1150860
tienda	486537	1150860
tienda	486509	1150880
tienda	486505	1150880
tienda	486485	1150920
tienda	486511	1150820
tienda	486513	1150820
tienda	486566	1150720
tienda	486558	1150740
tienda	486562	1150740
tienda	486560	1150740
tienda	486564	1150760
tienda	486553	1150790
tienda	486516	1150830
tienda	486544	1150920
tienda	487792	1150300
tienda	487792	1150300
tienda	486496	1150900
tienda	486496	1150840
tienda	486557	1150730
tienda	486764	1151800
tienda	486012	1150000
tienda	485815	1149720
tienda	486076	1149680
tienda	485897	1149900
tienda	485815	1149890
tienda	486043	1150020
tienda	486009	1149970
tienda	485848	1149880
tienda	486070	1149680
tienda	485854	1149750
tienda	485924	1149920
tienda	485799	1149810
tienda	485754	1149810
tienda	486463	1150940
tienda	486931	1150900
tienda	487314	1150640
tienda	486703	1151680
tienda	486533	1150860
tienda	486685	1151670
tienda	486819	1151700
ficus	487413	1153530
ficus	487591	1150610
ficus	486612	1151120
ficus	486664	1151250
ficus	486606	1151050
ficus	486536	1151090
ficus	486685	1151580
ficus	486707	1151720
ficus	486901	1151360
ficus	486697	1151510
ficus	486633	1151240
ficus	486618	1150700
ficus	487063	1152380
ficus	487057	1152380
ficus	486926	1152600
ficus	486908	1152610
ficus	486892	1152530
ficus	486947	1153300
ficus	486993	1153300
ficus	486926	1153130
ficus	486887	1153160
ficus	486890	1153110
ficus	486231	1149630
ficus	486125	1150230
ficus	486311	1150270
ficus	486350	1150260
ficus	486241	1150060
ficus	486658	1152660
ficus	486222	1150250
ficus	486146	1150180
ficus	486155	1150160
ficus	486012	1149760
ficus	486435	1150390
ficus	486432	1150460
ficus	486441	1150460
ficus	486411	1150470
ficus	485550	1149990
ficus	486171	1150430
ficus	486031	1150310
ficus	486143	1150340
ficus	485030	1149470
ficus	484969	1149230
ficus	484972	1149220
ficus	484963	1149200
ficus	484978	1149230
ficus	485063	1149390
ficus	484945	1149190
ficus	484941	1149200
ficus	484935	1149110
ficus	484935	1149080
ficus	484929	1149070
ficus	486149	1149780
ficus	485973	1149720
ficus	486113	1149430
ficus	486688	1150080
ficus	486700	1150050
ficus	486709	1150070
ficus	486718	1150100
ficus	484768	1148780
ficus	484686	1148740
ficus	486019	1150030
ficus	485988	1150020
ficus	485891	1149930
ficus	485824	1149950
ficus	485742	1149890
ficus	485757	1149900
ficus	485882	1149850
ficus	485036	1148980
ficus	484972	1148750
ficus	485012	1149400
ficus	486161	1150090
ficus	486152	1150090
ficus	486131	1150090
ficus	486165	1150190
ficus	486381	1150240
ficus	486688	1149950
ficus	486168	1150460
ficus	485191	1149950
ficus	486183	1150470
ficus	485191	1149940
ficus	486015	1149590
ficus	485857	1149850
ficus	485760	1149910
ficus	485885	1149930
ficus	486704	1152670
ficus	486689	1152670
ficus	486686	1152670
ficus	486070	1150050
ficus	486277	1150090
ficus	485900	1149970
ficus	485821	1149840
ficus	486149	1150120
ficus	486140	1150120
ficus	486493	1150370
ficus	486490	1150360
ficus	485924	1149920
ficus	485891	1149940
ficus	486162	1150110
ficus	485799	1149840
ficus	485803	1149840
ficus	485912	1149940
ficus	485879	1149930
ficus	485632	1149800
ficus	485672	1149640
ficus	486052	1149990
ficus	486209	1148180
ficus	486000	1149860
ficus	486140	1149760
ficus	485897	1149680
ficus	486261	1148130
ficus	486456	1148000
ficus	486513	1147960
ficus	486553	1147780
ficus	486574	1147800
ficus	486580	1147770
ficus	486443	1147710
ficus	486440	1147670
ficus	486611	1147730
ficus	486507	1148010
ficus	486349	1148080
ficus	486334	1148090
ficus	486331	1148080
ficus	486395	1148070
ficus	486489	1148010
ficus	486173	1149570
ficus	486210	1149520
ficus	486237	1149480
ficus	486355	1148060
ficus	486337	1148070
ficus	486113	1149470
ficus	485708	1149710
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Kcrossinhom(DV).R
Type: application/octet-stream
Size: 704 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/c0f82834/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: study area.rar
Type: application/rar
Size: 20551 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/c0f82834/attachment.bin>

From milan.cisty at stuba.sk  Tue Oct 22 16:28:13 2013
From: milan.cisty at stuba.sk (Milan Cisty)
Date: Tue, 22 Oct 2013 16:28:13 +0200
Subject: [R-sig-Geo] spplot class intervals
Message-ID: <003e01cecf32$f0a6f0f0$d1f4d2d0$@stuba.sk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/01de92bc/attachment.pl>

From berman.jesse at gmail.com  Tue Oct 22 17:03:18 2013
From: berman.jesse at gmail.com (Jesse Berman)
Date: Tue, 22 Oct 2013 08:03:18 -0700 (PDT)
Subject: [R-sig-Geo] spplot class intervals
In-Reply-To: <003e01cecf32$f0a6f0f0$d1f4d2d0$@stuba.sk>
References: <003e01cecf32$f0a6f0f0$d1f4d2d0$@stuba.sk>
Message-ID: <1382454198841-7584935.post@n2.nabble.com>

Milan,

Try using the function 'cuts' instead of at=c(....).

Jesse

library(sp)
data(meuse)
coordinates(meuse)=~x+y
spplot(meuse, "cadmium", do.log = TRUE,
	key.space=list(x=0.2,y=0.9,corner=c(0,1)), cuts=c(1, 2, 3, 4, 10, 20), # My
custom cuts
	scales=list(draw=T))





-----
--------------------------------------------------------
Jesse D Berman, PhD
Yale University
School of Forestry and Environmental Studies
Post-Doc Fellow
--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spplot-class-intervals-tp7584934p7584935.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From marcelino.delacruz at upm.es  Tue Oct 22 18:21:07 2013
From: marcelino.delacruz at upm.es (Marcelino de la Cruz)
Date: Tue, 22 Oct 2013 18:21:07 +0200
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <CA+78ZtFi6wuggx6nGji-xgsS9u6EDwFncfT2oTXc4s1_wuFMMg@mail.gmail.com>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>	<1382390173833-7584920.post@n2.nabble.com>	<5265AF25.3010407@auckland.ac.nz>	<CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>
	<CA+78ZtFi6wuggx6nGji-xgsS9u6EDwFncfT2oTXc4s1_wuFMMg@mail.gmail.com>
Message-ID: <5266A5F3.50907@upm.es>

It seems that you get an estimate of lambda= 0.00000  for your ficus 
point #2. Kinhom can only be estimated when lambda > 0 in all points.

I would use either another sigma for bandwith estimation or set the 
argument leaveoneout=FALSE.

Cheers,

Marcelino


El 22/10/2013 14:37, David Villalobos escribi?:
> Hi Rolf and Julia
>
>
> Many thanks for your help, I appreciate that. I am sorry for the
> inconvenient, I am new in these things.
>
>
> Just to clarify, my window is complex because is created from a
> "shapefile" that delimit my study area.  This study area (called "W" in
> the analysis) have the spatial locations of my data ("ficus" and "tienda").
>
>
> With the purpose of reproduce the analysis and try to find the problem,
> in the attachment documents you can find the "shapefile" of my study
> area, a "txt" document of my data and my R script (Kcrossinhom(DV)).
>
>
> Again, I really appreciate your help. Thank you.
>
>
> Cheers
>
>
>
> 2013/10/21 Julia Chacon Labella <juliachacon at gmail.com
> <mailto:juliachacon at gmail.com>>
>
>     Yes, I tried to reproduced your example, and I didn?t have any
>     problem. Have you check how are your lambdas?? Why are you using "at
>     points" instead of the default "by pixel"??
>
>     It seems that could be the lambda values what is wrong. Try to
>     visualized them, and try with the pixel image.
>
>     Other option is to built a new window for your pattern. How did you
>     built it?
>
>
>
>     2013/10/22 Rolf Turner <r.turner at auckland.ac.nz
>     <mailto:r.turner at auckland.ac.nz>>
>
>
>
>         Again, your problem is not reproducible.  We do not have the objects
>         "north", "west", "W" and "tipo" which are necessary to duplicate
>         your
>         steps.
>
>         I tried to reproduce your problem with an artificial example:
>
>         W <- owin(c(0,3350),c(0,6150))
>         set.seed(42)
>         Z <- runifpoint(201,win=W)
>         m <- sample(rep(c("ficus","tienda")__,c(131,70)),201)
>         marks(Z) <- factor(m)
>         ff <- with(split(Z),bw.diggle(ficus)__)
>         tt <- with(split(Z),bw.diggle(__tienda))
>         lambdaf <- with(split(Z),density(ficus,__ff,at="points"))
>         lambdat <- with(split(Z),density(tienda,__tt,at="points"))
>
>         K <- Kcross.inhom(Z,"ficus","__tienda",lambdaf,lambdat)
>
>         No problema.
>
>         It is possible that the error has something to do with the
>         rather intricate
>         (1716 vertices) boundary of your observation window.  However
>         since I don't
>         have that window I can't tell.
>
>         cheers,
>
>         Rolf Turner
>
>
>
>         On 10/22/13 10:16, david.villalobos wrote:
>
>             Sure Julia,
>
>             First:
>
>             I have the following object called "Z"
>
>                 Z <- ppp(north, west,window=W,marks=tipo)
>                 summary(Z)
>
>             Marked planar point pattern: 201 points
>             Average intensity 4.46e-05 points per square unit
>
>             Coordinates are integers
>             i.e. rounded to the nearest 1 unit
>
>             Multitype:
>                      frequency proportion intensity
>             ficus        131      0.652  2.90e-05
>             tienda        70      0.348  1.55e-05
>
>             Window: polygonal boundary
>             single connected closed polygon with 1716 vertices
>             enclosing rectangle: [484546.8, 487897.4] x [1147521.3,
>             1153682.9] units
>             Window area =  4509680 square units
>
>             Second:
>
>             I calculated the bandwidth sigma for the kernel estimator of
>             point process
>             intensity with a Cross Validated Bandwidth Selection for
>             Kernel Density
>             (bw.diggle)
>
>                 attach(split(Z))
>                 f<-bw.diggle(ficus)
>                 t<-bw.diggle(tienda)
>
>             Third:
>
>             I calculated with the Kernel Smoothed Intensity of Point Pattern
>             (density.ppp) the values of the the estimated intensity of
>             the sub-process
>             of points of type i and j:
>
>                 lambdaf<-density.ppp(ficus,f,__at="points")
>                 lambdat<-density.ppp(tienda,t,__at="points")
>
>             and Finally:
>
>             I ran the script for Kcross.inhom for the method (1):
>             estimate intensities
>             by nonparametric smoothing, but I had the error.
>
>                 K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
>
>             Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) :
>                 Weights in K-function were infinite or NA
>
>             I tryed the method (2): leave-one-out, but I had the same
>             problems
>
>             Any help is appreciated. A lot of thanks.
>
>
>
>
>
>
>             --
>             View this message in context:
>             http://r-sig-geo.2731867.n2.__nabble.com/Problems-with-__Kcross-inhom-__tp7584914p7584920.html
>             <http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html>
>             Sent from the R-sig-geo mailing list archive at Nabble.com.
>
>             _________________________________________________
>             R-sig-Geo mailing list
>             R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>             https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>             <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>
>         _________________________________________________
>         R-sig-Geo mailing list
>         R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>         https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>
>
>
>
>     --
>     Julia
>
>
>
>
> --
>
> Saludos
>
> David Villalobos Chaves
> Maestr?a Acad?mica en Biolog?a
> Universidad de Costa Rica
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From amy.mikhail at gmail.com  Tue Oct 22 20:56:28 2013
From: amy.mikhail at gmail.com (Amy Mikhail)
Date: Tue, 22 Oct 2013 19:56:28 +0100
Subject: [R-sig-Geo] White spaces in .dbf file id names causing issues with
	reading in shapefiles
Message-ID: <CAH637UCWUjHF1eoyUG206j755cK_Yz3Se6hSCoc5FyOp-1rGMw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/c2517dba/attachment.pl>

From amy.mikhail at gmail.com  Tue Oct 22 21:14:14 2013
From: amy.mikhail at gmail.com (Amy Mikhail)
Date: Tue, 22 Oct 2013 20:14:14 +0100
Subject: [R-sig-Geo] White spaces in .dbf file id names causing issues
 with reading in shapefiles
In-Reply-To: <CALyPt8z5Xyya_g64v3ReZ-wcsqe_PazUP3f0c4xeETzB99Z96w@mail.gmail.com>
References: <CAH637UCWUjHF1eoyUG206j755cK_Yz3Se6hSCoc5FyOp-1rGMw@mail.gmail.com>
	<CALyPt8z5Xyya_g64v3ReZ-wcsqe_PazUP3f0c4xeETzB99Z96w@mail.gmail.com>
Message-ID: <CAH637UAwDur7bVmLwg52RiSKzGa=vHL__B0aq-QhqhBZwpBFUA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131022/296ce12c/attachment.pl>

From markus.jenning at web.de  Tue Oct 22 23:36:50 2013
From: markus.jenning at web.de (Markus Jenning)
Date: Tue, 22 Oct 2013 23:36:50 +0200
Subject: [R-sig-Geo] Load a map png in ggplot2 (workaround for missing world
 map support in ggmap)
In-Reply-To: <523FEFEF.5070903@gmail.com>
References: <523FEFEF.5070903@gmail.com>
Message-ID: <op.w5dkzolnvldg4i@charliebravo123>

Hello everybody,

my professor and I are assembling a handout on the best options for  
creating maps in R.
As it looked very up-to-date, I've been considering including a short  
tutorial on the ggmap package.

Now, as some of you might have noticed, the ggmap package does not fully  
support world maps - you can save empty maps as a png, but you can't use  
them directly in a plot, as one would usually do, e.g. with  
ggmap(get_map(...)).
Unfortunately, being able to plot data on maps of the whole world is one  
of our main priorities.

That's why I'm trying to find out how I could load pngs (or similar image  
files) into ggplot and use them as a map to plot on. I know that it's  
possible to include background images in ggplot (see e.g. this question on  
stackoverflow:  
http://stackoverflow.com/questions/16409935/plot-data-over-background-image-with-ggplot).  
However, this would only cover importing the image itself, and not  
adjusting the x/y axes etc., as it is necessary so I can plot my spatial  
data onto the map properly.

Has anyone encountered the same problem, and perhaps found a solution?
I'm looking forward to your ideas.
Please let me know if I've been unclear.

Cheers,
Markus


From muraka51 at sk.tsukuba.ac.jp  Wed Oct 23 11:03:14 2013
From: muraka51 at sk.tsukuba.ac.jp (Daisuke Murakami)
Date: Wed, 23 Oct 2013 18:03:14 +0900 (JST)
Subject: [R-sig-Geo] Shortest-path (railway) distance calculation using R
Message-ID: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp>

Hi everyone,

I try to calculate railway distances from a railway station to the other
stations on R.
I have shp files of the stations and railway.

Does anyone know useful R package/function for the distance calculation?

Sincerely,
Daisuke


From baremma2002 at yahoo.fr  Wed Oct 23 13:53:07 2013
From: baremma2002 at yahoo.fr (baremma2002)
Date: Wed, 23 Oct 2013 04:53:07 -0700 (PDT)
Subject: [R-sig-Geo] Problem of legend using spplot in R
Message-ID: <1382529187175-7584940.post@n2.nabble.com>

Dear users,

How can I make disappeared only the axes of the map and not the barline in
the bar legend using spplot in R? 

The code is like:

library(sp)
data(meuse)
coordinates(meuse) = ~x+y
data(meuse.grid)
coordinates(meuse.grid) = ~x+y
gridded(meuse.grid) = TRUE

lzn.vgm = variogram(log(zinc)~1, meuse)
lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))
lzn.kriged = krige(log(zinc)~1, meuse, meuse.grid, model = lzn.fit)

spplot(lzn.kriged,"var1.pred")

The map has a legend with predicted values.

Using this:

spplot(lzn.kriged,"var1.pred",par.settings=list(axis.line=list(col='transparent')))

the axes of the map and the right bar line for the legend disappear.

How can I perform the R code in order to get only the black bar line on the
legend (on the right of the map)? In other words, I would like to make
disappeared only the axes of the map but not the black line of the bar
legend.

Thank you very much for your answer.

Emmanuel



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Problem-of-legend-using-spplot-in-R-tp7584940.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Wed Oct 23 14:10:00 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 23 Oct 2013 14:10:00 +0200
Subject: [R-sig-Geo] Problem of legend using spplot in R
In-Reply-To: <1382529187175-7584940.post@n2.nabble.com>
References: <1382529187175-7584940.post@n2.nabble.com>
Message-ID: <5267BC98.3050704@uni-muenster.de>

This is a lattice question; IIRC it was asked once and answered
negatively by the author of lattice.

On 10/23/2013 01:53 PM, baremma2002 wrote:
> Dear users,
> 
> How can I make disappeared only the axes of the map and not the barline in
> the bar legend using spplot in R? 
> 
> The code is like:
> 
> library(sp)
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.grid)
> coordinates(meuse.grid) = ~x+y
> gridded(meuse.grid) = TRUE
> 
> lzn.vgm = variogram(log(zinc)~1, meuse)
> lzn.fit = fit.variogram(lzn.vgm, model = vgm(1, "Sph", 900, 1))
> lzn.kriged = krige(log(zinc)~1, meuse, meuse.grid, model = lzn.fit)
> 
> spplot(lzn.kriged,"var1.pred")
> 
> The map has a legend with predicted values.
> 
> Using this:
> 
> spplot(lzn.kriged,"var1.pred",par.settings=list(axis.line=list(col='transparent')))
> 
> the axes of the map and the right bar line for the legend disappear.
> 
> How can I perform the R code in order to get only the black bar line on the
> legend (on the right of the map)? In other words, I would like to make
> disappeared only the axes of the map but not the black line of the bar
> legend.
> 
> Thank you very much for your answer.
> 
> Emmanuel
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Problem-of-legend-using-spplot-in-R-tp7584940.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/35e12a40/attachment.bin>

From mspinola10 at gmail.com  Wed Oct 23 15:12:29 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 23 Oct 2013 07:12:29 -0600
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
In-Reply-To: <CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
References: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
	<CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
Message-ID: <CABkCotQpmy6oXvBOiqfEiRmc0dpigkXbChMtjz-i+CMyLzujcw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/9fdde85f/attachment.pl>

From mspinola10 at gmail.com  Wed Oct 23 17:52:54 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 23 Oct 2013 09:52:54 -0600
Subject: [R-sig-Geo] How can I make a raster with latitude information?
Message-ID: <CABkCotT8Q__HUnqKtMY7mPaQtey=dO8+YPzsEca0wY8YU=gRqQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/5edfb559/attachment.pl>

From oscar.perpinan at gmail.com  Wed Oct 23 18:35:54 2013
From: oscar.perpinan at gmail.com (Oscar =?utf-8?B?UGVycGnDscOhbg==?= Lamigueiro)
Date: Wed, 23 Oct 2013 18:35:54 +0200
Subject: [R-sig-Geo] How can I make a raster with latitude information?
In-Reply-To: <CABkCotT8Q__HUnqKtMY7mPaQtey=dO8+YPzsEca0wY8YU=gRqQ@mail.gmail.com>
References: <CABkCotT8Q__HUnqKtMY7mPaQtey=dO8+YPzsEca0wY8YU=gRqQ@mail.gmail.com>
Message-ID: <87zjq0gd1x.fsf@gmail.com>

Hello,

If your raster is 'r':

lat <- init(r, v='y')

Oscar.

Manuel Sp?nola writes:

> Dear list members,
>
> I would like to make a raster with the latitude (in UTM) data to include
> this as a covariable in raster stack object to use for a species
> distribution model.  How can I do that?
>
> Best,
>
> Manuel


-- 
Oscar Perpi??n Lamigueiro
Grupo de Sistemas Fotovoltaicos (IES-UPM)
Dpto. Ingenier?a El?ctrica (ETSIDI-UPM)
URL: http://http://oscarperpinan.github.io
Twitter: @oscarperpinan


From mspinola10 at gmail.com  Wed Oct 23 18:58:53 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 23 Oct 2013 10:58:53 -0600
Subject: [R-sig-Geo] How can I make a raster with latitude information?
In-Reply-To: <87zjq0gd1x.fsf@gmail.com>
References: <CABkCotT8Q__HUnqKtMY7mPaQtey=dO8+YPzsEca0wY8YU=gRqQ@mail.gmail.com>
	<87zjq0gd1x.fsf@gmail.com>
Message-ID: <CABkCotSW3HJFsCAjw+igi+YcMb=nBczV6ahWJTxP3LiCs=EQ4A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/2e743353/attachment.pl>

From mspinola10 at gmail.com  Wed Oct 23 19:12:40 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 23 Oct 2013 11:12:40 -0600
Subject: [R-sig-Geo] How do I remove the color box in a raster
Message-ID: <CABkCotSj+g4Z7pLUoBMA5WKKtfV3yCvuw=tJLRfGPDo8wrNzAQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/9185e31d/attachment.pl>

From roman.lustrik at gmail.com  Wed Oct 23 23:49:33 2013
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Wed, 23 Oct 2013 23:49:33 +0200
Subject: [R-sig-Geo] Shortest-path (railway) distance calculation using R
In-Reply-To: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp>
References: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp>
Message-ID: <CAHT1vphjDEQ2Yy_U91up3Oov=tGDbC3Adxmqyw3JO4pg-_rHuw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/b974fb98/attachment.pl>

From jgrn at illinois.edu  Thu Oct 24 00:31:43 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 23 Oct 2013 17:31:43 -0500
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
In-Reply-To: <CABkCotQpmy6oXvBOiqfEiRmc0dpigkXbChMtjz-i+CMyLzujcw@mail.gmail.com>
References: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
	<CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
	<CABkCotQpmy6oXvBOiqfEiRmc0dpigkXbChMtjz-i+CMyLzujcw@mail.gmail.com>
Message-ID: <CABG0rfvD6BVe0_n6b3CNbx_P2tNyqaX618vat+aj1=3zk+aKXQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/346dd3ea/attachment.pl>

From jgrn at illinois.edu  Thu Oct 24 00:37:45 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Wed, 23 Oct 2013 17:37:45 -0500
Subject: [R-sig-Geo] problem reading large ncdf on windows 7 64 bits
In-Reply-To: <1381247593802-7584819.post@n2.nabble.com>
References: <1360718493.33962.YahooMailNeo@web133106.mail.ir2.yahoo.com>
	<1381247593802-7584819.post@n2.nabble.com>
Message-ID: <CABG0rfvyRMfQsgdm_gv4wOcdKWGfR7ha6pj2NehysBq7H05xtw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/cae701e6/attachment.pl>

From mspinola10 at gmail.com  Thu Oct 24 00:47:28 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 23 Oct 2013 16:47:28 -0600
Subject: [R-sig-Geo] How I make 2 rasters with equal extents
In-Reply-To: <CABG0rfvD6BVe0_n6b3CNbx_P2tNyqaX618vat+aj1=3zk+aKXQ@mail.gmail.com>
References: <CABkCotSQUMc9Z0LjkZJttRxAS-OMKWuz=tHzJTwdZ_VJktUYZQ@mail.gmail.com>
	<CAPKp32u0TGoaKpcTqxVpB97MeDjuwPQHJfC6HpAE-wyndPVS_Q@mail.gmail.com>
	<CABkCotQpmy6oXvBOiqfEiRmc0dpigkXbChMtjz-i+CMyLzujcw@mail.gmail.com>
	<CABG0rfvD6BVe0_n6b3CNbx_P2tNyqaX618vat+aj1=3zk+aKXQ@mail.gmail.com>
Message-ID: <CABkCotT9Hg7Bj8C_ieHNHv=x2_7OOYzxQ+3rX5JFEYAccG7M3Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131023/306e623d/attachment.pl>

From muraka51 at sk.tsukuba.ac.jp  Thu Oct 24 04:48:40 2013
From: muraka51 at sk.tsukuba.ac.jp (Daisuke Murakami)
Date: Thu, 24 Oct 2013 11:48:40 +0900 (JST)
Subject: [R-sig-Geo] Shortest-path (railway) distance calculation using R
In-Reply-To: <CAHT1vphjDEQ2Yy_U91up3Oov=tGDbC3Adxmqyw3JO4pg-_rHuw@mail.gmail.com>
References: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp>
	<CAHT1vphjDEQ2Yy_U91up3Oov=tGDbC3Adxmqyw3JO4pg-_rHuw@mail.gmail.com>
Message-ID: <51298.130.158.101.233.1382582920.risu@infoshako.sk.tsukuba.ac.jp>

Thank you very much!
Daisuke

> Have you looked at http://cran.r-project.org/web/views/Spatial.html,
> specifically the `rgeos` package?
>
> Cheers,
> Roman
>
>
>
>
> On Wed, Oct 23, 2013 at 11:03 AM, Daisuke Murakami <
> muraka51 at sk.tsukuba.ac.jp> wrote:
>
>> Hi everyone,
>>
>> I try to calculate railway distances from a railway station to the other
>> stations on R.
>> I have shp files of the stations and railway.
>>
>> Does anyone know useful R package/function for the distance calculation?
>>
>> Sincerely,
>> Daisuke
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> In God we trust, all others bring data.
>


From mathieu.rajerison at gmail.com  Thu Oct 24 09:42:28 2013
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 24 Oct 2013 09:42:28 +0200
Subject: [R-sig-Geo] Shortest-path (railway) distance calculation using R
In-Reply-To: <51298.130.158.101.233.1382582920.risu@infoshako.sk.tsukuba.ac.jp>
References: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp>
	<CAHT1vphjDEQ2Yy_U91up3Oov=tGDbC3Adxmqyw3JO4pg-_rHuw@mail.gmail.com>
	<51298.130.158.101.233.1382582920.risu@infoshako.sk.tsukuba.ac.jp>
Message-ID: <CAGfc75=48p8k505k=ssoyjQGn02RmbgAhT+eQyeXCiR9BQn=Ag@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/7b580498/attachment.pl>

From muraka51 at sk.tsukuba.ac.jp  Thu Oct 24 09:50:07 2013
From: muraka51 at sk.tsukuba.ac.jp (Daisuke Murakami)
Date: Thu, 24 Oct 2013 16:50:07 +0900 (JST)
Subject: [R-sig-Geo] Shortest-path (railway) distance calculation using R
In-Reply-To: <CAGfc75=48p8k505k=ssoyjQGn02RmbgAhT+eQyeXCiR9BQn=Ag@mail.gmail.com>
References: <52089.130.158.101.233.1382518994.risu@infoshako.sk.tsukuba.ac.jp><CAHT1vphjDEQ2Yy_U91up3Oov=tGDbC3Adxmqyw3JO4pg-_rHuw@mail.gmail.com><51298.130.158.101.233.1382582920.risu@infoshako.sk.tsukuba.ac.jp>
	<CAGfc75=48p8k505k=ssoyjQGn02RmbgAhT+eQyeXCiR9BQn=Ag@mail.gmail.com>
Message-ID: <60265.130.158.101.233.1382601007.risu@infoshako.sk.tsukuba.ac.jp>

Thank you for the interesting advice.
I'll check it.

Daisuke,


> Hi,
>
> You could use igraph package to do this
> See Barry Rowlingson's method  : http://rpubs.com/geospacedman/routing
>
> Otherwrise, with OSM data, you can use osmar package.
> But I don't think you can coerce a SpatialLines object to an osmar one.
> Maybe if you convert your data into OSM XML data using GDAL first ?
> http://osmar.r-forge.r-project.org/
>
> Hope this helps,
>
> Mathieu
>
>
> 2013/10/24 Daisuke Murakami <muraka51 at sk.tsukuba.ac.jp>
>
>> Thank you very much!
>> Daisuke
>>
>> > Have you looked at http://cran.r-project.org/web/views/Spatial.html,
>> > specifically the `rgeos` package?
>> >
>> > Cheers,
>> > Roman
>> >
>> >
>> >
>> >
>> > On Wed, Oct 23, 2013 at 11:03 AM, Daisuke Murakami <
>> > muraka51 at sk.tsukuba.ac.jp> wrote:
>> >
>> >> Hi everyone,
>> >>
>> >> I try to calculate railway distances from a railway station to the
>> other
>> >> stations on R.
>> >> I have shp files of the stations and railway.
>> >>
>> >> Does anyone know useful R package/function for the distance
>> calculation?
>> >>
>> >> Sincerely,
>> >> Daisuke
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>
>> >
>> >
>> >
>> > --
>> > In God we trust, all others bring data.
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>


From efisio.solazzo at jrc.ec.europa.eu  Thu Oct 24 14:35:12 2013
From: efisio.solazzo at jrc.ec.europa.eu (solazef)
Date: Thu, 24 Oct 2013 05:35:12 -0700 (PDT)
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of
	experiment and model
In-Reply-To: <5264EE7B.5000303@uni-muenster.de>
References: <525FB23A.9080008@jrc.ec.europa.eu> <2369899.cjO6JZN5Xj@erebus>
	<1382343196318-7584906.post@n2.nabble.com>
	<5264EE7B.5000303@uni-muenster.de>
Message-ID: <1382618112658-7584957.post@n2.nabble.com>

HI, thanks for the reply.

looking at the example(plot.gstatVariogram) , the type of plot produced by 
plot(vgm2, model=model.2)
(one panel for each direction, experiment and model overlapped)  is exactly
what  am trying to get.

Only in my case I don't have the direct output of the variogram function.
Basically I first run the variogram function to my dataset:

v <- variogram(dat0.z~1, data = dat, widht=width_d, alpha=hor_angle,
tol.hor=15, cloud=T)

with: hor_angle=seq(0,150,30)

Then I do some processing of the cloud to extract the distance relative to
one point only (not all pairs):

vm <- v[((v$np%/% attr(v, ".BigInt"))+1)== 1 | ((v$np%%  attr(v,
".BigInt"))+1)== 1, ]
    
 and split the vm according to the directions so to have six distinct
variograms to feed into the autofit function:
       
    vm_split <- split(vm,vm$dir.hor) 
    class (vm_split) <- c("gstatVariogram", "dataframe")
    vh =
list(vm_split[[1]],vm_split[[2]],vm_split[[3]],vm_split[[4]],vm_split[[5]],vm_split[[6]])
 
The output of the (modified) autofitVariogram fitting function is
"auto_Sph_h". For plotting I run:

for (i in 1:length(hor_angle)) { 
              model.1 <- vgm(psill=sum(auto_Sph_h[[i]]$var_model[,2]),
model="Sph", 
                              range=sum(auto_Sph_h[[i]]$var_model[,3]),
                             
nugget=sum(auto_Sph_h[[i]]$var_model[1,"psill"]), 
                              error=auto_Sph_h[[i]]$sserr)
        
          xyplot( gamma ~ dist | dir.hor
          ,data = vh[[i]] 
          ,labels = "", shift =0.1,  
          ,model = model.1
          ,direction = hor_angle 
          ,xlim=..., ylim=..., xlab=..., ylab=..., main=....
          ,group.id = TRUE           
           ,panel = automap:::autokrige.vgm.panel 
         ,mode = "direct")  }


 Now, this loop either does not show the model overlapped to the data or
print the plots in six different pages. I have tried countless combinations
of split.screen(), layout, par(mfrow), but nothing seems to work. Only by
using "print" six times with the option "more=T" does the job, but the
layout is not as nice.  

Hope you can suggest a way round.
Thanks.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gstat-anisotropy-multipanel-plotting-of-experiment-and-model-tp7584877p7584957.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jgrn at illinois.edu  Thu Oct 24 15:01:57 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Thu, 24 Oct 2013 08:01:57 -0500
Subject: [R-sig-Geo] R not responding
In-Reply-To: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>
References: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>
Message-ID: <CABG0rfsZimBkrbkJ1w=acvWDbLAM5L7bOk2gTPHhG0ODHH9jRA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/0b965512/attachment.pl>

From larroque.jeremy at gmail.com  Thu Oct 24 15:08:34 2013
From: larroque.jeremy at gmail.com (Jeremy Larroque)
Date: Thu, 24 Oct 2013 15:08:34 +0200
Subject: [R-sig-Geo] Least-cost path in meter
Message-ID: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/9d1cd77f/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Oct 24 16:07:27 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 24 Oct 2013 16:07:27 +0200
Subject: [R-sig-Geo] gstat anisotropy : multipanel plotting of
 experiment and model
In-Reply-To: <1382618112658-7584957.post@n2.nabble.com>
References: <525FB23A.9080008@jrc.ec.europa.eu>
	<2369899.cjO6JZN5Xj@erebus>	<1382343196318-7584906.post@n2.nabble.com>	<5264EE7B.5000303@uni-muenster.de>
	<1382618112658-7584957.post@n2.nabble.com>
Message-ID: <5269299F.8070007@uni-muenster.de>

Dear Solazev, please study

http://www.r-project.org/posting-guide.html

carefully, and then try to formulate a question that will prompt a
useful answer.

On 10/24/2013 02:35 PM, solazef wrote:
> HI, thanks for the reply.
> 
> looking at the example(plot.gstatVariogram) , the type of plot produced by 
> plot(vgm2, model=model.2)
> (one panel for each direction, experiment and model overlapped)  is exactly
> what  am trying to get.
> 
> Only in my case I don't have the direct output of the variogram function.
> Basically I first run the variogram function to my dataset:
> 
> v <- variogram(dat0.z~1, data = dat, widht=width_d, alpha=hor_angle,
> tol.hor=15, cloud=T)
> 
> with: hor_angle=seq(0,150,30)
> 
> Then I do some processing of the cloud to extract the distance relative to
> one point only (not all pairs):
> 
> vm <- v[((v$np%/% attr(v, ".BigInt"))+1)== 1 | ((v$np%%  attr(v,
> ".BigInt"))+1)== 1, ]
>     
>  and split the vm according to the directions so to have six distinct
> variograms to feed into the autofit function:
>        
>     vm_split <- split(vm,vm$dir.hor) 
>     class (vm_split) <- c("gstatVariogram", "dataframe")
>     vh =
> list(vm_split[[1]],vm_split[[2]],vm_split[[3]],vm_split[[4]],vm_split[[5]],vm_split[[6]])
>  
> The output of the (modified) autofitVariogram fitting function is
> "auto_Sph_h". For plotting I run:
> 
> for (i in 1:length(hor_angle)) { 
>               model.1 <- vgm(psill=sum(auto_Sph_h[[i]]$var_model[,2]),
> model="Sph", 
>                               range=sum(auto_Sph_h[[i]]$var_model[,3]),
>                              
> nugget=sum(auto_Sph_h[[i]]$var_model[1,"psill"]), 
>                               error=auto_Sph_h[[i]]$sserr)
>         
>           xyplot( gamma ~ dist | dir.hor
>           ,data = vh[[i]] 
>           ,labels = "", shift =0.1,  
>           ,model = model.1
>           ,direction = hor_angle 
>           ,xlim=..., ylim=..., xlab=..., ylab=..., main=....
>           ,group.id = TRUE           
>            ,panel = automap:::autokrige.vgm.panel 
>          ,mode = "direct")  }
> 
> 
>  Now, this loop either does not show the model overlapped to the data or
> print the plots in six different pages. I have tried countless combinations
> of split.screen(), layout, par(mfrow), but nothing seems to work. Only by
> using "print" six times with the option "more=T" does the job, but the
> layout is not as nice.  
> 
> Hope you can suggest a way round.
> Thanks.
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/gstat-anisotropy-multipanel-plotting-of-experiment-and-model-tp7584877p7584957.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/415dc2c0/attachment.bin>

From friedman.steve at gmail.com  Thu Oct 24 16:16:00 2013
From: friedman.steve at gmail.com (Steve Friedman)
Date: Thu, 24 Oct 2013 10:16:00 -0400
Subject: [R-sig-Geo] R not responding
In-Reply-To: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>
References: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>
Message-ID: <CADkZ+_V_fOJLBeZzi54pkShoFuuHb-nuWAw1VLy1HPfitcpR-g@mail.gmail.com>

Have you reinstalled the system?
On Oct 22, 2013 6:12 AM, "Joseph Bechara" <jbechara at lri-lb.org> wrote:

> R is not running.****
>
> Whenever I open it, it run for few seconds and the close with an error
> message ?not responding?.****
>
> Any clue?****
>
> ** **
>
> ** **
>
> *JOSEPH BECHARA*
>
> *Wildfire Management Program Coordinator*
>
> Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon**
>
> Tel.: +961 (1) 426630-1-2****
>
> Fax: +961 (1) 426631****
>
> Mail: jbechara at lri-lb.org <jbejjani at lri-lb.org>****
>
> www.lri-lb.org****
>
> [image: Description: Description: LRI-logo-Email]****
>
> ** **
>
> ** **
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/d191ca7b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/d191ca7b/attachment.jpe>

From jacobvanetten at yahoo.com  Thu Oct 24 16:34:03 2013
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Thu, 24 Oct 2013 15:34:03 +0100 (BST)
Subject: [R-sig-Geo] Least-cost path in meter
In-Reply-To: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>
References: <CAGaZB31EY=ieBf5_cZZqU=+E2uiVdhaiHAcRqkjrJE8BVhSJ1A@mail.gmail.com>
Message-ID: <1382625243.24142.YahooMailNeo@web133204.mail.ir2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/a4732cdf/attachment.pl>

From geotheory1 at gmail.com  Thu Oct 24 17:45:05 2013
From: geotheory1 at gmail.com (Robin Edwards)
Date: Thu, 24 Oct 2013 08:45:05 -0700 (PDT)
Subject: [R-sig-Geo] Reading multiple layer/geometry KML into R
In-Reply-To: <CANVKczOr1Oo_h-3hgPwqXF82XbRpA7gKFD=Boe-psyfAA3QsZw@mail.gmail.com>
References: <1382393229600-7584922.post@n2.nabble.com>
	<CANVKczOr1Oo_h-3hgPwqXF82XbRpA7gKFD=Boe-psyfAA3QsZw@mail.gmail.com>
Message-ID: <1382629505827-7584963.post@n2.nabble.com>

Thanks Barry, ogr2ogr works well. Lesson I guess is to try and ensure your
KMLs are single-geometry.



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Reading-multiple-layer-geometry-KML-into-R-tp7584922p7584963.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From amy.mikhail at gmail.com  Thu Oct 24 17:56:09 2013
From: amy.mikhail at gmail.com (Amy Mikhail)
Date: Thu, 24 Oct 2013 16:56:09 +0100
Subject: [R-sig-Geo] SpatialEpi & plotmap - how to change the colours?
Message-ID: <CAH637UD=h+1aB0kpDetZq9KAj4ZVtNjJ7Yy=BDa3RQx71R2-kg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/956409a1/attachment.pl>

From jean.d.marchal at gmail.com  Thu Oct 24 23:36:24 2013
From: jean.d.marchal at gmail.com (Jean Marchal)
Date: Thu, 24 Oct 2013 17:36:24 -0400
Subject: [R-sig-Geo] [writeRaster] Error in .local(.Object,
	...) : Dataset copy failed
Message-ID: <CACF6B3VqQ5Urma4r4fFYddTCqyKYohSTf-tcOfUfpvBZv2jp9g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131024/2d6561bd/attachment.pl>

From r.hijmans at gmail.com  Fri Oct 25 05:41:39 2013
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 24 Oct 2013 20:41:39 -0700
Subject: [R-sig-Geo] [writeRaster] Error in .local(.Object,
 ...) : Dataset copy failed
In-Reply-To: <CACF6B3VqQ5Urma4r4fFYddTCqyKYohSTf-tcOfUfpvBZv2jp9g@mail.gmail.com>
References: <CACF6B3VqQ5Urma4r4fFYddTCqyKYohSTf-tcOfUfpvBZv2jp9g@mail.gmail.com>
Message-ID: <CANtt_hx6w7VcAtxTYBW-DmOP7kCg8ku4kHFL98vAxoeRmSMD-Q@mail.gmail.com>

Jean, Is the file is larger then the available disk space? Robert

On Thu, Oct 24, 2013 at 2:36 PM, Jean Marchal <jean.d.marchal at gmail.com> wrote:
> Dear list,
>
> I got this strange error while saving a raster on disk using writeRaster()
> function. I tried to use absolute path without success.
>
> It might be a matter of path because sometimes it works when I saved it in
> another folder or in parent folder but sometimes it needs a different name
> also... (make no sense). The path looks like that:
> "C:/Users/jean/Desktop/Data/Climate/CMIP5/rcp45_GTiff/ipsl-ipsl_cm5b_lr-r1i1p1/tasmax.tif"
> (92 characters)
>
> Note that I saved successfully two others rasters in the same folder
> (ipsl-ipsl_cm5b_lr-r1i1p1) but with name length of 2 and 3. I did not
> encounter this problem using the same process once before.
>
>
> Additional info:
>
> I created rcp45_GTiff and ipsl-ipsl_cm5b_lr-r1i1p1 folders with R. The
> raster I am trying to save is a raster brick with 1800+ bands.
>
> I am using the ?raster? package version 2.1-49.
>
> I used writeRaster in nested lapply().
>
> I have full rights to this folder.
>
> The xml file is saved successfully.
>
>
> What I am doing wrong ? I can provide additional information if needed.
>
>
> Best regards,
>
> Jean
>
>
> Jean Marchal
>
> Etudiant au doctorat / PHD student
> Universit? Laval - Pavillon Abitibi-Price
> Facult? de foresterie, de g?ographie et de g?omatique
> 2405, rue de la Terrasse
> Qu?bec (Qu?bec) G1V 0A6
> T?l: 418-656-2131 poste 2620
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jbechara at lri-lb.org  Fri Oct 25 12:02:39 2013
From: jbechara at lri-lb.org (Joseph Bechara)
Date: Fri, 25 Oct 2013 13:02:39 +0300
Subject: [R-sig-Geo] R not responding
In-Reply-To: <CABG0rfsZimBkrbkJ1w=acvWDbLAM5L7bOk2gTPHhG0ODHH9jRA@mail.gmail.com>
References: <000001cecf0d$f950f540$ebf2dfc0$@lri-lb.org>
	<CABG0rfsZimBkrbkJ1w=acvWDbLAM5L7bOk2gTPHhG0ODHH9jRA@mail.gmail.com>
Message-ID: <003001ced169$58e58090$0ab081b0$@lri-lb.org>

Hello, 

 

I was able to run it using the "safe run".

Weirdly it is not working normally.

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

Description: Description: LRI-logo-Email

 

 

From: jgrn307 at gmail.com [mailto:jgrn307 at gmail.com] On Behalf Of Jonathan
Greenberg
Sent: Thursday, October 24, 2013 4:02 PM
To: Joseph Bechara
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] R not responding

 

Hi Joseph:

 

You might want to ask folks at r-help about this:
https://stat.ethz.ch/mailman/listinfo/r-help

 

--j

 

On Tue, Oct 22, 2013 at 5:03 AM, Joseph Bechara <jbechara at lri-lb.org> wrote:

R is not running.

Whenever I open it, it run for few seconds and the close with an error
message "not responding".

Any clue?

 

 

JOSEPH BECHARA

Wildfire Management Program Coordinator

Ashrafieh 1020 Building, 8th floor, Mathaf, Beirut, Lebanon

Tel.: +961 (1) 426630-1-2

Fax: +961 (1) 426631 <tel:%2B961%20%281%29%20426631> 

Mail:  <mailto:jbejjani at lri-lb.org> jbechara at lri-lb.org

 <http://www.lri-lb.org/> www.lri-lb.org

 

 


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo





 

-- 
Jonathan A. Greenberg, PhD
Assistant Professor
Global Environmental Analysis and Remote Sensing (GEARS) Laboratory
Department of Geography and Geographic Information Science
University of Illinois at Urbana-Champaign
259 Computing Applications Building, MC-150
605 East Springfield Avenue
Champaign, IL  61820-6371
Phone: 217-300-1924
http://www.geog.illinois.edu/~jgrn/
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307, Skype: jgrn3007 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131025/9d2804e9/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 16370 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131025/9d2804e9/attachment.jpe>

From jean.d.marchal at gmail.com  Fri Oct 25 13:44:03 2013
From: jean.d.marchal at gmail.com (Jean Marchal)
Date: Fri, 25 Oct 2013 07:44:03 -0400
Subject: [R-sig-Geo] [writeRaster] Error in .local(.Object,
 ...) : Dataset copy failed
In-Reply-To: <CANtt_hx6w7VcAtxTYBW-DmOP7kCg8ku4kHFL98vAxoeRmSMD-Q@mail.gmail.com>
References: <CACF6B3VqQ5Urma4r4fFYddTCqyKYohSTf-tcOfUfpvBZv2jp9g@mail.gmail.com>
	<CANtt_hx6w7VcAtxTYBW-DmOP7kCg8ku4kHFL98vAxoeRmSMD-Q@mail.gmail.com>
Message-ID: <CACF6B3WvF2v0BLxTJ-_gPqN4PXSJAmfkQDGoJymF=BLdX4E6OA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131025/afc27d89/attachment.pl>

From jean.d.marchal at gmail.com  Fri Oct 25 16:50:11 2013
From: jean.d.marchal at gmail.com (Jean Marchal)
Date: Fri, 25 Oct 2013 10:50:11 -0400
Subject: [R-sig-Geo] [writeRaster] Error in .local(.Object,
 ...) : Dataset copy failed
In-Reply-To: <CACF6B3WvF2v0BLxTJ-_gPqN4PXSJAmfkQDGoJymF=BLdX4E6OA@mail.gmail.com>
References: <CACF6B3VqQ5Urma4r4fFYddTCqyKYohSTf-tcOfUfpvBZv2jp9g@mail.gmail.com>
	<CANtt_hx6w7VcAtxTYBW-DmOP7kCg8ku4kHFL98vAxoeRmSMD-Q@mail.gmail.com>
	<CACF6B3WvF2v0BLxTJ-_gPqN4PXSJAmfkQDGoJymF=BLdX4E6OA@mail.gmail.com>
Message-ID: <CACF6B3WLAbH71Ctg6_b2kNoCjm239ybFA6J6vmZ89jSg7D64Bw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131025/c4d63f8a/attachment.pl>

From npt_eng at hotmail.com  Sun Oct 27 11:19:28 2013
From: npt_eng at hotmail.com (netra)
Date: Sun, 27 Oct 2013 03:19:28 -0700 (PDT)
Subject: [R-sig-Geo] idw
Message-ID: <1382869168652-7584974.post@n2.nabble.com>

how idw works in gstat packages, like how much is search radius or points
included in the interpolation??

Netra



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/idw-tp7584974.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mauriziomarchi85 at gmail.com  Sun Oct 27 12:06:53 2013
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Sun, 27 Oct 2013 12:06:53 +0100
Subject: [R-sig-Geo] Idw
Message-ID: <CANJhsN3KDBTSobBmsdZGGcZrTMuCJsRH7oGCtbTXDcmmiAQWnQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131027/a625a5b2/attachment.pl>

From npt_eng at hotmail.com  Sun Oct 27 18:55:58 2013
From: npt_eng at hotmail.com (netra)
Date: Sun, 27 Oct 2013 10:55:58 -0700 (PDT)
Subject: [R-sig-Geo] Idw
In-Reply-To: <CANJhsN3KDBTSobBmsdZGGcZrTMuCJsRH7oGCtbTXDcmmiAQWnQ@mail.gmail.com>
References: <1382869168652-7584974.post@n2.nabble.com>
	<CANJhsN3KDBTSobBmsdZGGcZrTMuCJsRH7oGCtbTXDcmmiAQWnQ@mail.gmail.com>
Message-ID: <1382896558365-7584977.post@n2.nabble.com>

Hi Maurizio ,

		
			
		library(gstat)		
		idw.out <- idw(z~1, elev, grd, idp = 2)

this is my code snippet,  I have "elev" is  SpatialPointsDataFrame object
and "grd" is SpatialPixels object.

Netra



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/idw-tp7584975p7584977.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From osoong+r at gmail.com  Mon Oct 28 06:03:21 2013
From: osoong+r at gmail.com (Oliver Soong)
Date: Sun, 27 Oct 2013 22:03:21 -0700
Subject: [R-sig-Geo] GDAL.close
Message-ID: <CAPQ=hV+UZi=S3216CT4ZTrZC8AP9tEC9tzszP94-6qf04iCMZA@mail.gmail.com>

I've had a long standing struggle with GDAL.close on Windows, and I
think I might finally have found a fix.  I'm currently running rgdal
0.8.11, R 3.0.2, and 32-bit Windows 7.

Currently, writeRaster and writeGDAL create temporary files in the
tempdir() folder (the final filename prefixed with 3 random [a-z]
letters).  On my system, these files get left open and orphaned.  When
doing heavy processing, this can lead to the drive hosting the
tempdir() folder to become full, even if the data is being ultimately
written to a much larger drive.  This also means that R cannot clean
up these files or the tempdir() folder when it closes, causing similar
bloat in my %TEMP%.

I haven't tested this on other platforms, but I think it might help to
insert an extra line into GDAL.close:

.setCollectorFun(slot(dataset, "handle"), NULL)
.Call("RGDAL_CloseHandle", dataset at handle, PACKAGE = "rgdal")
.Call("RGDAL_CloseDataset", dataset, PACKAGE = "rgdal")

For whatever reason, RGDAL_CloseDataset doesn't seem to actually close
the C file handle, but it doesn't seem to mind if the file handle was
closed beforehand.

Cheers,
Oliver


From mauriziomarchi85 at gmail.com  Mon Oct 28 12:13:44 2013
From: mauriziomarchi85 at gmail.com (Maurizio Marchi)
Date: Mon, 28 Oct 2013 12:13:44 +0100
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 122, Issue 26
In-Reply-To: <mailman.7.1382958003.936.r-sig-geo@r-project.org>
References: <mailman.7.1382958003.936.r-sig-geo@r-project.org>
Message-ID: <CANJhsN3n-JUmR-7yQ8_Nfg0QTgU=-R6EjTVHTHWG+nJq-xONbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131028/7e037c69/attachment.pl>

From avi3187 at gmail.com  Tue Oct 29 01:44:55 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Mon, 28 Oct 2013 18:44:55 -0600
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <5266A5F3.50907@upm.es>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
	<1382390173833-7584920.post@n2.nabble.com>
	<5265AF25.3010407@auckland.ac.nz>
	<CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>
	<CA+78ZtFi6wuggx6nGji-xgsS9u6EDwFncfT2oTXc4s1_wuFMMg@mail.gmail.com>
	<5266A5F3.50907@upm.es>
Message-ID: <CA+78ZtHtDB0=AjiO2s5QBijgMQejqZ2Bo-a2Q37JhNb=Snruzg@mail.gmail.com>

Thank you for your help Marcelino
Regards

2013/10/22, Marcelino de la Cruz <marcelino.delacruz at upm.es>:
> It seems that you get an estimate of lambda= 0.00000  for your ficus
> point #2. Kinhom can only be estimated when lambda > 0 in all points.
>
> I would use either another sigma for bandwith estimation or set the
> argument leaveoneout=FALSE.
>
> Cheers,
>
> Marcelino
>
>
> El 22/10/2013 14:37, David Villalobos escribi?:
>> Hi Rolf and Julia
>>
>>
>> Many thanks for your help, I appreciate that. I am sorry for the
>> inconvenient, I am new in these things.
>>
>>
>> Just to clarify, my window is complex because is created from a
>> "shapefile" that delimit my study area.  This study area (called "W" in
>> the analysis) have the spatial locations of my data ("ficus" and
>> "tienda").
>>
>>
>> With the purpose of reproduce the analysis and try to find the problem,
>> in the attachment documents you can find the "shapefile" of my study
>> area, a "txt" document of my data and my R script (Kcrossinhom(DV)).
>>
>>
>> Again, I really appreciate your help. Thank you.
>>
>>
>> Cheers
>>
>>
>>
>> 2013/10/21 Julia Chacon Labella <juliachacon at gmail.com
>> <mailto:juliachacon at gmail.com>>
>>
>>     Yes, I tried to reproduced your example, and I didn?t have any
>>     problem. Have you check how are your lambdas?? Why are you using "at
>>     points" instead of the default "by pixel"??
>>
>>     It seems that could be the lambda values what is wrong. Try to
>>     visualized them, and try with the pixel image.
>>
>>     Other option is to built a new window for your pattern. How did you
>>     built it?
>>
>>
>>
>>     2013/10/22 Rolf Turner <r.turner at auckland.ac.nz
>>     <mailto:r.turner at auckland.ac.nz>>
>>
>>
>>
>>         Again, your problem is not reproducible.  We do not have the
>> objects
>>         "north", "west", "W" and "tipo" which are necessary to duplicate
>>         your
>>         steps.
>>
>>         I tried to reproduce your problem with an artificial example:
>>
>>         W <- owin(c(0,3350),c(0,6150))
>>         set.seed(42)
>>         Z <- runifpoint(201,win=W)
>>         m <- sample(rep(c("ficus","tienda")__,c(131,70)),201)
>>         marks(Z) <- factor(m)
>>         ff <- with(split(Z),bw.diggle(ficus)__)
>>         tt <- with(split(Z),bw.diggle(__tienda))
>>         lambdaf <- with(split(Z),density(ficus,__ff,at="points"))
>>         lambdat <- with(split(Z),density(tienda,__tt,at="points"))
>>
>>         K <- Kcross.inhom(Z,"ficus","__tienda",lambdaf,lambdat)
>>
>>         No problema.
>>
>>         It is possible that the error has something to do with the
>>         rather intricate
>>         (1716 vertices) boundary of your observation window.  However
>>         since I don't
>>         have that window I can't tell.
>>
>>         cheers,
>>
>>         Rolf Turner
>>
>>
>>
>>         On 10/22/13 10:16, david.villalobos wrote:
>>
>>             Sure Julia,
>>
>>             First:
>>
>>             I have the following object called "Z"
>>
>>                 Z <- ppp(north, west,window=W,marks=tipo)
>>                 summary(Z)
>>
>>             Marked planar point pattern: 201 points
>>             Average intensity 4.46e-05 points per square unit
>>
>>             Coordinates are integers
>>             i.e. rounded to the nearest 1 unit
>>
>>             Multitype:
>>                      frequency proportion intensity
>>             ficus        131      0.652  2.90e-05
>>             tienda        70      0.348  1.55e-05
>>
>>             Window: polygonal boundary
>>             single connected closed polygon with 1716 vertices
>>             enclosing rectangle: [484546.8, 487897.4] x [1147521.3,
>>             1153682.9] units
>>             Window area =  4509680 square units
>>
>>             Second:
>>
>>             I calculated the bandwidth sigma for the kernel estimator of
>>             point process
>>             intensity with a Cross Validated Bandwidth Selection for
>>             Kernel Density
>>             (bw.diggle)
>>
>>                 attach(split(Z))
>>                 f<-bw.diggle(ficus)
>>                 t<-bw.diggle(tienda)
>>
>>             Third:
>>
>>             I calculated with the Kernel Smoothed Intensity of Point
>> Pattern
>>             (density.ppp) the values of the the estimated intensity of
>>             the sub-process
>>             of points of type i and j:
>>
>>                 lambdaf<-density.ppp(ficus,f,__at="points")
>>                 lambdat<-density.ppp(tienda,t,__at="points")
>>
>>             and Finally:
>>
>>             I ran the script for Kcross.inhom for the method (1):
>>             estimate intensities
>>             by nonparametric smoothing, but I had the error.
>>
>>                 K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
>>
>>             Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) :
>>                 Weights in K-function were infinite or NA
>>
>>             I tryed the method (2): leave-one-out, but I had the same
>>             problems
>>
>>             Any help is appreciated. A lot of thanks.
>>
>>
>>
>>
>>
>>
>>             --
>>             View this message in context:
>>
>> http://r-sig-geo.2731867.n2.__nabble.com/Problems-with-__Kcross-inhom-__tp7584914p7584920.html
>>
>> <http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html>
>>             Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>>             _________________________________________________
>>             R-sig-Geo mailing list
>>             R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>             https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>>             <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>>
>>         _________________________________________________
>>         R-sig-Geo mailing list
>>         R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>         https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>>         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>>
>>
>>
>>     --
>>     Julia
>>
>>
>>
>>
>> --
>>
>> Saludos
>>
>> David Villalobos Chaves
>> Maestr?a Acad?mica en Biolog?a
>> Universidad de Costa Rica
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>


-- 

Saludos

David Villalobos Chaves
Maestr?a Acad?mica en Biolog?a
Universidad de Costa Rica


From avi3187 at gmail.com  Tue Oct 29 01:47:56 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Mon, 28 Oct 2013 18:47:56 -0600
Subject: [R-sig-Geo] Problems with Kcross.inhom
In-Reply-To: <5266A5F3.50907@upm.es>
References: <CA+78ZtEAkd4hEsg_ouRRV5zbrTru3-yAh1A4kNPNVL=mCYnHBg@mail.gmail.com>
	<CAPsE2jwqa_+g1gXpibA+UVwz8sic+U-KbuP0FW1r15QB1jEJhQ@mail.gmail.com>
	<1382390173833-7584920.post@n2.nabble.com>
	<5265AF25.3010407@auckland.ac.nz>
	<CAPsE2jx8qq2UQzwg1vT=qwAENikn+AdzS0Br+-_zhCBuypb-Yg@mail.gmail.com>
	<CA+78ZtFi6wuggx6nGji-xgsS9u6EDwFncfT2oTXc4s1_wuFMMg@mail.gmail.com>
	<5266A5F3.50907@upm.es>
Message-ID: <CA+78ZtFeiRHTr_uPwu7HoEyTXR1=4XhOU9Oh5bxw=XYrg_Lmww@mail.gmail.com>

Thank you Marcelino.
Regards

2013/10/22, Marcelino de la Cruz <marcelino.delacruz at upm.es>:
> It seems that you get an estimate of lambda= 0.00000  for your ficus
> point #2. Kinhom can only be estimated when lambda > 0 in all points.
>
> I would use either another sigma for bandwith estimation or set the
> argument leaveoneout=FALSE.
>
> Cheers,
>
> Marcelino
>
>
> El 22/10/2013 14:37, David Villalobos escribi?:
>> Hi Rolf and Julia
>>
>>
>> Many thanks for your help, I appreciate that. I am sorry for the
>> inconvenient, I am new in these things.
>>
>>
>> Just to clarify, my window is complex because is created from a
>> "shapefile" that delimit my study area.  This study area (called "W" in
>> the analysis) have the spatial locations of my data ("ficus" and
>> "tienda").
>>
>>
>> With the purpose of reproduce the analysis and try to find the problem,
>> in the attachment documents you can find the "shapefile" of my study
>> area, a "txt" document of my data and my R script (Kcrossinhom(DV)).
>>
>>
>> Again, I really appreciate your help. Thank you.
>>
>>
>> Cheers
>>
>>
>>
>> 2013/10/21 Julia Chacon Labella <juliachacon at gmail.com
>> <mailto:juliachacon at gmail.com>>
>>
>>     Yes, I tried to reproduced your example, and I didn?t have any
>>     problem. Have you check how are your lambdas?? Why are you using "at
>>     points" instead of the default "by pixel"??
>>
>>     It seems that could be the lambda values what is wrong. Try to
>>     visualized them, and try with the pixel image.
>>
>>     Other option is to built a new window for your pattern. How did you
>>     built it?
>>
>>
>>
>>     2013/10/22 Rolf Turner <r.turner at auckland.ac.nz
>>     <mailto:r.turner at auckland.ac.nz>>
>>
>>
>>
>>         Again, your problem is not reproducible.  We do not have the
>> objects
>>         "north", "west", "W" and "tipo" which are necessary to duplicate
>>         your
>>         steps.
>>
>>         I tried to reproduce your problem with an artificial example:
>>
>>         W <- owin(c(0,3350),c(0,6150))
>>         set.seed(42)
>>         Z <- runifpoint(201,win=W)
>>         m <- sample(rep(c("ficus","tienda")__,c(131,70)),201)
>>         marks(Z) <- factor(m)
>>         ff <- with(split(Z),bw.diggle(ficus)__)
>>         tt <- with(split(Z),bw.diggle(__tienda))
>>         lambdaf <- with(split(Z),density(ficus,__ff,at="points"))
>>         lambdat <- with(split(Z),density(tienda,__tt,at="points"))
>>
>>         K <- Kcross.inhom(Z,"ficus","__tienda",lambdaf,lambdat)
>>
>>         No problema.
>>
>>         It is possible that the error has something to do with the
>>         rather intricate
>>         (1716 vertices) boundary of your observation window.  However
>>         since I don't
>>         have that window I can't tell.
>>
>>         cheers,
>>
>>         Rolf Turner
>>
>>
>>
>>         On 10/22/13 10:16, david.villalobos wrote:
>>
>>             Sure Julia,
>>
>>             First:
>>
>>             I have the following object called "Z"
>>
>>                 Z <- ppp(north, west,window=W,marks=tipo)
>>                 summary(Z)
>>
>>             Marked planar point pattern: 201 points
>>             Average intensity 4.46e-05 points per square unit
>>
>>             Coordinates are integers
>>             i.e. rounded to the nearest 1 unit
>>
>>             Multitype:
>>                      frequency proportion intensity
>>             ficus        131      0.652  2.90e-05
>>             tienda        70      0.348  1.55e-05
>>
>>             Window: polygonal boundary
>>             single connected closed polygon with 1716 vertices
>>             enclosing rectangle: [484546.8, 487897.4] x [1147521.3,
>>             1153682.9] units
>>             Window area =  4509680 square units
>>
>>             Second:
>>
>>             I calculated the bandwidth sigma for the kernel estimator of
>>             point process
>>             intensity with a Cross Validated Bandwidth Selection for
>>             Kernel Density
>>             (bw.diggle)
>>
>>                 attach(split(Z))
>>                 f<-bw.diggle(ficus)
>>                 t<-bw.diggle(tienda)
>>
>>             Third:
>>
>>             I calculated with the Kernel Smoothed Intensity of Point
>> Pattern
>>             (density.ppp) the values of the the estimated intensity of
>>             the sub-process
>>             of points of type i and j:
>>
>>                 lambdaf<-density.ppp(ficus,f,__at="points")
>>                 lambdat<-density.ppp(tienda,t,__at="points")
>>
>>             and Finally:
>>
>>             I ran the script for Kcross.inhom for the method (1):
>>             estimate intensities
>>             by nonparametric smoothing, but I had the error.
>>
>>                 K <- Kcross.inhom(Z, "ficus", "tienda", lambdaf, lambdat)
>>
>>             Error in Kwtsum(dclose, bI, weight, b, 1/lambdaI, breaks) :
>>                 Weights in K-function were infinite or NA
>>
>>             I tryed the method (2): leave-one-out, but I had the same
>>             problems
>>
>>             Any help is appreciated. A lot of thanks.
>>
>>
>>
>>
>>
>>
>>             --
>>             View this message in context:
>>
>> http://r-sig-geo.2731867.n2.__nabble.com/Problems-with-__Kcross-inhom-__tp7584914p7584920.html
>>
>> <http://r-sig-geo.2731867.n2.nabble.com/Problems-with-Kcross-inhom-tp7584914p7584920.html>
>>             Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>>             _________________________________________________
>>             R-sig-Geo mailing list
>>             R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>             https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>>             <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>>
>>         _________________________________________________
>>         R-sig-Geo mailing list
>>         R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>>         https://stat.ethz.ch/mailman/__listinfo/r-sig-geo
>>         <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>>
>>
>>
>>     --
>>     Julia
>>
>>
>>
>>
>> --
>>
>> Saludos
>>
>> David Villalobos Chaves
>> Maestr?a Acad?mica en Biolog?a
>> Universidad de Costa Rica
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>


-- 

Saludos

David Villalobos Chaves
Maestr?a Acad?mica en Biolog?a
Universidad de Costa Rica


From Bastien.Ferland-Raymond at mrn.gouv.qc.ca  Tue Oct 29 15:31:10 2013
From: Bastien.Ferland-Raymond at mrn.gouv.qc.ca (Bastien.Ferland-Raymond at mrn.gouv.qc.ca)
Date: Tue, 29 Oct 2013 10:31:10 -0400
Subject: [R-sig-Geo] using the raster package to calculate knn results from
	yaImpute
Message-ID: <161DC602615F6943A19BAEA3DBF2E4B901B21676EA69@HARFANG.intranet.mrn.gouv>

Dear List,

I've been working on a way to make knn forest maps from satellite imagery and I'm using both the raster package (to prepare my data) and the yaImpute package (to do the knn).  The problem is that the yaImpute package requires data frames as inputs and I have rasters. So I have to do:

Raster -> data.frame -> knn -> data.frame -> raster

Which is not efficient.  I would like to be able to do directly:
Raster -> knn -> raster

Using the calc() fonction from the raster.  I've made a function that I thought would work however it doesn't, it gives me the error: "cannot use this function".  Any idea if my task is doable?

Here is a code example:

####
library(raster);library(yaImpute)

###  preparing the raster used as input:
r <- raster(nrow=50, ncol=50, xmn=0, xmx=50, ymn=0, ymx=50, crs=NA)
r.x1 <- r.x2 <- r.x3 <- r.x4 <- r.y1 <- r.y2 <- r
set.seed(123)
values(r.x1) <- rnorm(2500,10,1)
values(r.x2) <- rnorm(2500,13,1.1)
values(r.x3) <- rnorm(2500,20,5)
values(r.x4) <- rnorm(2500,.5,.05)
values(r.y1) <- rnorm(2500,10,1)
values(r.y2) <- rnorm(2500,50,5)
r.x.st <- stack(r.x1,r.x2,r.x3,r.x4)
names(r.x.st) <- c("varX1", "varX2","varX3","varX4")
r.y.st <- stack(r.y1,r.y2)
names(r.y.st) <- c("varY1", "varY2")
###


###  Making the table to use in yaImpute as reference observations
tab.x <- sampleRegular(r.x.st, 100, cells=T)        # choose the reference observations
rownames(tab.x) <- tab.x[,1]
tab.x <- tab.x[,-1]
tab.y <- sampleRegular(r.y.st, 100, cells=T)        # choose the reference observations
rownames(tab.y) <- tab.y[,1]
tab.y <- tab.y[,-1]
###


###  Praparing the knn (it's kind of a pre-knn that uses only the references set.
###  The object that it produces here is latter used on the target observations
res.yai <- yai(x=tab.x, y=tab.y, k=4, method="euclidean")
###


###  My function to get the prediction for a target observation
prod.knn.raster <-function(vec.bandes, info.yai, na.rm=T){
  dat <- rbind(vec.bandes,vec.bandes)                       # yaImpute needs a matrix as input (of usually at least 2 observations or it doesn't work)
  rownames(dat) <- c(paste0("o",round(runif(1,1,1000000000000000))),paste0("o",round(runif(1,1,1000000000000000)),"b"))  # it need a UNIQUE id for the pixel, there is maybe a way to use the cell number but I don't know it.
  res.knn.cible<-newtargets(info.yai,dat)                   # find the k nearest neighbours associated with the pixel of the raster
  res.imp <- impute.yai(res.knn.cible,observed=F)           # impute the values of the response variable for the pixel
  res <- res.imp [1,]                                       # keep one of the observations
  res                                                       # returns a vector of same length as the number of Y variables
}

### If I try my fonction directly it works
prod.knn.raster(vec.bandes=r.x.st[1], info.yai=res.yai, na.rm=T)
                   varY1    varY2
o87892296724022 11.17959 48.55119

### but if I put it in calc it doesn't:
qwqw <- calc(r.x.st, prod.knn.raster,info.yai=res.yai)
Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
  cannot use this function
####

I have a feeling the problem is linked with the fact I have to get the res.yai object into the function...

Anyway, thanks a lot for the potential help!


Bastien Ferland-Raymond, M.Sc. Stat., M.Sc. Biol.
Division des orientations et projets sp?ciaux
Direction des inventaires forestiers
Minist?re des Ressources naturelles
880, chemin Sainte-Foy, 5e ?tage
Qu?bec (Qu?bec) G1S 4X4


From jgrn at illinois.edu  Tue Oct 29 17:33:03 2013
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Tue, 29 Oct 2013 11:33:03 -0500
Subject: [R-sig-Geo] Singlepart to multipart
Message-ID: <CABG0rfuSWTAAZ7AYUxksJBrjT__=gHLxAyX74Ob+RYYCAJtpMA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131029/e11ed8e5/attachment.pl>

From perlman84 at gmail.com  Tue Oct 29 19:11:02 2013
From: perlman84 at gmail.com (Joshua Perlman)
Date: Tue, 29 Oct 2013 13:11:02 -0500
Subject: [R-sig-Geo] Issue reading GRASS rasters with rgdal
Message-ID: <CANv=Tc=tAJN7XGYWEtwjmRM1HPLX1EJn1pjk+kujrX+zsBBA=Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131029/edd0061d/attachment.pl>

From Roger.Bivand at nhh.no  Tue Oct 29 20:27:24 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 29 Oct 2013 20:27:24 +0100
Subject: [R-sig-Geo] Issue reading GRASS rasters with rgdal
In-Reply-To: <CANv=Tc=tAJN7XGYWEtwjmRM1HPLX1EJn1pjk+kujrX+zsBBA=Q@mail.gmail.com>
References: <CANv=Tc=tAJN7XGYWEtwjmRM1HPLX1EJn1pjk+kujrX+zsBBA=Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310292009240.3464@reclus.nhh.no>

Please do not post HTML, do follow the posting guide and instructions.

On Tue, 29 Oct 2013, Joshua Perlman wrote:

> Hello,
>
> I am attempting to read rasters from GRASS format into R directly through
> rgdal (without running GRASS).  The GDAL GRASS plugin is installed and
> apparently working as evidenced by a call to gdalinfo with one of the GRASS
> rasters.
>
> However, when I run these lines in R:
>
> library(rgdal)
> R = readGDAL("/path/cellhd/raster")
>
> R tells me:
>
> /path/cellhd/raster has GDAL driver GRASS
> and has 23457 rows and 35104 columns

Really? You'll have around 800 million cells, if numeric needing over 6GB, 
and probably copied multiple times internally. Use GRASS to manipulate 
data of this kind, or use the facilities in rgdal to read parts of the 
data in tiles. It is very unlikely that any statistical method is 
appropriate for raster data of this kind, unless you are predicting from a 
fitted model, which can be done in tiles. Since you have not included any 
affiliation or motivation, how should anyone know what your problem is? In 
general avoid non-informative subscribed addresses, at least an 
institutional address gives some insight into why you need to know.

The plugin also has no write functionality, so it isn't easy to see what 
the point is. The error may also show that the plugin doesn't actually 
work.

> Error in x[, , i] <- .Call("RGDAL_GetRasterData", raster,
> as.integer(c(offset,  :
>  number of items to replace is not a multiple of replacement length
>
> Any ideas what my causing this error and how to fix it?
>

If you had provided your verbatim command, the output of traceback() and 
the output of sessionInfo(), as well as the startup messages shown when 
loading rgdal, we might be a little the wiser. Can you reproduce the error 
with any other data set? The error is flagged in getRasterData() called in 
readGDAL(), and indicates that the number of values in the band is likely 
not the product of the numbers of rows and columns.

Hope this clarifies,

Roger

> Thanks,
>
> Josh
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Oct 29 20:32:22 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 29 Oct 2013 20:32:22 +0100
Subject: [R-sig-Geo] Singlepart to multipart
In-Reply-To: <CABG0rfuSWTAAZ7AYUxksJBrjT__=gHLxAyX74Ob+RYYCAJtpMA@mail.gmail.com>
References: <CABG0rfuSWTAAZ7AYUxksJBrjT__=gHLxAyX74Ob+RYYCAJtpMA@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310292030311.3464@reclus.nhh.no>

On Tue, 29 Oct 2013, Jonathan Greenberg wrote:

> R-sig-geo'ers:
>
> If I have a SpatialPolygonsDataFrame with a field "MYID", how do I go about
> coercing that object to a multipart polygon, where I am "merging" on the
> MYID field?

maptools::unionSpatialPolygons() which calls rgeos::gUnaryUnion, so go to 
rgeos::gUnaryUnion first unless you have challenged geometries - if hole 
problems use maptools::checkPolygonsHoles first.

Hope this helps,

Roger

>
> --j
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From baremma2002 at yahoo.fr  Wed Oct 30 15:47:13 2013
From: baremma2002 at yahoo.fr (baremma2002)
Date: Wed, 30 Oct 2013 07:47:13 -0700 (PDT)
Subject: [R-sig-Geo] spplot : Computing variances of prediction with
 log-transformed data in R
Message-ID: <1383144433326-7584987.post@n2.nabble.com>

Dear users,

How can I compute the variances of prediction (ordinary kriging) using
log-transformed data in R:

library(gstat)
library(sp)
data(meuse)
coordinates(meuse)=~x+y
data(meuse.grid)
gridded(meuse.grid) = ~x+y
modv <- vgm(psill=0.5, model="Sph", range=900, nug = 0)
fitv <- fit.variogram(variogram(log(zinc)~ 1,meuse),model=modv)
res <- krige(log(zinc) ~ 1, meuse, meuse.grid,model = fitv)

Suppose the observed process Z(s) is the variable "zinc". If we assume that
Y(s) = log Z(s)
is a Gaussian process where s is a space-point, we can write:

res <- krige(Y(s) ~ 1, meuse, meuse.grid,model = fitv)

Moreover, Y(s) = mean(Y) + delta(s) 

where delta(s) is intrinsically stationary with mean 0. Ordinary Kriging on
the Y-scale yields kriging coefficients lambdaY and Lagrange multiplier mY.
Then the best linear predictor of Y(s0) is

pY(s0) = lambdaY Y

and the kriging variance is

var(Y(s0) = SUM(lambdaY semivar(s0-si) + MUY

Cressie (1993) proposed this formula to compute the unbiased predictor for
variances (mean-squared prediction error,) back on the Z-scale, of Z(s0):
 
var = {exp(2mean(Y) + var(Y(s0))}{exp(var(Y(s0)) + exp(var(pY(s0))) -
2exp(cov(Y(s0),pY(s0))} ;

The last term is the covariance between the observed and the predicted data
at the space-point s0. However, suppose that this variable is observed at 10
space-points. The predicted values will be at the other points where the
values are unknown. The covariance will be equal to zero and var will be a
constant. The kriging is exact interpolator and the predicted values are
equal to the observed values at the observed points and the covariance will
be equal to zero. Is it true? How can I compute this variance in R with
back-transformed data? Thanks.

Emmanuel BARANKANIRA




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spplot-Computing-variances-of-prediction-with-log-transformed-data-in-R-tp7584987.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From avi3187 at gmail.com  Wed Oct 30 15:52:14 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Wed, 30 Oct 2013 08:52:14 -0600
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
	created with writePolyShape
Message-ID: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/2927d194/attachment.pl>

From mspinola10 at gmail.com  Wed Oct 30 16:18:07 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 30 Oct 2013 09:18:07 -0600
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
In-Reply-To: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
References: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
Message-ID: <CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/2a18fba3/attachment.pl>

From avi3187 at gmail.com  Wed Oct 30 17:41:57 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Wed, 30 Oct 2013 10:41:57 -0600
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
In-Reply-To: <CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>
References: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
	<CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>
Message-ID: <CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/063d8418/attachment.pl>

From noelia.gonzalezm at gmail.com  Wed Oct 30 18:03:30 2013
From: noelia.gonzalezm at gmail.com (Acacia dealbata)
Date: Wed, 30 Oct 2013 10:03:30 -0700 (PDT)
Subject: [R-sig-Geo] Aggregate raster
Message-ID: <1383152610567-7584991.post@n2.nabble.com>

Hi community!

I have a raster of Global Land Cover with a resolution of 1 km
(http://glcf.umd.edu/). 

I want to change its resolution to be similar to that of the rest of the
rasters I am using for my project (0.166667 degrees).

Besides, I want to recalculate the value for each new cell. In the original
raster, there are 12 categories of land use. In my new raster, I want the
new cells to have the value more often repeated among those of the original
cells.

I have tried with this:

rnew<-aggregate(rprevious, factor=(1/0.1666667), fun=modal)

But it is not working. Any help? Seems correct?

Thank you!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Aggregate-raster-tp7584991.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mspinola10 at gmail.com  Wed Oct 30 18:24:29 2013
From: mspinola10 at gmail.com (=?ISO-8859-1?Q?Manuel_Sp=EDnola?=)
Date: Wed, 30 Oct 2013 11:24:29 -0600
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
In-Reply-To: <CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>
References: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
	<CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>
	<CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>
Message-ID: <CABkCotTAkUOySJM67PH-dgOc6G-rMpD6PBJoGNp0T+=b-nR2JQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/b197336d/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Oct 30 18:24:34 2013
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 30 Oct 2013 18:24:34 +0100
Subject: [R-sig-Geo] spplot : Computing variances of prediction with
 log-transformed data in R
In-Reply-To: <1383144433326-7584987.post@n2.nabble.com>
References: <1383144433326-7584987.post@n2.nabble.com>
Message-ID: <527140D2.2050808@uni-muenster.de>

Dear Emmanuel, you may want to look into what gstat::krigeTg does, it
might be close or identical to what you want.

On 10/30/2013 03:47 PM, baremma2002 wrote:
> Dear users,
> 
> How can I compute the variances of prediction (ordinary kriging) using
> log-transformed data in R:
> 
> library(gstat)
> library(sp)
> data(meuse)
> coordinates(meuse)=~x+y
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> modv <- vgm(psill=0.5, model="Sph", range=900, nug = 0)
> fitv <- fit.variogram(variogram(log(zinc)~ 1,meuse),model=modv)
> res <- krige(log(zinc) ~ 1, meuse, meuse.grid,model = fitv)
> 
> Suppose the observed process Z(s) is the variable "zinc". If we assume that
> Y(s) = log Z(s)
> is a Gaussian process where s is a space-point, we can write:
> 
> res <- krige(Y(s) ~ 1, meuse, meuse.grid,model = fitv)
> 
> Moreover, Y(s) = mean(Y) + delta(s) 
> 
> where delta(s) is intrinsically stationary with mean 0. Ordinary Kriging on
> the Y-scale yields kriging coefficients lambdaY and Lagrange multiplier mY.
> Then the best linear predictor of Y(s0) is
> 
> pY(s0) = lambdaY Y
> 
> and the kriging variance is
> 
> var(Y(s0) = SUM(lambdaY semivar(s0-si) + MUY
> 
> Cressie (1993) proposed this formula to compute the unbiased predictor for
> variances (mean-squared prediction error,) back on the Z-scale, of Z(s0):
>  
> var = {exp(2mean(Y) + var(Y(s0))}{exp(var(Y(s0)) + exp(var(pY(s0))) -
> 2exp(cov(Y(s0),pY(s0))} ;
> 
> The last term is the covariance between the observed and the predicted data
> at the space-point s0. However, suppose that this variable is observed at 10
> space-points. The predicted values will be at the other points where the
> values are unknown. The covariance will be equal to zero and var will be a
> constant. The kriging is exact interpolator and the predicted values are
> equal to the observed values at the observed points and the covariance will
> be equal to zero. Is it true? How can I compute this variance in R with
> back-transformed data? Thanks.
> 
> Emmanuel BARANKANIRA
> 
> 
> 
> 
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spplot-Computing-variances-of-prediction-with-log-transformed-data-in-R-tp7584987.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany. Phone: +49 251
83 33081 http://ifgi.uni-muenster.de GPG key ID 0xAC227795

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 555 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/3e19dbaa/attachment.bin>

From M.Huck at derby.ac.uk  Wed Oct 30 18:24:54 2013
From: M.Huck at derby.ac.uk (Maren Huck)
Date: Wed, 30 Oct 2013 17:24:54 +0000
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
Message-ID: <0E1E893FE7447F4F883C415B21D0E5E9012639DD5973@MKT-MBX01.university.ds.derby.ac.uk>

Hi David,
Could the problem be that the function locoh.a does not actually create a single convex hull, but a multitude. So you have to select the locoh with the percentage you want by looking at
as.data.frame(locoh)
This will give you a long list, and you select the row which comes closest to your preferred percentage value, e.g., 90% or 95%. And when you plot, you need to specify that row.

I just tried with my own data, and it worked, using spplot.

library(maptools)
library(adehabitatHS)
library(mapproj)
library(rgdal)
library(rgeos)

minX<-min(Helen_sp$X)
maxX<-max(Helen_sp$X)
minY<-min(Helen_sp$Y)
maxY<-max(Helen_sp$Y)

dista<-sqrt(((maxX-minX)^2)+((maxY-minY)^2))
dista  # should be an approximation of a for LoCoH

habitat <- readShapeSpatial("clean")
proj4string(habitat) <- CRS("+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs")

nn_a <- LoCoH.a(Helen_sp, a=401, unin="m", unout="ha")
plot(nn_a, border=NA)
as.data.frame(nn_a)       # line 115 is the first with >90% (91.5)
# The area is given as 17204. Since unout is set to "ha" this cannot be true (should be about 1.7 ha).

# To get just the locations and the locoh:
plot(Helen_sp, pch=16, col="blue")
plot(nn_a[115,], border="red", add=T)      # 91.5%

# To plot on my map
code<-c("orange", "pink", "lightblue", "blue", "green3", "green", "darkseagreen", "grey",  "darkgreen")   # a list of suitable colours for the map
spplot(habitat, zcol="HABITAT", col.regions=code, sp.layout=list("sp.polygons", nn_a[115,], lwd=4, col="green"))

Hope this helps,

Muchos saludos,
Maren

Maren Huck
Dep. of Biological and Forensic Sciences
University of Derby
Kedleston Road
Derby DE22 1GB
U.K.
Tel: +44-(0)1332-59 2354


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of David Villalobos
Sent: 30 October 2013 16:42
To: Manuel Sp?nola
Cc: r-sig-geo at r-project.org
Subject: [POSSIBLE SPAM] Re: [R-sig-Geo] Problems with the Spatial Reference of a shapefile created with writePolyShape

Hi Manuel

Thank you, I tryed your solution and it works partially

xysp <- SpatialPoints(xy)

proj4string(xysp) <- CRS("+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000
+k=0.9999 +datum=WGS84")

> xysp
SpatialPoints:
              X       Y
  [1,] 815196.4 1152758
  [2,] 815196.0 1152759
  [3,] 815055.7 1152120
  [4,] 815055.7 1152120
  [5,] 815056.5 1152122
  [6,] 815061.6 1152131.......

Coordinate Reference System (CRS) arguments: +proj=tmerc +lon_0=-84
+lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84

> locoh<- LoCoH.a(xysp, a=657,
unin=c("m"),unout=c("ha"),duplicates=c("random"),amount=NULL)

> summary(locoh)
Object of class SpatialPolygonsDataFrame
Coordinates:
        min       max
x  815048.9  815365.8
y 1152113.3 1152759.5
Is projected: TRUE
proj4string :
[+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84] Data attributes:
      area            percent
 Min.   :  789.5   Min.   : 54.17
 1st Qu.:  789.5   1st Qu.: 54.17
 Median :  834.9   Median : 60.83
 Mean   : 6311.2   Mean   : 69.13
 3rd Qu.: 8263.5   3rd Qu.: 85.83
 Max.   :31699.1   Max.   :100.00

BUT, when I create the shapefile > writePolyShape(locoh, "Locohraul") the same problem appear in AarGis 10.0:  "UnKnown Spatial Reference: object missing spatial reference information, this can be drawn, but can't be projected."

Then, the object is draw, but not projected. The map of my study area and the shapefile of my LoCoH.a analysis doesn't match.

Any idea? Thank you



2013/10/30 Manuel Sp?nola <mspinola10 at gmail.com>

> Hi David,
>
> You don?t have the CRS.
>
> Try this:
>
> proj4string(xysp) <- CRS("+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000
> +k=0.9999 +datum=WGS84")
>
> Best,
>
> Manuel Sp?nola
>
>
> 2013/10/30 David Villalobos <avi3187 at gmail.com>
>
>> Dear list,
>>
>> Maybe a silly problem, but I need help to solve it.
>>
>> At this moment I am working with the R package "adehabitatHR", 
>> specifically with the LoCoH.a (Adaptative LoCoh). I am calculating 
>> the home range of a neotropical bat (Ectophylla alba: 
>> Phyllostomidae). My commands are the followings:
>>
>> xy<-read.table("clipboard", header=T)
>>
>> head(xy)
>>
>>          X       Y
>>
>> 1 815802.7 1151723
>>
>> 2 815816.2 1151717
>>
>> 3 815816.1 1151811
>>
>> 4 816053.5 1151723
>>
>> 5 816027.1 1151698
>>
>> 6 816096.1 1151687
>>
>> xysp
>>
>> SpatialPoints:
>>
>>               X       Y
>>
>>   [1,] 815802.7 1151723
>>
>>   [2,] 815816.2 1151717
>>
>>   [3,] 815816.1 1151811
>>
>>   [4,] 816053.5 1151723
>>
>>   [5,] 816027.1 1151698.........
>>
>> Coordinate Reference System (CRS) arguments: NA
>>
>>
>> locoh<- LoCoH.a(xysp, a=1419,
>> unin=c("m"),unout=c("ha"),duplicates=c("random"),amount=NULL)
>>
>> plot(locoh)
>>
>> plot(xysp,add=T)
>>
>> locohhr<- MCHu2hrsize(locoh, percent=seq(10, 100, by=5))
>>
>> locohhr
>>
>>             df
>>
>> 10    2935.613
>>
>> 15    2935.613
>>
>> 20    2935.613
>>
>> 25    2935.613........
>>
>> At this point everything right, and now my purpose is to create a 
>> "shapefile" using the object "locoh" (Class =
>> SpatialPolygonsDataFrame) with this command:
>>
>> writePolyShape(locohhr, "LocohI")
>>
>> Here, the real problem: I want to use the shapefile created on a map 
>> of my study area (in Costa Rica). I have the map in the local 
>> Projected Coordinate System:
>>
>>  Projected Coordinate System:   Proyeccion_CRTM05
>>
>> Projection:    Transverse_Mercator
>>
>> False_Easting: 500000.00000000
>>
>> False_Northing: 0.00000000
>>
>> Central_Meridian:      -84.00000000
>>
>> Scale_Factor:  0.99990000
>>
>> Latitude_Of_Origin:    0.00000000
>>
>> Linear Unit:   Meter
>>
>> Geographic Coordinate System:  GCS_WGS_1984
>>
>> Datum:  D_WGS_1984
>>
>> Prime Meridian:        Greenwich
>>
>> Angular Unit:  Degree
>>
>>
>> The first step is to read the shapefile in ArcMap 10. When I try to 
>> read the shapefile of my LoCoH.a analysis, I can't do it good because 
>> the following message appear: "UnKnown Spatial Reference: object 
>> missing spatial reference information, this can be drawn, but can't 
>> be projected."
>>
>> Then, the object is draw, but not projected. The map of my study area 
>> and the shapefile of my LoCoH.a analysis doesn't match.
>>
>>
>> I want to solve this problem with spatial reference information of my 
>> shapefile(LoCoH.a). I suspect that the way to do it is related with 
>> one part of the command writePolyShape(locoh, "LocohI"), maybe the
>> part: "proj4string=CRS(as.character(NA)".
>>
>>
>>
>> Please any help is welcome. I will be very appreciated.
>>
>>
>>  Since now, THANK YOU.
>>
>>
>> --
>>
>> Saludos
>>
>> David Villalobos Chaves
>> Maestr?a Acad?mica en Biolog?a
>> Universidad de Costa Rica
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre 
> Universidad Nacional Apartado 1350-3000 Heredia COSTA RICA 
> mspinola at una.ac.cr mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de 
> r?o<https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>



-- 

Saludos

David Villalobos Chaves
Maestr?a Acad?mica en Biolog?a
Universidad de Costa Rica

	[[alternative HTML version deleted]]

_____________________________________________________________________
The University of Derby has a published policy regarding email and reserves the right to monitor email traffic. If you believe this email was sent to you in error, please notify the sender and delete this email. Please direct any concerns to Infosec at derby.ac.uk.


From Roger.Bivand at nhh.no  Wed Oct 30 19:43:54 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Oct 2013 19:43:54 +0100
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
In-Reply-To: <CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>
References: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
	<CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>
	<CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>
Message-ID: <alpine.LRH.2.03.1310301939120.6984@reclus.nhh.no>

On Wed, 30 Oct 2013, David Villalobos wrote:

> Hi Manuel
>
> Thank you, I tryed your solution and it works partially
>
> xysp <- SpatialPoints(xy)
>
> proj4string(xysp) <- CRS("+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000
> +k=0.9999 +datum=WGS84")
>
>> xysp
> SpatialPoints:
>              X       Y
>  [1,] 815196.4 1152758
>  [2,] 815196.0 1152759
>  [3,] 815055.7 1152120
>  [4,] 815055.7 1152120
>  [5,] 815056.5 1152122
>  [6,] 815061.6 1152131.......
>
> Coordinate Reference System (CRS) arguments: +proj=tmerc +lon_0=-84
> +lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84
>
>> locoh<- LoCoH.a(xysp, a=657,
> unin=c("m"),unout=c("ha"),duplicates=c("random"),amount=NULL)
>
>> summary(locoh)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>        min       max
> x  815048.9  815365.8
> y 1152113.3 1152759.5
> Is projected: TRUE
> proj4string :
> [+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000 +k=0.9999 +datum=WGS84]
> Data attributes:
>      area            percent
> Min.   :  789.5   Min.   : 54.17
> 1st Qu.:  789.5   1st Qu.: 54.17
> Median :  834.9   Median : 60.83
> Mean   : 6311.2   Mean   : 69.13
> 3rd Qu.: 8263.5   3rd Qu.: 85.83
> Max.   :31699.1   Max.   :100.00
>
> BUT, when I create the shapefile > writePolyShape(locoh, "Locohraul") the
> same problem appear in AarGis 10.0:  "UnKnown Spatial Reference: object
> missing spatial reference information, this can be drawn, but can't be
> projected."

Never use the shapefile functions in the maptools (or shapefiles) packages 
if you have access to rgdal. In rgdal, writeOGR() for the "ESRI Shapefile" 
driver, the *.prj file is written correctly and will be recognised by 
ArcGIS. The functions in maptools will be withdrawn very soon, this case 
showing that removing them is in everyone's interests. The description of 
maptools will be modified to suit.

Roger

>
> Then, the object is draw, but not projected. The map of my study area
> and the shapefile of my LoCoH.a analysis doesn't match.
>
> Any idea? Thank you
>
>
>
> 2013/10/30 Manuel Sp?nola <mspinola10 at gmail.com>
>
>> Hi David,
>>
>> You don?t have the CRS.
>>
>> Try this:
>>
>> proj4string(xysp) <- CRS("+proj=tmerc +lon_0=-84 +lat_0=0 +x_0=500000
>> +k=0.9999 +datum=WGS84")
>>
>> Best,
>>
>> Manuel Sp?nola
>>
>>
>> 2013/10/30 David Villalobos <avi3187 at gmail.com>
>>
>>> Dear list,
>>>
>>> Maybe a silly problem, but I need help to solve it.
>>>
>>> At this moment I am working with the R package "adehabitatHR",
>>> specifically with the LoCoH.a (Adaptative LoCoh). I am calculating the
>>> home range of a neotropical bat (Ectophylla alba: Phyllostomidae). My
>>> commands are the followings:
>>>
>>> xy<-read.table("clipboard", header=T)
>>>
>>> head(xy)
>>>
>>>          X       Y
>>>
>>> 1 815802.7 1151723
>>>
>>> 2 815816.2 1151717
>>>
>>> 3 815816.1 1151811
>>>
>>> 4 816053.5 1151723
>>>
>>> 5 816027.1 1151698
>>>
>>> 6 816096.1 1151687
>>>
>>> xysp
>>>
>>> SpatialPoints:
>>>
>>>               X       Y
>>>
>>>   [1,] 815802.7 1151723
>>>
>>>   [2,] 815816.2 1151717
>>>
>>>   [3,] 815816.1 1151811
>>>
>>>   [4,] 816053.5 1151723
>>>
>>>   [5,] 816027.1 1151698.........
>>>
>>> Coordinate Reference System (CRS) arguments: NA
>>>
>>>
>>> locoh<- LoCoH.a(xysp, a=1419,
>>> unin=c("m"),unout=c("ha"),duplicates=c("random"),amount=NULL)
>>>
>>> plot(locoh)
>>>
>>> plot(xysp,add=T)
>>>
>>> locohhr<- MCHu2hrsize(locoh, percent=seq(10, 100, by=5))
>>>
>>> locohhr
>>>
>>>             df
>>>
>>> 10    2935.613
>>>
>>> 15    2935.613
>>>
>>> 20    2935.613
>>>
>>> 25    2935.613........
>>>
>>> At this point everything right, and now my purpose is to create a
>>> "shapefile" using the object "locoh" (Class =
>>> SpatialPolygonsDataFrame) with this command:
>>>
>>> writePolyShape(locohhr, "LocohI")
>>>
>>> Here, the real problem: I want to use the shapefile created on a map
>>> of my study area (in Costa Rica). I have the map in the local
>>> Projected Coordinate System:
>>>
>>>  Projected Coordinate System:   Proyeccion_CRTM05
>>>
>>> Projection:    Transverse_Mercator
>>>
>>> False_Easting: 500000.00000000
>>>
>>> False_Northing: 0.00000000
>>>
>>> Central_Meridian:      -84.00000000
>>>
>>> Scale_Factor:  0.99990000
>>>
>>> Latitude_Of_Origin:    0.00000000
>>>
>>> Linear Unit:   Meter
>>>
>>> Geographic Coordinate System:  GCS_WGS_1984
>>>
>>> Datum:  D_WGS_1984
>>>
>>> Prime Meridian:        Greenwich
>>>
>>> Angular Unit:  Degree
>>>
>>>
>>> The first step is to read the shapefile in ArcMap 10. When I try to
>>> read the shapefile of my LoCoH.a analysis, I can't do it good because
>>> the following message appear: "UnKnown Spatial Reference: object
>>> missing spatial reference information, this can be drawn, but can't be
>>> projected."
>>>
>>> Then, the object is draw, but not projected. The map of my study area
>>> and the shapefile of my LoCoH.a analysis doesn't match.
>>>
>>>
>>> I want to solve this problem with spatial reference information of my
>>> shapefile(LoCoH.a). I suspect that the way to do it is related with
>>> one part of the command writePolyShape(locoh, "LocohI"), maybe the
>>> part: "proj4string=CRS(as.character(NA)".
>>>
>>>
>>>
>>> Please any help is welcome. I will be very appreciated.
>>>
>>>
>>>  Since now, THANK YOU.
>>>
>>>
>>> --
>>>
>>> Saludos
>>>
>>> David Villalobos Chaves
>>> Maestr?a Acad?mica en Biolog?a
>>> Universidad de Costa Rica
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.ac.cr
>> mspinola10 at gmail.com
>> Tel?fono: (506) 2277-3598
>> Fax: (506) 2237-7036
>> Personal website: Lobito de r?o<https://sites.google.com/site/lobitoderio/>
>> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From avi3187 at gmail.com  Wed Oct 30 21:15:47 2013
From: avi3187 at gmail.com (David Villalobos)
Date: Wed, 30 Oct 2013 14:15:47 -0600
Subject: [R-sig-Geo] Problems with the Spatial Reference of a shapefile
 created with writePolyShape
In-Reply-To: <alpine.LRH.2.03.1310301939120.6984@reclus.nhh.no>
References: <CA+78ZtHY_zbbGbx7fxDZ_xj50oOwqi=QZ1tf5eqJSZT2WSR1Hw@mail.gmail.com>
	<CABkCotSaKCdRziieMsV2BE_xZWZutv6rvMzmUGz9yEriq1nf=w@mail.gmail.com>
	<CA+78ZtFYKmy4zRS-eEo2UfkQa=O2Mpccta2Z2mVmqudYOBKwEw@mail.gmail.com>
	<alpine.LRH.2.03.1310301939120.6984@reclus.nhh.no>
Message-ID: <CA+78ZtFHhG1d3_9kowCmBn20A0FME80TN+Cs6noE-ouxiP+ryA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/08c9c2d4/attachment.pl>

From agus.camacho at gmail.com  Wed Oct 30 21:40:20 2013
From: agus.camacho at gmail.com (Agus Camacho)
Date: Wed, 30 Oct 2013 18:40:20 -0200
Subject: [R-sig-Geo] how to obtain coordinates of each clump using "zonal"
	from raster package
Message-ID: <CALsJ7pSQTS9URYc8MMMdH9Jwv_whchiF+MEH3ejKdxEPrkKpPA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131030/3701f6be/attachment.pl>

From dusa.adrian at unibuc.ro  Wed Oct 30 21:59:37 2013
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Wed, 30 Oct 2013 22:59:37 +0200
Subject: [R-sig-Geo] simplify map for web use
Message-ID: <CAJ=0CtAas6eYhveNOSeF_8jxUGXJGkeEyQL+En8dJSDgEDNfjg@mail.gmail.com>

Dear All,

A question from a very beginner with maps and geographic data.
I have a map with many (too many) vertices which I would like to use
interactively over a web page. What I need is to simplify that map,
make it <similar> to the original one but discarding 90% of the
current information.

I read that is possible using QGIS (which I have installed), but I
wonder if it would be possible in R. I would gladly use an R function
instead of learning how to use QGIS.

Thanks in advance,
Adrian

-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391


From tech_dev at wildintellect.com  Wed Oct 30 22:26:55 2013
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Wed, 30 Oct 2013 14:26:55 -0700
Subject: [R-sig-Geo] simplify map for web use
In-Reply-To: <CAJ=0CtAas6eYhveNOSeF_8jxUGXJGkeEyQL+En8dJSDgEDNfjg@mail.gmail.com>
References: <CAJ=0CtAas6eYhveNOSeF_8jxUGXJGkeEyQL+En8dJSDgEDNfjg@mail.gmail.com>
Message-ID: <5271799F.3050403@wildintellect.com>

On 10/30/2013 01:59 PM, Adrian Du?a wrote:
> Dear All,
> 
> A question from a very beginner with maps and geographic data.
> I have a map with many (too many) vertices which I would like to use
> interactively over a web page. What I need is to simplify that map,
> make it <similar> to the original one but discarding 90% of the
> current information.
> 
> I read that is possible using QGIS (which I have installed), but I
> wonder if it would be possible in R. I would gladly use an R function
> instead of learning how to use QGIS.
> 
> Thanks in advance,
> Adrian
> 

Not an R method but way easy, http://www.mapshaper.org/

A quick search shows several R packages that also have the
Douglas-Peucker algorithm. Look at 'shapefiles' or 'cshapes' packages

Enjoy,
Alex


From Roger.Bivand at nhh.no  Wed Oct 30 22:42:13 2013
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 30 Oct 2013 22:42:13 +0100
Subject: [R-sig-Geo] simplify map for web use
In-Reply-To: <5271799F.3050403@wildintellect.com>
References: <CAJ=0CtAas6eYhveNOSeF_8jxUGXJGkeEyQL+En8dJSDgEDNfjg@mail.gmail.com>
	<5271799F.3050403@wildintellect.com>
Message-ID: <alpine.LRH.2.03.1310302233530.7458@reclus.nhh.no>

On Wed, 30 Oct 2013, Alex Mandel wrote:

> On 10/30/2013 01:59 PM, Adrian Du?a wrote:
>> Dear All,
>> 
>> A question from a very beginner with maps and geographic data.
>> I have a map with many (too many) vertices which I would like to use
>> interactively over a web page. What I need is to simplify that map,
>> make it <similar> to the original one but discarding 90% of the
>> current information.
>> 
>> I read that is possible using QGIS (which I have installed), but I
>> wonder if it would be possible in R. I would gladly use an R function
>> instead of learning how to use QGIS.
>> 
>> Thanks in advance,
>> Adrian
>> 
>
> Not an R method but way easy, http://www.mapshaper.org/
>

but no documentation anywhere, not on github either, but you get what you 
might expect, maybe?

> A quick search shows several R packages that also have the
> Douglas-Peucker algorithm. Look at 'shapefiles' or 'cshapes' packages

The obvious choice is rgeos::gSimplify, unless you need to preserve 
topology accurately (which mapshaper doesn't do either) - GEOS will have 
shared nodes, but not all on an arc will be shared. If you need simplified 
arcs, use GRASS from R.

Hope this helps,

Roger

>
> Enjoy,
> Alex
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From adrian.baddeley at uwa.edu.au  Thu Oct 31 02:02:12 2013
From: adrian.baddeley at uwa.edu.au (Adrian Baddeley)
Date: Thu, 31 Oct 2013 09:02:12 +0800
Subject: [R-sig-Geo] spatstat is now free open source
Message-ID: <1CEF56CFF7118748AE0FA6C0186D3A312ECDB01E@IS-WIN-172.staffad.uwa.edu.au>

Just announcing that the package 'spatstat' is now fully covered by a Free Open Source licence.

In previous versions of spatstat, polygon clipping was (optionally) performed using the package 'gpclib'
which has a restricted licence. From spatstat version 1.34-0 onward, polygon clipping is performed
using the package 'polyclip' which is free open source. This means that all uses of spatstat are now 
covered by free open source licences. 

Adrian

Prof Adrian Baddeley FAA
University of Western Australia  /and/ CSIRO Computational Informatics /and/ University of Aarhus


From loic.dutrieux at wur.nl  Thu Oct 31 10:45:56 2013
From: loic.dutrieux at wur.nl (Dutrieux, Loic)
Date: Thu, 31 Oct 2013 09:45:56 +0000
Subject: [R-sig-Geo] Aggregate raster
In-Reply-To: <1383152610567-7584991.post@n2.nabble.com>
References: <1383152610567-7584991.post@n2.nabble.com>
Message-ID: <A83620D4CC4762448EFB789FD6E9BBB72A67967B@SCOMP0937.wurnet.nl>

Hi Noelia,

The fact= arguments needs to be an integer.
You probably need to reproject anyway, right? So what about aggregating to something close to your 0.16 degree and then reproject to exactly 0.16667 degree resolution (using nearest neighbour resampling). Take a look at the new gdalUtils package (https://r-forge.r-project.org/R/?group_id=1695) for the reprojecting step; probably the gdalwarp function.

# Aggregate
rnew<-aggregate(rprevious, fact=6, fun=modal)
# Reproject using gdalwarp
...

Best regards,

--
Lo?c Dutrieux
PhD candidate
Laboratory of Geo-Information sciences and remote sensing
Wageningen University, The Netherlands



-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Acacia dealbata
Sent: Wednesday, October 30, 2013 18:04
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Aggregate raster

Hi community!

I have a raster of Global Land Cover with a resolution of 1 km (http://glcf.umd.edu/). 

I want to change its resolution to be similar to that of the rest of the rasters I am using for my project (0.166667 degrees).

Besides, I want to recalculate the value for each new cell. In the original raster, there are 12 categories of land use. In my new raster, I want the new cells to have the value more often repeated among those of the original cells.

I have tried with this:

rnew<-aggregate(rprevious, factor=(1/0.1666667), fun=modal)

But it is not working. Any help? Seems correct?

Thank you!



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Aggregate-raster-tp7584991.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From npt_eng at hotmail.com  Thu Oct 31 14:59:15 2013
From: npt_eng at hotmail.com (netra)
Date: Thu, 31 Oct 2013 06:59:15 -0700 (PDT)
Subject: [R-sig-Geo] raster interpolation within shape file
Message-ID: <1383227955294-7585003.post@n2.nabble.com>

Hello,
I am doing a raster interpolation using the gstat and raster packages. My
raster area is very big but within raster area I have a river and this is
the smallest extent of raster that covers the river. I want to interpolate
only inside river not in the whole raster area. Is there any ways that I
could limit the analysis by using mask shape file or something?

Thanks for your help


code snippet

		#read raster
rst <- raster("contor_to_dem_5m.asc")

#define model
		mg <- gstat(id = "z", formula = z~1, locations = ~x+y, data=xyz, 
		                    nmax=7, set=list(idp = .2)) #
		
#interpolate raster
		#this is time consuming :( 
		z <- interpolate(rst, mg)
		

Netra




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-interpolation-within-shape-file-tp7585003.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From palfaro at motionsoft.com.uy  Thu Oct 31 16:05:43 2013
From: palfaro at motionsoft.com.uy (Pablo Alfaro)
Date: Thu, 31 Oct 2013 13:05:43 -0200
Subject: [R-sig-Geo] raster interpolation within shape file
In-Reply-To: <1383227955294-7585003.post@n2.nabble.com>
References: <1383227955294-7585003.post@n2.nabble.com>
Message-ID: <CAGFWpksOdONx9eE6FH711mw-tVSg5Ak0kV=c924+mCs0NoJfVg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131031/09bf77d5/attachment.pl>

From ted.rosenbaum at yale.edu  Thu Oct 31 16:40:31 2013
From: ted.rosenbaum at yale.edu (Ted Rosenbaum)
Date: Thu, 31 Oct 2013 11:40:31 -0400
Subject: [R-sig-Geo] Dilation and Window Definition in Spatstat
Message-ID: <CAJgfpiisTFKJ3dKZ8udqi+nyTa-gO7=RNpLpECQw4PMNeg2Ahg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131031/7041c00d/attachment.pl>

From dusa.adrian at unibuc.ro  Thu Oct 31 18:18:47 2013
From: dusa.adrian at unibuc.ro (=?UTF-8?B?QWRyaWFuIER1yJlh?=)
Date: Thu, 31 Oct 2013 19:18:47 +0200
Subject: [R-sig-Geo] simplify map for web use
In-Reply-To: <alpine.LRH.2.03.1310302233530.7458@reclus.nhh.no>
References: <CAJ=0CtAas6eYhveNOSeF_8jxUGXJGkeEyQL+En8dJSDgEDNfjg@mail.gmail.com>
	<5271799F.3050403@wildintellect.com>
	<alpine.LRH.2.03.1310302233530.7458@reclus.nhh.no>
Message-ID: <CAJ=0CtC4dRZp2KeccKiri6dg13LOPSgmxdTxPjKLDxijz+1iGw@mail.gmail.com>

Apologies for a second message, the previous one did not make it to the
list (the attachement exceeded 50KB).
Hopefully, this time will make it.

----
Thanks very much for these hints.
What I would <really> want to achieve is a sort of a spline contour.

In the mean time, I've played with QGIS (and mapshaper.org), both of
them make a good job to simplify the Shape file, but the number of
vertices is still too high for a webpage (my intention is to simply
make an interactive map with coloured polygons function of some social
indicators). The geographical information is of a little interest
here, but very important are:
- visual appeal
- size of the map, given that it's included in a webpage (a small SVG
definition is perfect)

>From QGIS, I've exported a SVG file and at a first impression it has
way too many details. A "smooth" contour would be ideal, something
like in the attached print screen (not sure if it will go through the
r-sig-geo archive, though).

Will play with rgeos::gSimplify and GRASS, if this would be achievable.

Best wishes, thanks again,
Adrian


On Wed, Oct 30, 2013 at 11:42 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Wed, 30 Oct 2013, Alex Mandel wrote:
>
>  On 10/30/2013 01:59 PM, Adrian Du?a wrote:
>>
>>> Dear All,
>>>
>>> A question from a very beginner with maps and geographic data.
>>> I have a map with many (too many) vertices which I would like to use
>>> interactively over a web page. What I need is to simplify that map,
>>> make it <similar> to the original one but discarding 90% of the
>>> current information.
>>>
>>> I read that is possible using QGIS (which I have installed), but I
>>> wonder if it would be possible in R. I would gladly use an R function
>>> instead of learning how to use QGIS.
>>>
>>> Thanks in advance,
>>> Adrian
>>>
>>>
>> Not an R method but way easy, http://www.mapshaper.org/
>>
>>
> but no documentation anywhere, not on github either, but you get what you
> might expect, maybe?
>
>
>  A quick search shows several R packages that also have the
>> Douglas-Peucker algorithm. Look at 'shapefiles' or 'cshapes' packages
>>
>
> The obvious choice is rgeos::gSimplify, unless you need to preserve
> topology accurately (which mapshaper doesn't do either) - GEOS will have
> shared nodes, but not all on an arc will be shared. If you need simplified
> arcs, use GRASS from R.
>
> Hope this helps,
>
> Roger
>
>
>> Enjoy,
>> Alex
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>



-- 
Adrian Dusa
University of Bucharest
Romanian Social Data Archive
1, Schitu Magureanu Bd.
050025 Bucharest sector 5
Romania
Tel.:+40 21 3126618 \
        +40 21 3120210 / int.101
Fax: +40 21 3158391
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131031/1a077cf2/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smooth spline.png
Type: image/png
Size: 20481 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131031/1a077cf2/attachment.png>

From sofeawright at gmail.com  Thu Oct 31 21:39:35 2013
From: sofeawright at gmail.com (Sofea Wright)
Date: Thu, 31 Oct 2013 20:39:35 +0000
Subject: [R-sig-Geo] Fit a sine curve to raster stack
Message-ID: <CAB5R0=W4fP6nACWFGGdYAK-7R8xc0o8HRUGDCtiaJYb3-OcmZg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20131031/b8448193/attachment.pl>

From rr2box42 at gmail.com  Thu Oct 31 22:01:07 2013
From: rr2box42 at gmail.com (Ry Guy)
Date: Thu, 31 Oct 2013 16:01:07 -0500
Subject: [R-sig-Geo] Projected SpatialLinesDataFrame has a segment spanning
	the globe
Message-ID: <339F016E-2D5F-464C-B47B-60316ADE512B@gmail.com>

Hi All,

I'm trying to use the 'coastsCoarse' dataset from library 'rworldmap' as a base map for plotting a global dataset. It works fine when I use unprojected data. However, if I project the data and base map, coastsCoarse ends up with one horizontal line segment that spans the whole map. You can see what I mean like this:

# ---------------------------------------
library(rgdal)
library(rworldmap)

data(coastsCoarse)
plot(coastsCoarse) # Looks good

mercator.proj4 = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
coastsMerc = spTransform(coastsCoarse, CRS(mercator.proj4))
spplot(coastsMerc) # horizontal line across plot connects east and west Beringia...
# ---------------------------------------


It seems like the boundary of northern Russia didn't get cut off correctly. I imagine the fix is straightforward, but I've been banging away at it to no avail. Does anyone have a simple solution that either (a) locates and removes the offending pan-global segment or (b) doesn't produce it to begin with?

Thanks much,
Ryan

