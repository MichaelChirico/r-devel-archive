From iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de  Mon May  2 18:21:46 2022
From: iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de (iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de)
Date: Mon, 02 May 2022 18:21:46 +0200
Subject: [R-sig-Geo] Polygon Data into Grid Structure
Message-ID: <20220502182146.Horde.dOK3ifqIxwrvNlFfgoDpSWJ@students.webmail.uni-mannheim.de>

Hello everyone,

I have the Aqueduct 3.0 Data from the WRI Institut which is in  
Multipolygon format.

To perform a regression analysis with different datasets I want to  
transform these polygons into a grid.
Basically, I want to overlay a grid over the map and assign each cell  
the value of the underlying polygon.
In a second step, I want to count how many points (different dataset)  
are inside each cell.


I have tried with the sp commands GridTopology, and SpatialPoints. I  
can produce the grid but fail to crop with my map.
Also, it is not clear to me how I can assign the underlying value of  
the polygon.

This is the code I have tried so far:
(I have copied this from doing a Course on DataCamp which I can't  
completely copy exactly because my data is different)

# -25,-49  my lower left corner (these are coordinates)
grid <- GridTopology(c(-25,-49),c(1, 1), c(72, 48))


gridpoints <- SpatialPoints(grid, proj4string = CRS(projection(aqua)))
plot(gridpoints)

cropped_gridpoints <- crop(gridpoints, aqua)
plot(cropped_gridpoints)

spgrid <- SpatialPixels(cropped_gridpoints)
plot(spgrid)


I hope someone has an idea to help me solve this.
Thanks to everyone who has any insights into this

Luca Frank


From giue-09turgid m@iii@g oii icioud@com  Mon May  2 18:43:18 2022
From: giue-09turgid m@iii@g oii icioud@com (giue-09turgid m@iii@g oii icioud@com)
Date: Mon, 2 May 2022 18:43:18 +0200
Subject: [R-sig-Geo] SDM and SDEM models with single aliased feature and lag
Message-ID: <A522AE75-C73C-400F-9E90-69389AEEC966@gmail.com>

Hello everyone, 
I am working with a SDM and SDEM models from the spatialreg package in a geographical pattern containing some islands. While simulating the regressions I encountered aliased variables, but to my surprise it only reported a single feature (and its lag). In previous cases when I encountered aliased variables it always was between a pair of features, as it usually meant that they both had perfect collinearity. I know how to adapt the data to deal with perfect colinearity, but I am not sure on how to proceed if only one feature (and its lag) are reported as aliased? Could it be caused by the "isolated nature" of the dataset (despite working with the zero.policy=TRUE argument)? 

Thanks the help.
Best regards,
Ari

From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  2 20:15:27 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 2 May 2022 20:15:27 +0200 (CEST)
Subject: [R-sig-Geo] 
 SDM and SDEM models with single aliased feature and lag
In-Reply-To: <A522AE75-C73C-400F-9E90-69389AEEC966@gmail.com>
References: <A522AE75-C73C-400F-9E90-69389AEEC966@gmail.com>
Message-ID: <e8cd019-bbbd-50d9-cfb1-2dfe2b79a7e@reclus2.nhh.no>

On Mon, 2 May 2022, Ari via R-sig-Geo wrote:

> Hello everyone,

> I am working with a SDM and SDEM models from the spatialreg package in a 
> geographical pattern containing some islands. While simulating the 
> regressions I encountered aliased variables, but to my surprise it only 
> reported a single feature (and its lag). In previous cases when I 
> encountered aliased variables it always was between a pair of features, 
> as it usually meant that they both had perfect collinearity. I know how 
> to adapt the data to deal with perfect colinearity, but I am not sure on 
> how to proceed if only one feature (and its lag) are reported as 
> aliased? Could it be caused by the "isolated nature" of the dataset 
> (despite working with the zero.policy=TRUE argument)?

Could you please provide reproducible examples of these cases, for example 
using the Boston data set ?spData::boston ? Please also report whether the 
variables are categorical (in R factors), or not. Without a minimal worked 
example, it isn't obvious what the problem might be. By feature, do you 
mean a single geometry/observation, or several observations on one 
subgraph?

Roger

>
> Thanks the help.
> Best regards,
> Ari
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C1ac78a5aa03a4072452808da2c5af02c%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637871066516191175%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=rfyCTdzM517VkdaG39ViNhdbgpSWRqsZD4MBmerZ6TU%3D&amp;reserved=0
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From Roger@B|v@nd @end|ng |rom nhh@no  Mon May  2 20:26:44 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 2 May 2022 20:26:44 +0200 (CEST)
Subject: [R-sig-Geo] Polygon Data into Grid Structure
In-Reply-To: <20220502182146.Horde.dOK3ifqIxwrvNlFfgoDpSWJ@students.webmail.uni-mannheim.de>
References: <20220502182146.Horde.dOK3ifqIxwrvNlFfgoDpSWJ@students.webmail.uni-mannheim.de>
Message-ID: <656af67-21a9-e68f-3158-24c1f1debb13@reclus2.nhh.no>

On Mon, 2 May 2022, lucfrank at mail.uni-mannheim.de wrote:

> Hello everyone,
>
> I have the Aqueduct 3.0 Data from the WRI Institut which is in Multipolygon 
> format.

This is not clear, neither aqueduct nor WRI mean anything to me and 
possibly most others.

>
> To perform a regression analysis with different datasets I want to transform 
> these polygons into a grid.
> Basically, I want to overlay a grid over the map and assign each cell the 
> value of the underlying polygon.
> In a second step, I want to count how many points (different dataset) are 
> inside each cell.
>

So a standard intersection between a raster grid and polygons - but you 
are modifying the support of the data quite brutally. If you need to 
integrate data with varying support, do not treat the estimated values for 
the new entities as fixed, they are estimates with error distributions.

Why not simply count the points within each polygon?

>
> I have tried with the sp commands GridTopology, and SpatialPoints. I can 
> produce the grid but fail to crop with my map.
> Also, it is not clear to me how I can assign the underlying value of the 
> polygon.
>
> This is the code I have tried so far:
> (I have copied this from doing a Course on DataCamp which I can't completely 
> copy exactly because my data is different)

Not a robust idea; build up your analysis from the support of your own 
data based on robust sources.

>
> # -25,-49  my lower left corner (these are coordinates)
> grid <- GridTopology(c(-25,-49),c(1, 1), c(72, 48))
>
>

This looks rather odd, seeming to use geographical coordinates, so the 
areas in the grid cells vary with latitude (as would the counts).

> gridpoints <- SpatialPoints(grid, proj4string = CRS(projection(aqua)))
> plot(gridpoints)
>
> cropped_gridpoints <- crop(gridpoints, aqua)
> plot(cropped_gridpoints)
>

crop is from terra (in older workflows raster), not sp. Perhaps using 
terra for the whole exercise is advisable? Your workflow template doesn't 
seem to be current, or even adequate, I'm afraid.

Roger

> spgrid <- SpatialPixels(cropped_gridpoints)
> plot(spgrid)
>
>
> I hope someone has an idea to help me solve this.
> Thanks to everyone who has any insights into this
>
> Luca Frank
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://eur02.safelinks.protection.outlook.com/?url=https%3A%2F%2Fstat.ethz.ch%2Fmailman%2Flistinfo%2Fr-sig-geo&amp;data=05%7C01%7CRoger.Bivand%40nhh.no%7C14ec72decd7e4b5697e508da2c5804a2%7C33a15b2f849941998d56f20b5aa91af2%7C0%7C0%7C637871053949019828%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=E5%2BzJh28dpHvmZxA0Ui9M7bL3dBFEcketbVX42AdswI%3D&amp;reserved=0
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From md@umner @end|ng |rom gm@||@com  Tue May  3 11:48:48 2022
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Tue, 3 May 2022 19:48:48 +1000
Subject: [R-sig-Geo] Polygon Data into Grid Structure
In-Reply-To: <20220502182146.Horde.dOK3ifqIxwrvNlFfgoDpSWJ@students.webmail.uni-mannheim.de>
References: <20220502182146.Horde.dOK3ifqIxwrvNlFfgoDpSWJ@students.webmail.uni-mannheim.de>
Message-ID: <CAAcGz988LEsMF5+L5bNRLvApciMqt6M2WRu0CEY+NZaZze9uYw@mail.gmail.com>

On Tue, May 3, 2022 at 2:22 AM <lucfrank at mail.uni-mannheim.de> wrote:

> Hello everyone,
>
> I have the Aqueduct 3.0 Data from the WRI Institut which is in
> Multipolygon format.
>
> To perform a regression analysis with different datasets I want to
> transform these polygons into a grid.
> Basically, I want to overlay a grid over the map and assign each cell
> the value of the underlying polygon.
>

try

library(terra)
p <- vect(<yourpolyfile>)
r <- rasterize(p, rast(<your-raster-file>), field = seq_along(p))

In a second step, I want to count how many points (different dataset)
> are inside each cell.
>
>
I'd use terra, and terra::cells(grid, vect(points))

where 'grid' is from

rast(<your-raster-file>)

and points is cbind(x, y) just your points. If grid and points are in
different projections you'll need to declare that for the points in vect( ,
crs  = ) unless you read it from a source with that info.

You get the cell id of the raster, which you can store alongside the x-y
values and summarize from there.

Best, Mike


>
> I have tried with the sp commands GridTopology, and SpatialPoints. I
> can produce the grid but fail to crop with my map.
> Also, it is not clear to me how I can assign the underlying value of
> the polygon.
>
> This is the code I have tried so far:
> (I have copied this from doing a Course on DataCamp which I can't
> completely copy exactly because my data is different)
>
> # -25,-49  my lower left corner (these are coordinates)
> grid <- GridTopology(c(-25,-49),c(1, 1), c(72, 48))
>
>
> gridpoints <- SpatialPoints(grid, proj4string = CRS(projection(aqua)))
> plot(gridpoints)
>
> cropped_gridpoints <- crop(gridpoints, aqua)
> plot(cropped_gridpoints)
>
> spgrid <- SpatialPixels(cropped_gridpoints)
> plot(spgrid)
>
>
> I hope someone has an idea to help me solve this.
> Thanks to everyone who has any insights into this
>
> Luca Frank
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From r@b|@h@h@h@d @end|ng |rom gm@||@com  Mon May  9 04:36:31 2022
From: r@b|@h@h@h@d @end|ng |rom gm@||@com (R A B I A)
Date: Mon, 9 May 2022 10:36:31 +0800
Subject: [R-sig-Geo] R code for rainfall isohyet map
Message-ID: <F3A23289-5590-49E5-A50B-E53228DABB06@hxcore.ol>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220509/28672b36/attachment.html>

From d|ego@hern@ngomezherrero @end|ng |rom gm@||@com  Mon May  9 21:21:41 2022
From: d|ego@hern@ngomezherrero @end|ng |rom gm@||@com (=?UTF-8?Q?Diego_Hernang=C3=B3mez_Herrero?=)
Date: Mon, 9 May 2022 21:21:41 +0200
Subject: [R-sig-Geo] Beta testers on new package: tidyterra
Message-ID: <CAA-ibazRN90fcLGN4MfL6gu0jw7zz7hnRqiZ021L78mePKC2Qw@mail.gmail.com>

Dear list:

In first place, my apologies if this is not the right channel for this
request.

I am working on a new package named tidyterra, that creates dplyr and tidyr
methods for terra::SpatRaster and terra::SpatVector objects. It also
provides ggplot2::geom_ for that objects, leveraging on the work already
done in ggspatial with a few improvements.

I have worked a bit with rasters in the past, but I am not an intensive
user. So I would appreciate if anyone that uses rasters frequent could
provide feedback on a real working environment. The goal is to release it
on CRAN at some point.

The package is on GitHub, see installation instructions there:
https://github.com/dieghernan/tidyterra

Many thanks and apologies again if this was not the intended purpose of
this list, regards
-- 



Have a nice day!

	[[alternative HTML version deleted]]


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Tue May 10 06:22:38 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Tue, 10 May 2022 09:52:38 +0530
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
Message-ID: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>

Hello Everyone,

I am trying to plot an Indian district shapefile filled with modeled yield,
corresponding to each GDMID. I needed to first merge the Yield data with
respect to each GDMID from the .RDS file with the district shapefile of
India. Each district is represented by a GDMID. After merging, the Indian
district map filled with modeled yield values needs to be plotted similar
to an example attached figure. Shape file has five features, and one of
them is "GDMID".

I feel there is something wrong with my code for merging and plotting by
ggplot.

I have attached herewith my code, and RDS data-frame.

It would be great if you could help me with merging issue and plotting the
map, showing yield value with legend in tile format.

Regards and Thanks,
Ranjeet

-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220510/b300a142/attachment.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: dist_yield.RDS
Type: application/octet-stream
Size: 7523 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220510/b300a142/attachment.obj>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Yield _map.R
Type: application/octet-stream
Size: 2124 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220510/b300a142/attachment-0001.obj>

From Roger@B|v@nd @end|ng |rom nhh@no  Tue May 10 10:04:25 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Tue, 10 May 2022 10:04:25 +0200 (CEST)
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
Message-ID: <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>

On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:

> Hello Everyone,
>
> I am trying to plot an Indian district shapefile filled with modeled yield,
> corresponding to each GDMID. I needed to first merge the Yield data with
> respect to each GDMID from the .RDS file with the district shapefile of
> India. Each district is represented by a GDMID. After merging, the Indian
> district map filled with modeled yield values needs to be plotted similar
> to an example attached figure. Shape file has five features, and one of
> them is "GDMID".

The code is not a reproducible example; it needs to run with no reference 
to local directories. The use of tibbles or other misunderstandings 
represents state.ID and GDMID as numeric, they should be character, you 
cannot do arithmetic on them. The level 2 boundaries from 
https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not use 
GDMID, so unless you provide a download link to your boundaries, no-one 
can help. Also, your data.frame has 694 observations, GADM has 666.

My guess is that you have found a blog somewhere, probably very 
out-of-date (you use rgdal::readOGR() not sf::st_read()), and which is 
causing lots of problems, because it complicates things.

Use the sf package, avoid tidyverse which can convert representations 
without asking, make sure that the IDs are character not numeric (to 
preserve any leading zeros), and use tmap or mapsf not ggplot (much 
simpler and more intuitive interface for mapping).

See https://geocompr.robinlovelace.net/ and the sf vignettes. Once you 
have control of the IDs (for example try match() to see if they do match 
in type and value). sf has a merge method, which gives a good deal of 
control.

Hope this helps,

Roger

>
> I feel there is something wrong with my code for merging and plotting by
> ggplot.
>
> I have attached herewith my code, and RDS data-frame.
>
> It would be great if you could help me with merging issue and plotting the
> map, showing yield value with legend in tile format.
>
> Regards and Thanks,
> Ranjeet
>
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Tue May 10 11:24:42 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Tue, 10 May 2022 14:54:42 +0530
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
Message-ID: <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>

Hello Roger,

Thanks for your kind reply! I am going through this. However, sharing the
link of code, shape file and .rds data frame for better understanding and
helping through the real files.

https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c

Regards and Thanks,
Ranjeet

On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>
> > Hello Everyone,
> >
> > I am trying to plot an Indian district shapefile filled with modeled
> yield,
> > corresponding to each GDMID. I needed to first merge the Yield data with
> > respect to each GDMID from the .RDS file with the district shapefile of
> > India. Each district is represented by a GDMID. After merging, the Indian
> > district map filled with modeled yield values needs to be plotted similar
> > to an example attached figure. Shape file has five features, and one of
> > them is "GDMID".
>
> The code is not a reproducible example; it needs to run with no reference
> to local directories. The use of tibbles or other misunderstandings
> represents state.ID and GDMID as numeric, they should be character, you
> cannot do arithmetic on them. The level 2 boundaries from
> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not use
> GDMID, so unless you provide a download link to your boundaries, no-one
> can help. Also, your data.frame has 694 observations, GADM has 666.
>
> My guess is that you have found a blog somewhere, probably very
> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which is
> causing lots of problems, because it complicates things.
>
> Use the sf package, avoid tidyverse which can convert representations
> without asking, make sure that the IDs are character not numeric (to
> preserve any leading zeros), and use tmap or mapsf not ggplot (much
> simpler and more intuitive interface for mapping).
>
> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once you
> have control of the IDs (for example try match() to see if they do match
> in type and value). sf has a merge method, which gives a good deal of
> control.
>
> Hope this helps,
>
> Roger
>
> >
> > I feel there is something wrong with my code for merging and plotting by
> > ggplot.
> >
> > I have attached herewith my code, and RDS data-frame.
> >
> > It would be great if you could help me with merging issue and plotting
> the
> > map, showing yield value with legend in tile format.
> >
> > Regards and Thanks,
> > Ranjeet
> >
> >
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>


-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de  Wed May 11 18:08:18 2022
From: iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de (iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de)
Date: Wed, 11 May 2022 18:08:18 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
Message-ID: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>

Hello Everyone,

I have a shapefile with district borders and a raster data file (.tif).

How can I extract the value from the raster data onto each district in  
the shapefile?

I have the exact thing I want with two shapefiles with the command:

x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)

This gives me the result I want. I tried to convert the .tif file to a  
shapefile, but this didn't work for me with multiple different  
solutions I found online.

I would appreciate any ideas you might have.

Luca


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Wed May 11 18:18:45 2022
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Wed, 11 May 2022 18:18:45 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
Message-ID: <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>

Hi Luca,
You should perhaps have a look at the crop and mask function in the raster
or terra package.
Hope this helps!
Zivan

On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de> wrote:

> Hello Everyone,
>
> I have a shapefile with district borders and a raster data file (.tif).
>
> How can I extract the value from the raster data onto each district in
> the shapefile?
>
> I have the exact thing I want with two shapefiles with the command:
>
> x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
>
> This gives me the result I want. I tried to convert the .tif file to a
> shapefile, but this didn't work for me with multiple different
> solutions I found online.
>
> I would appreciate any ideas you might have.
>
> Luca
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger@B|v@nd @end|ng |rom nhh@no  Wed May 11 18:42:03 2022
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Wed, 11 May 2022 18:42:03 +0200 (CEST)
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
Message-ID: <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>

On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:

> Hello Roger,
>
> Thanks for your kind reply! I am going through this. However, sharing the
> link of code, shape file and .rds data frame for better understanding and
> helping through the real files.

District_sim.shp must of course be accompanied by District_sim.shx, 
District_sim.dbf and most likely District_sim.prj, which are absent.

Roger

>
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>
> Regards and Thanks,
> Ranjeet
>
> On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>
>>> Hello Everyone,
>>>
>>> I am trying to plot an Indian district shapefile filled with modeled
>> yield,
>>> corresponding to each GDMID. I needed to first merge the Yield data with
>>> respect to each GDMID from the .RDS file with the district shapefile of
>>> India. Each district is represented by a GDMID. After merging, the Indian
>>> district map filled with modeled yield values needs to be plotted similar
>>> to an example attached figure. Shape file has five features, and one of
>>> them is "GDMID".
>>
>> The code is not a reproducible example; it needs to run with no reference
>> to local directories. The use of tibbles or other misunderstandings
>> represents state.ID and GDMID as numeric, they should be character, you
>> cannot do arithmetic on them. The level 2 boundaries from
>> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not use
>> GDMID, so unless you provide a download link to your boundaries, no-one
>> can help. Also, your data.frame has 694 observations, GADM has 666.
>>
>> My guess is that you have found a blog somewhere, probably very
>> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which is
>> causing lots of problems, because it complicates things.
>>
>> Use the sf package, avoid tidyverse which can convert representations
>> without asking, make sure that the IDs are character not numeric (to
>> preserve any leading zeros), and use tmap or mapsf not ggplot (much
>> simpler and more intuitive interface for mapping).
>>
>> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once you
>> have control of the IDs (for example try match() to see if they do match
>> in type and value). sf has a merge method, which gives a good deal of
>> control.
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> I feel there is something wrong with my code for merging and plotting by
>>> ggplot.
>>>
>>> I have attached herewith my code, and RDS data-frame.
>>>
>>> It would be great if you could help me with merging issue and plotting
>> the
>>> map, showing yield value with legend in tile format.
>>>
>>> Regards and Thanks,
>>> Ranjeet
>>>
>>>
>>
>> --
>> Roger Bivand
>> Emeritus Professor
>> Department of Economics, Norwegian School of Economics,
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> e-mail: Roger.Bivand at nhh.no
>> https://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>
>
>
>

-- 
Roger Bivand
Emeritus Professor
Department of Economics, Norwegian School of Economics,
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
e-mail: Roger.Bivand at nhh.no
https://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en


From ju||enrodr|guez@@rd@@pm @end|ng |rom gm@||@com  Wed May 11 19:52:28 2022
From: ju||enrodr|guez@@rd@@pm @end|ng |rom gm@||@com (Julien Rodriguez)
Date: Wed, 11 May 2022 19:52:28 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
 <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
Message-ID: <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>

Hi Luca and Zivan,


Maybe this toy example using terra and sf (probably the class of your
district borders object) may help.

library(terra)
library(sf)

# Create a SpatRaster
r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
values(r) <- 1:25

# Create a polygon object as sf
p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
myPol <- st_sf(code = c(1:2), geometry = st_sfc(list(st_polygon(list(p1)),
st_polygon(list(p2)))))

# Polygon object as SpatVector
myPolAsSpatVect <- vect(st_geometry(myPol))

plot(r)
plot(myPolAsSpatVect, add = TRUE)

# Here is your extraction, using fun argument, you can decide how to
aggregate the values by district border
terra::extract(r, myPolAsSpatVect, fun = mean)

Regards

Julien




Le mer. 11 mai 2022 ? 18:19, Zivan Karaman <zivan.karaman at gmail.com> a
?crit :

> Hi Luca,
> You should perhaps have a look at the crop and mask function in the raster
> or terra package.
> Hope this helps!
> Zivan
>
> On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de> wrote:
>
> > Hello Everyone,
> >
> > I have a shapefile with district borders and a raster data file (.tif).
> >
> > How can I extract the value from the raster data onto each district in
> > the shapefile?
> >
> > I have the exact thing I want with two shapefiles with the command:
> >
> > x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
> >
> > This gives me the result I want. I tried to convert the .tif file to a
> > shapefile, but this didn't work for me with multiple different
> > solutions I found online.
> >
> > I would appreciate any ideas you might have.
> >
> > Luca
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From g||berto@c@m@r@@|npe @end|ng |rom gm@||@com  Wed May 11 21:58:51 2022
From: g||berto@c@m@r@@|npe @end|ng |rom gm@||@com (GilbertoCamara)
Date: Wed, 11 May 2022 16:58:51 -0300
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
 <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
 <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>
Message-ID: <988422EF-9EDC-4880-B0EB-F092B75FA8F8@inpe.br>

Dear Julian, 

Your script works nicely if the raster data if well-behaved. In real life, raster data can have missing values, which have to be dealt with.

Best
Gilberto
============================
Prof Dr Gilberto Camara
Senior Researcher
National Institute for Space Research (INPE), Brazil
https://gilbertocamara.org/
=============================




> On 11 May 2022, at 14:52, Julien Rodriguez <julienrodriguez.ardaspm at gmail.com> wrote:
> 
> Hi Luca and Zivan,
> 
> 
> Maybe this toy example using terra and sf (probably the class of your
> district borders object) may help.
> 
> library(terra)
> library(sf)
> 
> # Create a SpatRaster
> r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
> values(r) <- 1:25
> 
> # Create a polygon object as sf
> p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
> p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
> myPol <- st_sf(code = c(1:2), geometry = st_sfc(list(st_polygon(list(p1)),
> st_polygon(list(p2)))))
> 
> # Polygon object as SpatVector
> myPolAsSpatVect <- vect(st_geometry(myPol))
> 
> plot(r)
> plot(myPolAsSpatVect, add = TRUE)
> 
> # Here is your extraction, using fun argument, you can decide how to
> aggregate the values by district border
> terra::extract(r, myPolAsSpatVect, fun = mean)
> 
> Regards
> 
> Julien
> 
> 
> 
> 
> Le mer. 11 mai 2022 ? 18:19, Zivan Karaman <zivan.karaman at gmail.com> a
> ?crit :
> 
>> Hi Luca,
>> You should perhaps have a look at the crop and mask function in the raster
>> or terra package.
>> Hope this helps!
>> Zivan
>> 
>> On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de> wrote:
>> 
>>> Hello Everyone,
>>> 
>>> I have a shapefile with district borders and a raster data file (.tif).
>>> 
>>> How can I extract the value from the raster data onto each district in
>>> the shapefile?
>>> 
>>> I have the exact thing I want with two shapefiles with the command:
>>> 
>>> x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
>>> 
>>> This gives me the result I want. I tried to convert the .tif file to a
>>> shapefile, but this didn't work for me with multiple different
>>> solutions I found online.
>>> 
>>> I would appreciate any ideas you might have.
>>> 
>>> Luca
>>> 
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> 
>> 
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From j|n||68 @end|ng |rom gm@||@com  Thu May 12 06:03:22 2022
From: j|n||68 @end|ng |rom gm@||@com (Jin Li)
Date: Thu, 12 May 2022 14:03:22 +1000
Subject: [R-sig-Geo] For gbm users
Message-ID: <CAGu_3ZJH0axOGJYNaLzc4Hxjf8XggOgxht=40+ocLoXVBXcFgw@mail.gmail.com>

Hi all,

The package `spm` has been updated last week, with a bug fixed for the
function `gbmcv` that can now be used for 0/1 data. Consequently, the
functions such as `stepgbm` in the package `stepgbm` can also be used for
1/0 data.

Please let me know if you have any questions.

Best regards,
-- 
Jin
------------------------------------------
Jin Li, PhD
Founder, Data2action, Australia
https://www.researchgate.net/profile/Jin_Li32
https://scholar.google.com/citations?user=Jeot53EAAAAJ&hl=en

	[[alternative HTML version deleted]]


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Thu May 12 09:02:31 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Thu, 12 May 2022 08:02:31 +0100
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
Message-ID: <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>

Hello Roger,

I really appreciate your support and help! Now I have uploaded all the
required .shx, .dbf, and .prj files in the link folder.

https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c

On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>
> > Hello Roger,
> >
> > Thanks for your kind reply! I am going through this. However, sharing the
> > link of code, shape file and .rds data frame for better understanding and
> > helping through the real files.
>
> District_sim.shp must of course be accompanied by District_sim.shx,
> District_sim.dbf and most likely District_sim.prj, which are absent.
>
> Roger
>
> >
> >
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
> >
> > Regards and Thanks,
> > Ranjeet
> >
> > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >
> >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
> >>
> >>> Hello Everyone,
> >>>
> >>> I am trying to plot an Indian district shapefile filled with modeled
> >> yield,
> >>> corresponding to each GDMID. I needed to first merge the Yield data
> with
> >>> respect to each GDMID from the .RDS file with the district shapefile of
> >>> India. Each district is represented by a GDMID. After merging, the
> Indian
> >>> district map filled with modeled yield values needs to be plotted
> similar
> >>> to an example attached figure. Shape file has five features, and one of
> >>> them is "GDMID".
> >>
> >> The code is not a reproducible example; it needs to run with no
> reference
> >> to local directories. The use of tibbles or other misunderstandings
> >> represents state.ID and GDMID as numeric, they should be character, you
> >> cannot do arithmetic on them. The level 2 boundaries from
> >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not
> use
> >> GDMID, so unless you provide a download link to your boundaries, no-one
> >> can help. Also, your data.frame has 694 observations, GADM has 666.
> >>
> >> My guess is that you have found a blog somewhere, probably very
> >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which is
> >> causing lots of problems, because it complicates things.
> >>
> >> Use the sf package, avoid tidyverse which can convert representations
> >> without asking, make sure that the IDs are character not numeric (to
> >> preserve any leading zeros), and use tmap or mapsf not ggplot (much
> >> simpler and more intuitive interface for mapping).
> >>
> >> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once you
> >> have control of the IDs (for example try match() to see if they do match
> >> in type and value). sf has a merge method, which gives a good deal of
> >> control.
> >>
> >> Hope this helps,
> >>
> >> Roger
> >>
> >>>
> >>> I feel there is something wrong with my code for merging and plotting
> by
> >>> ggplot.
> >>>
> >>> I have attached herewith my code, and RDS data-frame.
> >>>
> >>> It would be great if you could help me with merging issue and plotting
> >> the
> >>> map, showing yield value with legend in tile format.
> >>>
> >>> Regards and Thanks,
> >>> Ranjeet
> >>>
> >>>
> >>
> >> --
> >> Roger Bivand
> >> Emeritus Professor
> >> Department of Economics, Norwegian School of Economics,
> >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> >> e-mail: Roger.Bivand at nhh.no
> >> https://orcid.org/0000-0003-2392-6140
> >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>
> >
> >
> >
>
> --
> Roger Bivand
> Emeritus Professor
> Department of Economics, Norwegian School of Economics,
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> e-mail: Roger.Bivand at nhh.no
> https://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>


-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From ju||enrodr|guez@@rd@@pm @end|ng |rom gm@||@com  Thu May 12 11:03:08 2022
From: ju||enrodr|guez@@rd@@pm @end|ng |rom gm@||@com (Julien Rodriguez)
Date: Thu, 12 May 2022 11:03:08 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <CAO=dqtKfK0m5P9TM3X2HRbSjxFuw8+DW+S7NhXW2hLy_U5ODyw@mail.gmail.com>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
 <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
 <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>
 <988422EF-9EDC-4880-B0EB-F092B75FA8F8@inpe.br>
 <CAO=dqtKfK0m5P9TM3X2HRbSjxFuw8+DW+S7NhXW2hLy_U5ODyw@mail.gmail.com>
Message-ID: <CACEJfCqouBBSt6L=vktdXqQWvdqiUsKADYUTtwa3AgPx-T5CSg@mail.gmail.com>

Thanks: it is true that handling missing values when extracting from a
raster can sometimes be perilous.

Same example with missing values and playing with terra::extract arguments
to take the best decision about them.

library(terra)
library(sf)

# Create a SpatRaster
r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
val <- 1:25
# add randomly selected NAs
set.seed(220512)
val[sample(1:25,4)] <- NA

values(r) <- val

# Create a polygon object as sf
p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
p3 <- rbind(c(1.6, 1.6), c(3, 1.6), c(3, 3), c(1.6, 3), c(1.6, 1.6))
myPol <- st_sf(code = c(1:3), geometry = st_sfc(list(st_polygon(list(p1)),
st_polygon(list(p2)), st_polygon(list(p3)))))

# Polygon object as SpatVector
myPolAsSpatVect <- vect(st_geometry(myPol))

plot(r)
plot(myPolAsSpatVect, add = TRUE)

# Here is your extraction, using fun argument, you can decide how to
aggregate the values by district border
terra::extract(r, myPolAsSpatVect, fun = mean)
terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE)
# By default, the extraction will concern pixels whose center point is
within the polygon
terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, touches = TRUE)
terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, exact = TRUE)

# without aggregation
terra::extract(r, myPolAsSpatVect)
terra::extract(r, myPolAsSpatVect, exact = TRUE)
terra::extract(r, myPolAsSpatVect, touches = TRUE)

Regards



Le jeu. 12 mai 2022 ? 09:29, Jordan Chamberlin <jordan.chamberlin at gmail.com>
a ?crit :

> One way to deal with NAs is simply to add an argument to terra::extract:
> na.rm=TRUE
>
>
>
> On Wed, May 11, 2022 at 9:59 PM GilbertoCamara <
> gilberto.camara.inpe at gmail.com> wrote:
>
>> Dear Julian,
>>
>> Your script works nicely if the raster data if well-behaved. In real
>> life, raster data can have missing values, which have to be dealt with.
>>
>> Best
>> Gilberto
>> ============================
>> Prof Dr Gilberto Camara
>> Senior Researcher
>> National Institute for Space Research (INPE), Brazil
>>
>> https://urldefense.com/v3/__https://gilbertocamara.org/__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel5LZQAkw$
>> =============================
>>
>>
>>
>>
>> > On 11 May 2022, at 14:52, Julien Rodriguez <
>> julienrodriguez.ardaspm at gmail.com> wrote:
>> >
>> > Hi Luca and Zivan,
>> >
>> >
>> > Maybe this toy example using terra and sf (probably the class of your
>> > district borders object) may help.
>> >
>> > library(terra)
>> > library(sf)
>> >
>> > # Create a SpatRaster
>> > r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
>> > values(r) <- 1:25
>> >
>> > # Create a polygon object as sf
>> > p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
>> > p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
>> > myPol <- st_sf(code = c(1:2), geometry =
>> st_sfc(list(st_polygon(list(p1)),
>> > st_polygon(list(p2)))))
>> >
>> > # Polygon object as SpatVector
>> > myPolAsSpatVect <- vect(st_geometry(myPol))
>> >
>> > plot(r)
>> > plot(myPolAsSpatVect, add = TRUE)
>> >
>> > # Here is your extraction, using fun argument, you can decide how to
>> > aggregate the values by district border
>> > terra::extract(r, myPolAsSpatVect, fun = mean)
>> >
>> > Regards
>> >
>> > Julien
>> >
>> >
>> >
>> >
>> > Le mer. 11 mai 2022 ? 18:19, Zivan Karaman <zivan.karaman at gmail.com> a
>> > ?crit :
>> >
>> >> Hi Luca,
>> >> You should perhaps have a look at the crop and mask function in the
>> raster
>> >> or terra package.
>> >> Hope this helps!
>> >> Zivan
>> >>
>> >> On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de> wrote:
>> >>
>> >>> Hello Everyone,
>> >>>
>> >>> I have a shapefile with district borders and a raster data file
>> (.tif).
>> >>>
>> >>> How can I extract the value from the raster data onto each district in
>> >>> the shapefile?
>> >>>
>> >>> I have the exact thing I want with two shapefiles with the command:
>> >>>
>> >>> x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
>> >>>
>> >>> This gives me the result I want. I tried to convert the .tif file to a
>> >>> shapefile, but this didn't work for me with multiple different
>> >>> solutions I found online.
>> >>>
>> >>> I would appreciate any ideas you might have.
>> >>>
>> >>> Luca
>> >>>
>> >>> _______________________________________________
>> >>> R-sig-Geo mailing list
>> >>> R-sig-Geo at r-project.org
>> >>>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>> >>>
>> >>
>> >>        [[alternative HTML version deleted]]
>> >>
>> >> _______________________________________________
>> >> R-sig-Geo mailing list
>> >> R-sig-Geo at r-project.org
>> >>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>> >>
>> >
>> >       [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> >
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>>
>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>
>

	[[alternative HTML version deleted]]


From iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de  Thu May 12 11:43:04 2022
From: iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de (iucir@@k m@iii@g oii m@ii@u@i-m@@@heim@de)
Date: Thu, 12 May 2022 11:43:04 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <CACEJfCqouBBSt6L=vktdXqQWvdqiUsKADYUTtwa3AgPx-T5CSg@mail.gmail.com>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
 <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
 <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>
 <988422EF-9EDC-4880-B0EB-F092B75FA8F8@inpe.br>
 <CAO=dqtKfK0m5P9TM3X2HRbSjxFuw8+DW+S7NhXW2hLy_U5ODyw@mail.gmail.com>
 <CACEJfCqouBBSt6L=vktdXqQWvdqiUsKADYUTtwa3AgPx-T5CSg@mail.gmail.com>
Message-ID: <20220512114304.Horde._74Jk9LKQUSEHVb0tlyPKc-@students.webmail.uni-mannheim.de>

Thanks for all the helpful input.
I have used terra::extract, and it worked.

I have included: touches = TRUE,na.rm = TRUE, to eliminate all NAs.

I was wondering what na.rm does here?
I know it from dplyr functions, but how can I imagine here how it works?



Zitat von Julien Rodriguez <julienrodriguez.ardaspm at gmail.com>:

> Thanks: it is true that handling missing values when extracting from a
> raster can sometimes be perilous.
>
> Same example with missing values and playing with terra::extract arguments
> to take the best decision about them.
>
> library(terra)
> library(sf)
>
> # Create a SpatRaster
> r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
> val <- 1:25
> # add randomly selected NAs
> set.seed(220512)
> val[sample(1:25,4)] <- NA
>
> values(r) <- val
>
> # Create a polygon object as sf
> p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
> p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
> p3 <- rbind(c(1.6, 1.6), c(3, 1.6), c(3, 3), c(1.6, 3), c(1.6, 1.6))
> myPol <- st_sf(code = c(1:3), geometry = st_sfc(list(st_polygon(list(p1)),
> st_polygon(list(p2)), st_polygon(list(p3)))))
>
> # Polygon object as SpatVector
> myPolAsSpatVect <- vect(st_geometry(myPol))
>
> plot(r)
> plot(myPolAsSpatVect, add = TRUE)
>
> # Here is your extraction, using fun argument, you can decide how to
> aggregate the values by district border
> terra::extract(r, myPolAsSpatVect, fun = mean)
> terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE)
> # By default, the extraction will concern pixels whose center point is
> within the polygon
> terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, touches = TRUE)
> terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, exact = TRUE)
>
> # without aggregation
> terra::extract(r, myPolAsSpatVect)
> terra::extract(r, myPolAsSpatVect, exact = TRUE)
> terra::extract(r, myPolAsSpatVect, touches = TRUE)
>
> Regards
>
>
>
> Le jeu. 12 mai 2022 ? 09:29, Jordan Chamberlin <jordan.chamberlin at gmail.com>
> a ?crit :
>
>> One way to deal with NAs is simply to add an argument to terra::extract:
>> na.rm=TRUE
>>
>>
>>
>> On Wed, May 11, 2022 at 9:59 PM GilbertoCamara <
>> gilberto.camara.inpe at gmail.com> wrote:
>>
>>> Dear Julian,
>>>
>>> Your script works nicely if the raster data if well-behaved. In real
>>> life, raster data can have missing values, which have to be dealt with.
>>>
>>> Best
>>> Gilberto
>>> ============================
>>> Prof Dr Gilberto Camara
>>> Senior Researcher
>>> National Institute for Space Research (INPE), Brazil
>>>
>>> https://urldefense.com/v3/__https://gilbertocamara.org/__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel5LZQAkw$
>>> =============================
>>>
>>>
>>>
>>>
>>> > On 11 May 2022, at 14:52, Julien Rodriguez <
>>> julienrodriguez.ardaspm at gmail.com> wrote:
>>> >
>>> > Hi Luca and Zivan,
>>> >
>>> >
>>> > Maybe this toy example using terra and sf (probably the class of your
>>> > district borders object) may help.
>>> >
>>> > library(terra)
>>> > library(sf)
>>> >
>>> > # Create a SpatRaster
>>> > r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
>>> > values(r) <- 1:25
>>> >
>>> > # Create a polygon object as sf
>>> > p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
>>> > p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
>>> > myPol <- st_sf(code = c(1:2), geometry =
>>> st_sfc(list(st_polygon(list(p1)),
>>> > st_polygon(list(p2)))))
>>> >
>>> > # Polygon object as SpatVector
>>> > myPolAsSpatVect <- vect(st_geometry(myPol))
>>> >
>>> > plot(r)
>>> > plot(myPolAsSpatVect, add = TRUE)
>>> >
>>> > # Here is your extraction, using fun argument, you can decide how to
>>> > aggregate the values by district border
>>> > terra::extract(r, myPolAsSpatVect, fun = mean)
>>> >
>>> > Regards
>>> >
>>> > Julien
>>> >
>>> >
>>> >
>>> >
>>> > Le mer. 11 mai 2022 ? 18:19, Zivan Karaman <zivan.karaman at gmail.com> a
>>> > ?crit :
>>> >
>>> >> Hi Luca,
>>> >> You should perhaps have a look at the crop and mask function in the
>>> raster
>>> >> or terra package.
>>> >> Hope this helps!
>>> >> Zivan
>>> >>
>>> >> On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de> wrote:
>>> >>
>>> >>> Hello Everyone,
>>> >>>
>>> >>> I have a shapefile with district borders and a raster data file
>>> (.tif).
>>> >>>
>>> >>> How can I extract the value from the raster data onto each district in
>>> >>> the shapefile?
>>> >>>
>>> >>> I have the exact thing I want with two shapefiles with the command:
>>> >>>
>>> >>> x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
>>> >>>
>>> >>> This gives me the result I want. I tried to convert the .tif file to a
>>> >>> shapefile, but this didn't work for me with multiple different
>>> >>> solutions I found online.
>>> >>>
>>> >>> I would appreciate any ideas you might have.
>>> >>>
>>> >>> Luca
>>> >>>
>>> >>> _______________________________________________
>>> >>> R-sig-Geo mailing list
>>> >>> R-sig-Geo at r-project.org
>>> >>>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>> >>>
>>> >>
>>> >>        [[alternative HTML version deleted]]
>>> >>
>>> >> _______________________________________________
>>> >> R-sig-Geo mailing list
>>> >> R-sig-Geo at r-project.org
>>> >>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>> >>
>>> >
>>> >       [[alternative HTML version deleted]]
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> >
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>>
>>> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
>>>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo



-- 
Luca Frank
Matrikelnr: 1698155
4.FS Politikwissenschaft


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Thu May 12 12:03:29 2022
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Thu, 12 May 2022 12:03:29 +0200
Subject: [R-sig-Geo] Extract Raster Data Values to Shapefile
In-Reply-To: <20220512114304.Horde._74Jk9LKQUSEHVb0tlyPKc-@students.webmail.uni-mannheim.de>
References: <20220511180818.Horde.4AQznYCQbg1WFaCTdnmk2Gd@students.webmail.uni-mannheim.de>
 <CAKtE6yN9Cc0=24F+7JV6hrmemhdcbs+R0MAoghNa4LB2Wmd2gw@mail.gmail.com>
 <CACEJfCrS-L8Vxto_zrbZwyeiKEFt+ZJGqqmv6Kh0oC+owaJjVA@mail.gmail.com>
 <988422EF-9EDC-4880-B0EB-F092B75FA8F8@inpe.br>
 <CAO=dqtKfK0m5P9TM3X2HRbSjxFuw8+DW+S7NhXW2hLy_U5ODyw@mail.gmail.com>
 <CACEJfCqouBBSt6L=vktdXqQWvdqiUsKADYUTtwa3AgPx-T5CSg@mail.gmail.com>
 <20220512114304.Horde._74Jk9LKQUSEHVb0tlyPKc-@students.webmail.uni-mannheim.de>
Message-ID: <CAKtE6yPQar4xfM=4U+CK=5jeO6oCh=KNtTAvHPzL_gBigBGLkA@mail.gmail.com>

Hi,

The na.rm = TRUE excludes any missing values BEFORE applying the aggregate
function (like mean, min, max, etc.). Without it, the missing values
propagate, i.e., the aggregate function returns NA if any missing value in
present.
Hope this clarifies.

Kind regards,
Zivan


On Thu, May 12, 2022 at 11:43 AM <lucfrank at mail.uni-mannheim.de> wrote:

> Thanks for all the helpful input.
> I have used terra::extract, and it worked.
>
> I have included: touches = TRUE,na.rm = TRUE, to eliminate all NAs.
>
> I was wondering what na.rm does here?
> I know it from dplyr functions, but how can I imagine here how it works?
>
>
>
> Zitat von Julien Rodriguez <julienrodriguez.ardaspm at gmail.com>:
>
> > Thanks: it is true that handling missing values when extracting from a
> > raster can sometimes be perilous.
> >
> > Same example with missing values and playing with terra::extract
> arguments
> > to take the best decision about them.
> >
> > library(terra)
> > library(sf)
> >
> > # Create a SpatRaster
> > r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
> > val <- 1:25
> > # add randomly selected NAs
> > set.seed(220512)
> > val[sample(1:25,4)] <- NA
> >
> > values(r) <- val
> >
> > # Create a polygon object as sf
> > p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
> > p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
> > p3 <- rbind(c(1.6, 1.6), c(3, 1.6), c(3, 3), c(1.6, 3), c(1.6, 1.6))
> > myPol <- st_sf(code = c(1:3), geometry =
> st_sfc(list(st_polygon(list(p1)),
> > st_polygon(list(p2)), st_polygon(list(p3)))))
> >
> > # Polygon object as SpatVector
> > myPolAsSpatVect <- vect(st_geometry(myPol))
> >
> > plot(r)
> > plot(myPolAsSpatVect, add = TRUE)
> >
> > # Here is your extraction, using fun argument, you can decide how to
> > aggregate the values by district border
> > terra::extract(r, myPolAsSpatVect, fun = mean)
> > terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE)
> > # By default, the extraction will concern pixels whose center point is
> > within the polygon
> > terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, touches =
> TRUE)
> > terra::extract(r, myPolAsSpatVect, fun = mean, na.rm = TRUE, exact =
> TRUE)
> >
> > # without aggregation
> > terra::extract(r, myPolAsSpatVect)
> > terra::extract(r, myPolAsSpatVect, exact = TRUE)
> > terra::extract(r, myPolAsSpatVect, touches = TRUE)
> >
> > Regards
> >
> >
> >
> > Le jeu. 12 mai 2022 ? 09:29, Jordan Chamberlin <
> jordan.chamberlin at gmail.com>
> > a ?crit :
> >
> >> One way to deal with NAs is simply to add an argument to terra::extract:
> >> na.rm=TRUE
> >>
> >>
> >>
> >> On Wed, May 11, 2022 at 9:59 PM GilbertoCamara <
> >> gilberto.camara.inpe at gmail.com> wrote:
> >>
> >>> Dear Julian,
> >>>
> >>> Your script works nicely if the raster data if well-behaved. In real
> >>> life, raster data can have missing values, which have to be dealt with.
> >>>
> >>> Best
> >>> Gilberto
> >>> ============================
> >>> Prof Dr Gilberto Camara
> >>> Senior Researcher
> >>> National Institute for Space Research (INPE), Brazil
> >>>
> >>>
> https://urldefense.com/v3/__https://gilbertocamara.org/__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel5LZQAkw$
> >>> =============================
> >>>
> >>>
> >>>
> >>>
> >>> > On 11 May 2022, at 14:52, Julien Rodriguez <
> >>> julienrodriguez.ardaspm at gmail.com> wrote:
> >>> >
> >>> > Hi Luca and Zivan,
> >>> >
> >>> >
> >>> > Maybe this toy example using terra and sf (probably the class of your
> >>> > district borders object) may help.
> >>> >
> >>> > library(terra)
> >>> > library(sf)
> >>> >
> >>> > # Create a SpatRaster
> >>> > r <- rast(ncols=5, nrows=5, xmin=0, xmax=5, ymin=0, ymax=5)
> >>> > values(r) <- 1:25
> >>> >
> >>> > # Create a polygon object as sf
> >>> > p1 <- rbind(c(1, 1), c(3, 1), c(3, 3), c(1, 3), c(1, 1))
> >>> > p2 <- rbind(c(4, 0), c(4, 1), c(5, 1), c(5, 0), c(4, 0))
> >>> > myPol <- st_sf(code = c(1:2), geometry =
> >>> st_sfc(list(st_polygon(list(p1)),
> >>> > st_polygon(list(p2)))))
> >>> >
> >>> > # Polygon object as SpatVector
> >>> > myPolAsSpatVect <- vect(st_geometry(myPol))
> >>> >
> >>> > plot(r)
> >>> > plot(myPolAsSpatVect, add = TRUE)
> >>> >
> >>> > # Here is your extraction, using fun argument, you can decide how to
> >>> > aggregate the values by district border
> >>> > terra::extract(r, myPolAsSpatVect, fun = mean)
> >>> >
> >>> > Regards
> >>> >
> >>> > Julien
> >>> >
> >>> >
> >>> >
> >>> >
> >>> > Le mer. 11 mai 2022 ? 18:19, Zivan Karaman <zivan.karaman at gmail.com>
> a
> >>> > ?crit :
> >>> >
> >>> >> Hi Luca,
> >>> >> You should perhaps have a look at the crop and mask function in the
> >>> raster
> >>> >> or terra package.
> >>> >> Hope this helps!
> >>> >> Zivan
> >>> >>
> >>> >> On Wed, May 11, 2022 at 6:09 PM <lucfrank at mail.uni-mannheim.de>
> wrote:
> >>> >>
> >>> >>> Hello Everyone,
> >>> >>>
> >>> >>> I have a shapefile with district borders and a raster data file
> >>> (.tif).
> >>> >>>
> >>> >>> How can I extract the value from the raster data onto each
> district in
> >>> >>> the shapefile?
> >>> >>>
> >>> >>> I have the exact thing I want with two shapefiles with the command:
> >>> >>>
> >>> >>> x <- st_join(x,y,join=st_overlaps,left=TRUE,largest=TRUE)
> >>> >>>
> >>> >>> This gives me the result I want. I tried to convert the .tif file
> to a
> >>> >>> shapefile, but this didn't work for me with multiple different
> >>> >>> solutions I found online.
> >>> >>>
> >>> >>> I would appreciate any ideas you might have.
> >>> >>>
> >>> >>> Luca
> >>> >>>
> >>> >>> _______________________________________________
> >>> >>> R-sig-Geo mailing list
> >>> >>> R-sig-Geo at r-project.org
> >>> >>>
> >>>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
> >>> >>>
> >>> >>
> >>> >>        [[alternative HTML version deleted]]
> >>> >>
> >>> >> _______________________________________________
> >>> >> R-sig-Geo mailing list
> >>> >> R-sig-Geo at r-project.org
> >>> >>
> >>>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
> >>> >>
> >>> >
> >>> >       [[alternative HTML version deleted]]
> >>> >
> >>> > _______________________________________________
> >>> > R-sig-Geo mailing list
> >>> > R-sig-Geo at r-project.org
> >>> >
> >>>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>>
> >>>
> https://urldefense.com/v3/__https://stat.ethz.ch/mailman/listinfo/r-sig-geo__;!!HXCxUKc!xb3Skg9BEorRUu-1yoW_jHkQRP9y6tC81a3GXDuYrM-JEP1U_aBOybnpLw7uroqGQsB8yGdvdj8X4xbotnvel9iqWVYy$
> >>>
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
> --
> Luca Frank
> Matrikelnr: 1698155
> 4.FS Politikwissenschaft
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Thu May 12 12:35:45 2022
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Thu, 12 May 2022 12:35:45 +0200
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
 <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
Message-ID: <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>

Hi Ranjeet,

Perhaps you could try the following script:

#####Yield data
#average rice yield
dist_yield <- readRDS(file = "dist_yield.RDS")

#India shape file for districts
library(sf)
shp_dist <- read_sf("District_sim.shp")

#merging using merge function
merge_yield <- merge(shp_dist, dist_yield)

#plot
nbrks <- 10
plot(merge_yield["mod.yield.all"], nbreaks = nbrks, pal =
colorRampPalette(c("red", "white", "blue"))(nbrks), main = "yield by
district")

The plotting is done by the plot from the sf package, you can consult the
help page for more options.
You can, of course, change the color palette, the number of breaks, title,
and other decorations as you wish.

Kind regards,
Zivan


On Thu, May 12, 2022 at 9:03 AM Ranjeet Kumar Jha <
ranjeetjhaiitkgp at gmail.com> wrote:

> Hello Roger,
>
> I really appreciate your support and help! Now I have uploaded all the
> required .shx, .dbf, and .prj files in the link folder.
>
>
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>
> On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> > On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
> >
> > > Hello Roger,
> > >
> > > Thanks for your kind reply! I am going through this. However, sharing
> the
> > > link of code, shape file and .rds data frame for better understanding
> and
> > > helping through the real files.
> >
> > District_sim.shp must of course be accompanied by District_sim.shx,
> > District_sim.dbf and most likely District_sim.prj, which are absent.
> >
> > Roger
> >
> > >
> > >
> >
> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
> > >
> > > Regards and Thanks,
> > > Ranjeet
> > >
> > > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
> > wrote:
> > >
> > >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
> > >>
> > >>> Hello Everyone,
> > >>>
> > >>> I am trying to plot an Indian district shapefile filled with modeled
> > >> yield,
> > >>> corresponding to each GDMID. I needed to first merge the Yield data
> > with
> > >>> respect to each GDMID from the .RDS file with the district shapefile
> of
> > >>> India. Each district is represented by a GDMID. After merging, the
> > Indian
> > >>> district map filled with modeled yield values needs to be plotted
> > similar
> > >>> to an example attached figure. Shape file has five features, and one
> of
> > >>> them is "GDMID".
> > >>
> > >> The code is not a reproducible example; it needs to run with no
> > reference
> > >> to local directories. The use of tibbles or other misunderstandings
> > >> represents state.ID and GDMID as numeric, they should be character,
> you
> > >> cannot do arithmetic on them. The level 2 boundaries from
> > >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not
> > use
> > >> GDMID, so unless you provide a download link to your boundaries,
> no-one
> > >> can help. Also, your data.frame has 694 observations, GADM has 666.
> > >>
> > >> My guess is that you have found a blog somewhere, probably very
> > >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which is
> > >> causing lots of problems, because it complicates things.
> > >>
> > >> Use the sf package, avoid tidyverse which can convert representations
> > >> without asking, make sure that the IDs are character not numeric (to
> > >> preserve any leading zeros), and use tmap or mapsf not ggplot (much
> > >> simpler and more intuitive interface for mapping).
> > >>
> > >> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once
> you
> > >> have control of the IDs (for example try match() to see if they do
> match
> > >> in type and value). sf has a merge method, which gives a good deal of
> > >> control.
> > >>
> > >> Hope this helps,
> > >>
> > >> Roger
> > >>
> > >>>
> > >>> I feel there is something wrong with my code for merging and plotting
> > by
> > >>> ggplot.
> > >>>
> > >>> I have attached herewith my code, and RDS data-frame.
> > >>>
> > >>> It would be great if you could help me with merging issue and
> plotting
> > >> the
> > >>> map, showing yield value with legend in tile format.
> > >>>
> > >>> Regards and Thanks,
> > >>> Ranjeet
> > >>>
> > >>>
> > >>
> > >> --
> > >> Roger Bivand
> > >> Emeritus Professor
> > >> Department of Economics, Norwegian School of Economics,
> > >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> > >> e-mail: Roger.Bivand at nhh.no
> > >> https://orcid.org/0000-0003-2392-6140
> > >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> > >>
> > >
> > >
> > >
> >
> > --
> > Roger Bivand
> > Emeritus Professor
> > Department of Economics, Norwegian School of Economics,
> > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
> > e-mail: Roger.Bivand at nhh.no
> > https://orcid.org/0000-0003-2392-6140
> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >
>
>
> --
> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
> -----------------------------------------------------------
> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>
>
> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
> lives beautiful!"*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Thu May 12 13:04:42 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Thu, 12 May 2022 16:34:42 +0530
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
 <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
 <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>
Message-ID: <CAJfMH3pGeJd7a+nNgQcP8GD=hDb6Q9O1Qicfw_e2e6in58jNEA@mail.gmail.com>

Thank you Zivan for your kind help and support ! Code really worked now and
I understood the concept now!

I again appreciate your help!

Regards and Thanks,
Ranjeet

On Thu, May 12, 2022 at 4:06 PM Zivan Karaman <zivan.karaman at gmail.com>
wrote:

> Hi Ranjeet,
>
> Perhaps you could try the following script:
>
> #####Yield data
> #average rice yield
> dist_yield <- readRDS(file = "dist_yield.RDS")
>
> #India shape file for districts
> library(sf)
> shp_dist <- read_sf("District_sim.shp")
>
> #merging using merge function
> merge_yield <- merge(shp_dist, dist_yield)
>
> #plot
> nbrks <- 10
> plot(merge_yield["mod.yield.all"], nbreaks = nbrks, pal =
> colorRampPalette(c("red", "white", "blue"))(nbrks), main = "yield by
> district")
>
> The plotting is done by the plot from the sf package, you can consult the
> help page for more options.
> You can, of course, change the color palette, the number of breaks, title,
> and other decorations as you wish.
>
> Kind regards,
> Zivan
>
>
> On Thu, May 12, 2022 at 9:03 AM Ranjeet Kumar Jha <
> ranjeetjhaiitkgp at gmail.com> wrote:
>
>> Hello Roger,
>>
>> I really appreciate your support and help! Now I have uploaded all the
>> required .shx, .dbf, and .prj files in the link folder.
>>
>>
>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>
>> On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>> > On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>> >
>> > > Hello Roger,
>> > >
>> > > Thanks for your kind reply! I am going through this. However, sharing
>> the
>> > > link of code, shape file and .rds data frame for better understanding
>> and
>> > > helping through the real files.
>> >
>> > District_sim.shp must of course be accompanied by District_sim.shx,
>> > District_sim.dbf and most likely District_sim.prj, which are absent.
>> >
>> > Roger
>> >
>> > >
>> > >
>> >
>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>> > >
>> > > Regards and Thanks,
>> > > Ranjeet
>> > >
>> > > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
>> > wrote:
>> > >
>> > >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>> > >>
>> > >>> Hello Everyone,
>> > >>>
>> > >>> I am trying to plot an Indian district shapefile filled with modeled
>> > >> yield,
>> > >>> corresponding to each GDMID. I needed to first merge the Yield data
>> > with
>> > >>> respect to each GDMID from the .RDS file with the district
>> shapefile of
>> > >>> India. Each district is represented by a GDMID. After merging, the
>> > Indian
>> > >>> district map filled with modeled yield values needs to be plotted
>> > similar
>> > >>> to an example attached figure. Shape file has five features, and
>> one of
>> > >>> them is "GDMID".
>> > >>
>> > >> The code is not a reproducible example; it needs to run with no
>> > reference
>> > >> to local directories. The use of tibbles or other misunderstandings
>> > >> represents state.ID and GDMID as numeric, they should be character,
>> you
>> > >> cannot do arithmetic on them. The level 2 boundaries from
>> > >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do not
>> > use
>> > >> GDMID, so unless you provide a download link to your boundaries,
>> no-one
>> > >> can help. Also, your data.frame has 694 observations, GADM has 666.
>> > >>
>> > >> My guess is that you have found a blog somewhere, probably very
>> > >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which
>> is
>> > >> causing lots of problems, because it complicates things.
>> > >>
>> > >> Use the sf package, avoid tidyverse which can convert representations
>> > >> without asking, make sure that the IDs are character not numeric (to
>> > >> preserve any leading zeros), and use tmap or mapsf not ggplot (much
>> > >> simpler and more intuitive interface for mapping).
>> > >>
>> > >> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once
>> you
>> > >> have control of the IDs (for example try match() to see if they do
>> match
>> > >> in type and value). sf has a merge method, which gives a good deal of
>> > >> control.
>> > >>
>> > >> Hope this helps,
>> > >>
>> > >> Roger
>> > >>
>> > >>>
>> > >>> I feel there is something wrong with my code for merging and
>> plotting
>> > by
>> > >>> ggplot.
>> > >>>
>> > >>> I have attached herewith my code, and RDS data-frame.
>> > >>>
>> > >>> It would be great if you could help me with merging issue and
>> plotting
>> > >> the
>> > >>> map, showing yield value with legend in tile format.
>> > >>>
>> > >>> Regards and Thanks,
>> > >>> Ranjeet
>> > >>>
>> > >>>
>> > >>
>> > >> --
>> > >> Roger Bivand
>> > >> Emeritus Professor
>> > >> Department of Economics, Norwegian School of Economics,
>> > >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> > >> e-mail: Roger.Bivand at nhh.no
>> > >> https://orcid.org/0000-0003-2392-6140
>> > >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> > >>
>> > >
>> > >
>> > >
>> >
>> > --
>> > Roger Bivand
>> > Emeritus Professor
>> > Department of Economics, Norwegian School of Economics,
>> > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>> > e-mail: Roger.Bivand at nhh.no
>> > https://orcid.org/0000-0003-2392-6140
>> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> >
>>
>>
>> --
>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>> -----------------------------------------------------------
>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>
>>
>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>> lives beautiful!"*
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Thu May 12 15:41:30 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Thu, 12 May 2022 19:11:30 +0530
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAJfMH3pGeJd7a+nNgQcP8GD=hDb6Q9O1Qicfw_e2e6in58jNEA@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
 <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
 <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>
 <CAJfMH3pGeJd7a+nNgQcP8GD=hDb6Q9O1Qicfw_e2e6in58jNEA@mail.gmail.com>
Message-ID: <CAJfMH3oDC5Heu9OwEv8_uf=3dsB=7H9OrxkES2D31tCK6MhAdg@mail.gmail.com>

Hi Zivan, Just a quick question - Can we add legend title - "Yield
(tons/ha) with this plot function in sf package. I could n't find so.

Thanks,
Ranjeet

On Thu, May 12, 2022 at 4:34 PM Ranjeet Kumar Jha <
ranjeetjhaiitkgp at gmail.com> wrote:

> Thank you Zivan for your kind help and support ! Code really worked now
> and I understood the concept now!
>
> I again appreciate your help!
>
> Regards and Thanks,
> Ranjeet
>
> On Thu, May 12, 2022 at 4:06 PM Zivan Karaman <zivan.karaman at gmail.com>
> wrote:
>
>> Hi Ranjeet,
>>
>> Perhaps you could try the following script:
>>
>> #####Yield data
>> #average rice yield
>> dist_yield <- readRDS(file = "dist_yield.RDS")
>>
>> #India shape file for districts
>> library(sf)
>> shp_dist <- read_sf("District_sim.shp")
>>
>> #merging using merge function
>> merge_yield <- merge(shp_dist, dist_yield)
>>
>> #plot
>> nbrks <- 10
>> plot(merge_yield["mod.yield.all"], nbreaks = nbrks, pal =
>> colorRampPalette(c("red", "white", "blue"))(nbrks), main = "yield by
>> district")
>>
>> The plotting is done by the plot from the sf package, you can consult the
>> help page for more options.
>> You can, of course, change the color palette, the number of breaks,
>> title, and other decorations as you wish.
>>
>> Kind regards,
>> Zivan
>>
>>
>> On Thu, May 12, 2022 at 9:03 AM Ranjeet Kumar Jha <
>> ranjeetjhaiitkgp at gmail.com> wrote:
>>
>>> Hello Roger,
>>>
>>> I really appreciate your support and help! Now I have uploaded all the
>>> required .shx, .dbf, and .prj files in the link folder.
>>>
>>>
>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>>
>>> On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>
>>> > On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>> >
>>> > > Hello Roger,
>>> > >
>>> > > Thanks for your kind reply! I am going through this. However,
>>> sharing the
>>> > > link of code, shape file and .rds data frame for better
>>> understanding and
>>> > > helping through the real files.
>>> >
>>> > District_sim.shp must of course be accompanied by District_sim.shx,
>>> > District_sim.dbf and most likely District_sim.prj, which are absent.
>>> >
>>> > Roger
>>> >
>>> > >
>>> > >
>>> >
>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>> > >
>>> > > Regards and Thanks,
>>> > > Ranjeet
>>> > >
>>> > > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
>>> > wrote:
>>> > >
>>> > >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>> > >>
>>> > >>> Hello Everyone,
>>> > >>>
>>> > >>> I am trying to plot an Indian district shapefile filled with
>>> modeled
>>> > >> yield,
>>> > >>> corresponding to each GDMID. I needed to first merge the Yield data
>>> > with
>>> > >>> respect to each GDMID from the .RDS file with the district
>>> shapefile of
>>> > >>> India. Each district is represented by a GDMID. After merging, the
>>> > Indian
>>> > >>> district map filled with modeled yield values needs to be plotted
>>> > similar
>>> > >>> to an example attached figure. Shape file has five features, and
>>> one of
>>> > >>> them is "GDMID".
>>> > >>
>>> > >> The code is not a reproducible example; it needs to run with no
>>> > reference
>>> > >> to local directories. The use of tibbles or other misunderstandings
>>> > >> represents state.ID and GDMID as numeric, they should be character,
>>> you
>>> > >> cannot do arithmetic on them. The level 2 boundaries from
>>> > >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do
>>> not
>>> > use
>>> > >> GDMID, so unless you provide a download link to your boundaries,
>>> no-one
>>> > >> can help. Also, your data.frame has 694 observations, GADM has 666.
>>> > >>
>>> > >> My guess is that you have found a blog somewhere, probably very
>>> > >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and which
>>> is
>>> > >> causing lots of problems, because it complicates things.
>>> > >>
>>> > >> Use the sf package, avoid tidyverse which can convert
>>> representations
>>> > >> without asking, make sure that the IDs are character not numeric (to
>>> > >> preserve any leading zeros), and use tmap or mapsf not ggplot (much
>>> > >> simpler and more intuitive interface for mapping).
>>> > >>
>>> > >> See https://geocompr.robinlovelace.net/ and the sf vignettes. Once
>>> you
>>> > >> have control of the IDs (for example try match() to see if they do
>>> match
>>> > >> in type and value). sf has a merge method, which gives a good deal
>>> of
>>> > >> control.
>>> > >>
>>> > >> Hope this helps,
>>> > >>
>>> > >> Roger
>>> > >>
>>> > >>>
>>> > >>> I feel there is something wrong with my code for merging and
>>> plotting
>>> > by
>>> > >>> ggplot.
>>> > >>>
>>> > >>> I have attached herewith my code, and RDS data-frame.
>>> > >>>
>>> > >>> It would be great if you could help me with merging issue and
>>> plotting
>>> > >> the
>>> > >>> map, showing yield value with legend in tile format.
>>> > >>>
>>> > >>> Regards and Thanks,
>>> > >>> Ranjeet
>>> > >>>
>>> > >>>
>>> > >>
>>> > >> --
>>> > >> Roger Bivand
>>> > >> Emeritus Professor
>>> > >> Department of Economics, Norwegian School of Economics,
>>> > >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>> > >> e-mail: Roger.Bivand at nhh.no
>>> > >> https://orcid.org/0000-0003-2392-6140
>>> > >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> > >>
>>> > >
>>> > >
>>> > >
>>> >
>>> > --
>>> > Roger Bivand
>>> > Emeritus Professor
>>> > Department of Economics, Norwegian School of Economics,
>>> > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>> > e-mail: Roger.Bivand at nhh.no
>>> > https://orcid.org/0000-0003-2392-6140
>>> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> >
>>>
>>>
>>> --
>>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>>> -----------------------------------------------------------
>>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>>
>>>
>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>>> lives beautiful!"*
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>
> --
> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
> -----------------------------------------------------------
> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>
>
> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
> lives beautiful!"*
>
>

-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Thu May 12 17:19:45 2022
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Thu, 12 May 2022 17:19:45 +0200
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAJfMH3oDC5Heu9OwEv8_uf=3dsB=7H9OrxkES2D31tCK6MhAdg@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
 <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
 <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>
 <CAJfMH3pGeJd7a+nNgQcP8GD=hDb6Q9O1Qicfw_e2e6in58jNEA@mail.gmail.com>
 <CAJfMH3oDC5Heu9OwEv8_uf=3dsB=7H9OrxkES2D31tCK6MhAdg@mail.gmail.com>
Message-ID: <CAKtE6yMpCN97xkALWzfjifUj2CkJX6RN-Fhz25q7avuZHMmSrw@mail.gmail.com>

Hi Ranjeet,

I didn?t find out how to do it with sf, but you can get it using the mapsf
package:

library(mapsf)

brks <- mf_get_breaks(merge_yield$mod.yield.all, breaks = "pretty")
nclass <- length(brks) - 1

# set a theme
mf_theme("ink")

# plot yield
mf_map(
    x = merge_yield,
    var = "mod.yield.all",
    type = "choro",
    breaks = brks,
    pal = colorRampPalette(c("red", "white", "blue"))(nclass),
    border = "grey",
    lwd = 0.5,
    leg_val_rnd = 0,
    leg_pos = "topright",
    leg_title = "Yield (tons/ha)"
)

# title etc.
mf_layout(title = "Rice yield by district in India",
          credits = "", scale = FALSE, arrow = FALSE)


Kind regards,
Zivan


On Thu, May 12, 2022 at 3:42 PM Ranjeet Kumar Jha <
ranjeetjhaiitkgp at gmail.com> wrote:

> Hi Zivan, Just a quick question - Can we add legend title - "Yield
> (tons/ha) with this plot function in sf package. I could n't find so.
>
> Thanks,
> Ranjeet
>
> On Thu, May 12, 2022 at 4:34 PM Ranjeet Kumar Jha <
> ranjeetjhaiitkgp at gmail.com> wrote:
>
>> Thank you Zivan for your kind help and support ! Code really worked now
>> and I understood the concept now!
>>
>> I again appreciate your help!
>>
>> Regards and Thanks,
>> Ranjeet
>>
>> On Thu, May 12, 2022 at 4:06 PM Zivan Karaman <zivan.karaman at gmail.com>
>> wrote:
>>
>>> Hi Ranjeet,
>>>
>>> Perhaps you could try the following script:
>>>
>>> #####Yield data
>>> #average rice yield
>>> dist_yield <- readRDS(file = "dist_yield.RDS")
>>>
>>> #India shape file for districts
>>> library(sf)
>>> shp_dist <- read_sf("District_sim.shp")
>>>
>>> #merging using merge function
>>> merge_yield <- merge(shp_dist, dist_yield)
>>>
>>> #plot
>>> nbrks <- 10
>>> plot(merge_yield["mod.yield.all"], nbreaks = nbrks, pal =
>>> colorRampPalette(c("red", "white", "blue"))(nbrks), main = "yield by
>>> district")
>>>
>>> The plotting is done by the plot from the sf package, you can consult
>>> the help page for more options.
>>> You can, of course, change the color palette, the number of breaks,
>>> title, and other decorations as you wish.
>>>
>>> Kind regards,
>>> Zivan
>>>
>>>
>>> On Thu, May 12, 2022 at 9:03 AM Ranjeet Kumar Jha <
>>> ranjeetjhaiitkgp at gmail.com> wrote:
>>>
>>>> Hello Roger,
>>>>
>>>> I really appreciate your support and help! Now I have uploaded all the
>>>> required .shx, .dbf, and .prj files in the link folder.
>>>>
>>>>
>>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>>>
>>>> On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no>
>>>> wrote:
>>>>
>>>> > On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>>> >
>>>> > > Hello Roger,
>>>> > >
>>>> > > Thanks for your kind reply! I am going through this. However,
>>>> sharing the
>>>> > > link of code, shape file and .rds data frame for better
>>>> understanding and
>>>> > > helping through the real files.
>>>> >
>>>> > District_sim.shp must of course be accompanied by District_sim.shx,
>>>> > District_sim.dbf and most likely District_sim.prj, which are absent.
>>>> >
>>>> > Roger
>>>> >
>>>> > >
>>>> > >
>>>> >
>>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>>> > >
>>>> > > Regards and Thanks,
>>>> > > Ranjeet
>>>> > >
>>>> > > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
>>>> > wrote:
>>>> > >
>>>> > >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>>> > >>
>>>> > >>> Hello Everyone,
>>>> > >>>
>>>> > >>> I am trying to plot an Indian district shapefile filled with
>>>> modeled
>>>> > >> yield,
>>>> > >>> corresponding to each GDMID. I needed to first merge the Yield
>>>> data
>>>> > with
>>>> > >>> respect to each GDMID from the .RDS file with the district
>>>> shapefile of
>>>> > >>> India. Each district is represented by a GDMID. After merging, the
>>>> > Indian
>>>> > >>> district map filled with modeled yield values needs to be plotted
>>>> > similar
>>>> > >>> to an example attached figure. Shape file has five features, and
>>>> one of
>>>> > >>> them is "GDMID".
>>>> > >>
>>>> > >> The code is not a reproducible example; it needs to run with no
>>>> > reference
>>>> > >> to local directories. The use of tibbles or other misunderstandings
>>>> > >> represents state.ID and GDMID as numeric, they should be
>>>> character, you
>>>> > >> cannot do arithmetic on them. The level 2 boundaries from
>>>> > >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do
>>>> not
>>>> > use
>>>> > >> GDMID, so unless you provide a download link to your boundaries,
>>>> no-one
>>>> > >> can help. Also, your data.frame has 694 observations, GADM has 666.
>>>> > >>
>>>> > >> My guess is that you have found a blog somewhere, probably very
>>>> > >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and
>>>> which is
>>>> > >> causing lots of problems, because it complicates things.
>>>> > >>
>>>> > >> Use the sf package, avoid tidyverse which can convert
>>>> representations
>>>> > >> without asking, make sure that the IDs are character not numeric
>>>> (to
>>>> > >> preserve any leading zeros), and use tmap or mapsf not ggplot (much
>>>> > >> simpler and more intuitive interface for mapping).
>>>> > >>
>>>> > >> See https://geocompr.robinlovelace.net/ and the sf vignettes.
>>>> Once you
>>>> > >> have control of the IDs (for example try match() to see if they do
>>>> match
>>>> > >> in type and value). sf has a merge method, which gives a good deal
>>>> of
>>>> > >> control.
>>>> > >>
>>>> > >> Hope this helps,
>>>> > >>
>>>> > >> Roger
>>>> > >>
>>>> > >>>
>>>> > >>> I feel there is something wrong with my code for merging and
>>>> plotting
>>>> > by
>>>> > >>> ggplot.
>>>> > >>>
>>>> > >>> I have attached herewith my code, and RDS data-frame.
>>>> > >>>
>>>> > >>> It would be great if you could help me with merging issue and
>>>> plotting
>>>> > >> the
>>>> > >>> map, showing yield value with legend in tile format.
>>>> > >>>
>>>> > >>> Regards and Thanks,
>>>> > >>> Ranjeet
>>>> > >>>
>>>> > >>>
>>>> > >>
>>>> > >> --
>>>> > >> Roger Bivand
>>>> > >> Emeritus Professor
>>>> > >> Department of Economics, Norwegian School of Economics,
>>>> > >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>> > >> e-mail: Roger.Bivand at nhh.no
>>>> > >> https://orcid.org/0000-0003-2392-6140
>>>> > >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>> > >>
>>>> > >
>>>> > >
>>>> > >
>>>> >
>>>> > --
>>>> > Roger Bivand
>>>> > Emeritus Professor
>>>> > Department of Economics, Norwegian School of Economics,
>>>> > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>> > e-mail: Roger.Bivand at nhh.no
>>>> > https://orcid.org/0000-0003-2392-6140
>>>> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>> >
>>>>
>>>>
>>>> --
>>>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>>>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>>>> -----------------------------------------------------------
>>>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>>>
>>>>
>>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>>>> lives beautiful!"*
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> --
>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>> -----------------------------------------------------------
>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>
>>
>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>> lives beautiful!"*
>>
>>
>
> --
> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
> -----------------------------------------------------------
> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>
>
> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
> lives beautiful!"*
>
>

	[[alternative HTML version deleted]]


From r@njeetjh@||tkgp @end|ng |rom gm@||@com  Fri May 13 07:26:14 2022
From: r@njeetjh@||tkgp @end|ng |rom gm@||@com (Ranjeet Kumar Jha)
Date: Fri, 13 May 2022 06:26:14 +0100
Subject: [R-sig-Geo] Need to merge .RDS dataframe and India Shape file,
 and then plot yield map with tile legend
In-Reply-To: <CAKtE6yMpCN97xkALWzfjifUj2CkJX6RN-Fhz25q7avuZHMmSrw@mail.gmail.com>
References: <CAJfMH3rWJVj8u+BcW1idZkGdDziLa+9R5TSmZz7GQK0pDSbmpQ@mail.gmail.com>
 <22e52c1e-2b16-e928-17a3-18e8c29531be@reclus2.nhh.no>
 <CAJfMH3q6vPajobnQ0y2RZGLM_6EJ=+RF8p_Ft3XU93FjfYA6_A@mail.gmail.com>
 <d4e0e983-8352-8662-121d-787a4ab2659@reclus2.nhh.no>
 <CAJfMH3pmaWZik1uwg6-nPWG_q6M5FmLXK9FN_zVcj5p=rVoa+Q@mail.gmail.com>
 <CAKtE6yO9ccghZahrbHQnj0zeLARvCAZDg-EJnPHgtaURi=vX3Q@mail.gmail.com>
 <CAJfMH3pGeJd7a+nNgQcP8GD=hDb6Q9O1Qicfw_e2e6in58jNEA@mail.gmail.com>
 <CAJfMH3oDC5Heu9OwEv8_uf=3dsB=7H9OrxkES2D31tCK6MhAdg@mail.gmail.com>
 <CAKtE6yMpCN97xkALWzfjifUj2CkJX6RN-Fhz25q7avuZHMmSrw@mail.gmail.com>
Message-ID: <CAJfMH3rWJPWzkTP+Xv05p3LJ9s6xqoDiXjsv4BsoNZ3n1j-OLQ@mail.gmail.com>

Thank you Zivan for such a kind gesture and immense help!!!! It solved all
the issues of this spatial mapping.

Regards and Thanks,
Ranjeet

On Thu, May 12, 2022 at 4:20 PM Zivan Karaman <zivan.karaman at gmail.com>
wrote:

> Hi Ranjeet,
>
> I didn?t find out how to do it with sf, but you can get it using the mapsf
> package:
>
> library(mapsf)
>
> brks <- mf_get_breaks(merge_yield$mod.yield.all, breaks = "pretty")
> nclass <- length(brks) - 1
>
> # set a theme
> mf_theme("ink")
>
> # plot yield
> mf_map(
>     x = merge_yield,
>     var = "mod.yield.all",
>     type = "choro",
>     breaks = brks,
>     pal = colorRampPalette(c("red", "white", "blue"))(nclass),
>     border = "grey",
>     lwd = 0.5,
>     leg_val_rnd = 0,
>     leg_pos = "topright",
>     leg_title = "Yield (tons/ha)"
> )
>
> # title etc.
> mf_layout(title = "Rice yield by district in India",
>           credits = "", scale = FALSE, arrow = FALSE)
>
>
> Kind regards,
> Zivan
>
>
> On Thu, May 12, 2022 at 3:42 PM Ranjeet Kumar Jha <
> ranjeetjhaiitkgp at gmail.com> wrote:
>
>> Hi Zivan, Just a quick question - Can we add legend title - "Yield
>> (tons/ha) with this plot function in sf package. I could n't find so.
>>
>> Thanks,
>> Ranjeet
>>
>> On Thu, May 12, 2022 at 4:34 PM Ranjeet Kumar Jha <
>> ranjeetjhaiitkgp at gmail.com> wrote:
>>
>>> Thank you Zivan for your kind help and support ! Code really worked now
>>> and I understood the concept now!
>>>
>>> I again appreciate your help!
>>>
>>> Regards and Thanks,
>>> Ranjeet
>>>
>>> On Thu, May 12, 2022 at 4:06 PM Zivan Karaman <zivan.karaman at gmail.com>
>>> wrote:
>>>
>>>> Hi Ranjeet,
>>>>
>>>> Perhaps you could try the following script:
>>>>
>>>> #####Yield data
>>>> #average rice yield
>>>> dist_yield <- readRDS(file = "dist_yield.RDS")
>>>>
>>>> #India shape file for districts
>>>> library(sf)
>>>> shp_dist <- read_sf("District_sim.shp")
>>>>
>>>> #merging using merge function
>>>> merge_yield <- merge(shp_dist, dist_yield)
>>>>
>>>> #plot
>>>> nbrks <- 10
>>>> plot(merge_yield["mod.yield.all"], nbreaks = nbrks, pal =
>>>> colorRampPalette(c("red", "white", "blue"))(nbrks), main = "yield by
>>>> district")
>>>>
>>>> The plotting is done by the plot from the sf package, you can consult
>>>> the help page for more options.
>>>> You can, of course, change the color palette, the number of breaks,
>>>> title, and other decorations as you wish.
>>>>
>>>> Kind regards,
>>>> Zivan
>>>>
>>>>
>>>> On Thu, May 12, 2022 at 9:03 AM Ranjeet Kumar Jha <
>>>> ranjeetjhaiitkgp at gmail.com> wrote:
>>>>
>>>>> Hello Roger,
>>>>>
>>>>> I really appreciate your support and help! Now I have uploaded all the
>>>>> required .shx, .dbf, and .prj files in the link folder.
>>>>>
>>>>>
>>>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>>>>
>>>>> On Wed, May 11, 2022 at 5:42 PM Roger Bivand <Roger.Bivand at nhh.no>
>>>>> wrote:
>>>>>
>>>>> > On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>>>> >
>>>>> > > Hello Roger,
>>>>> > >
>>>>> > > Thanks for your kind reply! I am going through this. However,
>>>>> sharing the
>>>>> > > link of code, shape file and .rds data frame for better
>>>>> understanding and
>>>>> > > helping through the real files.
>>>>> >
>>>>> > District_sim.shp must of course be accompanied by District_sim.shx,
>>>>> > District_sim.dbf and most likely District_sim.prj, which are absent.
>>>>> >
>>>>> > Roger
>>>>> >
>>>>> > >
>>>>> > >
>>>>> >
>>>>> https://drive.google.com/drive/folders/1dNmGTI8_c9PK1QqmfIjnpbyzuiCXgxFC?msclkid=4816425dd04111ec912cf8b4175aa93c
>>>>> > >
>>>>> > > Regards and Thanks,
>>>>> > > Ranjeet
>>>>> > >
>>>>> > > On Tue, May 10, 2022 at 1:34 PM Roger Bivand <Roger.Bivand at nhh.no>
>>>>> > wrote:
>>>>> > >
>>>>> > >> On Tue, 10 May 2022, Ranjeet Kumar Jha wrote:
>>>>> > >>
>>>>> > >>> Hello Everyone,
>>>>> > >>>
>>>>> > >>> I am trying to plot an Indian district shapefile filled with
>>>>> modeled
>>>>> > >> yield,
>>>>> > >>> corresponding to each GDMID. I needed to first merge the Yield
>>>>> data
>>>>> > with
>>>>> > >>> respect to each GDMID from the .RDS file with the district
>>>>> shapefile of
>>>>> > >>> India. Each district is represented by a GDMID. After merging,
>>>>> the
>>>>> > Indian
>>>>> > >>> district map filled with modeled yield values needs to be plotted
>>>>> > similar
>>>>> > >>> to an example attached figure. Shape file has five features, and
>>>>> one of
>>>>> > >>> them is "GDMID".
>>>>> > >>
>>>>> > >> The code is not a reproducible example; it needs to run with no
>>>>> > reference
>>>>> > >> to local directories. The use of tibbles or other
>>>>> misunderstandings
>>>>> > >> represents state.ID and GDMID as numeric, they should be
>>>>> character, you
>>>>> > >> cannot do arithmetic on them. The level 2 boundaries from
>>>>> > >> https://geodata.ucdavis.edu/gadm/gadm4.0/gpkg/gadm40_IND.gpkg do
>>>>> not
>>>>> > use
>>>>> > >> GDMID, so unless you provide a download link to your boundaries,
>>>>> no-one
>>>>> > >> can help. Also, your data.frame has 694 observations, GADM has
>>>>> 666.
>>>>> > >>
>>>>> > >> My guess is that you have found a blog somewhere, probably very
>>>>> > >> out-of-date (you use rgdal::readOGR() not sf::st_read()), and
>>>>> which is
>>>>> > >> causing lots of problems, because it complicates things.
>>>>> > >>
>>>>> > >> Use the sf package, avoid tidyverse which can convert
>>>>> representations
>>>>> > >> without asking, make sure that the IDs are character not numeric
>>>>> (to
>>>>> > >> preserve any leading zeros), and use tmap or mapsf not ggplot
>>>>> (much
>>>>> > >> simpler and more intuitive interface for mapping).
>>>>> > >>
>>>>> > >> See https://geocompr.robinlovelace.net/ and the sf vignettes.
>>>>> Once you
>>>>> > >> have control of the IDs (for example try match() to see if they
>>>>> do match
>>>>> > >> in type and value). sf has a merge method, which gives a good
>>>>> deal of
>>>>> > >> control.
>>>>> > >>
>>>>> > >> Hope this helps,
>>>>> > >>
>>>>> > >> Roger
>>>>> > >>
>>>>> > >>>
>>>>> > >>> I feel there is something wrong with my code for merging and
>>>>> plotting
>>>>> > by
>>>>> > >>> ggplot.
>>>>> > >>>
>>>>> > >>> I have attached herewith my code, and RDS data-frame.
>>>>> > >>>
>>>>> > >>> It would be great if you could help me with merging issue and
>>>>> plotting
>>>>> > >> the
>>>>> > >>> map, showing yield value with legend in tile format.
>>>>> > >>>
>>>>> > >>> Regards and Thanks,
>>>>> > >>> Ranjeet
>>>>> > >>>
>>>>> > >>>
>>>>> > >>
>>>>> > >> --
>>>>> > >> Roger Bivand
>>>>> > >> Emeritus Professor
>>>>> > >> Department of Economics, Norwegian School of Economics,
>>>>> > >> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>>> > >> e-mail: Roger.Bivand at nhh.no
>>>>> > >> https://orcid.org/0000-0003-2392-6140
>>>>> > >> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>> > >>
>>>>> > >
>>>>> > >
>>>>> > >
>>>>> >
>>>>> > --
>>>>> > Roger Bivand
>>>>> > Emeritus Professor
>>>>> > Department of Economics, Norwegian School of Economics,
>>>>> > Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway.
>>>>> > e-mail: Roger.Bivand at nhh.no
>>>>> > https://orcid.org/0000-0003-2392-6140
>>>>> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>> >
>>>>>
>>>>>
>>>>> --
>>>>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>>>>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>>>>> -----------------------------------------------------------
>>>>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>>>>
>>>>>
>>>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>>>>> lives beautiful!"*
>>>>>
>>>>>         [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>
>>> --
>>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>>> -----------------------------------------------------------
>>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>>
>>>
>>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>>> lives beautiful!"*
>>>
>>>
>>
>> --
>> Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
>> https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
>> -----------------------------------------------------------
>> Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*
>>
>>
>> *"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
>> lives beautiful!"*
>>
>>

-- 
Ranjeet  Kumar Jha, M.Tech. (IIT Kharagpur), Ph.D. (USA)
https://www.linkedin.com/in/ranjeet-kumar-jha-ph-d-usa-73a5aa56
-----------------------------------------------------------
Email: *ranjeetjhaiitkgp at gmail.com <ranjeetjhaiitkgp at gmail.com>*


*"Simple Heart, Humble Attitude and Surrender to Supreme Being make our
lives beautiful!"*

	[[alternative HTML version deleted]]


From @own@|ch@nd|m@ @end|ng |rom gm@||@com  Fri May 13 11:47:56 2022
From: @own@|ch@nd|m@ @end|ng |rom gm@||@com (sownal chand)
Date: Fri, 13 May 2022 21:47:56 +1200
Subject: [R-sig-Geo] Shapefile and Basemap
Message-ID: <CAH5tCz28aaOcO9KDYby97sA6KpbVXAZyCA6v8QMzKD5t7_ctRQ@mail.gmail.com>

Hello sir/madam,

I am working with shape file of my country and the issue I am facing is the
shapefile is scattered while plotting it using basemap. I am using my
sample point data which is attached to this email. I hope that some expert
in this area would help in correcting the codes below to show the shapefile
in one location ( its a pacific centered map)

**************************************************************************************************


library(sp)
library(raster)
library(rgdal)
library(leaflet)

#read.csv
read.csv ("C://Users/Documents/data.csv") -> data.df
head(data.df)

hist(data.df$Year, breaks=20)

#remove NA valuues in the spatial Data Frame
data.df <- na.omit(data.df)
View(data.df)

plot(data.df$long, data.df$lat,
     ylab = "Latitude", xlab="Longitude") #boring!

# Use the cex function to plot circle size as a function of a variable
plot(data.df$long, data.df$lat,
     cex = data.df$Year.7 * 0.045,
     ylab = "Latitude", xlab="Longitude")

data.df_SPDF <- SpatialPointsDataFrame(coords = data.df[,c("long", "lat")],
                                                data = data.df[,c("Year",
"Year.1", "Year.2","Year.3","Year.4")],
                                                proj4string =
CRS("+init=epsg:4326")) # sets the projection to WGS 1984 using lat/long.
Optional but good to specify

# Summary of object
data.df_SPDF

# SPDFs partition data elements, e.g. the coordinates are stored separately
from the data
head(data.df_SPDF at coords)

head(data.df_SPDF at data)


# You can quickly access the data frame as per a standard data frame, e.g.
head(data.df_SPDF$Year)


# You can use the plot or spplot function to get quick plots
plot(data.df_SPDF)

spplot(data.df_SPDF, zcol = "Year")

FIJ_Adm_2 <- readOGR("FIJ_Adm_2_shapefile", "FIJ_Adm_2")

# You first need the ISO3 codes for the country of interest.

# The getData function then allows you to retrieve the relevant admin level
boundaries from GADM.
FJI_Adm_2 <- raster::getData("GADM", country="FJI", level=2)

# Plot both country and data points
plot(FJI_Adm_2)
points(data.df$long, data.df$lat,
       cex = data.df$Year * 0.045,
       ylab = "Latitude", xlab="Longitude",
       col="red")

basemap <- leaflet() %>% addProviderTiles("CartoDB.Positron")

basemap %>% addPolygons(data=FJI_Adm_2)

# to change the colors/line weight
basemap %>% addPolygons(data=FJI_Adm_2, color = "red",
                        weight = 1, fillOpacity = 0.2)


# If you want to add points as well
basemap %>% addPolygons(data=FJI_Adm_2, weight = 2,
                        popup = FJI_Adm_2$NAME_2) %>%

  addCircleMarkers(data=data.df_SPDF,
                   color="red", radius = 2)

library(wesanderson) # for a nice color palette
colorPal <- colorNumeric(wes_palette("Zissou1")[1:5], data.df_SPDF$Year, n
= 5)


# colorPal is now a function you can apply to get the corresponding
# color for a value
colorPal(0.6)

basemap %>% addPolygons(data=FJI_Adm_1, weight = 2, fillOpacity=0,
                        popup = FJI_Adm_1$NAME_1) %>%

  addCircleMarkers(data=data.df_SPDF,
                   color = colorPal(data.df$Year),
                   radius = 2,
                   popup = as.character(data.df$Year))%>%

  addLegend(pal = colorPal,
            title = "Average Temp for Year",
            values = data.df_SPDF$Year)



*************************************************************************************************

Thanking you in advance
sownalc

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220513/f09fac6c/attachment-0001.html>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: DataR.csv
Type: text/csv
Size: 611 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20220513/f09fac6c/attachment-0001.csv>

From @own@|ch@nd|m@ @end|ng |rom gm@||@com  Sun May 15 02:52:58 2022
From: @own@|ch@nd|m@ @end|ng |rom gm@||@com (sownal chand)
Date: Sun, 15 May 2022 12:52:58 +1200
Subject: [R-sig-Geo] Shapefile and Basemap
In-Reply-To: <49649c45-49ed-1a47-0cb4-88b3ba57a3af@gmail.com>
References: <CAH5tCz28aaOcO9KDYby97sA6KpbVXAZyCA6v8QMzKD5t7_ctRQ@mail.gmail.com>
 <49649c45-49ed-1a47-0cb4-88b3ba57a3af@gmail.com>
Message-ID: <CAH5tCz0oBsZLZSZ8WBAUcdBR4t9_uWawNnt1TdPP_SQDjtwTtg@mail.gmail.com>

Hi Micha,

Thanks for your email and really appreciate your assistance.

I see that there are alot of old versions of information on the net with
spatial analysis using R. I would like to request if you have any
particular site or reading materials for spatial analysis and modelling in
regards to R programming would really help.

Once again, thanking you in advance

Kind regards
Sownalc

On Sun, May 15, 2022, 03:50 Micha Silver <tsvibar at gmail.com> wrote:

> Hello
>
>
> On 5/13/22 12:47, sownal chand wrote:
> > Hello sir/madam,
> >
> > I am working with shape file of my country and the issue I am facing
> > is the shapefile is scattered while plotting it using basemap. I am
> > using my sample point data which is attached to this email. I hope
> > that some expert in this area would help in correcting the codes below
> > to show the shapefile in one location ( its a pacific centered map)
>
>
> When you raised this question a few weeks ago, it was suggested to avoid
> the `sp` package with its SPDF data type, and instead focus on the newer
> `sf` package.
>
> There is also a replacement for the raster::getData function in the new
> `geodata` package.
>
>
> Here is a much simpler version of what (I think) you are trying to achieve:
>
>
> # Load only three libraries
>
> library(sf)
> library(tmap)
> library(geodata)
>
>
> # Read your list of data (You should remove the summary line in advance...)
>
> dt <- read.csv("DataR.csv")
> dt <- dt[complete.cases(dt),]
> dt_sf <- st_as_sf(dt, coords=c("long", "lat"),
>                    crs="EPSG:4326")
> str(dt_sf)
>
> # Get Fiji boundary from geodata package
> fiji <- gadm(country="FIJI", level=2, path=tempdir())
> # Convert to sf object for tmap plotting
> fiji <- st_as_sf(fiji)
>
>
> # Visualize with tmap
>
> tmap_mode("view")
> tm_basemap("OpenStreetMap.Mapnik") +
>          tm_shape(fiji) +
>          tm_borders(col="brown", lwd=2) +
>          tm_shape(dt_sf) +
>
>          # size of symbols by yearly data. You can choose any year, of
> course
>
>          tm_symbols(col="blue", size="Year2", scale=0.1)
>
>
>
> If you have a specific problem with a certain shapefile, you'll have to
> supply it to the list in order to get further help.
>
>
> HTH
>
>
> >
> >
> **************************************************************************************************
> >
> >
> > library(sp)
> > library(raster)
> > library(rgdal)
> > library(leaflet)
> >
> > #read.csv
> > read.csv ("C://Users/Documents/data.csv") -> data.df
> > head(data.df)
> >
> > hist(data.df$Year, breaks=20)
> >
> > #remove NA valuues in the spatial Data Frame
> > data.df <- na.omit(data.df)
> > View(data.df)
> >
> > plot(data.df$long, data.df$lat,
> >      ylab = "Latitude", xlab="Longitude") #boring!
> >
> > # Use the cex function to plot circle size as a function of a variable
> > plot(data.df$long, data.df$lat,
> >      cex = data.df$Year.7 * 0.045,
> >      ylab = "Latitude", xlab="Longitude")
> >
> > data.df_SPDF <- SpatialPointsDataFrame(coords = data.df[,c("long",
> > "lat")],
> >                                                 data =
> > data.df[,c("Year", "Year.1", "Year.2","Year.3","Year.4")],
> >                                                 proj4string =
> > CRS("+init=epsg:4326")) # sets the projection to WGS 1984 using
> > lat/long. Optional but good to specify
> >
> > # Summary of object
> > data.df_SPDF
> >
> > # SPDFs partition data elements, e.g. the coordinates are stored
> > separately from the data
> > head(data.df_SPDF at coords)
> >
> > head(data.df_SPDF at data)
> >
> >
> > # You can quickly access the data frame as per a standard data frame,
> e.g.
> > head(data.df_SPDF$Year)
> >
> >
> > # You can use the plot or spplot function to get quick plots
> > plot(data.df_SPDF)
> >
> > spplot(data.df_SPDF, zcol = "Year")
> >
> > FIJ_Adm_2 <- readOGR("FIJ_Adm_2_shapefile", "FIJ_Adm_2")
> >
> > # You first need the ISO3 codes for the country of interest.
> >
> > # The getData function then allows you to retrieve the relevant admin
> > level boundaries from GADM.
> > FJI_Adm_2 <- raster::getData("GADM", country="FJI", level=2)
> >
> > # Plot both country and data points
> > plot(FJI_Adm_2)
> > points(data.df$long, data.df$lat,
> >        cex = data.df$Year * 0.045,
> >        ylab = "Latitude", xlab="Longitude",
> >        col="red")
> >
> > basemap <- leaflet() %>% addProviderTiles("CartoDB.Positron")
> >
> > basemap %>% addPolygons(data=FJI_Adm_2)
> >
> > # to change the colors/line weight
> > basemap %>% addPolygons(data=FJI_Adm_2, color = "red",
> >                         weight = 1, fillOpacity = 0.2)
> >
> >
> > # If you want to add points as well
> > basemap %>% addPolygons(data=FJI_Adm_2, weight = 2,
> >                         popup = FJI_Adm_2$NAME_2) %>%
> >
> >   addCircleMarkers(data=data.df_SPDF,
> >                    color="red", radius = 2)
> >
> > library(wesanderson) # for a nice color palette
> > colorPal <- colorNumeric(wes_palette("Zissou1")[1:5],
> > data.df_SPDF$Year, n = 5)
> >
> >
> > # colorPal is now a function you can apply to get the corresponding
> > # color for a value
> > colorPal(0.6)
> >
> > basemap %>% addPolygons(data=FJI_Adm_1, weight = 2, fillOpacity=0,
> >                         popup = FJI_Adm_1$NAME_1) %>%
> >
> >   addCircleMarkers(data=data.df_SPDF,
> >                    color = colorPal(data.df$Year),
> >                    radius = 2,
> >                    popup = as.character(data.df$Year))%>%
> >
> >   addLegend(pal = colorPal,
> >             title = "Average Temp for Year",
> >             values = data.df_SPDF$Year)
> >
> >
> >
> >
> *************************************************************************************************
> >
> > Thanking you in advance
> > sownalc
>
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> https://orcid.org/0000-0002-1128-1325
>
>

	[[alternative HTML version deleted]]


From t@v|b@r @end|ng |rom gm@||@com  Sun May 15 17:15:11 2022
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Sun, 15 May 2022 18:15:11 +0300
Subject: [R-sig-Geo] Shapefile and Basemap
In-Reply-To: <CAH5tCz0oBsZLZSZ8WBAUcdBR4t9_uWawNnt1TdPP_SQDjtwTtg@mail.gmail.com>
References: <CAH5tCz28aaOcO9KDYby97sA6KpbVXAZyCA6v8QMzKD5t7_ctRQ@mail.gmail.com>
 <49649c45-49ed-1a47-0cb4-88b3ba57a3af@gmail.com>
 <CAH5tCz0oBsZLZSZ8WBAUcdBR4t9_uWawNnt1TdPP_SQDjtwTtg@mail.gmail.com>
Message-ID: <0ddb79de-8f46-59f4-9ffe-dcbc2af69f5b@gmail.com>


On 5/15/22 03:52, sownal chand wrote:
> Hi Micha,
>
> Thanks for?your email and really appreciate your assistance.
>
> I see that there are alot of old versions of information on the net 
> with spatial analysis using R. I would like to request if you have any 
> particular site or reading materials for spatial analysis and 
> modelling in regards to R programming would really help.
>

One of the best online sources (in my opinion) is the book by Robin 
Lovelace "Geocomputation with R":

https://geocompr.robinlovelace.net/


Here's a good explanation of all the changes in the R-spatial packages, 
and why those changes were necessary:

https://r-spatial.org/r/2022/04/12/evolution.html


If you're following tutorials that depend on any of the packages: `sp`, 
`raster`, `rgdal`, then you should be aware that these will soon be 
deprecated and your procedure will not work in a year or so.

(Authors of those tutorials will have to revise them...)


Good luck



> Once again, thanking you in advance
> Kind?regards
> Sownalc
>
> On Sun, May 15, 2022, 03:50 Micha Silver <tsvibar at gmail.com> wrote:
>
>     Hello
>
>
>     On 5/13/22 12:47, sownal chand wrote:
>     > Hello sir/madam,
>     >
>     > I am working with shape file of my country and the issue I am
>     facing
>     > is the shapefile is scattered while plotting it using basemap. I am
>     > using my sample point data which is attached to this email. I hope
>     > that some expert in this area would help in correcting the codes
>     below
>     > to show the shapefile in one location ( its a pacific centered map)
>
>
>     When you raised this question a few weeks ago, it was suggested to
>     avoid
>     the `sp` package with its SPDF data type, and instead focus on the
>     newer
>     `sf` package.
>
>     There is also a replacement for the raster::getData function in
>     the new
>     `geodata` package.
>
>
>     Here is a much simpler version of what (I think) you are trying to
>     achieve:
>
>
>     # Load only three libraries
>
>     library(sf)
>     library(tmap)
>     library(geodata)
>
>
>     # Read your list of data (You should remove the summary line in
>     advance...)
>
>     dt <- read.csv("DataR.csv")
>     dt <- dt[complete.cases(dt),]
>     dt_sf <- st_as_sf(dt, coords=c("long", "lat"),
>     ?????????????????? crs="EPSG:4326")
>     str(dt_sf)
>
>     # Get Fiji boundary from geodata package
>     fiji <- gadm(country="FIJI", level=2, path=tempdir())
>     # Convert to sf object for tmap plotting
>     fiji <- st_as_sf(fiji)
>
>
>     # Visualize with tmap
>
>     tmap_mode("view")
>     tm_basemap("OpenStreetMap.Mapnik") +
>     ???????? tm_shape(fiji) +
>     ???????? tm_borders(col="brown", lwd=2) +
>     ???????? tm_shape(dt_sf) +
>
>     ???? ??? # size of symbols by yearly data. You can choose any
>     year, of
>     course
>
>     ???????? tm_symbols(col="blue", size="Year2", scale=0.1)
>
>
>
>     If you have a specific problem with a certain shapefile, you'll
>     have to
>     supply it to the list in order to get further help.
>
>
>     HTH
>
>
>     >
>     >
>     **************************************************************************************************
>     >
>     >
>     > library(sp)
>     > library(raster)
>     > library(rgdal)
>     > library(leaflet)
>     >
>     > #read.csv
>     > read.csv ("C://Users/Documents/data.csv") -> data.df
>     > head(data.df)
>     >
>     > hist(data.df$Year, breaks=20)
>     >
>     > #remove NA valuues in the spatial Data Frame
>     > data.df <- na.omit(data.df)
>     > View(data.df)
>     >
>     > plot(data.df$long, data.df$lat,
>     > ? ? ?ylab = "Latitude", xlab="Longitude") #boring!
>     >
>     > # Use the cex function to plot circle size as a function of a
>     variable
>     > plot(data.df$long, data.df$lat,
>     > ? ? ?cex = data.df$Year.7 * 0.045,
>     > ? ? ?ylab = "Latitude", xlab="Longitude")
>     >
>     > data.df_SPDF <- SpatialPointsDataFrame(coords = data.df[,c("long",
>     > "lat")],
>     > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? data =
>     > data.df[,c("Year", "Year.1", "Year.2","Year.3","Year.4")],
>     > proj4string =
>     > CRS("+init=epsg:4326")) # sets the projection to WGS 1984 using
>     > lat/long. Optional but good to specify
>     >
>     > # Summary of object
>     > data.df_SPDF
>     >
>     > # SPDFs partition data elements, e.g. the coordinates are stored
>     > separately from the data
>     > head(data.df_SPDF at coords)
>     >
>     > head(data.df_SPDF at data)
>     >
>     >
>     > # You can quickly access the data frame as per a standard data
>     frame, e.g.
>     > head(data.df_SPDF$Year)
>     >
>     >
>     > # You can use the plot or spplot function to get quick plots
>     > plot(data.df_SPDF)
>     >
>     > spplot(data.df_SPDF, zcol = "Year")
>     >
>     > FIJ_Adm_2 <- readOGR("FIJ_Adm_2_shapefile", "FIJ_Adm_2")
>     >
>     > # You first need the ISO3 codes for the country of interest.
>     >
>     > # The getData function then allows you to retrieve the relevant
>     admin
>     > level boundaries from GADM.
>     > FJI_Adm_2 <- raster::getData("GADM", country="FJI", level=2)
>     >
>     > # Plot both country and data points
>     > plot(FJI_Adm_2)
>     > points(data.df$long, data.df$lat,
>     > ? ? ? ?cex = data.df$Year * 0.045,
>     > ? ? ? ?ylab = "Latitude", xlab="Longitude",
>     > ? ? ? ?col="red")
>     >
>     > basemap <- leaflet() %>% addProviderTiles("CartoDB.Positron")
>     >
>     > basemap %>% addPolygons(data=FJI_Adm_2)
>     >
>     > # to change the colors/line weight
>     > basemap %>% addPolygons(data=FJI_Adm_2, color = "red",
>     > ? ? ? ? ? ? ? ? ? ? ? ? weight = 1, fillOpacity = 0.2)
>     >
>     >
>     > # If you want to add points as well
>     > basemap %>% addPolygons(data=FJI_Adm_2, weight = 2,
>     > ? ? ? ? ? ? ? ? ? ? ? ? popup = FJI_Adm_2$NAME_2) %>%
>     >
>     > ? addCircleMarkers(data=data.df_SPDF,
>     > ? ? ? ? ? ? ? ? ? ?color="red", radius = 2)
>     >
>     > library(wesanderson) # for a nice color palette
>     > colorPal <- colorNumeric(wes_palette("Zissou1")[1:5],
>     > data.df_SPDF$Year, n = 5)
>     >
>     >
>     > # colorPal is now a function you can apply to get the corresponding
>     > # color for a value
>     > colorPal(0.6)
>     >
>     > basemap %>% addPolygons(data=FJI_Adm_1, weight = 2, fillOpacity=0,
>     > ? ? ? ? ? ? ? ? ? ? ? ? popup = FJI_Adm_1$NAME_1) %>%
>     >
>     > ? addCircleMarkers(data=data.df_SPDF,
>     > ? ? ? ? ? ? ? ? ? ?color = colorPal(data.df$Year),
>     > ? ? ? ? ? ? ? ? ? ?radius = 2,
>     > ? ? ? ? ? ? ? ? ? ?popup = as.character(data.df$Year))%>%
>     >
>     > ? addLegend(pal = colorPal,
>     > ? ? ? ? ? ? title = "Average Temp for Year",
>     > ? ? ? ? ? ? values = data.df_SPDF$Year)
>     >
>     >
>     >
>     >
>     *************************************************************************************************
>     >
>     > Thanking you in advance
>     > sownalc
>
>     -- 
>     Micha Silver
>     Ben Gurion Univ.
>     Sde Boker, Remote Sensing Lab
>     cell: +972-523-665918
>     https://orcid.org/0000-0002-1128-1325
>
-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325


From @own@|ch@nd|m@ @end|ng |rom gm@||@com  Sun May 15 18:54:42 2022
From: @own@|ch@nd|m@ @end|ng |rom gm@||@com (sownal chand)
Date: Mon, 16 May 2022 04:54:42 +1200
Subject: [R-sig-Geo] Shapefile and Basemap
In-Reply-To: <0ddb79de-8f46-59f4-9ffe-dcbc2af69f5b@gmail.com>
References: <CAH5tCz28aaOcO9KDYby97sA6KpbVXAZyCA6v8QMzKD5t7_ctRQ@mail.gmail.com>
 <49649c45-49ed-1a47-0cb4-88b3ba57a3af@gmail.com>
 <CAH5tCz0oBsZLZSZ8WBAUcdBR4t9_uWawNnt1TdPP_SQDjtwTtg@mail.gmail.com>
 <0ddb79de-8f46-59f4-9ffe-dcbc2af69f5b@gmail.com>
Message-ID: <CAH5tCz0bT3wU2JqD8Nw73mq9+qSKfF1RYyR7TtJO6wC76p6K-A@mail.gmail.com>

Hi Micha

Thanks a lot for your assistance.

Have a blessed day
Sownalc

On Mon, May 16, 2022, 03:15 Micha Silver <tsvibar at gmail.com> wrote:

>
> On 5/15/22 03:52, sownal chand wrote:
> > Hi Micha,
> >
> > Thanks for your email and really appreciate your assistance.
> >
> > I see that there are alot of old versions of information on the net
> > with spatial analysis using R. I would like to request if you have any
> > particular site or reading materials for spatial analysis and
> > modelling in regards to R programming would really help.
> >
>
> One of the best online sources (in my opinion) is the book by Robin
> Lovelace "Geocomputation with R":
>
> https://geocompr.robinlovelace.net/
>
>
> Here's a good explanation of all the changes in the R-spatial packages,
> and why those changes were necessary:
>
> https://r-spatial.org/r/2022/04/12/evolution.html
>
>
> If you're following tutorials that depend on any of the packages: `sp`,
> `raster`, `rgdal`, then you should be aware that these will soon be
> deprecated and your procedure will not work in a year or so.
>
> (Authors of those tutorials will have to revise them...)
>
>
> Good luck
>
>
>
> > Once again, thanking you in advance
> > Kind regards
> > Sownalc
> >
> > On Sun, May 15, 2022, 03:50 Micha Silver <tsvibar at gmail.com> wrote:
> >
> >     Hello
> >
> >
> >     On 5/13/22 12:47, sownal chand wrote:
> >     > Hello sir/madam,
> >     >
> >     > I am working with shape file of my country and the issue I am
> >     facing
> >     > is the shapefile is scattered while plotting it using basemap. I am
> >     > using my sample point data which is attached to this email. I hope
> >     > that some expert in this area would help in correcting the codes
> >     below
> >     > to show the shapefile in one location ( its a pacific centered map)
> >
> >
> >     When you raised this question a few weeks ago, it was suggested to
> >     avoid
> >     the `sp` package with its SPDF data type, and instead focus on the
> >     newer
> >     `sf` package.
> >
> >     There is also a replacement for the raster::getData function in
> >     the new
> >     `geodata` package.
> >
> >
> >     Here is a much simpler version of what (I think) you are trying to
> >     achieve:
> >
> >
> >     # Load only three libraries
> >
> >     library(sf)
> >     library(tmap)
> >     library(geodata)
> >
> >
> >     # Read your list of data (You should remove the summary line in
> >     advance...)
> >
> >     dt <- read.csv("DataR.csv")
> >     dt <- dt[complete.cases(dt),]
> >     dt_sf <- st_as_sf(dt, coords=c("long", "lat"),
> >                        crs="EPSG:4326")
> >     str(dt_sf)
> >
> >     # Get Fiji boundary from geodata package
> >     fiji <- gadm(country="FIJI", level=2, path=tempdir())
> >     # Convert to sf object for tmap plotting
> >     fiji <- st_as_sf(fiji)
> >
> >
> >     # Visualize with tmap
> >
> >     tmap_mode("view")
> >     tm_basemap("OpenStreetMap.Mapnik") +
> >              tm_shape(fiji) +
> >              tm_borders(col="brown", lwd=2) +
> >              tm_shape(dt_sf) +
> >
> >              # size of symbols by yearly data. You can choose any
> >     year, of
> >     course
> >
> >              tm_symbols(col="blue", size="Year2", scale=0.1)
> >
> >
> >
> >     If you have a specific problem with a certain shapefile, you'll
> >     have to
> >     supply it to the list in order to get further help.
> >
> >
> >     HTH
> >
> >
> >     >
> >     >
> >
>  **************************************************************************************************
> >     >
> >     >
> >     > library(sp)
> >     > library(raster)
> >     > library(rgdal)
> >     > library(leaflet)
> >     >
> >     > #read.csv
> >     > read.csv ("C://Users/Documents/data.csv") -> data.df
> >     > head(data.df)
> >     >
> >     > hist(data.df$Year, breaks=20)
> >     >
> >     > #remove NA valuues in the spatial Data Frame
> >     > data.df <- na.omit(data.df)
> >     > View(data.df)
> >     >
> >     > plot(data.df$long, data.df$lat,
> >     >      ylab = "Latitude", xlab="Longitude") #boring!
> >     >
> >     > # Use the cex function to plot circle size as a function of a
> >     variable
> >     > plot(data.df$long, data.df$lat,
> >     >      cex = data.df$Year.7 * 0.045,
> >     >      ylab = "Latitude", xlab="Longitude")
> >     >
> >     > data.df_SPDF <- SpatialPointsDataFrame(coords = data.df[,c("long",
> >     > "lat")],
> >     >                                                 data =
> >     > data.df[,c("Year", "Year.1", "Year.2","Year.3","Year.4")],
> >     > proj4string =
> >     > CRS("+init=epsg:4326")) # sets the projection to WGS 1984 using
> >     > lat/long. Optional but good to specify
> >     >
> >     > # Summary of object
> >     > data.df_SPDF
> >     >
> >     > # SPDFs partition data elements, e.g. the coordinates are stored
> >     > separately from the data
> >     > head(data.df_SPDF at coords)
> >     >
> >     > head(data.df_SPDF at data)
> >     >
> >     >
> >     > # You can quickly access the data frame as per a standard data
> >     frame, e.g.
> >     > head(data.df_SPDF$Year)
> >     >
> >     >
> >     > # You can use the plot or spplot function to get quick plots
> >     > plot(data.df_SPDF)
> >     >
> >     > spplot(data.df_SPDF, zcol = "Year")
> >     >
> >     > FIJ_Adm_2 <- readOGR("FIJ_Adm_2_shapefile", "FIJ_Adm_2")
> >     >
> >     > # You first need the ISO3 codes for the country of interest.
> >     >
> >     > # The getData function then allows you to retrieve the relevant
> >     admin
> >     > level boundaries from GADM.
> >     > FJI_Adm_2 <- raster::getData("GADM", country="FJI", level=2)
> >     >
> >     > # Plot both country and data points
> >     > plot(FJI_Adm_2)
> >     > points(data.df$long, data.df$lat,
> >     >        cex = data.df$Year * 0.045,
> >     >        ylab = "Latitude", xlab="Longitude",
> >     >        col="red")
> >     >
> >     > basemap <- leaflet() %>% addProviderTiles("CartoDB.Positron")
> >     >
> >     > basemap %>% addPolygons(data=FJI_Adm_2)
> >     >
> >     > # to change the colors/line weight
> >     > basemap %>% addPolygons(data=FJI_Adm_2, color = "red",
> >     >                         weight = 1, fillOpacity = 0.2)
> >     >
> >     >
> >     > # If you want to add points as well
> >     > basemap %>% addPolygons(data=FJI_Adm_2, weight = 2,
> >     >                         popup = FJI_Adm_2$NAME_2) %>%
> >     >
> >     >   addCircleMarkers(data=data.df_SPDF,
> >     >                    color="red", radius = 2)
> >     >
> >     > library(wesanderson) # for a nice color palette
> >     > colorPal <- colorNumeric(wes_palette("Zissou1")[1:5],
> >     > data.df_SPDF$Year, n = 5)
> >     >
> >     >
> >     > # colorPal is now a function you can apply to get the corresponding
> >     > # color for a value
> >     > colorPal(0.6)
> >     >
> >     > basemap %>% addPolygons(data=FJI_Adm_1, weight = 2, fillOpacity=0,
> >     >                         popup = FJI_Adm_1$NAME_1) %>%
> >     >
> >     >   addCircleMarkers(data=data.df_SPDF,
> >     >                    color = colorPal(data.df$Year),
> >     >                    radius = 2,
> >     >                    popup = as.character(data.df$Year))%>%
> >     >
> >     >   addLegend(pal = colorPal,
> >     >             title = "Average Temp for Year",
> >     >             values = data.df_SPDF$Year)
> >     >
> >     >
> >     >
> >     >
> >
>  *************************************************************************************************
> >     >
> >     > Thanking you in advance
> >     > sownalc
> >
> >     --
> >     Micha Silver
> >     Ben Gurion Univ.
> >     Sde Boker, Remote Sensing Lab
> >     cell: +972-523-665918
> >     https://orcid.org/0000-0002-1128-1325
> >
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> https://orcid.org/0000-0002-1128-1325
>
>

	[[alternative HTML version deleted]]


From p@|@ween|nk @end|ng |rom out|ook@com  Wed May 18 11:33:07 2022
From: p@|@ween|nk @end|ng |rom out|ook@com (Philibert Weenink)
Date: Wed, 18 May 2022 11:33:07 +0200
Subject: [R-sig-Geo] Obtaining covariance matrix from space time variogram
Message-ID: <AM9P190MB11726D168C0DD373DBA7A30BB5D19@AM9P190MB1172.EURP190.PROD.OUTLOOK.COM>

Hi all,

I'm trying to obtain a full covariance matrix for a STIDF object
(spacetime library).
I use the vgmST function from gstat to specify a functional form based
on regression residuals of a subset.

While the krigeST function provides the option to compute such a full
covariance matrix, this only works for global kriging.
As this requires a lot of computing power, this is no option for me.
Hence, I am looking for a method to obtain the covariance matrix
directly.

While I found various functions to do so with purely spatial
variograms, this was not the case for space time variograms.
Any help will be appreciated.

Kind regards,
Philibert

Example Script:

#--R-Script--#

library(sp)
library(spacetime)
library(gstat)
data(air)

suppressWarnings(proj4string(stations) <- CRS(proj4string(stations)))
rural = STFDF(stations, dates, data.frame(PM10 = as.vector(air)))
rr <- rural[,"2005-06-01/2005-09-01"]
rr <- as(rr,"STSDF")

vgram <- variogramST(formula = PM10 ~ 1, data = rr, tunit = "days",
tlags = seq(0,3,1), cutoff = 500, cores = 7)

sumMetricVgm <- vgmST("sumMetric",
                      space = vgm( 8.5, "Exp", 196.6,  3),
                      time  = vgm( 25, "Sph",   1.1,  2),
                      joint = vgm(5, "Exp", 136.6, 12),
                      stAni = 51.7)

VAR <- fit.StVariogram(vgram, sumMetricVgm,
                       lower = c(0,0,0,0,0,0,0,0,0,0),,
                       method="L-BFGS-B",
                       fit.method = 7)
plot(vgram,VAR, all = TRUE)

#Thus far I have tried the krige method, but this is not an option as
the newdata contains a larger set.
kr <- krigeST(PM10 ~ 1, data = rr, newdata = rr, VAR, computeVar =
TRUE, fullCovariance = TRUE)

#While the local kriging option is computably feasable it does not
provide full covariance matrices.
lkr <- krigeST(PM10 ~ 1, data = rr, newdata = rural, VAR, nmax = 10,
computeVar = TRUE, fullCovariance = TRUE)

#--R-Script--#


From edzer@pebe@m@ @end|ng |rom un|-muen@ter@de  Wed May 18 12:11:02 2022
From: edzer@pebe@m@ @end|ng |rom un|-muen@ter@de (Edzer Pebesma)
Date: Wed, 18 May 2022 12:11:02 +0200
Subject: [R-sig-Geo] 
 Obtaining covariance matrix from space time variogram
In-Reply-To: <AM9P190MB11726D168C0DD373DBA7A30BB5D19@AM9P190MB1172.EURP190.PROD.OUTLOOK.COM>
References: <AM9P190MB11726D168C0DD373DBA7A30BB5D19@AM9P190MB1172.EURP190.PROD.OUTLOOK.COM>
Message-ID: <66a2fe9f-7428-dad9-2446-ca21dced2468@uni-muenster.de>

You can reduce your global problem to a smaller, local problem and get 
it, or you can modify the code of krigeST to save the covariance matrix 
e.g. to your global environment using <<- or assign().

In local kriging the covariance matrix is a thing that you compute and 
then abandon, so there's little point in the function making it 
available to users.

On 18/05/2022 11:33, Philibert Weenink wrote:
> Hi all,
> 
> I'm trying to obtain a full covariance matrix for a STIDF object
> (spacetime library).
> I use the vgmST function from gstat to specify a functional form based
> on regression residuals of a subset.
> 
> While the krigeST function provides the option to compute such a full
> covariance matrix, this only works for global kriging.
> As this requires a lot of computing power, this is no option for me.
> Hence, I am looking for a method to obtain the covariance matrix
> directly.
> 
> While I found various functions to do so with purely spatial
> variograms, this was not the case for space time variograms.
> Any help will be appreciated.
> 
> Kind regards,
> Philibert
> 
> Example Script:
> 
> #--R-Script--#
> 
> library(sp)
> library(spacetime)
> library(gstat)
> data(air)
> 
> suppressWarnings(proj4string(stations) <- CRS(proj4string(stations)))
> rural = STFDF(stations, dates, data.frame(PM10 = as.vector(air)))
> rr <- rural[,"2005-06-01/2005-09-01"]
> rr <- as(rr,"STSDF")
> 
> vgram <- variogramST(formula = PM10 ~ 1, data = rr, tunit = "days",
> tlags = seq(0,3,1), cutoff = 500, cores = 7)
> 
> sumMetricVgm <- vgmST("sumMetric",
>                        space = vgm( 8.5, "Exp", 196.6,  3),
>                        time  = vgm( 25, "Sph",   1.1,  2),
>                        joint = vgm(5, "Exp", 136.6, 12),
>                        stAni = 51.7)
> 
> VAR <- fit.StVariogram(vgram, sumMetricVgm,
>                         lower = c(0,0,0,0,0,0,0,0,0,0),,
>                         method="L-BFGS-B",
>                         fit.method = 7)
> plot(vgram,VAR, all = TRUE)
> 
> #Thus far I have tried the krige method, but this is not an option as
> the newdata contains a larger set.
> kr <- krigeST(PM10 ~ 1, data = rr, newdata = rr, VAR, computeVar =
> TRUE, fullCovariance = TRUE)
> 
> #While the local kriging option is computably feasable it does not
> provide full covariance matrices.
> lkr <- krigeST(PM10 ~ 1, data = rr, newdata = rural, VAR, nmax = 10,
> computeVar = TRUE, fullCovariance = TRUE)
> 
> #--R-Script--#
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics
Heisenbergstrasse 2, 48151 Muenster, Germany
Phone: +49 251 8333081


From @@j@|@r|m@ne@h @end|ng |rom gm@||@com  Sat May 21 12:29:37 2022
From: @@j@|@r|m@ne@h @end|ng |rom gm@||@com (Ahoura Jafarimanesh)
Date: Sat, 21 May 2022 12:29:37 +0200
Subject: [R-sig-Geo] Unscribe requrest
Message-ID: <CAKKT74_6DzdGDEi7nvzvqu-7Lw4TnZrgFzVU+3F2ztbj1ckZPw@mail.gmail.com>

Dear Sir or Madam,

Is it kindly possible that you Unsubscribe my email from your mailing list?
I tried to do it via the link provided and asked for the password therefore
not successful.

Thank you and kind regards,

Emaili: A.jafarimanesh at gmail.com

Jafarimanesh

	[[alternative HTML version deleted]]


From g||berto@c@m@r@@|npe @end|ng |rom gm@||@com  Sat May 21 21:29:31 2022
From: g||berto@c@m@r@@|npe @end|ng |rom gm@||@com (GilbertoCamara)
Date: Sat, 21 May 2022 16:29:31 -0300
Subject: [R-sig-Geo] Release of SITS version 1.0.0
Message-ID: <846D5770-03F5-4726-B9E4-E3E2F935B0B3@inpe.br>

Dear R-SIG-GEO list members,

I would like to inform you that the ?sits? open source R package version 1.0.0 has been accepted in CRAN. 

?sits? is a package for satellite image time series analysis using machine learning that works with big image collections available in cloud services. Users can perform the full cycle of land user and land cover classification: 

1. Select an image collection available on cloud providers AWS, Microsoft Planetary Computer, Digital Earth Africa and Brazil Data Cube. 
2. Build a regular data cube using analysis-ready image collections.
3. Extract labelled time series from data cubes to be used as training samples.
4. Perform quality control using self-organised maps.
5. Filtering time series samples for noise reduction.
6. Use the samples to train machine learning models.
7. Tune machine learning models for improved accuracy.
8. Classify data cubes using machine learning models.
9. Post-process classified images with Bayesian smoothing to remove outliers. 
10. Estimate uncertainty values of classified images.
11. Evaluate classification accuracy using best practices.
12. Improve results with active learning and self-supervised learning methods.

The package is equivalent to Google Earth Engine for land classification, plus some functions not available in the standard GEE API (sample quality analysis using SOM, time series deep learning methods, model tuning, uncertainty measures, active learning and self-supervised learning). The library has been developed since 2016 and has now reached TRL 8 status, being currently used in Brazil for classification of the Amazonia and Cerrado biomes.

Our work relies on many important contributions for the R-SIG-GEO community. Many thanks to Edzer Pebesma for ?sf? and ?stars?, Robert Hijmans for ?terra?, Marius Appel for ?gdalcubes?, Tim Appelhans for ?leafem?, Victor Maus for ?dtwSat?. We are also indebted to the RStudio team for the ?tidyverse?, to Daniel Falbel for ?torch? and ?luz?, and to Dirk Eddelbuettel for ?Rcpp? and ?RcppArmadillo?. A big round of appreciation goes to Roger Bivand, who put us the Right path 20 years ago. 

?Sits? can be found on GitHub at "https://github.com/e-sensing/sits? and documentation in "https://e-sensing.github.io/sitsbook/?. 

Best regards
Gilberto
============================
Prof Dr Gilberto Camara
Senior Researcher
National Institute for Space Research (INPE), Brazil
https://gilbertocamara.org/
=============================


From r@turner @end|ng |rom @uck|@nd@@c@nz  Sun May 22 04:17:20 2022
From: r@turner @end|ng |rom @uck|@nd@@c@nz (Rolf Turner)
Date: Sun, 22 May 2022 14:17:20 +1200
Subject: [R-sig-Geo] Unscribe requrest
In-Reply-To: <CAKKT74_6DzdGDEi7nvzvqu-7Lw4TnZrgFzVU+3F2ztbj1ckZPw@mail.gmail.com>
References: <CAKKT74_6DzdGDEi7nvzvqu-7Lw4TnZrgFzVU+3F2ztbj1ckZPw@mail.gmail.com>
Message-ID: <20220522141720.528c4105@rolf-Latitude-E7470>

On Sat, 21 May 2022 12:29:37 +0200
Ahoura Jafarimanesh <a.jafarimanesh at gmail.com> wrote:

> Dear Sir or Madam,
> 
> Is it kindly possible that you Unsubscribe my email from your mailing
> list? I tried to do it via the link provided and asked for the
> password therefore not successful.

Read what the link says: "If you just want to unsubscribe from this
list, click on the Unsubscribe button and a confirmation message will
be sent to you."

cheers,

Rolf Turner

-- 
Honorary Research Fellow
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From @erv|ce @end|ng |rom @hd@w@on@com  Sat May 28 18:06:27 2022
From: @erv|ce @end|ng |rom @hd@w@on@com (Stephen H. Dawson, DSL)
Date: Sat, 28 May 2022 12:06:27 -0400
Subject: [R-sig-Geo] Fwd: [R] Circular Graph Recommendation Request
In-Reply-To: <7ca11ada-1f0e-c52b-8173-76851f0a51bd@shdawson.com>
References: <7ca11ada-1f0e-c52b-8173-76851f0a51bd@shdawson.com>
Message-ID: <17e526fa-7c25-8b69-58ca-41271fcedf0c@shdawson.com>

Hi,


First post to the group.

Writing today as part of the message dialogue listed below.

Any circular graph recommendations to share?


Thank You,
*Stephen Dawson, DSL*
/Executive Strategy Consultant/
Business & Technology
+1 (865) 804-3454
http://www.shdawson.com




-------- Forwarded Message --------
Subject: 	Re: [R] Circular Graph Recommendation Request
Date: 	Sat, 28 May 2022 12:01:19 -0400
From: 	Stephen H. Dawson, DSL <service at shdawson.com>
Reply-To: 	service at shdawson.com
Organization: 	SH Dawson
To: 	Bert Gunter <bgunter.4567 at gmail.com>
CC: 	r-help <r-help at r-project.org>



Thanks, Bert. Will do.


Kindest Regards,
*Stephen Dawson, DSL*
/Executive Strategy Consultant/
Business & Technology
+1 (865) 804-3454
http://www.shdawson.com


On 5/28/22 11:55, Bert Gunter wrote:
> Very nice plot. Thanks for sharing.
> Can't help directly, but as the plot is sort of a map with polygonal
> areas encoding the value of a variable, you might try posting on
> r-sig-geo instead where there might be more relevant expertise in such
>   things -- or perhaps suggestions for alternative visualizations that
> work similarly.
>
> Bert Gunter
>
> "The trouble with having an open mind is that people keep coming along
> and sticking things into it."
> -- Opus (aka Berkeley Breathed in his "Bloom County" comic strip )
>
> On Sat, May 28, 2022 at 8:39 AM Stephen H. Dawson, DSL via R-help
> <r-help at r-project.org>  wrote:
>> https://www.visualcapitalist.com/us-goods-exports-by-state/
>> Visualizing U.S. Exports by State
>>
>> Good Morning,
>>
>>
>> https://www.visualcapitalist.com/wp-content/uploads/2022/05/us-exports-by-state-infographic.jpg
>>
>> Saw an impressive graph today. Sharing with the list.
>>
>> The size proportionality of the state segments in a circle graph is catchy.
>>
>> QUESTION
>> Is there a package one could use with R to accomplish this particular
>> circular-style graph?
>>
>>
>> Kindest Regards,
>> --
>> *Stephen Dawson, DSL*
>> /Executive Strategy Consultant/
>> Business & Technology
>> +1 (865) 804-3454
>> http://www.shdawson.com
>>
>> ______________________________________________
>> R-help at r-project.org  mailing list -- To UNSUBSCRIBE and more, see
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guidehttp://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.


From rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u  Mon May 30 08:50:54 2022
From: rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u (Roozbeh Valavi)
Date: Mon, 30 May 2022 16:50:54 +1000
Subject: [R-sig-Geo] terra/GDAL error reading file from http inside docker
 container
Message-ID: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>

Hi all,

I try to read raster files using a URL from within a docker container.
I can easily read the same file with terra package from my system (both
Windows and Ubuntu), but when try reading the same file within a docker
container it runs to an error.

*The  R code for reading the raster file hosted on a public AWS S3 bucket.*

terra::rast("
https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
")

*Error:*
Error: [rast] cannot open file:
https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
In addition: Warning message:
An error occurred while creating a virtual connection to the DAP
server:Error while reading the URL:
https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif.ver
.
The OPeNDAP server returned the following message:
Not Found: The data source or server could not be found.
        Often this means that the OPeNDAP server is missing or needs
attention.
        Please contact the server administrator. (GDAL error 1)


*System info of docker container:*
R version 4.2.0
GDAL 3.0.4
terra 1.5.21
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=20.04
DISTRIB_CODENAME=focal
DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"

* libgdal-dev* is installed in the docker container.

*System info of my local system:*
R version 4.2.0
GDAL 3.3.2
terra 1.5.21
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=20.04
DISTRIB_CODENAME=focal
DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"

I appreciate any help.

Kind regards,
Roozbeh

Roozbeh Valavi
The Quantitative & Applied Ecology Group <http://qaeco.com/>
School of Ecosystem and Forest Sciences,
The University of Melbourne, VIC 3010, Australia
*Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
*Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*

	[[alternative HTML version deleted]]


From m@tmo@er @end|ng |rom wu@@c@@t  Mon May 30 09:59:20 2022
From: m@tmo@er @end|ng |rom wu@@c@@t (Mathias Moser)
Date: Mon, 30 May 2022 09:59:20 +0200
Subject: [R-sig-Geo] 
 terra/GDAL error reading file from http inside docker container
In-Reply-To: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
References: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
Message-ID: <a31f61369549ed27dab11b581c11a48b1f9e8036.camel@wu.ac.at>

Could be a certificate issue, have you tried replacing https with http in your
link? Or, alternatively set,

> library(terra)
> setGDALconfig("GDAL_HTTP_UNSAFESSL", "YES")

If that does not help, you could start debugging by enabling verbose curl
logging,

> setGDALconfig("CPL_CURL_VERBOSE", "YES")


A list of other possible options is here [1]. setGDALconfig is however not
available in the 1.5.21 version you are using, you need to install dev version
first,

> devtools::install_github("rspatial/terra")

Best wishes,

Mathias

[1] https://trac.osgeo.org/gdal/wiki/ConfigOptions


On Mon, 2022-05-30 at 16:50 +1000, Roozbeh Valavi wrote:
> Hi all,
> 
> I try to read raster files using a URL from within a docker container.
> I can easily read the same file with terra package from my system (both
> Windows and Ubuntu), but when try reading the same file within a docker
> container it runs to an error.
> 
> *The? R code for reading the raster file hosted on a public AWS S3 bucket.*
> 
> terra::rast("
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> ")
> 
> *Error:*
> Error: [rast] cannot open file:
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> In addition: Warning message:
> An error occurred while creating a virtual connection to the DAP
> server:Error while reading the URL:
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif.ver
> .
> The OPeNDAP server returned the following message:
> Not Found: The data source or server could not be found.
> ??????? Often this means that the OPeNDAP server is missing or needs
> attention.
> ??????? Please contact the server administrator. (GDAL error 1)
> 
> 
> *System info of docker container:*
> R version 4.2.0
> GDAL 3.0.4
> terra 1.5.21
> DISTRIB_ID=Ubuntu
> DISTRIB_RELEASE=20.04
> DISTRIB_CODENAME=focal
> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
> 
> * libgdal-dev* is installed in the docker container.
> 
> *System info of my local system:*
> R version 4.2.0
> GDAL 3.3.2
> terra 1.5.21
> DISTRIB_ID=Ubuntu
> DISTRIB_RELEASE=20.04
> DISTRIB_CODENAME=focal
> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
> 
> I appreciate any help.
> 
> Kind regards,
> Roozbeh
> 
> Roozbeh Valavi
> The Quantitative & Applied Ecology Group <http://qaeco.com/>
> School of Ecosystem and Forest Sciences,
> The University of Melbourne, VIC 3010, Australia
> *Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
> *Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*
> 
> ????????[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From |eroy@o|| @end|ng |rom gm@||@com  Mon May 30 10:09:56 2022
From: |eroy@o|| @end|ng |rom gm@||@com (Olivier Leroy)
Date: Mon, 30 May 2022 10:09:56 +0200
Subject: [R-sig-Geo] 
 terra/GDAL error reading file from http inside docker container
In-Reply-To: <a31f61369549ed27dab11b581c11a48b1f9e8036.camel@wu.ac.at>
References: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
 <a31f61369549ed27dab11b581c11a48b1f9e8036.camel@wu.ac.at>
Message-ID: <CAO4YiaDNuiRDiMDGXU4KPKMP=4VNMCmC=8r8F4-jKkzR2Zvsvg@mail.gmail.com>

Hello,

I had some trouble with the web and docker in my university because we are
still using proxies (it needs to be set up for every image).  It could be
that.

Good luck !


Olivier Leroy

Le lun. 30 mai 2022 ? 09:59, Mathias Moser <matmoser at wu.ac.at> a ?crit :

> Could be a certificate issue, have you tried replacing https with http in
> your
> link? Or, alternatively set,
>
> > library(terra)
> > setGDALconfig("GDAL_HTTP_UNSAFESSL", "YES")
>
> If that does not help, you could start debugging by enabling verbose curl
> logging,
>
> > setGDALconfig("CPL_CURL_VERBOSE", "YES")
>
>
> A list of other possible options is here [1]. setGDALconfig is however not
> available in the 1.5.21 version you are using, you need to install dev
> version
> first,
>
> > devtools::install_github("rspatial/terra")
>
> Best wishes,
>
> Mathias
>
> [1] https://trac.osgeo.org/gdal/wiki/ConfigOptions
>
>
> On Mon, 2022-05-30 at 16:50 +1000, Roozbeh Valavi wrote:
> > Hi all,
> >
> > I try to read raster files using a URL from within a docker container.
> > I can easily read the same file with terra package from my system (both
> > Windows and Ubuntu), but when try reading the same file within a docker
> > container it runs to an error.
> >
> > *The  R code for reading the raster file hosted on a public AWS S3
> bucket.*
> >
> > terra::rast("
> >
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> > ")
> >
> > *Error:*
> > Error: [rast] cannot open file:
> >
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> > In addition: Warning message:
> > An error occurred while creating a virtual connection to the DAP
> > server:Error while reading the URL:
> >
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif.ver
> > .
> > The OPeNDAP server returned the following message:
> > Not Found: The data source or server could not be found.
> >         Often this means that the OPeNDAP server is missing or needs
> > attention.
> >         Please contact the server administrator. (GDAL error 1)
> >
> >
> > *System info of docker container:*
> > R version 4.2.0
> > GDAL 3.0.4
> > terra 1.5.21
> > DISTRIB_ID=Ubuntu
> > DISTRIB_RELEASE=20.04
> > DISTRIB_CODENAME=focal
> > DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
> >
> > * libgdal-dev* is installed in the docker container.
> >
> > *System info of my local system:*
> > R version 4.2.0
> > GDAL 3.3.2
> > terra 1.5.21
> > DISTRIB_ID=Ubuntu
> > DISTRIB_RELEASE=20.04
> > DISTRIB_CODENAME=focal
> > DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
> >
> > I appreciate any help.
> >
> > Kind regards,
> > Roozbeh
> >
> > Roozbeh Valavi
> > The Quantitative & Applied Ecology Group <http://qaeco.com/>
> > School of Ecosystem and Forest Sciences,
> > The University of Melbourne, VIC 3010, Australia
> > *Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
> > *Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Olivier Leroy
Docteur G?ographie et Environnement
06.18.37.18.08

	[[alternative HTML version deleted]]


From md@umner @end|ng |rom gm@||@com  Tue May 31 06:20:39 2022
From: md@umner @end|ng |rom gm@||@com (Michael Sumner)
Date: Tue, 31 May 2022 14:20:39 +1000
Subject: [R-sig-Geo] 
 terra/GDAL error reading file from http inside docker container
In-Reply-To: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
References: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
Message-ID: <CAAcGz99JBGGBpmmQAk=taioczYbKVLzgGKToFoPN4SeopmVdgQ@mail.gmail.com>

The opendap part of the message suggests driver conflation, so you can
disable DODS driver or try vsicurl:

terra::rast("/vsicurl/
https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
")

not sure it this works but possibly opts = c("if", "GTiff") or something
like that  to trigger the "initial format" to open.



On Mon, May 30, 2022 at 4:52 PM Roozbeh Valavi <
rvalavi at student.unimelb.edu.au> wrote:

> Hi all,
>
> I try to read raster files using a URL from within a docker container.
> I can easily read the same file with terra package from my system (both
> Windows and Ubuntu), but when try reading the same file within a docker
> container it runs to an error.
>
> *The  R code for reading the raster file hosted on a public AWS S3 bucket.*
>
> terra::rast("
>
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> ")
>
> *Error:*
> Error: [rast] cannot open file:
>
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> In addition: Warning message:
> An error occurred while creating a virtual connection to the DAP
> server:Error while reading the URL:
>
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif.ver
> .
> The OPeNDAP server returned the following message:
> Not Found: The data source or server could not be found.
>         Often this means that the OPeNDAP server is missing or needs
> attention.
>         Please contact the server administrator. (GDAL error 1)
>
>
> *System info of docker container:*
> R version 4.2.0
> GDAL 3.0.4
> terra 1.5.21
> DISTRIB_ID=Ubuntu
> DISTRIB_RELEASE=20.04
> DISTRIB_CODENAME=focal
> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
>
> * libgdal-dev* is installed in the docker container.
>
> *System info of my local system:*
> R version 4.2.0
> GDAL 3.3.2
> terra 1.5.21
> DISTRIB_ID=Ubuntu
> DISTRIB_RELEASE=20.04
> DISTRIB_CODENAME=focal
> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
>
> I appreciate any help.
>
> Kind regards,
> Roozbeh
>
> Roozbeh Valavi
> The Quantitative & Applied Ecology Group <http://qaeco.com/>
> School of Ecosystem and Forest Sciences,
> The University of Melbourne, VIC 3010, Australia
> *Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
> *Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com

	[[alternative HTML version deleted]]


From rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u  Tue May 31 14:06:08 2022
From: rv@|@v| @end|ng |rom @tudent@un|me|b@edu@@u (Roozbeh Valavi)
Date: Tue, 31 May 2022 22:06:08 +1000
Subject: [R-sig-Geo] 
 terra/GDAL error reading file from http inside docker container
In-Reply-To: <CAAcGz99JBGGBpmmQAk=taioczYbKVLzgGKToFoPN4SeopmVdgQ@mail.gmail.com>
References: <CAH-s5PNLSmiiC-kmJ1VcUbt7WBsj-OCPR4E9ButLoF+-2uBN2Q@mail.gmail.com>
 <CAAcGz99JBGGBpmmQAk=taioczYbKVLzgGKToFoPN4SeopmVdgQ@mail.gmail.com>
Message-ID: <CAH-s5PO_7KBjj0kmv3YdTQez4b_ssd9gwdUaR1wOx+F95OOYZw@mail.gmail.com>

Thanks Michael! I tried /vsicurl/ based on a previous comment of yours in
rspatial/raster issues but it didn't work.


Roozbeh Valavi
The Quantitative & Applied Ecology Group <http://qaeco.com/>
School of Ecosystem and Forest Sciences,
The University of Melbourne, VIC 3010, Australia
*Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
*Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*


On Tue, May 31, 2022 at 2:20 PM Michael Sumner <mdsumner at gmail.com> wrote:

> The opendap part of the message suggests driver conflation, so you can
> disable DODS driver or try vsicurl:
>
> terra::rast("/vsicurl/
> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
> ")
>
> not sure it this works but possibly opts = c("if", "GTiff") or something
> like that  to trigger the "initial format" to open.
>
>
>
> On Mon, May 30, 2022 at 4:52 PM Roozbeh Valavi <
> rvalavi at student.unimelb.edu.au> wrote:
>
>> Hi all,
>>
>> I try to read raster files using a URL from within a docker container.
>> I can easily read the same file with terra package from my system (both
>> Windows and Ubuntu), but when try reading the same file within a docker
>> container it runs to an error.
>>
>> *The  R code for reading the raster file hosted on a public AWS S3
>> bucket.*
>>
>> terra::rast("
>>
>> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
>> ")
>>
>> *Error:*
>> Error: [rast] cannot open file:
>>
>> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif
>> In addition: Warning message:
>> An error occurred while creating a virtual connection to the DAP
>> server:Error while reading the URL:
>>
>> https://s3-ap-southeast-2.amazonaws.com/silo-open-data/daily/max_temp/2018/20180103.max_temp.tif.ver
>> .
>> The OPeNDAP server returned the following message:
>> Not Found: The data source or server could not be found.
>>         Often this means that the OPeNDAP server is missing or needs
>> attention.
>>         Please contact the server administrator. (GDAL error 1)
>>
>>
>> *System info of docker container:*
>> R version 4.2.0
>> GDAL 3.0.4
>> terra 1.5.21
>> DISTRIB_ID=Ubuntu
>> DISTRIB_RELEASE=20.04
>> DISTRIB_CODENAME=focal
>> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
>>
>> * libgdal-dev* is installed in the docker container.
>>
>> *System info of my local system:*
>> R version 4.2.0
>> GDAL 3.3.2
>> terra 1.5.21
>> DISTRIB_ID=Ubuntu
>> DISTRIB_RELEASE=20.04
>> DISTRIB_CODENAME=focal
>> DISTRIB_DESCRIPTION="Ubuntu 20.04.4 LTS"
>>
>> I appreciate any help.
>>
>> Kind regards,
>> Roozbeh
>>
>> Roozbeh Valavi
>> The Quantitative & Applied Ecology Group <http://qaeco.com/>
>> School of Ecosystem and Forest Sciences,
>> The University of Melbourne, VIC 3010, Australia
>> *Mobile*: +61 423 283 238 | *Twitter*: @ValaviRoozbeh |
>> *Researchgate <https://www.researchgate.net/profile/Roozbeh_Valavi>*
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>

	[[alternative HTML version deleted]]


