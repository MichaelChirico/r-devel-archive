From Virgilio.Gomez at uv.es  Mon Oct 13 14:01:08 2003
From: Virgilio.Gomez at uv.es (Virgilio =?ISO-8859-1?Q?G=F3mez?= Rubio)
Date: Mon, 13 Oct 2003 14:01:08 +0200
Subject: [R-sig-Geo] Pre-release of package DCluster available
Message-ID: <1066046467.6737.37.camel@chomsky.estadi.uv.es>

Hi,

I have just put the source code (and a zip file for Window$ users) of
package DCluster in my website:

http://matheron.estadi.uv.es/~virgil/Rpackages/DCluster/

DCluster is a package that contains routines for the detection of
spatial clusters of diseases (Openshaw's GAM, Besag and Newell, 
Kulldorff and Nagarwalla, Stone's Test and others).

A full description can be found here:

http://www.ci.tuwien.ac.at/Conferences/DSC-2003/Proceedings/GomezRubioEtAl.pdf

The purpose of this pre-release is to get feedback from the users. I'm
sure there are still bugs in the code (please, use it with care), so I
hope to debug them from your comments!!

Best regards,

-- 
             Virgilio G?mez Rubio

Grup d'Estad?stica espacial i temporal 
en Epidemiologia i medi ambient 

Dpto. Estad?stica e I. O. - Facultat de Matem?tiques
Avda. Vicent A. Estell?s, 1 - 46100 Burjassot
Valencia - SPAIN

http://matheron.uv.es/~virgil

TLF: 00 34 96 354 43 62 - FAX: 00 34 96 354 47 35



From Roger.Bivand at nhh.no  Mon Oct 13 21:54:58 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 13 Oct 2003 21:54:58 +0200 (CEST)
Subject: [R-sig-Geo] Re: R(D)-COM stat conenctor for ArcGIS
Message-ID: <Pine.LNX.4.44.0310132142270.9477-100000@reclus.nhh.no>

Hi Monica!

On R-help you wrote:

>   I heard about "R(D)-COM Stat connector" for ArcGIS, but i am not 
>     sure what that is. I did a search in the archive but it seems i am 
>     not getting anything back. 
>     can anybody explain me what that is, and where i can find more 
>     info about it? There is any possibility to run R from inside 
> ArcGIS? 
>     there is more than RArcInfo and Shapefile which can import 
> these 
>     kind of files in R environment?
>     Sorry, but i have no clue ;-)

This is the general Stat Connector, which also "works" with ArcGIS VBA. 
The general connector is at:

http://cran.r-project.org/contrib/extra/dcom

not a package. It was mostly written for Excel. There is no reason in
principle why it won't work with ArcGIS, but nothing is just "ready to
run", it involves VBA programming from the ArcGIS side. Try it with Excel
first to get a feel. There will be more discussion on the r-sig-geo list,
I know Virgilio whom you met at the StatGIS03 meeting is interested too,
though none of us know VBA, I think. I'll ask a student at our department,
Helge Astad, to contact you about this too.

Best wishes,

Roger

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From fmh1 at ra.msstate.edu  Tue Oct 14 19:36:02 2003
From: fmh1 at ra.msstate.edu (Frank M. Howell)
Date: Tue, 14 Oct 2003 12:36:02 -0500
Subject: [R-sig-Geo] RE: R-sig-Geo Digest, Vol 2, Issue 1
In-Reply-To: <200310141002.h9EA2nq5020070@stat.math.ethz.ch>
Message-ID: <002e01c39279$a4e7d220$b3811282@THUMPER>

Virgilio:

Thanks for announcing the DCluster library for R. It's a promising new
addition. I downloaded the compiled R library:

http://matheron.estadi.uv.es/~virgil/Rpackages/DCluster/DCluster_0.1_compile
d.zip

and tried to install it in R 1.8.0 in Windows from a "local zip file".
However, the return was that the "description" file could not be read and it
barfed.

"Error in file{file, "r"}: unable to open connection
In addition: Warning message:
Cannot open file 'DCluster_0.1_compiled/DESCRIPTION'"

Could you check this zipfile again just to make sure? I've tried to install
it from two separate Win2K PCs with R 1.8.0.

Thanks!

Frank

--------
Frank M. Howell
Professor of Sociology
Dept. of Sociology, Anthropology, and Social Work
P.O. Box C [Postal Delivery]
324A Etheredge Hall, Hardy Road [Courier Delivery]
Mississippi State University
Mississippi State, MS 39762
662.325.7872 [voice]; 662.325.4060 [fax]
fmh1 at ra.msstate.edu [e-mail]
www.msstate.edu/~fmh1 [webpage]

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of
r-sig-geo-request at stat.math.ethz.ch
Sent: Tuesday, October 14, 2003 5:03 AM
To: r-sig-geo at stat.math.ethz.ch
Subject: R-sig-Geo Digest, Vol 2, Issue 1

Send R-sig-Geo mailing list submissions to
	r-sig-geo at stat.math.ethz.ch

To subscribe or unsubscribe via the World Wide Web, visit
	https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
or, via email, send a message with subject or body 'help' to
	r-sig-geo-request at stat.math.ethz.ch

You can reach the person managing the list at
	r-sig-geo-owner at stat.math.ethz.ch

When replying, please edit your Subject line so it is more specific
than "Re: Contents of R-sig-Geo digest..."



From Virgilio.Gomez at uv.es  Wed Oct 15 21:27:33 2003
From: Virgilio.Gomez at uv.es (Virgilio =?ISO-8859-1?Q?G=F3mez?= Rubio)
Date: Wed, 15 Oct 2003 21:27:33 +0200
Subject: [R-sig-Geo] Windows binaries for DCluster updated
In-Reply-To: <200310151003.h9FA3Vq7002468@stat.math.ethz.ch>
References: <200310151003.h9FA3Vq7002468@stat.math.ethz.ch>
Message-ID: <1066246053.1281.4.camel@chomsky.estadi.uv.es>

Hi,

As Frank M. Howell noticed (and probably other users), the Windows 
binaries for DCluster I put in my web page are not working... I have
compiled the source code
again and know it does. Please, download it again, and sorry for the
inconvenience.

The URL is http://matheron.uv.es/~virgil/Rpackages/DCluster

DCluster is a package that implements some methods for the detection of
spatial clusters of diseases.

Best regards,

Virgilio



From hi_ono2001 at ybb.ne.jp  Wed Oct 15 22:15:47 2003
From: hi_ono2001 at ybb.ne.jp (Hisaji Ono)
Date: Thu, 16 Oct 2003 05:15:47 +0900
Subject: [R-sig-Geo] Windows binaries for DCluster updated
References: <200310151003.h9FA3Vq7002468@stat.math.ethz.ch>
	<1066246053.1281.4.camel@chomsky.estadi.uv.es>
Message-ID: <039901c39359$1f0bdf30$818001db@webgis>

Hi.

 DCluster is very nice tool, especially Stan Openshaw's GAM.

 DCluster's GAM's testing function is different from original GAM whose
testing function used Monte Carlo method.

 Could you tell me how I can execute original GAM using DCluster?

 And can I execute GAM/K using DCluster?

 Regards.

----- Original Message ----- 
From: "Virgilio G仁ez Rubio" <Virgilio.Gomez at uv.es>
To: <r-sig-geo at stat.math.ethz.ch>; <r-help at stat.math.ethz.ch>
Sent: Thursday, October 16, 2003 4:27 AM
Subject: [R-sig-Geo] Windows binaries for DCluster updated


> Hi,
>
> As Frank M. Howell noticed (and probably other users), the Windows
> binaries for DCluster I put in my web page are not working... I have
> compiled the source code
> again and know it does. Please, download it again, and sorry for the
> inconvenience.
>
> The URL is http://matheron.uv.es/~virgil/Rpackages/DCluster
>
> DCluster is a package that implements some methods for the detection of
> spatial clusters of diseases.



From Virgilio.Gomez at uv.es  Wed Oct 15 22:52:48 2003
From: Virgilio.Gomez at uv.es (Virgilio =?ISO-8859-1?Q?G=F3mez?= Rubio)
Date: Wed, 15 Oct 2003 22:52:48 +0200
Subject: [Fwd: Re: [R-sig-Geo] Windows binaries for DCluster updated]
Message-ID: <1066251168.1505.37.camel@chomsky.estadi.uv.es>

Hi,


>  DCluster is very nice tool, especially Stan Openshaw's GAM.

Thank you!

> 
>  DCluster's GAM's testing function is different from original GAM whose
> testing function used Monte Carlo method.
> 
>  Could you tell me how I can execute original GAM using DCluster?

Well, I think you can write your own function to do that and pass it to
opgam as argument 'iscluster'. The default value is
'opgam.iscluster.default':

opgam.iscluster.default<-function (data, idx, idxorder, alpha, ...)
{
    localO <- sum(data$Observed[idx])
    localE <- sum(data$Expected[idx])
    if (localE == 0)
        return(c(localO, NA, NA))
    localP <- sum(data$Population[idx])
    pvalue <- ppois(localO, localE, lower.tail = FALSE)
    return(c(localO, alpha > pvalue, pvalue))
}

What you can do is to change the line where the pvalue is calculated
and, instead of using 'ppois' use a function that performs a Monte Carlo
test. Probably you will not need localR nor localP if you use Monte
Carlo.

So, the function could be simething like:

montecarlo.iscluster<-function(data, idx, idxorder, alpha, ...)
{
	localO <- sum(data$Observed[idx])
	pvalue <- return_pvalue_from_monte_carlo_simulations(data, localO) 
	return(c(localO, alpha > pvalue, pvalue))
}

where 'return_pvalue_from_monte_carlo_simulations' performs the M.C.
simulations and compare localO with the values obtained to compute
the pvalue.

I hope it's clear... if not, just tell me. :D

>  And can I execute GAM/K using DCluster?

Not at the moment, but 'opgam' returns the coordinates of the centres of
the balls that were significant, so I guess that you can use other R
packages to calculate a density from this table.

I have also written some code (not released yet) to calculate how many
times a centroid is included in these circles, in case you are
interested. I know it's not GAM/K but it can be useful for some
purposes...

Best regards,
-- 
             Virgilio G?mez Rubio

Grup d'Estad?stica espacial i temporal 
en Epidemiologia i medi ambient 

Dpto. Estad?stica e I. O. - Facultat de Matem?tiques
Avda. Vicent A. Estell?s, 1 - 46100 Burjassot
Valencia - SPAIN

http://matheron.uv.es/~virgil

TLF: 00 34 96 354 43 62 - FAX: 00 34 96 354 47 35



From Roger.Bivand at nhh.no  Tue Oct 21 15:18:09 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 21 Oct 2003 15:18:09 +0200 (CEST)
Subject: [R-sig-Geo] Re: [R] R and Arcgis through VBA
In-Reply-To: <3F952C51.9080707@univ-lr.fr>
Message-ID: <Pine.LNX.4.44.0310211511450.16119-100000@reclus.nhh.no>

Christophe:

I suggest moving this discussion from r-help to r-sig-geo, there will be a 
higher density of people there who may have had successful experiences. 
There are so many different configuration issues that might impact this, 
that r-help is too broad a forum. I have also CC-ed this to the R(D)COM 
list, which is also relevant. Can you first confirm that you can use the 
StatConnector with say Excel?

Roger

On Tue, 21 Oct 2003, Christophe Saint-Jean wrote:

> Dear R experts,
>   I am trying to use R with Arcgis Desktop 8.1.
>   When i try to add a "StatConnectorGraphicsDevice" control to my form,
> VBA returns an specified error and nothing else.
>   Does anybody has a successful experience with Arcgis and R ?
> Thanks,
> Christophe Saint-Jean.
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://www.stat.math.ethz.ch/mailman/listinfo/r-help
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From cdeclercq at nordnet.fr  Wed Oct 22 16:19:11 2003
From: cdeclercq at nordnet.fr (Christophe Declercq)
Date: Wed, 22 Oct 2003 15:19:11 +0100
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <000a01c3988b$5221f8a0$94a1ed82@dsv.su.se>
Message-ID: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>

Your question is not really clear because:

- I don't know what 'convert.r' do
- I don't know where 'transf.cgm' is (BTW, 'cgm' is not the usual extension
for shapefiles which is 'shp'). Check if it is really in your current
directory.

but, yes, if what you want is to import shapefiles in R, it's easy. Look at
the 'maptools' package on CRAN (there is also a 'shapefiles' package).

And if you want to build an adjacency matrix for a map of polygons (as I
guess from the header of you mail), look at the 'spdep' package, too. It is
then possible to write a text file with your data as a list readable by
WinBUGS.

(I send a copy of my answer to the the R-SIG-GEO mailing list which can be
of interest to you).

Hope it helps.

Christophe
--
Christophe DECLERCQ, MD
Observatoire R?gional de la Sant? Nord-Pas-de-Calais
13, rue Faidherbe 59046 LILLE Cedex FRANCE
Phone +33 3 20 15 49 24
Fax   +33 3 20 55 92 30
E-mail c.declercq at orsnpdc.org



> -----Message d'origine-----
> De : r-help-bounces at stat.math.ethz.ch
> [mailto:r-help-bounces at stat.math.ethz.ch]De la part de Orlando Zacarias
> Envoy? : mercredi 22 octobre 2003 11:58
> ? : r-help at stat.math.ethz.ch
> Objet : [R] adjacency matrix
>
>
> Dear R experts,
> I am new to the list and R software. I need to convert arcview
> file to Winbugs having R has middle package. Got from friends
> that it is possible following the steps:
> 1. Converting arcview shapefile to "cgm clear text file"
> 2. Downloading "convert.r" to into R
>     2.1 use source("convert.r")
>      2.2 convert("filename_cgm") without the extension.
> But that doesn't work, given the following errors:
> ----------------------------
> R : Copyright 2003, The R Development Core Team
> Version 1.8.0  (2003-10-08)
> R is free software and comes with ABSOLUTELY NO WARRANTY.
> You are welcome to redistribute it under certain conditions.
> Type 'license()' or 'licence()' for distribution details.
> R is a collaborative project with many contributors.
> Type 'contributors()' for more information.
> Type 'demo()' for some demos, 'help()' for on-line help, or
> 'help.start()' for a HTML browser interface to help.
> Type 'q()' to quit R.
> [Previously saved workspace restored]
> > source("convert.r")
> > convert("transf")
> Error in file(file, "r") : unable to open connection
> In addition: Warning message:
> cannot open file `transf.cgm'
> >
> -----------------------------------
> Have i done some mistakes?Or i am missing some files?
> Please assist.
> Rgs,
> Orlando.
>
>
>
> 	[[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://www.stat.math.ethz.ch/mailman/listinfo/r-help
>



From anselin at uiuc.edu  Wed Oct 22 16:36:48 2003
From: anselin at uiuc.edu (Luc Anselin)
Date: Wed, 22 Oct 2003 09:36:48 -0500
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>
Message-ID: <2B2056A2-049D-11D8-B2A8-000393C8EF0E@uiuc.edu>

Another alternative would be to use the "Tools" in GeoDa
(free from http://sal.agecon.uiuc.edu/csiss/geoda.html ).
This creates contiguity and distance based sparse weights
files (in ascii format) directly from point and polygon shape
files. The spdep package contains functions to read and
manipulate these weights files. I'm not familiar with the
format used by WinBUGS, but I doubt it can be very different.
L.


On Wednesday, October 22, 2003, at 09:19 AM, Christophe Declercq wrote:

> Your question is not really clear because:
>
> - I don't know what 'convert.r' do
> - I don't know where 'transf.cgm' is (BTW, 'cgm' is not the usual 
> extension
> for shapefiles which is 'shp'). Check if it is really in your current
> directory.
>
> but, yes, if what you want is to import shapefiles in R, it's easy. 
> Look at
> the 'maptools' package on CRAN (there is also a 'shapefiles' package).
>
> And if you want to build an adjacency matrix for a map of polygons (as 
> I
> guess from the header of you mail), look at the 'spdep' package, too. 
> It is
> then possible to write a text file with your data as a list readable by
> WinBUGS.
>
> (I send a copy of my answer to the the R-SIG-GEO mailing list which 
> can be
> of interest to you).
>
> Hope it helps.
>
> Christophe
> --
> Christophe DECLERCQ, MD
> Observatoire R?gional de la Sant? Nord-Pas-de-Calais
> 13, rue Faidherbe 59046 LILLE Cedex FRANCE
> Phone +33 3 20 15 49 24
> Fax   +33 3 20 55 92 30
> E-mail c.declercq at orsnpdc.org
>
>
>
>> -----Message d'origine-----
>> De : r-help-bounces at stat.math.ethz.ch
>> [mailto:r-help-bounces at stat.math.ethz.ch]De la part de Orlando 
>> Zacarias
>> Envoy? : mercredi 22 octobre 2003 11:58
>> ? : r-help at stat.math.ethz.ch
>> Objet : [R] adjacency matrix
>>
>>
>> Dear R experts,
>> I am new to the list and R software. I need to convert arcview
>> file to Winbugs having R has middle package. Got from friends
>> that it is possible following the steps:
>> 1. Converting arcview shapefile to "cgm clear text file"
>> 2. Downloading "convert.r" to into R
>>     2.1 use source("convert.r")
>>      2.2 convert("filename_cgm") without the extension.
>> But that doesn't work, given the following errors:
>> ----------------------------
>> R : Copyright 2003, The R Development Core Team
>> Version 1.8.0  (2003-10-08)
>> R is free software and comes with ABSOLUTELY NO WARRANTY.
>> You are welcome to redistribute it under certain conditions.
>> Type 'license()' or 'licence()' for distribution details.
>> R is a collaborative project with many contributors.
>> Type 'contributors()' for more information.
>> Type 'demo()' for some demos, 'help()' for on-line help, or
>> 'help.start()' for a HTML browser interface to help.
>> Type 'q()' to quit R.
>> [Previously saved workspace restored]
>>> source("convert.r")
>>> convert("transf")
>> Error in file(file, "r") : unable to open connection
>> In addition: Warning message:
>> cannot open file `transf.cgm'
>>>
>> -----------------------------------
>> Have i done some mistakes?Or i am missing some files?
>> Please assist.
>> Rgs,
>> Orlando.
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-help at stat.math.ethz.ch mailing list
>> https://www.stat.math.ethz.ch/mailman/listinfo/r-help
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
>



From Roger.Bivand at nhh.no  Wed Oct 22 18:19:02 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 22 Oct 2003 18:19:02 +0200 (CEST)
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <2B2056A2-049D-11D8-B2A8-000393C8EF0E@uiuc.edu>
Message-ID: <Pine.LNX.4.44.0310221812450.11336-100000@reclus.nhh.no>

On Wed, 22 Oct 2003, Luc Anselin wrote:

> Another alternative would be to use the "Tools" in GeoDa
> (free from http://sal.agecon.uiuc.edu/csiss/geoda.html ).
> This creates contiguity and distance based sparse weights
> files (in ascii format) directly from point and polygon shape
> files. The spdep package contains functions to read and
> manipulate these weights files. I'm not familiar with the
> format used by WinBUGS, but I doubt it can be very different.
> L.

>From links from the web page I googled (convert.r AND cgm), and from the 
GeoBUGS manual, their format can be generated, but looks a bit naive as 
is. We could implement it, and/or talk to the GeoBUGS developers about 
using GeoDa (and maybe R/spdep) as a convenient front end - then they 
would avoid having to generate the weights internally. Since they are 
Windows, and WinBUGS is closed source, GeoDa could be a useful 
pre-processing tool (also for spdep weights).

Roger

> 
> 
> On Wednesday, October 22, 2003, at 09:19 AM, Christophe Declercq wrote:
> 
> > Your question is not really clear because:
> >
> > - I don't know what 'convert.r' do
> > - I don't know where 'transf.cgm' is (BTW, 'cgm' is not the usual 
> > extension
> > for shapefiles which is 'shp'). Check if it is really in your current
> > directory.
> >
> > but, yes, if what you want is to import shapefiles in R, it's easy. 
> > Look at
> > the 'maptools' package on CRAN (there is also a 'shapefiles' package).
> >
> > And if you want to build an adjacency matrix for a map of polygons (as 
> > I
> > guess from the header of you mail), look at the 'spdep' package, too. 
> > It is
> > then possible to write a text file with your data as a list readable by
> > WinBUGS.
> >
> > (I send a copy of my answer to the the R-SIG-GEO mailing list which 
> > can be
> > of interest to you).
> >
> > Hope it helps.
> >
> > Christophe
> > --
> > Christophe DECLERCQ, MD
> > Observatoire R?gional de la Sant? Nord-Pas-de-Calais
> > 13, rue Faidherbe 59046 LILLE Cedex FRANCE
> > Phone +33 3 20 15 49 24
> > Fax   +33 3 20 55 92 30
> > E-mail c.declercq at orsnpdc.org
> >
> >
> >
> >> -----Message d'origine-----
> >> De : r-help-bounces at stat.math.ethz.ch
> >> [mailto:r-help-bounces at stat.math.ethz.ch]De la part de Orlando 
> >> Zacarias
> >> Envoy? : mercredi 22 octobre 2003 11:58
> >> ? : r-help at stat.math.ethz.ch
> >> Objet : [R] adjacency matrix
> >>
> >>
> >> Dear R experts,
> >> I am new to the list and R software. I need to convert arcview
> >> file to Winbugs having R has middle package. Got from friends
> >> that it is possible following the steps:
> >> 1. Converting arcview shapefile to "cgm clear text file"
> >> 2. Downloading "convert.r" to into R
> >>     2.1 use source("convert.r")
> >>      2.2 convert("filename_cgm") without the extension.
> >> But that doesn't work, given the following errors:
> >> ----------------------------
> >> R : Copyright 2003, The R Development Core Team
> >> Version 1.8.0  (2003-10-08)
> >> R is free software and comes with ABSOLUTELY NO WARRANTY.
> >> You are welcome to redistribute it under certain conditions.
> >> Type 'license()' or 'licence()' for distribution details.
> >> R is a collaborative project with many contributors.
> >> Type 'contributors()' for more information.
> >> Type 'demo()' for some demos, 'help()' for on-line help, or
> >> 'help.start()' for a HTML browser interface to help.
> >> Type 'q()' to quit R.
> >> [Previously saved workspace restored]
> >>> source("convert.r")
> >>> convert("transf")
> >> Error in file(file, "r") : unable to open connection
> >> In addition: Warning message:
> >> cannot open file `transf.cgm'
> >>>
> >> -----------------------------------
> >> Have i done some mistakes?Or i am missing some files?
> >> Please assist.
> >> Rgs,
> >> Orlando.
> >>
> >>
> >>
> >> 	[[alternative HTML version deleted]]
> >>
> >> ______________________________________________
> >> R-help at stat.math.ethz.ch mailing list
> >> https://www.stat.math.ethz.ch/mailman/listinfo/r-help
> >>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at stat.math.ethz.ch
> > https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From c.declercq at orsnpdc.org  Thu Oct 23 11:25:18 2003
From: c.declercq at orsnpdc.org (Christophe Declercq)
Date: Thu, 23 Oct 2003 10:25:18 +0100
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <002b01c398c9$c41d5150$38fe0a50@Alfred>
Message-ID: <NGBBKLJCOLPAFMJIEMHCMEDACMAA.c.declercq@orsnpdc.org>

> ----- Original Message -----
> From: "Roger Bivand" <Roger.Bivand at nhh.no>
> To: "Luc Anselin" <anselin at uiuc.edu>
> Cc: <cdeclercq at nordnet.fr>; <r-sig-geo at stat.math.ethz.ch>; "Orlando
> Zacarias" <si-opz at dsv.su.se>
> Sent: Wednesday, October 22, 2003 6:19 PM
> Subject: Re: [R-sig-Geo] RE: [R] adjacency matrix
>
>
> On Wed, 22 Oct 2003, Luc Anselin wrote:
>
> > Another alternative would be to use the "Tools" in GeoDa
> > (free from http://sal.agecon.uiuc.edu/csiss/geoda.html ).
> > This creates contiguity and distance based sparse weights
> > files (in ascii format) directly from point and polygon shape
> > files. The spdep package contains functions to read and
> > manipulate these weights files. I'm not familiar with the
> > format used by WinBUGS, but I doubt it can be very different.
> > L.
>
> >From links from the web page I googled (convert.r AND cgm), and from the
> GeoBUGS manual, their format can be generated, but looks a bit naive as
> is. We could implement it, and/or talk to the GeoBUGS developers about
> using GeoDa (and maybe R/spdep) as a convenient front end - then they
> would avoid having to generate the weights internally. Since they are
> Windows, and WinBUGS is closed source, GeoDa could be a useful
> pre-processing tool (also for spdep weights).

I did not know GeoDa so I will have a look at it.

I'm now working on a project with mortality mapping using smoothing with a
hierarchical Bayes model (the Besag, York and Molli? model) and I'm actually
using R/maptools/spdep as a front end to WinBUGS1.4.

I do all the data preparation for WinBUGS in R, I use the new scripting
facility in WinBUGS1.4 and I get back the samples in R to plot maps of the
estimates with plotpolys(). It works fine for me.

It's easy to get the adjacency data as WinBUGS want them.
Something along the lines of (if 'cantons' is a 'polylist' object):

> cantons.nb<-poly2nb(cantons, bb=cantons.bb) # calculate the neighbourhood
> data<-list(N = length(cantons),
+  O=lungcanc$o, E=lungcanc$e,
+  num=sapply(cantons.nb, length),
+  adj=unlist(cantons.nb),
+  sumNumNeigh=length(unlist(cantons.nb))
+)

Some care is needed in the formating of numbers. I use some of the functions
by Andrew Gelman at http://www.stat.columbia.edu/~gelman/bugsR (a web
appendix to the book Bayesian Data Analysis, Second Edition,  by Andrew
Gelman, Donald B. Rubin, Hal S. Stern) to write the ascii files for WInBUGS.

Christophe
--
Christophe DECLERCQ, MD
Observatoire R?gional de la Sant? Nord-Pas-de-Calais
13, rue Faidherbe 59046 LILLE Cedex FRANCE
Phone +33 3 20 15 49 24
Fax   +33 3 20 55 92 30
E-mail c.declercq at orsnpdc.org



From si-opz at dsv.su.se  Thu Oct 23 10:44:41 2003
From: si-opz at dsv.su.se (Orlando Zacarias)
Date: Thu, 23 Oct 2003 10:44:41 +0200 (W. Europe Daylight Time)
Subject: [R-sig-Geo] RE: [R] adjacency matrix
References: <NGBBKLJCOLPAFMJIEMHCMEDACMAA.c.declercq@orsnpdc.org>
Message-ID: <3F9794F9.000001.00624@sida-opz.dsv.su.se>

Yes. i have managed to create the adjacency matrix in GeoDa. What i am now
struggling with is the map conversion from shapefile format to R, and from R
to WinBugs. Since i am running out of time, have downloaded the maptools and
trying to experiment it for data conversion. Will post you my results. BTW i
am working on malaria mapping adapting the hierarchical Bayes model (the
Besag, York and Molli? model).....
Tanxs all for the help and discussion so far.
Rgs,
Orlando. 

-------Original Message-------

From: c.declercq at orsnpdc.org
Date: 23 October 2003 10:25:20
To: Roger.Bivand at nhh.no
Cc: anselin at uiuc.edu; r-sig-geo at stat.math.ethz.ch; si-opz at dsv.su.se
Subject: RE: [R-sig-Geo] RE: [R] adjacency matrix

> ----- Original Message -----
> From: "Roger Bivand" <Roger.Bivand at nhh.no>
> To: "Luc Anselin" <anselin at uiuc.edu>
> Cc: <cdeclercq at nordnet.fr>; <r-sig-geo at stat.math.ethz.ch>; "Orlando
> Zacarias" <si-opz at dsv.su.se>
> Sent: Wednesday, October 22, 2003 6:19 PM
> Subject: Re: [R-sig-Geo] RE: [R] adjacency matrix
>
>
> On Wed, 22 Oct 2003, Luc Anselin wrote:
>
> > Another alternative would be to use the "Tools" in GeoDa
> > (free from http://sal.agecon.uiuc.edu/csiss/geoda.html ).
> > This creates contiguity and distance based sparse weights
> > files (in ascii format) directly from point and polygon shape
> > files. The spdep package contains functions to read and
> > manipulate these weights files. I'm not familiar with the
> > format used by WinBUGS, but I doubt it can be very different.
> > L.
>
> >From links from the web page I googled (convert.r AND cgm), and from the
> GeoBUGS manual, their format can be generated, but looks a bit naive as
> is. We could implement it, and/or talk to the GeoBUGS developers about
> using GeoDa (and maybe R/spdep) as a convenient front end - then they
> would avoid having to generate the weights internally. Since they are
> Windows, and WinBUGS is closed source, GeoDa could be a useful
> pre-processing tool (also for spdep weights).

I did not know GeoDa so I will have a look at it.

I'm now working on a project with mortality mapping using smoothing with a
hierarchical Bayes model (the Besag, York and Molli? model) and I'm actually
using R/maptools/spdep as a front end to WinBUGS1.4.

I do all the data preparation for WinBUGS in R, I use the new scripting
facility in WinBUGS1.4 and I get back the samples in R to plot maps of the
estimates with plotpolys(). It works fine for me.

It's easy to get the adjacency data as WinBUGS want them.
Something along the lines of (if 'cantons' is a 'polylist' object):

> cantons.nb<-poly2nb(cantons, bb=cantons.bb) # calculate the neighbourhood
> data<-list(N = length(cantons),
+ O=lungcanc$o, E=lungcanc$e,
+ num=sapply(cantons.nb, length),
+ adj=unlist(cantons.nb),
+ sumNumNeigh=length(unlist(cantons.nb))
+)

Some care is needed in the formating of numbers. I use some of the functions
by Andrew Gelman at http://www.stat.columbia.edu/~gelman/bugsR (a web
appendix to the book Bayesian Data Analysis, Second Edition, by Andrew
Gelman, Donald B. Rubin, Hal S. Stern) to write the ascii files for WInBUGS.

Christophe
--
Christophe DECLERCQ, MD
Observatoire R?gional de la Sant? Nord-Pas-de-Calais
13, rue Faidherbe 59046 LILLE Cedex FRANCE
Phone +33 3 20 15 49 24
Fax +33 3 20 55 92 30
E-mail c.declercq at orsnpdc.org



.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/3da73810/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 494 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/3da73810/attachment.gif>

From nikko at hailmail.net  Thu Oct 23 16:47:27 2003
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Thu, 23 Oct 2003 22:47:27 +0800
Subject: [R-sig-Geo] Re: Adjacency matrices
In-Reply-To: <200310231001.h9NA19q6016552@stat.math.ethz.ch>
References: <200310231001.h9NA19q6016552@stat.math.ethz.ch>
Message-ID: <20031023144727.C647B3CE49@www.fastmail.fm>

Hi,
>From the sound of this it is time
to grit my teeth and get the quadtree code working for maptools.
That should translate for a polygon list from Spdep and allow 
calculation of adjacency matrices in R for moderate to large maps.

Oh if I could put time in a bottle ......


Nicholas



From si-opz at dsv.su.se  Thu Oct 23 18:56:43 2003
From: si-opz at dsv.su.se (Orlando Zacarias)
Date: Thu, 23 Oct 2003 18:56:43 +0200 (W. Europe Daylight Time)
Subject: [R-sig-Geo] RE: [R] adjacency matrix
References: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>
Message-ID: <3F98084B.000006.01492@sida-opz.dsv.su.se>


Hi once again,
Now i have been trying to run the R changed example from Maptools package
manual, and errors occur underlined bellow. It is really troublesome....
Please assist,
Orlando.
---------------------------------------------------
shp <- try(library(shapefiles))  
Error in library(maptools) : There is no package called 'shapefiles'
> if (class(shp) != "try-error") {
+ ShapeDir <- system.file("shapes", package="maptools")[1]
+ try1 <- read.shapefile(paste(ShapeDir, "shapes", sep="/"))
+ shppolys <- shape2poly(try1, as.character(try1$dbf$dbf$NEIGNO))
+ plotpolys(shppolys)
+ title(main="Polygons for Vermani from shapefiles package")
+ }
> 
> try2 <- read.shape(system.file("shapes/Vermani.shp",
+ package="maptools/man")[1])
Error: couldn't find function "read.shape"
> mappolys <- Map2poly(try2, as.character(try2$att.data$NEIGNO))
Error: couldn't find function "Map2poly"
> plotpolys(mappolys)
Error: couldn't find function "plotpolys"
> title(main="Polygons for Vermani from maptools package")
Error in title(main = "Polygons for Vermani from maptools package") : 
        plot.new has not been called yet
> if (class(shp) != "try-error") {
+ plotpolys(shppolys)
+ plotpolys(mappolys, add=TRUE, border="red", lty="dotted")
+ title(main="Polygons for Vermani overplotted from both packages")
+ }
------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c5da4174/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 41982 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c5da4174/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1738 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c5da4174/attachment-0001.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 494 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c5da4174/attachment-0002.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 3937 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c5da4174/attachment-0003.gif>

From dray at biomserv.univ-lyon1.fr  Thu Oct 23 19:26:06 2003
From: dray at biomserv.univ-lyon1.fr (Stephane DRAY)
Date: Thu, 23 Oct 2003 13:26:06 -0400
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <3F98084B.000006.01492@sida-opz.dsv.su.se>
References: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>
Message-ID: <5.2.1.1.0.20031023132520.01490b38@biomserv.univ-lyon1.fr>

Have you install the shapefiles library on your computer ??


At 12:56 23/10/2003, Orlando Zacarias wrote:

>a77632.gif
>
>Hi once again,
>Now i have been trying to run the R changed example from Maptools package 
>manual, and errors occur underlined bellow. It is really troublesome....
>Please assist,
>Orlando.
>---------------------------------------------------
>shp <- try(library(shapefiles))
>Error in library(maptools) : There is no package called 'shapefiles'
> > if (class(shp) != "try-error") {
>+ ShapeDir <- system.file("shapes", package="maptools")[1]
>+ try1 <- read.shapefile(paste(ShapeDir, "shapes", sep="/"))
>+ shppolys <- shape2poly(try1, as.character(try1$dbf$dbf$NEIGNO))
>+ plotpolys(shppolys)
>+ title(main="Polygons for Vermani from shapefiles package")
>+ }
> >
> > try2 <- read.shape(system.file("shapes/Vermani.shp",
>+ package="maptools/man")[1])
>Error: couldn't find function "read.shape"
> > mappolys <- Map2poly(try2, as.character(try2$att.data$NEIGNO))
>Error: couldn't find function "Map2poly"
> > plotpolys(mappolys)
>Error: couldn't find function "plotpolys"
> > title(main="Polygons for Vermani from maptools package")
>Error in title(main = "Polygons for Vermani from maptools package") :
>         plot.new has not been called yet
> > if (class(shp) != "try-error") {
>+ plotpolys(shppolys)
>+ plotpolys(mappolys, add=TRUE, border="red", lty="dotted")
>+ title(main="Polygons for Vermani overplotted from both packages")
>+ }
>------------------------------------------------------
>
>a77678.gif
>____________________________________________________
><http://www.incredimail.com/redir.asp?ad_id=309&lang=9>a77683.gif 
>IncrediMail - Email has finally evolved - 
><http://www.incredimail.com/redir.asp?ad_id=309&lang=9>Click Here
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c8518e77/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a77632.gif
Type: image/gif
Size: 41982 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c8518e77/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a77678.gif
Type: image/gif
Size: 1738 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c8518e77/attachment-0001.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: a77683.gif
Type: image/gif
Size: 494 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/c8518e77/attachment-0002.gif>

From danlinyu at uwm.edu  Thu Oct 23 19:42:04 2003
From: danlinyu at uwm.edu (danlinyu at uwm.edu)
Date: Thu, 23 Oct 2003 12:42:04 -0500
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <3F98084B.000006.01492@sida-opz.dsv.su.se>
References: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>
	<3F98084B.000006.01492@sida-opz.dsv.su.se>
Message-ID: <1066930924.3f9812ec22d2b@mail03.imt.uwm.edu>

Hi-
    As far as I know, some of the error messages results from the fact that you

either did not install the package or did not load the package.
    If you did not install the package, you can install from R's GUI (my 
experiences are based on the Windows Version), and load them by type library
(packagename). If you have already installed them, just type library
(packagename) and you will be good to go. For your specific case, after you 
started R, just type library(maptools), and you will be able to use all the 
functions such as read.shape, Map2poly, plotpolys, etc.

Quoting Orlando Zacarias <si-opz at dsv.su.se>:

> 

> Hi once again,

> Now i have been trying to run the R changed example from Maptools package
> manual, and errors occur underlined bellow. It is really troublesome....

> Please assist,

> Orlando.

> ---------------------------------------------------

> shp <- try(library(shapefiles))  

> Error in library(maptools) : There is no package called 'shapefiles'

> > if (class(shp) != "try-error") {

> + ShapeDir <- system.file("shapes", package="maptools")[1]

> + try1 <- read.shapefile(paste(ShapeDir, "shapes", sep="/"))

> + shppolys <- shape2poly(try1, as.character(try1$dbf$dbf$NEIGNO))

> + plotpolys(shppolys)

> + title(main="Polygons for Vermani from shapefiles package")

> + }

> > 

> > try2 <- read.shape(system.file("shapes/Vermani.shp",

> + package="maptools/man")[1])

> Error: couldn't find function "read.shape"

> > mappolys <- Map2poly(try2, as.character(try2$att.data$NEIGNO))

> Error: couldn't find function "Map2poly"

> > plotpolys(mappolys)

> Error: couldn't find function "plotpolys"

> > title(main="Polygons for Vermani from maptools package")

> Error in title(main = "Polygons for Vermani from maptools package") : 

>         plot.new has not been called yet

> > if (class(shp) != "try-error") {

> + plotpolys(shppolys)

> + plotpolys(mappolys, add=TRUE, border="red", lty="dotted")

> + title(main="Polygons for Vermani overplotted from both packages")

> + }

> ------------------------------------------------------



From cdeclercq at nordnet.fr  Thu Oct 23 19:43:35 2003
From: cdeclercq at nordnet.fr (Christophe Declercq)
Date: Thu, 23 Oct 2003 19:43:35 +0200
Subject: [R-sig-Geo] Re: [R] adjacency matrix
References: <NGBBKLJCOLPAFMJIEMHCEECKCMAA.cdeclercq@nordnet.fr>
	<3F98084B.000006.01492@sida-opz.dsv.su.se>
Message-ID: <000c01c3998d$4cee4cf0$b999f9c1@Alfred>

> 
> ----- Original Message ----- 
> From: "Orlando Zacarias" <si-opz at dsv.su.se>
> To: <cdeclercq at nordnet.fr>
> Cc: <r-sig-geo at stat.math.ethz.ch>; <r-help at stat.math.ethz.ch>
> Sent: Thursday, October 23, 2003 6:56 PM
> Subject: RE: [R] adjacency matrix
> 
> 
> 
> Hi once again,
> Now i have been trying to run the R changed example from Maptools
> package manual, and errors occur underlined bellow. It is really
> troublesome....
> Please assist,
> Orlando.
> ---------------------------------------------------
> shp <- try(library(shapefiles))  
> Error in library(maptools) : There is no package called 'shapefiles'

The message is clear!

> > if (class(shp) != "try-error") {
> + ShapeDir <- system.file("shapes", package="maptools")[1]
> + try1 <- read.shapefile(paste(ShapeDir, "shapes", sep="/"))
> + shppolys <- shape2poly(try1, as.character(try1$dbf$dbf$NEIGNO))
> + plotpolys(shppolys)
> + title(main="Polygons for Vermani from shapefiles package")
> + }
> > 
> > try2 <- read.shape(system.file("shapes/Vermani.shp",
> + package="maptools/man")[1])
> Error: couldn't find function "read.shape"
> > mappolys <- Map2poly(try2, as.character(try2$att.data$NEIGNO))
> Error: couldn't find function "Map2poly"
> > plotpolys(mappolys)
> Error: couldn't find function "plotpolys"
> > title(main="Polygons for Vermani from maptools package")
> Error in title(main = "Polygons for Vermani from maptools package") : 
>         plot.new has not been called yet
> > if (class(shp) != "try-error") {
> + plotpolys(shppolys)
> + plotpolys(mappolys, add=TRUE, border="red", lty="dotted")
> + title(main="Polygons for Vermani overplotted from both packages")
> + }
> ------------------------------------------------------

Did you forget:
> library(maptools)
before that?

Christophe



From si-opz at dsv.su.se  Thu Oct 23 21:34:56 2003
From: si-opz at dsv.su.se (Orlando Zacarias)
Date: Thu, 23 Oct 2003 21:34:56 +0200 (W. Europe Daylight Time)
Subject: [R-sig-Geo] Re: [R] adjacency matrix
References: <000c01c3998d$4cee4cf0$b999f9c1@Alfred>
Message-ID: <3F982D60.000004.01536@sida-opz.dsv.su.se>

I have re-installed the maptools package in library-dir as required. But
there is still some error message on Test Version file for R as illustrated
bellow. Where do i change this "may be flag"??
Cheers,
Orlando.
-----------
shp <- try(library(maptools))  
Error in testRversion(descfields) : This package has not been installed properly See the Note in ?library
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/996f9ba3/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 41982 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/996f9ba3/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 1738 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/996f9ba3/attachment-0001.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 494 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/996f9ba3/attachment-0002.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 3937 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20031023/996f9ba3/attachment-0003.gif>

From Roger.Bivand at nhh.no  Fri Oct 24 21:19:50 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Oct 2003 21:19:50 +0200 (CEST)
Subject: [R-sig-Geo] Re: AI-GEOSTATS: Interpretation of rho and its control
	in Splus
In-Reply-To: <02db01c39a52$4b79dfe0$c8a66f82@Context>
Message-ID: <Pine.LNX.4.44.0310242110340.14002-100000@reclus.nhh.no>

On Fri, 24 Oct 2003, Volker Bahn wrote:

> 
> | On Wed, 22 Oct 2003, Volker Bahn wrote:
> |
> | > Dear Roger,
> | >
> | > thanks for your tips. I will check Haining. Concerning your latter
> comment:
> | > |
> | > | Perhaps just fit lm(), AIC should be OK, as should the likelihood
> ratio
> | > | test. I don't have access to the software, so I'm generalising from
> how
> | > | similar classes work in R.
> | >
> | > I initially fit my "null" model in lm() but the resulting log-lik was so
> | > different from the corresponding slm() log-lik that a comparsion was not
> | > possible. I figured that this must be because of the different
> optimisation
> | > processes in lm() and slm().
> |
> | I wouldn't think so - the basic R logic in logLik.lm() is:
> |
> |     val <- 0.5 * (sum(log(w)) - N * (log(2 * pi) + 1 - log(N) +
> |         log(sum(w * res^2))))
> |
> | where w is a vector of 1's if there are no weights. val is adjusted for
> | REML estimators, but otherwise is as you would expect. Maybe simply the
> | slm() is a much better fit?
> |
> 
> This is starting to be out of my league - I don't really know or understand
> the formula or its consequences. What I do know, though, is that my loglik
> of "null" models calculated with lm() was actually around 0 while the loglik
> of the equivalent slm() model was around -2000 suggesting that the slm() was
> way worse. I then used the following formula to calculate the loglik of
> slm() myself from the RSE, but, as I learned later, this formula really only
> applies to OLS regressions:
> 
> Loglik = (-n / 2) * LN(RSE^2 * df / n) - (n / 2) * LN(2*PI()) - (n / 2)
> 
> The results were pretty credible, though: The slm() were just about as much
> better than the corresponding lm() as I had expected. My next line of attack
> was to set the spatial coefficient rho or just "parameter" as it is called
> in Splus to 0 to get a comparable loglik for the non-spatial model. I
> accomplished
> this indirectly through a likelihood ratio test (lrt.slm), which allows me
> to control the parameter settings for the reduced model. However, I would
> prefer to be able to do this directly so that I can see whether the
> resulting model is really similar in coefficients and all to an lm model.
> Looking through the help files didn't show me an obvious way to accomplish
> this and looking through the functions themselves is just a little bit over
> my head. If you would happen to know how to control the spatial parameter in
> slm() or would have other suggestions I would appreciate to know.

Since I don't have access to S-PLUS myself, I don't think I can see how to 
help. Does anyone have access to SpatialStats and feel able to help (CC-ed 
to r-sig-geo)? I'm pretty uncomfortable with your logLik by hand, because 
the Jacobian seems to be omitted, is that correct?

Roger

> 
> Cheers
> 
> Volker
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Oct 24 23:19:06 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Oct 2003 23:19:06 +0200 (CEST)
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <3F9794F9.000001.00624@sida-opz.dsv.su.se>
Message-ID: <Pine.LNX.4.44.0310242302010.14002-100000@reclus.nhh.no>

On Thu, 23 Oct 2003, Orlando Zacarias wrote:

> Yes. i have managed to create the adjacency matrix in GeoDa. What i am now
> struggling with is the map conversion from shapefile format to R, and from R
> to WinBugs. Since i am running out of time, have downloaded the maptools and
> trying to experiment it for data conversion. Will post you my results. BTW i
> am working on malaria mapping adapting the hierarchical Bayes model (the
> Besag, York and Molli? model).....
> Tanxs all for the help and discussion so far.
> Rgs,
> Orlando. 
> 
> -------Original Message-------
> 
> From: c.declercq at orsnpdc.org
> Date: 23 October 2003 10:25:20
> To: Roger.Bivand at nhh.no
> Cc: anselin at uiuc.edu; r-sig-geo at stat.math.ethz.ch; si-opz at dsv.su.se
> Subject: RE: [R-sig-Geo] RE: [R] adjacency matrix
> 
> > ----- Original Message -----
> > From: "Roger Bivand" <Roger.Bivand at nhh.no>
> > To: "Luc Anselin" <anselin at uiuc.edu>
> > Cc: <cdeclercq at nordnet.fr>; <r-sig-geo at stat.math.ethz.ch>; "Orlando
> > Zacarias" <si-opz at dsv.su.se>
> > Sent: Wednesday, October 22, 2003 6:19 PM
> > Subject: Re: [R-sig-Geo] RE: [R] adjacency matrix
> >
> >
> > On Wed, 22 Oct 2003, Luc Anselin wrote:
> >
> > > Another alternative would be to use the "Tools" in GeoDa
> > > (free from http://sal.agecon.uiuc.edu/csiss/geoda.html ).
> > > This creates contiguity and distance based sparse weights
> > > files (in ascii format) directly from point and polygon shape
> > > files. The spdep package contains functions to read and
> > > manipulate these weights files. I'm not familiar with the
> > > format used by WinBUGS, but I doubt it can be very different.
> > > L.
> >
> > >From links from the web page I googled (convert.r AND cgm), and from the
> > GeoBUGS manual, their format can be generated, but looks a bit naive as
> > is. We could implement it, and/or talk to the GeoBUGS developers about
> > using GeoDa (and maybe R/spdep) as a convenient front end - then they
> > would avoid having to generate the weights internally. Since they are
> > Windows, and WinBUGS is closed source, GeoDa could be a useful
> > pre-processing tool (also for spdep weights).
> 
> I did not know GeoDa so I will have a look at it.
> 
> I'm now working on a project with mortality mapping using smoothing with a
> hierarchical Bayes model (the Besag, York and Molli? model) and I'm actually
> using R/maptools/spdep as a front end to WinBUGS1.4.
> 
> I do all the data preparation for WinBUGS in R, I use the new scripting
> facility in WinBUGS1.4 and I get back the samples in R to plot maps of the
> estimates with plotpolys(). It works fine for me.
> 
> It's easy to get the adjacency data as WinBUGS want them.
> Something along the lines of (if 'cantons' is a 'polylist' object):
> 
> > cantons.nb<-poly2nb(cantons, bb=cantons.bb) # calculate the neighbourhood
> > data<-list(N = length(cantons),
> + O=lungcanc$o, E=lungcanc$e,
> + num=sapply(cantons.nb, length),
> + adj=unlist(cantons.nb),
> + sumNumNeigh=length(unlist(cantons.nb))
> +)

Would it be useful for a function doing this to be put into spdep, 
including checking that things "add up"? Should the function write data 
out to a file - probably not, if you are using bugsR as the interface?

Would a similar function to output the polygon boundaries in a 
GeoBUGS-friendly format be helpful - should that rather be in maptools?

This is a very fruitful thread - please keep up the flow of ideas, because 
the need for data exchange with WinBUGS is clear and if we can get it 
right, should be useful for quite a large (and growing) group of people. 
Could some of us try to do a very rough mini-HOWTO, possibly with the 
author of convert.r (cc to Yue Cui, thread "adjacency matrix" on r-help 
and r-sig-help)?

Roger

> 
> Some care is needed in the formating of numbers. I use some of the functions
> by Andrew Gelman at http://www.stat.columbia.edu/~gelman/bugsR (a web
> appendix to the book Bayesian Data Analysis, Second Edition, by Andrew
> Gelman, Donald B. Rubin, Hal S. Stern) to write the ascii files for WInBUGS.
> 
> Christophe
> --
> Christophe DECLERCQ, MD
> Observatoire R?gional de la Sant? Nord-Pas-de-Calais
> 13, rue Faidherbe 59046 LILLE Cedex FRANCE
> Phone +33 3 20 15 49 24
> Fax +33 3 20 55 92 30
> E-mail c.declercq at orsnpdc.org
> 
> 
> 
> .

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Fri Oct 24 23:27:18 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 24 Oct 2003 23:27:18 +0200 (CEST)
Subject: [R-sig-Geo] Re: Adjacency matrices
In-Reply-To: <20031023144727.C647B3CE49@www.fastmail.fm>
Message-ID: <Pine.LNX.4.44.0310242320110.14002-100000@reclus.nhh.no>

On Thu, 23 Oct 2003, Nicholas Lewin-Koh wrote:

> Hi,
> >From the sound of this it is time
> to grit my teeth and get the quadtree code working for maptools.
> That should translate for a polygon list from Spdep and allow 
> calculation of adjacency matrices in R for moderate to large maps.

Actually poly2nb() isn't too slow for small data sets, such as those most 
of the GeoBUGS users seem to need, and for Windows users GeoDa does pretty 
well. I think Barry Rowlingson has (?) some quadtree code, but you are 
right, there is some in or near shapelib too (shptree?). This would give 
better spatial searching too (which poly is locator() in?), wouldn't it? 
Is this functionality that would be appreciated?

> 
> Oh if I could put time in a bottle ......
> 

Let me know if you find a way - CET people get one hour extra early Sunday 
morning!

Roger

> 
> Nicholas
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From cdeclercq at nordnet.fr  Mon Oct 27 11:43:00 2003
From: cdeclercq at nordnet.fr (Christophe Declercq)
Date: Mon, 27 Oct 2003 10:43:00 -0000
Subject: [R-sig-Geo] RE: [R] adjacency matrix
In-Reply-To: <Pine.LNX.4.44.0310242302010.14002-100000@reclus.nhh.no>
Message-ID: <NGBBKLJCOLPAFMJIEMHCAEEKCMAA.cdeclercq@nordnet.fr>



> -----Message d'origine-----
> De : r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]De la part de Roger Bivand
> Envoy? : vendredi 24 octobre 2003 22:19

[...]

> > It's easy to get the adjacency data as WinBUGS want them.
> > Something along the lines of (if 'cantons' is a 'polylist' object):
> >
> > > cantons.nb<-poly2nb(cantons, bb=cantons.bb) # calculate the
> neighbourhood
> > > data<-list(N = length(cantons),
> > + O=lungcanc$o, E=lungcanc$e,
> > + num=sapply(cantons.nb, length),
> > + adj=unlist(cantons.nb),
> > + sumNumNeigh=length(unlist(cantons.nb))
> > +)
>
> Would it be useful for a function doing this to be put into spdep,
> including checking that things "add up"? Should the function write data
> out to a file - probably not, if you are using bugsR as the interface?

Something generic would be useful but not that simple if you want to take
care of:
- the different models we can use (a simple example is the case where we
have an X variable for ecological regression)
- the different ways to connect R and WinBUGS:
  - export all the data from R in a format WinBUGS can read and do all the
work in WinBUGS
  - driving completely the WinBUGS engine from R (the bugsR approach)
  - a semi-interactive way using some of the bugsR functions to write text
files with data and inits, launching WinBUGS script from R (with something
as 'system("C:/\"Program Files\"/WinBUGS14/WinBUGS14 /par script.txt")', do
what you want in WinBUGS: more iterations, MCMC diagnostics... and save what
you want, get back in R when closing WinBUGS, read the saved files you need
in R to map estimates... It's the way I use now.
>
> Would a similar function to output the polygon boundaries in a
> GeoBUGS-friendly format be helpful - should that rather be in maptools?

I don't use GeoBUGS mapping functions at all for the moment (I use
plotpolys()... and poly2nb()...) but, yes, it should be useful. As I
understand it, GeoBUGS read the S maps format: would converting polylist
from/to S maps be useful?

> This is a very fruitful thread - please keep up the flow of
> ideas, because
> the need for data exchange with WinBUGS is clear and if we can get it
> right, should be useful for quite a large (and growing) group of people.
> Could some of us try to do a very rough mini-HOWTO, possibly with the
> author of convert.r (cc to Yue Cui, thread "adjacency matrix" on r-help
> and r-sig-help)?

Good idea! I can try to write a rough HOW-I sketch if you want. I hope
Orlando has eventually been sucessful in his work and so his experience will
be useful.

Christophe
--
Christophe DECLERCQ, MD
Observatoire R?gional de la Sant? Nord-Pas-de-Calais
13, rue Faidherbe 59046 LILLE Cedex FRANCE
Phone +33 3 20 15 49 24
Fax   +33 3 20 55 92 30
E-mail c.declercq at orsnpdc.org



From giovanna.jonalasinio at uniroma1.it  Thu Oct 30 13:10:36 2003
From: giovanna.jonalasinio at uniroma1.it (giovanna jona lasinio)
Date: Thu, 30 Oct 2003 13:10:36 +0100
Subject: [R-sig-Geo] conditional autoregressive models
Message-ID: <LIENKNHCFMLBLEDKGJHKAEGPCCAA.giovanna.jonalasinio@uniroma1.it>

Does anyone know how to estimate via ML a conditional autoregressive model
(CAR as in Cressie 1993) using R?

Thanks
Giovanna Jona Lasinio
DSPSA University of Rome "La Sapienza"



From Roger.Bivand at nhh.no  Thu Oct 30 14:03:41 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 30 Oct 2003 14:03:41 +0100 (CET)
Subject: [R-sig-Geo] conditional autoregressive models
In-Reply-To: <LIENKNHCFMLBLEDKGJHKAEGPCCAA.giovanna.jonalasinio@uniroma1.it>
Message-ID: <Pine.LNX.4.44.0310301356110.5889-100000@reclus.nhh.no>

On Thu, 30 Oct 2003, giovanna jona lasinio wrote:

> Does anyone know how to estimate via ML a conditional autoregressive model
> (CAR as in Cressie 1993) using R?
> 

Not yet. As Brian Ripley pointed out in R News in 2001, where 
functionality has been available in S-PLUS SpatialStats, there has been 
less incentive to write R code. My guess would be that if one used 
errorsarlm() in spdep as a template (with the functions being optimised) 
then it wouldn't be too difficult to do - but returning an object of a 
"carlm" class, for example. Next print(), anova(), and summary() classes. 
Would anyone like to help?

Roger

> Thanks
> Giovanna Jona Lasinio
> DSPSA University of Rome "La Sapienza"
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From anselin at uiuc.edu  Thu Oct 30 14:38:07 2003
From: anselin at uiuc.edu (Luc Anselin)
Date: Thu, 30 Oct 2003 07:38:07 -0600
Subject: [R-sig-Geo] conditional autoregressive models
In-Reply-To: <Pine.LNX.4.44.0310301356110.5889-100000@reclus.nhh.no>
Message-ID: <4B8E475F-0ADE-11D8-9937-000393C8EF0E@uiuc.edu>

The main catch would be to make sure that W is symmetric, since
the variance becomes (I - rW)-1 not the cross product as in
SAR (which is guaranteed to be symmetric, irrespective of W).
Also, the EGLS part would be slightly different, since what is
needed is X'(I - rW)X not X'(I - rW)'(I - rW)X.
More fundamentally though, one should make sure there is a good
reason to use CAR rather than SAR, they imply different correlation
structures but also different conceptual models.
L.

On Thursday, October 30, 2003, at 07:03 AM, Roger Bivand wrote:

> On Thu, 30 Oct 2003, giovanna jona lasinio wrote:
>
>> Does anyone know how to estimate via ML a conditional autoregressive 
>> model
>> (CAR as in Cressie 1993) using R?
>>
>
> Not yet. As Brian Ripley pointed out in R News in 2001, where
> functionality has been available in S-PLUS SpatialStats, there has been
> less incentive to write R code. My guess would be that if one used
> errorsarlm() in spdep as a template (with the functions being 
> optimised)
> then it wouldn't be too difficult to do - but returning an object of a
> "carlm" class, for example. Next print(), anova(), and summary() 
> classes.
> Would anyone like to help?
>
> Roger
>
>> Thanks
>> Giovanna Jona Lasinio
>> DSPSA University of Rome "La Sapienza"
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> -- 
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School 
> of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
>



From giovanna.jonalasinio at uniroma1.it  Thu Oct 30 15:05:53 2003
From: giovanna.jonalasinio at uniroma1.it (giovanna jona lasinio)
Date: Thu, 30 Oct 2003 15:05:53 +0100
Subject: [R-sig-Geo] conditional autoregressive models 
Message-ID: <LIENKNHCFMLBLEDKGJHKCEHBCCAA.giovanna.jonalasinio@uniroma1.it>

My interest in CAR is mainly didactic. I'm teaching spatial stat. and all
applications are made with R. I believe it maybe useful for research and
didactic purposes to have CARs implemented in R. I'll try to modify
errorsarlm and if I succeed I'll let you know. Any further suggestion will
be greatly appreciated!! :)

Thanks
Giovanna Jona Lasinio


>The main catch would be to make sure that W is symmetric, since
>the variance becomes (I - rW)-1 not the cross product as in
>SAR (which is guaranteed to be symmetric, irrespective of W).
>Also, the EGLS part would be slightly different, since what is
>needed is X'(I - rW)X not X'(I - rW)'(I - rW)X.
>More fundamentally though, one should make sure there is a good
>reason to use CAR rather than SAR, they imply different correlation
>structures but also different conceptual models.
>L.

On Thursday, October 30, 2003, at 07:03 AM, Roger Bivand wrote:

> On Thu, 30 Oct 2003, giovanna jona lasinio wrote:
>
>> Does anyone know how to estimate via ML a conditional autoregressive
>> model
>> (CAR as in Cressie 1993) using R?
>>
>
> Not yet. As Brian Ripley pointed out in R News in 2001, where
> functionality has been available in S-PLUS SpatialStats, there has been
> less incentive to write R code. My guess would be that if one used
> errorsarlm() in spdep as a template (with the functions being
> optimised)
> then it wouldn't be too difficult to do - but returning an object of a
> "carlm" class, for example. Next print(), anova(), and summary()
> classes.
> Would anyone like to help?
>
> Roger
>
>> Thanks
>> Giovanna Jona Lasinio
>> DSPSA University of Rome "La Sapienza"
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School
> of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no



From giovanna.jonalasinio at uniroma1.it  Thu Oct 30 15:05:53 2003
From: giovanna.jonalasinio at uniroma1.it (giovanna jona lasinio)
Date: Thu, 30 Oct 2003 15:05:53 +0100
Subject: [R-sig-Geo] conditional autoregressive models 
Message-ID: <LIENKNHCFMLBLEDKGJHKCEHBCCAA.giovanna.jonalasinio@uniroma1.it>

My interest in CAR is mainly didactic. I'm teaching spatial stat. and all
applications are made with R. I believe it maybe useful for research and
didactic purposes to have CARs implemented in R. I'll try to modify
errorsarlm and if I succeed I'll let you know. Any further suggestion will
be greatly appreciated!! :)

Thanks
Giovanna Jona Lasinio


>The main catch would be to make sure that W is symmetric, since
>the variance becomes (I - rW)-1 not the cross product as in
>SAR (which is guaranteed to be symmetric, irrespective of W).
>Also, the EGLS part would be slightly different, since what is
>needed is X'(I - rW)X not X'(I - rW)'(I - rW)X.
>More fundamentally though, one should make sure there is a good
>reason to use CAR rather than SAR, they imply different correlation
>structures but also different conceptual models.
>L.

On Thursday, October 30, 2003, at 07:03 AM, Roger Bivand wrote:

> On Thu, 30 Oct 2003, giovanna jona lasinio wrote:
>
>> Does anyone know how to estimate via ML a conditional autoregressive
>> model
>> (CAR as in Cressie 1993) using R?
>>
>
> Not yet. As Brian Ripley pointed out in R News in 2001, where
> functionality has been available in S-PLUS SpatialStats, there has been
> less incentive to write R code. My guess would be that if one used
> errorsarlm() in spdep as a template (with the functions being
> optimised)
> then it wouldn't be too difficult to do - but returning an object of a
> "carlm" class, for example. Next print(), anova(), and summary()
> classes.
> Would anyone like to help?
>
> Roger
>
>> Thanks
>> Giovanna Jona Lasinio
>> DSPSA University of Rome "La Sapienza"
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Economic Geography Section, Department of Economics, Norwegian School
> of
> Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
> Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
> e-mail: Roger.Bivand at nhh.no



From e.pebesma at geog.uu.nl  Fri Oct 31 12:29:48 2003
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Fri, 31 Oct 2003 12:29:48 +0100
Subject: [R-sig-Geo] A package for spatial data classes: request for comments
Message-ID: <3FA247AC.5000405@geog.uu.nl>

Much like time, spatial locations are not likely to change for observed
data. Still, R has no infrastructure or knowledge about spatial locations.

Many packages that deal with spatial data in R use their own classes
to deal with spatial data. On the workshop on spatial statistics software
held during DSC2003 (organized by Roger Bivand), we decided that
a base class that defines classes for spatial data should be helpful,
both as an exchange platform and (later) as a required package for
working with spatial data (compare the ts class for time series).

I started writing such a package, and opened a sourceforge.net project
for it, called r-spatial. I first worked with Barry Rowlinson's
spatial.data.frame (found in r-asp, or rasp, also on sourceforge),
which is  an S3 class. Then I restarted using S4 classes, because
they are here to stay, and allow validation.

Currently I defined three classes:

+ SpatialData
    +-- SpatialDataFrame
        +-- SpatialDataFrameGrid

SpatialData is only meant as a base class; it only contains a bounding
box (2D or 3D data), and information about projection (if present),
anticipating (re)projecting facilities in Roger's proj4R package.

SpatialDataFrame extends this class; holds a data frame, and the
information where in the data frame the coordinates (2D or 3D) are
stored.

SpatialDataFrameGrid extends SpatialDataFrame for the case where
the data are on a regular 2D/3D grid; it contains the offset of the grid,
the cellsize in (x,y,z) and the nr of row/cols/layers. One simple
way of creating these classes (idea taken from Barry) is:

 > data(meuse.grid) # data frame with gridded data
 > coordinates(meuse.grid) = c("x", "y") # promote to SpatialDataFrame
 > gridded(meuse.grid) = TRUE # promote to SpatialDataFrameGrid

in the last expression, the grid topology is auto-detected and stored.

Missing values for coordinates are not allowed.

This now works; I need to add more tests for a lot of pathetic cases.

To be really useful, the class should include vector (polygon) data,
and probably line elements. For this, I need help. The simples approach
would be to extend SpatialDataFrame to SpatialDataFramePolygon,
and add for each row add the corresponding polygon.

Questions:
- did I overlook important things in the current proposal?
- is there some class in a package that serves as a good
starting point for vector/polygon data?
- which information should be stored for each polygon (if I look
at class "Map" in maptools, there is a lot!)
- should we anticipate exchangeability with shapefiles, and
store everything needed for them right at the start? If yes,
how to deal with much simpler representations such as in
packages maps?
- should we work to two extensions of SpatialDataFrame,
first simply with the polygons, a second with all the
shapefile information requirements?
- will there ever be a need to export R data as shape files?
if not, which part of information in shapefiles may be ignored?
- Do we need another name, instead of the current SpatialCls?


You can download SpatialCls by cvs; use:

export CVS_RSH=ssh
cvs -d:pserver:anonymous at cvs.sf.net:/cvsroot/r-spatial login
# press return on the password prompt
cvs -d:pserver:anonymous at cvs.sf.net:/cvsroot/r-spatial co SpatialCls

If you are interested in becoming a co-developer, please join!
--
Edzer



From hi_ono2001 at ybb.ne.jp  Fri Oct 31 14:00:45 2003
From: hi_ono2001 at ybb.ne.jp (Hisaji Ono)
Date: Fri, 31 Oct 2003 22:00:45 +0900
Subject: [R-sig-Geo] Where is "spatial index" in spdep
References: <Pine.LNX.4.44.0310301356110.5889-100000@reclus.nhh.no>
Message-ID: <004901c39faf$018a9b60$818001db@webgis>

Hello.

 In "R spatial projects" site's ""Areal", it was written spdep supports
"spatial index".

 But no description in spdep's htmls in this archive.

 Could you tell me where is a description about this?

 Regards.



From Roger.Bivand at nhh.no  Fri Oct 31 14:11:01 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 31 Oct 2003 14:11:01 +0100 (CET)
Subject: [R-sig-Geo] Re: Where is "spatial index" in spdep
In-Reply-To: <004901c39faf$018a9b60$818001db@webgis>
Message-ID: <Pine.LNX.4.44.0310311409040.7971-100000@reclus.nhh.no>

On Fri, 31 Oct 2003, Hisaji Ono wrote:

> Hello.
> 
>  In "R spatial projects" site's ""Areal", it was written spdep supports
> "spatial index".

I'll change the description. This only refers to the Assun??o/Reis 
adjustment of Moran's I for rates, function EBImoran.mc(). I can see that 
it can be misunderstood.

Roger

> 
>  But no description in spdep's htmls in this archive.
> 
>  Could you tell me where is a description about this?
> 
>  Regards.
> 
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From cavallini at faunalia.it  Fri Oct 31 15:57:15 2003
From: cavallini at faunalia.it (Paolo Cavallini)
Date: Fri, 31 Oct 2003 15:57:15 +0100
Subject: [R-sig-Geo] shapefiles plotting and colouring
Message-ID: <200310311557.16227.cavallini@faunalia.it>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi all.
it may be a silly question, but: how can I, after reading a shapefile with the 
appropriate library, draw them with different colours (or grey shades) 
according to different database fields (read through RODBC)? The idea is 
similar to the polygon command, but using shp as polygons and database fields 
as qualifiers.
Thanks for any suggestions.
Ciao.
paolo
- -- 
Paolo Cavallini
cavallini at faunalia.it
www.faunalia.it
Piazza Garibaldi 5
56025 Pontedera (PI)
Italy
Tel: (+39)348-3801953
GPG signature/firma digitale @:
www.faunalia.it/Public_key_Paolo.asc
- ------------------------------------------
Lavoro esclusivamente con software libero.
I use exclusively free software.
www.gnu.org / www.linux.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.3 (GNU/Linux)

iD8DBQE/onhL/NedwLUzIr4RAoTVAKCzgD0WU5awJxg0gS37HD64WVF9uwCgmDYx
UhPvLWUMPaJMNeA4NIuNPg8=
=f7Fk
-----END PGP SIGNATURE-----



From cdeclercq at nordnet.fr  Fri Oct 31 17:40:36 2003
From: cdeclercq at nordnet.fr (Christophe Declercq)
Date: Fri, 31 Oct 2003 16:40:36 -0000
Subject: [R-sig-Geo] shapefiles plotting and colouring
In-Reply-To: <200310311557.16227.cavallini@faunalia.it>
Message-ID: <NGBBKLJCOLPAFMJIEMHCIEHPCMAA.cdeclercq@nordnet.fr>

Hi, Paolo

> De : r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch]De la part de Paolo
> Cavallini
> Envoy? : vendredi 31 octobre 2003 14:57
> ? : r-sig-geo at stat.math.ethz.ch
> Objet : [R-sig-Geo] shapefiles plotting and colouring

[...]
> Hi all.
> it may be a silly question

Not silly at all...

> it may be a silly question, but: how can I, after reading a
> shapefile with the
> appropriate library, draw them with different colours (or grey shades)
> according to different database fields (read through RODBC)? The idea is
> similar to the polygon command, but using shp as polygons and
> database fields
> as qualifiers.

In the 'maptools' package, you have the 'plot.Map' function (see ?plot.Map
and the 'auxvar', 'type' and 'nclass' arguments).

If you convert from a 'Map' object to a 'polylist' object with the
'Map2poly' function, you can also use 'plotpolys' which is more flexible.

Have a look at the ?plotpolys example, and by the way, try also the
'RColorBrewer' package for beautiful and efficient colors.

Hope it helps.

Christophe
--
Christophe DECLERCQ, MD
Observatoire R?gional de la Sant? Nord-Pas-de-Calais
13, rue Faidherbe 59046 LILLE Cedex FRANCE
Phone +33 3 20 15 49 24
Fax   +33 3 20 55 92 30
E-mail c.declercq at orsnpdc.org

> Thanks for any suggestions.
> Ciao.
> paolo
> - --
> Paolo Cavallini
> cavallini at faunalia.it
> www.faunalia.it
> Piazza Garibaldi 5
> 56025 Pontedera (PI)
> Italy
> Tel: (+39)348-3801953
> GPG signature/firma digitale @:
> www.faunalia.it/Public_key_Paolo.asc

[...]



From hi_ono2001 at ybb.ne.jp  Fri Oct 31 18:03:06 2003
From: hi_ono2001 at ybb.ne.jp (Hisaji Ono)
Date: Sat, 1 Nov 2003 02:03:06 +0900
Subject: [R-sig-Geo] shapefiles plotting and colouring
References: <200310311557.16227.cavallini@faunalia.it>
Message-ID: <00b201c39fd0$da72b3b0$818001db@webgis>

Hi.

I've tried to draw choropleth maps by rmap package as follows.

library(rmap)

mySF <- shapefile("columbus.shp")

 crime <- mySF$CRIME

# user-defined legend
 classes <- c(50,100,500,1000,5000)
 breaks <- length(classes) + 1
 classNo <- crime < classes[1]
 for(i in 1:(breaks - 1))
   classNo <- classNo + (crime >= classes[i] & crime < classes[i + 1]) * i

 classNo <- classNo + (crime >= max(classes)) * breaks
 plot(mySF, f=gray(1 - classNo/breaks)) # draw map
 lines(mySF, col="red") # draw outlines

----- Original Message ----- 
From: "Paolo Cavallini" <cavallini at faunalia.it>
To: <r-sig-geo at stat.math.ethz.ch>
Sent: Friday, October 31, 2003 11:57 PM
Subject: [R-sig-Geo] shapefiles plotting and colouring


> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi all.
> it may be a silly question, but: how can I, after reading a shapefile with
the
> appropriate library, draw them with different colours (or grey shades)
> according to different database fields (read through RODBC)? The idea is
> similar to the polygon command, but using shp as polygons and database
fields
> as qualifiers.
> Thanks for any suggestions.
> Ciao.
> paolo



From cavallini at faunalia.it  Fri Oct 31 18:27:56 2003
From: cavallini at faunalia.it (Paolo Cavallini)
Date: Fri, 31 Oct 2003 18:27:56 +0100
Subject: [R-sig-Geo] shapefiles plotting and colouring
In-Reply-To: <00b201c39fd0$da72b3b0$818001db@webgis>
References: <200310311557.16227.cavallini@faunalia.it>
	<00b201c39fd0$da72b3b0$818001db@webgis>
Message-ID: <200310311827.58313.cavallini@faunalia.it>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Thanks for this. My problem is, however, to use variables from a database 
(PostgreSQL in our case) rather than those of the dbf associated with the shp 
file.
All the best.
Paolo

At 18:03, venerd? 31 ottobre 2003 you presumably wrote:
> Hi.
>
> I've tried to draw choropleth maps by rmap package as follows.
>
> library(rmap)
>
> mySF <- shapefile("columbus.shp")
>
>  crime <- mySF$CRIME
>
> # user-defined legend
>  classes <- c(50,100,500,1000,5000)
>  breaks <- length(classes) + 1
>  classNo <- crime < classes[1]
>  for(i in 1:(breaks - 1))
>    classNo <- classNo + (crime >= classes[i] & crime < classes[i + 1]) * i
>
>  classNo <- classNo + (crime >= max(classes)) * breaks
>  plot(mySF, f=gray(1 - classNo/breaks)) # draw map
>  lines(mySF, col="red") # draw outlines
>
> ----- Original Message -----
> From: "Paolo Cavallini" <cavallini at faunalia.it>
> To: <r-sig-geo at stat.math.ethz.ch>
> Sent: Friday, October 31, 2003 11:57 PM
> Subject: [R-sig-Geo] shapefiles plotting and colouring
>
> > -----BEGIN PGP SIGNED MESSAGE-----
> > Hash: SHA1
> >
> > Hi all.
> > it may be a silly question, but: how can I, after reading a shapefile
> > with
>
> the
>
> > appropriate library, draw them with different colours (or grey shades)
> > according to different database fields (read through RODBC)? The idea is
> > similar to the polygon command, but using shp as polygons and database
>
> fields
>
> > as qualifiers.
> > Thanks for any suggestions.
> > Ciao.
> > paolo

- -- 
Paolo Cavallini
cavallini at faunalia.it
www.faunalia.it
Piazza Garibaldi 5
56025 Pontedera (PI)
Italy
Tel: (+39)348-3801953
GPG signature/firma digitale @:
www.faunalia.it/Public_key_Paolo.asc
- ------------------------------------------
Lavoro esclusivamente con software libero.
I use exclusively free software.
www.gnu.org / www.linux.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.3 (GNU/Linux)

iD8DBQE/opuc/NedwLUzIr4RApSMAJoCktLlzZVBfzStI09vsNKScgDk4wCdHNz8
+HhE2grymbl4Z5S84M2Fwgo=
=4H68
-----END PGP SIGNATURE-----



From danlinyu at csd.uwm.edu  Fri Oct 31 19:52:17 2003
From: danlinyu at csd.uwm.edu (Danlin Yu)
Date: Fri, 31 Oct 2003 12:52:17 -0600 (CST)
Subject: [R-sig-Geo] shapefiles plotting and colouring
In-Reply-To: <200310311827.58313.cavallini@faunalia.it>
Message-ID: <Pine.OSF.3.96.1031031124834.12864A-100000@alpha1.csd.uwm.edu>

Hi, Paolo:
    I don't know if this helps. Indeed, if you have access to ArcGIS or
ArcView, I would surely suggest you to *join* your other database fields
to the shapefile and export the joined shapefile as a new one, then I
suppose either Chris or Hisaji's method will work for your problem.

On Fri, 31 Oct 2003, Paolo Cavallini wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Thanks for this. My problem is, however, to use variables from a database 
> (PostgreSQL in our case) rather than those of the dbf associated with the shp 
> file.
> All the best.
> Paolo
> 
> At 18:03, venerd? 31 ottobre 2003 you presumably wrote:
> > Hi.
> >
> > I've tried to draw choropleth maps by rmap package as follows.
> >
> > library(rmap)
> >
> > mySF <- shapefile("columbus.shp")
> >
> >  crime <- mySF$CRIME
> >
> > # user-defined legend
> >  classes <- c(50,100,500,1000,5000)
> >  breaks <- length(classes) + 1
> >  classNo <- crime < classes[1]
> >  for(i in 1:(breaks - 1))
> >    classNo <- classNo + (crime >= classes[i] & crime < classes[i + 1]) * i
> >
> >  classNo <- classNo + (crime >= max(classes)) * breaks
> >  plot(mySF, f=gray(1 - classNo/breaks)) # draw map
> >  lines(mySF, col="red") # draw outlines
> >
> > ----- Original Message -----
> > From: "Paolo Cavallini" <cavallini at faunalia.it>
> > To: <r-sig-geo at stat.math.ethz.ch>
> > Sent: Friday, October 31, 2003 11:57 PM
> > Subject: [R-sig-Geo] shapefiles plotting and colouring
> >
> > > -----BEGIN PGP SIGNED MESSAGE-----
> > > Hash: SHA1
> > >
> > > Hi all.
> > > it may be a silly question, but: how can I, after reading a shapefile
> > > with
> >
> > the
> >
> > > appropriate library, draw them with different colours (or grey shades)
> > > according to different database fields (read through RODBC)? The idea is
> > > similar to the polygon command, but using shp as polygons and database
> >
> > fields
> >
> > > as qualifiers.
> > > Thanks for any suggestions.
> > > Ciao.
> > > paolo
> 
> - -- 
> Paolo Cavallini
> cavallini at faunalia.it
> www.faunalia.it
> Piazza Garibaldi 5
> 56025 Pontedera (PI)
> Italy
> Tel: (+39)348-3801953
> GPG signature/firma digitale @:
> www.faunalia.it/Public_key_Paolo.asc
> - ------------------------------------------
> Lavoro esclusivamente con software libero.
> I use exclusively free software.
> www.gnu.org / www.linux.org
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.2.3 (GNU/Linux)
> 
> iD8DBQE/opuc/NedwLUzIr4RApSMAJoCktLlzZVBfzStI09vsNKScgDk4wCdHNz8
> +HhE2grymbl4Z5S84M2Fwgo=
> =4H68
> -----END PGP SIGNATURE-----
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> 

    Sincerely,
    Danlin Yu, Ph.D. Candidate
    Department of Geography
    University of Wisconsin, Milwaukee
    Tel: (414)229-5818
    Fax: (414)229-3981
    Email: danlinyu at uwm.edu



From Roger.Bivand at nhh.no  Fri Oct 31 21:18:05 2003
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 31 Oct 2003 21:18:05 +0100 (CET)
Subject: [R-sig-Geo] shapefiles plotting and colouring
In-Reply-To: <200310311827.58313.cavallini@faunalia.it>
Message-ID: <Pine.LNX.4.44.0310312103350.8520-100000@reclus.nhh.no>

Paolo:

The key question will be to make sure that the colours you use to fill the 
polygons are in the correct order for the polygons. If you use Map2poly() 
to convert the shapes of a Map object to a polylist, you will see that you 
can attach a "region.id" attribute. When you access your database records, 
you could use that to check, and if necessary re-order the data frame rows 
using match(), to put them in the same order as the spatial objects (which 
can be multiple polygons). 

Then if your variable is a factor, you need to assign colours to its
levels, if continuous, you need to choose and impose class intervals to
use colour table lookup in the col= argument to plotpolys. Try running
example(plotpolys), and then just type for example cols[np] to see how the
table lookup is being used to feed a vector of colours of the same length
as mappolys to the function. The results of length(mappolys) and
length(cols[np]) should be the same. But I do recommend checking the
"region.id" against your database!

Hope this helps,

Roger


On Fri, 31 Oct 2003, Paolo Cavallini wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Thanks for this. My problem is, however, to use variables from a database 
> (PostgreSQL in our case) rather than those of the dbf associated with the shp 
> file.
> All the best.
> Paolo
> 
> At 18:03, venerd? 31 ottobre 2003 you presumably wrote:
> > Hi.
> >
> > I've tried to draw choropleth maps by rmap package as follows.
> >
> > library(rmap)
> >
> > mySF <- shapefile("columbus.shp")
> >
> >  crime <- mySF$CRIME
> >
> > # user-defined legend
> >  classes <- c(50,100,500,1000,5000)
> >  breaks <- length(classes) + 1
> >  classNo <- crime < classes[1]
> >  for(i in 1:(breaks - 1))
> >    classNo <- classNo + (crime >= classes[i] & crime < classes[i + 1]) * i
> >
> >  classNo <- classNo + (crime >= max(classes)) * breaks
> >  plot(mySF, f=gray(1 - classNo/breaks)) # draw map
> >  lines(mySF, col="red") # draw outlines
> >
> > ----- Original Message -----
> > From: "Paolo Cavallini" <cavallini at faunalia.it>
> > To: <r-sig-geo at stat.math.ethz.ch>
> > Sent: Friday, October 31, 2003 11:57 PM
> > Subject: [R-sig-Geo] shapefiles plotting and colouring
> >
> > > -----BEGIN PGP SIGNED MESSAGE-----
> > > Hash: SHA1
> > >
> > > Hi all.
> > > it may be a silly question, but: how can I, after reading a shapefile
> > > with
> >
> > the
> >
> > > appropriate library, draw them with different colours (or grey shades)
> > > according to different database fields (read through RODBC)? The idea is
> > > similar to the polygon command, but using shp as polygons and database
> >
> > fields
> >
> > > as qualifiers.
> > > Thanks for any suggestions.
> > > Ciao.
> > > paolo
> 
> - -- 
> Paolo Cavallini
> cavallini at faunalia.it
> www.faunalia.it
> Piazza Garibaldi 5
> 56025 Pontedera (PI)
> Italy
> Tel: (+39)348-3801953
> GPG signature/firma digitale @:
> www.faunalia.it/Public_key_Paolo.asc
> - ------------------------------------------
> Lavoro esclusivamente con software libero.
> I use exclusively free software.
> www.gnu.org / www.linux.org
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.2.3 (GNU/Linux)
> 
> iD8DBQE/opuc/NedwLUzIr4RApSMAJoCktLlzZVBfzStI09vsNKScgDk4wCdHNz8
> +HhE2grymbl4Z5S84M2Fwgo=
> =4H68
> -----END PGP SIGNATURE-----
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



