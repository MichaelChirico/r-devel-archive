From jefunes at gmail.com  Sat Mar  1 01:21:33 2008
From: jefunes at gmail.com (Jose Funes)
Date: Fri, 29 Feb 2008 19:21:33 -0500
Subject: [R-sig-Geo] kriging -- grass -- asciigrid
Message-ID: <8e01f5830802291621q49950373u9d65a83e7c813154@mail.gmail.com>

Dear members,

I have tried to export a kriging map to arcgis as asciigrid or image.
I have used the functions write.asciigrid and writeRast6sp(grass), in
both cases any success; In the former when exporting it, I got the
following message " Asciigrid does not support grids with non-square
cells". I checked for the krige map topology characteristics using the
following code:
getGridTopology(lidekri)

Apparently cell size looks fine: see below

                         s1       s2
cellcentre.offset -363565.9 175563.0
cellsize               90.0     90.0
cells.dim             804.0   1236.0

For the writeRast6sp function from "spgrass6" library

writeRast6sp(lidekri,"lidekri",zcol="var1.pred",NODATA=-9999),

I got the following message error

 "Error in system(paste(paste("g.tempfile", .addexe(), sep = ""),
"pid=",  :  g.tempfilepid=421 not found"

I will greatly appreciate any suggestions to get around this technical problem.

Sincerely,

Jose Funes









On Fri, Feb 29, 2008 at 6:00 AM,  <r-sig-geo-request at stat.math.ethz.ch> wrote:
> Send R-sig-Geo mailing list submissions to
>         r-sig-geo at stat.math.ethz.ch
>
>  To subscribe or unsubscribe via the World Wide Web, visit
>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  or, via email, send a message with subject or body 'help' to
>         r-sig-geo-request at stat.math.ethz.ch
>
>  You can reach the person managing the list at
>         r-sig-geo-owner at stat.math.ethz.ch
>
>  When replying, please edit your Subject line so it is more specific
>  than "Re: Contents of R-sig-Geo digest..."
>
>
>  Today's Topics:
>
>    1. estimates for paths of travel given two time series,      drawn
>       from two corresponding spatial densities (Galkowski, Jan)
>    2. makeGrid(PBSmapping) (Markus Loecher)
>    3. Choice of Spatial weights (stefan lhachimi)
>
>
>  ----------------------------------------------------------------------
>
>  Message: 1
>  Date: Thu, 28 Feb 2008 13:58:49 -0500
>  From: "Galkowski, Jan" <jgalkows at akamai.com>
>  Subject: [R-sig-Geo] estimates for paths of travel given two time
>         series, drawn from two corresponding spatial densities
>  To: <r-sig-geo at stat.math.ethz.ch>
>  Message-ID:
>         <76EB4827B2104D40AE7E43AA5D8582EA011A9D32 at MAVS1.kendall.corp.akamai.com>
>
>  Content-Type: text/plain
>
>  This is less an R question and more a request to the community for
>  literature references and the like.
>
>  I'm interested in the following inferential question.  What's the max
>  likelihood estimate for a path of travel of a point across a plane
>  having stable, smooth densities of two separate variables given two time
>  series of their values at the point as it moves?   Suppose all that's
>  available is the ratio of the variables?
>
>  This is motivated by problems of inferring movement of biological
>  specimens between nesting and migratory regions, or the problem of
>  recovery of travel given the technique described here:
>
>     http://www.pnas.org/cgi/content/abstract/105/8/2788
>
>  Despite that, are there R packages which might help this?  I ask because
>  I often find real gems buried within many R packages, gems which aren't
>  obviously related to their primary subject.
>
>  Thanks much.
>
>         [[alternative HTML version deleted]]
>
>
>
>  ------------------------------
>
>  Message: 2
>  Date: Thu, 28 Feb 2008 15:00:28 -0500
>  From: Markus Loecher <loecher at eden.rutgers.edu>
>  Subject: [R-sig-Geo] makeGrid(PBSmapping)
>  To: r-sig-geo at stat.math.ethz.ch
>  Message-ID: <20080228195805.F18A632408E at annwn13.rutgers.edu>
>  Content-Type: text/plain; charset="us-ascii"; format=flowed
>
>  Dear geo experts,
>  I am clearly misunderstanding the role of the projection argument in
>  the wonderful utility makeGrid(PBSmapping).
>  I had hoped that by setting projection ="LL" the resulting grid would
>  be equidistant in "real" space, and hence curvilinear in lat/lon space.
>  But the following code yields the identical, regular grid,
>  irrespective of the projection argument:
>
>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>  length=10), byrow = FALSE, addSID = TRUE, projection = "LL")
>         plotMap(mypolys)
>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>  length=10), byrow = FALSE, addSID = TRUE, projection = 1)
>         plotMap(mypolys)
>
>  Is there an easy way to create a rectangular grid in lat/lon space ?
>  Should I first translate the points to UTM coordinates ?
>
>  Thanks!
>
>  Markus
>
>
>
>  ------------------------------
>
>  Message: 3
>  Date: Fri, 29 Feb 2008 11:36:18 +0100
>  From: "stefan lhachimi" <stefan.duke at gmail.com>
>  Subject: [R-sig-Geo] Choice of Spatial weights
>  To: r-sig-geo at stat.math.ethz.ch
>  Message-ID:
>         <a211af3b0802290236m53a12cd1h806a3106f508fb54 at mail.gmail.com>
>  Content-Type: text/plain; charset=ISO-8859-1
>
>  Dear all,
>
>  as a matter of curiosity does anybody know literature which discusses
>  what spatial weight to choose (e.g. k-nn, single or double
>  contiguity)? Or has anybod a good rule of thumb?
>  I found an article which proposes to try several specification and
>  take either the one with the highest lambda  or the one with the best
>  overall model fit (in a regression). But I think that is statistically
>  speaking that is not very satisfactory, in particular if the
>  application does not give any indication what weight to use.
>
>  Any hints?
>  Best,
>  Stefan
>
>
>
>  ------------------------------
>
>  _______________________________________________
>  R-sig-Geo mailing list
>  R-sig-Geo at stat.math.ethz.ch
>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>  End of R-sig-Geo Digest, Vol 54, Issue 27
>  *****************************************
>



From Roger.Bivand at nhh.no  Sun Mar  2 21:41:59 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 2 Mar 2008 21:41:59 +0100 (CET)
Subject: [R-sig-Geo] Choice of Spatial weights
In-Reply-To: <a211af3b0802290236m53a12cd1h806a3106f508fb54@mail.gmail.com>
References: <a211af3b0802290236m53a12cd1h806a3106f508fb54@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803022125410.30274@reclus.nhh.no>

On Fri, 29 Feb 2008, stefan lhachimi wrote:

> Dear all,
>
> as a matter of curiosity does anybody know literature which discusses
> what spatial weight to choose (e.g. k-nn, single or double
> contiguity)? Or has anybod a good rule of thumb?

There are papers by Daniel Griffith, and one by Francois Bavaud, both 
prefer sparse to denser. This one is online:

http://www.unil.ch/webdav/site/imm/users/fbavaud/private/spatialweights_bavaud.pdf

> I found an article which proposes to try several specification and
> take either the one with the highest lambda  or the one with the best
> overall model fit (in a regression). But I think that is statistically
> speaking that is not very satisfactory, in particular if the
> application does not give any indication what weight to use.

Yes, this is a grey area, where different disciplines approach things 
differently. Looking at the data many times is of course a problem. Not 
infrequently, the "accepted" type of weights for a discipline is the one 
chosen, but this isn't a satisfactory answer. Opinions?

Roger

>
> Any hints?
> Best,
> Stefan
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Mar  2 21:51:23 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 2 Mar 2008 21:51:23 +0100 (CET)
Subject: [R-sig-Geo] kriging -- grass -- asciigrid
In-Reply-To: <8e01f5830802291621q49950373u9d65a83e7c813154@mail.gmail.com>
References: <8e01f5830802291621q49950373u9d65a83e7c813154@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803022143050.30274@reclus.nhh.no>

On Fri, 29 Feb 2008, Jose Funes wrote:

> Dear members,
>
> I have tried to export a kriging map to arcgis as asciigrid or image.
> I have used the functions write.asciigrid and writeRast6sp(grass), in
> both cases any success; In the former when exporting it, I got the
> following message " Asciigrid does not support grids with non-square
> cells".

Please quote your exact code. The function writeAsciiGrid() in maptools 
will probably work, while write.asciigrid() in sp (which we ought to 
deprecate, pointing to maptools) does not. The problem is machine fuzz, 
the 90.0 values probably differ by 1e-16 or some other small amount - 
writeAsciiGrid() tests and corrects for the fuzz.

> I checked for the krige map topology characteristics using the
> following code:
> getGridTopology(lidekri)
>
> Apparently cell size looks fine: see below
>
>                         s1       s2
> cellcentre.offset -363565.9 175563.0
> cellsize               90.0     90.0
> cells.dim             804.0   1236.0
>
> For the writeRast6sp function from "spgrass6" library
>
> writeRast6sp(lidekri,"lidekri",zcol="var1.pred",NODATA=-9999),
>

Was your goal to write an Arc ASCII grid as a file, or to write the data 
to GRASS?

Did you try writeRAST6() in spgrass6, which uses other file formats?

Did you try the Arc ASCII grid driver "AAIGrid" with writeGDAL() in rgdal?

Hope this helps,

Roger

> I got the following message error
>
> "Error in system(paste(paste("g.tempfile", .addexe(), sep = ""),
> "pid=",  :  g.tempfilepid=421 not found"
>
> I will greatly appreciate any suggestions to get around this technical problem.
>
> Sincerely,
>
> Jose Funes
>
>
>
>
>
>
>
>
>
> On Fri, Feb 29, 2008 at 6:00 AM,  <r-sig-geo-request at stat.math.ethz.ch> wrote:
>> Send R-sig-Geo mailing list submissions to
>>         r-sig-geo at stat.math.ethz.ch
>>
>>  To subscribe or unsubscribe via the World Wide Web, visit
>>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>  or, via email, send a message with subject or body 'help' to
>>         r-sig-geo-request at stat.math.ethz.ch
>>
>>  You can reach the person managing the list at
>>         r-sig-geo-owner at stat.math.ethz.ch
>>
>>  When replying, please edit your Subject line so it is more specific
>>  than "Re: Contents of R-sig-Geo digest..."
>>
>>
>>  Today's Topics:
>>
>>    1. estimates for paths of travel given two time series,      drawn
>>       from two corresponding spatial densities (Galkowski, Jan)
>>    2. makeGrid(PBSmapping) (Markus Loecher)
>>    3. Choice of Spatial weights (stefan lhachimi)
>>
>>
>>  ----------------------------------------------------------------------
>>
>>  Message: 1
>>  Date: Thu, 28 Feb 2008 13:58:49 -0500
>>  From: "Galkowski, Jan" <jgalkows at akamai.com>
>>  Subject: [R-sig-Geo] estimates for paths of travel given two time
>>         series, drawn from two corresponding spatial densities
>>  To: <r-sig-geo at stat.math.ethz.ch>
>>  Message-ID:
>>         <76EB4827B2104D40AE7E43AA5D8582EA011A9D32 at MAVS1.kendall.corp.akamai.com>
>>
>>  Content-Type: text/plain
>>
>>  This is less an R question and more a request to the community for
>>  literature references and the like.
>>
>>  I'm interested in the following inferential question.  What's the max
>>  likelihood estimate for a path of travel of a point across a plane
>>  having stable, smooth densities of two separate variables given two time
>>  series of their values at the point as it moves?   Suppose all that's
>>  available is the ratio of the variables?
>>
>>  This is motivated by problems of inferring movement of biological
>>  specimens between nesting and migratory regions, or the problem of
>>  recovery of travel given the technique described here:
>>
>>     http://www.pnas.org/cgi/content/abstract/105/8/2788
>>
>>  Despite that, are there R packages which might help this?  I ask because
>>  I often find real gems buried within many R packages, gems which aren't
>>  obviously related to their primary subject.
>>
>>  Thanks much.
>>
>>         [[alternative HTML version deleted]]
>>
>>
>>
>>  ------------------------------
>>
>>  Message: 2
>>  Date: Thu, 28 Feb 2008 15:00:28 -0500
>>  From: Markus Loecher <loecher at eden.rutgers.edu>
>>  Subject: [R-sig-Geo] makeGrid(PBSmapping)
>>  To: r-sig-geo at stat.math.ethz.ch
>>  Message-ID: <20080228195805.F18A632408E at annwn13.rutgers.edu>
>>  Content-Type: text/plain; charset="us-ascii"; format=flowed
>>
>>  Dear geo experts,
>>  I am clearly misunderstanding the role of the projection argument in
>>  the wonderful utility makeGrid(PBSmapping).
>>  I had hoped that by setting projection ="LL" the resulting grid would
>>  be equidistant in "real" space, and hence curvilinear in lat/lon space.
>>  But the following code yields the identical, regular grid,
>>  irrespective of the projection argument:
>>
>>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>>  length=10), byrow = FALSE, addSID = TRUE, projection = "LL")
>>         plotMap(mypolys)
>>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>>  length=10), byrow = FALSE, addSID = TRUE, projection = 1)
>>         plotMap(mypolys)
>>
>>  Is there an easy way to create a rectangular grid in lat/lon space ?
>>  Should I first translate the points to UTM coordinates ?
>>
>>  Thanks!
>>
>>  Markus
>>
>>
>>
>>  ------------------------------
>>
>>  Message: 3
>>  Date: Fri, 29 Feb 2008 11:36:18 +0100
>>  From: "stefan lhachimi" <stefan.duke at gmail.com>
>>  Subject: [R-sig-Geo] Choice of Spatial weights
>>  To: r-sig-geo at stat.math.ethz.ch
>>  Message-ID:
>>         <a211af3b0802290236m53a12cd1h806a3106f508fb54 at mail.gmail.com>
>>  Content-Type: text/plain; charset=ISO-8859-1
>>
>>  Dear all,
>>
>>  as a matter of curiosity does anybody know literature which discusses
>>  what spatial weight to choose (e.g. k-nn, single or double
>>  contiguity)? Or has anybod a good rule of thumb?
>>  I found an article which proposes to try several specification and
>>  take either the one with the highest lambda  or the one with the best
>>  overall model fit (in a regression). But I think that is statistically
>>  speaking that is not very satisfactory, in particular if the
>>  application does not give any indication what weight to use.
>>
>>  Any hints?
>>  Best,
>>  Stefan
>>
>>
>>
>>  ------------------------------
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at stat.math.ethz.ch
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>  End of R-sig-Geo Digest, Vol 54, Issue 27
>>  *****************************************
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From munroe.9 at osu.edu  Sun Mar  2 22:18:24 2008
From: munroe.9 at osu.edu (Darla Munroe)
Date: Sun, 2 Mar 2008 16:18:24 -0500
Subject: [R-sig-Geo] Choice of Spatial weights
In-Reply-To: <Pine.LNX.4.64.0803022125410.30274@reclus.nhh.no>
References: <a211af3b0802290236m53a12cd1h806a3106f508fb54@mail.gmail.com>
	<Pine.LNX.4.64.0803022125410.30274@reclus.nhh.no>
Message-ID: <002901c87caa$f30a9260$36c29280@MUNROE>

Here's another paper that seems to support the idea that when in doubt, go
with a sparser representation:

R.J.G.M. Florax and S.J. Rey, The impacts of misspecified spatial weight
structures in linear regression models. In: L. Anselin and R.J.G.M. Florax,
Editors, New Directions in Spatial Econometrics, Springer Verlag, Berlin
(1995).

- DM

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Roger Bivand
Sent: Sunday, March 02, 2008 3:42 PM
To: stefan lhachimi
Cc: r-sig-geo at stat.math.ethz.ch
Subject: Re: [R-sig-Geo] Choice of Spatial weights

On Fri, 29 Feb 2008, stefan lhachimi wrote:

> Dear all,
>
> as a matter of curiosity does anybody know literature which discusses
> what spatial weight to choose (e.g. k-nn, single or double
> contiguity)? Or has anybod a good rule of thumb?

There are papers by Daniel Griffith, and one by Francois Bavaud, both 
prefer sparse to denser. This one is online:

http://www.unil.ch/webdav/site/imm/users/fbavaud/private/spatialweights_bava
ud.pdf

> I found an article which proposes to try several specification and
> take either the one with the highest lambda  or the one with the best
> overall model fit (in a regression). But I think that is statistically
> speaking that is not very satisfactory, in particular if the
> application does not give any indication what weight to use.

Yes, this is a grey area, where different disciplines approach things 
differently. Looking at the data many times is of course a problem. Not 
infrequently, the "accepted" type of weights for a discipline is the one 
chosen, but this isn't a satisfactory answer. Opinions?

Roger

>
> Any hints?
> Best,
> Stefan
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Brendan.Dooher at lfr.com  Mon Mar  3 22:00:06 2008
From: Brendan.Dooher at lfr.com (Dooher, Brendan)
Date: Mon, 3 Mar 2008 13:00:06 -0800
Subject: [R-sig-Geo] kriging -- grass -- asciigrid
In-Reply-To: <Pine.LNX.4.64.0803022143050.30274@reclus.nhh.no>
Message-ID: <77C4ED0F55F3B9489E805C60AAD3EA7401DDEF1A@ex-northwest.HQ.LFR.AD>

Hi all...
Is there a package that can match two sets of spatial points?  I have an
old set of files that were digitized into a local coordinate system, and
a newer set of files that have been gps'd.  The IDs between the two
don't match, there may be more points in the gps'd data, and of course,
there's uncertainty (even in the gps'd data! - but we'll assume its
"perfect")....
Any ideas?
Regards,
Brendan Dooher
brendan.dooher at lfr.com

This message (including any attachments) is intended onl...{{dropped:19}}



From jefunes at gmail.com  Mon Mar  3 23:13:18 2008
From: jefunes at gmail.com (Jose Funes)
Date: Mon, 3 Mar 2008 17:13:18 -0500
Subject: [R-sig-Geo] kriging -- grass -- asciigrid
In-Reply-To: <Pine.LNX.4.64.0803022143050.30274@reclus.nhh.no>
References: <8e01f5830802291621q49950373u9d65a83e7c813154@mail.gmail.com>
	<Pine.LNX.4.64.0803022143050.30274@reclus.nhh.no>
Message-ID: <8e01f5830803031413x5b7ef492xddfbed24a1621282@mail.gmail.com>

Rogers,

It worked great, the function writeAsciiGrid() from maptools. My goal
was to export it as Arc ASCII file.

Thanks,

Jose

On Sun, Mar 2, 2008 at 3:51 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 29 Feb 2008, Jose Funes wrote:
>
>  > Dear members,
>  >
>  > I have tried to export a kriging map to arcgis as asciigrid or image.
>  > I have used the functions write.asciigrid and writeRast6sp(grass), in
>  > both cases any success; In the former when exporting it, I got the
>  > following message " Asciigrid does not support grids with non-square
>  > cells".
>
>  Please quote your exact code. The function writeAsciiGrid() in maptools
>  will probably work, while write.asciigrid() in sp (which we ought to
>  deprecate, pointing to maptools) does not. The problem is machine fuzz,
>  the 90.0 values probably differ by 1e-16 or some other small amount -
>  writeAsciiGrid() tests and corrects for the fuzz.
>
>
>  > I checked for the krige map topology characteristics using the
>  > following code:
>  > getGridTopology(lidekri)
>  >
>  > Apparently cell size looks fine: see below
>  >
>  >                         s1       s2
>  > cellcentre.offset -363565.9 175563.0
>  > cellsize               90.0     90.0
>  > cells.dim             804.0   1236.0
>  >
>  > For the writeRast6sp function from "spgrass6" library
>  >
>  > writeRast6sp(lidekri,"lidekri",zcol="var1.pred",NODATA=-9999),
>  >
>
>  Was your goal to write an Arc ASCII grid as a file, or to write the data
>  to GRASS?
>
>  Did you try writeRAST6() in spgrass6, which uses other file formats?
>
>  Did you try the Arc ASCII grid driver "AAIGrid" with writeGDAL() in rgdal?
>
>  Hope this helps,
>
>  Roger
>
>
>
>  > I got the following message error
>  >
>  > "Error in system(paste(paste("g.tempfile", .addexe(), sep = ""),
>  > "pid=",  :  g.tempfilepid=421 not found"
>  >
>  > I will greatly appreciate any suggestions to get around this technical problem.
>  >
>  > Sincerely,
>  >
>  > Jose Funes
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  >
>  > On Fri, Feb 29, 2008 at 6:00 AM,  <r-sig-geo-request at stat.math.ethz.ch> wrote:
>  >> Send R-sig-Geo mailing list submissions to
>  >>         r-sig-geo at stat.math.ethz.ch
>  >>
>  >>  To subscribe or unsubscribe via the World Wide Web, visit
>  >>         https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  >>  or, via email, send a message with subject or body 'help' to
>  >>         r-sig-geo-request at stat.math.ethz.ch
>  >>
>  >>  You can reach the person managing the list at
>  >>         r-sig-geo-owner at stat.math.ethz.ch
>  >>
>  >>  When replying, please edit your Subject line so it is more specific
>  >>  than "Re: Contents of R-sig-Geo digest..."
>  >>
>  >>
>  >>  Today's Topics:
>  >>
>  >>    1. estimates for paths of travel given two time series,      drawn
>  >>       from two corresponding spatial densities (Galkowski, Jan)
>  >>    2. makeGrid(PBSmapping) (Markus Loecher)
>  >>    3. Choice of Spatial weights (stefan lhachimi)
>  >>
>  >>
>  >>  ----------------------------------------------------------------------
>  >>
>  >>  Message: 1
>  >>  Date: Thu, 28 Feb 2008 13:58:49 -0500
>  >>  From: "Galkowski, Jan" <jgalkows at akamai.com>
>  >>  Subject: [R-sig-Geo] estimates for paths of travel given two time
>  >>         series, drawn from two corresponding spatial densities
>  >>  To: <r-sig-geo at stat.math.ethz.ch>
>  >>  Message-ID:
>  >>         <76EB4827B2104D40AE7E43AA5D8582EA011A9D32 at MAVS1.kendall.corp.akamai.com>
>  >>
>  >>  Content-Type: text/plain
>  >>
>  >>  This is less an R question and more a request to the community for
>  >>  literature references and the like.
>  >>
>  >>  I'm interested in the following inferential question.  What's the max
>  >>  likelihood estimate for a path of travel of a point across a plane
>  >>  having stable, smooth densities of two separate variables given two time
>  >>  series of their values at the point as it moves?   Suppose all that's
>  >>  available is the ratio of the variables?
>  >>
>  >>  This is motivated by problems of inferring movement of biological
>  >>  specimens between nesting and migratory regions, or the problem of
>  >>  recovery of travel given the technique described here:
>  >>
>  >>     http://www.pnas.org/cgi/content/abstract/105/8/2788
>  >>
>  >>  Despite that, are there R packages which might help this?  I ask because
>  >>  I often find real gems buried within many R packages, gems which aren't
>  >>  obviously related to their primary subject.
>  >>
>  >>  Thanks much.
>  >>
>  >>         [[alternative HTML version deleted]]
>  >>
>  >>
>  >>
>  >>  ------------------------------
>  >>
>  >>  Message: 2
>  >>  Date: Thu, 28 Feb 2008 15:00:28 -0500
>  >>  From: Markus Loecher <loecher at eden.rutgers.edu>
>  >>  Subject: [R-sig-Geo] makeGrid(PBSmapping)
>  >>  To: r-sig-geo at stat.math.ethz.ch
>  >>  Message-ID: <20080228195805.F18A632408E at annwn13.rutgers.edu>
>  >>  Content-Type: text/plain; charset="us-ascii"; format=flowed
>  >>
>  >>  Dear geo experts,
>  >>  I am clearly misunderstanding the role of the projection argument in
>  >>  the wonderful utility makeGrid(PBSmapping).
>  >>  I had hoped that by setting projection ="LL" the resulting grid would
>  >>  be equidistant in "real" space, and hence curvilinear in lat/lon space.
>  >>  But the following code yields the identical, regular grid,
>  >>  irrespective of the projection argument:
>  >>
>  >>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>  >>  length=10), byrow = FALSE, addSID = TRUE, projection = "LL")
>  >>         plotMap(mypolys)
>  >>         mypolys <- makeGrid(x= seq(-123,-122,length=10), y = seq(33, 34,
>  >>  length=10), byrow = FALSE, addSID = TRUE, projection = 1)
>  >>         plotMap(mypolys)
>  >>
>  >>  Is there an easy way to create a rectangular grid in lat/lon space ?
>  >>  Should I first translate the points to UTM coordinates ?
>  >>
>  >>  Thanks!
>  >>
>  >>  Markus
>  >>
>  >>
>  >>
>  >>  ------------------------------
>  >>
>  >>  Message: 3
>  >>  Date: Fri, 29 Feb 2008 11:36:18 +0100
>  >>  From: "stefan lhachimi" <stefan.duke at gmail.com>
>  >>  Subject: [R-sig-Geo] Choice of Spatial weights
>  >>  To: r-sig-geo at stat.math.ethz.ch
>  >>  Message-ID:
>  >>         <a211af3b0802290236m53a12cd1h806a3106f508fb54 at mail.gmail.com>
>  >>  Content-Type: text/plain; charset=ISO-8859-1
>  >>
>  >>  Dear all,
>  >>
>  >>  as a matter of curiosity does anybody know literature which discusses
>  >>  what spatial weight to choose (e.g. k-nn, single or double
>  >>  contiguity)? Or has anybod a good rule of thumb?
>  >>  I found an article which proposes to try several specification and
>  >>  take either the one with the highest lambda  or the one with the best
>  >>  overall model fit (in a regression). But I think that is statistically
>  >>  speaking that is not very satisfactory, in particular if the
>  >>  application does not give any indication what weight to use.
>  >>
>  >>  Any hints?
>  >>  Best,
>  >>  Stefan
>  >>
>  >>
>  >>
>  >>  ------------------------------
>  >>
>  >>  _______________________________________________
>  >>  R-sig-Geo mailing list
>  >>  R-sig-Geo at stat.math.ethz.ch
>  >>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  >>
>  >>
>  >>  End of R-sig-Geo Digest, Vol 54, Issue 27
>  >>  *****************************************
>  >>
>  >
>  > _______________________________________________
>  > R-sig-Geo mailing list
>  > R-sig-Geo at stat.math.ethz.ch
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  >
>
>  --
>  Roger Bivand
>  Economic Geography Section, Department of Economics, Norwegian School of
>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  e-mail: Roger.Bivand at nhh.no
>
>



From Brendan.Dooher at lfr.com  Mon Mar  3 23:25:58 2008
From: Brendan.Dooher at lfr.com (Dooher, Brendan)
Date: Mon, 3 Mar 2008 14:25:58 -0800
Subject: [R-sig-Geo] Point pattern match
In-Reply-To: <77C4ED0F55F3B9489E805C60AAD3EA7401DDEF1A@ex-northwest.HQ.LFR.AD>
Message-ID: <77C4ED0F55F3B9489E805C60AAD3EA7401DDEF1C@ex-northwest.HQ.LFR.AD>

I apologize for the repost - I noticed that I didn't change the header -
not sure it would make a difference...
Hi all...
Is there a package that can match two sets of spatial points?  I have an
old set of files that were digitized into a local coordinate system, and
a newer set of files that have been gps'd.  The IDs between the two
don't match, there may be more points in the gps'd data, and of course,
there's uncertainty (even in the gps'd data! - but we'll assume its
"perfect")....
Any ideas?
Regards,
Brendan Dooher
brendan.dooher at lfr.com


This message (including any attachments) is intended onl...{{dropped:19}}



From jefunes at gmail.com  Mon Mar  3 23:35:36 2008
From: jefunes at gmail.com (Jose Funes)
Date: Mon, 3 Mar 2008 17:35:36 -0500
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
Message-ID: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com>

Dear members,

I would like to share some of the problems that I have run into R when
importing ascii files. I described the problem below, if any have
experienced similar issues I will appreciate you support.

I am working with raster data(maps) and importing it as ascii files to
R. I am stacking 9 layers (10MB~each, total 90MB). However, when
stacking the eight layer I get the following message "Error: cannot
allocate vector of size 10.8 Mb". I did a little of bit of reading
about this, and some suggestions are to increase the memory
allocation. I increased it to 3GB  using the following command:
memory.limit(size=3000) but the problem still persist.

code:
1. predictorslide2 <- readAsciiGrid("sol_spr_lide2.asc")
...
...
8. predictorslide2 <- cbind(predictorslide2,readAsciiGrid("umca_pr_lide2.asc"))

Also I got a similar error when running regression kriging:
Error: cannot allocate vector of size 6.7 Mb
In addition: There were 12 warnings (use warnings() to see them)

warning messages:
1: Reached total allocation of 1535Mb: see help(memory.size)
...
3: In slot(value, what) <- slot(from, what) :
...
8: In slot(value, what) <- slot(from, what) :
  Reached total allocation of 1535Mb: see help(memory.size)
...
12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
  Reached total allocation of 1535Mb: see help(memory.size)

I will appreciate your suggestions. I have also considered splitting
the data  but would like to explore other solutions.

Regards,

Jose Funes



From Roger.Bivand at nhh.no  Tue Mar  4 09:07:01 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Mar 2008 09:07:01 +0100 (CET)
Subject: [R-sig-Geo] Point pattern match
In-Reply-To: <77C4ED0F55F3B9489E805C60AAD3EA7401DDEF1C@ex-northwest.HQ.LFR.AD>
References: <77C4ED0F55F3B9489E805C60AAD3EA7401DDEF1C@ex-northwest.HQ.LFR.AD>
Message-ID: <Pine.LNX.4.64.0803040858080.3689@reclus.nhh.no>

On Mon, 3 Mar 2008, Dooher, Brendan wrote:

> I apologize for the repost - I noticed that I didn't change the header -
> not sure it would make a difference...

It makes two big differences:

1) the subject is misleading if not suited to the contents, but worse is:

2) mailing lists are threaded, which means that if you start a new thread 
by replying to a posting in an existing thread, even if you change the 
subject. This is what you have done this time - the thread ID is one of 
the many header lines in mailing list messages, and cannot (easily) be 
changed by the user.

See:

http://news.gmane.org/gmane.comp.lang.r.geo

for a threaded view - this exchange is still threaded with the original 
posting. Thread discipline is crucial for the value of the archives to 
others - questions are _NOT_ only single exchanges, but are accummulated 
knowledge that others can search and use.

Please start a completely new message, and maybe we can resolve your real 
question.

Roger


> Hi all...
> Is there a package that can match two sets of spatial points?  I have an
> old set of files that were digitized into a local coordinate system, and
> a newer set of files that have been gps'd.  The IDs between the two
> don't match, there may be more points in the gps'd data, and of course,
> there's uncertainty (even in the gps'd data! - but we'll assume its
> "perfect")....
> Any ideas?
> Regards,
> Brendan Dooher
> brendan.dooher at lfr.com
>
>
> This message (including any attachments) is intended o...{{dropped:16}}



From Roger.Bivand at nhh.no  Tue Mar  4 09:48:56 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Mar 2008 09:48:56 +0100 (CET)
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
In-Reply-To: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com>
References: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no>

On Mon, 3 Mar 2008, Jose Funes wrote:

> Dear members,
>
> I would like to share some of the problems that I have run into R when
> importing ascii files. I described the problem below, if any have
> experienced similar issues I will appreciate you support.
>
> I am working with raster data(maps) and importing it as ascii files to
> R. I am stacking 9 layers (10MB~each, total 90MB). However, when
> stacking the eight layer I get the following message "Error: cannot
> allocate vector of size 10.8 Mb". I did a little of bit of reading
> about this, and some suggestions are to increase the memory
> allocation. I increased it to 3GB  using the following command:
> memory.limit(size=3000) but the problem still persist.
>

Which platform? Windows? Its performance is systematically worse than 
other OS on the same hardware. When you say 10Mb, is this 8 bytes * 
roughly 1.2 million cells? Are you running gc() between calls to 
readAsciiGrid() to force garbage collection? While readAsciiGrid() is 
working, I think that at least three copies of the data are in memory.

Have you tried using rgdal? Maybe readGDAL() keeps fewer internal copies? 
(in readGDAL, that may be at least two copies, but I'm not sure (NAs are 
handled by GDAL)). Because input needs to be converted from representation 
to representation, it is not possible to avoid multiple copies.

> code:
> 1. predictorslide2 <- readAsciiGrid("sol_spr_lide2.asc")
> ...
> ...
> 8. predictorslide2 <- cbind(predictorslide2,readAsciiGrid("umca_pr_lide2.asc"))
>

It may be possible to get round cbind() copying if that turns out to be 
the problem, by taking the SpatialGrid from the first read, putting it 
aside, and storing the single columns of the data slots of read data in a 
single, pre-allocated data frame. Re-allocating to predictorslide2 
successively is not a good idea for large objects - Braun & Murdoch in 
their nice book on R programming treat it as a worst case on speed and 
memory usage.


> Also I got a similar error when running regression kriging:
> Error: cannot allocate vector of size 6.7 Mb

Without the command, this isn't informative. Were you using local areas 
(maximum distance or # data points)? How large were the data= and newdata= 
objects?

Roger

> In addition: There were 12 warnings (use warnings() to see them)
>
> warning messages:
> 1: Reached total allocation of 1535Mb: see help(memory.size)
> ...
> 3: In slot(value, what) <- slot(from, what) :
> ...
> 8: In slot(value, what) <- slot(from, what) :
>  Reached total allocation of 1535Mb: see help(memory.size)
> ...
> 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
>  Reached total allocation of 1535Mb: see help(memory.size)
>
> I will appreciate your suggestions. I have also considered splitting
> the data  but would like to explore other solutions.
>
> Regards,
>
> Jose Funes
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Mar  4 10:38:42 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Mar 2008 10:38:42 +0100 (CET)
Subject: [R-sig-Geo] Plotting continuous data (gridded) clipped to shape
 boundary
In-Reply-To: <47C58865.6040604@wisc.edu>
References: <47C58865.6040604@wisc.edu>
Message-ID: <Pine.LNX.4.64.0803041033230.3689@reclus.nhh.no>

On Wed, 27 Feb 2008, Shawn P. Serbin wrote:

> All,
>
> I was hoping there was someone (or several folks) who could assist me. I
> have spent some time lately trying to figure out a way to plot gridded
> data in Latitude and Longitude values with a map overlay and ultimately
> the gridded data would be clipped to the boundary of the map, i.e. a
> Wisconsin state boundary shapefile (either custom or from the maps
> package). The idea is to create code that can inject netCDF output and
> quickly create maps that can be used in presentations/publications.
>
> I have cleared the first hurdle (well not really a hurdle) and have a
> pretty clean way of importing the netCDF files into R arrays, vectors,
> data.frames (I guess these would be considered Spatial.data.frames)
> which I can then manipulate.
>
> The problem lies with the actual mapping. Now I can easily map the data
> in the Lattice package(s) and display a very nice, custom legend bar
> with contour overlays. However, when I try to use ?image? in the
> spatstat package either 1) I can only view the data on a standard grid
> (i.e. 0 to 1 in the x and y) or 2) I get an error message letting me
> know that ?expecting increasing x and y? or 3) ?x does not increase
> consistently?

It is not impossible that the difficulties come from mixing projected and 
geographical coordinates. Could you please try to show is your problem as 
code, say using volcano? Could you also say what you mean by "clipping" - 
do you mean painting over the areas outside Wisconsin with background 
colour? Or do you mean setting the grid cells falling outside Wisconsin to 
NA, and omitting them from the display?

If the polygon is a SpatialPolygons object, and the data are a 
SpatialGridDataFrame or SpatialPixelsDataFrame in the same coordinate 
reference system, overlay() methods in sp will do this. If not in the same 
CRS, use spTransform() on the SpatialPolygons object to get it to the grid 
CRS. For obvious reasons, you cannot transform the CRS of the grid.

Roger

>
> Again, I have tried many mapping and spatial packages but have yet to
> find one that can handle the lat and long as well as clipping to a
> boundary. Now I have seen an example on the web where using image you
> can create a binary mask (i.e. meuse) but have yet to see how I can get
> this to work with a vector shapefile. If I could get this to work with
> plotting lat and long in image I think I would be good to go.
> Alternatively, if there is a package that can handle what I am looking
> to do then that would be great as well. It seems however that I am
> having difficulty getting the data in the correct format and / or using
> the correct plotting.
>
> What I would like to do is something similar to the ?volcano? demo where
> I plot the gridded data (in native 8km grid cell resolution) then
> overlay contours of my chosen spacing and the clip the data to
> Wisconsin, with Lat and Long x and y and a legend bar.
>
> Thanks in advance to any and all who are better at this than me!
>
> Shawn
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Tue Mar  4 11:21:08 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Mar 2008 11:21:08 +0100 (CET)
Subject: [R-sig-Geo] class ker (ks) --> conversion --> raster
In-Reply-To: <874pbtddt5.fsf@sympatico.ca>
References: <874pbtddt5.fsf@sympatico.ca>
Message-ID: <Pine.LNX.4.64.0803041115210.3689@reclus.nhh.no>

On Wed, 27 Feb 2008, Nicolas Bergeron wrote:

> Hi All,
>
> I'm searching for the method to convert a class ker (library(ks)) to the 
> format raster. Can you suggest a possible solution?
>
> This code produces the object of class ker:
>
> # Modules
> library(ks)
>
> # xy
> xy <- as.matrix(loc[loc$ID_animal == 2004021,c("x","y")])
>
> # HPI-SCALE
> HpiScale <- Hpi(x=xy, pilot="samse", pre="scale")
> fhat.HpiScale <- kde(x=xy, H = HpiScale)

So far so good - an example:

library(ks)
library(sp)
data(meuse)
xy <- cbind(meuse$x, meuse$y)
HpiScale <- Hpi(x=xy, pilot="samse", pre="scale")
fhat.HpiScale <- kde(x=xy, H = HpiScale)
plot(fhat.HpiScale)
im <- list(x=fhat.HpiScale$eval.points[[1]],
  y=fhat.HpiScale$eval.points[[2]], z=fhat.HpiScale$estimate)
# make an image-style list
image(im)
contour(im)
SPim <- image2Grid(im)
# convert the image-style list to a SpatialGridDataFrame object,
# thanks to Mike Sumner for code now in sp
image(SPim)

So now we have a SpatialGridDataFrame (note that the values are very 
small, consider re-scaling).

>From there, look at writeAsciiGrid() in maptools to write an Arc ASCII 
grid (r.in.arc in GRASS), writeGDAL() in rgdal and r.in.gdal in GRASS with 
a suitable driver, or writeRAST6() in spgrass6 to write a 
SpatialGridDataFrame to GRASS using temporary files.

Hope this helps,

Roger

>
> # Code for conversion
> # Export {XY=long,lat, Z=fhat} --> GRASS (r.in.xyz)
> XY <- data.frame(x=fhat.HpiScale[[2]][[1]],y=fhat.HpiScale[[2]][[2]])
> Z <- fhat.HpiScale[[3]]
>
> ... suggestions will appreciate or  others methods to write a text file
> of X,Y coordinates and Z value.
>
> after that, in GRASS-GIS r.in.xyz
>
> Thank's
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From igciliza at waikato.ac.nz  Tue Mar  4 22:35:37 2008
From: igciliza at waikato.ac.nz (Liza Koshy)
Date: Wed, 5 Mar 2008 10:35:37 +1300
Subject: [R-sig-Geo] ArcGIS raster/vector to SPATSTATS im image file
	conversion
Message-ID: <15CCFEF7F0514C4A9883D8451008BC0A01100D1C@ex2.its.waikato.ac.nz>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080305/8b37c225/attachment.pl>

From dylan.beaudette at gmail.com  Wed Mar  5 01:21:30 2008
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Tue, 4 Mar 2008 16:21:30 -0800
Subject: [R-sig-Geo] spplot with two rasters
Message-ID: <200803041621.30538.dylan.beaudette@gmail.com>


Hi,

Is it possible to plot two raster images using spplot() in a manner similar 
to:

pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))

Note that one of the raster images is an aerial photo, used only for context, 
while the second one is one with interesting z-values. The second raster is 
masked and thus does not cover the entire region.

Thanks,

Dylan


-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341



From jefunes at gmail.com  Wed Mar  5 01:45:56 2008
From: jefunes at gmail.com (Jose Funes)
Date: Tue, 4 Mar 2008 19:45:56 -0500
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
In-Reply-To: <Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no>
References: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com>
	<Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no>
Message-ID: <8e01f5830803041645lc0f3207l5e6020334fde4435@mail.gmail.com>

Roger,

I am running it in Windows and is 8 bytes. I tried to use the gc() for
the regression kriging but it did not work, instead I did employ the
gctorture() that turn "R" to run extremely slow (it is still running,
almost 8 hours so far, it may finish tomorrow). For the regression
kriging, I am using 163 data points:

R code: Regression kriging
 ystrk = krige(yststep$call$formula,ystdec3,predictors,vgf1yst)

where:
yststep: is the regression residual
ystdec3: are the data points (163 points)
predictors: are the asciigrid file containing the predictor variables
(9 raster layers)
vgf1yst: fitted variogram

error message:
In addition: There were 12 warnings (use warnings() to see them)

warning messages:
1: Reached total allocation of 1535Mb: see help(memory.size)
 ...
3: In slot(value, what) <- slot(from, what) :
 ...
8: In slot(value, what) <- slot(from, what) :
Reached total allocation of 1535Mb: see help(memory.size)
...
12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
Reached total allocation of 1535Mb: see help(memory.size)


Is there another way to get around garbage collection than gctorture().?

Sincerely,

Jose




On Tue, Mar 4, 2008 at 3:48 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Mon, 3 Mar 2008, Jose Funes wrote:
>
>  > Dear members,
>  >
>  > I would like to share some of the problems that I have run into R when
>  > importing ascii files. I described the problem below, if any have
>  > experienced similar issues I will appreciate you support.
>  >
>  > I am working with raster data(maps) and importing it as ascii files to
>  > R. I am stacking 9 layers (10MB~each, total 90MB). However, when
>  > stacking the eight layer I get the following message "Error: cannot
>  > allocate vector of size 10.8 Mb". I did a little of bit of reading
>  > about this, and some suggestions are to increase the memory
>  > allocation. I increased it to 3GB  using the following command:
>  > memory.limit(size=3000) but the problem still persist.
>  >
>
>  Which platform? Windows? Its performance is systematically worse than
>  other OS on the same hardware. When you say 10Mb, is this 8 bytes *
>  roughly 1.2 million cells? Are you running gc() between calls to
>  readAsciiGrid() to force garbage collection? While readAsciiGrid() is
>  working, I think that at least three copies of the data are in memory.
>
>  Have you tried using rgdal? Maybe readGDAL() keeps fewer internal copies?
>  (in readGDAL, that may be at least two copies, but I'm not sure (NAs are
>  handled by GDAL)). Because input needs to be converted from representation
>  to representation, it is not possible to avoid multiple copies.
>
>
>  > code:
>  > 1. predictorslide2 <- readAsciiGrid("sol_spr_lide2.asc")
>  > ...
>  > ...
>  > 8. predictorslide2 <- cbind(predictorslide2,readAsciiGrid("umca_pr_lide2.asc"))
>  >
>
>  It may be possible to get round cbind() copying if that turns out to be
>  the problem, by taking the SpatialGrid from the first read, putting it
>  aside, and storing the single columns of the data slots of read data in a
>  single, pre-allocated data frame. Re-allocating to predictorslide2
>  successively is not a good idea for large objects - Braun & Murdoch in
>  their nice book on R programming treat it as a worst case on speed and
>  memory usage.
>
>
>
>  > Also I got a similar error when running regression kriging:
>  > Error: cannot allocate vector of size 6.7 Mb
>
>  Without the command, this isn't informative. Were you using local areas
>  (maximum distance or # data points)? How large were the data= and newdata=
>  objects?
>
>  Roger
>
>
>  > In addition: There were 12 warnings (use warnings() to see them)
>  >
>  > warning messages:
>  > 1: Reached total allocation of 1535Mb: see help(memory.size)
>  > ...
>  > 3: In slot(value, what) <- slot(from, what) :
>  > ...
>  > 8: In slot(value, what) <- slot(from, what) :
>  >  Reached total allocation of 1535Mb: see help(memory.size)
>  > ...
>  > 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
>  >  Reached total allocation of 1535Mb: see help(memory.size)
>  >
>  > I will appreciate your suggestions. I have also considered splitting
>  > the data  but would like to explore other solutions.
>  >
>  > Regards,
>  >
>  > Jose Funes
>  >
>  > _______________________________________________
>  > R-sig-Geo mailing list
>  > R-sig-Geo at stat.math.ethz.ch
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  >
>
>  --
>  Roger Bivand
>  Economic Geography Section, Department of Economics, Norwegian School of
>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  e-mail: Roger.Bivand at nhh.no
>
>



From nicolas.bergeron at sympatico.ca  Wed Mar  5 05:29:34 2008
From: nicolas.bergeron at sympatico.ca (Nicolas Bergeron)
Date: Tue, 04 Mar 2008 23:29:34 -0500
Subject: [R-sig-Geo] class ker (ks) --> conversion --> raster
References: <874pbtddt5.fsf@sympatico.ca>
	<Pine.LNX.4.64.0803041115210.3689@reclus.nhh.no>
Message-ID: <87abldkd3l.fsf@sympatico.ca>

Roger Bivand <Roger.Bivand at nhh.no> writes:

> On Wed, 27 Feb 2008, Nicolas Bergeron wrote:
>
>> Hi All,
>>
>> I'm searching for the method to convert a class ker (library(ks)) to
>> the format raster. Can you suggest a possible solution?
>>
>> This code produces the object of class ker:
>>
>> # Modules
>> library(ks)
>>
>> # xy
>> xy <- as.matrix(loc[loc$ID_animal == 2004021,c("x","y")])
>>
>> # HPI-SCALE
>> HpiScale <- Hpi(x=xy, pilot="samse", pre="scale")
>> fhat.HpiScale <- kde(x=xy, H = HpiScale)
>
> So far so good - an example:
>
> library(ks)
> library(sp)
> data(meuse)
> xy <- cbind(meuse$x, meuse$y)
> HpiScale <- Hpi(x=xy, pilot="samse", pre="scale")
> fhat.HpiScale <- kde(x=xy, H = HpiScale)
> plot(fhat.HpiScale)
> im <- list(x=fhat.HpiScale$eval.points[[1]],
>  y=fhat.HpiScale$eval.points[[2]], z=fhat.HpiScale$estimate)
> # make an image-style list
> image(im)
> contour(im)
> SPim <- image2Grid(im)
> # convert the image-style list to a SpatialGridDataFrame object,
> # thanks to Mike Sumner for code now in sp
> image(SPim)
>
> So now we have a SpatialGridDataFrame (note that the values are very
> small, consider re-scaling).
>
> From there, look at writeAsciiGrid() in maptools to write an Arc ASCII
> grid (r.in.arc in GRASS), writeGDAL() in rgdal and r.in.gdal in GRASS
> with a suitable driver, or writeRAST6() in spgrass6 to write a
> SpatialGridDataFrame to GRASS using temporary files.

M. Bivand,

Your  suggestion to  convert the  class kde  with sp  package  is very
effectual.

Thank's for your help!

Salutations

-- 
NicBer



From Roger.Bivand at nhh.no  Wed Mar  5 08:08:29 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Mar 2008 08:08:29 +0100 (CET)
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
In-Reply-To: <8e01f5830803041645lc0f3207l5e6020334fde4435@mail.gmail.com>
References: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com> 
	<Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no>
	<8e01f5830803041645lc0f3207l5e6020334fde4435@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803050756410.6584@reclus.nhh.no>

On Tue, 4 Mar 2008, Jose Funes wrote:

> Roger,
>
> I am running it in Windows and is 8 bytes. I tried to use the gc() for
> the regression kriging but it did not work, instead I did employ the
> gctorture() that turn "R" to run extremely slow (it is still running,
> almost 8 hours so far, it may finish tomorrow). For the regression
> kriging, I am using 163 data points:
>
> R code: Regression kriging
> ystrk = krige(yststep$call$formula,ystdec3,predictors,vgf1yst)
>
> where:
> yststep: is the regression residual
> ystdec3: are the data points (163 points)
> predictors: are the asciigrid file containing the predictor variables
> (9 raster layers)
> vgf1yst: fitted variogram

But no use of maxdist= or nmax=? I would have said:

g1 <- gstat(formula=yststep$call$formula, data=ystdec3, model=vgf1yst)
ystrk <- predict(g1, newdata=predictors)

anyway, which shows exactly how to resolve the problem - subset ystdec3 
into tiles and patch them together again afterwards (patching may need 
thinking through clearly). I assume that you have now successfully read in 
the predictors? Do I understand that you are calibrating your model on 163 
observations, and predicting for roughly four orders of magnitude more 
grid cells?

gc() can help to clean out garbage sometimes - say in a loop, gctorture() 
really only during development, not in regular use.

Roger

>
> error message:
> In addition: There were 12 warnings (use warnings() to see them)
>
> warning messages:
> 1: Reached total allocation of 1535Mb: see help(memory.size)
> ...
> 3: In slot(value, what) <- slot(from, what) :
> ...
> 8: In slot(value, what) <- slot(from, what) :
> Reached total allocation of 1535Mb: see help(memory.size)
> ...
> 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
> Reached total allocation of 1535Mb: see help(memory.size)
>
>
> Is there another way to get around garbage collection than gctorture().?
>
> Sincerely,
>
> Jose
>
>
>
>
> On Tue, Mar 4, 2008 at 3:48 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Mon, 3 Mar 2008, Jose Funes wrote:
>>
>> > Dear members,
>> >
>> > I would like to share some of the problems that I have run into R when
>> > importing ascii files. I described the problem below, if any have
>> > experienced similar issues I will appreciate you support.
>> >
>> > I am working with raster data(maps) and importing it as ascii files to
>> > R. I am stacking 9 layers (10MB~each, total 90MB). However, when
>> > stacking the eight layer I get the following message "Error: cannot
>> > allocate vector of size 10.8 Mb". I did a little of bit of reading
>> > about this, and some suggestions are to increase the memory
>> > allocation. I increased it to 3GB  using the following command:
>> > memory.limit(size=3000) but the problem still persist.
>> >
>>
>>  Which platform? Windows? Its performance is systematically worse than
>>  other OS on the same hardware. When you say 10Mb, is this 8 bytes *
>>  roughly 1.2 million cells? Are you running gc() between calls to
>>  readAsciiGrid() to force garbage collection? While readAsciiGrid() is
>>  working, I think that at least three copies of the data are in memory.
>>
>>  Have you tried using rgdal? Maybe readGDAL() keeps fewer internal copies?
>>  (in readGDAL, that may be at least two copies, but I'm not sure (NAs are
>>  handled by GDAL)). Because input needs to be converted from representation
>>  to representation, it is not possible to avoid multiple copies.
>>
>>
>> > code:
>> > 1. predictorslide2 <- readAsciiGrid("sol_spr_lide2.asc")
>> > ...
>> > ...
>> > 8. predictorslide2 <- cbind(predictorslide2,readAsciiGrid("umca_pr_lide2.asc"))
>> >
>>
>>  It may be possible to get round cbind() copying if that turns out to be
>>  the problem, by taking the SpatialGrid from the first read, putting it
>>  aside, and storing the single columns of the data slots of read data in a
>>  single, pre-allocated data frame. Re-allocating to predictorslide2
>>  successively is not a good idea for large objects - Braun & Murdoch in
>>  their nice book on R programming treat it as a worst case on speed and
>>  memory usage.
>>
>>
>>
>> > Also I got a similar error when running regression kriging:
>> > Error: cannot allocate vector of size 6.7 Mb
>>
>>  Without the command, this isn't informative. Were you using local areas
>>  (maximum distance or # data points)? How large were the data= and newdata=
>>  objects?
>>
>>  Roger
>>
>>
>> > In addition: There were 12 warnings (use warnings() to see them)
>> >
>> > warning messages:
>> > 1: Reached total allocation of 1535Mb: see help(memory.size)
>> > ...
>> > 3: In slot(value, what) <- slot(from, what) :
>> > ...
>> > 8: In slot(value, what) <- slot(from, what) :
>> >  Reached total allocation of 1535Mb: see help(memory.size)
>> > ...
>> > 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,  ... :
>> >  Reached total allocation of 1535Mb: see help(memory.size)
>> >
>> > I will appreciate your suggestions. I have also considered splitting
>> > the data  but would like to explore other solutions.
>> >
>> > Regards,
>> >
>> > Jose Funes
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at stat.math.ethz.ch
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>  --
>>  Roger Bivand
>>  Economic Geography Section, Department of Economics, Norwegian School of
>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>  e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From edzer.pebesma at uni-muenster.de  Wed Mar  5 08:32:21 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 05 Mar 2008 08:32:21 +0100
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <200803041621.30538.dylan.beaudette@gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>
Message-ID: <47CE4C85.2050303@uni-muenster.de>

I find it hard to imagine how you want to plot two raster files on top 
of each other. Do you want some form of transparency? If it is just one 
overlaying the other, you could use overlay to find out which cells in 
raster 1 to replace with those in raster 2 before plotting.
--
Edzer

Dylan Beaudette wrote:
> Hi,
>
> Is it possible to plot two raster images using spplot() in a manner similar 
> to:
>
> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>
> Note that one of the raster images is an aerial photo, used only for context, 
> while the second one is one with interesting z-values. The second raster is 
> masked and thus does not cover the entire region.
>
> Thanks,
>
> Dylan
>
>
>



From Roger.Bivand at nhh.no  Wed Mar  5 08:34:31 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 5 Mar 2008 08:34:31 +0100 (CET)
Subject: [R-sig-Geo] ArcGIS raster/vector to SPATSTATS im image file
 conversion
In-Reply-To: <15CCFEF7F0514C4A9883D8451008BC0A01100D1C@ex2.its.waikato.ac.nz>
References: <15CCFEF7F0514C4A9883D8451008BC0A01100D1C@ex2.its.waikato.ac.nz>
Message-ID: <Pine.LNX.4.64.0803050809080.6584@reclus.nhh.no>

On Wed, 5 Mar 2008, Liza Koshy wrote:

> Hello,
>
> I would like to convert ArcGIS vector/raster grids to SPATSTATS image
> files (*.im files) and would like to know how this can be done.

Assuming vector is a point shapefile, use readOGR() in the rgdal package - 
points do not make im objects (not files) directly. Do you have a plan of 
your workflow? Is it something like:

1) read a shapefile of points and convert to a ppp object;
2) read a grid and convert to an im object to use as a window for the
   point pattern analysis;

The first one would be:

library(rgdal)
my_pts <- readOGR(dsn=".", layer="my_shp") # for my_shp.shp in current
                                            # directory
plot(my_pts)
library(maptools)
my_ppp <- as(as(my_pts, "SpatialPoints"), "ppp") # coerce to SpatialPoints
                                             # before coercion to ppp
                                             # unless you need marks
plot(my_ppp)

and the second:

my_grd <- readGDAL("my_grid") # for my_grid as full file name
image(my_grd)
plot(my_pts, add=TRUE)
my_im <- as(my_grd, "im") # note that my_grd should only have a single
                           # column
plot(my_im)

Are you thinking of using the im object values to represent inhomogeneity? 
Or are you going to use missing values to define the owin window object 
for the point process? If the latter, you may want to say:

summary(my_grd)
names(my_grd)

to see what is inside the object before coercing to an im object. If need 
be, set the single column values to NA for areas outside the required 
window.

Hope this helps,

Roger

>
> I have not used SPATSTATS before (I use ArcGIS regularly), however I
> would like to try spatial modelling of a point pattern in SPATSTATS,
> using a ArcGIS point pattern (shapefile) with environmental variables of
> climate, land cover, and landscape indicators (ArcGIS raster grids of
> either continuous or categorical data). I can also convert these grids
> to ASCII file formats also if that helps.
>

PS. From your description, it isn't clear that you have a viable work 
plan, or that point pattern analysis is appropriate. You have points 
(presence of something?) and rasters of environmental variables. Have you 
observed a point pattern in which interpoint distances are important, or 
just (some) points at which something has been observed? Do you have, for 
example, Fortin & Dale to hand, it might help?

>
>
> I would be grateful for any assistance you can provide.
>
>
>
> Kind regards,
>
>
>
> Liza Storey.
>
>
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dylan.beaudette at gmail.com  Wed Mar  5 18:45:30 2008
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Wed, 5 Mar 2008 09:45:30 -0800
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <47CE4C85.2050303@uni-muenster.de>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<47CE4C85.2050303@uni-muenster.de>
Message-ID: <200803050945.30314.dylan.beaudette@gmail.com>

On Tuesday 04 March 2008, Edzer Pebesma wrote:
> I find it hard to imagine how you want to plot two raster files on top
> of each other. Do you want some form of transparency? If it is just one
> overlaying the other, you could use overlay to find out which cells in
> raster 1 to replace with those in raster 2 before plotting.
> --
> Edzer

Hi Edzer,

I generally agree that plotting one raster file "over" another raster file 
would be of little use. In this case, one of the raster files (the 
interesting one) has been masked with nodata, such that it only really covers 
about 30% of the region of interest. The other raster is just contextual 
data, and thus would be useful to plot "behind" the first raster.

Ideas?

Dylan 

> Dylan Beaudette wrote:
> > Hi,
> >
> > Is it possible to plot two raster images using spplot() in a manner
> > similar to:
> >
> > pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
> > spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
> >
> > Note that one of the raster images is an aerial photo, used only for
> > context, while the second one is one with interesting z-values. The
> > second raster is masked and thus does not cover the entire region.
> >
> > Thanks,
> >
> > Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341



From dylan.beaudette at gmail.com  Wed Mar  5 19:14:49 2008
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Wed, 5 Mar 2008 10:14:49 -0800
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <2439f5740803051001w7cba8cecgeae2fc9038a00e2a@mail.gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803050945.30314.dylan.beaudette@gmail.com>
	<2439f5740803051001w7cba8cecgeae2fc9038a00e2a@mail.gmail.com>
Message-ID: <200803051014.49393.dylan.beaudette@gmail.com>

On Wednesday 05 March 2008, Steve Friedman wrote:
> My two cents
>
> This sounds like a GIS type operation rather than an analytical process
> model that requires R. If so use ARC/INFO

Right-- this is just a plotting operation. The spplot function is very useful 
when working with data in R, and it would be nice to produce a "finished" 
figure within the context of the R session. Writing the data back to the GIS 
and finishing the map there works, but the operation cannot be eloquently 
contained within an R source file.

> Does the "context" raster provide data in the sense of quantitative needs
> or is it a categorical raster that shows classes of information such as
> land use?

the context raster is just an aerial image. I would like to overplot 
the "interesting" raster.

Dylan

> Now - would it make more sense to combine these using some kind of union
> process (I don't know how to do this in R) to show the quantitative raster
> data in the categorical classes. Then you can delete the larger context
> raster which does not contain any information and reduce the window
> (spatial extent) of the overlaid model.
>
> Steve
>
> On Wed, Mar 5, 2008 at 12:45 PM, Dylan Beaudette
> <dylan.beaudette at gmail.com>
>
> wrote:
> > On Tuesday 04 March 2008, Edzer Pebesma wrote:
> > > I find it hard to imagine how you want to plot two raster files on top
> > > of each other. Do you want some form of transparency? If it is just one
> > > overlaying the other, you could use overlay to find out which cells in
> > > raster 1 to replace with those in raster 2 before plotting.
> > > --
> > > Edzer
> >
> > Hi Edzer,
> >
> > I generally agree that plotting one raster file "over" another raster
> > file would be of little use. In this case, one of the raster files (the
> > interesting one) has been masked with nodata, such that it only really
> > covers
> > about 30% of the region of interest. The other raster is just contextual
> > data, and thus would be useful to plot "behind" the first raster.
> >
> > Ideas?
> >
> > Dylan
> >
> > > Dylan Beaudette wrote:
> > > > Hi,
> > > >
> > > > Is it possible to plot two raster images using spplot() in a manner
> > > > similar to:
> > > >
> > > > pts <- list("sp.points", points_file, pch = 4, col = "black",
> > > > cex=0.5) spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
> > > >
> > > > Note that one of the raster images is an aerial photo, used only for
> > > > context, while the second one is one with interesting z-values. The
> > > > second raster is masked and thus does not cover the entire region.
> > > >
> > > > Thanks,
> > > >
> > > > Dylan
> >
> > --

-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341



From p.hiemstra at geo.uu.nl  Thu Mar  6 14:31:38 2008
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 06 Mar 2008 14:31:38 +0100
Subject: [R-sig-Geo] readGDAL does not close connections
Message-ID: <47CFF23A.4020205@geo.uu.nl>

Dear r-sig-geo list,

I'm struggeling with readGDAL (rgdal package) not closing its file 
connections (I suspect). I am trying to construct a timeseries of 
rainfall using the following loop (conceptual code):

pt = SpatialPoint()
rainfall = numeric(length = length(listofiles))
for(i in 1:length(listofiles)) {
    grid = readGDAL(listofiles[i])
    rainfall[i] = grd$value[overlay(grid, pt)]
}

There are more than 35000 grids (HDF5) that I loop over (2007 - 15 
minutes interval). After reading about 1000 grids my program fails:

HDF5:"radar/2007/01/11/RAD_NL21_PCP_NA_200701111515.h5"://image1/image_data 
has GDAL driver HDF5Image
and has 256 rows and 256 columns
Error in gzfile(file, "r") : unable to open connection
In addition: Warning message:
In gzfile(file, "r") :
  cannot open compressed file '/home/hiemstra/lib/R/rgdal/DESCRIPTION'

I suspect that readGDAL opens connections to the files, but does not 
close them and the program fails because too many files have been 
openened simultaneously. I do not get messages like "Closing GDAL 
dataset handle 0x8ff7900...  destroyed ... done." when I run the script. 
Does anybody on the r-sig-geo list have similar experiences?

kind regards,
Paul

ps Additional information on my session
 > sessionInfo()
R version 2.6.1 (2007-11-26)
i486-pc-linux-gnu

locale:
LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.5-24   maptools_0.7-7 foreign_0.8-23 automap_0.4-3  
classInt_0.1-9
[6] e1071_1.5-17   class_7.2-41   gstat_0.9-43   sp_0.9-23

loaded via a namespace (and not attached):
[1] grid_2.6.1      lattice_0.17-6  rcompgen_0.1-17

I run Debian Lenny

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From edzer.pebesma at uni-muenster.de  Thu Mar  6 15:32:49 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 06 Mar 2008 15:32:49 +0100
Subject: [R-sig-Geo] readGDAL does not close connections
In-Reply-To: <47CFF23A.4020205@geo.uu.nl>
References: <47CFF23A.4020205@geo.uu.nl>
Message-ID: <47D00091.20603@uni-muenster.de>

Paul Hiemstra wrote:
> I suspect that readGDAL opens connections to the files, but does not 
> close them and the program fails because too many files have been 
> openened simultaneously. I do not get messages like "Closing GDAL 
> dataset handle 0x8ff7900...  destroyed ... done." when I run the script. 
> Does anybody on the r-sig-geo list have similar experiences?
>
>   
Looking at readGDAL, it seems that GDAL.close is called on the open file 
handle before the data are returned. This should give you the handle ... 
destroyed ... messages for each file you open.

In the C code of package rgdal, I see reference to GDALOpen(), but not 
to GDALClose(). I guess it should?
--
Edzer



From Roger.Bivand at nhh.no  Thu Mar  6 15:42:00 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 6 Mar 2008 15:42:00 +0100 (CET)
Subject: [R-sig-Geo] readGDAL does not close connections
In-Reply-To: <47CFF23A.4020205@geo.uu.nl>
References: <47CFF23A.4020205@geo.uu.nl>
Message-ID: <Pine.LNX.4.64.0803061537370.12924@reclus.nhh.no>

On Thu, 6 Mar 2008, Paul Hiemstra wrote:

> Dear r-sig-geo list,
>
> I'm struggeling with readGDAL (rgdal package) not closing its file
> connections (I suspect). I am trying to construct a timeseries of
> rainfall using the following loop (conceptual code):
>
> pt = SpatialPoint()
> rainfall = numeric(length = length(listofiles))
> for(i in 1:length(listofiles)) {
>    grid = readGDAL(listofiles[i])
>    rainfall[i] = grd$value[overlay(grid, pt)]
> }
>
> There are more than 35000 grids (HDF5) that I loop over (2007 - 15
> minutes interval). After reading about 1000 grids my program fails:
>
> HDF5:"radar/2007/01/11/RAD_NL21_PCP_NA_200701111515.h5"://image1/image_data
> has GDAL driver HDF5Image
> and has 256 rows and 256 columns
> Error in gzfile(file, "r") : unable to open connection
> In addition: Warning message:
> In gzfile(file, "r") :
>  cannot open compressed file '/home/hiemstra/lib/R/rgdal/DESCRIPTION'

After an error like this, please also report what traceback() says. A 
connection is not an open file. I have just run a loop of 10000 readGDAL() 
without any connections left open - showConnections() shows open 
connections - and indeed as far as I know, readGDAL() does not itself use 
any connections mechanisms.

In your case, something is trying to read:

/home/hiemstra/lib/R/rgdal/DESCRIPTION

using a connections mechanism, but without traceback(), we don't know 
what.

Roger

>
> I suspect that readGDAL opens connections to the files, but does not
> close them and the program fails because too many files have been
> openened simultaneously. I do not get messages like "Closing GDAL
> dataset handle 0x8ff7900...  destroyed ... done." when I run the script.
> Does anybody on the r-sig-geo list have similar experiences?
>
> kind regards,
> Paul
>
> ps Additional information on my session
> > sessionInfo()
> R version 2.6.1 (2007-11-26)
> i486-pc-linux-gnu
>
> locale:
> LC_CTYPE=en_US.UTF-8;LC_NUMERIC=C;LC_TIME=en_US.UTF-8;LC_COLLATE=en_US.UTF-8;LC_MONETARY=en_US.UTF-8;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] rgdal_0.5-24   maptools_0.7-7 foreign_0.8-23 automap_0.4-3
> classInt_0.1-9
> [6] e1071_1.5-17   class_7.2-41   gstat_0.9-43   sp_0.9-23
>
> loaded via a namespace (and not attached):
> [1] grid_2.6.1      lattice_0.17-6  rcompgen_0.1-17
>
> I run Debian Lenny
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Thu Mar  6 16:00:08 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 6 Mar 2008 16:00:08 +0100 (CET)
Subject: [R-sig-Geo] [R-spatial-devel] readGDAL does not close
	connections
In-Reply-To: <47D00091.20603@uni-muenster.de>
References: <47CFF23A.4020205@geo.uu.nl> <47D00091.20603@uni-muenster.de>
Message-ID: <Pine.LNX.4.64.0803061548310.12924@reclus.nhh.no>

On Thu, 6 Mar 2008, Edzer Pebesma wrote:

> Paul Hiemstra wrote:
>> I suspect that readGDAL opens connections to the files, but does not
>> close them and the program fails because too many files have been
>> openened simultaneously. I do not get messages like "Closing GDAL
>> dataset handle 0x8ff7900...  destroyed ... done." when I run the script.
>> Does anybody on the r-sig-geo list have similar experiences?
>>
>>
> Looking at readGDAL, it seems that GDAL.close is called on the open file
> handle before the data are returned. This should give you the handle ...
> destroyed ... messages for each file you open.
>
> In the C code of package rgdal, I see reference to GDALOpen(), but not
> to GDALClose(). I guess it should?

Where? In general, handles to GDAL datasets are all that are open and 
visible in R, they are external pointers, and are either destroyed by 
design, calling the C++ function RGDAL_CloseHandle in 
src/gdal-bindings.cpp, l. 357, or by the finalizer - see the beginning of 
R/gdal.R, and uses of .setCollectorFun(), which accompany calls to 
RGDAL_CloseHandle in class definitions.

I don't think that this is a problem in compiled code, because connections 
only exist in R code, and are not used directly by readGDAL().

Roger

> --
> Edzer
>
> _______________________________________________
> R-spatial-devel mailing list
> R-spatial-devel at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/r-spatial-devel
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Thomas.Adams at noaa.gov  Thu Mar  6 16:06:43 2008
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Thu, 06 Mar 2008 10:06:43 -0500
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <200803050945.30314.dylan.beaudette@gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<47CE4C85.2050303@uni-muenster.de>
	<200803050945.30314.dylan.beaudette@gmail.com>
Message-ID: <47D00883.9090007@noaa.gov>

Dylan,

I think a solution using GRASS can be found on pages 110-11 of "Open 
Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered 
in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters 
and judicious use of MASKs; a conditional statement in r.mapcalc is the key.

Regards,
Tom

Dylan Beaudette wrote:
> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>   
>> I find it hard to imagine how you want to plot two raster files on top
>> of each other. Do you want some form of transparency? If it is just one
>> overlaying the other, you could use overlay to find out which cells in
>> raster 1 to replace with those in raster 2 before plotting.
>> --
>> Edzer
>>     
>
> Hi Edzer,
>
> I generally agree that plotting one raster file "over" another raster file 
> would be of little use. In this case, one of the raster files (the 
> interesting one) has been masked with nodata, such that it only really covers 
> about 30% of the region of interest. The other raster is just contextual 
> data, and thus would be useful to plot "behind" the first raster.
>
> Ideas?
>
> Dylan 
>
>   
>> Dylan Beaudette wrote:
>>     
>>> Hi,
>>>
>>> Is it possible to plot two raster images using spplot() in a manner
>>> similar to:
>>>
>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>
>>> Note that one of the raster images is an aerial photo, used only for
>>> context, while the second one is one with interesting z-values. The
>>> second raster is masked and thus does not cover the entire region.
>>>
>>> Thanks,
>>>
>>> Dylan
>>>       
>
>
>
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From Thomas.Adams at noaa.gov  Thu Mar  6 16:07:03 2008
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Thu, 06 Mar 2008 10:07:03 -0500
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <200803050945.30314.dylan.beaudette@gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<47CE4C85.2050303@uni-muenster.de>
	<200803050945.30314.dylan.beaudette@gmail.com>
Message-ID: <47D00897.3090304@noaa.gov>

Dylan,

I think a solution using GRASS can be found on pages 110-111 of "Open 
Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered 
in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters 
and judicious use of MASKs; a conditional statement in r.mapcalc is the key.

Regards,
Tom

Dylan Beaudette wrote:
> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>   
>> I find it hard to imagine how you want to plot two raster files on top
>> of each other. Do you want some form of transparency? If it is just one
>> overlaying the other, you could use overlay to find out which cells in
>> raster 1 to replace with those in raster 2 before plotting.
>> --
>> Edzer
>>     
>
> Hi Edzer,
>
> I generally agree that plotting one raster file "over" another raster file 
> would be of little use. In this case, one of the raster files (the 
> interesting one) has been masked with nodata, such that it only really covers 
> about 30% of the region of interest. The other raster is just contextual 
> data, and thus would be useful to plot "behind" the first raster.
>
> Ideas?
>
> Dylan 
>
>   
>> Dylan Beaudette wrote:
>>     
>>> Hi,
>>>
>>> Is it possible to plot two raster images using spplot() in a manner
>>> similar to:
>>>
>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>
>>> Note that one of the raster images is an aerial photo, used only for
>>> context, while the second one is one with interesting z-values. The
>>> second raster is masked and thus does not cover the entire region.
>>>
>>> Thanks,
>>>
>>> Dylan
>>>       
>
>
>
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From edzer.pebesma at uni-muenster.de  Thu Mar  6 16:22:26 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 06 Mar 2008 16:22:26 +0100
Subject: [R-sig-Geo] [R-spatial-devel] readGDAL does not
	close	connections
In-Reply-To: <Pine.LNX.4.64.0803061548310.12924@reclus.nhh.no>
References: <47CFF23A.4020205@geo.uu.nl> <47D00091.20603@uni-muenster.de>
	<Pine.LNX.4.64.0803061548310.12924@reclus.nhh.no>
Message-ID: <47D00C32.1020603@uni-muenster.de>

Sorry, I need to polish my C++ a bit. The line in gdal-bindings.cpp is:
    pDataset->~GDALDataset();

gdal docs at 
http://gdal.org/classGDALDataset.html#4d110533d799bac7dcfad3c41d30c0e7
--
Edzer




Roger Bivand wrote:
> On Thu, 6 Mar 2008, Edzer Pebesma wrote:
>
>   
>> Paul Hiemstra wrote:
>>     
>>> I suspect that readGDAL opens connections to the files, but does not
>>> close them and the program fails because too many files have been
>>> openened simultaneously. I do not get messages like "Closing GDAL
>>> dataset handle 0x8ff7900...  destroyed ... done." when I run the script.
>>> Does anybody on the r-sig-geo list have similar experiences?
>>>
>>>
>>>       
>> Looking at readGDAL, it seems that GDAL.close is called on the open file
>> handle before the data are returned. This should give you the handle ...
>> destroyed ... messages for each file you open.
>>
>> In the C code of package rgdal, I see reference to GDALOpen(), but not
>> to GDALClose(). I guess it should?
>>     
>
> Where? In general, handles to GDAL datasets are all that are open and 
> visible in R, they are external pointers, and are either destroyed by 
> design, calling the C++ function RGDAL_CloseHandle in 
> src/gdal-bindings.cpp, l. 357, or by the finalizer - see the beginning of 
> R/gdal.R, and uses of .setCollectorFun(), which accompany calls to 
> RGDAL_CloseHandle in class definitions.
>
> I don't think that this is a problem in compiled code, because connections 
> only exist in R code, and are not used directly by readGDAL().
>
> Roger
>
>   
>> --
>> Edzer
>>
>> _______________________________________________
>> R-spatial-devel mailing list
>> R-spatial-devel at lists.sourceforge.net
>> https://lists.sourceforge.net/lists/listinfo/r-spatial-devel
>>
>>     
>
>



From giohappy at gmail.com  Thu Mar  6 23:09:32 2008
From: giohappy at gmail.com (G. Allegri)
Date: Thu, 6 Mar 2008 23:09:32 +0100
Subject: [R-sig-Geo] SpatialPixelDataFrame over a polygon
Message-ID: <e12429640803061409r7401eb70o967f14da65de8e0b@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080306/891e87df/attachment.pl>

From p.hiemstra at geo.uu.nl  Thu Mar  6 23:31:06 2008
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Thu, 06 Mar 2008 23:31:06 +0100
Subject: [R-sig-Geo] SpatialPixelDataFrame over a polygon
In-Reply-To: <e12429640803061409r7401eb70o967f14da65de8e0b@mail.gmail.com>
References: <e12429640803061409r7401eb70o967f14da65de8e0b@mail.gmail.com>
Message-ID: <47D070AA.50106@geo.uu.nl>

G. Allegri schreef:
> Hello list,
> I need to create a SpatialPixelDataFrame to do a gaussian simulation over an
> area delimited by a polygon. The object I want to produce is something
> similar to the "meuse.grid" example.
> I could do it in Grass, converting first the polygon to raster (with the
> resolution of the Grass region), and then converting the raster to points
> vector. Then I import it with spgrass6 and "grid" it to SPDF.
> Is there a more straightforward way to accomplish it totally inside R?
>
> Giovanni
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
Hi Giovanni,

You can use spsample() to make a grid within a polygon, use the 
"cellsize =" argument to set the size of your grid cells, e.g.:

grd = spsample(polygon, cellsize = 1e3)

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:     +31302535773
Fax:    +31302531145
http://intamap.geo.uu.nl/~paul



From jefunes at gmail.com  Thu Mar  6 23:59:38 2008
From: jefunes at gmail.com (Jose Funes)
Date: Thu, 6 Mar 2008 17:59:38 -0500
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
In-Reply-To: <Pine.LNX.4.64.0803050756410.6584@reclus.nhh.no>
References: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com>
	<Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no>
	<8e01f5830803041645lc0f3207l5e6020334fde4435@mail.gmail.com>
	<Pine.LNX.4.64.0803050756410.6584@reclus.nhh.no>
Message-ID: <8e01f5830803061459w26b3c023g58664864ad72b66e@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080306/4aa4e778/attachment.pl>

From giohappy at gmail.com  Fri Mar  7 00:15:24 2008
From: giohappy at gmail.com (G. Allegri)
Date: Fri, 7 Mar 2008 00:15:24 +0100
Subject: [R-sig-Geo] SpatialPixelDataFrame over a polygon
In-Reply-To: <47D070AA.50106@geo.uu.nl>
References: <e12429640803061409r7401eb70o967f14da65de8e0b@mail.gmail.com>
	<47D070AA.50106@geo.uu.nl>
Message-ID: <e12429640803061515u1ea9738cq60967761bcf49e50@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080307/45d53597/attachment.pl>

From Roger.Bivand at nhh.no  Fri Mar  7 09:48:51 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Mar 2008 09:48:51 +0100 (CET)
Subject: [R-sig-Geo] memory - cannot allocate vector of size 'x'
In-Reply-To: <8e01f5830803061459w26b3c023g58664864ad72b66e@mail.gmail.com>
References: <8e01f5830803031435i628c8ba4kaa582fe79d2a9920@mail.gmail.com> 
	<Pine.LNX.4.64.0803040930590.3689@reclus.nhh.no> 
	<8e01f5830803041645lc0f3207l5e6020334fde4435@mail.gmail.com> 
	<Pine.LNX.4.64.0803050756410.6584@reclus.nhh.no>
	<8e01f5830803061459w26b3c023g58664864ad72b66e@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803070945360.16374@reclus.nhh.no>

On Thu, 6 Mar 2008, Jose Funes wrote:

> Roger,
>
> I end splitting the data for the predictors, 3 sections and then imported
> them to R. Your are right, I am calibrating the model using 163 obs but I do
> not understand what you meant with four orders of magnitude more grid
> cells?

Well, with only 163 observations, and over a million prediction points, 
you are putting a great deal of trust on your fitted model aren't you? 
What do the prediction errors look like?

> However, I tried the suggested code but still the regression kriging
> can not be completed for memory allocation. In some of the data had to be
> splitted in smaller areas.

Yes, as I suggested. Did you manage to patch them together again?

Roger

>
> Thanks,
>
> Jose
>
> But no use of maxdist= or nmax=? I would have said:
>>
>>  g1 <- gstat(formula=yststep$call$formula, data=ystdec3, model=vgf1yst)
>>  ystrk <- predict(g1, newdata=predictors)
>>
>>  anyway, which shows exactly how to resolve the problem - subset ystdec3
>>  into tiles and patch them together again afterwards (patching may need
>>  thinking through clearly). I assume that you have now successfully read
> in
>>  the predictors? Do I understand that you are calibrating your model on
> 163
>>  observations, and predicting for roughly four orders of magnitude more
>>  grid cells?
>>
>>  gc() can help to clean out garbage sometimes - say in a loop, gctorture()
>>  really only during development, not in regular use.
>>
>>  Roger
>
> On Wed, Mar 5, 2008 at 2:08 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Tue, 4 Mar 2008, Jose Funes wrote:
>>
>> > Roger,
>> >
>> > I am running it in Windows and is 8 bytes. I tried to use the gc() for
>> > the regression kriging but it did not work, instead I did employ the
>> > gctorture() that turn "R" to run extremely slow (it is still running,
>> > almost 8 hours so far, it may finish tomorrow). For the regression
>> > kriging, I am using 163 data points:
>> >
>> > R code: Regression kriging
>> > ystrk = krige(yststep$call$formula,ystdec3,predictors,vgf1yst)
>> >
>> > where:
>> > yststep: is the regression residual
>> > ystdec3: are the data points (163 points)
>> > predictors: are the asciigrid file containing the predictor variables
>> > (9 raster layers)
>> > vgf1yst: fitted variogram
>>
>>  But no use of maxdist= or nmax=? I would have said:
>>
>>  g1 <- gstat(formula=yststep$call$formula, data=ystdec3, model=vgf1yst)
>>  ystrk <- predict(g1, newdata=predictors)
>>
>>  anyway, which shows exactly how to resolve the problem - subset ystdec3
>>  into tiles and patch them together again afterwards (patching may need
>>  thinking through clearly). I assume that you have now successfully read
> in
>>  the predictors? Do I understand that you are calibrating your model on
> 163
>>  observations, and predicting for roughly four orders of magnitude more
>>  grid cells?
>>
>>  gc() can help to clean out garbage sometimes - say in a loop, gctorture()
>>  really only during development, not in regular use.
>>
>>  Roger
>>
>>
>>
>> >
>> > error message:
>> > In addition: There were 12 warnings (use warnings() to see them)
>> >
>> > warning messages:
>> > 1: Reached total allocation of 1535Mb: see help(memory.size)
>> > ...
>> > 3: In slot(value, what) <- slot(from, what) :
>> > ...
>> > 8: In slot(value, what) <- slot(from, what) :
>> > Reached total allocation of 1535Mb: see help(memory.size)
>> > ...
>> > 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,
> ... :
>> > Reached total allocation of 1535Mb: see help(memory.size)
>> >
>> >
>> > Is there another way to get around garbage collection than
> gctorture().?
>> >
>> > Sincerely,
>> >
>> > Jose
>> >
>> >
>> >
>> >
>> > On Tue, Mar 4, 2008 at 3:48 AM, Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
>> >> On Mon, 3 Mar 2008, Jose Funes wrote:
>> >>
>> >>> Dear members,
>> >>>
>> >>> I would like to share some of the problems that I have run into R
> when
>> >>> importing ascii files. I described the problem below, if any have
>> >>> experienced similar issues I will appreciate you support.
>> >>>
>> >>> I am working with raster data(maps) and importing it as ascii files
> to
>> >>> R. I am stacking 9 layers (10MB~each, total 90MB). However, when
>> >>> stacking the eight layer I get the following message "Error: cannot
>> >>> allocate vector of size 10.8 Mb". I did a little of bit of reading
>> >>> about this, and some suggestions are to increase the memory
>> >>> allocation. I increased it to 3GB  using the following command:
>> >>> memory.limit(size=3000) but the problem still persist.
>> >>>
>> >>
>> >>  Which platform? Windows? Its performance is systematically worse than
>> >>  other OS on the same hardware. When you say 10Mb, is this 8 bytes *
>> >>  roughly 1.2 million cells? Are you running gc() between calls to
>> >>  readAsciiGrid() to force garbage collection? While readAsciiGrid() is
>> >>  working, I think that at least three copies of the data are in
> memory.
>> >>
>> >>  Have you tried using rgdal? Maybe readGDAL() keeps fewer internal
> copies?
>> >>  (in readGDAL, that may be at least two copies, but I'm not sure (NAs
> are
>> >>  handled by GDAL)). Because input needs to be converted from
> representation
>> >>  to representation, it is not possible to avoid multiple copies.
>> >>
>> >>
>> >>> code:
>> >>> 1. predictorslide2 <- readAsciiGrid("sol_spr_lide2.asc")
>> >>> ...
>> >>> ...
>> >>> 8. predictorslide2 <-
> cbind(predictorslide2,readAsciiGrid("umca_pr_lide2.asc"))
>> >>>
>> >>
>> >>  It may be possible to get round cbind() copying if that turns out to
> be
>> >>  the problem, by taking the SpatialGrid from the first read, putting
> it
>> >>  aside, and storing the single columns of the data slots of read data
> in a
>> >>  single, pre-allocated data frame. Re-allocating to predictorslide2
>> >>  successively is not a good idea for large objects - Braun & Murdoch
> in
>> >>  their nice book on R programming treat it as a worst case on speed
> and
>> >>  memory usage.
>> >>
>> >>
>> >>
>> >>> Also I got a similar error when running regression kriging:
>> >>> Error: cannot allocate vector of size 6.7 Mb
>> >>
>> >>  Without the command, this isn't informative. Were you using local
> areas
>> >>  (maximum distance or # data points)? How large were the data= and
> newdata=
>> >>  objects?
>> >>
>> >>  Roger
>> >>
>> >>
>> >>> In addition: There were 12 warnings (use warnings() to see them)
>> >>>
>> >>> warning messages:
>> >>> 1: Reached total allocation of 1535Mb: see help(memory.size)
>> >>> ...
>> >>> 3: In slot(value, what) <- slot(from, what) :
>> >>> ...
>> >>> 8: In slot(value, what) <- slot(from, what) :
>> >>>  Reached total allocation of 1535Mb: see help(memory.size)
>> >>> ...
>> >>> 12: In `slot<-`(`*tmp*`, what, value = structure(c(-293438.89990765,
> ... :
>> >>>  Reached total allocation of 1535Mb: see help(memory.size)
>> >>>
>> >>> I will appreciate your suggestions. I have also considered splitting
>> >>> the data  but would like to explore other solutions.
>> >>>
>> >>> Regards,
>> >>>
>> >>> Jose Funes
>> >>>
>> >>> _______________________________________________
>> >>> R-sig-Geo mailing list
>> >>> R-sig-Geo at stat.math.ethz.ch
>> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>
>> >>
>> >>  --
>> >>  Roger Bivand
>> >>  Economic Geography Section, Department of Economics, Norwegian School
> of
>> >>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> >>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> >>  e-mail: Roger.Bivand at nhh.no
>> >>
>> >>
>> >
>>
>>  --
>>
>>
>> Roger Bivand
>>  Economic Geography Section, Department of Economics, Norwegian School of
>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>  e-mail: Roger.Bivand at nhh.no
>>
>>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From famuvie at alumni.uv.es  Fri Mar  7 16:56:55 2008
From: famuvie at alumni.uv.es (=?ISO-8859-1?Q?Facundo_Mu=F1oz?=)
Date: Fri, 07 Mar 2008 16:56:55 +0100
Subject: [R-sig-Geo] spgrass6 and null values
Message-ID: <47D165C7.3040007@alumni.uv.es>


Hello list,

while exporting vector maps form GRASS to R using readVECT6(spgrass6), 
null values in attributes become zeroes in R, and makes them 
undistinguishable from real zero-valued attributes.

I'm making a work-around, by previously replacing zeroes by 0.5 in GRASS 
(wich is an impossible value) and then reverting once in R.

But i wonder if there is a correct way of doing this that i didn't find. 
If not, i suggest to add the feature of passing null values to NAs and 
viceversa.

Greetings
       Facundo Mu?oz
       Universidad de Valencia
       Spain



From Roger.Bivand at nhh.no  Fri Mar  7 17:57:41 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 7 Mar 2008 17:57:41 +0100 (CET)
Subject: [R-sig-Geo] spgrass6 and null values
In-Reply-To: <47D165C7.3040007@alumni.uv.es>
References: <47D165C7.3040007@alumni.uv.es>
Message-ID: <Pine.LNX.4.64.0803071720070.7372@reclus.nhh.no>

On Fri, 7 Mar 2008, Facundo Mu?oz wrote:

>
> Hello list,
>
> while exporting vector maps form GRASS to R using readVECT6(spgrass6),
> null values in attributes become zeroes in R, and makes them
> undistinguishable from real zero-valued attributes.

This is a "feature" of shapefiles - the format used for the intermediate 
file. There is no known workaround, as as far as I know, there is no 
general workaround using v.out.ogr and v.in.ogr in the other direction. 
This is now noted on the readVECT6 function help page.

>
> I'm making a work-around, by previously replacing zeroes by 0.5 in GRASS
> (wich is an impossible value) and then reverting once in R.
>
> But i wonder if there is a correct way of doing this that i didn't find.
> If not, i suggest to add the feature of passing null values to NAs and
> viceversa.

I think that this lies on the v.out.ogr side - does anyone know of 
null-aware generic DB drivers on the GRASS side - the db.* SQL references 
refer to null handling, but can the nulls be exported? It would be 
unfortunate to restrict use of null-aware interface mechanisms to a 
particular driver.

Ideas?

Roger


>
> Greetings
>       Facundo Mu?oz
>       Universidad de Valencia
>       Spain
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From hi_ono2001 at ybb.ne.jp  Fri Mar  7 22:37:35 2008
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Sat, 8 Mar 2008 06:37:35 +0900 (JST)
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
Message-ID: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>

Hi.

 This book is first spatial statistics book for R, I
think.

 It's very interesting.



  Regards.



From tech_dev at wildintellect.com  Sat Mar  8 09:20:33 2008
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Sat, 08 Mar 2008 00:20:33 -0800
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
In-Reply-To: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>
References: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>
Message-ID: <47D24C51.4050904@wildintellect.com>

Hisaji ONO wrote:
> Hi.
> 
>  This book is first spatial statistics book for R, I
> think.
> 
>  It's very interesting.
> 
> 
> 
>   Regards.
> 
> 
Thanks for the information.
Here's the official Springer link
http://www.springer.com/statistics/statistical+theory+and+methods/book/978-0-387-78170-9

Roger could you comment on when/where your book will be available. I
think we'd like to use it for a class that starts next month.

Thanks,
Alex
Geography Graduate Group
University of California, Davis



From Roger.Bivand at nhh.no  Sat Mar  8 10:47:47 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 8 Mar 2008 10:47:47 +0100 (CET)
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
In-Reply-To: <47D24C51.4050904@wildintellect.com>
References: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>
	<47D24C51.4050904@wildintellect.com>
Message-ID: <Pine.LNX.4.64.0803081034110.9645@reclus.nhh.no>

On Sat, 8 Mar 2008, Alex Mandel wrote:

> Hisaji ONO wrote:
>> Hi.
>>
>>  This book is first spatial statistics book for R, I
>> think.
>>
>>  It's very interesting.
>>
>>
>>
>>   Regards.
>>
>>
> Thanks for the information.
> Here's the official Springer link
> http://www.springer.com/statistics/statistical+theory+and+methods/book/978-0-387-78170-9
>
> Roger could you comment on when/where your book will be available. I
> think we'd like to use it for a class that starts next month.

As the Springer site says, August 2008. The manuscript was only submitted 
February 29, which we hope is an auspicious day (R 1.0.0 was released on 
February 29, 2000). Perhaps some of the course materials from the Imperial 
College course, or Edzer Pebesma's e-seminar, both listed on the Rgeo 
website:

http://www.R-project.org/Rgeo

(old) news points 5 and 8 repsectively, may help in the interim?

Without this community, there would not have been any book; we (we are 
three - Edzer Pebesma, Virgilio G?mez-Rubio, and myself) hope that it will 
prove useful when it is ready.

Roger

>
> Thanks,
> Alex
> Geography Graduate Group
> University of California, Davis
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From hzambran.newsgroups at gmail.com  Sat Mar  8 11:09:08 2008
From: hzambran.newsgroups at gmail.com (Mauricio Zambrano)
Date: Sat, 8 Mar 2008 11:09:08 +0100
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
In-Reply-To: <Pine.LNX.4.64.0803081034110.9645@reclus.nhh.no>
References: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>
	<47D24C51.4050904@wildintellect.com>
	<Pine.LNX.4.64.0803081034110.9645@reclus.nhh.no>
Message-ID: <63d616b0803080209x67ff474gb2c05b9c469dbc50@mail.gmail.com>

Thanks for such good news. I'm really looking forward to reading it.

Thanks a lot Edzer Pebesma, Virgilio G?mez-Rubio and Roger Bivand for
your contribution to the universal knowledge.

-- 
hzambran

Linux user  #454569 -- Ubuntu user #17469



From hengl at science.uva.nl  Sat Mar  8 16:23:34 2008
From: hengl at science.uva.nl (Tomislav Hengl)
Date: Sat, 8 Mar 2008 16:23:34 +0100 (CET)
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
In-Reply-To: <63d616b0803080209x67ff474gb2c05b9c469dbc50@mail.gmail.com>
References: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>
	<47D24C51.4050904@wildintellect.com>
	<Pine.LNX.4.64.0803081034110.9645@reclus.nhh.no>
	<63d616b0803080209x67ff474gb2c05b9c469dbc50@mail.gmail.com>
Message-ID: <57185.86.80.191.132.1204989814.squirrel@webmail.science.uva.nl>


Dear Roger, Edzer and Rubio,

I would like to join the congratulations (hopefully we will not overload
the mailing list :))) ).

I have been already recommending it to many of my students (I saw the
draft at Edzer's place few months ago).

BTW, the book's website is not available. Is the URL correct?

http://www.asdar-book.org

all the best,

PS: Congratulations on the affordable price also!

Tom Hengl
http://spatial-analyst.net


> Thanks for such good news. I'm really looking forward to reading it.
>
> Thanks a lot Edzer Pebesma, Virgilio G?mez-Rubio and Roger Bivand for
> your contribution to the universal knowledge.
>
> --
> hzambran
>
> Linux user  #454569 -- Ubuntu user #17469
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From murray.richardson at utoronto.ca  Mon Mar 10 01:27:21 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Sun, 09 Mar 2008 20:27:21 -0400
Subject: [R-sig-Geo] [R] polygon shapefile from line edge coordinate list
In-Reply-To: <loom.20080308T121413-622@post.gmane.org>
References: <47D16B75.4000508@utoronto.ca>
	<loom.20080308T121413-622@post.gmane.org>
Message-ID: <47D48069.6030701@utoronto.ca>

Hi Roger

Thanks so much for your help.  I can definitely work with this.  On your 
advice I'm responding via r-sig-geo.

Unfortunately, there is no guarantee that the line segments will come in 
any particular order from the alpha shapes routine.  In fact, there will 
also likely be line segments from  different polys mixed together, so I 
need to write the code so that the polygons are assembled only for 
connected line segments.  I was naive when I started thinking about the 
problem.  As you suggest, this could get messy. 

As an alternative I may load the segments into a postGIS linestring 
table and polygonize that, all via RODBC/postGIS.  An added benefit is 
that it would clean up dangling segments, which may also exist.

Thanks again

Murray



Roger Bivand wrote:
> Murray Richardson <murray.richardson <at> utoronto.ca> writes:
>
>   
>> Hello,
>>
>> I am looking for advice on a task I am trying to complete.
>>
>> I have a 4 column dataframe defining the start and end coordinates of 
>> line edges (from a CGAL alpha shapes function to define concave hulls 
>> from point clusters).  I would like to create polygon shapefiles from 
>> these line edges, presumably creating lines first and then polygons.
>>     
>
> How many polygons in each data.frame? If more than one, how are they 
> separated? You note below that there are multiples, are they flagged by 
> for example an NA row, or is there a jump from (endX endY) to the next 
> (startX startY)?
>
>   
>> e.g. columns are:
>>
>> startX  startY endX endY
>>
>> where each row represents start and end coordinates of a line segment.
>>     
>
> Are the line segments ordered in sequence. If they are, something like:
>
> xy0 <- data.frame(sX=c(1,2,2,1,3,4,4,3), sY=c(1,1,2,2,3,3,4,4), 
>   eX=c(2,2,1,1,4,4,3,3), eY=c(1,2,2,1,3,4,4,3))
>
> brks <- logical(nrow(xy0))
> for (i in 2:nrow(xy0)) brks[i] <- (xy0$sX[i] != xy0$eX[i-1]) & 
>   (xy0$sY[i] != xy0$eY[i-1])
> cbrks <- cumsum(brks)+1
> # find the separate polygons
>
> xy1 <- split(xy0, cbrks)
>
> library(sp)
> Plist <- vector(mode="list", length=length(xy1))
> for (i in seq(along=Plist)) {
>   crds <- rbind(cbind(xy1[[i]]$sX, xy1[[i]]$sY), 
>     c(xy1[[i]]$eX[nrow(xy1[[i]])], xy1[[i]]$eY[nrow(xy1[[i]])]))
> #   close the polygon
>   Plist[[i]] <- Polygons(list(Polygon(crds)), ID=names(xy1[i]))
> }
> # make a list of Polygons objects with IDs
>
> Plist1 <- SpatialPolygons(Plist)
> plot(Plist1, axes=TRUE)
> SPDF <- SpatialPolygonsDataFrame(Plist1, data=data.frame(i=names(xy1), 
>   row.names=names(xy1)))
> # convert this to a SpatialPolygonsDataFrame object for export
>
> library(maptools)
> writePolyShape(SPDF, "chulls")
>
> If the segments are not in "join up the dots" sequence, it will be 
> (even) more messy. Please also consider whether the R-sig-geo list 
> might not be more relevant.
>
> Roger
>
>   
>> I am new to R spatial packages and I am not sure which one is best 
>> suited to this task. There seems to be a lot of options, which is great 
>> but hard to know which one to start with.  Any suggestions on the best 
>> way to proceed with this?  One further challenge is that the list 
>> includes line segments defining multiple polygons.
>>
>> Thanks for any advice.
>>
>> Murray
>>
>> ______________________________________________
>> R-help <at> r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>>
>>     
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>
>



From Roger.Bivand at nhh.no  Mon Mar 10 08:23:25 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 10 Mar 2008 08:23:25 +0100 (CET)
Subject: [R-sig-Geo] [R] polygon shapefile from line edge coordinate list
In-Reply-To: <47D48069.6030701@utoronto.ca>
References: <47D16B75.4000508@utoronto.ca>
	<loom.20080308T121413-622@post.gmane.org>
	<47D48069.6030701@utoronto.ca>
Message-ID: <Pine.LNX.4.64.0803100816320.4337@reclus.nhh.no>

On Sun, 9 Mar 2008, Murray Richardson wrote:

> Hi Roger
>
> Thanks so much for your help.  I can definitely work with this.  On your
> advice I'm responding via r-sig-geo.
>
> Unfortunately, there is no guarantee that the line segments will come in
> any particular order from the alpha shapes routine.  In fact, there will
> also likely be line segments from  different polys mixed together, so I
> need to write the code so that the polygons are assembled only for
> connected line segments.  I was naive when I started thinking about the
> problem.  As you suggest, this could get messy.

I understand. I might be tempted to use AWK externally to number the 
unique (x,y) pairs, and reorder the text file externally. There is some 
AWK code and shell scripts in the infrastructure in the maps package and 
the two Bell Labs reports referenced there. They treat the short line 
segment spaghetti scenario directly. Maybe that might provide a way 
forward?

>
> As an alternative I may load the segments into a postGIS linestring
> table and polygonize that, all via RODBC/postGIS.  An added benefit is
> that it would clean up dangling segments, which may also exist.
>

This would be more robust, and via ogr2ogr would let you make the 
shapefiles too. I'd prototype in AWK because I know it adequately and 
don't know PostGIS, but if you already know PostGIS, the underlying code 
is certainly stronger.

Please let us know how you get on, others may face the same problem at 
some time.

Roger

> Thanks again
>
> Murray
>
>
>
> Roger Bivand wrote:
>> Murray Richardson <murray.richardson <at> utoronto.ca> writes:
>>
>>
>>> Hello,
>>>
>>> I am looking for advice on a task I am trying to complete.
>>>
>>> I have a 4 column dataframe defining the start and end coordinates of
>>> line edges (from a CGAL alpha shapes function to define concave hulls
>>> from point clusters).  I would like to create polygon shapefiles from
>>> these line edges, presumably creating lines first and then polygons.
>>>
>>
>> How many polygons in each data.frame? If more than one, how are they
>> separated? You note below that there are multiples, are they flagged by
>> for example an NA row, or is there a jump from (endX endY) to the next
>> (startX startY)?
>>
>>
>>> e.g. columns are:
>>>
>>> startX  startY endX endY
>>>
>>> where each row represents start and end coordinates of a line segment.
>>>
>>
>> Are the line segments ordered in sequence. If they are, something like:
>>
>> xy0 <- data.frame(sX=c(1,2,2,1,3,4,4,3), sY=c(1,1,2,2,3,3,4,4),
>>   eX=c(2,2,1,1,4,4,3,3), eY=c(1,2,2,1,3,4,4,3))
>>
>> brks <- logical(nrow(xy0))
>> for (i in 2:nrow(xy0)) brks[i] <- (xy0$sX[i] != xy0$eX[i-1]) &
>>   (xy0$sY[i] != xy0$eY[i-1])
>> cbrks <- cumsum(brks)+1
>> # find the separate polygons
>>
>> xy1 <- split(xy0, cbrks)
>>
>> library(sp)
>> Plist <- vector(mode="list", length=length(xy1))
>> for (i in seq(along=Plist)) {
>>   crds <- rbind(cbind(xy1[[i]]$sX, xy1[[i]]$sY),
>>     c(xy1[[i]]$eX[nrow(xy1[[i]])], xy1[[i]]$eY[nrow(xy1[[i]])]))
>> #   close the polygon
>>   Plist[[i]] <- Polygons(list(Polygon(crds)), ID=names(xy1[i]))
>> }
>> # make a list of Polygons objects with IDs
>>
>> Plist1 <- SpatialPolygons(Plist)
>> plot(Plist1, axes=TRUE)
>> SPDF <- SpatialPolygonsDataFrame(Plist1, data=data.frame(i=names(xy1),
>>   row.names=names(xy1)))
>> # convert this to a SpatialPolygonsDataFrame object for export
>>
>> library(maptools)
>> writePolyShape(SPDF, "chulls")
>>
>> If the segments are not in "join up the dots" sequence, it will be
>> (even) more messy. Please also consider whether the R-sig-geo list
>> might not be more relevant.
>>
>> Roger
>>
>>
>>> I am new to R spatial packages and I am not sure which one is best
>>> suited to this task. There seems to be a lot of options, which is great
>>> but hard to know which one to start with.  Any suggestions on the best
>>> way to proceed with this?  One further challenge is that the list
>>> includes line segments defining multiple polygons.
>>>
>>> Thanks for any advice.
>>>
>>> Murray
>>>
>>> ______________________________________________
>>> R-help <at> r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>>
>>>
>>
>> ______________________________________________
>> R-help at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-help
>> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
>> and provide commented, minimal, self-contained, reproducible code.
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From edzer.pebesma at uni-muenster.de  Mon Mar 10 09:24:34 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 10 Mar 2008 09:24:34 +0100
Subject: [R-sig-Geo] "Applied Spatial Data Analysis with R" from Springer
In-Reply-To: <57185.86.80.191.132.1204989814.squirrel@webmail.science.uva.nl>
References: <20080307213736.32191.qmail@web10701.mail.bbt.yahoo.co.jp>	<47D24C51.4050904@wildintellect.com>	<Pine.LNX.4.64.0803081034110.9645@reclus.nhh.no>	<63d616b0803080209x67ff474gb2c05b9c469dbc50@mail.gmail.com>
	<57185.86.80.191.132.1204989814.squirrel@webmail.science.uva.nl>
Message-ID: <47D4F042.6060501@uni-muenster.de>

Tomislav Hengl wrote:
> BTW, the book's website is not available. Is the URL correct?
>
> http://www.asdar-book.org
>   
We plan it to be up and running by the time the book hits the shelves.
--
Edzer



From mgallay01 at qub.ac.uk  Tue Mar 11 13:23:00 2008
From: mgallay01 at qub.ac.uk (Michal Gallay)
Date: 11 Mar 2008 12:23:00 +0000
Subject: [R-sig-Geo] R chrashes when reading vector from GRASS with readVECT6
Message-ID: <Prayer.1.0.12.0803111223001.15804@localhost.localdomain>

Dear R experts,

I am running R 6.2.2 and QGIS 0.8.1 on WinXP, 1.5 GB RAM, 1.8GHZ processor.

When I try to read a vector point dataset from a GRASS mapset
R looks like its working but it goes on for a very long time 
even if the point dataset is small (1400 points).
After hitting ESC to terminate the process, R crashers.

require(spgrass6)
> gmeta6()
gisdbase    D:/GIS_data/GB_data/GRASS 
location    4_Langdale 
mapset      RST_ground_truth 
rows        290 
columns     400 
north       507450 
south       506000 
west        328000 
east        330000 
nsres       5 
ewres       5 
projection  NA 
cv.vect <- readVECT6("cv.points")

However, sometimes after closing R and openning again I managed to read the 
data and sometimes not. It appears to be more or less random behaviour.

Now, I wanted to read a big vector (1 million points). R crashes again. 
There is no problem with readRAST6() even with a big raster.

Would you have any ideas where the problem is?

Thank you for your time and advice.

Best regards

Michal

-- 
Michal Gallay

Postgraduate Research Student
School of Geography, Archaeology and Palaeoecology
Queen's University
Belfast BT7 1NN
Northern Ireland

Tel: +44(0)2890 273929
Fax: +44(0)2890 973212
email: mgallay01 at qub.ac.uk
www: www.qub.ac.uk/geog



From Roger.Bivand at nhh.no  Tue Mar 11 14:20:32 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 11 Mar 2008 14:20:32 +0100 (CET)
Subject: [R-sig-Geo] R chrashes when reading vector from GRASS with
 readVECT6
In-Reply-To: <Prayer.1.0.12.0803111223001.15804@localhost.localdomain>
References: <Prayer.1.0.12.0803111223001.15804@localhost.localdomain>
Message-ID: <Pine.LNX.4.64.0803111404040.8760@reclus.nhh.no>

On Tue, 11 Mar 2008, Michal Gallay wrote:

> Dear R experts,
>
> I am running R 6.2.2 and QGIS 0.8.1 on WinXP, 1.5 GB RAM, 1.8GHZ processor.
>
> When I try to read a vector point dataset from a GRASS mapset
> R looks like its working but it goes on for a very long time
> even if the point dataset is small (1400 points).
> After hitting ESC to terminate the process, R crashers.
>
> require(spgrass6)
>> gmeta6()
> gisdbase    D:/GIS_data/GB_data/GRASS
> location    4_Langdale
> mapset      RST_ground_truth
> rows        290
> columns     400
> north       507450
> south       506000
> west        328000
> east        330000
> nsres       5
> ewres       5
> projection  NA
> cv.vect <- readVECT6("cv.points")
>
> However, sometimes after closing R and openning again I managed to read the
> data and sometimes not. It appears to be more or less random behaviour.
>
> Now, I wanted to read a big vector (1 million points). R crashes again.
> There is no problem with readRAST6() even with a big raster.
>
> Would you have any ideas where the problem is?

This is a question for the statgrass list, really. The GRASS port to 
Windows for QGIS is highly experimental, and must be treated as unstable. 
The R-GRASS interface works with GRASS 6 under Cygwin, and the native 
Windows ports (QGIS is one, initially not by the GRASS team, the GRASS 
team is working on a second which is not ready yet), should not yet be 
relied on for production. By the way, the current QGIS release is 0.9.1, 
and 0.9.2 is at the second release candidate.

My guess would be that the system() commands in readVECT6 are generating 
code that the QGIS GRASS port doesn't always interpret correctly, for this 
combination of QGIS/GRASS/R/spgrass6/Windows - for instance a locale 
shadow on an escaped something? These problems are well nigh impossible to 
reproduce, even though they do happen. Are you running R as Rterm, or 
Rgui? I feel that there may be a QGIS event loop issue, that it isn't 
"paying attention".

I have seen different behaviour on different Windows machines with 
apparently similar QGIS/GRASS/R installations. If you need to interface 
QGIS 0.8.1 on Windows, please write out temporary vector files manually, 
and use readOGR() and writeOGR() in rgdal from inside R. Maybe things will 
improve, but likely not any time soon. If you have to use QGIS, try 
upgrading? Just running GRASS from the shell prompt is the easiest way, 
though, then everything *just works*TM.

Roger

>
> Thank you for your time and advice.
>
> Best regards
>
> Michal
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From p.hiemstra at geo.uu.nl  Tue Mar 11 23:05:57 2008
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Tue, 11 Mar 2008 23:05:57 +0100
Subject: [R-sig-Geo] Package for automatic interpolation
Message-ID: <47D70245.7090408@geo.uu.nl>

Dear r-sig-geo,

In the course of my PhD I have written a R package that performs 
automatic interpolation (kriging) and might be interesting for other 
people. I work on real-time automatic interpolation of radioactivity 
levels. It depends heavily on the gstat pacakge written by Edzer 
(Pebesma, he is my supervisor). If people are interested in this 
package, it can be downloaded from 
http://intamap.geo.uu.nl/~paul/Downloads.html. If you have any comments, 
complaints or suggestions please do not hesitate to e-mail me.

Some sample code:
library(automap)
data(meuse)
coordinates(meuse) = ~x+y
data(meuse.grid)
gridded(meuse.grid) = ~x+y
kr.ok = autoKrige(log(zinc)~1, meuse, meuse.grid)
plot(kr.ok)
kr.uk = autoKrige(log(zinc)~sqrt(dist), meuse, meuse.grid)
plot(kr.uk)

cheers,
Paul

-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:     +31302535773
Fax:    +31302531145
http://intamap.geo.uu.nl/~paul



From Thomas.Adams at noaa.gov  Wed Mar 12 13:07:03 2008
From: Thomas.Adams at noaa.gov (Thomas Adams)
Date: Wed, 12 Mar 2008 08:07:03 -0400
Subject: [R-sig-Geo] Package for automatic interpolation
In-Reply-To: <47D70245.7090408@geo.uu.nl>
References: <47D70245.7090408@geo.uu.nl>
Message-ID: <47D7C767.2070905@noaa.gov>

Paul,

This is outstanding; thank you very much! BTW, I noticed that when I run 
your example that I get:

Warning: singular model in variogram fit

?actually, 2 such warnings with the OK example, and 1 with the UK 
example. Are you seeing these too? Otherwise, the results look fine?

Thanks again for your contribution!

Regards,
Tom


Paul Hiemstra wrote:
> Dear r-sig-geo,
>
> In the course of my PhD I have written a R package that performs 
> automatic interpolation (kriging) and might be interesting for other 
> people. I work on real-time automatic interpolation of radioactivity 
> levels. It depends heavily on the gstat pacakge written by Edzer 
> (Pebesma, he is my supervisor). If people are interested in this 
> package, it can be downloaded from 
> http://intamap.geo.uu.nl/~paul/Downloads.html. If you have any comments, 
> complaints or suggestions please do not hesitate to e-mail me.
>
> Some sample code:
> library(automap)
> data(meuse)
> coordinates(meuse) = ~x+y
> data(meuse.grid)
> gridded(meuse.grid) = ~x+y
> kr.ok = autoKrige(log(zinc)~1, meuse, meuse.grid)
> plot(kr.ok)
> kr.uk = autoKrige(log(zinc)~sqrt(dist), meuse, meuse.grid)
> plot(kr.uk)
>
> cheers,
> Paul
>
>   


-- 
Thomas E Adams
National Weather Service
Ohio River Forecast Center
1901 South State Route 134
Wilmington, OH 45177

EMAIL:	thomas.adams at noaa.gov

VOICE:	937-383-0528
FAX:	937-383-0033



From p.hiemstra at geo.uu.nl  Wed Mar 12 13:14:18 2008
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Wed, 12 Mar 2008 13:14:18 +0100
Subject: [R-sig-Geo] Package for automatic interpolation
In-Reply-To: <47D7C767.2070905@noaa.gov>
References: <47D70245.7090408@geo.uu.nl> <47D7C767.2070905@noaa.gov>
Message-ID: <47D7C91A.7090301@geo.uu.nl>

Hi Thomas,

The automatic fitting procedure checks a range of possible variogram 
models, including Spherical, Exponential, Gaussian and Matern models. 
Each of these models could lead to a singular model fit. The fitting 
function in gstat (fit.variogram) says the following on singular model fits:

"""On singular model fits: If your variogram turns out to be a flat, 
horizontal or sloping line, then fitting a three parameter model such as 
the exponential or spherical with nugget is a bit heavy: there's an 
infinite number of possible combinations of sill and range (both very 
large) to fit to a sloping line. In this case, the returned, singular 
model may still be useful: just try and plot it. Gstat converges when 
the parameter values stabilize, and this may not be the case. Another 
case of singular model fits happens when a model that reaches the sill 
(such as the spherical) is fit with a nugget, and the range parameter 
starts, or converges to a value smaller than the distance of the second 
sample variogram estimate. In this case, again, an infinite number of 
possibilities occur essentially for fitting a line through a single 
(first sample variogram) point. In both cases, fixing one or more of the 
variogram model parameters may help you out. """'

regards,
Paul

Thomas Adams schreef:
> Paul,
>
> This is outstanding; thank you very much! BTW, I noticed that when I 
> run your example that I get:
>
> Warning: singular model in variogram fit
>
> ?actually, 2 such warnings with the OK example, and 1 with the UK 
> example. Are you seeing these too? Otherwise, the results look fine?
>
> Thanks again for your contribution!
>
> Regards,
> Tom
>
>
> Paul Hiemstra wrote:
>> Dear r-sig-geo,
>>
>> In the course of my PhD I have written a R package that performs 
>> automatic interpolation (kriging) and might be interesting for other 
>> people. I work on real-time automatic interpolation of radioactivity 
>> levels. It depends heavily on the gstat pacakge written by Edzer 
>> (Pebesma, he is my supervisor). If people are interested in this 
>> package, it can be downloaded from 
>> http://intamap.geo.uu.nl/~paul/Downloads.html. If you have any 
>> comments, complaints or suggestions please do not hesitate to e-mail me.
>>
>> Some sample code:
>> library(automap)
>> data(meuse)
>> coordinates(meuse) = ~x+y
>> data(meuse.grid)
>> gridded(meuse.grid) = ~x+y
>> kr.ok = autoKrige(log(zinc)~1, meuse, meuse.grid)
>> plot(kr.ok)
>> kr.uk = autoKrige(log(zinc)~sqrt(dist), meuse, meuse.grid)
>> plot(kr.uk)
>>
>> cheers,
>> Paul
>>
>>   
>
>


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone: 	+31302535773
Fax:	+31302531145
http://intamap.geo.uu.nl/~paul



From andre.schuetzenmeister at uni-hohenheim.de  Wed Mar 12 13:56:57 2008
From: andre.schuetzenmeister at uni-hohenheim.de (=?iso-8859-1?Q?Andre_Sch=FCtzenmeister?=)
Date: Wed, 12 Mar 2008 13:56:57 +0100
Subject: [R-sig-Geo] geoR: specification of trend.d and trend.l in
	krige.control()
Message-ID: <003d01c88440$8e4159c0$34882990@pflanzenbau.unihohenheim.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080312/5b4b1787/attachment.pl>

From edzer.pebesma at uni-muenster.de  Wed Mar 12 14:22:47 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 12 Mar 2008 14:22:47 +0100
Subject: [R-sig-Geo] Package for automatic interpolation
In-Reply-To: <47D7C91A.7090301@geo.uu.nl>
References: <47D70245.7090408@geo.uu.nl> <47D7C767.2070905@noaa.gov>
	<47D7C91A.7090301@geo.uu.nl>
Message-ID: <47D7D927.4050308@uni-muenster.de>

I agree with Thomas that seeing a warning is a worry. If Paul's automap 
takes care of singular fits by discarding them, it should try to hide 
the warning for the user, because otherwise it will worry them. I see 
that the warning is issued by the C code in gstat, and will rethink 
about how a wrapper function at the R level should be able to suppress it.

Thanks for sharing automap with this list!
--
Edzer

Paul Hiemstra wrote:
> Hi Thomas,
>
> The automatic fitting procedure checks a range of possible variogram 
> models, including Spherical, Exponential, Gaussian and Matern models. 
> Each of these models could lead to a singular model fit. The fitting 
> function in gstat (fit.variogram) says the following on singular model fits:
> ...
>



From jeffrey.stratford at wilkes.edu  Wed Mar 12 14:46:42 2008
From: jeffrey.stratford at wilkes.edu (Stratford, Jeffrey)
Date: Wed, 12 Mar 2008 09:46:42 -0400
Subject: [R-sig-Geo]   spatial verions of negative binomial
In-Reply-To: <47D7D927.4050308@uni-muenster.de>
References: <47D7C91A.7090301@geo.uu.nl> <47D7D927.4050308@uni-muenster.de>
Message-ID: <72B2B2BDFE51E64DAC63814956149800248553@STAFFEXCHVS3.wilkesu.wilkes.edu>

Hi group,

Does anyone have code for spatial error and spatial lag models for
negative binomial distributions?  There are spatial error and lag models
in the Dormann et al. Ecography paper (a very nice read) but these fit
linear models.  Or is there a way to modify the Poison models?  

If code doesn't exist and you want to develop it, I would be happy to
give you authorship.  I know that WinBugs can be modified but I have no
experience with programming it.  

It's a very straightforward data set and a very important paper looking
at the effects of urbanization on avian species richness.  The original
ms was accepted by one reviewer and rejected by the second, who wanted
to incorporate spatial autocorrelation.  

Cheers,

Jeff



From paulojus at c3sl.ufpr.br  Wed Mar 12 16:19:18 2008
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 12 Mar 2008 12:19:18 -0300 (BRT)
Subject: [R-sig-Geo] geoR: specification of trend.d and trend.l in
 krige.control()
In-Reply-To: <003d01c88440$8e4159c0$34882990@pflanzenbau.unihohenheim.de>
References: <003d01c88440$8e4159c0$34882990@pflanzenbau.unihohenheim.de>
Message-ID: <Pine.LNX.4.58.0803121209590.14207@bowmore.c3sl.ufpr.br>

Andre

Let's see if I can get this.
Some of the caracters I canot read (probably due to the encoding used
in your email)


On Wed, 12 Mar 2008, Andre Sch?tzenmeister wrote:

> Dear Subscribers,
> I have some trouble in specifying the parameters trend.d and trend.l
> correctly.
>
> As global trend I assume row and column effects which translate into the
> formula:
> trend=~factor(Row)+factor(Column)
>

OK. argment "trend" is used in functionhs such as variogram() and
likfit().
When it goes to krige.conv() you nned to separate trend.d for data
locations and trend.l for predictions locations.
If options are for "1st" or "2nd" the coordinates are used as trends and
them both are internally set to the same.

> Consequently, I obtain the parameters of a the model via variofit() and want
> to do OK-estimation
> for each point of a grid. Therefore, I call krige.cov() n times, for my n
> data points. Each time leaving
> out the point which I want to estimate. Actually, I want to smooth the
> surface using information
> of neighboring locations.

is this cross-validation " leaving one out" . xvalid() may be usefull.

>
> parms <- krige.control( type.krige="ok", obj.model=my.model, aniso.pars=c(
> ai.axis,ai.ratio), trend.d =
.?, trend.l =
.? )
>

I cannot read the options here, but hope above clarifys this otherwise leg
me know.
geoR page have some tutoruials with extra examples on this topic.
are you using the tilde caracter? e.g something like  trend.d = ~datatrend

> I always get the error: ?..trend.spatial(trend = krige$trend.d, geodata =
> geodata) :
> trend elements not found.

aparently the objects being passed does not exists...or cannot be found

>
> The geodata object I pass to krige.conv() contains the covariates Row and
> Column.
>

if Row and Columns are your data coordinates consider using trend.d="1st"
and so on

> How can I specify the parameters ?trend.d? and ?trend.l? correctly in order
> to do the OK-estimation
> location by location?
>

see dosc but basicaly you need the values at each prediction locations
passed as matrices or data-frames (not vectors)

hope this helps otherwise you may consider contact me offlist and maybe
sending reproducible code

best
P.J.


> I would appreciate to get a hint how to do that.
>
> Thanks,
>
>    Andre
>

Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

-------------------------------------------------------------------------
53a Reuniao Anual da Regiao Brasileira da Soc. Internacional de Biometria
14 a 16/05/2008, UFLA, Lavras,MG
http://www.rbras.org.br/rbras53



From giohappy at gmail.com  Wed Mar 12 17:37:45 2008
From: giohappy at gmail.com (G. Allegri)
Date: Wed, 12 Mar 2008 17:37:45 +0100
Subject: [R-sig-Geo] change a column name of the data slot
Message-ID: <e12429640803120937j706b8c4ardecd27abe39c1385@mail.gmail.com>

I'm trying to change a column name of the data slot of a SpatialPixelsDataFrame.
I've added the column this way:

> slot(EceZKRIG0_3,"data")[,index]<-Sim_mean_approx[[2]]

The column added is V151 (as 151 is the actual index).
I want to rename it, and I've tried:

> names(slot(EceZKRIG0_3,"data")[index])<-"Mean_approx"

No errors are raised, but the column remain V151. What's wrong?

Giovanni



From Roger.Bivand at nhh.no  Wed Mar 12 17:54:30 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2008 17:54:30 +0100 (CET)
Subject: [R-sig-Geo] change a column name of the data slot
In-Reply-To: <e12429640803120937j706b8c4ardecd27abe39c1385@mail.gmail.com>
References: <e12429640803120937j706b8c4ardecd27abe39c1385@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803121747550.13400@reclus.nhh.no>

On Wed, 12 Mar 2008, G. Allegri wrote:

> I'm trying to change a column name of the data slot of a SpatialPixelsDataFrame.
> I've added the column this way:
>
>> slot(EceZKRIG0_3,"data")[,index]<-Sim_mean_approx[[2]]
>
> The column added is V151 (as 151 is the actual index).
> I want to rename it, and I've tried:
>
>> names(slot(EceZKRIG0_3,"data")[index])<-"Mean_approx"

The point of the Spatial*DataFrame classes is to look like GIS to GIS 
people and data.frames to data people. Isn't it easier just to say:

EceZKRIG0_3$Mean_approx <- Sim_mean_approx[[2]]

There is also a names()<- method, so if you wanted to change a name, you 
could do it:

names(EceZKRIG0_3)[151] <- "Mean_approx"

library(sp)
data(meuse)
coordinates(meuse) <- c("x", "y")
class(meuse)
names(meuse)
meuse$s_lime <- sample(meuse$lime)
names(meuse)
names(meuse)[13] <- "not_slime"
names(meuse)

OK? Isn't that easier?

Roger

>
> No errors are raised, but the column remain V151. What's wrong?
>
> Giovanni
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From giohappy at gmail.com  Wed Mar 12 17:59:18 2008
From: giohappy at gmail.com (G. Allegri)
Date: Wed, 12 Mar 2008 17:59:18 +0100
Subject: [R-sig-Geo] change a column name of the data slot
In-Reply-To: <Pine.LNX.4.64.0803121747550.13400@reclus.nhh.no>
References: <e12429640803120937j706b8c4ardecd27abe39c1385@mail.gmail.com>
	<Pine.LNX.4.64.0803121747550.13400@reclus.nhh.no>
Message-ID: <e12429640803120959y45ab9049s1da42ddbb1d6918f@mail.gmail.com>

Roger, I have to get experience yet... I thought that the right way to
access the datas in Spatial*DataFrame should be through the use of
slots.
Thanks for the hint. Now things get easier! :-)

2008/3/12, Roger Bivand <Roger.Bivand at nhh.no>:
> On Wed, 12 Mar 2008, G. Allegri wrote:
>
>  > I'm trying to change a column name of the data slot of a SpatialPixelsDataFrame.
>  > I've added the column this way:
>  >
>  >> slot(EceZKRIG0_3,"data")[,index]<-Sim_mean_approx[[2]]
>  >
>  > The column added is V151 (as 151 is the actual index).
>  > I want to rename it, and I've tried:
>  >
>  >> names(slot(EceZKRIG0_3,"data")[index])<-"Mean_approx"
>
>
> The point of the Spatial*DataFrame classes is to look like GIS to GIS
>  people and data.frames to data people. Isn't it easier just to say:
>
>  EceZKRIG0_3$Mean_approx <- Sim_mean_approx[[2]]
>
>  There is also a names()<- method, so if you wanted to change a name, you
>  could do it:
>
>  names(EceZKRIG0_3)[151] <- "Mean_approx"
>
>  library(sp)
>  data(meuse)
>  coordinates(meuse) <- c("x", "y")
>  class(meuse)
>  names(meuse)
>  meuse$s_lime <- sample(meuse$lime)
>  names(meuse)
>  names(meuse)[13] <- "not_slime"
>  names(meuse)
>
>  OK? Isn't that easier?
>
>  Roger
>
>
>  >
>  > No errors are raised, but the column remain V151. What's wrong?
>  >
>  > Giovanni
>  >
>
> > _______________________________________________
>  > R-sig-Geo mailing list
>  > R-sig-Geo at stat.math.ethz.ch
>  > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>  >
>
>
>  --
>  Roger Bivand
>  Economic Geography Section, Department of Economics, Norwegian School of
>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  e-mail: Roger.Bivand at nhh.no
>
>



From murray.richardson at utoronto.ca  Wed Mar 12 17:59:28 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Wed, 12 Mar 2008 12:59:28 -0400
Subject: [R-sig-Geo] enumerate grid clusters/patches with size of contiguous
	cluster
Message-ID: <47D80BF0.70200@utoronto.ca>

Hello friends,

I am trying to take a binary input grid of patches (connected cells with 
value = 1), and assign to each non-zero cell the total number of pixels 
comprising the patch to which it belongs. 

So for a connected patch of 27 pixels, all cells belonging to that patch 
will have a value of 27.

Just wondering if anyone has any suggestions.  Maybe a function I don't 
know about yet...

Thanks in advance,

Murray Richardson



From andrew.niccolai at yale.edu  Wed Mar 12 18:12:23 2008
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Wed, 12 Mar 2008 13:12:23 -0400
Subject: [R-sig-Geo] enumerate grid clusters/patches with size of
	contiguous	cluster
In-Reply-To: <47D80BF0.70200@utoronto.ca>
References: <47D80BF0.70200@utoronto.ca>
Message-ID: <001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>

If you aren't dedicated to an R specific solution, ImageJ is open source and
does this under Analysis/Binary.

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray Richardson
Sent: Wednesday, March 12, 2008 12:59 PM
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] enumerate grid clusters/patches with size of contiguous
cluster

Hello friends,

I am trying to take a binary input grid of patches (connected cells with 
value = 1), and assign to each non-zero cell the total number of pixels 
comprising the patch to which it belongs. 

So for a connected patch of 27 pixels, all cells belonging to that patch 
will have a value of 27.

Just wondering if anyone has any suggestions.  Maybe a function I don't 
know about yet...

Thanks in advance,

Murray Richardson

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From dylan.beaudette at gmail.com  Wed Mar 12 18:34:42 2008
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Wed, 12 Mar 2008 09:34:42 -0800
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <47D00897.3090304@noaa.gov>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803050945.30314.dylan.beaudette@gmail.com>
	<47D00897.3090304@noaa.gov>
Message-ID: <200803121034.42952.dylan.beaudette@gmail.com>

On Thursday 06 March 2008, Thomas Adams wrote:
> Dylan,
>
> I think a solution using GRASS can be found on pages 110-111 of "Open
> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
> and judicious use of MASKs; a conditional statement in r.mapcalc is the
> key.
>
> Regards,
> Tom

Hi Tom,

Thanks for the suggestion. This works, but we were hoping to make the plot in 
R-- as the PDF output is hard to match with GRASS alone. I suppose I will 
just have to try using two rasters with spplot() and see what happens. 

Cheers,

Dylan

> Dylan Beaudette wrote:
> > On Tuesday 04 March 2008, Edzer Pebesma wrote:
> >> I find it hard to imagine how you want to plot two raster files on top
> >> of each other. Do you want some form of transparency? If it is just one
> >> overlaying the other, you could use overlay to find out which cells in
> >> raster 1 to replace with those in raster 2 before plotting.
> >> --
> >> Edzer
> >
> > Hi Edzer,
> >
> > I generally agree that plotting one raster file "over" another raster
> > file would be of little use. In this case, one of the raster files (the
> > interesting one) has been masked with nodata, such that it only really
> > covers about 30% of the region of interest. The other raster is just
> > contextual data, and thus would be useful to plot "behind" the first
> > raster.
> >
> > Ideas?
> >
> > Dylan
> >
> >> Dylan Beaudette wrote:
> >>> Hi,
> >>>
> >>> Is it possible to plot two raster images using spplot() in a manner
> >>> similar to:
> >>>
> >>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
> >>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
> >>>
> >>> Note that one of the raster images is an aerial photo, used only for
> >>> context, while the second one is one with interesting z-values. The
> >>> second raster is masked and thus does not cover the entire region.
> >>>
> >>> Thanks,
> >>>
> >>> Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341



From Agustin.Lobo at ija.csic.es  Wed Mar 12 18:33:44 2008
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Wed, 12 Mar 2008 18:33:44 +0100
Subject: [R-sig-Geo] enumerate grid clusters/patches with size
 of	contiguous cluster
In-Reply-To: <001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
References: <47D80BF0.70200@utoronto.ca>
	<001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
Message-ID: <47D813F8.2010806@ija.csic.es>

and a combination of r.clump and r.stats
in grass (which is "linked" to R) can also do the job.

Agus

Andrew Niccolai escribi?:
> If you aren't dedicated to an R specific solution, ImageJ is open source and
> does this under Analysis/Binary.
> 
> -----Original Message-----
> From: r-sig-geo-bounces at stat.math.ethz.ch
> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray Richardson
> Sent: Wednesday, March 12, 2008 12:59 PM
> To: r-sig-geo at stat.math.ethz.ch
> Subject: [R-sig-Geo] enumerate grid clusters/patches with size of contiguous
> cluster
> 
> Hello friends,
> 
> I am trying to take a binary input grid of patches (connected cells with 
> value = 1), and assign to each non-zero cell the total number of pixels 
> comprising the patch to which it belongs. 
> 
> So for a connected patch of 27 pixels, all cells belonging to that patch 
> will have a value of 27.
> 
> Just wondering if anyone has any suggestions.  Maybe a function I don't 
> know about yet...
> 
> Thanks in advance,
> 
> Murray Richardson
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Roger.Bivand at nhh.no  Wed Mar 12 18:54:08 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2008 18:54:08 +0100 (CET)
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <200803121034.42952.dylan.beaudette@gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803050945.30314.dylan.beaudette@gmail.com>
	<47D00897.3090304@noaa.gov>
	<200803121034.42952.dylan.beaudette@gmail.com>
Message-ID: <Pine.LNX.4.64.0803121842370.13400@reclus.nhh.no>

On Wed, 12 Mar 2008, Dylan Beaudette wrote:

> On Thursday 06 March 2008, Thomas Adams wrote:
>> Dylan,
>>
>> I think a solution using GRASS can be found on pages 110-111 of "Open
>> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
>> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
>> and judicious use of MASKs; a conditional statement in r.mapcalc is the
>> key.
>>
>> Regards,
>> Tom
>
> Hi Tom,
>
> Thanks for the suggestion. This works, but we were hoping to make the plot in
> R-- as the PDF output is hard to match with GRASS alone. I suppose I will
> just have to try using two rasters with spplot() and see what happens.
>

The problem is that customising a panel to insert an image probably means 
writing just that, customised panels, and spplot() essentially does that 
already. You could look at Chapter 5 in Paul Murrell's book, to see how to 
insert grid output into lattice output (to try to put an image as a 
backcloth, but there is no example for this case - the example is for 
adding a location position.

My guess would be that if you are only displaying a single panel, you will 
find it easier to use base graphics, and simply say image() twice, and use 
legend() (or legend.krige() from geoR).

Roger

> Cheers,
>
> Dylan
>
>> Dylan Beaudette wrote:
>>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>>>> I find it hard to imagine how you want to plot two raster files on top
>>>> of each other. Do you want some form of transparency? If it is just one
>>>> overlaying the other, you could use overlay to find out which cells in
>>>> raster 1 to replace with those in raster 2 before plotting.
>>>> --
>>>> Edzer
>>>
>>> Hi Edzer,
>>>
>>> I generally agree that plotting one raster file "over" another raster
>>> file would be of little use. In this case, one of the raster files (the
>>> interesting one) has been masked with nodata, such that it only really
>>> covers about 30% of the region of interest. The other raster is just
>>> contextual data, and thus would be useful to plot "behind" the first
>>> raster.
>>>
>>> Ideas?
>>>
>>> Dylan
>>>
>>>> Dylan Beaudette wrote:
>>>>> Hi,
>>>>>
>>>>> Is it possible to plot two raster images using spplot() in a manner
>>>>> similar to:
>>>>>
>>>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>>>
>>>>> Note that one of the raster images is an aerial photo, used only for
>>>>> context, while the second one is one with interesting z-values. The
>>>>> second raster is masked and thus does not cover the entire region.
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Dylan
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Agustin.Lobo at ija.csic.es  Wed Mar 12 18:55:24 2008
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Wed, 12 Mar 2008 18:55:24 +0100
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <200803121034.42952.dylan.beaudette@gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com>	<200803050945.30314.dylan.beaudette@gmail.com>	<47D00897.3090304@noaa.gov>
	<200803121034.42952.dylan.beaudette@gmail.com>
Message-ID: <47D8190C.5010205@ija.csic.es>

Well, the problem is that R does not have a real geographical
display. While things can be done going back and forth from R to GIS,
this procedure soon becomes very inconvenient. It's ok
for learning and teaching, but not for real applications.
Maybe getting an existing GIS to display spatial R objects
is actually easier than developing a geographical display for R.
Agus

Dylan Beaudette escribi?:
> On Thursday 06 March 2008, Thomas Adams wrote:
>> Dylan,
>>
>> I think a solution using GRASS can be found on pages 110-111 of "Open
>> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
>> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
>> and judicious use of MASKs; a conditional statement in r.mapcalc is the
>> key.
>>
>> Regards,
>> Tom
> 
> Hi Tom,
> 
> Thanks for the suggestion. This works, but we were hoping to make the plot in 
> R-- as the PDF output is hard to match with GRASS alone. I suppose I will 
> just have to try using two rasters with spplot() and see what happens. 
> 
> Cheers,
> 
> Dylan
> 
>> Dylan Beaudette wrote:
>>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>>>> I find it hard to imagine how you want to plot two raster files on top
>>>> of each other. Do you want some form of transparency? If it is just one
>>>> overlaying the other, you could use overlay to find out which cells in
>>>> raster 1 to replace with those in raster 2 before plotting.
>>>> --
>>>> Edzer
>>> Hi Edzer,
>>>
>>> I generally agree that plotting one raster file "over" another raster
>>> file would be of little use. In this case, one of the raster files (the
>>> interesting one) has been masked with nodata, such that it only really
>>> covers about 30% of the region of interest. The other raster is just
>>> contextual data, and thus would be useful to plot "behind" the first
>>> raster.
>>>
>>> Ideas?
>>>
>>> Dylan
>>>
>>>> Dylan Beaudette wrote:
>>>>> Hi,
>>>>>
>>>>> Is it possible to plot two raster images using spplot() in a manner
>>>>> similar to:
>>>>>
>>>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>>>
>>>>> Note that one of the raster images is an aerial photo, used only for
>>>>> context, while the second one is one with interesting z-values. The
>>>>> second raster is masked and thus does not cover the entire region.
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Dylan
> 
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From Roger.Bivand at nhh.no  Wed Mar 12 19:32:32 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 12 Mar 2008 19:32:32 +0100 (CET)
Subject: [R-sig-Geo] enumerate grid clusters/patches with size
 of	contiguous cluster
In-Reply-To: <47D813F8.2010806@ija.csic.es>
References: <47D80BF0.70200@utoronto.ca>
	<001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
	<47D813F8.2010806@ija.csic.es>
Message-ID: <Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>

On Wed, 12 Mar 2008, Agustin Lobo wrote:

> and a combination of r.clump and r.stats
> in grass (which is "linked" to R) can also do the job.

Yes, that will be very robust. I've tried an R attack through neighbour 
lists:

library(sp)
data(meuse.grid)
coordinates(meuse.grid) <- c("x", "y")
gridded(meuse.grid) <- TRUE
fullgrid(meuse.grid) <- TRUE
class(meuse.grid)
names(meuse.grid)
meuse.grid$ffreq1 <- meuse.grid$ffreq == 1
is.na(meuse.grid$ffreq1) <- !meuse.grid$ffreq1
image(meuse.grid, "ffreq1")
pix <- as(meuse.grid["ffreq1"], "SpatialPixelsDataFrame")
summary(pix)
image(pix)
library(spdep)
nb_rook <- dnearneigh(coordinates(pix), 0, 41)
nb_queen <- dnearneigh(coordinates(pix), 0, 57)
comp_rook <- n.comp.nb(nb_rook)
comp_queen <- n.comp.nb(nb_queen)
t_rook <- table(comp_rook$comp.id)
t_queen <- table(comp_queen$comp.id)
t_rook
t_queen
pix$rook <- comp_rook$comp.id
pix$queen <- comp_queen$comp.id
image(pix, "rook", col=rainbow(31))
pix$nrook <- t_rook[pix$rook]
pix$nqueen <- t_queen[pix$queen]
summary(pix)
image(pix, "nqueen")
spplot(pix, "nqueen")

using cut-off distances for distance-based neighbours just larger than the 
resolution and the diagonal resolution. There were only 779 cells in 
patches here, but it ran so fast that scaling up shouldn't be a problem.

Roger

>
> Agus
>
> Andrew Niccolai escribi?:
>> If you aren't dedicated to an R specific solution, ImageJ is open source and
>> does this under Analysis/Binary.
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at stat.math.ethz.ch
>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray Richardson
>> Sent: Wednesday, March 12, 2008 12:59 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] enumerate grid clusters/patches with size of contiguous
>> cluster
>>
>> Hello friends,
>>
>> I am trying to take a binary input grid of patches (connected cells with
>> value = 1), and assign to each non-zero cell the total number of pixels
>> comprising the patch to which it belongs.
>>
>> So for a connected patch of 27 pixels, all cells belonging to that patch
>> will have a value of 27.
>>
>> Just wondering if anyone has any suggestions.  Maybe a function I don't
>> know about yet...
>>
>> Thanks in advance,
>>
>> Murray Richardson
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From murray.richardson at utoronto.ca  Wed Mar 12 21:51:30 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Wed, 12 Mar 2008 16:51:30 -0400
Subject: [R-sig-Geo] [R] polygon shapefile from line edge coordinate list
In-Reply-To: <Pine.LNX.4.64.0803100816320.4337@reclus.nhh.no>
References: <47D16B75.4000508@utoronto.ca>
	<loom.20080308T121413-622@post.gmane.org>
	<47D48069.6030701@utoronto.ca>
	<Pine.LNX.4.64.0803100816320.4337@reclus.nhh.no>
Message-ID: <47D84252.9030502@utoronto.ca>

Thakns Roger

Since I am more familiar with postGIS I took that approach.  It worked 
like a charm.

I can post the script if you think it's worthwhile.

Murra

Roger Bivand wrote:
> On Sun, 9 Mar 2008, Murray Richardson wrote:
>
>> Hi Roger
>>
>> Thanks so much for your help.  I can definitely work with this.  On your
>> advice I'm responding via r-sig-geo.
>>
>> Unfortunately, there is no guarantee that the line segments will come in
>> any particular order from the alpha shapes routine.  In fact, there will
>> also likely be line segments from  different polys mixed together, so I
>> need to write the code so that the polygons are assembled only for
>> connected line segments.  I was naive when I started thinking about the
>> problem.  As you suggest, this could get messy.
>
> I understand. I might be tempted to use AWK externally to number the 
> unique (x,y) pairs, and reorder the text file externally. There is 
> some AWK code and shell scripts in the infrastructure in the maps 
> package and the two Bell Labs reports referenced there. They treat the 
> short line segment spaghetti scenario directly. Maybe that might 
> provide a way forward?
>
>>
>> As an alternative I may load the segments into a postGIS linestring
>> table and polygonize that, all via RODBC/postGIS.  An added benefit is
>> that it would clean up dangling segments, which may also exist.
>>
>
> This would be more robust, and via ogr2ogr would let you make the 
> shapefiles too. I'd prototype in AWK because I know it adequately and 
> don't know PostGIS, but if you already know PostGIS, the underlying 
> code is certainly stronger.
>
> Please let us know how you get on, others may face the same problem at 
> some time.
>
> Roger
>
>> Thanks again
>>
>> Murray
>>
>>
>>
>> Roger Bivand wrote:
>>> Murray Richardson <murray.richardson <at> utoronto.ca> writes:
>>>
>>>
>>>> Hello,
>>>>
>>>> I am looking for advice on a task I am trying to complete.
>>>>
>>>> I have a 4 column dataframe defining the start and end coordinates of
>>>> line edges (from a CGAL alpha shapes function to define concave hulls
>>>> from point clusters).  I would like to create polygon shapefiles from
>>>> these line edges, presumably creating lines first and then polygons.
>>>>
>>>
>>> How many polygons in each data.frame? If more than one, how are they
>>> separated? You note below that there are multiples, are they flagged by
>>> for example an NA row, or is there a jump from (endX endY) to the next
>>> (startX startY)?
>>>
>>>
>>>> e.g. columns are:
>>>>
>>>> startX  startY endX endY
>>>>
>>>> where each row represents start and end coordinates of a line segment.
>>>>
>>>
>>> Are the line segments ordered in sequence. If they are, something like:
>>>
>>> xy0 <- data.frame(sX=c(1,2,2,1,3,4,4,3), sY=c(1,1,2,2,3,3,4,4),
>>>   eX=c(2,2,1,1,4,4,3,3), eY=c(1,2,2,1,3,4,4,3))
>>>
>>> brks <- logical(nrow(xy0))
>>> for (i in 2:nrow(xy0)) brks[i] <- (xy0$sX[i] != xy0$eX[i-1]) &
>>>   (xy0$sY[i] != xy0$eY[i-1])
>>> cbrks <- cumsum(brks)+1
>>> # find the separate polygons
>>>
>>> xy1 <- split(xy0, cbrks)
>>>
>>> library(sp)
>>> Plist <- vector(mode="list", length=length(xy1))
>>> for (i in seq(along=Plist)) {
>>>   crds <- rbind(cbind(xy1[[i]]$sX, xy1[[i]]$sY),
>>>     c(xy1[[i]]$eX[nrow(xy1[[i]])], xy1[[i]]$eY[nrow(xy1[[i]])]))
>>> #   close the polygon
>>>   Plist[[i]] <- Polygons(list(Polygon(crds)), ID=names(xy1[i]))
>>> }
>>> # make a list of Polygons objects with IDs
>>>
>>> Plist1 <- SpatialPolygons(Plist)
>>> plot(Plist1, axes=TRUE)
>>> SPDF <- SpatialPolygonsDataFrame(Plist1, data=data.frame(i=names(xy1),
>>>   row.names=names(xy1)))
>>> # convert this to a SpatialPolygonsDataFrame object for export
>>>
>>> library(maptools)
>>> writePolyShape(SPDF, "chulls")
>>>
>>> If the segments are not in "join up the dots" sequence, it will be
>>> (even) more messy. Please also consider whether the R-sig-geo list
>>> might not be more relevant.
>>>
>>> Roger
>>>
>>>
>>>> I am new to R spatial packages and I am not sure which one is best
>>>> suited to this task. There seems to be a lot of options, which is 
>>>> great
>>>> but hard to know which one to start with.  Any suggestions on the best
>>>> way to proceed with this?  One further challenge is that the list
>>>> includes line segments defining multiple polygons.
>>>>
>>>> Thanks for any advice.
>>>>
>>>> Murray
>>>>
>>>> ______________________________________________
>>>> R-help <at> r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>>> PLEASE do read the posting guide 
>>>> http://www.R-project.org/posting-guide.html
>>>> and provide commented, minimal, self-contained, reproducible code.
>>>>
>>>>
>>>>
>>>
>>> ______________________________________________
>>> R-help at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-help
>>> PLEASE do read the posting guide 
>>> http://www.R-project.org/posting-guide.html
>>> and provide commented, minimal, self-contained, reproducible code.
>>>
>>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>



From murray.richardson at utoronto.ca  Wed Mar 12 21:59:37 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Wed, 12 Mar 2008 16:59:37 -0400
Subject: [R-sig-Geo] enumerate grid clusters/patches with size
 of	contiguous cluster
In-Reply-To: <Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>
References: <47D80BF0.70200@utoronto.ca>
	<001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
	<47D813F8.2010806@ija.csic.es>
	<Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>
Message-ID: <47D84439.3070109@utoronto.ca>

Thanks everyone for these responses

I'm pulling in too many different code sources already so I think I'll 
try Roger's approach and keep it in R.

Appreciate this.

Murray



Roger Bivand wrote:
> On Wed, 12 Mar 2008, Agustin Lobo wrote:
>
>> and a combination of r.clump and r.stats
>> in grass (which is "linked" to R) can also do the job.
>
> Yes, that will be very robust. I've tried an R attack through 
> neighbour lists:
>
> library(sp)
> data(meuse.grid)
> coordinates(meuse.grid) <- c("x", "y")
> gridded(meuse.grid) <- TRUE
> fullgrid(meuse.grid) <- TRUE
> class(meuse.grid)
> names(meuse.grid)
> meuse.grid$ffreq1 <- meuse.grid$ffreq == 1
> is.na(meuse.grid$ffreq1) <- !meuse.grid$ffreq1
> image(meuse.grid, "ffreq1")
> pix <- as(meuse.grid["ffreq1"], "SpatialPixelsDataFrame")
> summary(pix)
> image(pix)
> library(spdep)
> nb_rook <- dnearneigh(coordinates(pix), 0, 41)
> nb_queen <- dnearneigh(coordinates(pix), 0, 57)
> comp_rook <- n.comp.nb(nb_rook)
> comp_queen <- n.comp.nb(nb_queen)
> t_rook <- table(comp_rook$comp.id)
> t_queen <- table(comp_queen$comp.id)
> t_rook
> t_queen
> pix$rook <- comp_rook$comp.id
> pix$queen <- comp_queen$comp.id
> image(pix, "rook", col=rainbow(31))
> pix$nrook <- t_rook[pix$rook]
> pix$nqueen <- t_queen[pix$queen]
> summary(pix)
> image(pix, "nqueen")
> spplot(pix, "nqueen")
>
> using cut-off distances for distance-based neighbours just larger than 
> the resolution and the diagonal resolution. There were only 779 cells 
> in patches here, but it ran so fast that scaling up shouldn't be a 
> problem.
>
> Roger
>
>>
>> Agus
>>
>> Andrew Niccolai escribi?:
>>> If you aren't dedicated to an R specific solution, ImageJ is open 
>>> source and
>>> does this under Analysis/Binary.
>>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at stat.math.ethz.ch
>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray 
>>> Richardson
>>> Sent: Wednesday, March 12, 2008 12:59 PM
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Subject: [R-sig-Geo] enumerate grid clusters/patches with size of 
>>> contiguous
>>> cluster
>>>
>>> Hello friends,
>>>
>>> I am trying to take a binary input grid of patches (connected cells 
>>> with
>>> value = 1), and assign to each non-zero cell the total number of pixels
>>> comprising the patch to which it belongs.
>>>
>>> So for a connected patch of 27 pixels, all cells belonging to that 
>>> patch
>>> will have a value of 27.
>>>
>>> Just wondering if anyone has any suggestions.  Maybe a function I don't
>>> know about yet...
>>>
>>> Thanks in advance,
>>>
>>> Murray Richardson
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>



From edzer.pebesma at uni-muenster.de  Thu Mar 13 09:53:37 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 13 Mar 2008 09:53:37 +0100
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <47D8190C.5010205@ija.csic.es>
References: <200803041621.30538.dylan.beaudette@gmail.com>	<200803050945.30314.dylan.beaudette@gmail.com>	<47D00897.3090304@noaa.gov>	<200803121034.42952.dylan.beaudette@gmail.com>
	<47D8190C.5010205@ija.csic.es>
Message-ID: <47D8EB91.1090905@uni-muenster.de>

Agus, I disagree with your claim that R plot functions are not ok for 
real applications. Also, I use real applications for learning and 
teaching -- they are not fundamentally different.

In the trellis panel functions, or in the direct plot/image/lines etc 
functions, you plot in data coordinates. The main thing that the plot 
and spplot methods in package sp control is the aspect ratio. How else 
do data coordinates differ from geographical coordinates when it comes 
to plotting?

Are you refering to taking care of geographic (re)projection at that level?
--
Edzer

Agustin Lobo wrote:
> Well, the problem is that R does not have a real geographical
> display. While things can be done going back and forth from R to GIS,
> this procedure soon becomes very inconvenient. It's ok
> for learning and teaching, but not for real applications.
> Maybe getting an existing GIS to display spatial R objects
> is actually easier than developing a geographical display for R.
> Agus
>
> Dylan Beaudette escribi?:
>   
>> On Thursday 06 March 2008, Thomas Adams wrote:
>>     
>>> Dylan,
>>>
>>> I think a solution using GRASS can be found on pages 110-111 of "Open
>>> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
>>> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
>>> and judicious use of MASKs; a conditional statement in r.mapcalc is the
>>> key.
>>>
>>> Regards,
>>> Tom
>>>       
>> Hi Tom,
>>
>> Thanks for the suggestion. This works, but we were hoping to make the plot in 
>> R-- as the PDF output is hard to match with GRASS alone. I suppose I will 
>> just have to try using two rasters with spplot() and see what happens. 
>>
>> Cheers,
>>
>> Dylan
>>
>>     
>>> Dylan Beaudette wrote:
>>>       
>>>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>>>>         
>>>>> I find it hard to imagine how you want to plot two raster files on top
>>>>> of each other. Do you want some form of transparency? If it is just one
>>>>> overlaying the other, you could use overlay to find out which cells in
>>>>> raster 1 to replace with those in raster 2 before plotting.
>>>>> --
>>>>> Edzer
>>>>>           
>>>> Hi Edzer,
>>>>
>>>> I generally agree that plotting one raster file "over" another raster
>>>> file would be of little use. In this case, one of the raster files (the
>>>> interesting one) has been masked with nodata, such that it only really
>>>> covers about 30% of the region of interest. The other raster is just
>>>> contextual data, and thus would be useful to plot "behind" the first
>>>> raster.
>>>>
>>>> Ideas?
>>>>
>>>> Dylan
>>>>
>>>>         
>>>>> Dylan Beaudette wrote:
>>>>>           
>>>>>> Hi,
>>>>>>
>>>>>> Is it possible to plot two raster images using spplot() in a manner
>>>>>> similar to:
>>>>>>
>>>>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>>>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>>>>
>>>>>> Note that one of the raster images is an aerial photo, used only for
>>>>>> context, while the second one is one with interesting z-values. The
>>>>>> second raster is masked and thus does not cover the entire region.
>>>>>>
>>>>>> Thanks,
>>>>>>
>>>>>> Dylan
>>>>>>             
>>
>>     
>
>



From Roger.Bivand at nhh.no  Thu Mar 13 10:11:51 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Mar 2008 10:11:51 +0100 (CET)
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <47D8EB91.1090905@uni-muenster.de>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803050945.30314.dylan.beaudette@gmail.com>
	<47D00897.3090304@noaa.gov>
	<200803121034.42952.dylan.beaudette@gmail.com>
	<47D8190C.5010205@ija.csic.es> <47D8EB91.1090905@uni-muenster.de>
Message-ID: <Pine.LNX.4.64.0803131006200.15702@reclus.nhh.no>

On Thu, 13 Mar 2008, Edzer Pebesma wrote:

> Agus, I disagree with your claim that R plot functions are not ok for
> real applications. Also, I use real applications for learning and
> teaching -- they are not fundamentally different.
>
> In the trellis panel functions, or in the direct plot/image/lines etc
> functions, you plot in data coordinates. The main thing that the plot
> and spplot methods in package sp control is the aspect ratio. How else
> do data coordinates differ from geographical coordinates when it comes
> to plotting?

Exactly. In fact I think that a grid panel might make it possible to 
insert an image backdrop behind spplot(), which was the original question 
from Dylan - it would make a nice student project in visualisation. 
Something like an sp.image() for sp.layout=, but using its own palette and 
being painted over by the "real" data.

Roger

>
> Are you refering to taking care of geographic (re)projection at that level?
> --
> Edzer
>
> Agustin Lobo wrote:
>> Well, the problem is that R does not have a real geographical
>> display. While things can be done going back and forth from R to GIS,
>> this procedure soon becomes very inconvenient. It's ok
>> for learning and teaching, but not for real applications.
>> Maybe getting an existing GIS to display spatial R objects
>> is actually easier than developing a geographical display for R.
>> Agus
>>
>> Dylan Beaudette escribi?:
>>
>>> On Thursday 06 March 2008, Thomas Adams wrote:
>>>
>>>> Dylan,
>>>>
>>>> I think a solution using GRASS can be found on pages 110-111 of "Open
>>>> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
>>>> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
>>>> and judicious use of MASKs; a conditional statement in r.mapcalc is the
>>>> key.
>>>>
>>>> Regards,
>>>> Tom
>>>>
>>> Hi Tom,
>>>
>>> Thanks for the suggestion. This works, but we were hoping to make the plot in
>>> R-- as the PDF output is hard to match with GRASS alone. I suppose I will
>>> just have to try using two rasters with spplot() and see what happens.
>>>
>>> Cheers,
>>>
>>> Dylan
>>>
>>>
>>>> Dylan Beaudette wrote:
>>>>
>>>>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>>>>>
>>>>>> I find it hard to imagine how you want to plot two raster files on top
>>>>>> of each other. Do you want some form of transparency? If it is just one
>>>>>> overlaying the other, you could use overlay to find out which cells in
>>>>>> raster 1 to replace with those in raster 2 before plotting.
>>>>>> --
>>>>>> Edzer
>>>>>>
>>>>> Hi Edzer,
>>>>>
>>>>> I generally agree that plotting one raster file "over" another raster
>>>>> file would be of little use. In this case, one of the raster files (the
>>>>> interesting one) has been masked with nodata, such that it only really
>>>>> covers about 30% of the region of interest. The other raster is just
>>>>> contextual data, and thus would be useful to plot "behind" the first
>>>>> raster.
>>>>>
>>>>> Ideas?
>>>>>
>>>>> Dylan
>>>>>
>>>>>
>>>>>> Dylan Beaudette wrote:
>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> Is it possible to plot two raster images using spplot() in a manner
>>>>>>> similar to:
>>>>>>>
>>>>>>> pts <- list("sp.points", points_file, pch = 4, col = "black", cex=0.5)
>>>>>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>>>>>
>>>>>>> Note that one of the raster images is an aerial photo, used only for
>>>>>>> context, while the second one is one with interesting z-values. The
>>>>>>> second raster is masked and thus does not cover the entire region.
>>>>>>>
>>>>>>> Thanks,
>>>>>>>
>>>>>>> Dylan
>>>>>>>
>>>
>>>
>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From nikko at hailmail.net  Thu Mar 13 17:04:50 2008
From: nikko at hailmail.net (Nicholas Lewin-Koh)
Date: Thu, 13 Mar 2008 12:04:50 -0400
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 55, Issue 11
In-Reply-To: <mailman.7.1205406002.7286.r-sig-geo@stat.math.ethz.ch>
References: <mailman.7.1205406002.7286.r-sig-geo@stat.math.ethz.ch>
Message-ID: <1205424290.25140.1242224739@webmail.messagingengine.com>

Hi Jeff,
I think you can fit a spatial error model using a glmm in nlme or lme4.
The negative binomial
is not implemented, but a gamma model (if your counts are "well
behaved") should be a good approximation.
Another posibility is to use the VGAM package or mgcv and assume a
smooth surface for your x and y coordinates.
This of course is not the same as a spatial lag model, but does capture
the spatial trend (if any).

If overdispersion is the problem you can probably use the Poisson model
and try to bring the extra variation in as a random effect. You haven't
given us the
structure of your data. Is it the number of bird species at each point?
Is it 
counts of birds along a gradient? How the sampling was done is
important.

Nicholas

> Date: Wed, 12 Mar 2008 09:46:42 -0400
> From: "Stratford, Jeffrey" <jeffrey.stratford at wilkes.edu>
> Subject: [R-sig-Geo]   spatial verions of negative binomial
> To: <r-sig-geo at stat.math.ethz.ch>
> Message-ID:
> 	<72B2B2BDFE51E64DAC63814956149800248553 at STAFFEXCHVS3.wilkesu.wilkes.edu>
> 	
> Content-Type: text/plain;	charset="US-ASCII"
> 
> Hi group,
> 
> Does anyone have code for spatial error and spatial lag models for
> negative binomial distributions?  There are spatial error and lag models
> in the Dormann et al. Ecography paper (a very nice read) but these fit
> linear models.  Or is there a way to modify the Poison models?  
> 
> If code doesn't exist and you want to develop it, I would be happy to
> give you authorship.  I know that WinBugs can be modified but I have no
> experience with programming it.  
> 
> It's a very straightforward data set and a very important paper looking
> at the effects of urbanization on avian species richness.  The original
> ms was accepted by one reviewer and rejected by the second, who wanted
> to incorporate spatial autocorrelation.  
> 
> Cheers,
> 
> Jeff
> 
> 
>



From Agustin.Lobo at ija.csic.es  Thu Mar 13 19:42:11 2008
From: Agustin.Lobo at ija.csic.es (Agustin Lobo)
Date: Thu, 13 Mar 2008 19:42:11 +0100
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <47D8EB91.1090905@uni-muenster.de>
References: <200803041621.30538.dylan.beaudette@gmail.com>	<200803050945.30314.dylan.beaudette@gmail.com>	<47D00897.3090304@noaa.gov>	<200803121034.42952.dylan.beaudette@gmail.com>
	<47D8190C.5010205@ija.csic.es> <47D8EB91.1090905@uni-muenster.de>
Message-ID: <47D97583.9040801@ija.csic.es>

Edzer,

Edzer Pebesma escribi?:
> Agus, I disagree with your claim that R plot functions are not ok for 
> real applications. Also, I use real applications for learning and 
> teaching -- they are not fundamentally different.

Yes they are: we use the results of real applications as examples
for teaching. Real applications need a lot of (geo)graphical interaction
for being developed, which cannot be done in the (not geo)graphical
display of R, you need a GIS display for that. In my case, in most cases 
I have to export the
sp objects as rasters or shp files, bring them to a GIS and interact
with them (and many other layers of information) there (for example,
getting on-screen values as tips, zooming in and out, changing the
background from one color composite to another, calculating buffers,
interactively measuring distances, selecting polygons according to an
associated database...). These operations are required to evaluate
results and to think on alternative approaches, and have to be done
easily and fast. If your problem is
solved with one single cycle involving one analysis in R, exporting to shp
and displaying, this is fine. But if you have to iterate
this process, having the option of displaying the sp
objects directly in the GIS display would be an advantage.

> In the trellis panel functions, or in the direct plot/image/lines etc 
> functions, you plot in data coordinates. The main thing that the plot 
> and spplot methods in package sp control is the aspect ratio. How else 
> do data coordinates differ from geographical coordinates when it comes 
> to plotting?
> 
> Are you refering to taking care of geographic (re)projection at that level?

This is one case, yes: if your GIS supports on-the-fly reprojection, you
can use layers from geodata distribution centers that work with a
different projection
than yours and display them along with your R (exported) layers,
no need for the user to run a reprojection, it's automatically done.
This is often the case here, where we normally work with UTM but get
many layers at European scale that are in a different projection.

In a previous message you said:
>>>>>> I find it hard to imagine how you want to plot two raster files on
>>>>>> top
>>>>>> of each other.

Well, in many GIS displays you just define a rectangle that you can move
on top of one raster as a window through which you can see (and check
values of) an underlying raster. This is most useful, and is set up in
seconds. Also, perhaps Dylan's problem could have been solved in a
GIS by
displaying the Z values as terrain, and draping the other raster on top
of it. Or just defining shades for the second raster. Or perhaps setting
a 50% of transparency for some regions of one raster...

Geographic information requires GIS display, that's why GIS displays exist.

In much the same way as the analysis of geographic data required the
design of sp
objects, the visualization of geographic data requires a geographic
display. Getting sp objects directly displayed on a GIS would be great.

Agus

> -- 
> Edzer
> 
> Agustin Lobo wrote:
>> Well, the problem is that R does not have a real geographical
>> display. While things can be done going back and forth from R to GIS,
>> this procedure soon becomes very inconvenient. It's ok
>> for learning and teaching, but not for real applications.
>> Maybe getting an existing GIS to display spatial R objects
>> is actually easier than developing a geographical display for R.
>> Agus
>>
>> Dylan Beaudette escribi?:
>>  
>>> On Thursday 06 March 2008, Thomas Adams wrote:
>>>    
>>>> Dylan,
>>>>
>>>> I think a solution using GRASS can be found on pages 110-111 of "Open
>>>> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
>>>> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
>>>> and judicious use of MASKs; a conditional statement in r.mapcalc is the
>>>> key.
>>>>
>>>> Regards,
>>>> Tom
>>>>       
>>> Hi Tom,
>>>
>>> Thanks for the suggestion. This works, but we were hoping to make the 
>>> plot in R-- as the PDF output is hard to match with GRASS alone. I 
>>> suppose I will just have to try using two rasters with spplot() and 
>>> see what happens.
>>> Cheers,
>>>
>>> Dylan
>>>
>>>    
>>>> Dylan Beaudette wrote:
>>>>      
>>>>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
>>>>>        
>>>>>> I find it hard to imagine how you want to plot two raster files on 
>>>>>> top
>>>>>> of each other. Do you want some form of transparency? If it is 
>>>>>> just one
>>>>>> overlaying the other, you could use overlay to find out which 
>>>>>> cells in
>>>>>> raster 1 to replace with those in raster 2 before plotting.
>>>>>> -- 
>>>>>> Edzer
>>>>>>           
>>>>> Hi Edzer,
>>>>>
>>>>> I generally agree that plotting one raster file "over" another raster
>>>>> file would be of little use. In this case, one of the raster files 
>>>>> (the
>>>>> interesting one) has been masked with nodata, such that it only really
>>>>> covers about 30% of the region of interest. The other raster is just
>>>>> contextual data, and thus would be useful to plot "behind" the first
>>>>> raster.
>>>>>
>>>>> Ideas?
>>>>>
>>>>> Dylan
>>>>>
>>>>>        
>>>>>> Dylan Beaudette wrote:
>>>>>>          
>>>>>>> Hi,
>>>>>>>
>>>>>>> Is it possible to plot two raster images using spplot() in a manner
>>>>>>> similar to:
>>>>>>>
>>>>>>> pts <- list("sp.points", points_file, pch = 4, col = "black", 
>>>>>>> cex=0.5)
>>>>>>> spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
>>>>>>>
>>>>>>> Note that one of the raster images is an aerial photo, used only for
>>>>>>> context, while the second one is one with interesting z-values. The
>>>>>>> second raster is masked and thus does not cover the entire region.
>>>>>>>
>>>>>>> Thanks,
>>>>>>>
>>>>>>> Dylan
>>>>>>>             
>>>
>>>     
>>
>>   
> 
> 

-- 
Dr. Agustin Lobo
Institut de Ciencies de la Terra "Jaume Almera" (CSIC)
LLuis Sole Sabaris s/n
08028 Barcelona
Spain
Tel. 34 934095410
Fax. 34 934110012
email: Agustin.Lobo at ija.csic.es
http://www.ija.csic.es/gt/obster



From h.wickham at gmail.com  Thu Mar 13 20:31:18 2008
From: h.wickham at gmail.com (hadley wickham)
Date: Thu, 13 Mar 2008 14:31:18 -0500
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <Pine.LNX.4.64.0803131006200.15702@reclus.nhh.no>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803050945.30314.dylan.beaudette@gmail.com>
	<47D00897.3090304@noaa.gov>
	<200803121034.42952.dylan.beaudette@gmail.com>
	<47D8190C.5010205@ija.csic.es> <47D8EB91.1090905@uni-muenster.de>
	<Pine.LNX.4.64.0803131006200.15702@reclus.nhh.no>
Message-ID: <f8e6ff050803131231k6a7bd7b7g4484fd1003ee6aab@mail.gmail.com>

>  > In the trellis panel functions, or in the direct plot/image/lines etc
>  > functions, you plot in data coordinates. The main thing that the plot
>  > and spplot methods in package sp control is the aspect ratio. How else
>  > do data coordinates differ from geographical coordinates when it comes
>  > to plotting?
>
>  Exactly. In fact I think that a grid panel might make it possible to
>  insert an image backdrop behind spplot(), which was the original question
>  from Dylan - it would make a nice student project in visualisation.
>  Something like an sp.image() for sp.layout=, but using its own palette and
>  being painted over by the "real" data.

Another approach would be to develop a better interface between
spatial data and ggplot2, which provides much better support for layer
compositing (and in general for modifying a plot after you have
created it).  There are some simple examples at
http://had.co.nz/ggplot2/geom_polygon.html and
http://had.co.nz/ggplot2/coord_map.html, but I don't know enough about
the problems of spatial data to be able to do it all myself.

Hadley


-- 
http://had.co.nz/



From Roger.Bivand at nhh.no  Thu Mar 13 21:39:36 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 13 Mar 2008 21:39:36 +0100 (CET)
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <f8e6ff050803131231k6a7bd7b7g4484fd1003ee6aab@mail.gmail.com>
References: <200803041621.30538.dylan.beaudette@gmail.com> 
	<200803050945.30314.dylan.beaudette@gmail.com>
	<47D00897.3090304@noaa.gov>
	<200803121034.42952.dylan.beaudette@gmail.com>
	<47D8190C.5010205@ija.csic.es> <47D8EB91.1090905@uni-muenster.de>
	<Pine.LNX.4.64.0803131006200.15702@reclus.nhh.no>
	<f8e6ff050803131231k6a7bd7b7g4484fd1003ee6aab@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803132107330.16765@reclus.nhh.no>

On Thu, 13 Mar 2008, hadley wickham wrote:

>> > In the trellis panel functions, or in the direct plot/image/lines etc
>> > functions, you plot in data coordinates. The main thing that the plot
>> > and spplot methods in package sp control is the aspect ratio. How else
>> > do data coordinates differ from geographical coordinates when it comes
>> > to plotting?
>>
>>  Exactly. In fact I think that a grid panel might make it possible to
>>  insert an image backdrop behind spplot(), which was the original question
>>  from Dylan - it would make a nice student project in visualisation.
>>  Something like an sp.image() for sp.layout=, but using its own palette and
>>  being painted over by the "real" data.
>
> Another approach would be to develop a better interface between
> spatial data and ggplot2, which provides much better support for layer
> compositing (and in general for modifying a plot after you have
> created it).  There are some simple examples at
> http://had.co.nz/ggplot2/geom_polygon.html and
> http://had.co.nz/ggplot2/coord_map.html, but I don't know enough about
> the problems of spatial data to be able to do it all myself.

Maybe, but as Wilkinson says, his proposal is not a GIS either. I'm sorry 
nobody replied to your question earlier about using mapproj. Even the way 
Wilkinson addresses things isn't going to deliver unless the data and the 
graphics stay very close together.

This is the mapproj problem, the projected coordinates are an eclectic 
rendering, not something that can be used for anything else than display. 
Over thousands of km, the problems are not so clear, but over a couple of 
km they are showstoppers.

It looks as though Simon Urbanek has been trying to "do it his way" for 
iplots by publishing a limited interface to PROJ.4 on CRAN as a proj4 
package, presumably because there are real issues in providing proper 
support on OSX, and on Windows (I don't imagine that he didn't know that 
PROJ.4 is interfaced in rgdal, because I have asked for his help in 
finding a mechanism for producing rgdal binaries for OSX with minimal 
intervention). The Windows issues are fully addressed by rgdal (but not in 
proj4, there is no PROJ.4 share/), which he could have used, but chose not 
to. Perhaps I should ask again whether he could help automate the 
production of rgdal binaries for OSX?

Yes, you are right that this needs doing in concert between people who 
understand both sides, the graphics side, and crucially the spatial data 
side, because the layering fails unless the data are correctly aligned. 
This constrains the ways the data can be represented, and the S data model 
of a two-column matrix with NAs to separate geometric entities is simply 
not sufficiently robust.

Roger

>
> Hadley
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From modern82376 at mypacks.net  Thu Mar 13 22:10:27 2008
From: modern82376 at mypacks.net (modern82376 at mypacks.net)
Date: Thu, 13 Mar 2008 17:10:27 -0400 (EDT)
Subject: [R-sig-Geo] writing shapefiles using write.pointShape
Message-ID: <8489940.1205442627177.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>

I've been running gwr on some survey data and trying to write output back out to point shapefiles. At first, I thought that the shapefile wasn't being written, but after calling the file object I found it in a local settings/temp folder with a random shapefile name. I thought I had specified all that, but I'm obviously not familiar enough with the syntax to get it right. Would someone mind assisting me on this?  Code follows..

> library(spgwr)
> surveypts <- readShapePoints("C:/temp/NE_survey.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
> survey.bw <- gwr.sel(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data=surveypts)
> fitpts <- readShapePoints("C:/temp/fitpts.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
> fitpix <- SpatialPixels(fitpts, proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
> surv.local <- ggwr(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, adapt = NULL, fit.points = fitpix, longlat = FALSE)
> surv.local

Call:
ggwr(formula = GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, 
    data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, 
    adapt = NULL, fit.points = fitpix, longlat = FALSE)
Kernel function: gwr.Gauss 
Fixed bandwidth: 22738.78 
Summary of GWR coefficient estimates:
                   Min.    1st Qu.     Median    3rd Qu.       Max.   Global
X.Intercept. -4.176e+03 -9.067e+01 -3.565e+00  8.029e+01  4.402e+03 -73.5570
pca1         -2.567e+00 -2.289e-02 -1.725e-03  1.674e-02  3.135e-01  -0.0077
PCA2         -7.874e+01 -6.543e-01 -1.934e-01  2.298e-01  2.016e+01  -0.2667
PCA3         -8.844e+01 -1.236e+00 -1.109e-01  6.008e-01  1.469e+02   0.0202
PCA4         -1.272e+01 -3.509e-01  3.005e-01  1.178e+00  3.386e+02   0.8161
PCA5         -1.368e+02 -1.134e+00 -8.233e-03  9.222e-01  4.384e+01   0.6937

> names(surv.local$SDF)

[1] "sum.w"           "X.Intercept."    "pca1"            "PCA2"            "PCA3"           
[6] "PCA4"            "PCA5"            "dispersion"      "response_resids"

> coords <- coordinates(fitpts)
> pca1 <- cbind(coords, surv.local$SDF$pca1)
> summary(pca1)
   coords.x1         coords.x2            V3           
 Min.   :-670120   Min.   :287533   Min.   :-2.566983  
 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891  
 Median :-417620   Median :464533   Median :-0.001725  
 Mean   :-417620   Mean   :464533   Mean   :-0.047442  
 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741  
 Max.   :-165120   Max.   :641533   Max.   : 0.313544 

>class(pca1)
[1] "matrix"
> dim(pca1)
[1] 179630      3
> all(dim(dpca1 <- as.data.frame(pca1)) == c(179630,3))
[1] TRUE
> summary(dpca1)
   coords.x1         coords.x2            V3           
 Min.   :-670120   Min.   :287533   Min.   :-2.566983  
 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891  
 Median :-417620   Median :464533   Median :-0.001725  
 Mean   :-417620   Mean   :464533   Mean   :-0.047442  
 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741  
 Max.   :-165120   Max.   :641533   Max.   : 0.313544  
> class(dpca1)
[1] "data.frame"

> B1pca1 <- tempfile("C:\temp")
> write.pointShape(coords, df=dpca1, B1pca1, factor2char=TRUE)
(Where's the shapefile??)

>B1pca1
[1] "C:\\DOCUME~1\\gcook\\LOCALS~1\\Temp\\Rtmpijon4d\\C:\temp1eb26e9"


After calling B1pca1, I find a randomly named shapefile (with .dbf and .shx)extensions in the .../Local Settings/Temp/ folder. I'm trying to name the file "B1pca1.shp" and I want it to go in the C:/Temp folder (for now). I've tried a few permutations of the last two commands, but I'm just not getting it right.

Thanks so much :)

Gericke



From modern82376 at mypacks.net  Thu Mar 13 23:08:13 2008
From: modern82376 at mypacks.net (modern82376 at mypacks.net)
Date: Thu, 13 Mar 2008 18:08:13 -0400 (EDT)
Subject: [R-sig-Geo] writing shapefiles using write.pointShape
Message-ID: <3879560.1205446093396.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>

I'm also having issues with getting the gw.cov function to work for fit points. Here's an example, using the same files...

> pcavars <- names(surveypts[,4:8])
> pcavars
[1] "pca1" "PCA2" "PCA3" "PCA4" "PCA5"
> surv.cov <- gw.cov(data = surveypts, vars = pcavars, fit.points = fitpix, bw = survey.bw)
Error in gw.cov(surveypts, test, fit.points = fitpix, bw = survey.bw) : 
  unused argument(s) (fit.points = <S4 object of class "SpatialPixels">)

As far as I can tell, I'm using the same syntax as in the ggwr function. Thanks again. =)

Gericke Cook
USDA APHIS


-----Original Message-----
>From: modern82376 at mypacks.net
>Sent: Mar 13, 2008 5:10 PM
>To: r-sig-geo at stat.math.ethz.ch
>Subject: [R-sig-Geo] writing shapefiles using write.pointShape
>
>I've been running gwr on some survey data and trying to write output back out to point shapefiles. At first, I thought that the shapefile wasn't being written, but after calling the file object I found it in a local settings/temp folder with a random shapefile name. I thought I had specified all that, but I'm obviously not familiar enough with the syntax to get it right. Would someone mind assisting me on this?  Code follows..
>
>> library(spgwr)
>> surveypts <- readShapePoints("C:/temp/NE_survey.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>> survey.bw <- gwr.sel(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data=surveypts)
>> fitpts <- readShapePoints("C:/temp/fitpts.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>> fitpix <- SpatialPixels(fitpts, proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>> surv.local <- ggwr(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, adapt = NULL, fit.points = fitpix, longlat = FALSE)
>> surv.local
>
>Call:
>ggwr(formula = GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, 
>    data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, 
>    adapt = NULL, fit.points = fitpix, longlat = FALSE)
>Kernel function: gwr.Gauss 
>Fixed bandwidth: 22738.78 
>Summary of GWR coefficient estimates:
>                   Min.    1st Qu.     Median    3rd Qu.       Max.   Global
>X.Intercept. -4.176e+03 -9.067e+01 -3.565e+00  8.029e+01  4.402e+03 -73.5570
>pca1         -2.567e+00 -2.289e-02 -1.725e-03  1.674e-02  3.135e-01  -0.0077
>PCA2         -7.874e+01 -6.543e-01 -1.934e-01  2.298e-01  2.016e+01  -0.2667
>PCA3         -8.844e+01 -1.236e+00 -1.109e-01  6.008e-01  1.469e+02   0.0202
>PCA4         -1.272e+01 -3.509e-01  3.005e-01  1.178e+00  3.386e+02   0.8161
>PCA5         -1.368e+02 -1.134e+00 -8.233e-03  9.222e-01  4.384e+01   0.6937
>
>> names(surv.local$SDF)
>
>[1] "sum.w"           "X.Intercept."    "pca1"            "PCA2"            "PCA3"           
>[6] "PCA4"            "PCA5"            "dispersion"      "response_resids"
>
>> coords <- coordinates(fitpts)
>> pca1 <- cbind(coords, surv.local$SDF$pca1)
>> summary(pca1)
>   coords.x1         coords.x2            V3           
> Min.   :-670120   Min.   :287533   Min.   :-2.566983  
> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891  
> Median :-417620   Median :464533   Median :-0.001725  
> Mean   :-417620   Mean   :464533   Mean   :-0.047442  
> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741  
> Max.   :-165120   Max.   :641533   Max.   : 0.313544 
>
>>class(pca1)
>[1] "matrix"
>> dim(pca1)
>[1] 179630      3
>> all(dim(dpca1 <- as.data.frame(pca1)) == c(179630,3))
>[1] TRUE
>> summary(dpca1)
>   coords.x1         coords.x2            V3           
> Min.   :-670120   Min.   :287533   Min.   :-2.566983  
> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891  
> Median :-417620   Median :464533   Median :-0.001725  
> Mean   :-417620   Mean   :464533   Mean   :-0.047442  
> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741  
> Max.   :-165120   Max.   :641533   Max.   : 0.313544  
>> class(dpca1)
>[1] "data.frame"
>
>> B1pca1 <- tempfile("C:\temp")
>> write.pointShape(coords, df=dpca1, B1pca1, factor2char=TRUE)
>(Where's the shapefile??)
>
>>B1pca1
>[1] "C:\\DOCUME~1\\gcook\\LOCALS~1\\Temp\\Rtmpijon4d\\C:\temp1eb26e9"
>
>
>After calling B1pca1, I find a randomly named shapefile (with .dbf and .shx)extensions in the .../Local Settings/Temp/ folder. I'm trying to name the file "B1pca1.shp" and I want it to go in the C:/Temp folder (for now). I've tried a few permutations of the last two commands, but I'm just not getting it right.
>
>Thanks so much :)
>
>Gericke
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From lienert at karto.baug.ethz.ch  Fri Mar 14 11:44:34 2008
From: lienert at karto.baug.ethz.ch (Lienert  Christophe)
Date: Fri, 14 Mar 2008 11:44:34 +0100
Subject: [R-sig-Geo] gdal error 1 (execution halted)
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
Message-ID: <A0C7AADAEF32A64696B51EC0F31A90E303E3CF0A@EX4.d.ethz.ch>

Dear All,
Parts of the he following email have been already posted on the R-devel list, but is supplemented with the code that may cause the error discussed below and put on the R-sig-geo list at the suggestion of Mr. Bivand.
 
I am using R 2.6.2 on my Redhat AS4. I installed the RPM offered on the cran website. I would like to use R from my bash console with the following command:

/path/to/R --vanilla --slave --args < /data/myscript.R

this script invokes a range of functions and tools, among others to process a bunch of raster images in a loop using GDAL. The thing is that releasing this command in the bash results in the following error:
 
ERROR:
*************************************

Error in GDAL.close(tds.out) :
        GDAL Error 1: TIFFReadDirectory:/tmp/RtmpBgrSyt/file2ef6a5b2: cannot handle zero scanline size
Calls: plot.georef -> GDAL.close -> .Call
Execution halted



CODE:
*************************************


plot.georef=function(grid.sp,graph.file,col.palette,breaks){

  require("sp")
  require("rgdal")

  # get desired picture type
  base.name=strsplit(graph.file,"/")[[1]][length(strsplit(graph.file,"/")[[1]])]
  ft=0
  ft=sum(c(ft,grep(".tiff",base.name)))
  if (ft==1){ file.typ="TIFF" }
  ft=0
  ft=sum(c(ft,grep(".jpg",base.name)))
  if (ft==1){ file.typ="JPG" }
  ft=0
  ft=sum(c(ft,grep(".png",base.name)))
  if (ft==1){ file.typ="PNG" }

  # create RGB bands
  names(grid.sp)=c("band1","band2")
  grid.sp$band3=grid.sp$band2
  grid.sp$band4=grid.sp$band2
  
  col.class=as.vector(cut(grid.sp$band1,br = breaks, labels=col.palette))
  col.class[is.na(col.class)]="#FFFFFF"
  col.class.rgb=col2rgb(col.class)

  grid.sp$band1=col.class.rgb["red",]
  grid.sp$band2=col.class.rgb["green",]
  grid.sp$band3=col.class.rgb["blue",]
  grid.sp$band4[]=256

  if (file.typ=="TIFF"){

    #writeGDAL(grid.sp, graph.file,drivername = "GTiff",type = "band",options="ALPHA=YES")
    tds.out <- create2GDAL(dataset=grid.sp,drivername="GTiff",type="band")
    saveDataset(tds.out,graph.file)
    GDAL.close(tds.out)
  }
}




The error is most likely in the if control. Both variants (the with only the commented line and the one with only the three following lines) produce the error.  
Thanks for any help!

Ciao,

Chris

_______________________________________________
Christophe Lienert 
ETH Zurich 
Institute of Cartography 
Wolfgang-Pauli-Str. 15 
HIL G 13.3 
CH-8093 Zurich
SWITZERLAND

Fon: +41-44-6333036 
Fax: +41-44-6331153
www.karto.ethz.ch 
lienert at karto.baug.ethz.ch



From murray.richardson at utoronto.ca  Fri Mar 14 13:37:00 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Fri, 14 Mar 2008 08:37:00 -0400
Subject: [R-sig-Geo] enumerate grid clusters/patches with size
 of	contiguous cluster
In-Reply-To: <Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>
References: <47D80BF0.70200@utoronto.ca>
	<001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
	<47D813F8.2010806@ija.csic.es>
	<Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>
Message-ID: <47DA716C.8090601@utoronto.ca>

Hi Roger and others,

Thanks again for this helpful script.  It made me see some potential to 
use spdep package for another related problem that I was previously 
using CGAL (C++) alpha shapes for.

Is there a way to output a list of nearest neighbour pairs in an xy 
coordinate list (or binary grid for that matter I guess).  I would like 
to convert a binary grid of lines (1 cell thick) to a constituent line 
segment list of the form (startx, starty, end x end y), which I then 
polygonize using RODBC/postGIS, as we discussed in a previous thread.

Thanks in advance!

Murray

Roger Bivand wrote:
> On Wed, 12 Mar 2008, Agustin Lobo wrote:
>
>> and a combination of r.clump and r.stats
>> in grass (which is "linked" to R) can also do the job.
>
> Yes, that will be very robust. I've tried an R attack through 
> neighbour lists:
>
> library(sp)
> data(meuse.grid)
> coordinates(meuse.grid) <- c("x", "y")
> gridded(meuse.grid) <- TRUE
> fullgrid(meuse.grid) <- TRUE
> class(meuse.grid)
> names(meuse.grid)
> meuse.grid$ffreq1 <- meuse.grid$ffreq == 1
> is.na(meuse.grid$ffreq1) <- !meuse.grid$ffreq1
> image(meuse.grid, "ffreq1")
> pix <- as(meuse.grid["ffreq1"], "SpatialPixelsDataFrame")
> summary(pix)
> image(pix)
> library(spdep)
> nb_rook <- dnearneigh(coordinates(pix), 0, 41)
> nb_queen <- dnearneigh(coordinates(pix), 0, 57)
> comp_rook <- n.comp.nb(nb_rook)
> comp_queen <- n.comp.nb(nb_queen)
> t_rook <- table(comp_rook$comp.id)
> t_queen <- table(comp_queen$comp.id)
> t_rook
> t_queen
> pix$rook <- comp_rook$comp.id
> pix$queen <- comp_queen$comp.id
> image(pix, "rook", col=rainbow(31))
> pix$nrook <- t_rook[pix$rook]
> pix$nqueen <- t_queen[pix$queen]
> summary(pix)
> image(pix, "nqueen")
> spplot(pix, "nqueen")
>
> using cut-off distances for distance-based neighbours just larger than 
> the resolution and the diagonal resolution. There were only 779 cells 
> in patches here, but it ran so fast that scaling up shouldn't be a 
> problem.
>
> Roger
>
>>
>> Agus
>>
>> Andrew Niccolai escribi?:
>>> If you aren't dedicated to an R specific solution, ImageJ is open 
>>> source and
>>> does this under Analysis/Binary.
>>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at stat.math.ethz.ch
>>> [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray 
>>> Richardson
>>> Sent: Wednesday, March 12, 2008 12:59 PM
>>> To: r-sig-geo at stat.math.ethz.ch
>>> Subject: [R-sig-Geo] enumerate grid clusters/patches with size of 
>>> contiguous
>>> cluster
>>>
>>> Hello friends,
>>>
>>> I am trying to take a binary input grid of patches (connected cells 
>>> with
>>> value = 1), and assign to each non-zero cell the total number of pixels
>>> comprising the patch to which it belongs.
>>>
>>> So for a connected patch of 27 pixels, all cells belonging to that 
>>> patch
>>> will have a value of 27.
>>>
>>> Just wondering if anyone has any suggestions.  Maybe a function I don't
>>> know about yet...
>>>
>>> Thanks in advance,
>>>
>>> Murray Richardson
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>



From Roger.Bivand at nhh.no  Fri Mar 14 14:18:34 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 14 Mar 2008 14:18:34 +0100 (CET)
Subject: [R-sig-Geo] enumerate grid clusters/patches with size
 of	contiguous cluster
In-Reply-To: <47DA716C.8090601@utoronto.ca>
References: <47D80BF0.70200@utoronto.ca>
	<001401c88464$3d0fa290$b72ee7b0$@niccolai@yale.edu>
	<47D813F8.2010806@ija.csic.es>
	<Pine.LNX.4.64.0803121925250.13400@reclus.nhh.no>
	<47DA716C.8090601@utoronto.ca>
Message-ID: <Pine.LNX.4.64.0803141416150.27371@reclus.nhh.no>

On Fri, 14 Mar 2008, Murray Richardson wrote:

> Hi Roger and others,
>
> Thanks again for this helpful script.  It made me see some potential to use 
> spdep package for another related problem that I was previously using CGAL 
> (C++) alpha shapes for.
>
> Is there a way to output a list of nearest neighbour pairs in an xy 
> coordinate list (or binary grid for that matter I guess).  I would like to 
> convert a binary grid of lines (1 cell thick) to a constituent line segment 
> list of the form (startx, starty, end x end y), which I then polygonize using 
> RODBC/postGIS, as we discussed in a previous thread.

Would nb2lines() in spdep help? It was written for a user wanting to write 
a shapefile of lines, so I guess that it either is what you are looking 
for, or close enough to serve as an example?

Roger

>
> Thanks in advance!
>
> Murray
>
> Roger Bivand wrote:
>>  On Wed, 12 Mar 2008, Agustin Lobo wrote:
>> 
>> >  and a combination of r.clump and r.stats
>> >  in grass (which is "linked" to R) can also do the job.
>>
>>  Yes, that will be very robust. I've tried an R attack through neighbour
>>  lists:
>>
>>  library(sp)
>>  data(meuse.grid)
>>  coordinates(meuse.grid) <- c("x", "y")
>>  gridded(meuse.grid) <- TRUE
>>  fullgrid(meuse.grid) <- TRUE
>>  class(meuse.grid)
>>  names(meuse.grid)
>>  meuse.grid$ffreq1 <- meuse.grid$ffreq == 1
>>  is.na(meuse.grid$ffreq1) <- !meuse.grid$ffreq1
>>  image(meuse.grid, "ffreq1")
>>  pix <- as(meuse.grid["ffreq1"], "SpatialPixelsDataFrame")
>>  summary(pix)
>>  image(pix)
>>  library(spdep)
>>  nb_rook <- dnearneigh(coordinates(pix), 0, 41)
>>  nb_queen <- dnearneigh(coordinates(pix), 0, 57)
>>  comp_rook <- n.comp.nb(nb_rook)
>>  comp_queen <- n.comp.nb(nb_queen)
>>  t_rook <- table(comp_rook$comp.id)
>>  t_queen <- table(comp_queen$comp.id)
>>  t_rook
>>  t_queen
>>  pix$rook <- comp_rook$comp.id
>>  pix$queen <- comp_queen$comp.id
>>  image(pix, "rook", col=rainbow(31))
>>  pix$nrook <- t_rook[pix$rook]
>>  pix$nqueen <- t_queen[pix$queen]
>>  summary(pix)
>>  image(pix, "nqueen")
>>  spplot(pix, "nqueen")
>>
>>  using cut-off distances for distance-based neighbours just larger than the
>>  resolution and the diagonal resolution. There were only 779 cells in
>>  patches here, but it ran so fast that scaling up shouldn't be a problem.
>>
>>  Roger
>> 
>> > 
>> >  Agus
>> > 
>> >  Andrew Niccolai escribi?:
>> > >  If you aren't dedicated to an R specific solution, ImageJ is open 
>> > >  source and
>> > >  does this under Analysis/Binary.
>> > > 
>> > >  -----Original Message-----
>> > >  From: r-sig-geo-bounces at stat.math.ethz.ch
>> > >  [mailto:r-sig-geo-bounces at stat.math.ethz.ch] On Behalf Of Murray 
>> > >  Richardson
>> > >  Sent: Wednesday, March 12, 2008 12:59 PM
>> > >  To: r-sig-geo at stat.math.ethz.ch
>> > >  Subject: [R-sig-Geo] enumerate grid clusters/patches with size of 
>> > >  contiguous
>> > >  cluster
>> > > 
>> > >  Hello friends,
>> > > 
>> > >  I am trying to take a binary input grid of patches (connected cells 
>> > >  with
>> > >  value = 1), and assign to each non-zero cell the total number of 
>> > >  pixels
>> > >  comprising the patch to which it belongs.
>> > > 
>> > >  So for a connected patch of 27 pixels, all cells belonging to that 
>> > >  patch
>> > >  will have a value of 27.
>> > > 
>> > >  Just wondering if anyone has any suggestions.  Maybe a function I 
>> > >  don't
>> > >  know about yet...
>> > > 
>> > >  Thanks in advance,
>> > > 
>> > >  Murray Richardson
>> > > 
>>>> _______________________________________________
>> > >  R-sig-Geo mailing list
>> > >  R-sig-Geo at stat.math.ethz.ch
>> > >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > > 
>>>> _______________________________________________
>> > >  R-sig-Geo mailing list
>> > >  R-sig-Geo at stat.math.ethz.ch
>> > >  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > > 
>> > 
>> > 
>> 
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From paulojus at c3sl.ufpr.br  Fri Mar 14 17:23:14 2008
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Fri, 14 Mar 2008 13:23:14 -0300 (BRT)
Subject: [R-sig-Geo] spatial regression with generalized least squares
In-Reply-To: <e12429640801311035s68e05849x70fa6aa9cbe0146d@mail.gmail.com>
References: <e12429640801311035s68e05849x70fa6aa9cbe0146d@mail.gmail.com>
Message-ID: <Pine.LNX.4.58.0803141216210.30797@caporal.c3sl.ufpr.br>

Dear G Allegri

I'v e being running through old email here and gound this message from
yours posted a while ago

well, you could for instance, model the covariance matrix using a
correlation function of the distances using nlme() with a
spatial covariance structed or likfit() in package geoR.
Both will estimate mean (regression) and covariance jointly
(instead of alternating between OLS and veriogram fits)


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

-------------------------------------------------------------------------
53a Reuniao Anual da Regiao Brasileira da Soc. Internacional de Biometria
14 a 16/05/2008, UFLA, Lavras,MG
http://www.rbras.org.br/rbras53
-------------------------------------------------------------------------


On Thu, 31 Jan 2008, G. Allegri wrote:

> I have a question about using GLS estimation within the Regression
> Kriging framework.
> In Rossiter and Hengl texts it is stated that it makes not so much
> difference, in many practical situations, using OLS rather then GLS.
> I'd like to test it in my work.
> What's the more feasible way to adobt it in R?
> The RK method suggests to use iteratively the regression coefficient
> estimates using the covariance matrix derived from the residual
> covariance modelling.
>
> 1 - How to automate this iteration scheme? I'm not so expert in R scripting...
> 2 - Could gls, from the nlme package, be used?
>
> Giovanni
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From pbokaj at gmail.com  Sat Mar 15 21:09:42 2008
From: pbokaj at gmail.com (Jakob Petersen)
Date: Sat, 15 Mar 2008 20:09:42 +0000
Subject: [R-sig-Geo]  writing shapefiles using write.pointShape
Message-ID: <fff63d280803151309s78fa570ag99e34e6b15dcc41@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080315/8c5a8dec/attachment.pl>

From modern82376 at mypacks.net  Sun Mar 16 04:42:36 2008
From: modern82376 at mypacks.net (modern82376 at mypacks.net)
Date: Sat, 15 Mar 2008 21:42:36 -0600 (GMT-06:00)
Subject: [R-sig-Geo]   writing shapefiles using write.pointShape
Message-ID: <6653971.1205638956340.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>

Thank you Jakob. I figured that if I couldn't get the write.pointShape function to work the way I wanted, I'd have to do something like that. I'll keep your code as a backup, since I'd like to automate some processes.
 
Cheers. 
 
Gericke Cook
USDA APHIS

---------------------------------------------------

More a work-around than a solution, but you could export the results
data.frame as a csv and then import as an xy in arcmap (then save as a shp).
The Columbus example...

## GWR example

library(spgwr)

data(columbus)

main <- columbus

main <- cbind(main, region=1:49)

main.lm <- lm(crime ~ income + housing, data=main)

summary(main.lm)

main.bw <- gwr.sel(crime ~ income + housing, data=main,

  coords=cbind(main$x, main$y))

main.gauss <- gwr(crime ~ income + housing, data=main,

  coords=cbind(main$x, main$y), bandwidth=main.bw, hatmatrix=TRUE)

main.gauss

main.gauss$SDF

main_res <- cbind(main, main.gauss$SDF)

main_res

write.table(main_res, file = "main_gwr.csv", sep = ",", col.names = NA)




Jakob Petersen

PhD candidate
Geography UCL



From Roger.Bivand at nhh.no  Sun Mar 16 11:31:35 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 16 Mar 2008 11:31:35 +0100 (CET)
Subject: [R-sig-Geo] writing shapefiles using write.pointShape
In-Reply-To: <8489940.1205442627177.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>
References: <8489940.1205442627177.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>
Message-ID: <Pine.LNX.4.64.0803161055000.2387@reclus.nhh.no>

On Thu, 13 Mar 2008, modern82376 at mypacks.net wrote:

> I've been running gwr on some survey data and trying to write output 
> back out to point shapefiles. At first, I thought that the shapefile 
> wasn't being written, but after calling the file object I found it in a 
> local settings/temp folder with a random shapefile name. I thought I had 
> specified all that, but I'm obviously not familiar enough with the 
> syntax to get it right. Would someone mind assisting me on this?  Code 
> follows..

See ?tempfile, you were not using it correctly. Whether you should use it 
at all is of course also a good question - see below.

>
>> library(spgwr)

>> surveypts <- readShapePoints("C:/temp/NE_survey.shp", proj4string = 
>> CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))

>> survey.bw <- gwr.sel(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, 
>> data=surveypts)

>> fitpts <- readShapePoints("C:/temp/fitpts.shp", proj4string = 
>> CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))

OK so far.

>> fitpix <- SpatialPixels(fitpts, proj4string = CRS("+proj=aea +lat_0=96w 
>> +lat_1=29.5n +lat_2=45.5n"))

Why this step? It is unnecessary, just use fit.points=fitpts if the output 
Spatial*DataFrame is to be exported as a shapefile. If, on the other hand, 
you want to export it as a raster file, then don't try to write it as a 
shapefile.

>> surv.local <- ggwr(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data = 
>> surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, adapt = NULL, 
>> fit.points = fitpix, longlat = FALSE)


>> surv.local
>
> Call:
> ggwr(formula = GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5,
>    data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss,
>    adapt = NULL, fit.points = fitpix, longlat = FALSE)
> Kernel function: gwr.Gauss
> Fixed bandwidth: 22738.78
> Summary of GWR coefficient estimates:
>                   Min.    1st Qu.     Median    3rd Qu.       Max.   Global
> X.Intercept. -4.176e+03 -9.067e+01 -3.565e+00  8.029e+01  4.402e+03 -73.5570
> pca1         -2.567e+00 -2.289e-02 -1.725e-03  1.674e-02  3.135e-01  -0.0077
> PCA2         -7.874e+01 -6.543e-01 -1.934e-01  2.298e-01  2.016e+01  -0.2667
> PCA3         -8.844e+01 -1.236e+00 -1.109e-01  6.008e-01  1.469e+02   0.0202
> PCA4         -1.272e+01 -3.509e-01  3.005e-01  1.178e+00  3.386e+02   0.8161
> PCA5         -1.368e+02 -1.134e+00 -8.233e-03  9.222e-01  4.384e+01   0.6937
>
>> names(surv.local$SDF)
>
> [1] "sum.w"           "X.Intercept."    "pca1"            "PCA2"            "PCA3"
> [6] "PCA4"            "PCA5"            "dispersion"      "response_resids"
>

If fit.points=fitpts, surv.local$SDF would be a SpatialPointsDataFrame, so 
then just say

fn <- "whatever"
writePointsShape(surv.local$SDF, fn)

and you are done. If you only want pca1, then

writePointsShape(surv.local$SDF[, "pca1"], fn)

will write just that column. If you wanted a raster, fit.points=fitpix, 
and for example:

SGDF <- as(surv.local$SDF["pca1"], "SpatialGridDataFrame")
writeAsciiGrid(SGDF, fn)

will give you an Arc ASCII grid.

>> coords <- coordinates(fitpts)
>> pca1 <- cbind(coords, surv.local$SDF$pca1)
>> summary(pca1)
>   coords.x1         coords.x2            V3
> Min.   :-670120   Min.   :287533   Min.   :-2.566983
> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891
> Median :-417620   Median :464533   Median :-0.001725
> Mean   :-417620   Mean   :464533   Mean   :-0.047442
> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741
> Max.   :-165120   Max.   :641533   Max.   : 0.313544
>
>> class(pca1)
> [1] "matrix"
>> dim(pca1)
> [1] 179630      3
>> all(dim(dpca1 <- as.data.frame(pca1)) == c(179630,3))
> [1] TRUE
>> summary(dpca1)
>   coords.x1         coords.x2            V3
> Min.   :-670120   Min.   :287533   Min.   :-2.566983
> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891
> Median :-417620   Median :464533   Median :-0.001725
> Mean   :-417620   Mean   :464533   Mean   :-0.047442
> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741
> Max.   :-165120   Max.   :641533   Max.   : 0.313544
>> class(dpca1)
> [1] "data.frame"
>
>> B1pca1 <- tempfile("C:\temp")
>> write.pointShape(coords, df=dpca1, B1pca1, factor2char=TRUE)
> (Where's the shapefile??)
>
>> B1pca1
> [1] "C:\\DOCUME~1\\gcook\\LOCALS~1\\Temp\\Rtmpijon4d\\C:\temp1eb26e9"
>

You are getting exactly what you asked for - tempfile() is prepending 
"C:\temp" to the random suffix, and putting it into R's temporary 
directory as you requested.

>
> After calling B1pca1, I find a randomly named shapefile (with .dbf and 
> .shx)extensions in the .../Local Settings/Temp/ folder. I'm trying to 
> name the file "B1pca1.shp" and I want it to go in the C:/Temp folder 
> (for now). I've tried a few permutations of the last two commands, but 
> I'm just not getting it right.

So say:

fn <- "C:/Temp/B1pca1"

and do not use tempfile(). For obvious reasons, the examples in the help 
pages use tempfile() to avoid messing up users' own work.

Roger

>
> Thanks so much :)
>
> Gericke
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Mar 16 11:42:17 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 16 Mar 2008 11:42:17 +0100 (CET)
Subject: [R-sig-Geo] writing shapefiles using write.pointShape
In-Reply-To: <3879560.1205446093396.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>
References: <3879560.1205446093396.JavaMail.root@elwamui-chisos.atl.sa.earthlink.net>
Message-ID: <Pine.LNX.4.64.0803161131510.2387@reclus.nhh.no>

On Thu, 13 Mar 2008, modern82376 at mypacks.net wrote:

> I'm also having issues with getting the gw.cov function to work for fit 
> points. Here's an example, using the same files...
>
>> pcavars <- names(surveypts[,4:8])
>> pcavars
> [1] "pca1" "PCA2" "PCA3" "PCA4" "PCA5"
>> surv.cov <- gw.cov(data = surveypts, vars = pcavars, fit.points = fitpix, bw = survey.bw)
> Error in gw.cov(surveypts, test, fit.points = fitpix, bw = survey.bw) :
>  unused argument(s) (fit.points = <S4 object of class "SpatialPixels">)
>
> As far as I can tell, I'm using the same syntax as in the ggwr function. 
> Thanks again. =)

?gw.cov will help. The first argument is x= not data=, and fit.points= 
should be fp=. So

surv.cov <- gw.cov(x=surveypts, vars=pcavars, fp=fitpix, bw=survey.bw)

ought to work. The functions are fairly different (no formula=), so 
assuming that the arguments have the same names suggests that actually 
reading the help pages might save time.

Please note that spgwr is only a proof of concept package and does not 
imply any affirmation of approaches using geographical weights. The 
approach may be helpful, but following Wheeler and Tiefelsdorf (2005), 
caution is recommended. Your use of PCAs may help alleviate the induced 
collinearity in GWR regression coefficients, but please always plot 
pairs() of the local coefficients!

Roger



>
> Gericke Cook
> USDA APHIS
>
>
> -----Original Message-----
>> From: modern82376 at mypacks.net
>> Sent: Mar 13, 2008 5:10 PM
>> To: r-sig-geo at stat.math.ethz.ch
>> Subject: [R-sig-Geo] writing shapefiles using write.pointShape
>>
>> I've been running gwr on some survey data and trying to write output back out to point shapefiles. At first, I thought that the shapefile wasn't being written, but after calling the file object I found it in a local settings/temp folder with a random shapefile name. I thought I had specified all that, but I'm obviously not familiar enough with the syntax to get it right. Would someone mind assisting me on this?  Code follows..
>>
>>> library(spgwr)
>>> surveypts <- readShapePoints("C:/temp/NE_survey.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>>> survey.bw <- gwr.sel(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data=surveypts)
>>> fitpts <- readShapePoints("C:/temp/fitpts.shp", proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>>> fitpix <- SpatialPixels(fitpts, proj4string = CRS("+proj=aea +lat_0=96w +lat_1=29.5n +lat_2=45.5n"))
>>> surv.local <- ggwr(GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5, data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss, adapt = NULL, fit.points = fitpix, longlat = FALSE)
>>> surv.local
>>
>> Call:
>> ggwr(formula = GHDENSITY ~ pca1 + PCA2 + PCA3 + PCA4 + PCA5,
>>    data = surveypts, bandwidth = survey.bw, gweight = gwr.Gauss,
>>    adapt = NULL, fit.points = fitpix, longlat = FALSE)
>> Kernel function: gwr.Gauss
>> Fixed bandwidth: 22738.78
>> Summary of GWR coefficient estimates:
>>                   Min.    1st Qu.     Median    3rd Qu.       Max.   Global
>> X.Intercept. -4.176e+03 -9.067e+01 -3.565e+00  8.029e+01  4.402e+03 -73.5570
>> pca1         -2.567e+00 -2.289e-02 -1.725e-03  1.674e-02  3.135e-01  -0.0077
>> PCA2         -7.874e+01 -6.543e-01 -1.934e-01  2.298e-01  2.016e+01  -0.2667
>> PCA3         -8.844e+01 -1.236e+00 -1.109e-01  6.008e-01  1.469e+02   0.0202
>> PCA4         -1.272e+01 -3.509e-01  3.005e-01  1.178e+00  3.386e+02   0.8161
>> PCA5         -1.368e+02 -1.134e+00 -8.233e-03  9.222e-01  4.384e+01   0.6937
>>
>>> names(surv.local$SDF)
>>
>> [1] "sum.w"           "X.Intercept."    "pca1"            "PCA2"            "PCA3"
>> [6] "PCA4"            "PCA5"            "dispersion"      "response_resids"
>>
>>> coords <- coordinates(fitpts)
>>> pca1 <- cbind(coords, surv.local$SDF$pca1)
>>> summary(pca1)
>>   coords.x1         coords.x2            V3
>> Min.   :-670120   Min.   :287533   Min.   :-2.566983
>> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891
>> Median :-417620   Median :464533   Median :-0.001725
>> Mean   :-417620   Mean   :464533   Mean   :-0.047442
>> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741
>> Max.   :-165120   Max.   :641533   Max.   : 0.313544
>>
>>> class(pca1)
>> [1] "matrix"
>>> dim(pca1)
>> [1] 179630      3
>>> all(dim(dpca1 <- as.data.frame(pca1)) == c(179630,3))
>> [1] TRUE
>>> summary(dpca1)
>>   coords.x1         coords.x2            V3
>> Min.   :-670120   Min.   :287533   Min.   :-2.566983
>> 1st Qu.:-544120   1st Qu.:375533   1st Qu.:-0.022891
>> Median :-417620   Median :464533   Median :-0.001725
>> Mean   :-417620   Mean   :464533   Mean   :-0.047442
>> 3rd Qu.:-291120   3rd Qu.:553533   3rd Qu.: 0.016741
>> Max.   :-165120   Max.   :641533   Max.   : 0.313544
>>> class(dpca1)
>> [1] "data.frame"
>>
>>> B1pca1 <- tempfile("C:\temp")
>>> write.pointShape(coords, df=dpca1, B1pca1, factor2char=TRUE)
>> (Where's the shapefile??)
>>
>>> B1pca1
>> [1] "C:\\DOCUME~1\\gcook\\LOCALS~1\\Temp\\Rtmpijon4d\\C:\temp1eb26e9"
>>
>>
>> After calling B1pca1, I find a randomly named shapefile (with .dbf and .shx)extensions in the .../Local Settings/Temp/ folder. I'm trying to name the file "B1pca1.shp" and I want it to go in the C:/Temp folder (for now). I've tried a few permutations of the last two commands, but I'm just not getting it right.
>>
>> Thanks so much :)
>>
>> Gericke
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sun Mar 16 12:36:54 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 16 Mar 2008 12:36:54 +0100 (CET)
Subject: [R-sig-Geo] gdal error 1 (execution halted)
In-Reply-To: <A0C7AADAEF32A64696B51EC0F31A90E303E3CF0A@EX4.d.ethz.ch>
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
	<A0C7AADAEF32A64696B51EC0F31A90E303E3CF0A@EX4.d.ethz.ch>
Message-ID: <Pine.LNX.4.64.0803161151430.2387@reclus.nhh.no>

On Fri, 14 Mar 2008, Lienert  Christophe wrote:

> Dear All, Parts of the he following email have been already posted on 
> the R-devel list, but is supplemented with the code that may cause the 
> error discussed below and put on the R-sig-geo list at the suggestion of 
> Mr. Bivand.
>
> I am using R 2.6.2 on my Redhat AS4. I installed the RPM offered on the 
> cran website. I would like to use R from my bash console with the 
> following command:
>
> /path/to/R --vanilla --slave --args < /data/myscript.R
>
> this script invokes a range of functions and tools, among others to 
> process a bunch of raster images in a loop using GDAL. The thing is that 
> releasing this command in the bash results in the following error:

The possibilities are almost endless. Without having any idea of the 
classes of the arguments to your function, it is hard to know why the 
object passed to writeGDAL() may be corrupt.

Only write a script when you have a good practical understanding of all 
the steps you are taking. Your script indicates that this is not the case. 
You have not even explained that what you seem to be trying to do is to 
take a SpatialGridDataFrame with one column, and to convert it into a 
four-column SpatialGridDataFrame with red, green, blue, and alpha columns, 
based on a classification of the input variable given in a numeric vector 
breaks.


>
> ERROR:
> *************************************
>
> Error in GDAL.close(tds.out) :
>        GDAL Error 1: TIFFReadDirectory:/tmp/RtmpBgrSyt/file2ef6a5b2: 
> cannot handle zero scanline size
> Calls: plot.georef -> GDAL.close -> .Call
> Execution halted
>
>
>
> CODE:
> *************************************
>
>
> plot.georef=function(grid.sp,graph.file,col.palette,breaks){

grid.sp is what? A SpatialGridDataFrame?
graph.file is what? A file name - single element character vector?
col.palette is what? A character vector?
breaks is what? A numeric vector?

>
>  require("sp")
>  require("rgdal")
>
>  # get desired picture type
>  base.name=strsplit(graph.file,"/")[[1]]
       [length(strsplit(graph.file,"/")[[1]])]

Do you know that base.name is what you think it is? Did you consider using 
the basename() function?

>  ft=0
>  ft=sum(c(ft,grep(".tiff",base.name)))

See ?grep - "." means something.

>  if (ft==1){ file.typ="TIFF" }
>  ft=0
>  ft=sum(c(ft,grep(".jpg",base.name)))
>  if (ft==1){ file.typ="JPG" }
>  ft=0
>  ft=sum(c(ft,grep(".png",base.name)))
>  if (ft==1){ file.typ="PNG" }
>
>  # create RGB bands
>  names(grid.sp)=c("band1","band2")

How many columns did grid.sp have when it came into the function, do you 
know that there were two? If not, this will not create them.

>  grid.sp$band3=grid.sp$band2
>  grid.sp$band4=grid.sp$band2

If band2 wasn't created above, this won't create band3 or band4.

>
>  col.class=as.vector(cut(grid.sp$band1,br = breaks, labels=col.palette))

Curious use of cut:

col.class <- col.palette[findInterval(grid.sp$band1, vec=breaks,
     all.inside=TRUE)]

seems more natural, and avoids creating a factor (which is what cut() is 
for).

>  col.class[is.na(col.class)]="#FFFFFF"

Do you know how many are NAs?

>  col.class.rgb=col2rgb(col.class)

Assuming that you have full control of col.class, this should work.

>
>  grid.sp$band1=col.class.rgb["red",]

Here you are overwriting the input object - do you need to? Wouldn't it be 
cleaner to start a fresh object?

>  grid.sp$band2=col.class.rgb["green",]
>  grid.sp$band3=col.class.rgb["blue",]
>  grid.sp$band4[]=256
>

Should the alpha band run 0-255 or 1-256? col2rgb() uses 0-255 (and can 
also add an alpha column).

>  if (file.typ=="TIFF"){
>
>    #writeGDAL(grid.sp, graph.file,drivername = "GTiff",
         type = "band",options="ALPHA=YES")

The two versions are equivalent. Most likely, the cause of your problems 
is type = "band", which is not a valid type, being passed to underlying 
GDAL functions as "Unknown". My guess would be that you mean "Byte".

The full list of GDAL data types is on www.gdal.org (down now for me, so 
no specific link), and from the R prompt as:

rgdal:::.GDALDataTypes

Finally, wouldn't it be easier to use the vec2RGB() function in rgdal, see 
the example using the meuse.grid data set at the foot of the example on 
the help page?

Hope this helps,

Roger


>    tds.out <- create2GDAL(dataset=grid.sp,drivername="GTiff",type="band")
>    saveDataset(tds.out,graph.file)
>    GDAL.close(tds.out)
>  }
> }
>
>
>
>
> The error is most likely in the if control. Both variants (the with only the commented line and the one with only the three following lines) produce the error.
> Thanks for any help!
>
> Ciao,
>
> Chris
>
> _______________________________________________
> Christophe Lienert
> ETH Zurich
> Institute of Cartography
> Wolfgang-Pauli-Str. 15
> HIL G 13.3
> CH-8093 Zurich
> SWITZERLAND
>
> Fon: +41-44-6333036
> Fax: +41-44-6331153
> www.karto.ethz.ch
> lienert at karto.baug.ethz.ch
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From saimon at student.ethz.ch  Mon Mar 17 00:15:26 2008
From: saimon at student.ethz.ch (sj)
Date: Mon, 17 Mar 2008 00:15:26 +0100
Subject: [R-sig-Geo] gdal error 1 (execution halted)
In-Reply-To: <A0C7AADAEF32A64696B51EC0F31A90E303E3CF14@EX4.d.ethz.ch>
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
	<A0C7AADAEF32A64696B51EC0F31A90E303E3CF0A@EX4.d.ethz.ch>
	<Pine.LNX.4.64.0803161151430.2387@reclus.nhh.no>
	<A0C7AADAEF32A64696B51EC0F31A90E303E3CF14@EX4.d.ethz.ch>
Message-ID: <F4D4E10D-B0AF-486A-AC1F-521642C30755@student.ethz.ch>

Dear Roger

Thanks for your detailed reply.

>> I would like to use R from my bash console with the following  
>> command:
>>
>> /path/to/R --vanilla --slave --args < /data/myscript.R
>>
>> this script invokes a range of functions and tools, among others to
>> process a bunch of raster images in a loop using GDAL. The thing  
>> is that
>> releasing this command in the bash results in the following error:
>
> The possibilities are almost endless. Without having any idea of the
> classes of the arguments to your function, it is hard to know why the
> object passed to writeGDAL() may be corrupt.
>
> Only write a script when you have a good practical understanding of  
> all
> the steps you are taking. Your script indicates that this is not  
> the case.
> You have not even explained that what you seem to be trying to do  
> is to
> take a SpatialGridDataFrame with one column, and to convert it into a
> four-column SpatialGridDataFrame with red, green, blue, and alpha  
> columns,
> based on a classification of the input variable given in a numeric  
> vector
> breaks.

Yes, the description of what the script intends to do is missing.  
Sorry, my fault. Your description of the script is correct. And yes,  
it was the first time I did anything with GDAL.

>> ERROR:
>> *************************************
>>
>> Error in GDAL.close(tds.out) :
>>       GDAL Error 1: TIFFReadDirectory:/tmp/RtmpBgrSyt/file2ef6a5b2:
>> cannot handle zero scanline size
>> Calls: plot.georef -> GDAL.close -> .Call
>> Execution halted

The weird thing is, that the script works as expected if called  
interactively from the R console. It gives the same error, but the  
resulting TIFF images are ok. The execution is only halted if R is  
called from the command line (with the script name as argument).

>> CODE:
>> *************************************
>>
>> plot.georef=function(grid.sp,graph.file,col.palette,breaks){
>
> grid.sp is what? A SpatialGridDataFrame?

Yes, this SpatialGridDataFrame results from an interpolated  
temperature field. writeAsciiGrid(grid.sp,asc.file) results in the  
expected text file with a correct georef.

 > str(grid.sp)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
   ..@ data       :'data.frame': 84000 obs. of  2 variables:
   .. ..$ temperature_mean.pred: num [1:84000] 5.4 5.4 5.4 5.4 5.5  
5.5 5.5 5.5 5.5 5.5 ...
   .. ..$ temperature_mean.var : num [1:84000] NA NA NA NA NA NA NA  
NA NA NA ...
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
slots
   .. .. ..@ cellcentre.offset: Named num [1:2] 655050 278050
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   .. .. ..@ cellsize         : Named num [1:2] 100 100
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   .. .. ..@ cells.dim        : Named int [1:2] 350 240
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   ..@ grid.index : int(0)
   ..@ coords     : num [1:2, 1:2] 655050 689950 278050 301950
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "x_coord" "y_coord"
   ..@ bbox       : num [1:2, 1:2] 655000 278000 690000 302000
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "x_coord" "y_coord"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr "+init=world:CH1903"

> graph.file is what? A file name - single element character vector?

 > str(graph.file)
  chr "/data/graph_output/temp_205_100m_2008031117.tiff"

> col.palette is what? A character vector?

 > str(col.palette)
  chr [1:26] "#97FF02" "#5BFA05" "#00C632" "#17D9ED" "#28CCEE" ...

> breaks is what? A numeric vector?

 > str(breaks)
  num [1:27] -100 -18 -16 -14 -12 -10 -8 -6 -4 -2 ...

>> # get desired picture type
>> base.name=strsplit(graph.file,"/")[[1]][length(strsplit 
>> (graph.file,"/")[[1]])]
>
> Do you know that base.name is what you think it is? Did you  
> consider using
> the basename() function?

Yes, basename() should be used. The above is a relict from an old  
script, and does the same as basename().

>> ft=0
>> ft=sum(c(ft,grep(".tiff",base.name)))
>
> See ?grep - "." means something.
>
>> if (ft==1){ file.typ="TIFF" }
>> ft=0
>> ft=sum(c(ft,grep(".jpg",base.name)))
>> if (ft==1){ file.typ="JPG" }
>> ft=0
>> ft=sum(c(ft,grep(".png",base.name)))
>> if (ft==1){ file.typ="PNG" }

This part of the script actually works without problems. I know that  
the determination of the file type from the given file name is not  
done in a very elaborate way. Any suggestions?

>> # create RGB bands
>> names(grid.sp)=c("band1","band2")
>
> How many columns did grid.sp have when it came into the function,  
> do you
> know that there were two? If not, this will not create them.

Yes, it always has two.

>> grid.sp$band3=grid.sp$band2
>> grid.sp$band4=grid.sp$band2
>
> If band2 wasn't created above, this won't create band3 or band4.

Yes, but as band2 is always present, this is not an issue.

>> col.class=as.vector(cut(grid.sp$band1,br = breaks,  
>> labels=col.palette))
>
> Curious use of cut:
>
> col.class <- col.palette[findInterval(grid.sp$band1, vec=breaks,
>     all.inside=TRUE)]
>
> seems more natural, and avoids creating a factor (which is what cut 
> () is
> for).

I'll keep this in mind. But doesn't findInterval() need sorted input?  
For this specific problem I would now use vec2RGB as suggested below.

>> col.class[is.na(col.class)]="#FFFFFF"
>
> Do you know how many are NAs?

No, this differs for the individual cases.

>> col.class.rgb=col2rgb(col.class)
>
> Assuming that you have full control of col.class, this should work.

It does:

 > str(col.class.rgb)
  int [1:3, 1:84000] 214 226 238 214 226 238 214 226 238 214 ...
  - attr(*, "dimnames")=List of 2
   ..$ : chr [1:3] "red" "green" "blue"
   ..$ : NULL

>> grid.sp$band1=col.class.rgb["red",]
>
> Here you are overwriting the input object - do you need to?  
> Wouldn't it be
> cleaner to start a fresh object?

As I do not need the data from the input object any more, I tried to  
save memory by reusing this object (as these can become fairly  
large). Could this be done better in a different way?

>> grid.sp$band2=col.class.rgb["green",]
>> grid.sp$band3=col.class.rgb["blue",]
>> grid.sp$band4[]=256
>
> Should the alpha band run 0-255 or 1-256? col2rgb() uses 0-255 (and  
> can
> also add an alpha column).

I actually determined 256 by trial and error (the alpha channel  
option from col2rgb() gives 255). With 256, writeGDAL() produced an  
image with a transparent alpha channel. Assumed that the higher  
number represents complete transparency.

The script results in the following SpatialGridDataFrame:

 > str(grid.sp)
Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
   ..@ data       :'data.frame': 84000 obs. of  4 variables:
   .. ..$ band1: int [1:84000] 214 214 214 214 214 214 214 214 214  
214 ...
   .. ..$ band2: int [1:84000] 226 226 226 226 226 226 226 226 226  
226 ...
   .. ..$ band3: int [1:84000] 238 238 238 238 238 238 238 238 238  
238 ...
   .. ..$ band4: num [1:84000] 256 256 256 256 256 256 256 256 256  
256 ...
   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3  
slots
   .. .. ..@ cellcentre.offset: Named num [1:2] 655050 278050
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   .. .. ..@ cellsize         : Named num [1:2] 100 100
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   .. .. ..@ cells.dim        : Named int [1:2] 350 240
   .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
   ..@ grid.index : int(0)
   ..@ coords     : num [1:2, 1:2] 655050 689950 278050 301950
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : NULL
   .. .. ..$ : chr [1:2] "x_coord" "y_coord"
   ..@ bbox       : num [1:2, 1:2] 655000 278000 690000 302000
   .. ..- attr(*, "dimnames")=List of 2
   .. .. ..$ : chr [1:2] "x_coord" "y_coord"
   .. .. ..$ : chr [1:2] "min" "max"
   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
   .. .. ..@ projargs: chr "+init=world:CH1903"


>>   #writeGDAL(grid.sp, graph.file,drivername = "GTiff",type =  
>> "band",options="ALPHA=YES")
>
> The two versions are equivalent.

I know. I first suspected the error in writeGDAL() and therefore  
tried to achieve the same result by directly using the "underlying"  
function.

> Most likely, the cause of your problems
> is type = "band", which is not a valid type, being passed to  
> underlying
> GDAL functions as "Unknown". My guess would be that you mean "Byte".
>
> The full list of GDAL data types is on www.gdal.org (down now for  
> me, so
> no specific link), and from the R prompt as:
>
> rgdal:::.GDALDataTypes

That's the one! When I checked out writeGDAL I obviously  
misinterpreted the type option. As it worked from the command line, I  
did not suspect this option to be wrong.

> Finally, wouldn't it be easier to use the vec2RGB() function in  
> rgdal, see
> the example using the meuse.grid data set at the foot of the  
> example on
> the help page?

Yes, could be used instead of the "misused" cut (gives the same  
result). Another reinvention from my side ...

Thanks a lot for your help and time.

Best regards,
Simon



From modern82376 at mypacks.net  Mon Mar 17 03:41:53 2008
From: modern82376 at mypacks.net (modern82376 at mypacks.net)
Date: Sun, 16 Mar 2008 20:41:53 -0600 (GMT-06:00)
Subject: [R-sig-Geo] writing shapefiles using write.pointShape
Message-ID: <6947474.1205721713404.JavaMail.root@elwamui-rubis.atl.sa.earthlink.net>

-----Original Message-----
>From: Roger Bivand <Roger.Bivand at nhh.no>
>Sent: Mar 16, 2008 4:42 AM
>To: modern82376 at mypacks.net
>Cc: r-sig-geo at stat.math.ethz.ch
>Subject: Re: [R-sig-Geo] writing shapefiles using write.pointShape
>
>On Thu, 13 Mar 2008, modern82376 at mypacks.net wrote:
>
>> I'm also having issues with getting the gw.cov function to work for fit 
>> points. Here's an example, using the same files...
>>
>>> pcavars <- names(surveypts[,4:8])
>>> pcavars
>> [1] "pca1" "PCA2" "PCA3" "PCA4" "PCA5"
>>> surv.cov <- gw.cov(data = surveypts, vars = pcavars, fit.points = fitpix, bw = survey.bw)
>> Error in gw.cov(surveypts, test, fit.points = fitpix, bw = survey.bw) :
>>  unused argument(s) (fit.points = <S4 object of class "SpatialPixels">)
>>
>> As far as I can tell, I'm using the same syntax as in the ggwr function. 
>> Thanks again. =)
>
>?gw.cov will help. The first argument is x= not data=, and fit.points= 
>should be fp=. So
>
>surv.cov <- gw.cov(x=surveypts, vars=pcavars, fp=fitpix, bw=survey.bw)
>
>ought to work. The functions are fairly different (no formula=), so 
>assuming that the arguments have the same names suggests that actually 
>reading the help pages might save time.


Yep, tunnel vision as I said before. I actually do read those help pages, believe it or not. Many times. Finding the difference between calling fp= and fit.points= for the same file is actually easy to overlook. 


>
>Please note that spgwr is only a proof of concept package and does not 
>imply any affirmation of approaches using geographical weights. The 
>approach may be helpful, but following Wheeler and Tiefelsdorf (2005), 
>caution is recommended. Your use of PCAs may help alleviate the induced 
>collinearity in GWR regression coefficients, but please always plot 
>pairs() of the local coefficients!


Thanks Roger, I'll do that. I'm actually evaluating several modelling approaches for large geographic prediction surfaces, and non-stationarity appears to be a very large issue (among others). I wanted to see how gwr compared to some of the other methodologies, and it appeared R was the only way I could evaluate it without having to buy a license. So, yes. You have a newbie in R on board.



From pinaud at cebc.cnrs.fr  Mon Mar 17 10:10:13 2008
From: pinaud at cebc.cnrs.fr (David PINAUD)
Date: Mon, 17 Mar 2008 10:10:13 +0100
Subject: [R-sig-Geo] rgdal installation
Message-ID: <47DE3575.40608@cebc.cnrs.fr>

Dear all,

I'm trying to import HDF (v4) files on R2.6.2  using the package rgdal 
and FWTools v2.1.0. I have the following message :

 > GDALinfo("T20060012006008.L3m_8D_SST_9.hdf")
Erreur dans .local(.Object, ...) :
        GDAL Error 4: `T20060012006008.L3m_8D_SST_9.hdf' not recognised 
as a supported file format.

I can load this file with FWTools without problem.
I suppose that rgdal is not able to recognize the path to the 
FWTools/bin directory:
 > library(rgdal)
Le chargement a n?cessit? le package : sp
Geospatial Data Abstraction Library extensions to R successfully loaded
Loaded GDAL runtime: GDAL 1.5.0, released 2007/12/18
GDAL_DATA: C:/PROGRA~1/R/R-26~1.2/library/rgdal/gdal  ####### it should 
be FWTools/bin ??  #####
Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
PROJ_LIB: C:/PROGRA~1/R/R-26~1.2/library/rgdal/proj

However I set before the PATH environment variable in Windows 
(Start>Parameters>Configuration Panel>System>Advanced>Environment 
variables : GDAL_DATA set to C:\Program Files\FWTools2.1.0\bin) as 
explained in http://rgdal.sourceforge.net/. No effect.

What's wrong ? Is there a thing that I've missed or didn't do correctly? 
Is there another way to set this directory?

Thank you for your help^.

David

-- 
***************************************************
David PINAUD
Ing?nieur de Recherche "Analyses spatiales"

Centre d'Etudes Biologiques de Chiz? - CNRS UPR1934
79360 Villiers-en-Bois, France 
poste 485
Tel: +33 (0)5.49.09.35.58
Fax: +33 (0)5.49.09.65.26
http://www.cebc.cnrs.fr/

***************************************************




________ Information from NOD32 ________
This message was checked by NOD32 Antivirus System for Linux Mail Servers.
http://www.eset.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: pinaud.vcf
Type: text/x-vcard
Size: 324 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080317/e7a01999/attachment.vcf>

From mdsumner at utas.edu.au  Mon Mar 17 10:37:27 2008
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Mon, 17 Mar 2008 20:37:27 +1100
Subject: [R-sig-Geo] rgdal installation
In-Reply-To: <47DE3575.40608@cebc.cnrs.fr>
References: <47DE3575.40608@cebc.cnrs.fr>
Message-ID: <47DE3BD7.7020100@utas.edu.au>

Hello, to find which drivers are available to you in rgdal use 
gdalDrivers(). These won't be as many as are available in FWTools, 
unless you build rgdal from source against FWTools itself.  For HDF you 
must build rgdal against your own GDAL installation.

I've done this with VC++ - see the notes in rgdal/README.windows - it's 
fairly painful, and I haven't done it for several rgdal releases.
Far easier is to build GDAL and rgdal from source with msys, and I have 
detailed instructions provided by Roger Bivand that I could find.

But perhaps even simpler is to use gdal_translate  -  calls to this via 
system can be conveniently wrapped into a simple function to handle the 
georeferencing as well (which HDF rarely provides fully).  It is simply 
not possible to build a single rgdal to handle both HDF and netCDF, and 
so I have resorted to this method for such formats, rather than maintain 
2 separate rgdal builds.

I gather that your files are MODIS Terra SST, and so you still need to 
wrap the calls for reading since the georeferencing will not be 
available automatically, so I suggest that having access from rgdal will 
only give you slight benefit anyway.

Finally, if the files are composed of subdatasets (SDS) you would need 
to refer to that directly, rather than the file name.

This will tell you about the SDS:

gdalinfo T20060012006008.L3m_8D_NSST_9.hdf

This will give you access to the first SDS:

gdalinfo HDF4_SDS:UNKNOWN:"T20050172005024.L3m_8D_NSST_9.hdf":0

HTH

Cheers, Mike.


David PINAUD wrote:
> Dear all,
>
> I'm trying to import HDF (v4) files on R2.6.2  using the package rgdal 
> and FWTools v2.1.0. I have the following message :
>
> > GDALinfo("T20060012006008.L3m_8D_SST_9.hdf")
> Erreur dans .local(.Object, ...) :
>        GDAL Error 4: `T20060012006008.L3m_8D_SST_9.hdf' not recognised 
> as a supported file format.
>
> I can load this file with FWTools without problem.
> I suppose that rgdal is not able to recognize the path to the 
> FWTools/bin directory:
> > library(rgdal)
> Le chargement a n?cessit? le package : sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.5.0, released 2007/12/18
> GDAL_DATA: C:/PROGRA~1/R/R-26~1.2/library/rgdal/gdal  ####### it 
> should be FWTools/bin ??  #####
> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> PROJ_LIB: C:/PROGRA~1/R/R-26~1.2/library/rgdal/proj
>
> However I set before the PATH environment variable in Windows 
> (Start>Parameters>Configuration Panel>System>Advanced>Environment 
> variables : GDAL_DATA set to C:\Program Files\FWTools2.1.0\bin) as 
> explained in http://rgdal.sourceforge.net/. No effect.
>
> What's wrong ? Is there a thing that I've missed or didn't do 
> correctly? Is there another way to set this directory?
>
> Thank you for your help^.
>
> David
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   
> ------------------------------------------------------------------------
>
> No virus found in this incoming message.
> Checked by AVG. 
> Version: 7.5.519 / Virus Database: 269.21.7/1331 - Release Date: 2008-03-16 10:34
>



From Roger.Bivand at nhh.no  Mon Mar 17 11:01:07 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Mar 2008 11:01:07 +0100 (CET)
Subject: [R-sig-Geo] gdal error 1 (execution halted)
In-Reply-To: <F4D4E10D-B0AF-486A-AC1F-521642C30755@student.ethz.ch>
References: <A0C7AADAEF32A64696B51EC0F31A90E303E3CEF0@EX4.d.ethz.ch>
	<A0C7AADAEF32A64696B51EC0F31A90E303E3CF0A@EX4.d.ethz.ch>
	<Pine.LNX.4.64.0803161151430.2387@reclus.nhh.no>
	<A0C7AADAEF32A64696B51EC0F31A90E303E3CF14@EX4.d.ethz.ch>
	<F4D4E10D-B0AF-486A-AC1F-521642C30755@student.ethz.ch>
Message-ID: <Pine.LNX.4.64.0803171042410.7806@reclus.nhh.no>

Dear Simon,

On Mon, 17 Mar 2008, sj wrote:

> Dear Roger
>
> Thanks for your detailed reply.
>
>> > I would like to use R from my bash console with the following command:
>> > 
>> > /path/to/R --vanilla --slave --args < /data/myscript.R
>> > 
>> > this script invokes a range of functions and tools, among others to
>> > process a bunch of raster images in a loop using GDAL. The thing is that
>> > releasing this command in the bash results in the following error:
>> 
>> The possibilities are almost endless. Without having any idea of the
>> classes of the arguments to your function, it is hard to know why the
>> object passed to writeGDAL() may be corrupt.
>> 
>> Only write a script when you have a good practical understanding of all
>> the steps you are taking. Your script indicates that this is not the case.
>> You have not even explained that what you seem to be trying to do is to
>> take a SpatialGridDataFrame with one column, and to convert it into a
>> four-column SpatialGridDataFrame with red, green, blue, and alpha columns,
>> based on a classification of the input variable given in a numeric vector
>> breaks.
>
> Yes, the description of what the script intends to do is missing. Sorry, my 
> fault. Your description of the script is correct. And yes, it was the first 
> time I did anything with GDAL.
>
>> > ERROR:
>> > *************************************
>> > 
>> > Error in GDAL.close(tds.out) :
>> >       GDAL Error 1: TIFFReadDirectory:/tmp/RtmpBgrSyt/file2ef6a5b2:
>> > cannot handle zero scanline size
>> > Calls: plot.georef -> GDAL.close -> .Call
>> > Execution halted
>
> The weird thing is, that the script works as expected if called interactively 
> from the R console. It gives the same error, but the resulting TIFF images 
> are ok. The execution is only halted if R is called from the command line 
> (with the script name as argument).

Scripted R fails by design on error. Interactive R also fails, but hands 
control back to the prompt, instead of terminating R, because the 
interactive user is expected to sort the error out.

The reason the output seemed to be OK is that the default "Unknown" type 
happened to make a 4-band RGBA file - by the way, we don't know whether 
this was at the stage of creating the GDAL dataset, or saving it, because 
the file gets written twice, once to a temporary location, next to its 
destination.

>
>> > CODE:
>> > *************************************
>> > 
>> > plot.georef=function(grid.sp,graph.file,col.palette,breaks){
>> 
>> grid.sp is what? A SpatialGridDataFrame?
>
> Yes, this SpatialGridDataFrame results from an interpolated temperature 
> field. writeAsciiGrid(grid.sp,asc.file) results in the expected text file 
> with a correct georef.
>
>>  str(grid.sp)
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>  ..@ data       :'data.frame': 84000 obs. of  2 variables:
>  .. ..$ temperature_mean.pred: num [1:84000] 5.4 5.4 5.4 5.4 5.5 5.5 5.5 5.5
>  5.5 5.5 ...
>  .. ..$ temperature_mean.var : num [1:84000] NA NA NA NA NA NA NA NA NA NA
>  ...
>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>  .. .. ..@ cellcentre.offset: Named num [1:2] 655050 278050
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  .. .. ..@ cellsize         : Named num [1:2] 100 100
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  .. .. ..@ cells.dim        : Named int [1:2] 350 240
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  ..@ grid.index : int(0)
>  ..@ coords     : num [1:2, 1:2] 655050 689950 278050 301950
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : NULL
>  .. .. ..$ : chr [1:2] "x_coord" "y_coord"
>  ..@ bbox       : num [1:2, 1:2] 655000 278000 690000 302000
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "x_coord" "y_coord"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr "+init=world:CH1903"
>
>> graph.file is what? A file name - single element character vector?
>
>>  str(graph.file)
> chr "/data/graph_output/temp_205_100m_2008031117.tiff"
>
>> col.palette is what? A character vector?
>
>>  str(col.palette)
> chr [1:26] "#97FF02" "#5BFA05" "#00C632" "#17D9ED" "#28CCEE" ...
>
>> breaks is what? A numeric vector?
>
>>  str(breaks)
> num [1:27] -100 -18 -16 -14 -12 -10 -8 -6 -4 -2 ...
>
>> > # get desired picture type
>> > base.name=strsplit(graph.file,"/")[[1]][length(strsplit(graph.file,"/")[[1]])]
>> 
>> Do you know that base.name is what you think it is? Did you consider using
>> the basename() function?
>
> Yes, basename() should be used. The above is a relict from an old script, and 
> does the same as basename().
>
>> > ft=0
>> > ft=sum(c(ft,grep(".tiff",base.name)))
>> 
>> See ?grep - "." means something.
>> 
>> > if (ft==1){ file.typ="TIFF" }
>> > ft=0
>> > ft=sum(c(ft,grep(".jpg",base.name)))
>> > if (ft==1){ file.typ="JPG" }
>> > ft=0
>> > ft=sum(c(ft,grep(".png",base.name)))
>> > if (ft==1){ file.typ="PNG" }
>
> This part of the script actually works without problems. I know that the 
> determination of the file type from the given file name is not done in a very 
> elaborate way. Any suggestions?
>
>> > # create RGB bands
>> > names(grid.sp)=c("band1","band2")
>> 
>> How many columns did grid.sp have when it came into the function, do you
>> know that there were two? If not, this will not create them.
>
> Yes, it always has two.
>
>> > grid.sp$band3=grid.sp$band2
>> > grid.sp$band4=grid.sp$band2
>> 
>> If band2 wasn't created above, this won't create band3 or band4.
>
> Yes, but as band2 is always present, this is not an issue.
>
>> > col.class=as.vector(cut(grid.sp$band1,br = breaks, labels=col.palette))
>> 
>> Curious use of cut:
>> 
>> col.class <- col.palette[findInterval(grid.sp$band1, vec=breaks,
>>     all.inside=TRUE)]
>> 
>> seems more natural, and avoids creating a factor (which is what cut() is
>> for).
>
> I'll keep this in mind. But doesn't findInterval() need sorted input? For 
> this specific problem I would now use vec2RGB as suggested below.
>

No, findInterval() is an excellent and very fast function for this 
purpose. Only vec= needs to be sorted, but that is the same in cut() and 
not an unreasonable requirement.

>> > col.class[is.na(col.class)]="#FFFFFF"
>> 
>> Do you know how many are NAs?
>
> No, this differs for the individual cases.
>
>> > col.class.rgb=col2rgb(col.class)
>> 
>> Assuming that you have full control of col.class, this should work.
>
> It does:
>
>>  str(col.class.rgb)
> int [1:3, 1:84000] 214 226 238 214 226 238 214 226 238 214 ...
> - attr(*, "dimnames")=List of 2
>  ..$ : chr [1:3] "red" "green" "blue"
>  ..$ : NULL
>
>> > grid.sp$band1=col.class.rgb["red",]
>> 
>> Here you are overwriting the input object - do you need to? Wouldn't it be
>> cleaner to start a fresh object?
>
> As I do not need the data from the input object any more, I tried to save 
> memory by reusing this object (as these can become fairly large). Could this 
> be done better in a different way?
>

When debugging, it is never a good idea to overwrite. Further, R uses 
advanced memory management and a garbage collector, so you are not 
guaranteed immediate reductions in memory usage by overwriting - it will 
depend on when garbage collection happens.

>> > grid.sp$band2=col.class.rgb["green",]
>> > grid.sp$band3=col.class.rgb["blue",]
>> > grid.sp$band4[]=256
>> 
>> Should the alpha band run 0-255 or 1-256? col2rgb() uses 0-255 (and can
>> also add an alpha column).
>
> I actually determined 256 by trial and error (the alpha channel option from 
> col2rgb() gives 255). With 256, writeGDAL() produced an image with a 
> transparent alpha channel. Assumed that the higher number represents complete 
> transparency.
>
> The script results in the following SpatialGridDataFrame:
>
>>  str(grid.sp)
> Formal class 'SpatialGridDataFrame' [package "sp"] with 6 slots
>  ..@ data       :'data.frame': 84000 obs. of  4 variables:
>  .. ..$ band1: int [1:84000] 214 214 214 214 214 214 214 214 214 214 ...
>  .. ..$ band2: int [1:84000] 226 226 226 226 226 226 226 226 226 226 ...
>  .. ..$ band3: int [1:84000] 238 238 238 238 238 238 238 238 238 238 ...
>  .. ..$ band4: num [1:84000] 256 256 256 256 256 256 256 256 256 256 ...
>  ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
>  .. .. ..@ cellcentre.offset: Named num [1:2] 655050 278050
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  .. .. ..@ cellsize         : Named num [1:2] 100 100
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  .. .. ..@ cells.dim        : Named int [1:2] 350 240
>  .. .. .. ..- attr(*, "names")= chr [1:2] "x_coord" "y_coord"
>  ..@ grid.index : int(0)
>  ..@ coords     : num [1:2, 1:2] 655050 689950 278050 301950
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : NULL
>  .. .. ..$ : chr [1:2] "x_coord" "y_coord"
>  ..@ bbox       : num [1:2, 1:2] 655000 278000 690000 302000
>  .. ..- attr(*, "dimnames")=List of 2
>  .. .. ..$ : chr [1:2] "x_coord" "y_coord"
>  .. .. ..$ : chr [1:2] "min" "max"
>  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>  .. .. ..@ projargs: chr "+init=world:CH1903"
>
>
>> >   #writeGDAL(grid.sp, graph.file,drivername = "GTiff",type = 
>> >   "band",options="ALPHA=YES")
>> 
>> The two versions are equivalent.
>
> I know. I first suspected the error in writeGDAL() and therefore tried to 
> achieve the same result by directly using the "underlying" function.
>
>> Most likely, the cause of your problems
>> is type = "band", which is not a valid type, being passed to underlying
>> GDAL functions as "Unknown". My guess would be that you mean "Byte".
>> 
>> The full list of GDAL data types is on www.gdal.org (down now for me, so
>> no specific link), and from the R prompt as:
>> 
>> rgdal:::.GDALDataTypes
>
> That's the one! When I checked out writeGDAL I obviously misinterpreted the 
> type option. As it worked from the command line, I did not suspect this 
> option to be wrong.

A string value not in rgdal:::.GDALDataTypes results in the type being set 
to "Unknown", which then has different behaviour fro different drivers. In 
the next rgdal release, users of writeGDAL will be forced to give a valid 
type (but not users of the underlying GDAL functions.

Roger

>
>> Finally, wouldn't it be easier to use the vec2RGB() function in rgdal, see
>> the example using the meuse.grid data set at the foot of the example on
>> the help page?
>
> Yes, could be used instead of the "misused" cut (gives the same result). 
> Another reinvention from my side ...
>
> Thanks a lot for your help and time.
>
> Best regards,
> Simon
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From dylan.beaudette at gmail.com  Mon Mar 17 17:51:03 2008
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Mon, 17 Mar 2008 08:51:03 -0800
Subject: [R-sig-Geo] spplot with two rasters
In-Reply-To: <Pine.LNX.4.64.0803121842370.13400@reclus.nhh.no>
References: <200803041621.30538.dylan.beaudette@gmail.com>
	<200803121034.42952.dylan.beaudette@gmail.com>
	<Pine.LNX.4.64.0803121842370.13400@reclus.nhh.no>
Message-ID: <200803170951.03384.dylan.beaudette@gmail.com>

On Wednesday 12 March 2008, Roger Bivand wrote:
> On Wed, 12 Mar 2008, Dylan Beaudette wrote:
> > On Thursday 06 March 2008, Thomas Adams wrote:
> >> Dylan,
> >>
> >> I think a solution using GRASS can be found on pages 110-111 of "Open
> >> Source GIS: A GRASS GIS Approach", 3rd Ed. The same material is covered
> >> in the 2nd Ed. as well, where you use r.mapcalc to combine two rasters
> >> and judicious use of MASKs; a conditional statement in r.mapcalc is the
> >> key.
> >>
> >> Regards,
> >> Tom
> >
> > Hi Tom,
> >
> > Thanks for the suggestion. This works, but we were hoping to make the
> > plot in R-- as the PDF output is hard to match with GRASS alone. I
> > suppose I will just have to try using two rasters with spplot() and see
> > what happens.
>
> The problem is that customising a panel to insert an image probably means
> writing just that, customised panels, and spplot() essentially does that
> already. You could look at Chapter 5 in Paul Murrell's book, to see how to
> insert grid output into lattice output (to try to put an image as a
> backcloth, but there is no example for this case - the example is for
> adding a location position.
>
> My guess would be that if you are only displaying a single panel, you will
> find it easier to use base graphics, and simply say image() twice, and use
> legend() (or legend.krige() from geoR).
>
> Roger

Thanks for the tips Roger. I think that in this case it will be simplest to 
use multiple calls to image().

Cheers,

Dylan


> > Cheers,
> >
> > Dylan
> >
> >> Dylan Beaudette wrote:
> >>> On Tuesday 04 March 2008, Edzer Pebesma wrote:
> >>>> I find it hard to imagine how you want to plot two raster files on top
> >>>> of each other. Do you want some form of transparency? If it is just
> >>>> one overlaying the other, you could use overlay to find out which
> >>>> cells in raster 1 to replace with those in raster 2 before plotting.
> >>>> --
> >>>> Edzer
> >>>
> >>> Hi Edzer,
> >>>
> >>> I generally agree that plotting one raster file "over" another raster
> >>> file would be of little use. In this case, one of the raster files (the
> >>> interesting one) has been masked with nodata, such that it only really
> >>> covers about 30% of the region of interest. The other raster is just
> >>> contextual data, and thus would be useful to plot "behind" the first
> >>> raster.
> >>>
> >>> Ideas?
> >>>
> >>> Dylan
> >>>
> >>>> Dylan Beaudette wrote:
> >>>>> Hi,
> >>>>>
> >>>>> Is it possible to plot two raster images using spplot() in a manner
> >>>>> similar to:
> >>>>>
> >>>>> pts <- list("sp.points", points_file, pch = 4, col = "black",
> >>>>> cex=0.5) spplot(raster_file, zcol="elev.pred", sp.layout=list(pts))
> >>>>>
> >>>>> Note that one of the raster images is an aerial photo, used only for
> >>>>> context, while the second one is one with interesting z-values. The
> >>>>> second raster is masked and thus does not cover the entire region.
> >>>>>
> >>>>> Thanks,
> >>>>>
> >>>>> Dylan



-- 
Dylan Beaudette
Soil Resource Laboratory
http://casoilresource.lawr.ucdavis.edu/
University of California at Davis
530.754.7341



From p.hiemstra at geo.uu.nl  Mon Mar 17 20:41:20 2008
From: p.hiemstra at geo.uu.nl (Paul Hiemstra)
Date: Mon, 17 Mar 2008 20:41:20 +0100
Subject: [R-sig-Geo] rgdal installation
In-Reply-To: <47DE3575.40608@cebc.cnrs.fr>
References: <47DE3575.40608@cebc.cnrs.fr>
Message-ID: <47DEC960.9010208@geo.uu.nl>

Hi,

I had a similar problem with reading HDF5 files. The standard gdal 
version compiled into rgdal probably does not support hdf4. One option 
is to compile rgdal yourself using a gdal and proj version that support 
hdf4. A good alternative is to translate the hdf4 file to tif (using 
shell() to give the gdal_translate command through R) and then read it 
into R.

cheers,
Paul

David PINAUD schreef:
> Dear all,
>
> I'm trying to import HDF (v4) files on R2.6.2  using the package rgdal 
> and FWTools v2.1.0. I have the following message :
>
> > GDALinfo("T20060012006008.L3m_8D_SST_9.hdf")
> Erreur dans .local(.Object, ...) :
>        GDAL Error 4: `T20060012006008.L3m_8D_SST_9.hdf' not recognised 
> as a supported file format.
>
> I can load this file with FWTools without problem.
> I suppose that rgdal is not able to recognize the path to the 
> FWTools/bin directory:
> > library(rgdal)
> Le chargement a n?cessit? le package : sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.5.0, released 2007/12/18
> GDAL_DATA: C:/PROGRA~1/R/R-26~1.2/library/rgdal/gdal  ####### it 
> should be FWTools/bin ??  #####
> Loaded PROJ.4 runtime: Rel. 4.6.0, 21 Dec 2007
> PROJ_LIB: C:/PROGRA~1/R/R-26~1.2/library/rgdal/proj
>
> However I set before the PATH environment variable in Windows 
> (Start>Parameters>Configuration Panel>System>Advanced>Environment 
> variables : GDAL_DATA set to C:\Program Files\FWTools2.1.0\bin) as 
> explained in http://rgdal.sourceforge.net/. No effect.
>
> What's wrong ? Is there a thing that I've missed or didn't do 
> correctly? Is there another way to set this directory?
>
> Thank you for your help^.
>
> David
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   


-- 
Drs. Paul Hiemstra
Department of Physical Geography
Faculty of Geosciences
University of Utrecht
Heidelberglaan 2
P.O. Box 80.115
3508 TC Utrecht
Phone:     +31302535773
Fax:    +31302531145
http://intamap.geo.uu.nl/~paul



From fhds2000 at yahoo.com  Mon Mar 17 22:54:58 2008
From: fhds2000 at yahoo.com (Fernando De Sales)
Date: Mon, 17 Mar 2008 14:54:58 -0700 (PDT)
Subject: [R-sig-Geo] smoother contour maps
Message-ID: <549750.17209.qm@web53306.mail.re2.yahoo.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080317/87059fcc/attachment.pl>

From regmi_pujan at hotmail.com  Mon Mar 17 23:35:54 2008
From: regmi_pujan at hotmail.com (PUJAN RAJ REGMI)
Date: Mon, 17 Mar 2008 22:35:54 +0000
Subject: [R-sig-Geo]  Variogram Plot
In-Reply-To: <47DE3575.40608@cebc.cnrs.fr>
References: <47DE3575.40608@cebc.cnrs.fr>
Message-ID: <BAY113-W50E7E176B90E2E9107C71684050@phx.gbl>


Dear all,
I am trying to plot semivarigram using the function "variog" but i am getting following error message "cannot allocate vector of size 757.6 Mb" I suppose my data set seems large?? it has 14090 samples. I will be thankful if anybody suggest me the alternative ways to overcome the problem of size.
Thanking you
Yours
Pujan


_________________________________________________________________
Helping your favorite cause is as easy as instant messaging.?You IM, we give.



From mdsumner at utas.edu.au  Tue Mar 18 00:23:22 2008
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Tue, 18 Mar 2008 9:23:22 +1000
Subject: [R-sig-Geo] smoother contour maps
Message-ID: <200803172323.m2HNNMrT028953@corinna.its.utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080318/eb42dd4b/attachment.pl>

From Mary.Barnes at csiro.au  Tue Mar 18 03:15:27 2008
From: Mary.Barnes at csiro.au (Mary.Barnes at csiro.au)
Date: Tue, 18 Mar 2008 12:45:27 +1030
Subject: [R-sig-Geo] Finding closest match to GIS coordinates - R code
Message-ID: <5315829F24762341B6EC14B120FF7B962068AB@exsa4-adl.nexus.csiro.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080318/5e2a3902/attachment.pl>

From yong.li at unimelb.edu.au  Tue Mar 18 05:10:00 2008
From: yong.li at unimelb.edu.au (Yong Li)
Date: Tue, 18 Mar 2008 15:10:00 +1100
Subject: [R-sig-Geo] How to produce a R2 for semivariance model fitting
Message-ID: <86DBA0678E017341B449A62F258E2956011FDB48@IS-EX-BEV3.unimelb.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080318/b42831f8/attachment.pl>

From Thierry.ONKELINX at inbo.be  Tue Mar 18 09:20:55 2008
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 18 Mar 2008 09:20:55 +0100
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W50E7E176B90E2E9107C71684050@phx.gbl>
References: <47DE3575.40608@cebc.cnrs.fr>
	<BAY113-W50E7E176B90E2E9107C71684050@phx.gbl>
Message-ID: <2E9C414912813E4EB981326983E0A104047DD7D9@inboexch.inbo.be>


Without your code it's hard to see what causes the error. Have you specified maxdist? The default is the maximum distance among all pairs. Start with reducing maxdist to one half or one thirth of the maximum distance among all pairs.

HTH,

Thierry


----------------------------------------------------------------------------
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics, methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium 
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be 
www.inbo.be 

To call in the statistician after the experiment is done may be no more than asking him to perform a post-mortem examination: he may be able to say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not ensure that a reasonable answer can be extracted from a given body of data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: r-sig-geo-bounces at stat.math.ethz.ch [mailto:r-sig-geo-bounces at stat.math.ethz.ch] Namens PUJAN RAJ REGMI
Verzonden: maandag 17 maart 2008 23:36
Aan: David PINAUD; r-sig-geo at stat.math.ethz.ch
Onderwerp: [R-sig-Geo] Variogram Plot


Dear all,
I am trying to plot semivarigram using the function "variog" but i am getting following error message "cannot allocate vector of size 757.6 Mb" I suppose my data set seems large?? it has 14090 samples. I will be thankful if anybody suggest me the alternative ways to overcome the problem of size.
Thanking you
Yours
Pujan


_________________________________________________________________
Helping your favorite cause is as easy as instant messaging.?You IM, we give.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From regmi_pujan at hotmail.com  Tue Mar 18 09:28:53 2008
From: regmi_pujan at hotmail.com (PUJAN RAJ REGMI)
Date: Tue, 18 Mar 2008 08:28:53 +0000
Subject: [R-sig-Geo] Variogram Plot
Message-ID: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>


Thank you very much for response.
Here i have attached the my code below . Pls have a look and suggest me the solution.
Thanking you in advance
Yours
Pujan

mol.gr <- read.table(?D:/Pujan_IUPWARE/Second_Year/Thesis/mol.dat?)
mol.gr[,"x"] <-mol.gr[,1] 
mol.gr[,"y"] <-mol.gr[,2] 
mol.gr[,"Green Band Reflectance"] <-mol.gr[,3]
map<-as.geodata(mol.gr)   # make a geoR object to use various ready-made R unctions 
coal.var <- variog(map, max.dist =283.6)   # omnidirectional semivariogram up to half max distance
Note: The total number of data points are 14094.
_________________________________________________________________


08


From edzer.pebesma at uni-muenster.de  Tue Mar 18 10:06:44 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 18 Mar 2008 10:06:44 +0100
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
Message-ID: <47DF8624.2030700@uni-muenster.de>

Does geoR try to store the quadratic form?

 > (14049 ** 2 * 8 / 2)/(1024**2)
[1] 752.9236

"I am trying to plot semivarigram using the function "variog" but i am getting following error message "cannot allocate vector of size 757.6 Mb" 

In any case, function variogram in package gstat does not do so.
--
Edzer

PUJAN RAJ REGMI wrote:
> Thank you very much for response.
> Here i have attached the my code below . Pls have a look and suggest me the solution.
> Thanking you in advance
> Yours
> Pujan
>
> mol.gr <- read.table(?D:/Pujan_IUPWARE/Second_Year/Thesis/mol.dat?)
> mol.gr[,"x"] <-mol.gr[,1] 
> mol.gr[,"y"] <-mol.gr[,2] 
> mol.gr[,"Green Band Reflectance"] <-mol.gr[,3]
> map<-as.geodata(mol.gr)   # make a geoR object to use various ready-made R unctions 
> coal.var <- variog(map, max.dist =283.6)   # omnidirectional semivariogram up to half max distance
> Note: The total number of data points are 14094.
> _________________________________________________________________
>
>
> 08
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Thierry.ONKELINX at inbo.be  Tue Mar 18 10:18:02 2008
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 18 Mar 2008 10:18:02 +0100
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
Message-ID: <2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>


> library(geoR)
Loading required package: sp

-------------------------------------------------------------
Analysis of geostatistical data
For an Introduction to geoR go to http://www.leg.ufpr.br/geoR
geoR version 1.6-20 (built on 2007-11-28) is now loaded
-------------------------------------------------------------

> n <- 14000
> map <- data.frame(x = runif(n, max = 400), y = runif(n, max = 400),
value = rnorm(n))
> selection <- as.geodata(map)
> coal.var <- variog(selection, max.dist = 280)
variog: computing omnidirectional variogram
Error: cannot allocate vector of size 747.6 Mb
> traceback()
3: dist(as.matrix(coords))
2: as.vector(dist(as.matrix(coords)))
1: variog(selection, max.dist = 280)

It looks like geoR gets in troubles when it calculates the distance
matrix.

> selection <- as.geodata(map[sample(seq_len(n), 8000), ])
> coal.var <- variog(selection, max.dist = 280)
variog: computing omnidirectional variogram

The problem does not arise, when the sample of the data is small enough.

> 
> 
> library(gstat)
> coordinates(map) <- ~x + y
> coal.var <- variogram(value ~1, map)
> 

gstat on the other hand has no problem with a dataset of 14000 points.

Thierry


------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium 
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be 
www.inbo.be 

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: PUJAN RAJ REGMI [mailto:regmi_pujan at hotmail.com] 
Verzonden: dinsdag 18 maart 2008 9:29
Aan: ONKELINX, Thierry; David PINAUD; r-sig-geo at stat.math.ethz.ch
Onderwerp: RE: [R-sig-Geo] Variogram Plot


Thank you very much for response.
Here i have attached the my code below . Pls have a look and suggest me
the solution.
Thanking you in advance
Yours
Pujan

mol.gr <- read.table("D:/Pujan_IUPWARE/Second_Year/Thesis/mol.dat")
mol.gr[,"x"] <-mol.gr[,1] 
mol.gr[,"y"] <-mol.gr[,2] 
mol.gr[,"Green Band Reflectance"] <-mol.gr[,3]
map<-as.geodata(mol.gr)   # make a geoR object to use various ready-made
R unctions 
coal.var <- variog(map, max.dist =283.6)   # omnidirectional
semivariogram up to half max distance
Note: The total number of data points are 14094.
_________________________________________________________________
Connect and share in new ways with Windows Live.
http://www.windowslive.com/share.html?ocid=TXT_TAGHM_Wave2_sharelife_012
008



From edzer.pebesma at uni-muenster.de  Tue Mar 18 10:23:38 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 18 Mar 2008 10:23:38 +0100
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
	<2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>
Message-ID: <47DF8A1A.8070400@uni-muenster.de>

ONKELINX, Thierry wrote:
>
> gstat on the other hand has no problem with a dataset of 14000 points.
>   
Right; it computes all pairwise distances in a double loop, but never 
stores them.
--
Edzer



From reeves at nceas.ucsb.edu  Tue Mar 18 16:58:44 2008
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Tue, 18 Mar 2008 08:58:44 -0700
Subject: [R-sig-Geo] Solution in R for finding closest points:
In-Reply-To: <5315829F24762341B6EC14B120FF7B962068AB@exsa4-adl.nexus.csiro.au>
References: <5315829F24762341B6EC14B120FF7B962068AB@exsa4-adl.nexus.csiro.au>
Message-ID: <47DFE6B4.1070006@nceas.ucsb.edu>


Mary:

Have a look at this tutorial:

http://nceas.ucsb.edu/scicomp/GISSeminar/UseCases/AssignClosestPointsR/AssignClosestPointsR.html

Uses R, which has a good set of geospatial analysis functions. This web 
site has several other examples!

Hope this helps,
Rick Reeves

Mary.Barnes at csiro.au wrote:
> Hi all,
> I recently joined, and have a rather basic question. I'd appreciate any
> help to find some R routines to find the closest match to GIS
> coordinates. I suspect simply using the Euclidean distance. I could
> write some code but I suspect there is some already.  I describe three
> classes of difficulties below. 
> 1. Sometimes there are simple measurement error differences in GIS from
> vine coordinates measurement at different times. This may also relate to
> ability to get close to trunk in addition to equipment measurement
> error.
> 2. Sometimes we encounter the problem of matching aerial spatial records
> with vines. Aerial and satellite imagery is on a different scales
> (pixels) to vine spacing. But we would like to be able to match these as
> best we can.
> 3. Sometimes we want to match kriged clusters to target vine GPS
> coordinates.
>
> Typically I have 100 target vines at each of 5 vineyards.
>
> Euclidean distance  approx. = square root of  ( differences between
> Eastings squared plus the differences between Northings squared)
>
> Any help will be appreciated  Mary Barnes
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: reeves.vcf
Type: text/x-vcard
Size: 339 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080318/30cfeb73/attachment.vcf>

From macq at llnl.gov  Tue Mar 18 20:47:39 2008
From: macq at llnl.gov (Don MacQueen)
Date: Tue, 18 Mar 2008 12:47:39 -0700
Subject: [R-sig-Geo] Solution in R for finding closest points:
In-Reply-To: <47DFE6B4.1070006@nceas.ucsb.edu>
References: <5315829F24762341B6EC14B120FF7B962068AB@exsa4-adl.nexus.csiro.au>
	<47DFE6B4.1070006@nceas.ucsb.edu>
Message-ID: <p0623091dc405cbe88e19@[128.115.92.33]>

Mary,

You might also want to look at the nncross function in the spatstat package.

-Don

At 8:58 AM -0700 3/18/08, Rick Reeves wrote:
>Mary:
>
>Have a look at this tutorial:
>
>http://nceas.ucsb.edu/scicomp/GISSeminar/UseCases/AssignClosestPointsR/AssignClosestPointsR.html
>
>Uses R, which has a good set of geospatial analysis functions. This 
>web site has several other examples!
>
>Hope this helps,
>Rick Reeves
>
>Mary.Barnes at csiro.au wrote:
>>Hi all,
>>I recently joined, and have a rather basic question. I'd appreciate any
>>help to find some R routines to find the closest match to GIS
>>coordinates. I suspect simply using the Euclidean distance. I could
>>write some code but I suspect there is some already.  I describe three
>>classes of difficulties below. 1. Sometimes there are simple 
>>measurement error differences in GIS from
>>vine coordinates measurement at different times. This may also relate to
>>ability to get close to trunk in addition to equipment measurement
>>error.
>>2. Sometimes we encounter the problem of matching aerial spatial records
>>with vines. Aerial and satellite imagery is on a different scales
>>(pixels) to vine spacing. But we would like to be able to match these as
>>best we can.
>>3. Sometimes we want to match kriged clusters to target vine GPS
>>coordinates.
>>
>>Typically I have 100 target vines at each of 5 vineyards.
>>
>>Euclidean distance  approx. = square root of  ( differences between
>>Eastings squared plus the differences between Northings squared)
>>
>>Any help will be appreciated  Mary Barnes
>>
>>	[[alternative HTML version deleted]]
>>
>>_______________________________________________
>>R-sig-Geo mailing list
>>R-sig-Geo at stat.math.ethz.ch
>>https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>
>
>Attachment converted: MacQMac:reeves.vcf (TEXT/R*ch) (01FDEEA0)
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062



From regmi_pujan at hotmail.com  Wed Mar 19 09:27:09 2008
From: regmi_pujan at hotmail.com (PUJAN RAJ REGMI)
Date: Wed, 19 Mar 2008 08:27:09 +0000
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
	<2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>
Message-ID: <BAY113-W56E2E63D205F13EBBB827084070@phx.gbl>

Dear all, 
I think earlier i didn't clear myself. Now i am sending my data file and the code. My data set is attached with the mail where first and second column is X and Y coordinates and the column is the value of samples.  I hope this time i am able to communicate.  
Thanking you 
Pujan 
 Code: 
> mol.gr <- read.table(?D:/mol.dat?) 
> mol.gr[,"x"] <-mol.gr[,1]
> mol.gr[,"y"] <-mol.gr[,2] 
> mol.gr[,"Green Band Reflectance"] <-mol.gr[,3] 
>map<-as.geodata(mol.gr) # make a geoR object to use various ready-made R unctions 
> coal.var <- variog(map, max.dist =283.6) # omnidirectional semivariogram up to half max distance 
> plot(coal.var)
_________________________________________________________________
Helping your favorite cause is as easy as instant messaging.?You IM, we give.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080319/0a4741e4/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mol.rar
Type: application/octet-stream
Size: 29506 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080319/0a4741e4/attachment.obj>

From paulojus at c3sl.ufpr.br  Wed Mar 19 19:09:52 2008
From: paulojus at c3sl.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 19 Mar 2008 15:09:52 -0300 (BRT)
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W50E7E176B90E2E9107C71684050@phx.gbl>
References: <47DE3575.40608@cebc.cnrs.fr>
	<BAY113-W50E7E176B90E2E9107C71684050@phx.gbl>
Message-ID: <Pine.LNX.4.58.0803191507390.24597@dalmore.c3sl.ufpr.br>

Pujan

geoR indeed has some restriction the way is is programed down in the C
code, more or less in the direction Edzer has pointed out.

This can certainly be improved but as a quick solution to run a variogram
computation on 14,000 data or over you should consider raun a function
grom another packages such as geostat, for instance or other
geostatistical package
(there are quite a few see the R-Sig-Geo web page)

best
P.J.


Paulo Justiniano Ribeiro Jr
LEG (Laboratorio de Estatistica e Geoinformacao)
Universidade Federal do Parana
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 3361 3573
Fax: (+55) 41 3361 3141
e-mail: paulojus AT  ufpr  br
http://www.leg.ufpr.br/~paulojus

-------------------------------------------------------------------------
53a Reuniao Anual da Regiao Brasileira da Soc. Internacional de Biometria
14 a 16/05/2008, UFLA, Lavras,MG
http://www.rbras.org.br/rbras53
-------------------------------------------------------------------------


On Mon, 17 Mar 2008, PUJAN RAJ REGMI wrote:

>
> Dear all,
> I am trying to plot semivarigram using the function "variog" but i am getting following error message "cannot allocate vector of size 757.6 Mb" I suppose my data set seems large?? it has 14090 samples. I will be thankful if anybody suggest me the alternative ways to overcome the problem of size.
> Thanking you
> Yours
> Pujan
>
>
> _________________________________________________________________
> Helping your favorite cause is as easy as instant messaging.?You IM, we give.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From famuvie at alumni.uv.es  Thu Mar 20 19:05:21 2008
From: famuvie at alumni.uv.es (=?ISO-8859-1?Q?Facundo_Mu=F1oz?=)
Date: Thu, 20 Mar 2008 19:05:21 +0100
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
Message-ID: <47E2A761.1070703@alumni.uv.es>

Hello All,

I'm performing  regression kriging (using both gstat and geoR)  in an 
urban environment. Thus, i have discontinuities (buildings) in the 
prediction space which make distances to be non-euclidean.

I need to estimate variogram and make predictions using distances 
calculated by myself and passed to the algorithms (say, in a distance 
matrix), instead of letting them calculate distances based on coordinates.

?Has anyone faced this issue before?

Thanks in advance,
    Facundo Mu?oz

-- 
Departament d'Estad?stica i Investigaci? Operativa Universitat de 
Val?ncia (Estudi General)
Facultat de Matem?tiques, Dr. Moliner 50, 46100 Burjassot, Spain.
(+34) 96 354 3987, fax: (+34) 96 354 3238
e-mail: Facundo.Munoz at uv.es, web: http://www.uv.es/~famarmu/



From macq at llnl.gov  Thu Mar 20 19:42:39 2008
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 20 Mar 2008 11:42:39 -0700
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
In-Reply-To: <47E2A761.1070703@alumni.uv.es>
References: <47E2A761.1070703@alumni.uv.es>
Message-ID: <p06230903c4085fc03705@[128.115.92.33]>

Facundo,

I am interested in essentially the same thing, 
though my application is inside buildings. I am 
wondering what technique(s), software, etc. you 
would be using to calculate your distances.

I asked about this about a month ago, here on 
r-sig-geo, and received some helpful replies. The 
subject line at that time was
    [R-sig-Geo] Shortest path around obstacles (OT)

-Don

At 7:05 PM +0100 3/20/08, Facundo Mu?oz wrote:
>Hello All,
>
>I'm performing  regression kriging (using both gstat and geoR)  in an
>urban environment. Thus, i have discontinuities (buildings) in the
>prediction space which make distances to be non-euclidean.
>
>I need to estimate variogram and make predictions using distances
>calculated by myself and passed to the algorithms (say, in a distance
>matrix), instead of letting them calculate distances based on coordinates.
>
>?Has anyone faced this issue before?
>
>Thanks in advance,
>     Facundo Mu?oz
>
>--
>Departament d'Estad?stica i Investigaci? Operativa Universitat de
>Val?ncia (Estudi General)
>Facultat de Matem?tiques, Dr. Moliner 50, 46100 Burjassot, Spain.
>(+34) 96 354 3987, fax: (+34) 96 354 3238
>e-mail: Facundo.Munoz at uv.es, web: http://www.uv.es/~famarmu/
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at stat.math.ethz.ch
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062



From acoffin at ufl.edu  Thu Mar 20 21:33:57 2008
From: acoffin at ufl.edu (Alisa Coffin)
Date: Thu, 20 Mar 2008 16:33:57 -0400
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
In-Reply-To: <bb61ce440803201322r52e91d1ek4eac693a8c6ef23c@mail.gmail.com>
References: <47E2A761.1070703@alumni.uv.es>
	<p06230903c4085fc03705@128.115.92.33>
	<bb61ce440803201322r52e91d1ek4eac693a8c6ef23c@mail.gmail.com>
Message-ID: <bb61ce440803201333i164dadccga7cee385a05252b6@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080320/8600b6cd/attachment.pl>

From mdsumner at utas.edu.au  Fri Mar 21 02:15:42 2008
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Fri, 21 Mar 2008 12:15:42 +1100
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
In-Reply-To: <bb61ce440803201333i164dadccga7cee385a05252b6@mail.gmail.com>
References: <47E2A761.1070703@alumni.uv.es>	<p06230903c4085fc03705@128.115.92.33>	<bb61ce440803201322r52e91d1ek4eac693a8c6ef23c@mail.gmail.com>
	<bb61ce440803201333i164dadccga7cee385a05252b6@mail.gmail.com>
Message-ID: <47E30C3E.9060802@utas.edu.au>

The soap package that accompanies mgcv may be of interest:

http://www.maths.bath.ac.uk/~sw283/simon/software.html

Cheers, Mike.


Alisa Coffin wrote:
> Don & Facundo,
>
> This is something that I'm interested in as well for coastal marine
> applications.
>
> The only solution I've found so far is a cumbersome "barrier" function
> available in the kriging operation of ArcGIS. I would be interested in
> seeing an (better) implementation of the idea in R.
>
> I was able to find a few references on the subject that I pass along to you
> and anyone else that might find it useful:
>
> Krioruchko, K. and A. Gribov. 2002. Geostatistical interpolation and
> simulation in the presence of barriers. X. Sanchez-Vila et al. (eds.), *geoENV
> IV -- Geostatistics for Environmental Applications,* pp. 331-342. Kluwer
> Academic Publishers: the Netherlands.
>
> Curriero, F.C. 1997. The use of non-Euclidean distances in geostatistics,
> PhD thesis.
>
> Little, LS, D Edwards and DE Porter. 1997. Kriging in estuaries: as the crow
> flies or as the fish swims? Journal of experimental marine biology and
> ecology. 213:1-11.
>
> Rathbun, S. 1998. Spatial modeling in irregularly shaped regions: kriging
> estuaries. Envirometrics. 9:109-129.
>
> Jensen, OP, MC Christman and TJ Mller. 2006. Landscape-based geostatistics:
> a case study of the distribution of blue crab in Chesapeake Bay.
> Envirometrics. 17:605-621.
>
> Regards,
>
> Alisa Coffin
>
>
> On Thu, Mar 20, 2008 at 2:42 PM, Don MacQueen <macq at llnl.gov> wrote:
>
>   
>> Facundo,
>>
>> I am interested in essentially the same thing,
>> though my application is inside buildings. I am
>> wondering what technique(s), software, etc. you
>> would be using to calculate your distances.
>>
>> I asked about this about a month ago, here on
>> r-sig-geo, and received some helpful replies. The
>> subject line at that time was
>>    [R-sig-Geo] Shortest path around obstacles (OT)
>>
>> -Don
>>
>> At 7:05 PM +0100 3/20/08, Facundo Mu?oz wrote:
>>     
>>> Hello All,
>>>
>>> I'm performing  regression kriging (using both gstat and geoR)  in an
>>> urban environment. Thus, i have discontinuities (buildings) in the
>>> prediction space which make distances to be non-euclidean.
>>>
>>> I need to estimate variogram and make predictions using distances
>>> calculated by myself and passed to the algorithms (say, in a distance
>>> matrix), instead of letting them calculate distances based on
>>>       
>> coordinates.
>>     
>>> ?Has anyone faced this issue before?
>>>
>>> Thanks in advance,
>>>     Facundo Mu?oz
>>>
>>> --
>>> Departament d'Estad?stica i Investigaci? Operativa Universitat de
>>> Val?ncia (Estudi General)
>>> Facultat de Matem?tiques, Dr. Moliner 50, 46100 Burjassot, Spain.
>>> (+34) 96 354 3987, fax: (+34) 96 354 3238
>>> e-mail: Facundo.Munoz at uv.es, web: http://www.uv.es/~famarmu/<http://www.uv.es/%7Efamarmu/>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at stat.math.ethz.ch
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>       
>> --
>> --------------------------------------
>> Don MacQueen
>> Environmental Protection Department
>> Lawrence Livermore National Laboratory
>> Livermore, CA, USA
>> 925-423-1062
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>>     
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>     
>> ------------------------------------------------------------------------
>>
>> Internal Virus Database is out-of-date.
>> Checked by AVG. 
>> Version: 7.5.519 / Virus Database: 269.21.7 - Release Date: 2008-03-08 00:00
>>



From aubreymoore at guam.net  Sat Mar 22 02:01:16 2008
From: aubreymoore at guam.net (Aubrey Moore)
Date: Sat, 22 Mar 2008 11:01:16 +1000
Subject: [R-sig-Geo] How to handle large negative numbers in GeoTIFF DEM?
Message-ID: <47E45A5C.8080301@guam.net>

Hi All,

I am trying to display a DEM for the island of Guam.  The data were 
downloaded in GeoTIFF format from the National Elevation Dataset 
(http://ned.usgs.gov/).  It appears that some rectangular areas of the 
ocean in this DEM been assigned an elevation attribute of -3.4E38 (see 
output below).  How can I change these values to something more 
realistic, like zero, before displaying the image? 

- Aubrey
___________________________________________

 > x=readGDAL(file.choose())
C:\Documents and Settings\Owner\My 
Documents\GuamDEM\NED_66800217\NED_66800217.tif has GDAL driver GTiff
and has 1612 rows and 1365 columns
Closing GDAL dataset handle 0x00236838...  destroyed ... done.
 > summary(x)
Object of class SpatialGridDataFrame
Coordinates:
        min       max
x 144.58611 144.96528
y  13.22667  13.67444
Is projected: FALSE
proj4string :
[+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0]
Number of points: 2
Grid attributes:
  cellcentre.offset     cellsize cells.dim
x         144.58625 0.0002777778      1365
y          13.22681 0.0002777778      1612
Data attributes:
     band1           
 Min.   :-3.403e+38  
 1st Qu.:-3.403e+38  
 Median : 0.000e+00  
 Mean   :-1.224e+38  
 3rd Qu.: 7.907e+00  
 Max.   : 4.029e+02



From mdsumner at utas.edu.au  Sat Mar 22 06:47:51 2008
From: mdsumner at utas.edu.au (Michael Sumner)
Date: Sat, 22 Mar 2008 16:47:51 +1100
Subject: [R-sig-Geo] How to handle large negative numbers in GeoTIFF DEM?
In-Reply-To: <47E45A5C.8080301@guam.net>
References: <47E45A5C.8080301@guam.net>
Message-ID: <47E49D87.5090101@utas.edu.au>


x$band1[x$band1 <=-3.403e+38] <- NA

Use 0 instead of NA if you like, but zero might be a valid value in your 
case. You may need to be more flexible with the value used for 
comparing, so something like this should be safe

x$band1[x$band1 <= (-3.403e+37)] <- NA

HTH, Mike

Aubrey Moore wrote:
> Hi All,
>
> I am trying to display a DEM for the island of Guam.  The data were 
> downloaded in GeoTIFF format from the National Elevation Dataset 
> (http://ned.usgs.gov/).  It appears that some rectangular areas of the 
> ocean in this DEM been assigned an elevation attribute of -3.4E38 (see 
> output below).  How can I change these values to something more 
> realistic, like zero, before displaying the image? 
>
> - Aubrey
> ___________________________________________
>
>  > x=readGDAL(file.choose())
> C:\Documents and Settings\Owner\My 
> Documents\GuamDEM\NED_66800217\NED_66800217.tif has GDAL driver GTiff
> and has 1612 rows and 1365 columns
> Closing GDAL dataset handle 0x00236838...  destroyed ... done.
>  > summary(x)
> Object of class SpatialGridDataFrame
> Coordinates:
>         min       max
> x 144.58611 144.96528
> y  13.22667  13.67444
> Is projected: FALSE
> proj4string :
> [+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs +towgs84=0,0,0]
> Number of points: 2
> Grid attributes:
>   cellcentre.offset     cellsize cells.dim
> x         144.58625 0.0002777778      1365
> y          13.22681 0.0002777778      1612
> Data attributes:
>      band1           
>  Min.   :-3.403e+38  
>  1st Qu.:-3.403e+38  
>  Median : 0.000e+00  
>  Mean   :-1.224e+38  
>  3rd Qu.: 7.907e+00  
>  Max.   : 4.029e+02
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>



From regmi_pujan at hotmail.com  Sat Mar 22 10:14:02 2008
From: regmi_pujan at hotmail.com (PUJAN RAJ REGMI)
Date: Sat, 22 Mar 2008 09:14:02 +0000
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W56E2E63D205F13EBBB827084070@phx.gbl>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl>
	<2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be> 
	<BAY113-W56E2E63D205F13EBBB827084070@phx.gbl>
Message-ID: <BAY113-W5458813588B210362E016D84020@phx.gbl>


Dear all,
I think earlier i didn't clear myself. I ahve a data set of 3 colun and 14000 rows in which first and second column is X and Y coordinates and the third column is the value of samples of each coordinates points.  Now I am trying to plot semi variogram for the given sample with respect to the coordinate of ecah smaple data. The maximum distance in X direction is 2.3 km and in y direction is 1.8 km. The sample are taken 12 m interval both in x and y direction in regular grid form. I hope this time i am able to communicate.
Thanking you
Pujan
 Code:
 mol.gr <- read.table(?D:/mol.dat?)
 mol.gr[,"x"] <-mol.gr[,1]
 mol.gr[,"y"] <-mol.gr[,2]
 mol.gr[,"Green Band Reflectance"] <-mol.gr[,3]
 map<-as.geodata(mol.gr) # make a geoR object to use various ready-made R unctions
 coal.var <- variog(map, max.dist =0.9) # omnidirectional semivariogram up to half max distance
 plot(coal.var)

_________________________________________________________________
Test your Star IQ



From B.Kranstauber at student.rug.nl  Sun Mar 23 02:57:50 2008
From: B.Kranstauber at student.rug.nl (B. Kranstauber)
Date: Sun, 23 Mar 2008 02:57:50 +0100
Subject: [R-sig-Geo] Plotting points over a grid
In-Reply-To: <mailman.0.1206234810.17680.r-sig-geo@stat.math.ethz.ch>
References: <mailman.0.1206234810.17680.r-sig-geo@stat.math.ethz.ch>
Message-ID: <web-60054819@mail2.rug.nl>

Hi,

What I want to do is plot grid and plot points with Z 
values over them with spplot. I have a 
SpatialGridDataframe and a SpatialPointsDataframe. The 
closest i get  is:

> bla=list("sp.grid", a["var1.pred"])
> spplot(layer["AGOUTIS_DAY"], sp.layout=bla)

But then i get a completely black background. I was 
wondering if there is an other way to let the panel 
function sp.grid plot properly

I would have expected some syntax like the normal plot:

> spplot(a["var1.pred"])
> spplot(layer["AGOUTIS_DAY"], add=TRUE)

But that doesn't work either. What is the proper way to 
achieve this assuming it is possible

Thanks

Bart

PS I'm using the sp and gstat libraries with R 2.5.1 on 
Ubuntu linux



From Thierry.ONKELINX at inbo.be  Tue Mar 25 09:52:03 2008
From: Thierry.ONKELINX at inbo.be (ONKELINX, Thierry)
Date: Tue, 25 Mar 2008 09:52:03 +0100
Subject: [R-sig-Geo] Variogram Plot
In-Reply-To: <BAY113-W5458813588B210362E016D84020@phx.gbl>
References: <BAY113-W37A365A18D49347DF681B584060@phx.gbl><2E9C414912813E4EB981326983E0A104047DD840@inboexch.inbo.be>
	<BAY113-W56E2E63D205F13EBBB827084070@phx.gbl>
	<BAY113-W5458813588B210362E016D84020@phx.gbl>
Message-ID: <2E9C414912813E4EB981326983E0A10404874A34@inboexch.inbo.be>

Pujan,

We allready pointed out that geoR can't calculate the variogram of a
large dataset like yours. Use gstat instead to calculate the variogram.

Thierry 


------------------------------------------------------------------------
----
ir. Thierry Onkelinx
Instituut voor natuur- en bosonderzoek / Research Institute for Nature
and Forest
Cel biometrie, methodologie en kwaliteitszorg / Section biometrics,
methodology and quality assurance
Gaverstraat 4
9500 Geraardsbergen
Belgium 
tel. + 32 54/436 185
Thierry.Onkelinx at inbo.be 
www.inbo.be 

To call in the statistician after the experiment is done may be no more
than asking him to perform a post-mortem examination: he may be able to
say what the experiment died of.
~ Sir Ronald Aylmer Fisher

The plural of anecdote is not data.
~ Roger Brinner

The combination of some data and an aching desire for an answer does not
ensure that a reasonable answer can be extracted from a given body of
data.
~ John Tukey

-----Oorspronkelijk bericht-----
Van: PUJAN RAJ REGMI [mailto:regmi_pujan at hotmail.com] 
Verzonden: zaterdag 22 maart 2008 10:14
Aan: ONKELINX, Thierry; David PINAUD; r-sig-geo at stat.math.ethz.ch
Onderwerp: RE: [R-sig-Geo] Variogram Plot


Dear all,
I think earlier i didn't clear myself. I ahve a data set of 3 colun and
14000 rows in which first and second column is X and Y coordinates and
the third column is the value of samples of each coordinates points.
Now I am trying to plot semi variogram for the given sample with respect
to the coordinate of ecah smaple data. The maximum distance in X
direction is 2.3 km and in y direction is 1.8 km. The sample are taken
12 m interval both in x and y direction in regular grid form. I hope
this time i am able to communicate.
Thanking you
Pujan
 Code:
 mol.gr <- read.table("D:/mol.dat")
 mol.gr[,"x"] <-mol.gr[,1]
 mol.gr[,"y"] <-mol.gr[,2]
 mol.gr[,"Green Band Reflectance"] <-mol.gr[,3]
 map<-as.geodata(mol.gr) # make a geoR object to use various ready-made
R unctions
 coal.var <- variog(map, max.dist =0.9) # omnidirectional semivariogram
up to half max distance
 plot(coal.var)

_________________________________________________________________
Test your Star IQ
http://club.live.com/red_carpet_reveal.aspx?icid=redcarpet_HMTAGMAR



From Oscar.Breugelmans at rivm.nl  Tue Mar 25 10:16:58 2008
From: Oscar.Breugelmans at rivm.nl (Oscar Breugelmans)
Date: Tue, 25 Mar 2008 10:16:58 +0100
Subject: [R-sig-Geo] Errors while creating a neighbourhood matrix using
	poly2nb
Message-ID: <OFB279AE94.64903A1E-ONC1257417.00314AEE-C1257417.0032FDBD@notesmail.rivm.nl>

Hi everybody,

I am trying to create a neigbourhood matrix based on a shapefile of postal
code areas that was created in ArcMap. Normally this works fine using the
'readShapePoly' and 'poly2nb' commands. However, the postal code areas
change over the years or are made up of 2 or mory polygons because they are
situated on both sides of a large waterway. I correct these difficulties by
merging postal code areas in ArcMap, so that I end up with a shapefile in
which each postal code area is represented by just 1 polygon with an unique
area ID.
I again import the updated shapefile in R using readShapePoly. But then the
problems start. When I create a neighbourhood matrix using poly2nb, the
areas that have been merged behave very strange: they don't recognize their
neighbours. Sometimes they recognize none, sometimes a few.
When I couldn't find a solution I tried to create the nb using GeoDa. This
gave exactly the same problems. Then I turned to GeoBugs and - surprise -
the nb was created without any problems.

Does anyone recognize these problems or has a solution for me?

Thanks,
Oscar
____________________________________________________________________________

DISCLAIMER:  http://www.rivm.nl/disclaimer.htm\ ...{{dropped:2}}



From Roger.Bivand at nhh.no  Tue Mar 25 10:29:38 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 25 Mar 2008 10:29:38 +0100 (CET)
Subject: [R-sig-Geo] Errors while creating a neighbourhood matrix using
 poly2nb
In-Reply-To: <OFB279AE94.64903A1E-ONC1257417.00314AEE-C1257417.0032FDBD@notesmail.rivm.nl>
References: <OFB279AE94.64903A1E-ONC1257417.00314AEE-C1257417.0032FDBD@notesmail.rivm.nl>
Message-ID: <Pine.LNX.4.64.0803251026030.3147@reclus.nhh.no>

On Tue, 25 Mar 2008, Oscar Breugelmans wrote:

> Hi everybody,
>
> I am trying to create a neigbourhood matrix based on a shapefile of postal
> code areas that was created in ArcMap. Normally this works fine using the
> 'readShapePoly' and 'poly2nb' commands. However, the postal code areas
> change over the years or are made up of 2 or mory polygons because they are
> situated on both sides of a large waterway. I correct these difficulties by
> merging postal code areas in ArcMap, so that I end up with a shapefile in
> which each postal code area is represented by just 1 polygon with an unique
> area ID.
> I again import the updated shapefile in R using readShapePoly. But then the
> problems start. When I create a neighbourhood matrix using poly2nb, the
> areas that have been merged behave very strange: they don't recognize their
> neighbours. Sometimes they recognize none, sometimes a few.
> When I couldn't find a solution I tried to create the nb using GeoDa. This
> gave exactly the same problems. Then I turned to GeoBugs and - surprise -
> the nb was created without any problems.

Almost certainly a topologically unclean set of boundaries. If you do the 
merging in R using unionSpatialPolygons() in maptools, the output 
SpatialPolygons ought to be OK. Use the post codes as the ID union key, 
and they will be used beith as the Polygons objects IDs, and the region.id 
values of the neighbour list. You could also try increasing the snap 
distance in poly2nb(), as this may relieve problems of remaining slivers.

Hope this helps,

Roger

>
> Does anyone recognize these problems or has a solution for me?
>
> Thanks,
> Oscar
> ____________________________________________________________________________
>
> DISCLAIMER:  http://www.rivm.nl/disclaimer.htm\ ...{{dropped:2}}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Oscar.Breugelmans at rivm.nl  Tue Mar 25 10:44:27 2008
From: Oscar.Breugelmans at rivm.nl (Oscar Breugelmans)
Date: Tue, 25 Mar 2008 10:44:27 +0100
Subject: [R-sig-Geo] Errors while creating a neighbourhood matrix using
	poly2nb
In-Reply-To: <Pine.LNX.4.64.0803251026030.3147@reclus.nhh.no>
Message-ID: <OFB9D2693D.23EE9D33-ONC1257417.00353986-C1257417.003581EF@notesmail.rivm.nl>

Thanks Roger,
Changing the snap distance already did the trick. I didn't know Arcmap was
so inaccurate!
Oscar



                                                                           
             Roger Bivand                                                  
             <Roger.Bivand at nhh                                             
             .no>                                                       To 
             Sent by:                  Oscar Breugelmans                   
             r-sig-geo-bounces         <Oscar.Breugelmans at rivm.nl>         
             @stat.math.ethz.c                                          cc 
             h                         r-sig-geo at stat.math.ethz.ch         
                                                                   Subject 
                                       Re: [R-sig-Geo] Errors while        
             25-03-2008 10:29          creating a neighbourhood matrix     
                                       using poly2nb                       
                                                                           
             Please respond to                                             
             Roger.Bivand at nhh.                                             
                    no                                                     
                                                                           
                                                                           




On Tue, 25 Mar 2008, Oscar Breugelmans wrote:

> Hi everybody,
>
> I am trying to create a neigbourhood matrix based on a shapefile of
postal
> code areas that was created in ArcMap. Normally this works fine using the
> 'readShapePoly' and 'poly2nb' commands. However, the postal code areas
> change over the years or are made up of 2 or mory polygons because they
are
> situated on both sides of a large waterway. I correct these difficulties
by
> merging postal code areas in ArcMap, so that I end up with a shapefile in
> which each postal code area is represented by just 1 polygon with an
unique
> area ID.
> I again import the updated shapefile in R using readShapePoly. But then
the
> problems start. When I create a neighbourhood matrix using poly2nb, the
> areas that have been merged behave very strange: they don't recognize
their
> neighbours. Sometimes they recognize none, sometimes a few.
> When I couldn't find a solution I tried to create the nb using GeoDa.
This
> gave exactly the same problems. Then I turned to GeoBugs and - surprise -
> the nb was created without any problems.

Almost certainly a topologically unclean set of boundaries. If you do the
merging in R using unionSpatialPolygons() in maptools, the output
SpatialPolygons ought to be OK. Use the post codes as the ID union key,
and they will be used beith as the Polygons objects IDs, and the region.id
values of the neighbour list. You could also try increasing the snap
distance in poly2nb(), as this may relieve problems of remaining slivers.

Hope this helps,

Roger



From Roger.Bivand at nhh.no  Tue Mar 25 11:08:43 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 25 Mar 2008 11:08:43 +0100 (CET)
Subject: [R-sig-Geo] Errors while creating a neighbourhood matrix using
 poly2nb
In-Reply-To: <OFB9D2693D.23EE9D33-ONC1257417.00353986-C1257417.003581EF@notesmail.rivm.nl>
References: <OFB9D2693D.23EE9D33-ONC1257417.00353986-C1257417.003581EF@notesmail.rivm.nl>
Message-ID: <Pine.LNX.4.64.0803251102130.3147@reclus.nhh.no>

On Tue, 25 Mar 2008, Oscar Breugelmans wrote:

> Thanks Roger,
> Changing the snap distance already did the trick. I didn't know Arcmap was
> so inaccurate!

Well, maybe it is assuming that centimetres don't matter at your scale? 
Not so unreasonable, but hard for computers to grasp? "Vector is correcter 
..." only for an assumed correctness? Something like the thickness of my 
pen point?

Roger



> Oscar
>
>
>
>
>             Roger Bivand
>             <Roger.Bivand at nhh
>             .no>                                                       To
>             Sent by:                  Oscar Breugelmans
>             r-sig-geo-bounces         <Oscar.Breugelmans at rivm.nl>
>             @stat.math.ethz.c                                          cc
>             h                         r-sig-geo at stat.math.ethz.ch
>                                                                   Subject
>                                       Re: [R-sig-Geo] Errors while
>             25-03-2008 10:29          creating a neighbourhood matrix
>                                       using poly2nb
>
>             Please respond to
>             Roger.Bivand at nhh.
>                    no
>
>
>
>
>
>
> On Tue, 25 Mar 2008, Oscar Breugelmans wrote:
>
>> Hi everybody,
>>
>> I am trying to create a neigbourhood matrix based on a shapefile of
> postal
>> code areas that was created in ArcMap. Normally this works fine using the
>> 'readShapePoly' and 'poly2nb' commands. However, the postal code areas
>> change over the years or are made up of 2 or mory polygons because they
> are
>> situated on both sides of a large waterway. I correct these difficulties
> by
>> merging postal code areas in ArcMap, so that I end up with a shapefile in
>> which each postal code area is represented by just 1 polygon with an
> unique
>> area ID.
>> I again import the updated shapefile in R using readShapePoly. But then
> the
>> problems start. When I create a neighbourhood matrix using poly2nb, the
>> areas that have been merged behave very strange: they don't recognize
> their
>> neighbours. Sometimes they recognize none, sometimes a few.
>> When I couldn't find a solution I tried to create the nb using GeoDa.
> This
>> gave exactly the same problems. Then I turned to GeoBugs and - surprise -
>> the nb was created without any problems.
>
> Almost certainly a topologically unclean set of boundaries. If you do the
> merging in R using unionSpatialPolygons() in maptools, the output
> SpatialPolygons ought to be OK. Use the post codes as the ID union key,
> and they will be used beith as the Polygons objects IDs, and the region.id
> values of the neighbour list. You could also try increasing the snap
> distance in poly2nb(), as this may relieve problems of remaining slivers.
>
> Hope this helps,
>
> Roger
>
>
>
>
>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From massistef at libero.it  Tue Mar 25 20:25:40 2008
From: massistef at libero.it (massimo ventrucci)
Date: Tue, 25 Mar 2008 20:25:40 +0100
Subject: [R-sig-Geo] about union.owin method in spatstat and
	self-intersection
Message-ID: <JYAWMS$43DB774239745FAB56BC738D405BA56D@libero.it>

Hello,
I have a couple of question regarding object owin in spatstat package.
I am going to simulating a spatial point process over a collection of contiguous regions (e.g. regions with some common borders). Firstly I am going to simulate a poisson process conditionally to a fixed number of events (runifpoint) but later I could need to simulate process that deviate from CSR; my basic aim is getting the number of points in each regions.
I read that in spatstat it is not possible creating owin objects where polygons share borders. I wonder if it could be reasonable creating several owin objects (one for each region) and simulating a spatial point pattern over the union of them. If so, I guess there will be no problem about the homogeneous case but my first point is about the inhomogeneous one: 
might be possible simulate an inhomogeneous poisson point process in such as union.owin window?
The second and final question regards a problem about self-intersection. When I try to create an owin objects lot of my region (in this case the number 6) meet the following problem:
w6 <- owin(poly = emr.poly[[6]])
Polygon  is self-intersecting
Error in owin(poly = emr.poly[[6]]) : 
  Polygon data contain self-intersection

Bear in mind that I do not have any shape file of my collection of regions, just x-y coordinates obtained by exporting the map from winbugs by using "export Splus".
Thus for many regions I can not obtain an owin object because of self-intersection, and as a result I can not obtain the union of owin objects I am interested in. I have to say I am not interested in a fine specification of borders, so I wonder if there is an easy way to eliminate point coordinates responsible for self-intersection. Do you have any suggestion please?

Thank you very much in advance 
Massimo



From famuvie at alumni.uv.es  Wed Mar 26 10:42:42 2008
From: famuvie at alumni.uv.es (=?ISO-8859-1?Q?Facundo_Mu=F1oz?=)
Date: Wed, 26 Mar 2008 10:42:42 +0100
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
In-Reply-To: <p06230903c4085fc03705@[128.115.92.33]>
References: <47E2A761.1070703@alumni.uv.es>
	<p06230903c4085fc03705@[128.115.92.33]>
Message-ID: <47EA1A92.3060501@alumni.uv.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080326/c3854a70/attachment.pl>

From famuvie at alumni.uv.es  Wed Mar 26 10:43:36 2008
From: famuvie at alumni.uv.es (=?ISO-8859-1?Q?Facundo_Mu=F1oz?=)
Date: Wed, 26 Mar 2008 10:43:36 +0100
Subject: [R-sig-Geo] regression kriging with non-euclidean distances
In-Reply-To: <bb61ce440803201333i164dadccga7cee385a05252b6@mail.gmail.com>
References: <47E2A761.1070703@alumni.uv.es>	<p06230903c4085fc03705@128.115.92.33>	<bb61ce440803201322r52e91d1ek4eac693a8c6ef23c@mail.gmail.com>
	<bb61ce440803201333i164dadccga7cee385a05252b6@mail.gmail.com>
Message-ID: <47EA1AC8.6060406@alumni.uv.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080326/ea1431d3/attachment.pl>

From hi_ono2001 at ybb.ne.jp  Wed Mar 26 14:06:58 2008
From: hi_ono2001 at ybb.ne.jp (Hisaji ONO)
Date: Wed, 26 Mar 2008 22:06:58 +0900 (JST)
Subject: [R-sig-Geo] Geographically Weighted Discriminant Analysis
Message-ID: <20080326130658.66829.qmail@web10713.mail.bbt.yahoo.co.jp>

Hello.

 I found following article.

Geographically Weighted Discriminant Analysis 
Chris Brunsdon, Stewart Fotheringham, Martin
Charlton(2007):
Geographical Analysis, Volume 39, Issue 4, Page 376-396,
Oct 2007
http://www.blackwell-synergy.com/doi/abs/10.1111/j.1538-4632.2005.00633.x

 Can ggwr function in spgwr deal with this method?


 Regards.



From Roger.Bivand at nhh.no  Wed Mar 26 17:05:13 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 26 Mar 2008 17:05:13 +0100 (CET)
Subject: [R-sig-Geo] Geographically Weighted Discriminant Analysis
In-Reply-To: <20080326130658.66829.qmail@web10713.mail.bbt.yahoo.co.jp>
References: <20080326130658.66829.qmail@web10713.mail.bbt.yahoo.co.jp>
Message-ID: <Pine.LNX.4.64.0803261650570.11431@reclus.nhh.no>

On Wed, 26 Mar 2008, Hisaji ONO wrote:

> Hello.
>
> I found following article.
>
> Geographically Weighted Discriminant Analysis
> Chris Brunsdon, Stewart Fotheringham, Martin
> Charlton(2007):
> Geographical Analysis, Volume 39, Issue 4, Page 376-396,
> Oct 2007
> http://www.blackwell-synergy.com/doi/abs/10.1111/j.1538-4632.2005.00633.x
>
> Can ggwr function in spgwr deal with this method?

Hi,

Not as such, no, because it uses glm(), and one would need a multinomial 
response. You could look at how multinom() in the nnet package could be 
adapted, it would easier than lda() or qda() in MASS, which do not take a 
weights= argument.

Hope this helps,

Roger

>
>
> Regards.
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From giohappy at gmail.com  Wed Mar 26 20:01:31 2008
From: giohappy at gmail.com (G. Allegri)
Date: Wed, 26 Mar 2008 20:01:31 +0100
Subject: [R-sig-Geo] case histories and scientific literature
Message-ID: <e12429640803261201m4510ef90w8010348174ed1543@mail.gmail.com>

Hello everyone.
I'm writing a chapter of my thesis about open source software for
spatial analysis. I've looked for documented case histories and
scientific literature about the use of R in the fields of lanscape
analysis, soil science, environmental analysis, geology, etc.
Yet I haven't found anything of significance.
Does anyone can indicate me some examples?

Thanks,
Giovanni



From Friderike.Oehler at fao.org  Thu Mar 27 10:54:41 2008
From: Friderike.Oehler at fao.org (Friderike Oehler)
Date: Thu, 27 Mar 2008 09:54:41 +0000 (UTC)
Subject: [R-sig-Geo] Overlaying spplots
Message-ID: <loom.20080327T095211-6@post.gmane.org>

Dear R Users,

I am struggeling to plot the z-column-values of a SpatialPointsDataFrame over a
polygon shapefile map SpatialPolygonsDataFrame) representing country borders. I
would like to use spplot in order to keep the scales. I followed the path that I
found in the help archive (http://thread.gmane.org/gmane.comp.lang.r.geo/2063).
This works fine to superimpose my points over the countries, however it does not
allow the z-values of the points to be shown.

The ADD=TRUE option does not seem to work for spplot. (Right or wrong?)

I also tried with levelplots and panel-functions, without success (admittedly I
am not an expert using these functions.) Without success were also my tries
using "overlay".

Any help would be much appreciated.
Many thanks in advance,
Friderike

# This is the shapefile:
EA=readShapePoly('C:/data/grassdata/EastAfrica/EastAfricaAdmin0',
proj4string=CRS("+proj=longlat +datum=WGS84"), force_ring=TRUE)
names(EA)
 [1] "CAT"        "AREA"       "PERIMETER"  "G2006_2_"   "G2006_2_ID"
"ADM2_CODE"  "ADM0_CODE"  "ADM0_NAME"  "ADM1_NAME"  "ADM1_CODE"  "ADM2_NAME" 
[12] "LAST_UPDAT" "CONTINENT"  "REGION"   

# This shows the shapefile
spplot(EA, zcol='ADM0_CODE', scales=list(draw=TRUE), xlim=c(30,52),
ylim=c(-10,18), col.regions='transparent', colorkey=FALSE)

# This is the SpatialPointsDataFrame:
 str(notinv)
Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
  ..@ data       :'data.frame': 1209 obs. of  1 variable:
  .. ..$ FQ: int [1:1209] 2 2 4 1 1 1 2 1 1 3 ...
  ..@ coords.nrs : int [1:2] 1 2
  ..@ coords     : num [1:1209, 1:2] 35.5 36.5 37.5 35.5 36.5 37.5 38.5 40.5
36.5 37.5 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] "LON" "LAT"
  ..@ bbox       : num [1:2, 1:2] -17.5 -3.5 92.5 38.5
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:2] "LON" "LAT"
  .. .. ..$ : chr [1:2] "min" "max"
  ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
  .. .. ..@ projargs: chr NA

 # And that's what it looks like:
spplot(notinv, zcol='FQ', cuts=seq(1,max(Knotinvfreq$FQ),5), xlim=c(30,52),
ylim=c(-10,18), key.space='bottom', scales=list(draw=TRUE),
col.regions=terrain.colors(64,alpha=1))



From edzer.pebesma at uni-muenster.de  Thu Mar 27 11:05:52 2008
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 27 Mar 2008 11:05:52 +0100
Subject: [R-sig-Geo] Overlaying spplots
In-Reply-To: <loom.20080327T095211-6@post.gmane.org>
References: <loom.20080327T095211-6@post.gmane.org>
Message-ID: <47EB7180.8020301@uni-muenster.de>

Dear Friderike, please try adding the argument

sp.layout = list("sp.polygons", EA)

to the final spplot call.
--
Edzer

Friderike Oehler wrote:
> Dear R Users,
>
> I am struggeling to plot the z-column-values of a SpatialPointsDataFrame over a
> polygon shapefile map SpatialPolygonsDataFrame) representing country borders. I
> would like to use spplot in order to keep the scales. I followed the path that I
> found in the help archive (http://thread.gmane.org/gmane.comp.lang.r.geo/2063).
> This works fine to superimpose my points over the countries, however it does not
> allow the z-values of the points to be shown.
>
> The ADD=TRUE option does not seem to work for spplot. (Right or wrong?)
>
> I also tried with levelplots and panel-functions, without success (admittedly I
> am not an expert using these functions.) Without success were also my tries
> using "overlay".
>
> Any help would be much appreciated.
> Many thanks in advance,
> Friderike
>
> # This is the shapefile:
> EA=readShapePoly('C:/data/grassdata/EastAfrica/EastAfricaAdmin0',
> proj4string=CRS("+proj=longlat +datum=WGS84"), force_ring=TRUE)
> names(EA)
>  [1] "CAT"        "AREA"       "PERIMETER"  "G2006_2_"   "G2006_2_ID"
> "ADM2_CODE"  "ADM0_CODE"  "ADM0_NAME"  "ADM1_NAME"  "ADM1_CODE"  "ADM2_NAME" 
> [12] "LAST_UPDAT" "CONTINENT"  "REGION"   
>
> # This shows the shapefile
> spplot(EA, zcol='ADM0_CODE', scales=list(draw=TRUE), xlim=c(30,52),
> ylim=c(-10,18), col.regions='transparent', colorkey=FALSE)
>
> # This is the SpatialPointsDataFrame:
>  str(notinv)
> Formal class 'SpatialPointsDataFrame' [package "sp"] with 5 slots
>   ..@ data       :'data.frame': 1209 obs. of  1 variable:
>   .. ..$ FQ: int [1:1209] 2 2 4 1 1 1 2 1 1 3 ...
>   ..@ coords.nrs : int [1:2] 1 2
>   ..@ coords     : num [1:1209, 1:2] 35.5 36.5 37.5 35.5 36.5 37.5 38.5 40.5
> 36.5 37.5 ...
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : NULL
>   .. .. ..$ : chr [1:2] "LON" "LAT"
>   ..@ bbox       : num [1:2, 1:2] -17.5 -3.5 92.5 38.5
>   .. ..- attr(*, "dimnames")=List of 2
>   .. .. ..$ : chr [1:2] "LON" "LAT"
>   .. .. ..$ : chr [1:2] "min" "max"
>   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slots
>   .. .. ..@ projargs: chr NA
>
>  # And that's what it looks like:
> spplot(notinv, zcol='FQ', cuts=seq(1,max(Knotinvfreq$FQ),5), xlim=c(30,52),
> ylim=c(-10,18), key.space='bottom', scales=list(draw=TRUE),
> col.regions=terrain.colors(64,alpha=1))
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



From Oscar.Breugelmans at rivm.nl  Thu Mar 27 17:23:21 2008
From: Oscar.Breugelmans at rivm.nl (Oscar Breugelmans)
Date: Thu, 27 Mar 2008 17:23:21 +0100
Subject: [R-sig-Geo] How to check a large neighbourhood matrix?
Message-ID: <OFA299DDB2.CC190EBD-ONC1257419.0058B074-C1257419.005A072F@notesmail.rivm.nl>

Dear all,

I am working on a neighbourhood matrix of the postal code areas in the
Netherlands. Reading the shapefile and producing the matrix is no problem
(after some help from Roger), but I am not completely confident that all
neighbours are recognized because there are a few polygon boundaries that
are topologically unclean. I have checked the shapefile as closely as
possible, but with 4000 postal code areas this is a hell of a job.
Plotting the matrix in R (using plot.nb) is also not an option because with
so many areas the individual connections are no longer visible. Thus, I
would like to zoom in on parts of the graph to check whether all neighbours
are defined correctly. I searched the web for methods to zoom in and out of
a graph in R, but couldn't find anything.
Does anyone know if there are ways to do this?

Oscar
____________________________________________________________________________

DISCLAIMER:  http://www.rivm.nl/disclaimer.htm\ ...{{dropped:2}}



From yud at mail.montclair.edu  Thu Mar 27 17:43:17 2008
From: yud at mail.montclair.edu (Danlin Yu)
Date: Thu, 27 Mar 2008 12:43:17 -0400
Subject: [R-sig-Geo] How to check a large neighbourhood matrix?
In-Reply-To: <OFA299DDB2.CC190EBD-ONC1257419.0058B074-C1257419.005A072F@notesmail.rivm.nl>
References: <OFA299DDB2.CC190EBD-ONC1257419.0058B074-C1257419.005A072F@notesmail.rivm.nl>
Message-ID: <47EBCEA5.8030707@mail.montclair.edu>

Oscar:

If you produced the nb list in R, you can always summarize the nb list 
to see whether there are units that don't have neighbors.

For instance:
#loading spdep
library(spdep)

#you have read a shapefile of postal code areas:

post<-read.shape("../yourshapefile.shp")

#since it is a polygon shapefile, a Map2poly and poly2nb function shall 
do the trick (Roger will have better ideas than my naive ones)

post.nb<-poly2nb(Map2poly(post))

#then you summarize the nb list:

summary(post.nb)

The summary command will give you the characteristics of the neighbor 
list object, including Number of regions, Number of nonzero links, 
Percentage nonzero weights, Average number of links, regions that have 
no links (which shall give you the idea whether or not some postal code 
areas are connected) and the most and least connected regions

Hope this helps.

Regards,
Dr. Danlin Yu

Oscar Breugelmans wrote:
> Dear all,
>
> I am working on a neighbourhood matrix of the postal code areas in the
> Netherlands. Reading the shapefile and producing the matrix is no problem
> (after some help from Roger), but I am not completely confident that all
> neighbours are recognized because there are a few polygon boundaries that
> are topologically unclean. I have checked the shapefile as closely as
> possible, but with 4000 postal code areas this is a hell of a job.
> Plotting the matrix in R (using plot.nb) is also not an option because with
> so many areas the individual connections are no longer visible. Thus, I
> would like to zoom in on parts of the graph to check whether all neighbours
> are defined correctly. I searched the web for methods to zoom in and out of
> a graph in R, but couldn't find anything.
> Does anyone know if there are ways to do this?
>
> Oscar
> ____________________________________________________________________________
>
> DISCLAIMER:  http://www.rivm.nl/disclaimer.htm\ ...{{dropped:2}}
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>   

-- 
___________________________________________
Danlin Yu, Ph.D.
Assistant Professor
Department of Earth & Environmental Studies
Montclair State University
Montclair, NJ, 07043
Tel: 973-655-4313
Fax: 973-655-4072
email: yud at mail.montclair.edu
webpage: csam.montclair.edu/~yu



From Roger.Bivand at nhh.no  Thu Mar 27 20:37:53 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 27 Mar 2008 20:37:53 +0100 (CET)
Subject: [R-sig-Geo] How to check a large neighbourhood matrix?
In-Reply-To: <47EBCEA5.8030707@mail.montclair.edu>
References: <OFA299DDB2.CC190EBD-ONC1257419.0058B074-C1257419.005A072F@notesmail.rivm.nl>
	<47EBCEA5.8030707@mail.montclair.edu>
Message-ID: <Pine.LNX.4.64.0803272030420.13762@reclus.nhh.no>

On Thu, 27 Mar 2008, Danlin Yu wrote:

> Oscar:
>
> If you produced the nb list in R, you can always summarize the nb list
> to see whether there are units that don't have neighbors.
>
> For instance:
> #loading spdep
> library(spdep)
>
> #you have read a shapefile of postal code areas:
>
> post<-read.shape("../yourshapefile.shp")
>
> #since it is a polygon shapefile, a Map2poly and poly2nb function shall
> do the trick (Roger will have better ideas than my naive ones)
>
> post.nb<-poly2nb(Map2poly(post))

I think that Oscar had got this far using the prefered sp object:

SPDF <- readShapePoly()

nb <- poly2nb(SPDF)

but had needed to use the snap= argument to poly2nb() to overcome slivers 
in his polygons.

>
> #then you summarize the nb list:
>
> summary(post.nb)
>

This helps, because it says which have no neighbours. It will indicate how 
to "zoom" in on the plot for the locations of the polygons. To actually 
"zoom", use xlim= and ylim= in the plot method for nb objects.

If you want real control, consider writeOGR(SPDF, ..., driver="KML") in 
the rgdal package, and equivalently writeOGR() of the 
SpatialLinesDataFrame output by nb2lines(), and zoom to your satisfaction 
in GE using KML files.

Roger

> The summary command will give you the characteristics of the neighbor
> list object, including Number of regions, Number of nonzero links,
> Percentage nonzero weights, Average number of links, regions that have
> no links (which shall give you the idea whether or not some postal code
> areas are connected) and the most and least connected regions
>
> Hope this helps.
>
> Regards,
> Dr. Danlin Yu
>
> Oscar Breugelmans wrote:
>> Dear all,
>>
>> I am working on a neighbourhood matrix of the postal code areas in the
>> Netherlands. Reading the shapefile and producing the matrix is no problem
>> (after some help from Roger), but I am not completely confident that all
>> neighbours are recognized because there are a few polygon boundaries that
>> are topologically unclean. I have checked the shapefile as closely as
>> possible, but with 4000 postal code areas this is a hell of a job.
>> Plotting the matrix in R (using plot.nb) is also not an option because with
>> so many areas the individual connections are no longer visible. Thus, I
>> would like to zoom in on parts of the graph to check whether all neighbours
>> are defined correctly. I searched the web for methods to zoom in and out of
>> a graph in R, but couldn't find anything.
>> Does anyone know if there are ways to do this?
>>
>> Oscar
>> ____________________________________________________________________________
>>
>> DISCLAIMER:  http://www.rivm.nl/disclaimer.htm\ ...{{dropped:2}}
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at stat.math.ethz.ch
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From macq at llnl.gov  Fri Mar 28 01:16:22 2008
From: macq at llnl.gov (Don MacQueen)
Date: Thu, 27 Mar 2008 17:16:22 -0700
Subject: [R-sig-Geo] Recombining polygon shapefiles using maptools
Message-ID: <p06230912c411df0e3348@[128.115.92.33]>

I have six polygon shapefiles. Two of them represent my area of 
interest (call them A and B), and the other four (call them C, D, E, 
F) represent holes in the first two.

I would like to create a single object that can be passed to 
spsample() for spatial sampling, such that spsample will place 
samples inside A and B, but not in C, D, E, or F.

I know how to do this by what might be called "brute force" (see below).

The real question is, are there ways to do this more effectively 
using higher level functions?

If there were, it might make for easier to understand scripts, for 
example, or be easier to repeat using different sets of shapefiles 
(the script below doesn't easily generalize, especially if any of the 
shapefiles consist of multiple polygons).

Thanks
-Don



Here is my solution; I've run it and it works. I apologize for not 
being able to supply the shapefiles and thus a reproducible example.

Each shapefile consists of a single polygon, and I don't need any of 
the attribute information from the shapefiles.
This simplifies things, quite a lot, I think.

Extract the single polygon from each, into six separate two column matrices.

# A
vz1 <- readShapePoly('shapefiles-zones/Zone-TK')
tmp <- as(vz1 , 'SpatialPolygons')
tmp <- tmp at polygons[[1]]   ## since I know it has only one polygon
poly1 <- tmp at Polygons[[1]]@coords  ## a matrix of coordinates

## repeat for additional shapefiles 2 through 6


Combine the polygons following the example in ?overlay

## this example uses only the first three of my polygons
tmp <- Polygons(
                 list(Polygon(poly1,hole=FALSE),  # A
                       Polygon(poly2,hole=FALSE),  # B
                       Polygon(poly3,hole=TRUE)),  # C
                 ID=1)
sr <- SpatialPolygons(list(tmp))


plot(sr)
tmp <- spsample(sr, type='random', n=500)
points(tmp)  ## looks good!


-- 
--------------------------------------
Don MacQueen
Environmental Protection Department
Lawrence Livermore National Laboratory
Livermore, CA, USA
925-423-1062



From Oscar.Breugelmans at rivm.nl  Fri Mar 28 09:02:34 2008
From: Oscar.Breugelmans at rivm.nl (Oscar Breugelmans)
Date: Fri, 28 Mar 2008 09:02:34 +0100
Subject: [R-sig-Geo] How to check a large neighbourhood matrix?
In-Reply-To: <Pine.LNX.4.64.0803272030420.13762@reclus.nhh.no>
Message-ID: <OF751A012B.D38CB78D-ONC125741A.00293C71-C125741A.002C2E11@notesmail.rivm.nl>

Roger and Danlin:

Thanks for your help on this. This is the code I used to create and plot
the nb:

pc4.02=readShapePoly("..../pc4_2002/pc4_gebieden_2002",IDvar="PC4NR")
nb.pc4.02=poly2nb(pc4.02,snap=0.01)
coords=coordinates(pc4.02)
plot(pc4.02)
plot.nb(nb.pc4.02,coords,add=T)
summary(nb.pc4.02)

>From Roger's comments I understand that there is no easy way to zoom in on
this plot. I wanted to specifically zoom in on the plot.nb() because it
shows the connections between the neighbours. I was able to check all the
areas with only 1 neighbour, but was afraid that there would be areas that
had only some of its neighbours assigned correctly. I will try to use xlim=
en ylim= to zoom in on the plot. I think writeOGR() is not really an option
because it will not show the lines connecting the neighbours that plot.nb()
so nicely does.

Oscar




On Thu, 27 Mar 2008, Danlin Yu wrote:

> Oscar:
>
> If you produced the nb list in R, you can always summarize the nb list
> to see whether there are units that don't have neighbors.
>
> For instance:
> #loading spdep
> library(spdep)
>
> #you have read a shapefile of postal code areas:
>
> post<-read.shape("../yourshapefile.shp")
>
> #since it is a polygon shapefile, a Map2poly and poly2nb function shall
> do the trick (Roger will have better ideas than my naive ones)
>
> post.nb<-poly2nb(Map2poly(post))

I think that Oscar had got this far using the prefered sp object:

SPDF <- readShapePoly()

nb <- poly2nb(SPDF)

but had needed to use the snap= argument to poly2nb() to overcome slivers
in his polygons.

>
> #then you summarize the nb list:
>
> summary(post.nb)
>

This helps, because it says which have no neighbours. It will indicate how
to "zoom" in on the plot for the locations of the polygons. To actually
"zoom", use xlim= and ylim= in the plot method for nb objects.

If you want real control, consider writeOGR(SPDF, ..., driver="KML") in
the rgdal package, and equivalently writeOGR() of the
SpatialLinesDataFrame output by nb2lines(), and zoom to your satisfaction
in GE using KML files.

Roger

> The summary command will give you the characteristics of the neighbor
> list object, including Number of regions, Number of nonzero links,
> Percentage nonzero weights, Average number of links, regions that have
> no links (which shall give you the idea whether or not some postal code
> areas are connected) and the most and least connected regions
>
> Hope this helps.
>
> Regards,
> Dr. Danlin Yu



From Roger.Bivand at nhh.no  Fri Mar 28 09:32:45 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Mar 2008 09:32:45 +0100 (CET)
Subject: [R-sig-Geo] How to check a large neighbourhood matrix?
In-Reply-To: <OF751A012B.D38CB78D-ONC125741A.00293C71-C125741A.002C2E11@notesmail.rivm.nl>
References: <OF751A012B.D38CB78D-ONC125741A.00293C71-C125741A.002C2E11@notesmail.rivm.nl>
Message-ID: <Pine.LNX.4.64.0803280930130.18201@reclus.nhh.no>

On Fri, 28 Mar 2008, Oscar Breugelmans wrote:

> Roger and Danlin:
>
> Thanks for your help on this. This is the code I used to create and plot
> the nb:
>
> pc4.02=readShapePoly("..../pc4_2002/pc4_gebieden_2002",IDvar="PC4NR")
> nb.pc4.02=poly2nb(pc4.02,snap=0.01)
> coords=coordinates(pc4.02)
> plot(pc4.02)
> plot.nb(nb.pc4.02,coords,add=T)
> summary(nb.pc4.02)
>
> From Roger's comments I understand that there is no easy way to zoom in on
> this plot. I wanted to specifically zoom in on the plot.nb() because it
> shows the connections between the neighbours. I was able to check all the
> areas with only 1 neighbour, but was afraid that there would be areas that
> had only some of its neighbours assigned correctly. I will try to use xlim=
> en ylim= to zoom in on the plot. I think writeOGR() is not really an option
> because it will not show the lines connecting the neighbours that plot.nb()
> so nicely does.

?nb2lines

This makes a SpatialLinesDataFrame, showing the lines connecting the 
neighbours. However, GE also has the drawback of only being in projected 
coordinates. I suggest using locator(2) at the SW and NE corners of the 
area of interest, feeding these forward to plot.nb() as xlim= and ylim=. 
Tedious, but it will get you there.

Roger

>
> Oscar
>
>
>
>
> On Thu, 27 Mar 2008, Danlin Yu wrote:
>
>> Oscar:
>>
>> If you produced the nb list in R, you can always summarize the nb list
>> to see whether there are units that don't have neighbors.
>>
>> For instance:
>> #loading spdep
>> library(spdep)
>>
>> #you have read a shapefile of postal code areas:
>>
>> post<-read.shape("../yourshapefile.shp")
>>
>> #since it is a polygon shapefile, a Map2poly and poly2nb function shall
>> do the trick (Roger will have better ideas than my naive ones)
>>
>> post.nb<-poly2nb(Map2poly(post))
>
> I think that Oscar had got this far using the prefered sp object:
>
> SPDF <- readShapePoly()
>
> nb <- poly2nb(SPDF)
>
> but had needed to use the snap= argument to poly2nb() to overcome slivers
> in his polygons.
>
>>
>> #then you summarize the nb list:
>>
>> summary(post.nb)
>>
>
> This helps, because it says which have no neighbours. It will indicate how
> to "zoom" in on the plot for the locations of the polygons. To actually
> "zoom", use xlim= and ylim= in the plot method for nb objects.
>
> If you want real control, consider writeOGR(SPDF, ..., driver="KML") in
> the rgdal package, and equivalently writeOGR() of the
> SpatialLinesDataFrame output by nb2lines(), and zoom to your satisfaction
> in GE using KML files.
>
> Roger
>
>> The summary command will give you the characteristics of the neighbor
>> list object, including Number of regions, Number of nonzero links,
>> Percentage nonzero weights, Average number of links, regions that have
>> no links (which shall give you the idea whether or not some postal code
>> areas are connected) and the most and least connected regions
>>
>> Hope this helps.
>>
>> Regards,
>> Dr. Danlin Yu
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at gmail.com  Fri Mar 28 20:22:08 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Fri, 28 Mar 2008 14:22:08 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
Message-ID: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>

I'm trying to see if I can track down a bug in X windows that causes
it to crash when plotting (I believe) very small filled polygons (or
it may have to do with large numbers of polygons). I first noticed
this running QGIS. Loading a PostGIS layer with ~3K polygons will
cause X to abort. I can load the layer if I have already zoomed into a
smaller region of the coverage. Once I try to zoom out to the full
extent, X dies.

So I tried loading the polygons into "sp" using "readOGR" which works
great. I could then plot the polygons, no problem. But when I called
"spplot" which I believe fills the polygons, same problem. X crashes.

Can anyone confirm this behavior? Try plotting a large number of
polygons with spplot and also try very small polygons (less than a
pixel size). I can send around the shapefile if anyone is interested.
It contains GSHHS coastlines for Micronesia.

THK

-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From Roger.Bivand at nhh.no  Sat Mar 29 14:41:38 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 29 Mar 2008 14:41:38 +0100 (CET)
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>

On Fri, 28 Mar 2008, Tim Keitt wrote:

> I'm trying to see if I can track down a bug in X windows that causes
> it to crash when plotting (I believe) very small filled polygons (or
> it may have to do with large numbers of polygons). I first noticed
> this running QGIS. Loading a PostGIS layer with ~3K polygons will
> cause X to abort. I can load the layer if I have already zoomed into a
> smaller region of the coverage. Once I try to zoom out to the full
> extent, X dies.
>
> So I tried loading the polygons into "sp" using "readOGR" which works
> great. I could then plot the polygons, no problem. But when I called
> "spplot" which I believe fills the polygons, same problem. X crashes.
>
> Can anyone confirm this behavior? Try plotting a large number of
> polygons with spplot and also try very small polygons (less than a
> pixel size). I can send around the shapefile if anyone is interested.
> It contains GSHHS coastlines for Micronesia.

I can't reproduce any problems on

http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip

library(rgdal)
usc <- readOGR(".", "co99_d00")
# OGR data source with driver: ESRI Shapefile
# Source: ".", layer: "co99_d00"
# with  3489  rows and  9  columns
plot(usc, col=rainbow(52)[usc$state1])
spplot(usc, "STATE", col.regions=rainbow(52))

and:

$ xdpyinfo
name of display:    :0.0
version number:    11.0
vendor string:    The X.Org Foundation
vendor release number:    60802000
X.Org version: 6.8.2
...
screen #0:
   dimensions:    1280x1024 pixels (361x271 millimeters)
   resolution:    90x96 dots per inch
   depths (7):    16, 1, 4, 8, 15, 24, 32

Could you please make your file available - maybe there is something 
particular about it? Is there way of asking X which driver it is using 
(here nvidia proprietary for Legacy GPU version (1.0-71xx series), full 
details in /proc/driver/nvidia)?

Roger

>
> THK
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at gmail.com  Sat Mar 29 16:01:16 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 10:01:16 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
Message-ID: <6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>

On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 28 Mar 2008, Tim Keitt wrote:
>
>  > I'm trying to see if I can track down a bug in X windows that causes
>  > it to crash when plotting (I believe) very small filled polygons (or
>  > it may have to do with large numbers of polygons). I first noticed
>  > this running QGIS. Loading a PostGIS layer with ~3K polygons will
>  > cause X to abort. I can load the layer if I have already zoomed into a
>  > smaller region of the coverage. Once I try to zoom out to the full
>  > extent, X dies.
>  >
>  > So I tried loading the polygons into "sp" using "readOGR" which works
>  > great. I could then plot the polygons, no problem. But when I called
>  > "spplot" which I believe fills the polygons, same problem. X crashes.
>  >
>  > Can anyone confirm this behavior? Try plotting a large number of
>  > polygons with spplot and also try very small polygons (less than a
>  > pixel size). I can send around the shapefile if anyone is interested.
>  > It contains GSHHS coastlines for Micronesia.
>
>  I can't reproduce any problems on
>
>  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>
>  library(rgdal)
>  usc <- readOGR(".", "co99_d00")
>  # OGR data source with driver: ESRI Shapefile
>  # Source: ".", layer: "co99_d00"
>  # with  3489  rows and  9  columns
>  plot(usc, col=rainbow(52)[usc$state1])
>  spplot(usc, "STATE", col.regions=rainbow(52))
>
>  and:
>
>  $ xdpyinfo
>  name of display:    :0.0
>  version number:    11.0
>  vendor string:    The X.Org Foundation
>  vendor release number:    60802000
>  X.Org version: 6.8.2
>  ...
>  screen #0:
>    dimensions:    1280x1024 pixels (361x271 millimeters)
>    resolution:    90x96 dots per inch
>    depths (7):    16, 1, 4, 8, 15, 24, 32
>
>  Could you please make your file available - maybe there is something
>  particular about it? Is there way of asking X which driver it is using
>  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>  details in /proc/driver/nvidia)?

I'll put the file someplace where it can be downloaded.

This has happened on my desktop using both nvidia and vesa drivers and
on my laptop with the intel driver.

THK

>
>  Roger
>
>  >
>  > THK
>  >
>  >
>
>  --
>  Roger Bivand
>  Economic Geography Section, Department of Economics, Norwegian School of
>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  e-mail: Roger.Bivand at nhh.no
>
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From tkeitt at gmail.com  Sat Mar 29 16:25:43 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 10:25:43 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
Message-ID: <6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>

On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>
> On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>  > On Fri, 28 Mar 2008, Tim Keitt wrote:
>  >
>  >  > I'm trying to see if I can track down a bug in X windows that causes
>  >  > it to crash when plotting (I believe) very small filled polygons (or
>  >  > it may have to do with large numbers of polygons). I first noticed
>  >  > this running QGIS. Loading a PostGIS layer with ~3K polygons will
>  >  > cause X to abort. I can load the layer if I have already zoomed into a
>  >  > smaller region of the coverage. Once I try to zoom out to the full
>  >  > extent, X dies.
>  >  >
>  >  > So I tried loading the polygons into "sp" using "readOGR" which works
>  >  > great. I could then plot the polygons, no problem. But when I called
>  >  > "spplot" which I believe fills the polygons, same problem. X crashes.
>  >  >
>  >  > Can anyone confirm this behavior? Try plotting a large number of
>  >  > polygons with spplot and also try very small polygons (less than a
>  >  > pixel size). I can send around the shapefile if anyone is interested.
>  >  > It contains GSHHS coastlines for Micronesia.
>  >
>  >  I can't reproduce any problems on
>  >
>  >  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>  >
>  >  library(rgdal)
>  >  usc <- readOGR(".", "co99_d00")
>  >  # OGR data source with driver: ESRI Shapefile
>  >  # Source: ".", layer: "co99_d00"
>  >  # with  3489  rows and  9  columns
>  >  plot(usc, col=rainbow(52)[usc$state1])
>  >  spplot(usc, "STATE", col.regions=rainbow(52))
>  >
>  >  and:
>  >
>  >  $ xdpyinfo
>  >  name of display:    :0.0
>  >  version number:    11.0
>  >  vendor string:    The X.Org Foundation
>  >  vendor release number:    60802000
>  >  X.Org version: 6.8.2
>  >  ...
>  >  screen #0:
>  >    dimensions:    1280x1024 pixels (361x271 millimeters)
>  >    resolution:    90x96 dots per inch
>  >    depths (7):    16, 1, 4, 8, 15, 24, 32
>  >
>  >  Could you please make your file available - maybe there is something
>  >  particular about it? Is there way of asking X which driver it is using
>  >  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>  >  details in /proc/driver/nvidia)?
>
>  I'll put the file someplace where it can be downloaded.

OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
crash. I'll test the same under Hardy shortly (requires a chroot).

THK

>
>  This has happened on my desktop using both nvidia and vesa drivers and
>  on my laptop with the intel driver.
>
>  THK
>
>
>  >
>  >  Roger
>  >
>  >  >
>  >  > THK
>  >  >
>  >  >
>  >
>  >  --
>  >  Roger Bivand
>  >  Economic Geography Section, Department of Economics, Norwegian School of
>  >  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  >  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  >  e-mail: Roger.Bivand at nhh.no
>  >
>  >
>
>
>
>
>
> --
>  Timothy H. Keitt, Assistant Professor
>  University of Texas at Austin http://www.keittlab.org/
>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  Please support open document formats http://opendocument.xml.org/
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From tkeitt at gmail.com  Sat Mar 29 16:39:30 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 10:39:30 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
Message-ID: <6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>

On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>
> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>  >
>  > On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>  >  > On Fri, 28 Mar 2008, Tim Keitt wrote:
>  >  >
>  >  >  > I'm trying to see if I can track down a bug in X windows that causes
>  >  >  > it to crash when plotting (I believe) very small filled polygons (or
>  >  >  > it may have to do with large numbers of polygons). I first noticed
>  >  >  > this running QGIS. Loading a PostGIS layer with ~3K polygons will
>  >  >  > cause X to abort. I can load the layer if I have already zoomed into a
>  >  >  > smaller region of the coverage. Once I try to zoom out to the full
>  >  >  > extent, X dies.
>  >  >  >
>  >  >  > So I tried loading the polygons into "sp" using "readOGR" which works
>  >  >  > great. I could then plot the polygons, no problem. But when I called
>  >  >  > "spplot" which I believe fills the polygons, same problem. X crashes.
>  >  >  >
>  >  >  > Can anyone confirm this behavior? Try plotting a large number of
>  >  >  > polygons with spplot and also try very small polygons (less than a
>  >  >  > pixel size). I can send around the shapefile if anyone is interested.
>  >  >  > It contains GSHHS coastlines for Micronesia.
>  >  >
>  >  >  I can't reproduce any problems on
>  >  >
>  >  >  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>  >  >
>  >  >  library(rgdal)
>  >  >  usc <- readOGR(".", "co99_d00")
>  >  >  # OGR data source with driver: ESRI Shapefile
>  >  >  # Source: ".", layer: "co99_d00"
>  >  >  # with  3489  rows and  9  columns
>  >  >  plot(usc, col=rainbow(52)[usc$state1])
>  >  >  spplot(usc, "STATE", col.regions=rainbow(52))
>  >  >
>  >  >  and:
>  >  >
>  >  >  $ xdpyinfo
>  >  >  name of display:    :0.0
>  >  >  version number:    11.0
>  >  >  vendor string:    The X.Org Foundation
>  >  >  vendor release number:    60802000
>  >  >  X.Org version: 6.8.2
>  >  >  ...
>  >  >  screen #0:
>  >  >    dimensions:    1280x1024 pixels (361x271 millimeters)
>  >  >    resolution:    90x96 dots per inch
>  >  >    depths (7):    16, 1, 4, 8, 15, 24, 32
>  >  >
>  >  >  Could you please make your file available - maybe there is something
>  >  >  particular about it? Is there way of asking X which driver it is using
>  >  >  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>  >  >  details in /proc/driver/nvidia)?
>  >
>  >  I'll put the file someplace where it can be downloaded.
>
>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
>  crash. I'll test the same under Hardy shortly (requires a chroot).
>
>  THK
>
>
>
>  >
>  >  This has happened on my desktop using both nvidia and vesa drivers and
>  >  on my laptop with the intel driver.

I just confirmed the same bug under Hardy Heron again using QGIS
0.9.2-rc2. I'll try with "spplot" next.

THK

>  >
>  >  THK
>  >
>  >
>  >  >
>  >  >  Roger
>  >  >
>  >  >  >
>  >  >  > THK
>  >  >  >
>  >  >  >
>  >  >
>  >  >  --
>  >  >  Roger Bivand
>  >  >  Economic Geography Section, Department of Economics, Norwegian School of
>  >  >  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  >  >  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  >  >  e-mail: Roger.Bivand at nhh.no
>  >  >
>  >  >
>  >
>  >
>  >
>  >
>  >
>  > --
>  >  Timothy H. Keitt, Assistant Professor
>  >  University of Texas at Austin http://www.keittlab.org/
>  >  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  >  Please support open document formats http://opendocument.xml.org/
>  >
>
>
>
>  --
>  Timothy H. Keitt, Assistant Professor
>  University of Texas at Austin http://www.keittlab.org/
>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  Please support open document formats http://opendocument.xml.org/
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From Roger.Bivand at nhh.no  Sat Mar 29 17:00:19 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 29 Mar 2008 17:00:19 +0100 (CET)
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com> 
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no> 
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com> 
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
Message-ID: <Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>

On Sat, 29 Mar 2008, Tim Keitt wrote:

> On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>>
>> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>> >
>> > On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> > > On Fri, 28 Mar 2008, Tim Keitt wrote:
>> > >
>> > > > I'm trying to see if I can track down a bug in X windows that causes
>> > > > it to crash when plotting (I believe) very small filled polygons (or
>> > > > it may have to do with large numbers of polygons). I first noticed
>> > > > this running QGIS. Loading a PostGIS layer with ~3K polygons will
>> > > > cause X to abort. I can load the layer if I have already zoomed into a
>> > > > smaller region of the coverage. Once I try to zoom out to the full
>> > > > extent, X dies.
>> > > >
>> > > > So I tried loading the polygons into "sp" using "readOGR" which works
>> > > > great. I could then plot the polygons, no problem. But when I called
>> > > > "spplot" which I believe fills the polygons, same problem. X crashes.
>> > > >
>> > > > Can anyone confirm this behavior? Try plotting a large number of
>> > > > polygons with spplot and also try very small polygons (less than a
>> > > > pixel size). I can send around the shapefile if anyone is interested.
>> > > > It contains GSHHS coastlines for Micronesia.
>> > >
>> > >  I can't reproduce any problems on
>> > >
>> > >  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>> > >
>> > >  library(rgdal)
>> > >  usc <- readOGR(".", "co99_d00")
>> > >  # OGR data source with driver: ESRI Shapefile
>> > >  # Source: ".", layer: "co99_d00"
>> > >  # with  3489  rows and  9  columns
>> > >  plot(usc, col=rainbow(52)[usc$state1])
>> > >  spplot(usc, "STATE", col.regions=rainbow(52))
>> > >
>> > >  and:
>> > >
>> > >  $ xdpyinfo
>> > >  name of display:    :0.0
>> > >  version number:    11.0
>> > >  vendor string:    The X.Org Foundation
>> > >  vendor release number:    60802000
>> > >  X.Org version: 6.8.2
>> > >  ...
>> > >  screen #0:
>> > >    dimensions:    1280x1024 pixels (361x271 millimeters)
>> > >    resolution:    90x96 dots per inch
>> > >    depths (7):    16, 1, 4, 8, 15, 24, 32
>> > >
>> > >  Could you please make your file available - maybe there is something
>> > >  particular about it? Is there way of asking X which driver it is using
>> > >  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>> > >  details in /proc/driver/nvidia)?
>> >
>> >  I'll put the file someplace where it can be downloaded.
>>
>>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
>>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
>>  crash. I'll test the same under Hardy shortly (requires a chroot).
>>
>>  THK
>>
>>
>>
>> >
>> >  This has happened on my desktop using both nvidia and vesa drivers and
>> >  on my laptop with the intel driver.
>
> I just confirmed the same bug under Hardy Heron again using QGIS
> 0.9.2-rc2. I'll try with "spplot" next.

I'll try melanesia on my system, please try the US counties shapefile on 
yours.

Roger

>
> THK
>
>> >
>> >  THK
>> >
>> >
>> > >
>> > >  Roger
>> > >
>> > > >
>> > > > THK
>> > > >
>> > > >
>> > >
>> > >  --
>> > >  Roger Bivand
>> > >  Economic Geography Section, Department of Economics, Norwegian School of
>> > >  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>> > >  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>> > >  e-mail: Roger.Bivand at nhh.no
>> > >
>> > >
>> >
>> >
>> >
>> >
>> >
>> > --
>> >  Timothy H. Keitt, Assistant Professor
>> >  University of Texas at Austin http://www.keittlab.org/
>> >  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>> >  Please support open document formats http://opendocument.xml.org/
>> >
>>
>>
>>
>>  --
>>  Timothy H. Keitt, Assistant Professor
>>  University of Texas at Austin http://www.keittlab.org/
>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>>  Please support open document formats http://opendocument.xml.org/
>>
>
>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From Roger.Bivand at nhh.no  Sat Mar 29 18:21:20 2008
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 29 Mar 2008 18:21:20 +0100 (CET)
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com> 
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no> 
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com> 
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
Message-ID: <Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>

On Sat, 29 Mar 2008, Roger Bivand wrote:

> On Sat, 29 Mar 2008, Tim Keitt wrote:
>
>> On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>>>
>>> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>>>>
>>>> On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>> On Fri, 28 Mar 2008, Tim Keitt wrote:
>>>>>
>>>>>> I'm trying to see if I can track down a bug in X windows that causes
>>>>>> it to crash when plotting (I believe) very small filled polygons (or
>>>>>> it may have to do with large numbers of polygons). I first noticed
>>>>>> this running QGIS. Loading a PostGIS layer with ~3K polygons will
>>>>>> cause X to abort. I can load the layer if I have already zoomed into a
>>>>>> smaller region of the coverage. Once I try to zoom out to the full
>>>>>> extent, X dies.
>>>>>>
>>>>>> So I tried loading the polygons into "sp" using "readOGR" which works
>>>>>> great. I could then plot the polygons, no problem. But when I called
>>>>>> "spplot" which I believe fills the polygons, same problem. X crashes.
>>>>>>
>>>>>> Can anyone confirm this behavior? Try plotting a large number of
>>>>>> polygons with spplot and also try very small polygons (less than a
>>>>>> pixel size). I can send around the shapefile if anyone is interested.
>>>>>> It contains GSHHS coastlines for Micronesia.
>>>>>
>>>>>  I can't reproduce any problems on
>>>>>
>>>>>  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>>>>>
>>>>>  library(rgdal)
>>>>>  usc <- readOGR(".", "co99_d00")
>>>>>  # OGR data source with driver: ESRI Shapefile
>>>>>  # Source: ".", layer: "co99_d00"
>>>>>  # with  3489  rows and  9  columns
>>>>>  plot(usc, col=rainbow(52)[usc$state1])
>>>>>  spplot(usc, "STATE", col.regions=rainbow(52))
>>>>>
>>>>>  and:
>>>>>
>>>>>  $ xdpyinfo
>>>>>  name of display:    :0.0
>>>>>  version number:    11.0
>>>>>  vendor string:    The X.Org Foundation
>>>>>  vendor release number:    60802000
>>>>>  X.Org version: 6.8.2
>>>>>  ...
>>>>>  screen #0:
>>>>>    dimensions:    1280x1024 pixels (361x271 millimeters)
>>>>>    resolution:    90x96 dots per inch
>>>>>    depths (7):    16, 1, 4, 8, 15, 24, 32
>>>>>
>>>>>  Could you please make your file available - maybe there is something
>>>>>  particular about it? Is there way of asking X which driver it is using
>>>>>  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>>>>>  details in /proc/driver/nvidia)?
>>>>
>>>>  I'll put the file someplace where it can be downloaded.
>>>
>>>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
>>>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
>>>  crash. I'll test the same under Hardy shortly (requires a chroot).
>>>
>>>  THK
>>>
>>>
>>>
>>>>
>>>>  This has happened on my desktop using both nvidia and vesa drivers and
>>>>  on my laptop with the intel driver.
>>
>> I just confirmed the same bug under Hardy Heron again using QGIS
>> 0.9.2-rc2. I'll try with "spplot" next.
>
> I'll try melanesia on my system, please try the US counties shapefile on
> yours.

The melanesia shapefile does not cause any problems on my system as 
documented earlier with spplot(). I guess that your X(s) is/are fresher 
than mine, but trying on another Linux system (F7, X.org 1.3.0, intel 
driver) shows no problems either, I'm afraid.

Roger

>
> Roger
>
>>
>> THK
>>
>>>>
>>>>  THK
>>>>
>>>>
>>>>>
>>>>>  Roger
>>>>>
>>>>>>
>>>>>> THK
>>>>>>
>>>>>>
>>>>>
>>>>>  --
>>>>>  Roger Bivand
>>>>>  Economic Geography Section, Department of Economics, Norwegian School of
>>>>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>>>>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>>>  e-mail: Roger.Bivand at nhh.no
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> --
>>>>  Timothy H. Keitt, Assistant Professor
>>>>  University of Texas at Austin http://www.keittlab.org/
>>>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>>>>  Please support open document formats http://opendocument.xml.org/
>>>>
>>>
>>>
>>>
>>>  --
>>>  Timothy H. Keitt, Assistant Professor
>>>  University of Texas at Austin http://www.keittlab.org/
>>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>>>  Please support open document formats http://opendocument.xml.org/
>>>
>>
>>
>>
>>
>
>

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Helleveien 30, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no



From tkeitt at gmail.com  Sat Mar 29 18:36:21 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 12:36:21 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
Message-ID: <6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>

On Sat, Mar 29, 2008 at 12:21 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> On Sat, 29 Mar 2008, Roger Bivand wrote:
>
>  > On Sat, 29 Mar 2008, Tim Keitt wrote:
>  >
>  >> On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>  >>>
>  >>> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>  >>>>
>  >>>> On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>  >>>>> On Fri, 28 Mar 2008, Tim Keitt wrote:
>  >>>>>
>  >>>>>> I'm trying to see if I can track down a bug in X windows that causes
>  >>>>>> it to crash when plotting (I believe) very small filled polygons (or
>  >>>>>> it may have to do with large numbers of polygons). I first noticed
>  >>>>>> this running QGIS. Loading a PostGIS layer with ~3K polygons will
>  >>>>>> cause X to abort. I can load the layer if I have already zoomed into a
>  >>>>>> smaller region of the coverage. Once I try to zoom out to the full
>  >>>>>> extent, X dies.
>  >>>>>>
>  >>>>>> So I tried loading the polygons into "sp" using "readOGR" which works
>  >>>>>> great. I could then plot the polygons, no problem. But when I called
>  >>>>>> "spplot" which I believe fills the polygons, same problem. X crashes.
>  >>>>>>
>  >>>>>> Can anyone confirm this behavior? Try plotting a large number of
>  >>>>>> polygons with spplot and also try very small polygons (less than a
>  >>>>>> pixel size). I can send around the shapefile if anyone is interested.
>  >>>>>> It contains GSHHS coastlines for Micronesia.
>  >>>>>
>  >>>>>  I can't reproduce any problems on
>  >>>>>
>  >>>>>  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>  >>>>>
>  >>>>>  library(rgdal)
>  >>>>>  usc <- readOGR(".", "co99_d00")
>  >>>>>  # OGR data source with driver: ESRI Shapefile
>  >>>>>  # Source: ".", layer: "co99_d00"
>  >>>>>  # with  3489  rows and  9  columns
>  >>>>>  plot(usc, col=rainbow(52)[usc$state1])
>  >>>>>  spplot(usc, "STATE", col.regions=rainbow(52))
>  >>>>>
>  >>>>>  and:
>  >>>>>
>  >>>>>  $ xdpyinfo
>  >>>>>  name of display:    :0.0
>  >>>>>  version number:    11.0
>  >>>>>  vendor string:    The X.Org Foundation
>  >>>>>  vendor release number:    60802000
>  >>>>>  X.Org version: 6.8.2
>  >>>>>  ...
>  >>>>>  screen #0:
>  >>>>>    dimensions:    1280x1024 pixels (361x271 millimeters)
>  >>>>>    resolution:    90x96 dots per inch
>  >>>>>    depths (7):    16, 1, 4, 8, 15, 24, 32
>  >>>>>
>  >>>>>  Could you please make your file available - maybe there is something
>  >>>>>  particular about it? Is there way of asking X which driver it is using
>  >>>>>  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>  >>>>>  details in /proc/driver/nvidia)?
>  >>>>
>  >>>>  I'll put the file someplace where it can be downloaded.
>  >>>
>  >>>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
>  >>>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
>  >>>  crash. I'll test the same under Hardy shortly (requires a chroot).
>  >>>
>  >>>  THK
>  >>>
>  >>>
>  >>>
>  >>>>
>  >>>>  This has happened on my desktop using both nvidia and vesa drivers and
>  >>>>  on my laptop with the intel driver.
>  >>
>  >> I just confirmed the same bug under Hardy Heron again using QGIS
>  >> 0.9.2-rc2. I'll try with "spplot" next.
>  >
>  > I'll try melanesia on my system, please try the US counties shapefile on
>  > yours.
>
>  The melanesia shapefile does not cause any problems on my system as
>  documented earlier with spplot(). I guess that your X(s) is/are fresher
>  than mine, but trying on another Linux system (F7, X.org 1.3.0, intel
>  driver) shows no problems either, I'm afraid.
>
>  Roger
>

version number:    11.0
vendor string:    The X.Org Foundation
vendor release number:    10400090
X.Org version: 1.4.0.90

Sigh. Debugging X is such a pain...

THK

>
>
>  >
>  > Roger
>  >
>  >>
>  >> THK
>  >>
>  >>>>
>  >>>>  THK
>  >>>>
>  >>>>
>  >>>>>
>  >>>>>  Roger
>  >>>>>
>  >>>>>>
>  >>>>>> THK
>  >>>>>>
>  >>>>>>
>  >>>>>
>  >>>>>  --
>  >>>>>  Roger Bivand
>  >>>>>  Economic Geography Section, Department of Economics, Norwegian School of
>  >>>>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  >>>>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  >>>>>  e-mail: Roger.Bivand at nhh.no
>  >>>>>
>  >>>>>
>  >>>>
>  >>>>
>  >>>>
>  >>>>
>  >>>>
>  >>>> --
>  >>>>  Timothy H. Keitt, Assistant Professor
>  >>>>  University of Texas at Austin http://www.keittlab.org/
>  >>>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  >>>>  Please support open document formats http://opendocument.xml.org/
>  >>>>
>  >>>
>  >>>
>  >>>
>  >>>  --
>  >>>  Timothy H. Keitt, Assistant Professor
>  >>>  University of Texas at Austin http://www.keittlab.org/
>  >>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  >>>  Please support open document formats http://opendocument.xml.org/
>  >>>
>  >>
>  >>
>  >>
>  >>
>  >
>  >
>
>  --
>  Roger Bivand
>  Economic Geography Section, Department of Economics, Norwegian School of
>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  e-mail: Roger.Bivand at nhh.no
>
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From regmi_pujan at hotmail.com  Sat Mar 29 20:02:40 2008
From: regmi_pujan at hotmail.com (PUJAN RAJ REGMI)
Date: Sat, 29 Mar 2008 19:02:40 +0000
Subject: [R-sig-Geo] Trend
In-Reply-To: <Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no> 
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com> 
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no> 
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
Message-ID: <BAY113-W3787836DAED04CB932B53284F80@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20080329/8ebf5583/attachment.pl>

From dan.putler at sauder.ubc.ca  Sat Mar 29 21:51:04 2008
From: dan.putler at sauder.ubc.ca (Dan Putler)
Date: Sat, 29 Mar 2008 13:51:04 -0700
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
	<6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
Message-ID: <1206823864.6017.31.camel@whitebox>

Hi Tim,

I'm running Gutsy and have no problem working with QGIS (0.9.2-RC1) on a
polygon layer with over 7K polygons doing a choropleth map from a
shapefile set. I think you have hardware/X11 issues, not OGR related
software issues. To confirm this, you might want to load the problem
layer into UDig and see if the same thing happens, since you would then
be out of OGR and into GeoTools.

Dan

On Sat, 2008-03-29 at 12:36 -0500, Tim Keitt wrote:
> On Sat, Mar 29, 2008 at 12:21 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> > On Sat, 29 Mar 2008, Roger Bivand wrote:
> >
> >  > On Sat, 29 Mar 2008, Tim Keitt wrote:
> >  >
> >  >> On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
> >  >>>
> >  >>> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
> >  >>>>
> >  >>>> On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >  >>>>> On Fri, 28 Mar 2008, Tim Keitt wrote:
> >  >>>>>
> >  >>>>>> I'm trying to see if I can track down a bug in X windows that causes
> >  >>>>>> it to crash when plotting (I believe) very small filled polygons (or
> >  >>>>>> it may have to do with large numbers of polygons). I first noticed
> >  >>>>>> this running QGIS. Loading a PostGIS layer with ~3K polygons will
> >  >>>>>> cause X to abort. I can load the layer if I have already zoomed into a
> >  >>>>>> smaller region of the coverage. Once I try to zoom out to the full
> >  >>>>>> extent, X dies.
> >  >>>>>>
> >  >>>>>> So I tried loading the polygons into "sp" using "readOGR" which works
> >  >>>>>> great. I could then plot the polygons, no problem. But when I called
> >  >>>>>> "spplot" which I believe fills the polygons, same problem. X crashes.
> >  >>>>>>
> >  >>>>>> Can anyone confirm this behavior? Try plotting a large number of
> >  >>>>>> polygons with spplot and also try very small polygons (less than a
> >  >>>>>> pixel size). I can send around the shapefile if anyone is interested.
> >  >>>>>> It contains GSHHS coastlines for Micronesia.
> >  >>>>>
> >  >>>>>  I can't reproduce any problems on
> >  >>>>>
> >  >>>>>  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
> >  >>>>>
> >  >>>>>  library(rgdal)
> >  >>>>>  usc <- readOGR(".", "co99_d00")
> >  >>>>>  # OGR data source with driver: ESRI Shapefile
> >  >>>>>  # Source: ".", layer: "co99_d00"
> >  >>>>>  # with  3489  rows and  9  columns
> >  >>>>>  plot(usc, col=rainbow(52)[usc$state1])
> >  >>>>>  spplot(usc, "STATE", col.regions=rainbow(52))
> >  >>>>>
> >  >>>>>  and:
> >  >>>>>
> >  >>>>>  $ xdpyinfo
> >  >>>>>  name of display:    :0.0
> >  >>>>>  version number:    11.0
> >  >>>>>  vendor string:    The X.Org Foundation
> >  >>>>>  vendor release number:    60802000
> >  >>>>>  X.Org version: 6.8.2
> >  >>>>>  ...
> >  >>>>>  screen #0:
> >  >>>>>    dimensions:    1280x1024 pixels (361x271 millimeters)
> >  >>>>>    resolution:    90x96 dots per inch
> >  >>>>>    depths (7):    16, 1, 4, 8, 15, 24, 32
> >  >>>>>
> >  >>>>>  Could you please make your file available - maybe there is something
> >  >>>>>  particular about it? Is there way of asking X which driver it is using
> >  >>>>>  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
> >  >>>>>  details in /proc/driver/nvidia)?
> >  >>>>
> >  >>>>  I'll put the file someplace where it can be downloaded.
> >  >>>
> >  >>>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
> >  >>>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
> >  >>>  crash. I'll test the same under Hardy shortly (requires a chroot).
> >  >>>
> >  >>>  THK
> >  >>>
> >  >>>
> >  >>>
> >  >>>>
> >  >>>>  This has happened on my desktop using both nvidia and vesa drivers and
> >  >>>>  on my laptop with the intel driver.
> >  >>
> >  >> I just confirmed the same bug under Hardy Heron again using QGIS
> >  >> 0.9.2-rc2. I'll try with "spplot" next.
> >  >
> >  > I'll try melanesia on my system, please try the US counties shapefile on
> >  > yours.
> >
> >  The melanesia shapefile does not cause any problems on my system as
> >  documented earlier with spplot(). I guess that your X(s) is/are fresher
> >  than mine, but trying on another Linux system (F7, X.org 1.3.0, intel
> >  driver) shows no problems either, I'm afraid.
> >
> >  Roger
> >
> 
> version number:    11.0
> vendor string:    The X.Org Foundation
> vendor release number:    10400090
> X.Org version: 1.4.0.90
> 
> Sigh. Debugging X is such a pain...
> 
> THK
> 
> >
> >
> >  >
> >  > Roger
> >  >
> >  >>
> >  >> THK
> >  >>
> >  >>>>
> >  >>>>  THK
> >  >>>>
> >  >>>>
> >  >>>>>
> >  >>>>>  Roger
> >  >>>>>
> >  >>>>>>
> >  >>>>>> THK
> >  >>>>>>
> >  >>>>>>
> >  >>>>>
> >  >>>>>  --
> >  >>>>>  Roger Bivand
> >  >>>>>  Economic Geography Section, Department of Economics, Norwegian School of
> >  >>>>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >  >>>>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >  >>>>>  e-mail: Roger.Bivand at nhh.no
> >  >>>>>
> >  >>>>>
> >  >>>>
> >  >>>>
> >  >>>>
> >  >>>>
> >  >>>>
> >  >>>> --
> >  >>>>  Timothy H. Keitt, Assistant Professor
> >  >>>>  University of Texas at Austin http://www.keittlab.org/
> >  >>>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
> >  >>>>  Please support open document formats http://opendocument.xml.org/
> >  >>>>
> >  >>>
> >  >>>
> >  >>>
> >  >>>  --
> >  >>>  Timothy H. Keitt, Assistant Professor
> >  >>>  University of Texas at Austin http://www.keittlab.org/
> >  >>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
> >  >>>  Please support open document formats http://opendocument.xml.org/
> >  >>>
> >  >>
> >  >>
> >  >>
> >  >>
> >  >
> >  >
> >
> >  --
> >  Roger Bivand
> >  Economic Geography Section, Department of Economics, Norwegian School of
> >  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
> >  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
> >  e-mail: Roger.Bivand at nhh.no
> >
> >
> 
> 
> 
-- 
Dan Putler
Sauder School of Business
University of British Columbia



From tkeitt at gmail.com  Sat Mar 29 22:15:53 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 16:15:53 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <1206823864.6017.31.camel@whitebox>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
	<6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
	<1206823864.6017.31.camel@whitebox>
Message-ID: <6262c54c0803291415j6a6c91ffi595e6bc6fca71574@mail.gmail.com>

On Sat, Mar 29, 2008 at 3:51 PM, Dan Putler <dan.putler at sauder.ubc.ca> wrote:
> Hi Tim,
>
>  I'm running Gutsy and have no problem working with QGIS (0.9.2-RC1) on a
>  polygon layer with over 7K polygons doing a choropleth map from a
>  shapefile set. I think you have hardware/X11 issues, not OGR related
>  software issues. To confirm this, you might want to load the problem
>  layer into UDig and see if the same thing happens, since you would then
>  be out of OGR and into GeoTools.

That's my point. It is an interaction between X and the properties of
this set of polygons. The fact that it is repeatable across two
different machines and three different videos drivers and two
different software programs suggests strongly that there is a bug in
the X server.

Please try the file at http://www.keittlab.org/~tkeitt/melanesia.tgz
and see if loading it into QGIS causes a crash.

THK

>
>  Dan
>
>
>
>  On Sat, 2008-03-29 at 12:36 -0500, Tim Keitt wrote:
>  > On Sat, Mar 29, 2008 at 12:21 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>  > >
>  > > On Sat, 29 Mar 2008, Roger Bivand wrote:
>  > >
>  > >  > On Sat, 29 Mar 2008, Tim Keitt wrote:
>  > >  >
>  > >  >> On Sat, Mar 29, 2008 at 10:25 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>  > >  >>>
>  > >  >>> On Sat, Mar 29, 2008 at 10:01 AM, Tim Keitt <tkeitt at gmail.com> wrote:
>  > >  >>>>
>  > >  >>>> On Sat, Mar 29, 2008 at 8:41 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>  > >  >>>>> On Fri, 28 Mar 2008, Tim Keitt wrote:
>  > >  >>>>>
>  > >  >>>>>> I'm trying to see if I can track down a bug in X windows that causes
>  > >  >>>>>> it to crash when plotting (I believe) very small filled polygons (or
>  > >  >>>>>> it may have to do with large numbers of polygons). I first noticed
>  > >  >>>>>> this running QGIS. Loading a PostGIS layer with ~3K polygons will
>  > >  >>>>>> cause X to abort. I can load the layer if I have already zoomed into a
>  > >  >>>>>> smaller region of the coverage. Once I try to zoom out to the full
>  > >  >>>>>> extent, X dies.
>  > >  >>>>>>
>  > >  >>>>>> So I tried loading the polygons into "sp" using "readOGR" which works
>  > >  >>>>>> great. I could then plot the polygons, no problem. But when I called
>  > >  >>>>>> "spplot" which I believe fills the polygons, same problem. X crashes.
>  > >  >>>>>>
>  > >  >>>>>> Can anyone confirm this behavior? Try plotting a large number of
>  > >  >>>>>> polygons with spplot and also try very small polygons (less than a
>  > >  >>>>>> pixel size). I can send around the shapefile if anyone is interested.
>  > >  >>>>>> It contains GSHHS coastlines for Micronesia.
>  > >  >>>>>
>  > >  >>>>>  I can't reproduce any problems on
>  > >  >>>>>
>  > >  >>>>>  http://www.census.gov/geo/cob/bdy/co/co00shp/co99_d00_shp.zip
>  > >  >>>>>
>  > >  >>>>>  library(rgdal)
>  > >  >>>>>  usc <- readOGR(".", "co99_d00")
>  > >  >>>>>  # OGR data source with driver: ESRI Shapefile
>  > >  >>>>>  # Source: ".", layer: "co99_d00"
>  > >  >>>>>  # with  3489  rows and  9  columns
>  > >  >>>>>  plot(usc, col=rainbow(52)[usc$state1])
>  > >  >>>>>  spplot(usc, "STATE", col.regions=rainbow(52))
>  > >  >>>>>
>  > >  >>>>>  and:
>  > >  >>>>>
>  > >  >>>>>  $ xdpyinfo
>  > >  >>>>>  name of display:    :0.0
>  > >  >>>>>  version number:    11.0
>  > >  >>>>>  vendor string:    The X.Org Foundation
>  > >  >>>>>  vendor release number:    60802000
>  > >  >>>>>  X.Org version: 6.8.2
>  > >  >>>>>  ...
>  > >  >>>>>  screen #0:
>  > >  >>>>>    dimensions:    1280x1024 pixels (361x271 millimeters)
>  > >  >>>>>    resolution:    90x96 dots per inch
>  > >  >>>>>    depths (7):    16, 1, 4, 8, 15, 24, 32
>  > >  >>>>>
>  > >  >>>>>  Could you please make your file available - maybe there is something
>  > >  >>>>>  particular about it? Is there way of asking X which driver it is using
>  > >  >>>>>  (here nvidia proprietary for Legacy GPU version (1.0-71xx series), full
>  > >  >>>>>  details in /proc/driver/nvidia)?
>  > >  >>>>
>  > >  >>>>  I'll put the file someplace where it can be downloaded.
>  > >  >>>
>  > >  >>>  OK. It is at http://www.keittlab.org/~tkeitt/melanesia.tgz. I just
>  > >  >>>  confirmed loading this file into QGIS 0.9.2-rc2 reproduces the X
>  > >  >>>  crash. I'll test the same under Hardy shortly (requires a chroot).
>  > >  >>>
>  > >  >>>  THK
>  > >  >>>
>  > >  >>>
>  > >  >>>
>  > >  >>>>
>  > >  >>>>  This has happened on my desktop using both nvidia and vesa drivers and
>  > >  >>>>  on my laptop with the intel driver.
>  > >  >>
>  > >  >> I just confirmed the same bug under Hardy Heron again using QGIS
>  > >  >> 0.9.2-rc2. I'll try with "spplot" next.
>  > >  >
>  > >  > I'll try melanesia on my system, please try the US counties shapefile on
>  > >  > yours.
>  > >
>  > >  The melanesia shapefile does not cause any problems on my system as
>  > >  documented earlier with spplot(). I guess that your X(s) is/are fresher
>  > >  than mine, but trying on another Linux system (F7, X.org 1.3.0, intel
>  > >  driver) shows no problems either, I'm afraid.
>  > >
>  > >  Roger
>  > >
>  >
>  > version number:    11.0
>  > vendor string:    The X.Org Foundation
>  > vendor release number:    10400090
>  > X.Org version: 1.4.0.90
>  >
>  > Sigh. Debugging X is such a pain...
>  >
>  > THK
>  >
>  > >
>  > >
>  > >  >
>  > >  > Roger
>  > >  >
>  > >  >>
>  > >  >> THK
>  > >  >>
>  > >  >>>>
>  > >  >>>>  THK
>  > >  >>>>
>  > >  >>>>
>  > >  >>>>>
>  > >  >>>>>  Roger
>  > >  >>>>>
>  > >  >>>>>>
>  > >  >>>>>> THK
>  > >  >>>>>>
>  > >  >>>>>>
>  > >  >>>>>
>  > >  >>>>>  --
>  > >  >>>>>  Roger Bivand
>  > >  >>>>>  Economic Geography Section, Department of Economics, Norwegian School of
>  > >  >>>>>  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  > >  >>>>>  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  > >  >>>>>  e-mail: Roger.Bivand at nhh.no
>  > >  >>>>>
>  > >  >>>>>
>  > >  >>>>
>  > >  >>>>
>  > >  >>>>
>  > >  >>>>
>  > >  >>>>
>  > >  >>>> --
>  > >  >>>>  Timothy H. Keitt, Assistant Professor
>  > >  >>>>  University of Texas at Austin http://www.keittlab.org/
>  > >  >>>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  > >  >>>>  Please support open document formats http://opendocument.xml.org/
>  > >  >>>>
>  > >  >>>
>  > >  >>>
>  > >  >>>
>  > >  >>>  --
>  > >  >>>  Timothy H. Keitt, Assistant Professor
>  > >  >>>  University of Texas at Austin http://www.keittlab.org/
>  > >  >>>  Contact info and schedule at http://www.keittlab.org/~tkeitt/
>  > >  >>>  Please support open document formats http://opendocument.xml.org/
>  > >  >>>
>  > >  >>
>  > >  >>
>  > >  >>
>  > >  >>
>  > >  >
>  > >  >
>  > >
>  > >  --
>  > >  Roger Bivand
>  > >  Economic Geography Section, Department of Economics, Norwegian School of
>  > >  Economics and Business Administration, Helleveien 30, N-5045 Bergen,
>  > >  Norway. voice: +47 55 95 93 55; fax +47 55 95 95 43
>  > >  e-mail: Roger.Bivand at nhh.no
>  > >
>  > >
>  >
>  >
>  >
>  --
>  Dan Putler
>  Sauder School of Business
>  University of British Columbia
>
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From b.rowlingson at lancaster.ac.uk  Sat Mar 29 22:36:24 2008
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 29 Mar 2008 21:36:24 +0000
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
	<6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
Message-ID: <47EEB658.30105@lancaster.ac.uk>

Tim Keitt wrote:

> version number:    11.0
> vendor string:    The X.Org Foundation
> vendor release number:    10400090
> X.Org version: 1.4.0.90
> 
> Sigh. Debugging X is such a pain...
> 

  Just a suggestion, but have you tried it with an Xnest, or an Xvfb 
server? That way it should only crash that server and not the one you 
are working on.

Barry



From tkeitt at gmail.com  Sun Mar 30 04:36:23 2008
From: tkeitt at gmail.com (Tim Keitt)
Date: Sat, 29 Mar 2008 21:36:23 -0500
Subject: [R-sig-Geo] Sleuthing X windows bug in Ubuntu Gutsy
In-Reply-To: <47EEB658.30105@lancaster.ac.uk>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>
	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>
	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
	<6262c54c0803291036p25858096ya163416d973b8c5f@mail.gmail.com>
	<47EEB658.30105@lancaster.ac.uk>
Message-ID: <6262c54c0803291936m6991f51fg1a2349a78ca51530@mail.gmail.com>

On Sat, Mar 29, 2008 at 4:36 PM, Barry Rowlingson
<b.rowlingson at lancaster.ac.uk> wrote:
> Tim Keitt wrote:
>
>  > version number:    11.0
>  > vendor string:    The X.Org Foundation
>  > vendor release number:    10400090
>  > X.Org version: 1.4.0.90
>  >
>  > Sigh. Debugging X is such a pain...
>  >
>
>   Just a suggestion, but have you tried it with an Xnest, or an Xvfb
>  server? That way it should only crash that server and not the one you
>  are working on.

Great suggestion. Yes, I did run a second X server and was able to
crash it without loosing my session. I got as far as trying to run the
X server from within gdb, but it hangs and I have to power cycle.

THK

>
>  Barry
>



-- 
Timothy H. Keitt, Assistant Professor
University of Texas at Austin http://www.keittlab.org/
Contact info and schedule at http://www.keittlab.org/~tkeitt/
Please support open document formats http://opendocument.xml.org/



From murray.richardson at utoronto.ca  Mon Mar 31 18:55:45 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Mon, 31 Mar 2008 12:55:45 -0400
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
Message-ID: <47F11791.1040701@utoronto.ca>

Hello list members,

I think I must be missing some obvious documentation somewhere; I'm not 
sure how I can access ogr2ogr vial R to convert a postGIS layer to a 
shapefile.  Must I use readOGR and writeOGR in rgdal instead or is there 
a way to call ogr2ogr directly? If so do I have to call the ogr2ogr 
binaries from FWTools?

On a more or less related topic - is it possible to convert a  
SpatialLines class to a  polygon feature class and  specify a threshold 
distance withing which line features will be treated as equivalent (i.e. 
to reduce spurious polygons at polygon boundaries).  Or even better 
could ogr be used to do this directly on a postGIS layer?  I know this 
is moving out of R territory but if anyone knows off hand I would 
appreciate your help.

Also - where do I search the complete r-sig-geo archives rather than 
have to do it one month at a time?

Thanks,

Murray



From giohappy at gmail.com  Mon Mar 31 20:07:32 2008
From: giohappy at gmail.com (G. Allegri)
Date: Mon, 31 Mar 2008 20:07:32 +0200
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
In-Reply-To: <47F11791.1040701@utoronto.ca>
References: <47F11791.1040701@utoronto.ca>
Message-ID: <e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>

Hi Murray.
About the first question. As far as I understand, you're working in R
on a *imported* PostGIS layer (I suppose you use rgdal to do it,
right?). Then you would need to export it to a shapefile (easily done
with writeOGR). Why are you considering the use of ogr2ogr? As you
probably  know, it's a binary callable from a command line, and it's
not possible (AFAIK) to do it from R...

I dont' understand your second question...
> Or even better could ogr be used to do this directly on a postGIS layer?
What do you mean?

Giovanni



From murray.richardson at utoronto.ca  Mon Mar 31 20:14:13 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Mon, 31 Mar 2008 14:14:13 -0400
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
In-Reply-To: <e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
References: <47F11791.1040701@utoronto.ca>
	<e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
Message-ID: <47F129F5.6070405@utoronto.ca>

Actually I am currently running an R script to link output from cgal 
routines to postGIS which allows me to handle massive tables and has 
some other advantages for my problem.  However, this clarifies the 
import export option somewhat (although I just learned that I can invoke 
ogr2ogr as a system command which would be a faster option I guess.

Thanks for you input.

Murray



G. Allegri wrote:
> Hi Murray.
> About the first question. As far as I understand, you're working in R
> on a *imported* PostGIS layer (I suppose you use rgdal to do it,
> right?). Then you would need to export it to a shapefile (easily done
> with writeOGR). Why are you considering the use of ogr2ogr? As you
> probably  know, it's a binary callable from a command line, and it's
> not possible (AFAIK) to do it from R...
>
> I dont' understand your second question...
>   
>> Or even better could ogr be used to do this directly on a postGIS layer?
>>     
> What do you mean?
>
> Giovanni
>
>



From giohappy at gmail.com  Mon Mar 31 20:44:51 2008
From: giohappy at gmail.com (G. Allegri)
Date: Mon, 31 Mar 2008 20:44:51 +0200
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
In-Reply-To: <47F129F5.6070405@utoronto.ca>
References: <47F11791.1040701@utoronto.ca>
	<e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
	<47F129F5.6070405@utoronto.ca>
Message-ID: <e12429640803311144w2e983e53wf78008e443471f4@mail.gmail.com>

Well, my innput has not been so useful, but yours do :-)

cgal stands for "computational geometry algorithms library"?
If yes, I will ask you a thing later...

How do you call system commands from R?

Giovanni


2008/3/31, Murray Richardson <murray.richardson at utoronto.ca>:
> Actually I am currently running an R script to link output from cgal
>  routines to postGIS which allows me to handle massive tables and has
>  some other advantages for my problem.  However, this clarifies the
>  import export option somewhat (although I just learned that I can invoke
>  ogr2ogr as a system command which would be a faster option I guess.
>
>  Thanks for you input.
>
>
>  Murray
>
>
>
>
>  G. Allegri wrote:
>  > Hi Murray.
>  > About the first question. As far as I understand, you're working in R
>  > on a *imported* PostGIS layer (I suppose you use rgdal to do it,
>  > right?). Then you would need to export it to a shapefile (easily done
>  > with writeOGR). Why are you considering the use of ogr2ogr? As you
>  > probably  know, it's a binary callable from a command line, and it's
>  > not possible (AFAIK) to do it from R...
>  >
>  > I dont' understand your second question...
>  >
>  >> Or even better could ogr be used to do this directly on a postGIS layer?
>  >>
>  > What do you mean?
>  >
>  > Giovanni
>  >
>  >
>



From murray.richardson at utoronto.ca  Mon Mar 31 20:47:50 2008
From: murray.richardson at utoronto.ca (Murray Richardson)
Date: Mon, 31 Mar 2008 14:47:50 -0400
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
In-Reply-To: <e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
References: <47F11791.1040701@utoronto.ca>
	<e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
Message-ID: <47F131D6.9040109@utoronto.ca>


See below. Haven't tried this yet.

Yes that is what CGAL stands for. 

Murray






Hi Murray,

Regarding the first question, you can read into R first and then output 
it again. You could also call ogr2ogr using a system call like:

system("ogr2ogr normal syntax stuff")

cheers,
Paul


G. Allegri wrote:
> Hi Murray.
> About the first question. As far as I understand, you're working in R
> on a *imported* PostGIS layer (I suppose you use rgdal to do it,
> right?). Then you would need to export it to a shapefile (easily done
> with writeOGR). Why are you considering the use of ogr2ogr? As you
> probably  know, it's a binary callable from a command line, and it's
> not possible (AFAIK) to do it from R...
>
> I dont' understand your second question...
>   
>> Or even better could ogr be used to do this directly on a postGIS layer?
>>     
> What do you mean?
>
> Giovanni
>
>



From giohappy at gmail.com  Mon Mar 31 21:09:58 2008
From: giohappy at gmail.com (G. Allegri)
Date: Mon, 31 Mar 2008 21:09:58 +0200
Subject: [R-sig-Geo] ogr2ogr for converting postGIS layer to shapefile
In-Reply-To: <47F131D6.9040109@utoronto.ca>
References: <47F11791.1040701@utoronto.ca>
	<e12429640803311107w1df052a6pa1613786bf2ce2b@mail.gmail.com>
	<47F131D6.9040109@utoronto.ca>
Message-ID: <e12429640803311209n413db72fp1ff9c87d43d0dfea@mail.gmail.com>

Great, I didn't know it... I just made a rapid try some time ago but
it failed because I didn't use the ""

I'm sorry for bothering, how are you using R with CGAL?


2008/3/31, Murray Richardson <murray.richardson at utoronto.ca>:
>
>  See below. Haven't tried this yet.
>
>  Yes that is what CGAL stands for.
>
>  Murray
>
>
>
>
>
>
>  Hi Murray,
>
>  Regarding the first question, you can read into R first and then output
>  it again. You could also call ogr2ogr using a system call like:
>
>  system("ogr2ogr normal syntax stuff")
>
>  cheers,
>  Paul
>
>
>
>  G. Allegri wrote:
>  > Hi Murray.
>  > About the first question. As far as I understand, you're working in R
>  > on a *imported* PostGIS layer (I suppose you use rgdal to do it,
>  > right?). Then you would need to export it to a shapefile (easily done
>  > with writeOGR). Why are you considering the use of ogr2ogr? As you
>  > probably  know, it's a binary callable from a command line, and it's
>  > not possible (AFAIK) to do it from R...
>  >
>  > I dont' understand your second question...
>  >
>  >> Or even better could ogr be used to do this directly on a postGIS layer?
>  >>
>  > What do you mean?
>  >
>  > Giovanni
>  >
>  >
>



From andrew.niccolai at yale.edu  Mon Mar 31 23:26:39 2008
From: andrew.niccolai at yale.edu (Andrew Niccolai)
Date: Mon, 31 Mar 2008 17:26:39 -0400
Subject: [R-sig-Geo] SpatialLines and SpatialGridDataFrame overlay or
	transect sampling
In-Reply-To: <Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
References: <6262c54c0803281222v59ca1e55mfbf676429e712135@mail.gmail.com>
	<Pine.LNX.4.64.0803291421020.22048@reclus.nhh.no>
	<6262c54c0803290801x3297612bode268d74304259fc@mail.gmail.com>
	<6262c54c0803290825n3d88e8band206535d022576f7@mail.gmail.com>	<6262c54c0803290839g3e9fb5e6g3e5d51194216207f@mail.gmail.com>	<Pine.LNX.4.64.0803291659310.22048@reclus.nhh.no>
	<Pine.LNX.4.64.0803291800070.22048@reclus.nhh.no>
Message-ID: <003001c89375$e869e590$b93db0b0$@niccolai@yale.edu>

Hi Roger et. al.!

Again, let me start by thanking the Spatial R group for almost 2 years of
fantastic help in my research.  I am currently working on a part of my
puzzle that can be easily done in image processing software such as ENVI but
I am looking for an R solution.  I have a list of lines objects gathered as
a SpatialLines object that "sits" on top of a SpatialGridDataFrame object.
I would like to collect all of the spectral intensity values (or z values)
from the "SpatialGridDataFrame" object that lie along the transect made from
any line of my SpatialLines object.  Here is imaginary code for what I would
like to accomplish

library(sp)
tmp.lines <- Lines(Line(rbind(rank.max2.test[1,1:2], tmp.coords[1,])),
ID=as.character(1))
looplen <- nrow(tmp.coords)
for ( i in 2:looplen){
i <- Lines(Line(rbind(rank.max2.test[1,1:2], tmp.coords[i,])),
ID=as.character(i))
tmp.lines <- c(tmp.lines, i)
}
tmp.slines <- SpatialLines(tmp.lines, proj4string = CRS(as.character(NA)))

where rank.max2.test[1,1:2]
[1] 945112.5 859834.5

And 
tmp.coords[1,]
[1] 945110.6 859848.5

## The above code works great at producing a SpatialLines object with
nrow(tmp.coords) lines

NOW the part that doesn't work
 Transect.values <- overlay(SGDF, tmp.slines[1])

Where SGDF is an object of class SpatialGridDataFrame.

Can this be accomplished as a SpatialLines class (or some polyline general
class) or does the overlay need points?  If I must use points to extract the
SGDF values, is there a way to convert the SpatialLines object into a set of
point coordinates at fixed intervals along the line.  Currently the lines
are only defined as starting and ending coordinates but I would want the
line "points" to occur every 1 meter along the line transect.

Many thanks in advance for any help in this endeavor,
Andrew

Andrew Niccolai
Doctoral Candidate
Yale University
office (203) 432-5144
cell (860) 402-6079



