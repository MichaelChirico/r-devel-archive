From tom@heng| @end|ng |rom gm@||@com  Tue Aug  6 18:45:10 2024
From: tom@heng| @end|ng |rom gm@||@com (Tomislav Hengl)
Date: Tue, 6 Aug 2024 18:45:10 +0200
Subject: [R-sig-Geo] Research assistant / Data scientist: Geovisualization
 and dashboard building for multivariate EO data
Message-ID: <6654a301-dd47-425b-8750-308fa31a8ab9@gmail.com>


We are hiring! "Data scientist: Geovisualization and dashboard building 
for multivariate EO data". Do you love making and innovating scientific 
visualizations with emphasis on web-GIS, time-series EO data and 
interactive dashboards? Are you competent at, and enjoy, developing 
computational notebooks using JupyterNotebooks and/or Quarto, debugging 
and problem solving using code? We might be a match!

Application Deadline: 1st of September 2024
Possible start date: 1st of October 2024
Duration: 3+ years,
Job location: Waldeck Pyrmontlaan 14, Doorwerth, the Netherlands
Bruto monthly salary: starting from ?3.420 gross per month (with 
possible bonuses)
Job type: research assistant
Fields: geovisualization, geocomputation, econometrics, environmental 
sciences, Earth observation, data science, environmental-economic accounting
Employer: OpenGeoHub Foundation.

For more info: 
https://opengeohub.org/jobs/data-scientist-geovisualization-and-dashboard-building-2024/

Qualifications:
1. You have an MSc degree in the field of data science, geoinformatics 
and/or environmental science; combined with a background in GIS, 
geocomputation and/or environmetrics.
2. You have at least 3?years of experience of working on 
geovisualization projects, building web-mapping tools, and visualizing 
complex multivariate data.
3. You have minimum required coding & geocomputing skills in programming 
languages such as Bash, R, and/or Python.
4. You enjoy creating super graphics and innovating how multivariate 
complex problems are visualized.
5. You are familiar with geovisualization tools and dashboards e.g. 
leaflet, rio-tiler, QGIS plugins, RShiny-based, Plotly, Grafana, Google 
Looker Studio and/or similar.
6. You are competent at, and enjoy, developing computational notebooks 
using jupyter and/or Quarto, debugging and problem solving using code.
7. You enjoy building UI?s, combining artwork and efficient 
web-functionality.
8. You have a high affinity to learn and teach / share knowledge across 
borders.
9. You are fluent in English.


From Gerh@rd@Wuehrer @end|ng |rom jku@@t  Wed Aug  7 12:01:30 2024
From: Gerh@rd@Wuehrer @end|ng |rom jku@@t (=?ISO-8859-1?Q?Gerhard=20W=FChrer?=)
Date: Wed, 07 Aug 2024 12:01:30 +0200
Subject: [R-sig-Geo] =?iso-8859-1?q?Antw=3A_R-sig-Geo_Digest=2C_Vol_252?=
 =?iso-8859-1?q?=2C_Issue_1_=28out_of_country/bin_au=DFerhalb_des_Landes?=
 =?iso-8859-1?q?=29?=
In-Reply-To: <B5A6CF7D0200005601F56C9B@s05gw01.im.jku.at>
References: <B5A6CF7D0200005601F56C9B@s05gw01.im.jku.at>
Message-ID: <66B345FA020000830006F46D@s05gw01.im.jku.at>

** Proprietary **
** Reply Requested When Convenient **

I am out of country till 10th of September. I check my mailbox less frequently. Enjoy life, have a good time and all the best to you - Gerhard A. W?hrer

Ich bin bis zum  10.9. nicht im B?ro zu erreichen. Ich gucke in meine Mailbox selten rein. Genie?en Sie das Leben, haben Sie eine gute Zeit und Ihnen alles Gute! Gerhard A. W?hrer


Em. o. Univ.-Prof. Dkfm. Dr. Gerhard A. W?hrer
Johannes Kepler Universit?t Linz

Institut f?r Handel, Absatz und Marketing
Altenberger Str. 69
4040 Linz/Austria
T.: 004373224687034

M.:004369917558526
fax.:004373224687035
mail: gerhard.wuehrer at jku.at

URL: www.marketing.jku.at

 


From m@p|no|@10 @end|ng |rom gm@||@com  Fri Aug  9 15:54:20 2024
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 9 Aug 2024 07:54:20 -0600
Subject: [R-sig-Geo] Night lights in R
Message-ID: <CABkCotSt05kOXVKaOo4os2fhqKD2Efp9QO016LE7wk-fnNEqUA@mail.gmail.com>

Dear list members,

Is there an R package or a way to obtain with R night lights for a specific
region or country?

I found 2 packages but they are outdated, rnighlights and nightlights.

Manuel

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Sitio web institucional: ICOMVIS
<http://www.icomvis.una.ac.cr/index.php/manuel>
Sitio web personal: Sitio personal <https://mspinola-sitioweb.netlify.app>
Blog sobre Ciencia de Datos: Blog de Ciencia de Datos
<https://mspinola-ciencia-de-datos.netlify.app>

	[[alternative HTML version deleted]]


From n|ko@@tz|ok@@ @end|ng |rom gm@||@com  Fri Aug  9 16:05:00 2024
From: n|ko@@tz|ok@@ @end|ng |rom gm@||@com (Nikolaos Tziokas)
Date: Fri, 9 Aug 2024 17:05:00 +0300
Subject: [R-sig-Geo] Night lights in R
In-Reply-To: <CABkCotSt05kOXVKaOo4os2fhqKD2Efp9QO016LE7wk-fnNEqUA@mail.gmail.com>
References: <CABkCotSt05kOXVKaOo4os2fhqKD2Efp9QO016LE7wk-fnNEqUA@mail.gmail.com>
Message-ID: <CAGg5H0YfhJWZ9vLKqikeHanRh=hy-KGFgdb9MpBB7ETNq39LbA@mail.gmail.com>

Blackmarbler

???? ???, 9 ??? 2024, 16:54 ? ??????? Manuel Sp?nola <mspinola10 at gmail.com>
??????:

> Dear list members,
>
> Is there an R package or a way to obtain with R night lights for a specific
> region or country?
>
> I found 2 packages but they are outdated, rnighlights and nightlights.
>
> Manuel
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.cr <mspinola at una.ac.cr>
> mspinola10 at gmail.com
> Tel?fono: (506) 8706 - 4662
> Sitio web institucional: ICOMVIS
> <http://www.icomvis.una.ac.cr/index.php/manuel>
> Sitio web personal: Sitio personal <https://mspinola-sitioweb.netlify.app>
> Blog sobre Ciencia de Datos: Blog de Ciencia de Datos
> <https://mspinola-ciencia-de-datos.netlify.app>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From m@p|no|@10 @end|ng |rom gm@||@com  Fri Aug  9 17:50:39 2024
From: m@p|no|@10 @end|ng |rom gm@||@com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 9 Aug 2024 09:50:39 -0600
Subject: [R-sig-Geo] Night lights in R
In-Reply-To: <CAGg5H0YfhJWZ9vLKqikeHanRh=hy-KGFgdb9MpBB7ETNq39LbA@mail.gmail.com>
References: <CABkCotSt05kOXVKaOo4os2fhqKD2Efp9QO016LE7wk-fnNEqUA@mail.gmail.com>
 <CAGg5H0YfhJWZ9vLKqikeHanRh=hy-KGFgdb9MpBB7ETNq39LbA@mail.gmail.com>
Message-ID: <CABkCotS+UnUv78AqZ7pQbVBNPpKXt+VC1mvig2Muof+v=cbWtg@mail.gmail.com>

Thank you very much!



*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.cr <mspinola at una.ac.cr>
mspinola10 at gmail.com
Tel?fono: (506) 8706 - 4662
Sitio web institucional: ICOMVIS
<http://www.icomvis.una.ac.cr/index.php/manuel>
Sitio web personal: Sitio personal <https://mspinola-sitioweb.netlify.app>
Blog sobre Ciencia de Datos: Blog de Ciencia de Datos
<https://mspinola-ciencia-de-datos.netlify.app>


El El vie, 9 ago 2024 a la(s) 08:05, Nikolaos Tziokas <
nikos.tziokas at gmail.com> escribi?:

> Blackmarbler
>
> ???? ???, 9 ??? 2024, 16:54 ? ??????? Manuel Sp?nola <mspinola10 at gmail.com>
> ??????:
>
>> Dear list members,
>>
>> Is there an R package or a way to obtain with R night lights for a
>> specific
>> region or country?
>>
>> I found 2 packages but they are outdated, rnighlights and nightlights.
>>
>> Manuel
>>
>> --
>> *Manuel Sp?nola, Ph.D.*
>> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
>> Universidad Nacional
>> Apartado 1350-3000
>> Heredia
>> COSTA RICA
>> mspinola at una.cr <mspinola at una.ac.cr>
>> mspinola10 at gmail.com
>> Tel?fono: (506) 8706 - 4662
>> Sitio web institucional: ICOMVIS
>> <http://www.icomvis.una.ac.cr/index.php/manuel>
>> Sitio web personal: Sitio personal <https://mspinola-sitioweb.netlify.app
>> >
>> Blog sobre Ciencia de Datos: Blog de Ciencia de Datos
>> <https://mspinola-ciencia-de-datos.netlify.app>
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>

	[[alternative HTML version deleted]]


From keren@r@|ter @end|ng |rom me@com  Mon Aug 12 10:19:02 2024
From: keren@r@|ter @end|ng |rom me@com (Keren Raiter)
Date: Mon, 12 Aug 2024 08:19:02 +0000 (UTC)
Subject: [R-sig-Geo] =?utf-8?q?Pre-processing_remotely-sensed_data_and_ca?=
 =?utf-8?q?lculating_MSAVI2_in_R?=
Message-ID: <fd352310-de6b-428b-959d-507280160a62@me.com>

Hello, I'm needing to calculate the modified soil-adjusted vegetation index (MSAVI2) for data captures for different years. The imagery I have to work with is plane fly-over imagery from 2010-2012 (the baseline), and GeoEye (or in some cases WorldView2) (the impact data). I know that comparing plane data with satellite data is very problematic but this is what I need to do for now. I have already calculated MSAVI2 for the GeoEye data including calculating the L value based on the gain, abscal factor, effective bandwidth and offset and then calculating the top-of-atmosphere reflectances (TOARs) based on Earth-Sun distances and solar exoatmospheric irradiance, before then calculating MSAVI2 based on the TOARs - i've done this manually with raster calculator and the i.vi tool in QGIS, but now am looking for a workflow to do this with script in R; plus to deal with the plane fly-over imagery too. Does anyone have recommendations for the most appropriate packages and functions within them for: - reprojecting, resampling and co-registering the different datasets - clipping / masking the datasets - because the different datasets cover different geographical extents so I need to look only at the areas that are common to both, and also because I'm just focusing on one vegetation type which i have a polygon (vector) layer for. - calculating MSAVI2 and comparing MSAVI values from different years - mapping results. If anyone could also please guide me on how to find example scripts that cover some or all of this workflow, or would be willing to share their code on this with me, I'd be eternally grateful! I have worked with rasters in R before but that was in the days of raster package and I'm not so sure what's the best tool suite for the current project. Thank you, Keren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20240812/42806cf7/attachment.html>

From t@v|b@r @end|ng |rom gm@||@com  Mon Aug 19 16:23:58 2024
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Mon, 19 Aug 2024 17:23:58 +0300
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
Message-ID: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>

Searching for the error in the subject line returns some discussions 
from a few years ago. But I'm not able to overcome this error.

Here's the polygon in question:

 > dput(aoi)

structure(list(x =

structure(list(structure(list(structure(c(11.0127043, 11.0127061, 
11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 
11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 
11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 
11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 
11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 
11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 
11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 
46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 
46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 
46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 
46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 
46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 
46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 
46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", 
"Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", 
"sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 
46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs 
= structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n 
ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World 
Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 
(G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n 
MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World 
Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 
(G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n 
ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n 
LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n 
PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n 
CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n 
ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic 
longitude (Lon)\",east,\n ORDER[2],\n 
ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal 
component of 3D system.\"],\n AREA[\"World.\"],\n 
BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty 
= 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", 
agr = structure(integer(0), class = "factor", levels = c("constant", 
"aggregate", "identity"), names = character(0)))

This polygon is used as area of interest to crop Copernicus imagery that 
I am downloading using the {CDSE} package. (I have run this workflow 
successfully many times with several other aoi polygons)

I have tried:

1- sf::st_make_valid()

2- transforming to a UTM CRS

3- extracting coordinates and recreating the polygon (i.e.:
aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
 ??? aoi3 <- aoi_p |>
 ? ??? st_sfc() |>
 ? ??? st_as_sf()
 ??? st_crs(aoi3) <- "EPSG:4326"

4- buffering by a small amount


The above error recurs in all cases (only with this problem polygon). 
Any suggestions?


Thanks


Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325

-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918


From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Mon Aug 19 18:40:23 2024
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Mon, 19 Aug 2024 18:40:23 +0200
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
Message-ID: <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>

Could you please provide an example of code that actually raises this error?
Best regards,
Zivan


On 19 Aug 2024, at 16:23, Micha Silver <tsvibar at gmail.com> wrote:

Searching for the error in the subject line returns some discussions from a few years ago. But I'm not able to overcome this error.

Here's the polygon in question:

> dput(aoi)

structure(list(x =

structure(list(structure(list(structure(c(11.0127043, 11.0127061, 11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", "Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", "sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs = structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 (G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 (G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic longitude (Lon)\",east,\n ORDER[2],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal component of 3D system.\"],\n AREA[\"World.\"],\n BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty = 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", agr = structure(integer(0), class = "factor", levels = c("constant", "aggregate", "identity"), names = character(0)))

This polygon is used as area of interest to crop Copernicus imagery that I am downloading using the {CDSE} package. (I have run this workflow successfully many times with several other aoi polygons)

I have tried:

1- sf::st_make_valid()

2- transforming to a UTM CRS

3- extracting coordinates and recreating the polygon (i.e.:
aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
    aoi3 <- aoi_p |>
      st_sfc() |>
      st_as_sf()
    st_crs(aoi3) <- "EPSG:4326"

4- buffering by a small amount


The above error recurs in all cases (only with this problem polygon). Any suggestions?


Thanks


Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325

-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Roger@B|v@nd @end|ng |rom nhh@no  Mon Aug 19 20:29:32 2024
From: Roger@B|v@nd @end|ng |rom nhh@no (Roger Bivand)
Date: Mon, 19 Aug 2024 18:29:32 +0000
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
Message-ID: <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>

Adding the output of sessionInfo() and sf_extSoftVersion() might also help. The difficulty Zivan points out is that the structure as read is valid, but before conversion to text by dput() may have actually had non-identical first and last coordinates, because of the number of digits used. Also try putting the file created by saveRDS(aoi, ...) on a website with a link here. It would be useful to see the code in the workflow at the point of failure (you point to Error in MtrxSet, maybe also run traceback() after the failure to give more precision in where this is occurring, maybe in stars?

Hop this helps,

Roger

--
Roger Bivand
Emeritus Professor
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no

________________________________________
From: R-sig-Geo <r-sig-geo-bounces at r-project.org> on behalf of Zivan Karaman <zivan.karaman at gmail.com>
Sent: 19 August 2024 18:40
To: Micha Silver
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed

Could you please provide an example of code that actually raises this error?
Best regards,
Zivan


On 19 Aug 2024, at 16:23, Micha Silver <tsvibar at gmail.com> wrote:

Searching for the error in the subject line returns some discussions from a few years ago. But I'm not able to overcome this error.

Here's the polygon in question:

> dput(aoi)

structure(list(x =

structure(list(structure(list(structure(c(11.0127043, 11.0127061, 11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", "Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", "sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs = structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 (G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 (G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic longitude (Lon)\",east,\n ORDER[2],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal component of 3D system.\"],\n AREA[\"World.\"],\n BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty = 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", agr = structure(integer(0), class = "factor", levels = c("constant", "aggregate", "identity"), names = character(0)))

This polygon is used as area of interest to crop Copernicus imagery that I am downloading using the {CDSE} package. (I have run this workflow successfully many times with several other aoi polygons)

I have tried:

1- sf::st_make_valid()

2- transforming to a UTM CRS

3- extracting coordinates and recreating the polygon (i.e.:
aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
    aoi3 <- aoi_p |>
      st_sfc() |>
      st_as_sf()
    st_crs(aoi3) <- "EPSG:4326"

4- buffering by a small amount


The above error recurs in all cases (only with this problem polygon). Any suggestions?


Thanks


Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918
https://orcid.org/0000-0002-1128-1325

--
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From t@v|b@r @end|ng |rom gm@||@com  Tue Aug 20 09:25:15 2024
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Tue, 20 Aug 2024 10:25:15 +0300
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
 <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <c88ff5dd-bdd4-4686-bc78-e4cae9fe9e37@gmail.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20240820/fe72f0de/attachment.html>

From mzyphur m@iii@g oii i@st@ts@org  Tue Aug 20 10:20:01 2024
From: mzyphur m@iii@g oii i@st@ts@org (mzyphur m@iii@g oii i@st@ts@org)
Date: Tue, 20 Aug 2024 08:20:01 +0000 (UTC)
Subject: [R-sig-Geo] Using ChatGPT and Copilot for Data Analysis in R -
 livestream seminar
Message-ID: <bl2xWnM_RqCgCjKfCr1zAQ@geopod-ismtpd-2>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20240820/5270118a/attachment.html>

From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Tue Aug 20 10:27:33 2024
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Tue, 20 Aug 2024 10:27:33 +0200
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <c88ff5dd-bdd4-4686-bc78-e4cae9fe9e37@gmail.com>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
 <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
 <c88ff5dd-bdd4-4686-bc78-e4cae9fe9e37@gmail.com>
Message-ID: <C475668C-2FBB-435F-8FBC-9394B034D499@gmail.com>

Hi Micha,
Thank you for sharing the file.
I?ve noticed that this polygon has only 5 vertices, while the one in the previous message has 40, so this is not exactly the same object. Both seem OK, and I was able to download and crop satellite images with CDSE without problems.
Difficult to say more without a reproducible example raising the error. 
Best,
Zivan


On 20 Aug 2024, at 09:25, Micha Silver <tsvibar at gmail.com> wrote:

Hi Zivan, Roger:
Thanks for the quick response.Here's the RDS of the polygon:
https://filebin.net/pdrazh0e4ej7el9f

and sessionInfo, etc:

> sessionInfo()
R version 4.2.2 Patched (2022-11-10 r83330)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 12 (bookworm)

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so <http://libblas.so/>.3
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so <http://libopenblasp-r0.3.21.so/>

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_IL.UTF-8       
 [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_IL.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
[10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] tidyr_1.3.1       sf_1.0-16         dplyr_1.1.4       lubridate_1.9.3  
 [5] RSQLite_2.3.7     CDSE_0.2.0        rOPTRAM_0.3.0.000 ggplot2_3.5.1    
 [9] knitr_1.47        terra_1.7-78      devtools_2.4.5    usethis_2.2.3    

loaded via a namespace (and not attached):
 [1] pkgload_1.3.4      bit64_4.0.5        jsonlite_1.8.8     here_1.0.1        
 [5] shiny_1.8.1.1      askpass_1.2.0      blob_1.2.4         remotes_2.5.0     
 [9] sessioninfo_1.2.2  pillar_1.9.0       glue_1.7.0         digest_0.6.35     
[13] promises_1.3.0     colorspace_2.1-0   htmltools_0.5.8.1  httpuv_1.6.15     
[17] pkgconfig_2.0.3    s2_1.1.6           purrr_1.0.2        xtable_1.8-4      
[21] scales_1.3.0       processx_3.8.4     later_1.3.2        openssl_2.2.0     
[25] timechange_0.3.0   tibble_3.2.1       proxy_0.4-27       generics_0.1.3    
[29] ellipsis_0.3.2     cachem_1.1.0       withr_3.0.0        cli_3.6.3         
[33] lutz_0.3.2         magrittr_2.0.3     mime_0.12          memoise_2.0.1     
[37] ps_1.7.6           fs_1.6.4           fansi_1.0.6        class_7.3-22      
[41] geojsonsf_2.0.3    pkgbuild_1.4.4     httr2_1.0.1        profvis_0.3.8     
[45] tools_4.2.2        lifecycle_1.0.4    stringr_1.5.1      munsell_0.5.1     
[49] callr_3.7.6        compiler_4.2.2     e1071_1.7-14       rlang_1.1.4       
[53] classInt_0.4-10    units_0.8-5        grid_4.2.2         rstudioapi_0.16.0 
[57] rappdirs_0.3.3     htmlwidgets_1.6.4  miniUI_0.1.1.1     wk_0.9.2          
[61] gtable_0.3.5       codetools_0.2-20   DBI_1.2.3          curl_5.2.1        
[65] R6_2.5.1           fastmap_1.2.0      bit_4.0.5          utf8_1.2.4        
[69] rprojroot_2.0.4    KernSmooth_2.23-24 desc_1.4.3         stringi_1.8.4     
[73] Rcpp_1.0.12        vctrs_0.6.5        tidyselect_1.2.1   xfun_0.45         
[77] urlchecker_1.0.1  
> sf_extSoftVersion()
          GEOS           GDAL         proj.4 GDAL_with_GEOS     USE_PROJ_H 
      "3.11.1"        "3.6.2"        "9.1.1"         "true"         "true" 
          PROJ 
       "9.1.1" 

This error occurs, during a longer analysis, when I begin downloading imagery , and only with the above aoi polygon. So I'm trying to strip out all the steps in the code to identify what the cause is. No luck yet... Note: I don't think that the CDSE package is the cause.

Best regards, Micha


On 19/08/2024 21:29, Roger Bivand wrote:
> Adding the output of sessionInfo() and sf_extSoftVersion() might also help. The difficulty Zivan points out is that the structure as read is valid, but before conversion to text by dput() may have actually had non-identical first and last coordinates, because of the number of digits used. Also try putting the file created by saveRDS(aoi, ...) on a website with a link here. It would be useful to see the code in the workflow at the point of failure (you point to Error in MtrxSet, maybe also run traceback() after the failure to give more precision in where this is occurring, maybe in stars?
> 
> Hop this helps,
> 
> Roger
> 
> --
> Roger Bivand
> Emeritus Professor
> Norwegian School of Economics
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
> Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> 
> ________________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> <mailto:r-sig-geo-bounces at r-project.org> on behalf of Zivan Karaman <zivan.karaman at gmail.com> <mailto:zivan.karaman at gmail.com>
> Sent: 19 August 2024 18:40
> To: Micha Silver
> Cc: R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> Subject: Re: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
> 
> Could you please provide an example of code that actually raises this error?
> Best regards,
> Zivan
> 
> 
> On 19 Aug 2024, at 16:23, Micha Silver <tsvibar at gmail.com> <mailto:tsvibar at gmail.com> wrote:
> 
> Searching for the error in the subject line returns some discussions from a few years ago. But I'm not able to overcome this error.
> 
> Here's the polygon in question:
> 
>> dput(aoi)
> structure(list(x =
> 
> structure(list(structure(list(structure(c(11.0127043, 11.0127061, 11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", "Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", "sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs = structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 (G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 (G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic longitude (Lon)\",east,\n ORDER[2],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal component of 3D system.\"],\n AREA[\"World.\"],\n BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty = 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", agr = structure(integer(0), class = "factor", levels = c("constant", "aggregate", "identity"), names = character(0)))
> 
> This polygon is used as area of interest to crop Copernicus imagery that I am downloading using the {CDSE} package. (I have run this workflow successfully many times with several other aoi polygons)
> 
> I have tried:
> 
> 1- sf::st_make_valid()
> 
> 2- transforming to a UTM CRS
> 
> 3- extracting coordinates and recreating the polygon (i.e.:
> aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
>     aoi3 <- aoi_p |>
>       st_sfc() |>
>       st_as_sf()
>     st_crs(aoi3) <- "EPSG:4326"
> 
> 4- buffering by a small amount
> 
> 
> The above error recurs in all cases (only with this problem polygon). Any suggestions?
> 
> 
> Thanks
> 
> 
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> https://orcid.org/0000-0002-1128-1325
> 
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Micha Silver
Remote Sensing Lab, Sde Boker
Ben Gurion University
+972-523-665918


	[[alternative HTML version deleted]]


From t@v|b@r @end|ng |rom gm@||@com  Tue Aug 20 10:35:33 2024
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Tue, 20 Aug 2024 11:35:33 +0300
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <C475668C-2FBB-435F-8FBC-9394B034D499@gmail.com>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
 <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
 <c88ff5dd-bdd4-4686-bc78-e4cae9fe9e37@gmail.com>
 <C475668C-2FBB-435F-8FBC-9394B034D499@gmail.com>
Message-ID: <cc1b1740-81cd-4862-9806-2af1ddcb95d9@gmail.com>


On 20/08/2024 11:27, Zivan Karaman wrote:
> Hi Micha,
> Thank you for sharing the file.
> I?ve noticed that this polygon has only 5 vertices, while the one in 
> the previous message has 40, so this is not exactly the same object. 
> Both seem OK, and I was able to download and crop satellite images 
> with CDSE without problems.

Yes, I used several polygon versions to try to isolate the problem.

When I use this polygon as aoi directly in a CDSE::GetImage() call it 
works fine also for me. So the issue is elsewhere. I'll continue to 
investigate.


> Difficult to say more without a reproducible example raising the error.
> Best,
> Zivan
>
>
> On 20 Aug 2024, at 09:25, Micha Silver <tsvibar at gmail.com> wrote:
>
> Hi Zivan, Roger:
> Thanks for the quick response.Here's the RDS of the polygon:
> https://filebin.net/pdrazh0e4ej7el9f
>
> and sessionInfo, etc:
>
> > sessionInfo()
> R version 4.2.2 Patched (2022-11-10 r83330)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Debian GNU/Linux 12 (bookworm)
>
> Matrix products: default
> BLAS:?? /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so 
> <http://libblas.so/>.3
> LAPACK: 
> /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so 
> <http://libopenblasp-r0.3.21.so/>
>
> locale:
> ?[1] LC_CTYPE=en_US.UTF-8?????? LC_NUMERIC=C LC_TIME=en_IL.UTF-8
> ?[4] LC_COLLATE=en_US.UTF-8???? LC_MONETARY=en_IL.UTF-8 
> LC_MESSAGES=en_US.UTF-8
> ?[7] LC_PAPER=en_US.UTF-8?????? LC_NAME=C LC_ADDRESS=C
> [10] LC_TELEPHONE=C???????????? LC_MEASUREMENT=en_US.UTF-8 
> LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats???? graphics? grDevices utils???? datasets methods?? base
>
> other attached packages:
> ?[1] tidyr_1.3.1?????? sf_1.0-16???????? dplyr_1.1.4 lubridate_1.9.3
> ?[5] RSQLite_2.3.7???? CDSE_0.2.0??????? rOPTRAM_0.3.0.000 ggplot2_3.5.1
> ?[9] knitr_1.47??????? terra_1.7-78????? devtools_2.4.5 usethis_2.2.3
>
> loaded via a namespace (and not attached):
> ?[1] pkgload_1.3.4????? bit64_4.0.5 jsonlite_1.8.8???? here_1.0.1
> ?[5] shiny_1.8.1.1????? askpass_1.2.0 blob_1.2.4???????? remotes_2.5.0
> ?[9] sessioninfo_1.2.2? pillar_1.9.0 glue_1.7.0???????? digest_0.6.35
> [13] promises_1.3.0???? colorspace_2.1-0 htmltools_0.5.8.1? httpuv_1.6.15
> [17] pkgconfig_2.0.3??? s2_1.1.6 purrr_1.0.2??????? xtable_1.8-4
> [21] scales_1.3.0?????? processx_3.8.4 later_1.3.2??????? openssl_2.2.0
> [25] timechange_0.3.0?? tibble_3.2.1 proxy_0.4-27?????? generics_0.1.3
> [29] ellipsis_0.3.2???? cachem_1.1.0 withr_3.0.0??????? cli_3.6.3
> [33] lutz_0.3.2???????? magrittr_2.0.3 mime_0.12????????? memoise_2.0.1
> [37] ps_1.7.6?????????? fs_1.6.4 fansi_1.0.6??????? class_7.3-22
> [41] geojsonsf_2.0.3??? pkgbuild_1.4.4 httr2_1.0.1??????? profvis_0.3.8
> [45] tools_4.2.2??????? lifecycle_1.0.4 stringr_1.5.1????? munsell_0.5.1
> [49] callr_3.7.6??????? compiler_4.2.2 e1071_1.7-14?????? rlang_1.1.4
> [53] classInt_0.4-10??? units_0.8-5 grid_4.2.2???????? rstudioapi_0.16.0
> [57] rappdirs_0.3.3???? htmlwidgets_1.6.4 miniUI_0.1.1.1???? wk_0.9.2
> [61] gtable_0.3.5?????? codetools_0.2-20 DBI_1.2.3????????? curl_5.2.1
> [65] R6_2.5.1?????????? fastmap_1.2.0 bit_4.0.5????????? utf8_1.2.4
> [69] rprojroot_2.0.4??? KernSmooth_2.23-24 desc_1.4.3???????? 
> stringi_1.8.4
> [73] Rcpp_1.0.12??????? vctrs_0.6.5 tidyselect_1.2.1?? xfun_0.45
> [77] urlchecker_1.0.1
> > sf_extSoftVersion()
> ????????? GEOS?????????? GDAL???????? proj.4 GDAL_with_GEOS???? USE_PROJ_H
> ????? "3.11.1"??????? "3.6.2"??????? "9.1.1" "true"???????? "true"
> ????????? PROJ
> ?????? "9.1.1"
>
> This error occurs, during a longer analysis, when I begin downloading 
> imagery , and only with the above aoi polygon. So I'm trying to strip 
> out all the steps in the code to identify what the cause is. No luck 
> yet... Note: I don't think that the CDSE package is the cause.
>
> Best regards, Micha
>
>
> On 19/08/2024 21:29, Roger Bivand wrote:
>> Adding the output of sessionInfo() and sf_extSoftVersion() might also help. The difficulty Zivan points out is that the structure as read is valid, but before conversion to text by dput() may have actually had non-identical first and last coordinates, because of the number of digits used. Also try putting the file created by saveRDS(aoi, ...) on a website with a link here. It would be useful to see the code in the workflow at the point of failure (you point to Error in MtrxSet, maybe also run traceback() after the failure to give more precision in where this is occurring, maybe in stars?
>>
>> Hop this helps,
>>
>> Roger
>>
>> --
>> Roger Bivand
>> Emeritus Professor
>> Norwegian School of Economics
>> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
>> Roger.Bivand at nhh.no
>>
>> ________________________________________
>> From: R-sig-Geo<r-sig-geo-bounces at r-project.org>  on behalf of Zivan Karaman<zivan.karaman at gmail.com>
>> Sent: 19 August 2024 18:40
>> To: Micha Silver
>> Cc:R-sig-Geo at r-project.org
>> Subject: Re: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
>>
>> Could you please provide an example of code that actually raises this error?
>> Best regards,
>> Zivan
>>
>>
>> On 19 Aug 2024, at 16:23, Micha Silver<tsvibar at gmail.com>  wrote:
>>
>> Searching for the error in the subject line returns some discussions from a few years ago. But I'm not able to overcome this error.
>>
>> Here's the polygon in question:
>>
>>> dput(aoi)
>> structure(list(x =
>>
>> structure(list(structure(list(structure(c(11.0127043, 11.0127061, 11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", "Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", "sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs = structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 (G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 (G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic longitude (Lon)\",east,\n ORDER[2],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal component of 3D system.\"],\n AREA[\"World.\"],\n BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty = 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", agr = structure(integer(0), class = "factor", levels = c("constant", "aggregate", "identity"), names = character(0)))
>>
>> This polygon is used as area of interest to crop Copernicus imagery that I am downloading using the {CDSE} package. (I have run this workflow successfully many times with several other aoi polygons)
>>
>> I have tried:
>>
>> 1- sf::st_make_valid()
>>
>> 2- transforming to a UTM CRS
>>
>> 3- extracting coordinates and recreating the polygon (i.e.:
>> aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
>>      aoi3 <- aoi_p |>
>>        st_sfc() |>
>>        st_as_sf()
>>      st_crs(aoi3) <- "EPSG:4326"
>>
>> 4- buffering by a small amount
>>
>>
>> The above error recurs in all cases (only with this problem polygon). Any suggestions?
>>
>>
>> Thanks
>>
>>
>> Micha Silver
>> Ben Gurion Univ.
>> Sde Boker, Remote Sensing Lab
>> cell: +972-523-665918
>> https://orcid.org/0000-0002-1128-1325
>>
>> --
>> Micha Silver
>> Ben Gurion Univ.
>> Sde Boker, Remote Sensing Lab
>> cell: +972-523-665918
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> -- 
> Micha Silver
> Remote Sensing Lab, Sde Boker
> Ben Gurion University
> +972-523-665918
>
-- 
Micha Silver
Remote Sensing Lab, Sde Boker
Ben Gurion University
+972-523-665918


From t@v|b@r @end|ng |rom gm@||@com  Wed Aug 21 18:59:47 2024
From: t@v|b@r @end|ng |rom gm@||@com (Micha Silver)
Date: Wed, 21 Aug 2024 19:59:47 +0300
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
 <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
Message-ID: <598b3b3e-3332-47a6-9fe2-26943f3bd1ee@gmail.com>

An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20240821/8ebdb716/attachment.html>

From z|v@n@k@r@m@n @end|ng |rom gm@||@com  Wed Aug 21 19:57:04 2024
From: z|v@n@k@r@m@n @end|ng |rom gm@||@com (Zivan Karaman)
Date: Wed, 21 Aug 2024 19:57:04 +0200
Subject: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
In-Reply-To: <598b3b3e-3332-47a6-9fe2-26943f3bd1ee@gmail.com>
References: <38936199-b8fa-4924-8f2e-79d0dae32a3f@gmail.com>
 <7FF9B3D8-3614-4501-99C1-3BE603B31AFC@gmail.com>
 <SV0P279MB0475616B0A33A5D797A189E6EE8C2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>
 <598b3b3e-3332-47a6-9fe2-26943f3bd1ee@gmail.com>
Message-ID: <7170BCAB-23BC-4E41-85A6-29807E6DD37B@gmail.com>

Thanks for the update.
Indeed, I have noticed that this polygon is on the edge of Sentinel-2 tiles. As a result, the AOI gets covered with two different tiles on every overpass, but not completely (bad luck for a 4.5 ha field!). Even the images that display 100% area coverage actually miss a tiny, tiny fraction of it (approximately 4e-10).
catalog <- SearchCatalog(aoi = aoi, from = "2023-06-01", to = "2023-08-31", collection = "sentinel-2-l2a?, with_geometry = TRUE, client = OAuthClient)
100 - subset(catalog, areaCoverage > 99)$areaCoverage
##  [1] 4.085194e-10 4.085194e-10 4.085194e-10 4.085194e-10 4.085194e-10 ...
I'm not sure if this could be the source of the problem, but it's good that you found a workaround.
Best regards,
Zivan


On 21 Aug 2024, at 18:59, Micha Silver <tsvibar at gmail.com> wrote:

Follow up:
After some gnawing of my teeth, I found the problem: Nothing to do with R, sf, nor the CDSE package. My date range included one date where the Sentinel-2 tile from Copernicus data space was damaged/clipped/mangled. And my study area was "hanging over the edge".  I found the problem image using the Copernicus Dataspace browser, and going thru date by date...
I'm not sure why exactly that caused the error, but once I changed the date range to exclude that problem image, the procedure worked as expected.

Thanks for your help.

On 19/08/2024 21:29, Roger Bivand wrote:
> Adding the output of sessionInfo() and sf_extSoftVersion() might also help. The difficulty Zivan points out is that the structure as read is valid, but before conversion to text by dput() may have actually had non-identical first and last coordinates, because of the number of digits used. Also try putting the file created by saveRDS(aoi, ...) on a website with a link here. It would be useful to see the code in the workflow at the point of failure (you point to Error in MtrxSet, maybe also run traceback() after the failure to give more precision in where this is occurring, maybe in stars?
> 
> Hop this helps,
> 
> Roger
> 
> --
> Roger Bivand
> Emeritus Professor
> Norwegian School of Economics
> Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
> Roger.Bivand at nhh.no <mailto:Roger.Bivand at nhh.no>
> 
> ________________________________________
> From: R-sig-Geo <r-sig-geo-bounces at r-project.org> <mailto:r-sig-geo-bounces at r-project.org> on behalf of Zivan Karaman <zivan.karaman at gmail.com> <mailto:zivan.karaman at gmail.com>
> Sent: 19 August 2024 18:40
> To: Micha Silver
> Cc: R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> Subject: Re: [R-sig-Geo] Error in MtrxSet ... polygons not (all) closed
> 
> Could you please provide an example of code that actually raises this error?
> Best regards,
> Zivan
> 
> 
> On 19 Aug 2024, at 16:23, Micha Silver <tsvibar at gmail.com> <mailto:tsvibar at gmail.com> wrote:
> 
> Searching for the error in the subject line returns some discussions from a few years ago. But I'm not able to overcome this error.
> 
> Here's the polygon in question:
> 
>> dput(aoi)
> structure(list(x =
> 
> structure(list(structure(list(structure(c(11.0127043, 11.0127061, 11.0134526, 11.0134554, 11.0134626, 11.0134692, 11.0134776, 11.0134813, 11.0157343, 11.0157373, 11.0157437, 11.0157495, 11.0157546, 11.0157585, 11.015761, 11.0157617, 11.0157616, 11.0157613, 11.0153992, 11.0153983, 11.0153956, 11.0153922, 11.0153869, 11.0153804, 11.0153729, 11.0153694, 11.0127478, 11.0127447, 11.0127379, 11.012732, 11.0127269, 11.0127232, 11.0127212, 11.01272, 11.0127197, 11.0126956, 11.0126958, 11.0126965, 11.0126978, 11.0127004, 11.0127043, 46.8484069, 46.8484048, 46.8476584, 46.847656, 46.8476511, 46.8476481, 46.8476461, 46.8476456, 46.8475213, 46.8475214, 46.847522, 46.8475235, 46.8475266, 46.8475311, 46.8475365, 46.8475425, 46.8475489, 46.8475519, 46.8495623, 46.8495656, 46.8495729, 46.8495788, 46.8495833, 46.8495856, 46.849587, 46.8495874, 46.8496081, 46.8496079, 46.8496069, 46.849605, 46.8496014, 46.8495965, 46.8495906, 46.8495839, 46.8495808, 46.8484309, 46.8484282, 46.8484218, 46.8484166, 46.848412, 46.8484069), dim = c(41L, 2L), dimnames = list( NULL, c("X", "Y")))), class = c("XY", "POLYGON", "sfg"))), class = c("sfc_POLYGON", "sfc"), precision = 0, bbox = structure(c(xmin = 11.0126956, ymin = 46.8475213, xmax = 11.0157617, ymax = 46.8496081), class = "bbox"), crs = structure(list( input = "EPSG:4326", wkt = "GEOGCRS[\"WGS 84\",\n ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n MEMBER[\"World Geodetic System 1984 (Transit)\"],\n MEMBER[\"World Geodetic System 1984 (G730)\"],\n MEMBER[\"World Geodetic System 1984 (G873)\"],\n MEMBER[\"World Geodetic System 1984 (G1150)\"],\n MEMBER[\"World Geodetic System 1984 (G1674)\"],\n MEMBER[\"World Geodetic System 1984 (G1762)\"],\n MEMBER[\"World Geodetic System 1984 (G2139)\"],\n ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n LENGTHUNIT[\"metre\",1]],\n ENSEMBLEACCURACY[2.0]],\n PRIMEM[\"Greenwich\",0,\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n CS[ellipsoidal,2],\n AXIS[\"geodetic latitude (Lat)\",north,\n ORDER[1],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n AXIS[\"geodetic longitude (Lon)\",east,\n ORDER[2],\n ANGLEUNIT[\"degree\",0.0174532925199433]],\n USAGE[\n SCOPE[\"Horizontal component of 3D system.\"],\n AREA[\"World.\"],\n BBOX[-90,-180,90,180]],\n ID[\"EPSG\",4326]]"), class = "crs"), n_empty = 0L)), row.names = 1L, class = c("sf", "data.frame"), sf_column = "x", agr = structure(integer(0), class = "factor", levels = c("constant", "aggregate", "identity"), names = character(0)))
> 
> This polygon is used as area of interest to crop Copernicus imagery that I am downloading using the {CDSE} package. (I have run this workflow successfully many times with several other aoi polygons)
> 
> I have tried:
> 
> 1- sf::st_make_valid()
> 
> 2- transforming to a UTM CRS
> 
> 3- extracting coordinates and recreating the polygon (i.e.:
> aoi_p <- st_polygon(list(st_coordinates(aoi)[,1:2]))
>     aoi3 <- aoi_p |>
>       st_sfc() |>
>       st_as_sf()
>     st_crs(aoi3) <- "EPSG:4326"
> 
> 4- buffering by a small amount
> 
> 
> The above error recurs in all cases (only with this problem polygon). Any suggestions?
> 
> 
> Thanks
> 
> 
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> https://orcid.org/0000-0002-1128-1325
> 
> --
> Micha Silver
> Ben Gurion Univ.
> Sde Boker, Remote Sensing Lab
> cell: +972-523-665918
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Micha Silver
Ben Gurion Univ.
Sde Boker, Remote Sensing Lab
cell: +972-523-665918


	[[alternative HTML version deleted]]


