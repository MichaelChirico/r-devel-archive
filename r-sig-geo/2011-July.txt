From aslantas at metu.edu.tr  Fri Jul  1 13:12:25 2011
From: aslantas at metu.edu.tr (=?ISO-8859-9?Q?P=FDnar_Aslantas_Bostan?=)
Date: Fri, 1 Jul 2011 14:12:25 +0300
Subject: [R-sig-Geo] space-time kriging
Message-ID: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110701/57425986/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Jul  1 13:50:26 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 01 Jul 2011 13:50:26 +0200
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>
Message-ID: <4E0DB482.2080400@uni-muenster.de>

Hi Pinar,

as you say, some data are missing, but the way you create index suggests
none are missing. Does your table "prec" have information for each
observation on which location and at which time it has been taken? Could
you maybe show how prec[1:10,] looks like?

Wbr,

On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
> Dear all,
> 
>  
> 
> I am working about space-time (ST) kriging. I want to make ST ordinary
> kriging with sparse data set. Dependent data is annual precipitation
> measured from 257 meteorological station. Observation period starts from
> 1970 and finishes at 2008, so temporal entity of my study contains 39
> year-value. Precipitation data comprised from 5365 value. It is not equal to
> 257 (location) *39 (time), because some stations has no value for some
> years. Therefore my data set fits to STSDF. An index table is required for
> STSDF object. But I could not create correct index object, my code does not
> work. 
> 
>  
> 
> I tried to summarize my code:
> 
>  
> 
> # creating STSDF object
> 
>  
> 
> # sp is spatial entity (257 spatial location)
> 
> # time is temporal entity (39 year period)
> 
> # prec is data attribute (5365 number of annual precipitation value)
> 
>  
> 
> index <- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
> 
> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
> 
>  
> 
> Error: nrow(object at index) == nrow(object at data) is not TRUE
> 
>  
> 
> Can you please help me about this error, how can I create correct index
> object?
> 
>  
> 
> Thank you all in advance!
> 
> With my best regards,
> 
> Pinar
> 
>  
> 
>  
> 
> Pinar Aslantas Bostan
> 
> Research Assistant
> 
> Department of Geodetic and
> 
> Geographic Information Technologies (GGIT) Middle East Technical University
> 
> 06531 Ankara/TURKEY
> 
> aslantas at metu.edu.tr
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From aslantas at metu.edu.tr  Fri Jul  1 14:02:46 2011
From: aslantas at metu.edu.tr (=?utf-8?Q?P=C4=B1nar_Aslantas_Bostan?=)
Date: Fri, 1 Jul 2011 15:02:46 +0300
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <4E0DB482.2080400@uni-muenster.de>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>
	<4E0DB482.2080400@uni-muenster.de>
Message-ID: <001301cc37e6$ca4f9280$5eeeb780$@edu.tr>

Hi Edzer,

Thank you for your mail. 
Prec data has location and time information. 

> prec_data[1:10,] 
   Station      X       Y   Prec Year Month Day
1    17020 693894 4931348 1274.4 1970     1   1
2    17020 693894 4931348 1134.3 1971     1   1
3    17020 693894 4931348  940.7 1972     1   1
4    17020 693894 4931348 1253.3 1973     1   1
5    17020 693894 4931348  940.8 1974     1   1
6    17020 693894 4931348  913.4 1975     1   1
7    17020 693894 4931348  895.3 1976     1   1
8    17020 693894 4931348  803.5 1977     1   1
9    17020 693894 4931348  993.1 1978     1   1
10   17020 693894 4931348  976.4 1979     1   1


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Friday, July 01, 2011 2:50 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] space-time kriging

Hi Pinar,

as you say, some data are missing, but the way you create index suggests
none are missing. Does your table "prec" have information for each
observation on which location and at which time it has been taken? Could
you maybe show how prec[1:10,] looks like?

Wbr,

On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
> Dear all,
> 
>  
> 
> I am working about space-time (ST) kriging. I want to make ST ordinary
> kriging with sparse data set. Dependent data is annual precipitation
> measured from 257 meteorological station. Observation period starts from
> 1970 and finishes at 2008, so temporal entity of my study contains 39
> year-value. Precipitation data comprised from 5365 value. It is not equal to
> 257 (location) *39 (time), because some stations has no value for some
> years. Therefore my data set fits to STSDF. An index table is required for
> STSDF object. But I could not create correct index object, my code does not
> work. 
> 
>  
> 
> I tried to summarize my code:
> 
>  
> 
> # creating STSDF object
> 
>  
> 
> # sp is spatial entity (257 spatial location)
> 
> # time is temporal entity (39 year period)
> 
> # prec is data attribute (5365 number of annual precipitation value)
> 
>  
> 
> index <- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
> 
> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
> 
>  
> 
> Error: nrow(object at index) == nrow(object at data) is not TRUE
> 
>  
> 
> Can you please help me about this error, how can I create correct index
> object?
> 
>  
> 
> Thank you all in advance!
> 
> With my best regards,
> 
> Pinar
> 
>  
> 
>  
> 
> Pinar Aslantas Bostan
> 
> Research Assistant
> 
> Department of Geodetic and
> 
> Geographic Information Technologies (GGIT) Middle East Technical University
> 
> 06531 Ankara/TURKEY
> 
> aslantas at metu.edu.tr
> 
>  
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tom.gottfried at tum.de  Fri Jul  1 14:34:51 2011
From: tom.gottfried at tum.de (Tom Gottfried)
Date: Fri, 01 Jul 2011 14:34:51 +0200
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <001301cc37e6$ca4f9280$5eeeb780$@edu.tr>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>	<4E0DB482.2080400@uni-muenster.de>
	<001301cc37e6$ca4f9280$5eeeb780$@edu.tr>
Message-ID: <4E0DBEEB.2010605@tum.de>

You could try

index <- cbind(as.integer(as.factor(prec_data$Station)), as.integer(as.factor(prec_data$Year)))

Tom


Am 01.07.2011 14:02, schrieb P?nar Aslantas Bostan:
> Hi Edzer,
>
> Thank you for your mail.
> Prec data has location and time information.
>
>> prec_data[1:10,]
>     Station      X       Y   Prec Year Month Day
> 1    17020 693894 4931348 1274.4 1970     1   1
> 2    17020 693894 4931348 1134.3 1971     1   1
> 3    17020 693894 4931348  940.7 1972     1   1
> 4    17020 693894 4931348 1253.3 1973     1   1
> 5    17020 693894 4931348  940.8 1974     1   1
> 6    17020 693894 4931348  913.4 1975     1   1
> 7    17020 693894 4931348  895.3 1976     1   1
> 8    17020 693894 4931348  803.5 1977     1   1
> 9    17020 693894 4931348  993.1 1978     1   1
> 10   17020 693894 4931348  976.4 1979     1   1
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Friday, July 01, 2011 2:50 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] space-time kriging
>
> Hi Pinar,
>
> as you say, some data are missing, but the way you create index suggests
> none are missing. Does your table "prec" have information for each
> observation on which location and at which time it has been taken? Could
> you maybe show how prec[1:10,] looks like?
>
> Wbr,
>
> On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
>> Dear all,
>>
>>
>>
>> I am working about space-time (ST) kriging. I want to make ST ordinary
>> kriging with sparse data set. Dependent data is annual precipitation
>> measured from 257 meteorological station. Observation period starts from
>> 1970 and finishes at 2008, so temporal entity of my study contains 39
>> year-value. Precipitation data comprised from 5365 value. It is not equal to
>> 257 (location) *39 (time), because some stations has no value for some
>> years. Therefore my data set fits to STSDF. An index table is required for
>> STSDF object. But I could not create correct index object, my code does not
>> work.
>>
>>
>>
>> I tried to summarize my code:
>>
>>
>>
>> # creating STSDF object
>>
>>
>>
>> # sp is spatial entity (257 spatial location)
>>
>> # time is temporal entity (39 year period)
>>
>> # prec is data attribute (5365 number of annual precipitation value)
>>
>>
>>
>> index<- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
>>
>> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
>>
>>
>>
>> Error: nrow(object at index) == nrow(object at data) is not TRUE
>>
>>
>>
>> Can you please help me about this error, how can I create correct index
>> object?
>>
>>
>>
>> Thank you all in advance!
>>
>> With my best regards,
>>
>> Pinar
>>
>>
>>
>>
>>
>> Pinar Aslantas Bostan
>>
>> Research Assistant
>>
>> Department of Geodetic and
>>
>> Geographic Information Technologies (GGIT) Middle East Technical University
>>
>> 06531 Ankara/TURKEY
>>
>> aslantas at metu.edu.tr
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


From aslantas at metu.edu.tr  Fri Jul  1 15:20:12 2011
From: aslantas at metu.edu.tr (=?utf-8?Q?P=C4=B1nar_Aslantas_Bostan?=)
Date: Fri, 1 Jul 2011 16:20:12 +0300
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <4E0DBEEB.2010605@tum.de>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>	<4E0DB482.2080400@uni-muenster.de>	<001301cc37e6$ca4f9280$5eeeb780$@edu.tr>
	<4E0DBEEB.2010605@tum.de>
Message-ID: <001401cc37f1$9bdbefb0$d393cf10$@edu.tr>

Thank you Tom! Now index is correct, comprised from 5365 record. I created STSDF object with this index.

Best regards,
Pinar

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Tom Gottfried
Sent: Friday, July 01, 2011 3:35 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] space-time kriging

You could try

index <- cbind(as.integer(as.factor(prec_data$Station)), as.integer(as.factor(prec_data$Year)))

Tom


Am 01.07.2011 14:02, schrieb P?nar Aslantas Bostan:
> Hi Edzer,
>
> Thank you for your mail.
> Prec data has location and time information.
>
>> prec_data[1:10,]
>     Station      X       Y   Prec Year Month Day
> 1    17020 693894 4931348 1274.4 1970     1   1
> 2    17020 693894 4931348 1134.3 1971     1   1
> 3    17020 693894 4931348  940.7 1972     1   1
> 4    17020 693894 4931348 1253.3 1973     1   1
> 5    17020 693894 4931348  940.8 1974     1   1
> 6    17020 693894 4931348  913.4 1975     1   1
> 7    17020 693894 4931348  895.3 1976     1   1
> 8    17020 693894 4931348  803.5 1977     1   1
> 9    17020 693894 4931348  993.1 1978     1   1
> 10   17020 693894 4931348  976.4 1979     1   1
>
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Friday, July 01, 2011 2:50 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] space-time kriging
>
> Hi Pinar,
>
> as you say, some data are missing, but the way you create index suggests
> none are missing. Does your table "prec" have information for each
> observation on which location and at which time it has been taken? Could
> you maybe show how prec[1:10,] looks like?
>
> Wbr,
>
> On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
>> Dear all,
>>
>>
>>
>> I am working about space-time (ST) kriging. I want to make ST ordinary
>> kriging with sparse data set. Dependent data is annual precipitation
>> measured from 257 meteorological station. Observation period starts from
>> 1970 and finishes at 2008, so temporal entity of my study contains 39
>> year-value. Precipitation data comprised from 5365 value. It is not equal to
>> 257 (location) *39 (time), because some stations has no value for some
>> years. Therefore my data set fits to STSDF. An index table is required for
>> STSDF object. But I could not create correct index object, my code does not
>> work.
>>
>>
>>
>> I tried to summarize my code:
>>
>>
>>
>> # creating STSDF object
>>
>>
>>
>> # sp is spatial entity (257 spatial location)
>>
>> # time is temporal entity (39 year period)
>>
>> # prec is data attribute (5365 number of annual precipitation value)
>>
>>
>>
>> index<- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
>>
>> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
>>
>>
>>
>> Error: nrow(object at index) == nrow(object at data) is not TRUE
>>
>>
>>
>> Can you please help me about this error, how can I create correct index
>> object?
>>
>>
>>
>> Thank you all in advance!
>>
>> With my best regards,
>>
>> Pinar
>>
>>
>>
>>
>>
>> Pinar Aslantas Bostan
>>
>> Research Assistant
>>
>> Department of Geodetic and
>>
>> Geographic Information Technologies (GGIT) Middle East Technical University
>>
>> 06531 Ankara/TURKEY
>>
>> aslantas at metu.edu.tr
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Fri Jul  1 15:27:16 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 01 Jul 2011 15:27:16 +0200
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <4E0DBEEB.2010605@tum.de>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>	<4E0DB482.2080400@uni-muenster.de>	<001301cc37e6$ca4f9280$5eeeb780$@edu.tr>
	<4E0DBEEB.2010605@tum.de>
Message-ID: <4E0DCB34.3040309@uni-muenster.de>

Pinar / Tom,

another route you might follow is (improvised):

require(spacetime)
prec_data$YearDate = as.Date(paste(prec_data$Year, "1", "1",sep="-"))
x = stConstruct(prec_data, c("X", "Y"), "YearDate")
class(x) # STIDF
x = as(x, "STSDF") # will sort out common locations & times

Bests,

On 07/01/2011 02:34 PM, Tom Gottfried wrote:
> You could try
> 
> index <- cbind(as.integer(as.factor(prec_data$Station)),
> as.integer(as.factor(prec_data$Year)))
> 
> Tom
> 
> 
> Am 01.07.2011 14:02, schrieb P?nar Aslantas Bostan:
>> Hi Edzer,
>>
>> Thank you for your mail.
>> Prec data has location and time information.
>>
>>> prec_data[1:10,]
>>     Station      X       Y   Prec Year Month Day
>> 1    17020 693894 4931348 1274.4 1970     1   1
>> 2    17020 693894 4931348 1134.3 1971     1   1
>> 3    17020 693894 4931348  940.7 1972     1   1
>> 4    17020 693894 4931348 1253.3 1973     1   1
>> 5    17020 693894 4931348  940.8 1974     1   1
>> 6    17020 693894 4931348  913.4 1975     1   1
>> 7    17020 693894 4931348  895.3 1976     1   1
>> 8    17020 693894 4931348  803.5 1977     1   1
>> 9    17020 693894 4931348  993.1 1978     1   1
>> 10   17020 693894 4931348  976.4 1979     1   1
>>
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at r-project.org
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
>> Sent: Friday, July 01, 2011 2:50 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] space-time kriging
>>
>> Hi Pinar,
>>
>> as you say, some data are missing, but the way you create index suggests
>> none are missing. Does your table "prec" have information for each
>> observation on which location and at which time it has been taken? Could
>> you maybe show how prec[1:10,] looks like?
>>
>> Wbr,
>>
>> On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
>>> Dear all,
>>>
>>>
>>>
>>> I am working about space-time (ST) kriging. I want to make ST ordinary
>>> kriging with sparse data set. Dependent data is annual precipitation
>>> measured from 257 meteorological station. Observation period starts from
>>> 1970 and finishes at 2008, so temporal entity of my study contains 39
>>> year-value. Precipitation data comprised from 5365 value. It is not
>>> equal to
>>> 257 (location) *39 (time), because some stations has no value for some
>>> years. Therefore my data set fits to STSDF. An index table is
>>> required for
>>> STSDF object. But I could not create correct index object, my code
>>> does not
>>> work.
>>>
>>>
>>>
>>> I tried to summarize my code:
>>>
>>>
>>>
>>> # creating STSDF object
>>>
>>>
>>>
>>> # sp is spatial entity (257 spatial location)
>>>
>>> # time is temporal entity (39 year period)
>>>
>>> # prec is data attribute (5365 number of annual precipitation value)
>>>
>>>
>>>
>>> index<- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
>>>
>>> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
>>>
>>>
>>>
>>> Error: nrow(object at index) == nrow(object at data) is not TRUE
>>>
>>>
>>>
>>> Can you please help me about this error, how can I create correct index
>>> object?
>>>
>>>
>>>
>>> Thank you all in advance!
>>>
>>> With my best regards,
>>>
>>> Pinar
>>>
>>>
>>>
>>>
>>>
>>> Pinar Aslantas Bostan
>>>
>>> Research Assistant
>>>
>>> Department of Geodetic and
>>>
>>> Geographic Information Technologies (GGIT) Middle East Technical
>>> University
>>>
>>> 06531 Ankara/TURKEY
>>>
>>> aslantas at metu.edu.tr
>>>
>>>
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From aslantas at metu.edu.tr  Fri Jul  1 15:38:08 2011
From: aslantas at metu.edu.tr (=?utf-8?Q?P=C4=B1nar_Aslantas_Bostan?=)
Date: Fri, 1 Jul 2011 16:38:08 +0300
Subject: [R-sig-Geo] space-time kriging
In-Reply-To: <4E0DCB34.3040309@uni-muenster.de>
References: <000e01cc37df$c1e7f260$45b7d720$@edu.tr>	<4E0DB482.2080400@uni-muenster.de>	<001301cc37e6$ca4f9280$5eeeb780$@edu.tr>	<4E0DBEEB.2010605@tum.de>
	<4E0DCB34.3040309@uni-muenster.de>
Message-ID: <001501cc37f4$1d3481b0$579d8510$@edu.tr>

Edzer, I will try also your suggestion. Thank you.

Best wishes,

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Friday, July 01, 2011 4:27 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] space-time kriging

Pinar / Tom,

another route you might follow is (improvised):

require(spacetime)
prec_data$YearDate = as.Date(paste(prec_data$Year, "1", "1",sep="-"))
x = stConstruct(prec_data, c("X", "Y"), "YearDate")
class(x) # STIDF
x = as(x, "STSDF") # will sort out common locations & times

Bests,

On 07/01/2011 02:34 PM, Tom Gottfried wrote:
> You could try
> 
> index <- cbind(as.integer(as.factor(prec_data$Station)),
> as.integer(as.factor(prec_data$Year)))
> 
> Tom
> 
> 
> Am 01.07.2011 14:02, schrieb P?nar Aslantas Bostan:
>> Hi Edzer,
>>
>> Thank you for your mail.
>> Prec data has location and time information.
>>
>>> prec_data[1:10,]
>>     Station      X       Y   Prec Year Month Day
>> 1    17020 693894 4931348 1274.4 1970     1   1
>> 2    17020 693894 4931348 1134.3 1971     1   1
>> 3    17020 693894 4931348  940.7 1972     1   1
>> 4    17020 693894 4931348 1253.3 1973     1   1
>> 5    17020 693894 4931348  940.8 1974     1   1
>> 6    17020 693894 4931348  913.4 1975     1   1
>> 7    17020 693894 4931348  895.3 1976     1   1
>> 8    17020 693894 4931348  803.5 1977     1   1
>> 9    17020 693894 4931348  993.1 1978     1   1
>> 10   17020 693894 4931348  976.4 1979     1   1
>>
>>
>> -----Original Message-----
>> From: r-sig-geo-bounces at r-project.org
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
>> Sent: Friday, July 01, 2011 2:50 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] space-time kriging
>>
>> Hi Pinar,
>>
>> as you say, some data are missing, but the way you create index suggests
>> none are missing. Does your table "prec" have information for each
>> observation on which location and at which time it has been taken? Could
>> you maybe show how prec[1:10,] looks like?
>>
>> Wbr,
>>
>> On 07/01/2011 01:12 PM, P?nar Aslantas Bostan wrote:
>>> Dear all,
>>>
>>>
>>>
>>> I am working about space-time (ST) kriging. I want to make ST ordinary
>>> kriging with sparse data set. Dependent data is annual precipitation
>>> measured from 257 meteorological station. Observation period starts from
>>> 1970 and finishes at 2008, so temporal entity of my study contains 39
>>> year-value. Precipitation data comprised from 5365 value. It is not
>>> equal to
>>> 257 (location) *39 (time), because some stations has no value for some
>>> years. Therefore my data set fits to STSDF. An index table is
>>> required for
>>> STSDF object. But I could not create correct index object, my code
>>> does not
>>> work.
>>>
>>>
>>>
>>> I tried to summarize my code:
>>>
>>>
>>>
>>> # creating STSDF object
>>>
>>>
>>>
>>> # sp is spatial entity (257 spatial location)
>>>
>>> # time is temporal entity (39 year period)
>>>
>>> # prec is data attribute (5365 number of annual precipitation value)
>>>
>>>
>>>
>>> index<- as.matrix(expand.grid(1:length(sp),1:nrow(time)))
>>>
>>> w= STSDF(sp, time, data.frame(values = as.vector(t(prec))),index)
>>>
>>>
>>>
>>> Error: nrow(object at index) == nrow(object at data) is not TRUE
>>>
>>>
>>>
>>> Can you please help me about this error, how can I create correct index
>>> object?
>>>
>>>
>>>
>>> Thank you all in advance!
>>>
>>> With my best regards,
>>>
>>> Pinar
>>>
>>>
>>>
>>>
>>>
>>> Pinar Aslantas Bostan
>>>
>>> Research Assistant
>>>
>>> Department of Geodetic and
>>>
>>> Geographic Information Technologies (GGIT) Middle East Technical
>>> University
>>>
>>> 06531 Ankara/TURKEY
>>>
>>> aslantas at metu.edu.tr
>>>
>>>
>>>
>>>
>>>     [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From christian.kamenik at giub.unibe.ch  Fri Jul  1 16:02:19 2011
From: christian.kamenik at giub.unibe.ch (Christian Kamenik)
Date: Fri, 1 Jul 2011 16:02:19 +0200
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
Message-ID: <4E0DD36B.5080500@giub.unibe.ch>

Dear all,

The package 'raster' provides excellent tools to work on geographic 
data. Subsetting a RasterBrick object, however, takes ages.

I have the following RasterBrick object:

     Temp.CRU.cropped

     class:                  RasterBrick
     filename:
     dimensions:        43, 99, 1200  (nrow, ncol, nlayers)
     ncell:                  4257
     projection:         +proj=longlat +ellps=WGS84
     min values:        -14.8 -22.1 -15.0  -8.6  -3.8   4.7   8.7   
6.0   1.6  -2.4 ...
     max values:       2.1 -3.9 -2.1  1.8  6.6 15.7 18.0 14.8 10.7  7.7 ...
     extent:               15, 31.5, 64, 71.16667  (xmin, xmax, ymin, ymax)
     resolution:         0.1666667, 0.1666667  (x, y)

These are temperature readings from northern Fennoscandia, and each 
layer represents a month, thus each grid cell has monthly readings over 
the last 100 years.

Now I want to extract the readings for only July:

     Months <- rep(month.abb,nlayers(Temp.CRU.cropped)/12)
     Temp.CRU.J <- subset(Temp.CRU.cropped,which(Months=='Jul'))

But as I said, this takes ages. It is much faster to do the subsetting 
on an array:

     CRU.values <- getValues(Temp.CRU.cropped)
     Temp.CRU.J <- CRU.values[,which(Months=='Jul')]
     Temp.CRU.J <- 
array(Temp.CRU.J,dim=c(nrow(Temp.CRU.cropped),ncol(Temp.CRU.cropped),nlayers(Temp.CRU.cropped)/12))
     Temp.CRU.J <- brick(Temp.CRU.J)
     Temp.CRU.J <- setExtent(Temp.CRU.J,extent(Temp.CRU.cropped))
     projection(Temp.CRU.J) <- projection(Temp.CRU.cropped)

It is strange that several lines of code run much faster than the 
'subset' command, and I was wondering why 'subset' takes at least a 1000 
times longer.

I would be interested in your opinion.

Many thanks, Christian

-- 
-----------------------------------------------
Oeschger Centre for Climate Change Research, Institute of Geography&  Institute of Plant Sciences
University of Bern

http://www.stomatocysts.unibe.ch/kamenik
mailto: christian.kamenik at giub.unibe.ch

Postal address:
Dr. Christian Kamenik
Institute of Geography
Erlachstrasse 9a, Trakt 3
3012 Bern, Switzerland

Tel. +41 (0)31 631 5091
Fax +41 (0)31 631 43 38


From kati.csillery at gmail.com  Fri Jul  1 17:11:05 2011
From: kati.csillery at gmail.com (Katalin Csillery)
Date: Fri, 1 Jul 2011 17:11:05 +0200
Subject: [R-sig-Geo] treating a Digital Elevation Map in RSAGA
Message-ID: <BANLkTi=9OtejRYwDqJknUYwP14tM6V0-Cg@mail.gmail.com>

Hi there,

I have a Digital Elevation Map (mnt50.asc) for which I would like to
calculate slope, curvature etc. using rsaga.local.morphometry (from
RSAGA).

I am on Ubuntu. I installed saga in /usr/bin (i.e. I have saga_cmd here)
The path to mnt50.asc is /home/kati/projects/cemagref/maps

I get the following error when I first try to get the DEM in the
required format:

> rsaga.esri.to.sgrd(in.grids="mnt50", in.path="/home/kati/projects/cemagref/maps", os.default.path="/usr/bin", cmd="saga_cmd")
Error in setwd(env$workspace) : character argument expected
In addition: Warning message:
In rsaga.env() :
  SAGA command line program 'saga_cmd' not found in any of the paths
/usr/lib/R/library/RSAGA/saga_vc

/home/kati/projects/cemagref/maps
/usr/local/bin

1. "Error in setwd(env$workspace) : character argument expected" -
this I don't understand.
2. it looks for saga_cmd at the wrong place: the default
os.default.path and not what I have given.

Any suggestions?

Thanks in advance,
Kati




-- 
Katalin Csill?ry, Ph.D.
UR ?cosyst?mes montagnards
CEMAGREF, 2 rue de la papeterie
38402 Saint Martin d'H?res, France
Tel +33 (0)4 76 76 27 80
Fax +33 (0)4 76 51 38 03
https://sites.google.com/site/katalincsillery/


From reeves at nceas.ucsb.edu  Fri Jul  1 18:20:28 2011
From: reeves at nceas.ucsb.edu (Rick Reeves)
Date: Fri, 01 Jul 2011 09:20:28 -0700
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <4E0DD36B.5080500@giub.unibe.ch>
References: <4E0DD36B.5080500@giub.unibe.ch>
Message-ID: <4E0DF3CC.2090608@nceas.ucsb.edu>

Hello Christian:
Yes indeed, my experience is that Raster package operations on very 
large datasets take a long time,
on either Linux or Windows desktops.

As an alternative to the Raster package, I have had good experience 
using the GDAL raster image utilities,
embedded within shell or Python scripts to perform first-order raster 
subsampling and subimage generation.
Check out the gdalinfo, gdal_translate, and gdalwarp utilities. I have 
been using these to work with 100 gigabyte-class
raster DEM images, with great success and relatively low execution times 
(considering the size of the data sets).

HTH,
Rick Reeves
NCEAS



On 7/1/2011 7:02 AM, Christian Kamenik wrote:
> Dear all,
>
> The package 'raster' provides excellent tools to work on geographic 
> data. Subsetting a RasterBrick object, however, takes ages.
>
> I have the following RasterBrick object:
>
>     Temp.CRU.cropped
>
>     class:                  RasterBrick
>     filename:
>     dimensions:        43, 99, 1200  (nrow, ncol, nlayers)
>     ncell:                  4257
>     projection:         +proj=longlat +ellps=WGS84
>     min values:        -14.8 -22.1 -15.0  -8.6  -3.8   4.7   8.7   
> 6.0   1.6  -2.4 ...
>     max values:       2.1 -3.9 -2.1  1.8  6.6 15.7 18.0 14.8 10.7  7.7 
> ...
>     extent:               15, 31.5, 64, 71.16667  (xmin, xmax, ymin, 
> ymax)
>     resolution:         0.1666667, 0.1666667  (x, y)
>
> These are temperature readings from northern Fennoscandia, and each 
> layer represents a month, thus each grid cell has monthly readings 
> over the last 100 years.
>
> Now I want to extract the readings for only July:
>
>     Months <- rep(month.abb,nlayers(Temp.CRU.cropped)/12)
>     Temp.CRU.J <- subset(Temp.CRU.cropped,which(Months=='Jul'))
>
> But as I said, this takes ages. It is much faster to do the subsetting 
> on an array:
>
>     CRU.values <- getValues(Temp.CRU.cropped)
>     Temp.CRU.J <- CRU.values[,which(Months=='Jul')]
>     Temp.CRU.J <- 
> array(Temp.CRU.J,dim=c(nrow(Temp.CRU.cropped),ncol(Temp.CRU.cropped),nlayers(Temp.CRU.cropped)/12))
>     Temp.CRU.J <- brick(Temp.CRU.J)
>     Temp.CRU.J <- setExtent(Temp.CRU.J,extent(Temp.CRU.cropped))
>     projection(Temp.CRU.J) <- projection(Temp.CRU.cropped)
>
> It is strange that several lines of code run much faster than the 
> 'subset' command, and I was wondering why 'subset' takes at least a 
> 1000 times longer.
>
> I would be interested in your opinion.
>
> Many thanks, Christian
>


From moshersteven at gmail.com  Fri Jul  1 19:35:43 2011
From: moshersteven at gmail.com (steven mosher)
Date: Fri, 1 Jul 2011 10:35:43 -0700
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <4E0DD36B.5080500@giub.unibe.ch>
References: <4E0DD36B.5080500@giub.unibe.ch>
Message-ID: <BANLkTimPNMpJ_syZcBeghx0Jtp7iXe02DA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110701/b8d03c73/attachment.pl>

From agnes.kaczmarczyk at gmail.com  Fri Jul  1 19:37:01 2011
From: agnes.kaczmarczyk at gmail.com (Agnieszka Kaczmarczyk)
Date: Fri, 1 Jul 2011 19:37:01 +0200
Subject: [R-sig-Geo] Geostatistical simulation
Message-ID: <BANLkTikas53qyR2E8+OeWbkZ+Q3-wvMMbA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110701/59aa1c42/attachment.pl>

From jorgefernandosaraiva at gmail.com  Sat Jul  2 16:50:58 2011
From: jorgefernandosaraiva at gmail.com (Jorge Fernando Saraiva de Menezes)
Date: Sat, 2 Jul 2011 11:50:58 -0300
Subject: [R-sig-Geo] kernel home range with weights
Message-ID: <CALnMTgFG_BpAo2VFCncgx9y+D6wqWai+g7x++o74ynoWYcFQMA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110702/4b45547a/attachment.pl>

From robhodges17 at gmail.com  Sun Jul  3 00:32:27 2011
From: robhodges17 at gmail.com (Rob Hodges)
Date: Sat, 2 Jul 2011 18:32:27 -0400
Subject: [R-sig-Geo] map2SpatialLines and map('world2')
Message-ID: <CAA7SFdw3t2nYz7TYAfvm0U8LdP2RJu1ZT70wW8jTid0KUuKb6Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110702/ff1a5fb1/attachment.pl>

From amelanchyer at gmail.com  Sun Jul  3 05:23:37 2011
From: amelanchyer at gmail.com (Jason Sorens)
Date: Sat, 2 Jul 2011 23:23:37 -0400
Subject: [R-sig-Geo] testing linear combinations of coefficients after
	spatial regression
Message-ID: <CAEvO4HQGO0fsZq-i06u4XEJ_LbiMwYgySxKnSL9WX_E5a-j0Gg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110702/757b25d2/attachment.pl>

From Roger.Bivand at nhh.no  Sun Jul  3 15:59:20 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 3 Jul 2011 15:59:20 +0200 (CEST)
Subject: [R-sig-Geo] map2SpatialLines and map('world2')
In-Reply-To: <CAA7SFdw3t2nYz7TYAfvm0U8LdP2RJu1ZT70wW8jTid0KUuKb6Q@mail.gmail.com>
References: <CAA7SFdw3t2nYz7TYAfvm0U8LdP2RJu1ZT70wW8jTid0KUuKb6Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107031540380.27267@reclus.nhh.no>

On Sat, 2 Jul 2011, Rob Hodges wrote:

> Greetings R-sig-geo'ders;
>
> I want to use the Pacific-centric world map 'world2' from the maps package
> for use with hurricane observations. I am also making use of the sp spatial
> data classes. The following (Atlantic-centric) example works:
>
> x = map('world', plot=F)
> x_sl = map2SpatialLines(x, proj4string=CRS("+proj=longlat +datum=WGS84"))
>
> However, the map2SpatialLines function when using 'world2' - the
> Pacific-centric world map - fails.
>
> x_pac = map('world2', plot=F)
> x_pac_sl = map2SpatialLines(x, proj4string=CRS("+proj=longlat
> +datum=WGS84"))
> *Error in validityMethod(object) :
>  Geographical CRS given to non-conformant data*
>
> Interestingly: The range on longitude for x is roughly 0 to 180, while the
> range on longitude for x_pac is 0 to 360. Didn't know if that had something
> to do with it.

> x_pac$range
[1]  -5.072266 369.988892 -85.443077  83.573914
> x$range
[1] -179.95721  190.29080  -85.44308   83.57391

where the world2 data falls foul of:

> sp:::.ll_sanity
function (bb)
{
     tol <- .Machine$double.eps^0.25
     W <- bb[1, 1] < -180 && !isTRUE(all.equal((bb[1, 1] - -180),
         0, tolerance = tol))
     E <- bb[1, 2] > 360 && !isTRUE(all.equal((bb[1, 2] - 360),
         0, tolerance = tol))
     S <- bb[2, 1] < -90 && !isTRUE(all.equal((bb[2, 1] - -90),
         0, tolerance = tol))
     N <- bb[2, 2] > 90 && !isTRUE(all.equal((bb[2, 2] - 90),
         0, tolerance = tol))
     return(!(any(W || E || S || N)))
}
<environment: namespace:sp>

and its limit at just over 360 degrees. If what you need are lines as a 
background, then pruneMap() may help:

x_pac_sl = map2SpatialLines(pruneMap(x_pac, xlim=c(0, 360)),
   proj4string=CRS("+proj=longlat +datum=WGS84"))

by trimming lines. Alternatives through recenter methods often lead to 
horizonal stripes.

Hope this helps,

Roger

>
> Thanks in advance,
>
> - Rob Hodges
> FSU, Geography
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Sun Jul  3 16:54:16 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 3 Jul 2011 16:54:16 +0200 (CEST)
Subject: [R-sig-Geo] testing linear combinations of coefficients after
 spatial regression
In-Reply-To: <CAEvO4HQGO0fsZq-i06u4XEJ_LbiMwYgySxKnSL9WX_E5a-j0Gg@mail.gmail.com>
References: <CAEvO4HQGO0fsZq-i06u4XEJ_LbiMwYgySxKnSL9WX_E5a-j0Gg@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107031638320.27267@reclus.nhh.no>

On Sat, 2 Jul 2011, Jason Sorens wrote:

> I'm interested in testing linear combinations of coefficients after models
> like spautolm, errorsarlm, and lagsarlm in the spdep package. I'm used to
> using "anova" for this, but the anova.sarlm implementation doesn't seem to
> permit it straightforwardly. For instance, if I wanted to testing something
> like b_1-.25*b_2=0, how would I go about doing that?

See the linearHypothesis() methods in the car package. I think that, after 
someone has checked that all is as it should be, sarlm objects could get a 
vcov() method, which they do not have now. These work formally, but are 
not checked:

library(car)
library(spdep)
example(columbus)
lmobj <- lm(CRIME ~ HOVAL+INC, data=columbus)
linearHypothesis(lmobj, "HOVAL-INC=0", test="Chisq")
lagobj <- lagsarlm(CRIME ~ HOVAL+INC, data=columbus,
   listw=nb2listw(col.gal.nb))
linearHypothesis(lagobj, "HOVAL-INC=0", test="Chisq",
   vcov.=lagobj$resvar[2:5,2:5])
errobj <- errorsarlm(CRIME ~ HOVAL+INC, data=columbus,
   listw=nb2listw(col.gal.nb))
linearHypothesis(errobj, "HOVAL-INC=0", test="Chisq",
   vcov.=errobj$resvar[2:5,2:5])

Please do check that this is an appropriate use of the returned values 
when fitted using eigenvalues. Other steps would be needed when a (mixed) 
numerical Hessian is used to approximate the variance/covariance matrix of 
the coefficients. Then a vcov() method could be added for sarlm objects, 
but it needs caution and analysis.

Hope this helps,

Roger


>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From amelanchyer at gmail.com  Sun Jul  3 19:32:53 2011
From: amelanchyer at gmail.com (Jason Sorens)
Date: Sun, 3 Jul 2011 13:32:53 -0400
Subject: [R-sig-Geo] testing linear combinations of coefficients after
 spatial regression
In-Reply-To: <alpine.LRH.2.00.1107031638320.27267@reclus.nhh.no>
References: <CAEvO4HQGO0fsZq-i06u4XEJ_LbiMwYgySxKnSL9WX_E5a-j0Gg@mail.gmail.com>
	<alpine.LRH.2.00.1107031638320.27267@reclus.nhh.no>
Message-ID: <CAEvO4HThxMthxiFcYVeykwEhO4L0T0RHBsMPT=cuLPxhHRzWew@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110703/2d097c2b/attachment.pl>

From ah3881 at bristol.ac.uk  Sun Jul  3 21:27:41 2011
From: ah3881 at bristol.ac.uk (ah3881)
Date: Sun, 3 Jul 2011 12:27:41 -0700 (PDT)
Subject: [R-sig-Geo] Assessing and ranking the relationships and
 contribution of environmental correlates to species richness
Message-ID: <1309721261109-6543945.post@n2.nabble.com>

I am trying to run some analysis to determine the percentage contribution
of various factors (minimum temp in lgm, npp, etc) on determining
species richness of 171 species throughout Southeast Asia (on a km by km
basis-so over 4 million rows of cells, and about 14 columns).
I have read about various stats tests, and softwares-but I am no
statistician and I would really appreciate some advice as to the best
method/tests.
So far I have been attempting SPSS, but it does not give me the outputs I
need, and a colleague suggested R might be the best way to analyse the data 
Thanks in advance

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Assessing-and-ranking-the-relationships-and-contribution-of-environmental-correlates-to-species-richs-tp6543945p6543945.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mathieu.rajerison at gmail.com  Mon Jul  4 08:53:05 2011
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Mon, 4 Jul 2011 08:53:05 +0200
Subject: [R-sig-Geo] Assessing and ranking the relationships and
 contribution of environmental correlates to species richness
In-Reply-To: <1309721261109-6543945.post@n2.nabble.com>
References: <1309721261109-6543945.post@n2.nabble.com>
Message-ID: <CAGfc75=DwTBPMsEP18N=1vS4K015tp8fNW6_KdTMs2uj-3knhg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110704/956689f5/attachment.pl>

From ah3881 at bristol.ac.uk  Mon Jul  4 10:08:08 2011
From: ah3881 at bristol.ac.uk (ah3881)
Date: Mon, 4 Jul 2011 01:08:08 -0700 (PDT)
Subject: [R-sig-Geo] Assessing and ranking the relationships and
 contribution of environmental correlates to species richness
In-Reply-To: <CAGfc75=DwTBPMsEP18N=1vS4K015tp8fNW6_KdTMs2uj-3knhg@mail.gmail.com>
References: <1309721261109-6543945.post@n2.nabble.com>
	<CAGfc75=DwTBPMsEP18N=1vS4K015tp8fNW6_KdTMs2uj-3knhg@mail.gmail.com>
Message-ID: <1309766888274-6545267.post@n2.nabble.com>

Hi

Thanks.
I have species richness projections (made using Maxent projections of
species distribution of 171 species, reclassified to give binary estimates
of species distributions {10 percentile training threshold) before combining
all 171 projections).
So I have a raster of species richness in addition to all the possible
correlates I am examining (npp, intra-annual variability of npp,
inter-annual variability of npp, distance from coast, distance from karsts,
latitude, lgm minimum temperature, lgm mean temperature, temperature change
in minimum temperature since lgm, t change in mean temp since lgm, actual
evapotranspiration)
None of the correlates were used in species distribution projections and I
have a gis raster of each variable, in addition to a database denoting the
value of each for every km2 throughout Southeast Asia.

Now I want to determine how much variability in species richness can be
explained by variation in each of the other variables, in addition to the
relationships. But I don't know which test would be best to do this, or
software (GIS or database) which could best analyse this-especially given
that the database is over 4520000 rows, and a large number of columns.....
Advice would be greatly appreciated 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Assessing-and-ranking-the-relationships-and-contribution-of-environmental-correlates-to-species-richs-tp6543945p6545267.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Mon Jul  4 10:58:50 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 4 Jul 2011 10:58:50 +0200 (CEST)
Subject: [R-sig-Geo] rgdal 0.7-1 release
Message-ID: <alpine.LRH.2.00.1107041040280.30204@reclus.nhh.no>

This release may cause trouble.

It has been found that an application (QGIS) plugin (SDA4P) loading R and 
rgdal through rpy2, and with QGIS linking to GDAL itself directly, has 
been occasionally seeing muddles with regard to error handling on Linux.

The CRAN Windows and CRAN extras OSX binary packages are built static, so 
don't see the problem (they have private copies of GDAL), but in order to 
try to resolve this, and following exchanges with Even Rouault, a GDAL 
developer, major changes in error handling in rgdal have been made.

Before, the R error handler was set to catch GDAL errors on the R thread 
(GDAL's error handler is said to be threaded, so rgdal pushed the R 
handler on load and popped it on unload). If the plugin loaded R on the 
same thread as QGIS, the R error handler might be seen by QGIS, instead of 
the QGIS error handler.

Now, the error handler is pushed/popped around every call to a GDAL 
function, on occasion pushed before a loop and popped after the loop.

I have contacted all maintainers of packages on CRAN depending on or 
suggesting rgdal, so that they could check whether their packages are 
affected. William Kyngesburye has been kind enough to clear some other 
issues for his R 2.13 Framework build, but reports no problems so far.

If you see issues, in particular R error exiting because the wrong error 
handler is being applied (only Linux, OSX with rgdal intalled from source 
or Frameworks, or Windows with rgdal installed from source), please 
document fully, preferably reproducibly, and report, and, until fixed, 
revert to the 0.6-* series.

Windows and OSX binaries will not be built for GDAL 1.8.0, but we'll aim 
to build with GDAL 1.8.1 sometime after its (impending) release.

All feedback welcome, including scrutiny of the changes made in the C/C++ 
source code on R-Forge.

Roger

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From johan.vandewauw at gmail.com  Mon Jul  4 11:14:00 2011
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Mon, 4 Jul 2011 11:14:00 +0200
Subject: [R-sig-Geo] treating a Digital Elevation Map in RSAGA
In-Reply-To: <BANLkTi=9OtejRYwDqJknUYwP14tM6V0-Cg@mail.gmail.com>
References: <BANLkTi=9OtejRYwDqJknUYwP14tM6V0-Cg@mail.gmail.com>
Message-ID: <CAJOp35=eXX7JytUHHTiTWPoGOALGHe28eTV2rkJBCMV0sdHO1g@mail.gmail.com>

This version of RSAGA:
http://zadeh.ugent.be/~johan/saga/RSAGA_0.91-1.5.tar.gz

contains a few fixes for running saga on debian/ubuntu, among others
the path is set correctly.
Installing is easy, run in a terminal:

wget http://zadeh.ugent.be/~johan/saga/RSAGA_0.91-1.5.tar.gz
R CMD INSTALL RSAGA_0.91-1.5.tar.gz

Johan

On Fri, Jul 1, 2011 at 5:11 PM, Katalin Csillery
<kati.csillery at gmail.com> wrote:
> Hi there,
>
> I have a Digital Elevation Map (mnt50.asc) for which I would like to
> calculate slope, curvature etc. using rsaga.local.morphometry (from
> RSAGA).
>
> I am on Ubuntu. I installed saga in /usr/bin (i.e. I have saga_cmd here)
> The path to mnt50.asc is /home/kati/projects/cemagref/maps
>
> I get the following error when I first try to get the DEM in the
> required format:
>
>> rsaga.esri.to.sgrd(in.grids="mnt50", in.path="/home/kati/projects/cemagref/maps", os.default.path="/usr/bin", cmd="saga_cmd")
> Error in setwd(env$workspace) : character argument expected
> In addition: Warning message:
> In rsaga.env() :
> ?SAGA command line program 'saga_cmd' not found in any of the paths
> /usr/lib/R/library/RSAGA/saga_vc
>
> /home/kati/projects/cemagref/maps
> /usr/local/bin
>
> 1. "Error in setwd(env$workspace) : character argument expected" -
> this I don't understand.
> 2. it looks for saga_cmd at the wrong place: the default
> os.default.path and not what I have given.
>
> Any suggestions?
>
> Thanks in advance,
> Kati
>
>
>
>
> --
> Katalin Csill?ry, Ph.D.
> UR ?cosyst?mes montagnards
> CEMAGREF, 2 rue de la papeterie
> 38402 Saint Martin d'H?res, France
> Tel +33 (0)4 76 76 27 80
> Fax +33 (0)4 76 51 38 03
> https://sites.google.com/site/katalincsillery/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From oscar.perpinan at upm.es  Mon Jul  4 13:35:32 2011
From: oscar.perpinan at upm.es (Oscar =?UTF-8?B?UGVycGnDsWFu?= Lamigueiro)
Date: Mon, 4 Jul 2011 13:35:32 +0200
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <BANLkTimPNMpJ_syZcBeghx0Jtp7iXe02DA@mail.gmail.com>
References: <4E0DD36B.5080500@giub.unibe.ch>
	<BANLkTimPNMpJ_syZcBeghx0Jtp7iXe02DA@mail.gmail.com>
Message-ID: <20110704133532.08b09344@upm.es>

Hi,

Navigating through the code, I learn that subset first makes a
conversion from a RasterBrick to a RasterStack:

> getMethod('subset', 'Raster')  
Method Definition:

function (x, ...) 
{
    .local <- function (x, subset, drop = TRUE, ...) 
    {
        x <- stack(x)
        subset(x, subset = subset, drop = drop, ...)
    }
    .local(x, ...)
}
<environment: namespace:raster>

Signatures:
        x       
target  "Raster"
defined "Raster"

With a toy example I find that the slow part is due to this conversion:

mat <- array(runif(12e4), dim=c(10, 10, 1200))
b <- brick(mat)
idx <- seq(from=as.Date('1910-01-01'), to=as.Date('2009-12-31'),
by='month')

month <- function(x)as.numeric(format(x, '%m'))
idxJuly <- which(month(idx)==7)

##conversion from RasterBrick to RasterStack
system.time(s <- stack(b))
   user  system elapsed 
 35.570   0.000  36.603 

##subset with the index
system.time(sJuly <- subset(s, idxJuly))
   user  system elapsed 
  0.080   0.000   0.098 


Another approach is to build a list of RasterLayers with *only* the
layers to keep:

system.time({
  l <- lapply(idxJuly, function(n)raster(b, n))
  sJuly2 <- do.call(stack, l)
  }
)           
   user  system elapsed 
  1.684   0.000   1.755 
 
Anyway, if your final objective is to calculate over subsets of the
RasterBrick, then you may find useful the new zApply function:

##First a time index is added to the RasterBrick
b <- setZ(b, idx)

system.time(meanMonthly <- zApply(b, by=month, FUN=mean))
   user  system elapsed 
  0.696   0.000   0.718 

Cheers,

Oscar.


--------------
Oscar Perpi??n Lamigueiro
Dpto. de Ingenier?a El?ctrica
EUITI-UPM

http://procomun.wordpress.com


From renaud.lancelot at cirad.fr  Mon Jul  4 16:31:59 2011
From: renaud.lancelot at cirad.fr (lancelot)
Date: Mon, 04 Jul 2011 16:31:59 +0200
Subject: [R-sig-Geo] package raster: pb with setValues on a RasterLayer
In-Reply-To: <alpine.LRH.2.00.1107041040280.30204@reclus.nhh.no>
References: <alpine.LRH.2.00.1107041040280.30204@reclus.nhh.no>
Message-ID: <4E11CEDF.6080706@cirad.fr>

Dear all,

I meet a pb when using setValues:

 > library(raster)
 > setwd("d:/analyses/abder")
 > r <- raster("rh.tif")
 > vals <- getValues(r)
 > summary(vals)
    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
       0     244     440    1646     828   65540  166222
 > vals[!is.na(vals) & ((vals > 10000) | (vals == 0))] <- NA
 > summary(vals)
     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's
      1.0    241.0    434.0    683.7    798.0   6805.0 173141.0
 > r2 <- setValues(r, vals)
 > plot(r2)
Error in .local(.Object, ...) : empty file name

Any idea of what's going on and how to solve it?

####

Some additional info:

 > class(r)
[1] "RasterLayer"
attr(,"package")
[1] "raster"

 > summary(r)
Cells:  604902

Min.        0
1st Qu.   181
Median    538
Mean     3330
3rd Qu.  1303
Max.    65540
summary based on a sample of 1e+05 cells, which is 16.5316034663466 % of 
all cells

 > slot(slot(r, "file"), "name")
[1] "d:/analyses/abder/rh.tif"

 > slot(slot(r2, "file"), "name")
[1] ""

 > sessionInfo()
R version 2.13.0 Patched (2011-04-28 r55678)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
[3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
[5] LC_TIME=French_France.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-33   raster_1.8-38  sp_0.9-84      fortunes_1.4-1

All the best,

Renaud

-- 
Renaud Lancelot
EDENext Project, coordinator: http://www.edenext.eu/

CIRAD, UMR15, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From moshersteven at gmail.com  Mon Jul  4 18:04:51 2011
From: moshersteven at gmail.com (steven mosher)
Date: Mon, 4 Jul 2011 09:04:51 -0700
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <20110704133248.7ec24642@ya.com>
References: <4E0DD36B.5080500@giub.unibe.ch>
	<BANLkTimPNMpJ_syZcBeghx0Jtp7iXe02DA@mail.gmail.com>
	<20110704133248.7ec24642@ya.com>
Message-ID: <CAFFLneRJ1CYwwusSOEqEgFB=RbyTWSBw1SvT8fNt-tqFrA+UDg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110704/d53b009d/attachment.pl>

From alexander.arpaci at boku.ac.at  Mon Jul  4 22:07:58 2011
From: alexander.arpaci at boku.ac.at (Alexander Arpaci)
Date: Mon, 04 Jul 2011 22:07:58 +0200
Subject: [R-sig-Geo] setting user path for gpsbabel use with readgps
Message-ID: <4E1239BE0200000300021218@gwia1.boku.ac.at>

Hello,

sorry maybe a newbie question but how can I set the user path for the use of the readGPS() in maptools?
I want to import obviously gpx data... any other tips how to do that quick and easy?
I am using eclipse with the statet plugin for my r scripting  on windows 7 (if  that makes an difference)
thanks a lot




MSc. Alexander Arpaci
Assistant researcher

Department of Forest - and Soil Sciences
Institute of Silviculture
Tel. +43-1-47654-4081
e-mail: alexander.arpaci at boku.ac.at
www.wabo.boku.ac.at 


From horacio.samaniego at gmail.com  Tue Jul  5 07:12:55 2011
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Mon, 4 Jul 2011 23:12:55 -0600
Subject: [R-sig-Geo] plotting latlon axes of sp object of different
	projection
Message-ID: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>

I need to add a lat/lon axes to an equal area plot of a
SpatialLinesDataFrame object currently in units of meters. Is that
achievable using sp/maptools?

The .prj file where the object comes from is:
PROJCS["Lambert_Azimuthal_Equal_Area",GEOGCS["GCS_unnamed
ellipse",DATUM["D_unknown",SPHEROID["Unknown",6370997,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_origin",45],PARAMETER["central_meridian",-100],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["Meter",1]]

I'ld hate to install arcinfo to generate 1 plot! (plus the plot is
already nice as it is!!! just need the axes!)

thanks,
I'll summarize!

H

-- 
Horacio Samaniego

Center for Nonlinear Studies
Los Alamos National Laboratory
MS B258
Los Alamos, New Mexico 87545

Instituto de Silvicultura
Universidad Austral de Chile
Valdivia, Chile


From r.hijmans at gmail.com  Tue Jul  5 12:15:24 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Tue, 5 Jul 2011 03:15:24 -0700 (PDT)
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <4E0DD36B.5080500@giub.unibe.ch>
References: <4E0DD36B.5080500@giub.unibe.ch>
Message-ID: <1309860924271-6549140.post@n2.nabble.com>

> The package 'raster' provides excellent tools to work on geographic 
> data. Subsetting a RasterBrick object, however, takes ages. 

Christian, 

Thanks for reporting this. I have improved the subset routine in raster
version 1.8-39 (on CRAN now for linux, but not built yet for win and mac).
In some cases nearly 1000x faster, as you also reported, but other cases
need further optimization. 

Best, 
Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Subsetting-RasterBrick-very-slow-tp6537890p6549140.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Tue Jul  5 13:20:56 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Jul 2011 13:20:56 +0200 (CEST)
Subject: [R-sig-Geo] plotting latlon axes of sp object of different
 projection
In-Reply-To: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
References: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107051300140.1850@reclus.nhh.no>

On Mon, 4 Jul 2011, Horacio Samaniego wrote:

> I need to add a lat/lon axes to an equal area plot of a
> SpatialLinesDataFrame object currently in units of meters. Is that
> achievable using sp/maptools?
>
> The .prj file where the object comes from is:
> PROJCS["Lambert_Azimuthal_Equal_Area",GEOGCS["GCS_unnamed
> ellipse",DATUM["D_unknown",SPHEROID["Unknown",6370997,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_origin",45],PARAMETER["central_meridian",-100],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["Meter",1]]
>
> I'ld hate to install arcinfo to generate 1 plot! (plus the plot is
> already nice as it is!!! just need the axes!)

No, the axes are in the same coordinate system as the plot, and would be 
curves here. You can overplot a long-lat grid on a projected plot:

library(sp)
data(meuse)
coordinates(meuse) <- ~x+y
proj4string(meuse) <- CRS("+init=epsg:28992")
plot(meuse)
library(rgdal)
meuse_ll <- spTransform(meuse, CRS("+proj=longlat +datum=WGS84"))
grd <- gridlines(meuse_ll)
grd_x <- spTransform(grd, CRS("+init=epsg:28992"))
plot(grd_x, add=TRUE, lty=2)
grdat_ll <- gridat(meuse_ll)
grdat_x <- spTransform(grdat_ll, CRS("+init=epsg:28992"))
text(coordinates(grdat_x), labels=parse(text=grdat_x$labels),
   pos=grdat_x$pos, offset=grdat_x$offset)

Hope this helps,

Roger

>
> thanks,
> I'll summarize!
>
> H
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jul  5 13:22:58 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 5 Jul 2011 13:22:58 +0200 (CEST)
Subject: [R-sig-Geo] setting user path for gpsbabel use with readgps
In-Reply-To: <4E1239BE0200000300021218@gwia1.boku.ac.at>
References: <4E1239BE0200000300021218@gwia1.boku.ac.at>
Message-ID: <alpine.LRH.2.00.1107051321100.1850@reclus.nhh.no>

On Mon, 4 Jul 2011, Alexander Arpaci wrote:

> Hello,
>
> sorry maybe a newbie question but how can I set the user path for the 
> use of the readGPS() in maptools? I want to import obviously gpx data... 
> any other tips how to do that quick and easy? I am using eclipse with 
> the statet plugin for my r scripting on windows 7 (if that makes an 
> difference) thanks a lot

It may be easier to download the *.gpx file from the device using other 
software, and use readOGR() with the GPX driver from the rgdal package. 
Path variables etc., tend to be difficult when R is buried under other 
software.

Roger

>
>
>
>
> MSc. Alexander Arpaci
> Assistant researcher
>
> Department of Forest - and Soil Sciences
> Institute of Silviculture
> Tel. +43-1-47654-4081
> e-mail: alexander.arpaci at boku.ac.at
> www.wabo.boku.ac.at
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From aelmore at usgs.gov  Tue Jul  5 15:40:48 2011
From: aelmore at usgs.gov (ahelmore)
Date: Tue, 5 Jul 2011 06:40:48 -0700 (PDT)
Subject: [R-sig-Geo] OLS vs likfit sill values
Message-ID: <1309873248270-6549794.post@n2.nabble.com>

Hi, 

I'm trying to automate anisotropic semivariogram modeling and have done the
following:

1) estimated isotropic parameters of NDVI data with automap
2) fed these parameters to geoR for an OLS model fit of the geoR isotropic
experimental variogram
3) estimated anisotropy parameters for the data with intamap
4) fed the geoR OLS model parameters and intamap anisotropy parameters to
likfit to fit an anisotropic model (none of the parameters was fixed).
----------
I'm now trying to figure out why the anisotropic model that is produced has
a sill value that's a little over one and a half times as big as the OLS
model's sill value.  Additionally, both the major and minor ranges (which
are the values I'm most interested in for in my current work), are lower
than the omindirectional inputs provided, although not as remarkably
different as the sill.  
----------
The plot I've inserted below doesn't show the OLS model, but that model
basically runs right through the binned means of the omnidirectional sample
variogram (represented by filled circles in the graph), and has nugget,
partial sill, and range values of 8118, 10954, and 96, respectively.  The
likfit parameters are given in the plot's text box.  
----------
Does anyone have any ideas about why I would be getting such drastically
different models from the two different fitting routines?  I know that
likfit doesn't fit the experimental bins, returning instead to the cloud
values.  Is likfit more sensitive to outliers or normality problems than
OLS?  If you have suggested reading materials, I'm all ears (or eyes, as the
case may be).
----------
Thanks
http://r-sig-geo.2731867.n2.nabble.com/file/n6549794/test_1000_variograms_color.jpg 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/OLS-vs-likfit-sill-values-tp6549794p6549794.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From jonathan at mazamascience.com  Tue Jul  5 20:13:17 2011
From: jonathan at mazamascience.com (Jonathan Callahan)
Date: Tue, 5 Jul 2011 11:13:17 -0700
Subject: [R-sig-Geo] Using rbind with SpatialLinesDataFrame
Message-ID: <CAPjNR=Tb8MXe3PBP0cVM4=Mu_5_9pzCOPPiarxzghp-9PSzb6A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110705/73fb0491/attachment.pl>

From horacio.samaniego at gmail.com  Tue Jul  5 20:20:39 2011
From: horacio.samaniego at gmail.com (Horacio Samaniego)
Date: Tue, 5 Jul 2011 12:20:39 -0600
Subject: [R-sig-Geo] plotting latlon axes of sp object of different
	projection
In-Reply-To: <alpine.LRH.2.00.1107051300140.1850@reclus.nhh.no>
References: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
	<alpine.LRH.2.00.1107051300140.1850@reclus.nhh.no>
Message-ID: <CAAzZ5K9+vrnCPw2eD+tXLN+jPSem1jFZC=cM6+UYbJ4jUw2VwQ@mail.gmail.com>

Thanks a lot Roger,

This is a good recipe, I'ld never have figured by my own!

To fine tune this, I need to place the labels on the other sides
(north, east) of the graph. Modifying the pos column of the  grdat
object (output of gridat()) does not do the trick. I imagine that any
modification should happen in the coordinates of that object.

So I wonder if that is achievable earlier in the process.

Any helpfull thought on doing that? It would be much appreciate.

thanks!

H

On Tue, Jul 5, 2011 at 5:20 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Mon, 4 Jul 2011, Horacio Samaniego wrote:
>
>> I need to add a lat/lon axes to an equal area plot of a
>> SpatialLinesDataFrame object currently in units of meters. Is that
>> achievable using sp/maptools?
>>
>> The .prj file where the object comes from is:
>> PROJCS["Lambert_Azimuthal_Equal_Area",GEOGCS["GCS_unnamed
>>
>> ellipse",DATUM["D_unknown",SPHEROID["Unknown",6370997,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_origin",45],PARAMETER["central_meridian",-100],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["Meter",1]]
>>
>> I'ld hate to install arcinfo to generate 1 plot! (plus the plot is
>> already nice as it is!!! just need the axes!)
>
> No, the axes are in the same coordinate system as the plot, and would be
> curves here. You can overplot a long-lat grid on a projected plot:
>
> library(sp)
> data(meuse)
> coordinates(meuse) <- ~x+y
> proj4string(meuse) <- CRS("+init=epsg:28992")
> plot(meuse)
> library(rgdal)
> meuse_ll <- spTransform(meuse, CRS("+proj=longlat +datum=WGS84"))
> grd <- gridlines(meuse_ll)
> grd_x <- spTransform(grd, CRS("+init=epsg:28992"))
> plot(grd_x, add=TRUE, lty=2)
> grdat_ll <- gridat(meuse_ll)
> grdat_x <- spTransform(grdat_ll, CRS("+init=epsg:28992"))
> text(coordinates(grdat_x), labels=parse(text=grdat_x$labels),
> ?pos=grdat_x$pos, offset=grdat_x$offset)
>
> Hope this helps,
>
> Roger
>
>>
>> thanks,
>> I'll summarize!
>>
>> H
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>



-- 
Horacio Samaniego

Center for Nonlinear Studies
Los Alamos National Laboratory
MS B258
Los Alamos, New Mexico 87545

Instituto de Silvicultura
Universidad Austral de Chile
Valdivia, Chile


From edzer.pebesma at uni-muenster.de  Tue Jul  5 23:24:01 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 05 Jul 2011 23:24:01 +0200
Subject: [R-sig-Geo] Using rbind with SpatialLinesDataFrame
In-Reply-To: <CAPjNR=Tb8MXe3PBP0cVM4=Mu_5_9pzCOPPiarxzghp-9PSzb6A@mail.gmail.com>
References: <CAPjNR=Tb8MXe3PBP0cVM4=Mu_5_9pzCOPPiarxzghp-9PSzb6A@mail.gmail.com>
Message-ID: <4E1380F1.8040103@uni-muenster.de>

Please try:

row.names(basin1) = 2029:4682
row.names(basin2) = 1:2028
rbind(basin1, basin2)


On 07/05/2011 08:13 PM, Jonathan Callahan wrote:
> I have a rather large dataset of watershed data stored as a
> SpatialLinesDataFrame. I can plot and subset the data just fine.
> 
> In an effort to speed up plotting times I have broken up the watershed into
> separate basins so that I can load and plot only those basins in my region
> of interest. (This improves performance quite a lot.)
> 
> I would like to use "subWatershed = rbind(basin1,basin2,...)" to
> reconstitute a single SpatialLinesDataFrame from just a few of the basins.
> 
> My problem is that the row.names in the sub-basins retain the row.names from
> the original dataset:
> 
> rownames(basin1 at data) = 2029:4682
> rownames(basin2 at data) = 1:2028
> 
> When I use rbind(basin1,basin2) I get the following error:
> 
> Error in SpatialLinesDataFrame(ll, df) :
>   row.names of data and Lines IDs do not match
> 
> If I reverse the ordering and use rbind(basin2,basin1) everything is OK but
> I want to do this reconstitution programmatically. I won't know ahead of
> time which basins are involved or what their ordering is. In the future I
> might also use basins from adjacent watersheds which have separate numbering
> schemes.
> 
> Can anyone explain to me what exactly this error means and how I might
> resolve it?
> 
> Thanks in advance,
> 
> Jon
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From mathieu.rajerison at gmail.com  Wed Jul  6 10:26:33 2011
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Wed, 6 Jul 2011 10:26:33 +0200
Subject: [R-sig-Geo] Assessing and ranking the relationships and
 contribution of environmental correlates to species richness
In-Reply-To: <1309766888274-6545267.post@n2.nabble.com>
References: <1309721261109-6543945.post@n2.nabble.com>
	<CAGfc75=DwTBPMsEP18N=1vS4K015tp8fNW6_KdTMs2uj-3knhg@mail.gmail.com>
	<1309766888274-6545267.post@n2.nabble.com>
Message-ID: <CAGfc75nt=t9WZQLLt0n+71dgNPdmpOmmP-AzvDpacZLe4am0Sw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110706/56765a2f/attachment.pl>

From alobolistas at gmail.com  Wed Jul  6 11:54:15 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 6 Jul 2011 11:54:15 +0200
Subject: [R-sig-Geo] raster: cannot extract object from list
Message-ID: <CAG4NReKxS6nBz6JLgDCSsMB5+6tdROkLwEX9n8N2aJLFpYzhvQ@mail.gmail.com>

A function of mine outputs several raster objects in a list "l":
> class(l$lisaobsv)
[1] "RasterLayer"
attr(,"package")
[1] "raster"

But by some reason I get this weird error:
> a = l$lisaobsv
Error in slot(x, slotname) :
  no slot of name "z" for this object of class "RasterLayer"
Calls: <Anonymous> -> lapply -> FUN -> slot -> .Call
Warning message:
In .rk.get.structure.global("a") : failure to get object a

Is this a bug or is there an special way to extract raster objects from a list?

Thanks

Agus

> sessionInfo()
R version 2.13.0 (2011-04-13)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8          LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8           LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8       LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8          LC_NAME=en_US.UTF-8
 [9] LC_ADDRESS=en_US.UTF-8        LC_TELEPHONE=en_US.UTF-8
[11] LC_MEASUREMENT=en_US.UTF-8    LC_IDENTIFICATION=en_US.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
 [1] rgdal_0.6-33  geoR_1.6-27   plotrix_3.2-2 ggplot2_0.8.9 proto_0.3-8
 [6] reshape_0.8.4 plyr_1.4      raster_1.8-40 sp_0.9-76     rkward_0.5.6

loaded via a namespace (and not attached):
[1] lattice_0.19-26 tools_2.13.0


From alobolistas at gmail.com  Wed Jul  6 12:05:03 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 6 Jul 2011 12:05:03 +0200
Subject: [R-sig-Geo] raster: cannot extract object from list
In-Reply-To: <CAG4NReKxS6nBz6JLgDCSsMB5+6tdROkLwEX9n8N2aJLFpYzhvQ@mail.gmail.com>
References: <CAG4NReKxS6nBz6JLgDCSsMB5+6tdROkLwEX9n8N2aJLFpYzhvQ@mail.gmail.com>
Message-ID: <CAG4NRe+UznWi-fUUyzSBvPMsALwvsRFaMHtVt63g-2uXJ8m=ZA@mail.gmail.com>

Solved: it was caused by having upgraded to raster 1.8.40 but using
raster objects created under 1.8.38

Agus

2011/7/6 Agustin Lobo <alobolistas at gmail.com>:
> A function of mine outputs several raster objects in a list "l":
>> class(l$lisaobsv)
> [1] "RasterLayer"
> attr(,"package")
> [1] "raster"
>
> But by some reason I get this weird error:
>> a = l$lisaobsv
> Error in slot(x, slotname) :
> ?no slot of name "z" for this object of class "RasterLayer"
> Calls: <Anonymous> -> lapply -> FUN -> slot -> .Call
> Warning message:
> In .rk.get.structure.global("a") : failure to get object a
>
> Is this a bug or is there an special way to extract raster objects from a list?
>
> Thanks
>
> Agus
>
>> sessionInfo()
> R version 2.13.0 (2011-04-13)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> ?[1] LC_CTYPE=en_US.UTF-8 ? ? ? ? ?LC_NUMERIC=C
> ?[3] LC_TIME=en_US.UTF-8 ? ? ? ? ? LC_COLLATE=en_US.UTF-8
> ?[5] LC_MONETARY=en_US.UTF-8 ? ? ? LC_MESSAGES=en_US.UTF-8
> ?[7] LC_PAPER=en_US.UTF-8 ? ? ? ? ?LC_NAME=en_US.UTF-8
> ?[9] LC_ADDRESS=en_US.UTF-8 ? ? ? ?LC_TELEPHONE=en_US.UTF-8
> [11] LC_MEASUREMENT=en_US.UTF-8 ? ?LC_IDENTIFICATION=en_US.UTF-8
>
> attached base packages:
> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets ?methods
> [8] base
>
> other attached packages:
> ?[1] rgdal_0.6-33 ?geoR_1.6-27 ? plotrix_3.2-2 ggplot2_0.8.9 proto_0.3-8
> ?[6] reshape_0.8.4 plyr_1.4 ? ? ?raster_1.8-40 sp_0.9-76 ? ? rkward_0.5.6
>
> loaded via a namespace (and not attached):
> [1] lattice_0.19-26 tools_2.13.0
>


From christian.kamenik at giub.unibe.ch  Wed Jul  6 13:18:23 2011
From: christian.kamenik at giub.unibe.ch (Christian Kamenik)
Date: Wed, 6 Jul 2011 04:18:23 -0700 (PDT)
Subject: [R-sig-Geo] Subsetting RasterBrick very slow
In-Reply-To: <1309860924271-6549140.post@n2.nabble.com>
References: <4E0DD36B.5080500@giub.unibe.ch>
	<1309860924271-6549140.post@n2.nabble.com>
Message-ID: <1309951103565-6554009.post@n2.nabble.com>

Dear Robert,

Thank you for sorting this out. And thanks to all the others for their
valuable comments.

Christian

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Subsetting-RasterBrick-very-slow-tp6537890p6554009.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Wed Jul  6 14:00:13 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 6 Jul 2011 14:00:13 +0200
Subject: [R-sig-Geo] Summary: how to plot several raster layers on the same
 page and with the same color scale
Message-ID: <CAG4NReLkaf8Pwet2DbUv+LQya836W+_k2yp3p0359GsqBbGwFA@mail.gmail.com>

I summarize here the different solutions I got to my question regarding
how to plot several raster layers on the same page and with the same
color scale.
Sorry it took a long time, I was interrupted by something else for weeks.
Hope this is useful.
Many thanks to all.


require(raster)
require(ggplot2)
require(plotrix)
require(rasterVis)
require(lattice)

foo1 <- foo2 <- foo3<- foo4 <- raster(nrows=20, ncols=20)
values(foo1) <- runif(400,-100.100)
values(foo2) <- runif(400,-150,100)
values(foo3) <- runif(400,0,50)
values(foo4) <- runif(400,-100,150)
extent(foo1) = extent(foo2) = extent(foo3) = extent(foo4) = extent(c(0,20,0,20))


#Based on comment by Jeremy Raw and Andy.Bunn at wwu.edu
par(mfrow=c(2,2))
plot(foo1,col=rev(heat.colors(32)),zlim=c(-150,150))
plot(foo2,col=rev(heat.colors(32)),zlim=c(-150,150))
plot(foo3,col=rev(heat.colors(32)),zlim=c(-150,150))
plot(foo4,col=rev(heat.colors(32)),zlim=c(-150,150))

#Note by ALOBO: simplest solution

#Based on comment by Adam Sparks
require(plotrix)
minValue = -150
maxValue = 150
colstep=10
brk = c(minValue, maxValue, by = colstep)
brk = seq(minValue, maxValue, by = colstep)
par(mfrow=c(2,2))
plot(foo1, breaks = brk, col = rev(heat.colors(30)), axes = FALSE,
xlab = '', ylab = '', legend = FALSE)
color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
maxValue, by = 3*colstep),
  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
col="black")
plot(foo2, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
xlab = '', ylab = '',)
color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
maxValue, by = 3*colstep),
  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
col="black")
plot(foo3, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
xlab = '', ylab = '',)
color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
maxValue, by = 3*colstep),
  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
col="black")
plot(foo3, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
xlab = '', ylab = '',)
color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
maxValue, by = 3*colstep),
  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
col="black")


#Note by ALOBO: in practice, you must use hist() to determine
meaningful min and max values in both cases


#Based on comment by  paul.hiemstra at knmi.nl
library(ggplot2)
library(raster)
theme_set(theme_bw())

r = foo1

# Convert to data.frame
r_df = as.data.frame(as(r, 'SpatialPixelsDataFrame'))
print(str(r_df))
# create new column 10 times larger
# here you could extract data from other grids that
# you want to show at the same time
r_df$foo2 = values(foo2)
r_df$foo3 = values(foo3)
r_df$foo4 = values(foo4)

print(str(r_df))

# Reshape the data for ggplot
plotData = melt(r_df, id.vars = c('x','y'))

ggplot(aes(x = x, y = y), data = plotData) +
    geom_tile(aes(fill = value)) + facet_wrap(~ variable) +
    scale_fill_gradient(low = 'white', high = 'blue') +
    coord_equal()

#Note by ALOBO: while this is the most aesthetic solution, would it
work for large raster objects?


#Based on comment by Robert Hijmans:
#Requires raster version >= 1.8-33 and rasterVis

s <- stack(foo1,foo2, foo3,foo4)
spplot(s)
theme_set(theme_bw())
gplot(s) + geom_tile(aes(fill = value)) + facet_wrap(~ variable) +
           scale_fill_gradient(low = 'white', high = 'blue') + coord_equal()

#Note by ALOBO: assumed it automatically makes a sampleRegular() for
large raster objects?
#In such a case, it would combine aesthetic and performance


From oscar.perpinan at upm.es  Wed Jul  6 14:19:30 2011
From: oscar.perpinan at upm.es (Oscar =?UTF-8?B?UGVycGnDsWFu?= Lamigueiro)
Date: Wed, 6 Jul 2011 14:19:30 +0200
Subject: [R-sig-Geo] Summary: how to plot several raster layers on the
 same page and with the same color scale
In-Reply-To: <CAG4NReLkaf8Pwet2DbUv+LQya836W+_k2yp3p0359GsqBbGwFA@mail.gmail.com>
References: <CAG4NReLkaf8Pwet2DbUv+LQya836W+_k2yp3p0359GsqBbGwFA@mail.gmail.com>
Message-ID: <20110706141930.0fa75084@OPL-EUITI>

Hi,

Just to add one more solution. It uses the rasterVis package (at
R-Forge now and should be at CRAN today).

library(raster)
library(rasterVis)

levelplot(s, par.settings=RdBuTheme)

More examples here: http://rastervis.r-forge.r-project.org/

Best,


Oscar.


-------------------
Oscar Perpi??n Lamigueiro
Dpto. Ingenier?a El?ctrica
EUITI-UPM

http://procomun.wordpress.com

-----------------------------------------
>I summarize here the different solutions I got to my question regarding
>how to plot several raster layers on the same page and with the same
>color scale.
>Sorry it took a long time, I was interrupted by something else for
>weeks. Hope this is useful.
>Many thanks to all.
>
>
>require(raster)
>require(ggplot2)
>require(plotrix)
>require(rasterVis)
>require(lattice)
>
>foo1 <- foo2 <- foo3<- foo4 <- raster(nrows=20, ncols=20)
>values(foo1) <- runif(400,-100.100)
>values(foo2) <- runif(400,-150,100)
>values(foo3) <- runif(400,0,50)
>values(foo4) <- runif(400,-100,150)
>extent(foo1) = extent(foo2) = extent(foo3) = extent(foo4) =
>extent(c(0,20,0,20))
>
>
>#Based on comment by Jeremy Raw and Andy.Bunn at wwu.edu
>par(mfrow=c(2,2))
>plot(foo1,col=rev(heat.colors(32)),zlim=c(-150,150))
>plot(foo2,col=rev(heat.colors(32)),zlim=c(-150,150))
>plot(foo3,col=rev(heat.colors(32)),zlim=c(-150,150))
>plot(foo4,col=rev(heat.colors(32)),zlim=c(-150,150))
>
>#Note by ALOBO: simplest solution
>
>#Based on comment by Adam Sparks
>require(plotrix)
>minValue = -150
>maxValue = 150
>colstep=10
>brk = c(minValue, maxValue, by = colstep)
>brk = seq(minValue, maxValue, by = colstep)
>par(mfrow=c(2,2))
>plot(foo1, breaks = brk, col = rev(heat.colors(30)), axes = FALSE,
>xlab = '', ylab = '', legend = FALSE)
>color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
>maxValue, by = 3*colstep),
>  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
>col="black")
>plot(foo2, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
>xlab = '', ylab = '',)
>color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
>maxValue, by = 3*colstep),
>  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
>col="black")
>plot(foo3, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
>xlab = '', ylab = '',)
>color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
>maxValue, by = 3*colstep),
>  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
>col="black")
>plot(foo3, breaks = brk, col = rev(heat.colors(30)),legend = FALSE,
>xlab = '', ylab = '',)
>color.legend(xl=20.5,yb=1,xr=21.5,yt=18, legend = seq(minValue,
>maxValue, by = 3*colstep),
>  rect.col = rev(heat.colors(30)),pos=4,gradient="y",cex=0.55,offset=2,
>col="black")
>
>
>#Note by ALOBO: in practice, you must use hist() to determine
>meaningful min and max values in both cases
>
>
>#Based on comment by  paul.hiemstra at knmi.nl
>library(ggplot2)
>library(raster)
>theme_set(theme_bw())
>
>r = foo1
>
># Convert to data.frame
>r_df = as.data.frame(as(r, 'SpatialPixelsDataFrame'))
>print(str(r_df))
># create new column 10 times larger
># here you could extract data from other grids that
># you want to show at the same time
>r_df$foo2 = values(foo2)
>r_df$foo3 = values(foo3)
>r_df$foo4 = values(foo4)
>
>print(str(r_df))
>
># Reshape the data for ggplot
>plotData = melt(r_df, id.vars = c('x','y'))
>
>ggplot(aes(x = x, y = y), data = plotData) +
>    geom_tile(aes(fill = value)) + facet_wrap(~ variable) +
>    scale_fill_gradient(low = 'white', high = 'blue') +
>    coord_equal()
>
>#Note by ALOBO: while this is the most aesthetic solution, would it
>work for large raster objects?
>
>
>#Based on comment by Robert Hijmans:
>#Requires raster version >= 1.8-33 and rasterVis
>
>s <- stack(foo1,foo2, foo3,foo4)
>spplot(s)
>theme_set(theme_bw())
>gplot(s) + geom_tile(aes(fill = value)) + facet_wrap(~ variable) +
>           scale_fill_gradient(low = 'white', high = 'blue') +
> coord_equal()
>
>#Note by ALOBO: assumed it automatically makes a sampleRegular() for
>large raster objects?
>#In such a case, it would combine aesthetic and performance


From josh.london at noaa.gov  Tue Jul  5 23:26:53 2011
From: josh.london at noaa.gov (Josh London)
Date: Tue, 05 Jul 2011 14:26:53 -0700
Subject: [R-sig-Geo] plotting latlon axes of sp object of
	different	projection
In-Reply-To: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
References: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
Message-ID: <B8427381-39D5-49B8-A624-F1B020E3BEF8@noaa.gov>

Horacio

See this thread from December:

http://www.mail-archive.com/r-sig-geo at r-project.org/msg00154.html

I haven't made much progress or further tested this approach since then. It seems to work for me and my needs.

The example with the North Carolina map relies on pretty() to determine where the lines are. Depending on your projection, you may find it better to specify the graticule lines.

cheers
Josh

On Jul 4, 2011, at 10:12 PM, Horacio Samaniego wrote:

> I need to add a lat/lon axes to an equal area plot of a
> SpatialLinesDataFrame object currently in units of meters. Is that
> achievable using sp/maptools?
> 
> The .prj file where the object comes from is:
> PROJCS["Lambert_Azimuthal_Equal_Area",GEOGCS["GCS_unnamed
> ellipse",DATUM["D_unknown",SPHEROID["Unknown",6370997,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_origin",45],PARAMETER["central_meridian",-100],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["Meter",1]]
> 
> I'ld hate to install arcinfo to generate 1 plot! (plus the plot is
> already nice as it is!!! just need the axes!)
> 
> thanks,
> I'll summarize!
> 
> H
> 
> -- 
> Horacio Samaniego
> 
> Center for Nonlinear Studies
> Los Alamos National Laboratory
> MS B258
> Los Alamos, New Mexico 87545
> 
> Instituto de Silvicultura
> Universidad Austral de Chile
> Valdivia, Chile
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Josh London
Wildlife Biologist
National Marine Mammal Laboratory
NOAA
Seattle, Washington


From alobolistas at gmail.com  Wed Jul  6 17:28:17 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 6 Jul 2011 17:28:17 +0200
Subject: [R-sig-Geo] sp::overlay() not conserving row.names ?
Message-ID: <CAG4NRe+fEbY=QXwL0HPPDxCqDsnJ1RDHjN_Eo0v53QujM5phPg@mail.gmail.com>

I'm using sp::overlay between a SpPolDF and a SpPointsDF:

> delme <- overlay(rndp,q1km, fn = mean)
> class(q1km)
[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"
> class(rndp)
[1] "SpatialPointsDataFrame"
attr(,"package")
[1] "sp"
> class(delme)
[1] "data.frame"

but I'm confused by the fact that the row.names(delme) are not the same
as the row.names(q1km):
> delme[1:10,]
          ID       id      val
X1  356.3333 357.3333 643.3162
X2  454.3333 455.3333 653.1833
X3  305.0000 306.0000 101.8930
X4  486.7143 487.7143 448.4612
X5  456.2500 457.2500 544.1646
X6  255.4000 256.4000 139.7507
X7  403.6667 404.6667 659.8114
X8  462.5000 463.5000 537.7209
X9  629.2000 630.2000 399.1040
X10 416.5000 417.5000 278.2879
> q1km at data[1:10,]
   idname ID   XMIN   XMAX   YMIN   YMAX
X0     X0  0 -8.994 -8.594 43.595 43.995
X1     X1  1 -8.594 -8.194 43.595 43.995
X2     X2  2 -8.194 -7.794 43.595 43.995
X3     X3  3 -7.794 -7.394 43.595 43.995
X4     X4  4 -7.394 -6.994 43.595 43.995
X5     X5  5 -6.994 -6.594 43.595 43.995
X6     X6  6 -6.594 -6.194 43.595 43.995
X7     X7  7 -6.194 -5.794 43.595 43.995
X8     X8  8 -5.794 -5.394 43.595 43.995
X9     X9  9 -5.394 -4.994 43.595 43.995

Is this the way it has to be? If it is, then it's kind of inconvenient
as I would like to join the new table "delme" to q1km at data.
It seems I just have to subtract 1 to the numeric part of
row.names(delme), but would like to make sure.

Agus


From edzer.pebesma at uni-muenster.de  Wed Jul  6 17:35:03 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 06 Jul 2011 17:35:03 +0200
Subject: [R-sig-Geo] sp::overlay() not conserving row.names ?
In-Reply-To: <CAG4NRe+fEbY=QXwL0HPPDxCqDsnJ1RDHjN_Eo0v53QujM5phPg@mail.gmail.com>
References: <CAG4NRe+fEbY=QXwL0HPPDxCqDsnJ1RDHjN_Eo0v53QujM5phPg@mail.gmail.com>
Message-ID: <4E1480A7.2030305@uni-muenster.de>

Agus, sp::overlay will be deprecated at some stage in favour of
sp::over, which is a more consistent and complete approach to the same
problem. For instance, overlay(x,y) would do the same as overlay(y,x),
which is not good, if you think about it a bit longer (my own mistake,
long time ago).

Could you please check if sp::over has the same problems? See also
http://cran.r-project.org/web/packages/sp/vignettes/over.pdf

On 07/06/2011 05:28 PM, Agustin Lobo wrote:
> I'm using sp::overlay between a SpPolDF and a SpPointsDF:
> 
>> delme <- overlay(rndp,q1km, fn = mean)
>> class(q1km)
> [1] "SpatialPolygonsDataFrame"
> attr(,"package")
> [1] "sp"
>> class(rndp)
> [1] "SpatialPointsDataFrame"
> attr(,"package")
> [1] "sp"
>> class(delme)
> [1] "data.frame"
> 
> but I'm confused by the fact that the row.names(delme) are not the same
> as the row.names(q1km):
>> delme[1:10,]
>           ID       id      val
> X1  356.3333 357.3333 643.3162
> X2  454.3333 455.3333 653.1833
> X3  305.0000 306.0000 101.8930
> X4  486.7143 487.7143 448.4612
> X5  456.2500 457.2500 544.1646
> X6  255.4000 256.4000 139.7507
> X7  403.6667 404.6667 659.8114
> X8  462.5000 463.5000 537.7209
> X9  629.2000 630.2000 399.1040
> X10 416.5000 417.5000 278.2879
>> q1km at data[1:10,]
>    idname ID   XMIN   XMAX   YMIN   YMAX
> X0     X0  0 -8.994 -8.594 43.595 43.995
> X1     X1  1 -8.594 -8.194 43.595 43.995
> X2     X2  2 -8.194 -7.794 43.595 43.995
> X3     X3  3 -7.794 -7.394 43.595 43.995
> X4     X4  4 -7.394 -6.994 43.595 43.995
> X5     X5  5 -6.994 -6.594 43.595 43.995
> X6     X6  6 -6.594 -6.194 43.595 43.995
> X7     X7  7 -6.194 -5.794 43.595 43.995
> X8     X8  8 -5.794 -5.394 43.595 43.995
> X9     X9  9 -5.394 -4.994 43.595 43.995
> 
> Is this the way it has to be? If it is, then it's kind of inconvenient
> as I would like to join the new table "delme" to q1km at data.
> It seems I just have to subtract 1 to the numeric part of
> row.names(delme), but would like to make sure.
> 
> Agus
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From alobolistas at gmail.com  Wed Jul  6 18:10:53 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 6 Jul 2011 18:10:53 +0200
Subject: [R-sig-Geo] sp::overlay() not conserving row.names ?
In-Reply-To: <4E1480A7.2030305@uni-muenster.de>
References: <CAG4NRe+fEbY=QXwL0HPPDxCqDsnJ1RDHjN_Eo0v53QujM5phPg@mail.gmail.com>
	<4E1480A7.2030305@uni-muenster.de>
Message-ID: <CAG4NReJ79O4NUAJYF4OFPQUPftvJv2UNkn2Mi1TA7+xA9ykoLA@mail.gmail.com>

Yes!

I'm doing:
> delme2 <- over(q1km, rndp,fn = mean)

And now not only the row.names are correct and the order of the 2
arguments makes more sense, but the dimensions of the result are also
the same
that that of the first argument
(which implies rows of NA for those polygons with no points: the user
can get rid of
these rows with na.omit() later, for me having the NA is a lot better):

> delme2[1:3,]
        ID      val
0 356.3333 760.5662
1 454.3333 541.5580
2 305.0000 467.0864
> q1km at data[1:3,]
  ID   XMIN   XMAX   YMIN   YMAX
0  0 -8.994 -8.594 43.595 43.995
1  1 -8.594 -8.194 43.595 43.995
2  2 -8.194 -7.794 43.595 43.995

> dim(delme2)
[1] 299   3
> dim(q1km at data)
[1] 299   6

I can just join this table to the one of q1km:
> delme2 = cbind(idname=row.names(delme2),delme2)
> delme2[1:3,]
  idname       ID      val
0      0 356.3333 760.5662
1      1 454.3333 541.5580
2      2 305.0000 467.0864

> q1kmv2 = q1km
> q1kmv2 <- mijoin(q1kmv2,delme2[,-2], by.x=1,by.y=1)
> q1kmv2 at data[1:3,]
  ID   XMIN   XMAX   YMIN   YMAX idname      val
0  0 -8.994 -8.594 43.595 43.995      0 760.5662
1  1 -8.594 -8.194 43.595 43.995      1 541.5580
2  2 -8.194 -7.794 43.595 43.995      2 467.0864
3  3 -7.794 -7.394 43.595 43.995      3 487.6461

Thanks!
Agus

2011/7/6 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
> Agus, sp::overlay will be deprecated at some stage in favour of
> sp::over, which is a more consistent and complete approach to the same
> problem. For instance, overlay(x,y) would do the same as overlay(y,x),
> which is not good, if you think about it a bit longer (my own mistake,
> long time ago).
>
> Could you please check if sp::over has the same problems? See also
> http://cran.r-project.org/web/packages/sp/vignettes/over.pdf
>
> On 07/06/2011 05:28 PM, Agustin Lobo wrote:
>> I'm using sp::overlay between a SpPolDF and a SpPointsDF:
>>
>>> delme <- overlay(rndp,q1km, fn = mean)
>>> class(q1km)
>> [1] "SpatialPolygonsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>> class(rndp)
>> [1] "SpatialPointsDataFrame"
>> attr(,"package")
>> [1] "sp"
>>> class(delme)
>> [1] "data.frame"
>>
>> but I'm confused by the fact that the row.names(delme) are not the same
>> as the row.names(q1km):
>>> delme[1:10,]
>> ? ? ? ? ? ID ? ? ? id ? ? ?val
>> X1 ?356.3333 357.3333 643.3162
>> X2 ?454.3333 455.3333 653.1833
>> X3 ?305.0000 306.0000 101.8930
>> X4 ?486.7143 487.7143 448.4612
>> X5 ?456.2500 457.2500 544.1646
>> X6 ?255.4000 256.4000 139.7507
>> X7 ?403.6667 404.6667 659.8114
>> X8 ?462.5000 463.5000 537.7209
>> X9 ?629.2000 630.2000 399.1040
>> X10 416.5000 417.5000 278.2879
>>> q1km at data[1:10,]
>> ? ?idname ID ? XMIN ? XMAX ? YMIN ? YMAX
>> X0 ? ? X0 ?0 -8.994 -8.594 43.595 43.995
>> X1 ? ? X1 ?1 -8.594 -8.194 43.595 43.995
>> X2 ? ? X2 ?2 -8.194 -7.794 43.595 43.995
>> X3 ? ? X3 ?3 -7.794 -7.394 43.595 43.995
>> X4 ? ? X4 ?4 -7.394 -6.994 43.595 43.995
>> X5 ? ? X5 ?5 -6.994 -6.594 43.595 43.995
>> X6 ? ? X6 ?6 -6.594 -6.194 43.595 43.995
>> X7 ? ? X7 ?7 -6.194 -5.794 43.595 43.995
>> X8 ? ? X8 ?8 -5.794 -5.394 43.595 43.995
>> X9 ? ? X9 ?9 -5.394 -4.994 43.595 43.995
>>
>> Is this the way it has to be? If it is, then it's kind of inconvenient
>> as I would like to join the new table "delme" to q1km at data.
>> It seems I just have to subtract 1 to the numeric part of
>> row.names(delme), but would like to make sure.
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster
> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
> 8333081, Fax: +49 251 8339763 ?http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics ? ? ?e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Wed Jul  6 19:29:33 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 06 Jul 2011 19:29:33 +0200
Subject: [R-sig-Geo] sp::overlay() not conserving row.names ?
In-Reply-To: <CAG4NReJ79O4NUAJYF4OFPQUPftvJv2UNkn2Mi1TA7+xA9ykoLA@mail.gmail.com>
References: <CAG4NRe+fEbY=QXwL0HPPDxCqDsnJ1RDHjN_Eo0v53QujM5phPg@mail.gmail.com>	<4E1480A7.2030305@uni-muenster.de>
	<CAG4NReJ79O4NUAJYF4OFPQUPftvJv2UNkn2Mi1TA7+xA9ykoLA@mail.gmail.com>
Message-ID: <4E149B7D.6000601@uni-muenster.de>

I'm not too familiar with GIS terminology, but would you agree that
sp::over does (or allows for) a spatial table join?

On 07/06/2011 06:10 PM, Agustin Lobo wrote:
> Yes!
> 
> I'm doing:
>> delme2 <- over(q1km, rndp,fn = mean)
> 
> And now not only the row.names are correct and the order of the 2
> arguments makes more sense, but the dimensions of the result are also
> the same
> that that of the first argument
> (which implies rows of NA for those polygons with no points: the user
> can get rid of
> these rows with na.omit() later, for me having the NA is a lot better):
> 
>> delme2[1:3,]
>         ID      val
> 0 356.3333 760.5662
> 1 454.3333 541.5580
> 2 305.0000 467.0864
>> q1km at data[1:3,]
>   ID   XMIN   XMAX   YMIN   YMAX
> 0  0 -8.994 -8.594 43.595 43.995
> 1  1 -8.594 -8.194 43.595 43.995
> 2  2 -8.194 -7.794 43.595 43.995
> 
>> dim(delme2)
> [1] 299   3
>> dim(q1km at data)
> [1] 299   6
> 
> I can just join this table to the one of q1km:
>> delme2 = cbind(idname=row.names(delme2),delme2)
>> delme2[1:3,]
>   idname       ID      val
> 0      0 356.3333 760.5662
> 1      1 454.3333 541.5580
> 2      2 305.0000 467.0864
> 
>> q1kmv2 = q1km
>> q1kmv2 <- mijoin(q1kmv2,delme2[,-2], by.x=1,by.y=1)
>> q1kmv2 at data[1:3,]
>   ID   XMIN   XMAX   YMIN   YMAX idname      val
> 0  0 -8.994 -8.594 43.595 43.995      0 760.5662
> 1  1 -8.594 -8.194 43.595 43.995      1 541.5580
> 2  2 -8.194 -7.794 43.595 43.995      2 467.0864
> 3  3 -7.794 -7.394 43.595 43.995      3 487.6461
> 
> Thanks!
> Agus
> 
> 2011/7/6 Edzer Pebesma <edzer.pebesma at uni-muenster.de>:
>> Agus, sp::overlay will be deprecated at some stage in favour of
>> sp::over, which is a more consistent and complete approach to the same
>> problem. For instance, overlay(x,y) would do the same as overlay(y,x),
>> which is not good, if you think about it a bit longer (my own mistake,
>> long time ago).
>>
>> Could you please check if sp::over has the same problems? See also
>> http://cran.r-project.org/web/packages/sp/vignettes/over.pdf
>>
>> On 07/06/2011 05:28 PM, Agustin Lobo wrote:
>>> I'm using sp::overlay between a SpPolDF and a SpPointsDF:
>>>
>>>> delme <- overlay(rndp,q1km, fn = mean)
>>>> class(q1km)
>>> [1] "SpatialPolygonsDataFrame"
>>> attr(,"package")
>>> [1] "sp"
>>>> class(rndp)
>>> [1] "SpatialPointsDataFrame"
>>> attr(,"package")
>>> [1] "sp"
>>>> class(delme)
>>> [1] "data.frame"
>>>
>>> but I'm confused by the fact that the row.names(delme) are not the same
>>> as the row.names(q1km):
>>>> delme[1:10,]
>>>           ID       id      val
>>> X1  356.3333 357.3333 643.3162
>>> X2  454.3333 455.3333 653.1833
>>> X3  305.0000 306.0000 101.8930
>>> X4  486.7143 487.7143 448.4612
>>> X5  456.2500 457.2500 544.1646
>>> X6  255.4000 256.4000 139.7507
>>> X7  403.6667 404.6667 659.8114
>>> X8  462.5000 463.5000 537.7209
>>> X9  629.2000 630.2000 399.1040
>>> X10 416.5000 417.5000 278.2879
>>>> q1km at data[1:10,]
>>>    idname ID   XMIN   XMAX   YMIN   YMAX
>>> X0     X0  0 -8.994 -8.594 43.595 43.995
>>> X1     X1  1 -8.594 -8.194 43.595 43.995
>>> X2     X2  2 -8.194 -7.794 43.595 43.995
>>> X3     X3  3 -7.794 -7.394 43.595 43.995
>>> X4     X4  4 -7.394 -6.994 43.595 43.995
>>> X5     X5  5 -6.994 -6.594 43.595 43.995
>>> X6     X6  6 -6.594 -6.194 43.595 43.995
>>> X7     X7  7 -6.194 -5.794 43.595 43.995
>>> X8     X8  8 -5.794 -5.394 43.595 43.995
>>> X9     X9  9 -5.394 -4.994 43.595 43.995
>>>
>>> Is this the way it has to be? If it is, then it's kind of inconvenient
>>> as I would like to join the new table "delme" to q1km at data.
>>> It seems I just have to subtract 1 to the numeric part of
>>> row.names(delme), but would like to make sure.
>>>
>>> Agus
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From alfreale74 at gmail.com  Thu Jul  7 12:32:16 2011
From: alfreale74 at gmail.com (Alfredo Alessandrini)
Date: Thu, 7 Jul 2011 12:32:16 +0200
Subject: [R-sig-Geo] apply a formula by matrix
Message-ID: <CA+GC7G6a12BAbSp9Hu2nzPjaKaYrFLK5u+GGVoWPGmdq2Fhw3A@mail.gmail.com>

Hi,

I've to apply a formula to a raster in relation to an index table
created from raster stack.

I'm trying to explain the problem:

I've three raster with same resolution, that I join in a raster
RasterStack, and from it I can obtain a table like this:

>  data <- stack(dem,aer550,aer550_type)

>  unique(as.matrix(data))
      layer_1      layer_2 layer_3
 [1,]       1 0.2460000000       2
 [2,]       1 0.1845000000       2
 [3,]       1 0.0000000001       2
 [4,]       0 0.0000000001       2
 [5,]       1 0.1476000000       2
 [6,]       1 0.0000000001       0
 [7,]       0 0.0000000001       0
.........
........

>From this table I develop a linear model that after I've to apply to
another raster that isn't in the raster stack and it has a higher
resolution.

I've to compute the function for the raster with higher resolution,
according to the coefficients of the rows, and only for specific
pixels.(layer_1 = 1 AND layer_2 = 0.246 AND layer_3 = 2) --> function
( -0.2710751  0.7981552 )


   layer_1      layer_2 layer_3        coeff_model_1      coeff_model_2
1        1 0.2460000000       2 -0.2710751  0.7981552
2        1 0.1845000000       2 -1.1499351 -0.6216590
3        1 0.0000000001       2 -0.6643215  0.1993647
4        0 0.0000000001       2 -1.0418143  1.5379033
5        1 0.1476000000       2  2.3148048  0.8951158
6        1 0.0000000001       0 -0.2710751  0.7981552
7        0 0.0000000001       0 -1.1499351 -0.6216590
.......
.......


Thanks in advance,

Alfredo


From camille.garcin10 at gmail.com  Thu Jul  7 13:32:02 2011
From: camille.garcin10 at gmail.com (camille garcin)
Date: Thu, 7 Jul 2011 13:32:02 +0200
Subject: [R-sig-Geo] how to get a SpatialGrid object from a .gri file ?
Message-ID: <CAMxV5dnQwSFMm7SkSuNMmOLzwyopw6fhdQqLGZe=OMhtKxCNfA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110707/815f4981/attachment.pl>

From m.fairbrother at bristol.ac.uk  Thu Jul  7 13:37:25 2011
From: m.fairbrother at bristol.ac.uk (Malcolm Fairbrother)
Date: Thu, 7 Jul 2011 12:37:25 +0100
Subject: [R-sig-Geo] spatial modelling Lectureship at the University of
	Bristol
Message-ID: <3F3CCCD7-8466-45B2-B315-84A1E73AAB8C@bristol.ac.uk>

Dear list,

Please see below an announcement about a job opening in the School of Geographical Sciences at the University of Bristol. The post is only just being advertised today, but there is a need to have someone in post by October -- so there is a very short time before the deadline.

Subscribers to this list looking for a beginning academic appointment in the social sciences would be very appropriate applicants. Please be aware the post is for three years.

- Malcolm

Dr Malcolm Fairbrother
Lecturer
School of Geographical Sciences
University of Bristol

___________________________________________

Lecturer in Quantitative Geography (vacancy ref. 16443)

The School of Geographical Sciences is looking to appoint an enthusiastic and committed person to a Lectureship in Quantitative Geography. You will deliver teaching in quantitative methods at both undergraduate and postgraduate levels, as well as other substantive areas of human geography. You will be able to teach regression methods, ideally through the medium of R. The post is advertised at three years in the first instance, and you will need to develop your own research agenda, contribute to initiatives within the Spatial Modelling research group, and participate in the range of activities in the School as well as building strong research links more broadly.

You will become a member of the Spatial Modelling Research Group (www.bris.ac.uk/geography/research/spatial-modelling/) which has an international reputation as a leading centre for spatial analysis. It focuses on innovative methodologies and techniques for the analysis of spatial data and their application to social, political and economic research problems. In addition the Group has a strong interest in the development of innovative social science software.

This Lectureship offers an exciting opportunity to join this innovative research group and to contribute to future developments in the School of Geographical Sciences.  Applications are welcomed from both human geographers and social scientists in cognate disciplines who have research interests in quantitative analysis in the social sciences using geographical data. You will have an emerging international reputation for research (or will be able to demonstrate a capacity to build such a reputation) and an excellent record of publication for their career stage.

Grade : Level b in Pathway 1
Salary : ?33,734

Please see: http://www.bris.ac.uk/boris/jobs/feeds/ads?ID=98491


From etiennebr at gmail.com  Thu Jul  7 14:47:29 2011
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Thu, 7 Jul 2011 08:47:29 -0400
Subject: [R-sig-Geo] plot3D raster coordinates
Message-ID: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110707/6aa76270/attachment.pl>

From etiennebr at gmail.com  Thu Jul  7 15:41:02 2011
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Thu, 7 Jul 2011 09:41:02 -0400
Subject: [R-sig-Geo] plot3D raster coordinates
In-Reply-To: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>
References: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>
Message-ID: <CALjAYt6cvwUtze=kb0Z=X9YSFR=h9t=xDETPHQtbbTCd0gvh2w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110707/8ad8ef84/attachment.pl>

From jeffrey.stratford at wilkes.edu  Thu Jul  7 15:52:29 2011
From: jeffrey.stratford at wilkes.edu (Stratford, Jeffrey)
Date: Thu, 7 Jul 2011 09:52:29 -0400
Subject: [R-sig-Geo] Error in anyDuplicated.default(coords) message with
	trinb
Message-ID: <72B2B2BDFE51E64DAC6381495614980007A0749B@STAFFEXCHVS3.wilkesu.wilkes.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110707/2a997fdd/attachment.pl>

From edzer.pebesma at uni-muenster.de  Thu Jul  7 16:34:02 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 07 Jul 2011 16:34:02 +0200
Subject: [R-sig-Geo] Error in anyDuplicated.default(coords) message with
 trinb
In-Reply-To: <72B2B2BDFE51E64DAC6381495614980007A0749B@STAFFEXCHVS3.wilkesu.wilkes.edu>
References: <72B2B2BDFE51E64DAC6381495614980007A0749B@STAFFEXCHVS3.wilkesu.wilkes.edu>
Message-ID: <4E15C3DA.6030103@uni-muenster.de>

Jeff, ?tri2nb suggests you to try

tri2nb(coordinates(data.sp))

On 07/07/2011 03:52 PM, Stratford, Jeffrey wrote:
> Hi everyone,
> 
>  
> 
> I'm attempting to do some spatial analyses with a relatively simple data
> set and I'm running into some issues.  Here's my code:
> 
>  
> 
> sosp09 <- read.csv("f:\\sosp\\2009\\sosp09.means.csv", header=T)
> 
> sp.point <- cbind(sosp09$x, sosp09$y)
> 
> colnames(sp.point) <- c("LONG","LAT") 
> 
> # Projection: UTM Zone 17
> 
> proj <- CRS("+proj=utm +zone=18 +datum=WGS84")
> 
> # Create spatial object
> 
> data.sp <- SpatialPointsDataFrame(coords=sp.point, data=sosp09,
> proj4string=proj)
> 
> ## Bounding box of data points
> 
> bbox(data.sp)
> 
> #build neighborhood
> 
> sosp.neigh <- tri2nb(data.sp)
> 
>  
> 
> And, with the last step, I get 
> 
>  
> 
> Error in anyDuplicated.default(coords) : 
> 
>   anyDuplicated() applies only to vectors
> 
>  
> 
> I went through and removed duplicated rows by averaging the responses
> and I still get this message.  I also removed via rm() all the objected
> from the original analysis and I still get this message.  Any ideas
> what's going on?
> 
>  
> 
> Thanks,
> 
>  
> 
> Jeff
> 
>  
> 
> The data:
> 
>  
> 
>  
> 
> new("SpatialPointsDataFrame"
> 
>     , data = structure(list(band = c(6467L, 6483L, 6466L, 6465L, 6463L,
> 6462L, 
> 
> 6498L, 6443L, 6496L, 6495L, 6459L, NA, 6458L, 6491L, 6446L, 6464L, 
> 
> NA, 6473L, 6444L, 6457L, 6468L, NA, 6485L, 6474L, 6445L, 6486L, 
> 
> 6488L, 6472L, 6493L, 6492L, 6471L, 6449L, 6453L, 6460L, 6482L
> 
> ), site = structure(c(19L, 26L, 18L, 17L, 15L, 14L, 35L, 1L, 
> 
> 34L, 33L, 12L, 8L, 11L, 30L, 4L, 16L, 5L, 23L, 2L, 10L, 20L, 
> 
> 9L, 27L, 24L, 3L, 28L, 29L, 22L, 32L, 31L, 21L, 6L, 7L, 13L, 
> 
> 25L), .Label = c("SOSP0901", "SOSP0902", "SOSP0903", "SOSP0904", 
> 
> "SOSP0905", "SOSP0906", "SOSP0908", "SOSP0909", "SOSP0910", "sosp0911", 
> 
> "sosp0912", "sosp0913", "sosp0914", "SOSP0915", "SOSP0916", "SOSP0917", 
> 
> "SOSP0918", "SOSP0919", "SOSP0920", "SOSP0921", "SOSP0925", "SOSP0926", 
> 
> "SOSP0927", "SOSP0928", "Sosp0934", "Sosp0935", "Sosp0936", "Sosp0937", 
> 
> "Sosp0938", "Sosp0940", "Sosp0941", "Sosp0942", "Sosp0943", "Sosp0944", 
> 
> "Sosp0946"), class = "factor"), sex = structure(c(1L, 1L, 1L, 
> 
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
> 
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L
> 
> ), .Label = "M", class = "factor"), age = structure(c(1L, 1L, 
> 
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
> 
> 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
> 
> 1L), .Label = "AHY", class = "factor"), wing = c(66, 62, 66, 
> 
> 65, 65, 64.5, 66, 69, 64.5, 67.5, 66, 66.5, 68, 67, 66, 67, 64.5, 
> 
> 68, 65, 65, 66, 65.5, 65, 66, 64, 65, 65, 66, 66, 63, 67, 66, 
> 
> 66, 65, 64), tail = c(69, 67, 69, 66, 67, 65, 66, 68, 64, 67.5, 
> 
> 66, 66, 67, 67, 67, 70, 69, 64, 67, 69, 68, 65.5, 66, 67, 65, 
> 
> 66, 66, 68, 71, 55, 72, 62, 70, 70, 66), bill = c(9, 9.7, 9.6, 
> 
> 9.5, 9.6, 8.5, 9.2, 9.5, 8.4, 9.2, 9.9, 8.8, 8.8, 9.2, 8.6, 9.6, 
> 
> 9.15, 9.7, 9.7, 8.7, 8.9, 9.45, 8.8, 9.1, 9.2, 9.2, 9.1, 8.9, 
> 
> 9.6, 8.7, 9.2, 8.8, 9.2, 9, 9.3), tarsus = c(21.6, 20.6, 20.9, 
> 
> 21.8, 20.9, 19.6, 22, 21.5, 21.7, 21.3, 22.1, 21.15, 19.9, 22.4, 
> 
> 22, 20.1, 21.85, 21.6, 20.9, 21.5, 22.4, 21.5, 21.3, 21.2, 21.5, 
> 
> 20.6, 21.4, 21.4, 21.4, 21.7, 21.4, 21.1, 20.6, 20.1, 22.2), 
> 
>     mass = c(20.8, 20.6, 21.1, 22.3, NA, 16.7, 23, 23.2, 20.7, 
> 
>     20.9, 27.3, 21.1, 21.4, 24.3, 23.2, 21.7, 22, 21, NA, 20.1, 
> 
>     20.5, 21.4, 20.5, 23.3, 21.5, 20.5, 20.8, 21, 21.3, 20.3, 
> 
>     20.4, 21, 22.9, 19.7, 21.5), x = c(1647222L, 1648242L, 1648272L, 
> 
>     1648422L, 1651242L, 1652472L, 1652472L, 1653042L, 1653282L, 
> 
>     1653372L, 1654092L, 1654212L, 1654362L, 1655082L, 1657032L, 
> 
>     1657212L, 1657272L, 1657932L, 1658292L, 1658412L, 1658772L, 
> 
>     1659072L, 1659192L, 1659342L, 1659702L, 1659762L, 1659912L, 
> 
>     1660692L, 1660872L, 1661022L, 1661082L, 1662042L, 1662192L, 
> 
>     1663362L, 1663512L), y = c(2207359L, 2206909L, 2207479L, 
> 
>     2202859L, 2203219L, 2204599L, 2198299L, 2194849L, 2202889L, 
> 
>     2208229L, 2199469L, 2199649L, 2199769L, 2202589L, 2198089L, 
> 
>     2201449L, 2198029L, 2201209L, 2202529L, 2201989L, 2203549L, 
> 
>     2202529L, 2203519L, 2201209L, 2202499L, 2204179L, 2203459L, 
> 
>     2200939L, 2208469L, 2208709L, 2201419L, 2204299L, 2204989L, 
> 
>     2206339L, 2202619L), urban1 = c(0.1724138, 0.2068966, 0.06896552, 
> 
>     0.2413793, 0.5172413, 0.34482762, 0.55172422, 0.138, 0.06896552, 
> 
>     0.03448276, 0.06896552, 1, 0.9655172, 0.4827586, 0.966, 0.8965516, 
> 
>     0.31, 1, 1, 0.99999996, 0.79310346, 1, 1.00000012, 0.99999992, 
> 
>     1, 0.99999998, 1, 0.9999999, 0.48275866, 1, 1.0000001, 1, 
> 
>     1, 1, 0.7241379), urban2 = c(0.2214765, 0.12751683, 0.18791945, 
> 
>     0.09395973, 0.24832219, 0.1946309, 0.32885906, 0.315, 0.08724833, 
> 
>     0.05369128, 0.3959732, 0.583892609, 0.77181212, 0.42281877, 
> 
>     0.758, 0.6577181, 0.564, 1.00000014, 0.993, 0.99999997, 0.63758395, 
> 
>     0.7919463, 1.00000003, 1, 1, 1.0000001, 0.73154363, 1.00000004, 
> 
>     0.59731537, 0.8993289, 0.97315443, 1, 0.913, 1.00000001, 
> 
>     0.75838925), urbank = c(0.0976826, 0.210325588, 0.360516315, 
> 
>     0.063361691, 0.060721623, 0.23995307, 0.18979175, 0.275, 
> 
>     0.065708423, 0.1589909, 0.332942288, 0.33499561, 0.3367556, 
> 
>     0.333528917, 0.557, 0.4297448, 0.561, 0.46318564, 0.29, 0.37870337, 
> 
>     0.37224991, 0.30272811, 0.34262238, 0.4197712, 0.341, 0.41126437, 
> 
>     0.3663831, 0.53300091, 0.45878559, 0.5136404, 0.46787914, 
> 
>     0.521, 0.463, 0.55148132, 0.40745079), forested1 = c(0, 0, 
> 
>     0.5172414, 0.1724138, 0, 0.20689652, 0.44827586, 0.552, 0.93103452, 
> 
>     0.724138, 0.8275862, 0, 0.03448276, 0.4482758, 0, 0, 0.345, 
> 
>     0, 0, 0, 0.03448276, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
> 
>     0, 0.27586212), forested2 = c(0.01342282, 0, 0.302013509, 
> 
>     0.14765102, 0.04026846, 0.33557047, 0.59060398, 0.537, 0.80536914, 
> 
>     0.6308725, 0.3624162, 0.21476511, 0.19463083, 0.53020128, 
> 
>     0.208, 0.053691279, 0.268, 0, 0, 0, 0.06040268, 0, 0, 0, 
> 
>     0, 0, 0.11409395, 0, 0, 0.05369128, 0.02684564, 0, 0.034, 
> 
>     0, 0.2416107), forestedk = c(0.38163685, 0.25579349, 0.19829863, 
> 
>     0.5916691, 0.5819888, 0.48958633, 0.46758578, 0.424, 0.79319447, 
> 
>     0.5946026, 0.21120558, 0.21883251, 0.21883252, 0.46142569, 
> 
>     0.255, 0.072748608, 0.182, 0.02904077, 0.067, 0.000586682, 
> 
>     0.089469052, 0.082722209, 0.098855966, 0.01320035, 0.078, 
> 
>     0.026987389, 0.078322094, 0.009093576, 0.013493693, 0.014373716, 
> 
>     0.009093576, 0.049, 0.082, 0.03314755, 0.297154573), shrubby1 =
> c(0.8275862, 
> 
>     0.7931035, 0.4137932, 0.5862069, 0.4827586, 0.2413793, 0, 
> 
>     0.31, 0, 0.2413793, 0.1034483, 0, 0, 0.06896552, 0.034, 0, 
> 
>     0.345, 0, 0, 0, 0.1724138, 0, 0, 0, 0, 0, 0, 0, 0.5172414, 
> 
>     0, 0, 0, 0, 0, 0), shrubby2 = c(0.76510064, 0.758389309, 
> 
>     0.5100671, 0.7583892, 0.7114094, 0.20805372, 0.06040268, 
> 
>     0.148, 0, 0.31543623, 0.22818796, 0.201342299, 0.033557049, 
> 
>     0, 0, 0.04697987, 0.04, 0, 0.007, 0, 0.27516781, 0, 0, 0, 
> 
>     0, 0, 0.08053692, 0, 0.4026846, 0.04697987, 0, 0, 0.034, 
> 
>     0, 0), shrubbyk = c(0.51305367, 0.513347012, 0.41947781, 
> 
>     0.341449058, 0.343502535, 0.231152806, 0.173364628, 0.172, 
> 
>     0.13229683, 0.24611325, 0.290994421, 0.243766531, 0.213552315, 
> 
>     0.066295101, 0.048, 0.044001168, 0.038, 0.01760047, 0.164, 
> 
>     0.032560866, 0.171604586, 0.116456448, 0.148430628, 0.005280141, 
> 
>     0.055, 0.024640656, 0.050748025, 0.002933411, 0.11440306, 
> 
>     0.10237605, 0, 0.045, 0.075, 0.028160755, 0.0099736), l = c(0, 
> 
>     1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0.5, 0, 0, 0, 
> 
>     0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0), p = c(0L, 1L, 
> 
>     0L, 0L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 0L, 1L, 
> 
>     1L, 0L, 0L, 1L, 0L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 1L, 0L, 
> 
>     1L, 0L, 0L), h = c(0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 1L, 
> 
>     0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 0L, 0L, 
> 
>     1L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L), o = c(0, 0, 0, 0, 
> 
>     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.5, 0, 0, 0, 0, 0, 0, 
> 
>     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), infected = c(0L, 1L, 
> 
>     0L, 0L, 0L, 0L, 1L, 1L, 1L, 1L, 1L, 0L, 1L, 0L, 1L, 0L, 1L, 
> 
>     1L, 1L, 0L, 1L, 0L, 0L, 1L, 0L, 1L, 0L, 1L, 0L, 1L, 1L, 0L, 
> 
>     1L, 0L, 0L)), .Names = c("band", "site", "sex", "age", "wing", 
> 
> "tail", "bill", "tarsus", "mass", "x", "y", "urban1", "urban2", 
> 
> "urbank", "forested1", "forested2", "forestedk", "shrubby1", 
> 
> "shrubby2", "shrubbyk", "l", "p", "h", "o", "infected"), class =
> "data.frame", row.names = c(NA, 
> 
> -35L))
> 
>     , coords.nrs = numeric(0)
> 
>     , coords = structure(c(1647222, 1648242, 1648272, 1648422, 1651242,
> 1652472, 
> 
> 1652472, 1653042, 1653282, 1653372, 1654092, 1654212, 1654362, 
> 
> 1655082, 1657032, 1657212, 1657272, 1657932, 1658292, 1658412, 
> 
> 1658772, 1659072, 1659192, 1659342, 1659702, 1659762, 1659912, 
> 
> 1660692, 1660872, 1661022, 1661082, 1662042, 1662192, 1663362, 
> 
> 1663512, 2207359, 2206909, 2207479, 2202859, 2203219, 2204599, 
> 
> 2198299, 2194849, 2202889, 2208229, 2199469, 2199649, 2199769, 
> 
> 2202589, 2198089, 2201449, 2198029, 2201209, 2202529, 2201989, 
> 
> 2203549, 2202529, 2203519, 2201209, 2202499, 2204179, 2203459, 
> 
> 2200939, 2208469, 2208709, 2201419, 2204299, 2204989, 2206339, 
> 
> 2202619), .Dim = c(35L, 2L), .Dimnames = list(NULL, c("LONG", 
> 
> "LAT")))
> 
>     , bbox = structure(c(1647222, 2194849, 1663512, 2208709), .Dim =
> c(2L, 
> 
> 2L), .Dimnames = list(c("LONG", "LAT"), c("min", "max")))
> 
>     , proj4string = new("CRS"
> 
>     , projargs = "+proj=utm +zone=18 +datum=WGS84"
> 
> )
> 
> )
> 
>  
> 
>  
> 
>  
> 
> *****************************************
> 
> Jeffrey A. Stratford, Ph.D.
> 
> Department of Health and Biological Sciences
> 
> 84 W. South St.
> 
> Wilkes Univertsity, PA 18766
> 
> 570-332-2942
> 
> http://web.wilkes.edu/jeffrey.stratford/
> 
> *****************************************
> 
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From sarah.papworth06 at imperial.ac.uk  Thu Jul  7 18:25:32 2011
From: sarah.papworth06 at imperial.ac.uk (Sarah Papworth)
Date: Thu, 7 Jul 2011 17:25:32 +0100
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>
References: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>
Message-ID: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>

Dear all,

I have a jpg map of altitudinal contours in my study area which I
would like to map and use in R to calculate the altitude and slope of
GPS coordinates.
So far, I have painstakingly traced these contours in ArcMap to create
a shapefile (of polylines) with altitude. I have now imported this
file shapefile into R.

?What I would like to do is turn it into a raster of slope and
altitude, but I can't seem to find any method of doing this in the
online R help archives. Does anyone have any idea which package I
should be using, or perhaps if it is even possible to turn this type
of shapefile into a raster?

Thanks in advance!

Sarah


-- 
Imperial College London
http://www.iccs.org.uk/sarahpapworth.htm


From b.rowlingson at lancaster.ac.uk  Thu Jul  7 18:56:04 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 7 Jul 2011 17:56:04 +0100
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
References: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>
	<CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
Message-ID: <CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>

On Thu, Jul 7, 2011 at 5:25 PM, Sarah Papworth
<sarah.papworth06 at imperial.ac.uk> wrote:
> Dear all,
>
> I have a jpg map of altitudinal contours in my study area which I
> would like to map and use in R to calculate the altitude and slope of
> GPS coordinates.
> So far, I have painstakingly traced these contours in ArcMap to create
> a shapefile (of polylines) with altitude. I have now imported this
> file shapefile into R.
>
> ?What I would like to do is turn it into a raster of slope and
> altitude, but I can't seem to find any method of doing this in the
> online R help archives. Does anyone have any idea which package I
> should be using, or perhaps if it is even possible to turn this type
> of shapefile into a raster?

 There's definitely tools for doing this in GRASS-GIS:

http://linfiniti.com/2010/12/3d-visualisation-and-dem-creation-in-qgis-with-the-grass-plugin/

 but not sure about R. One approach might be:

 load shapefile into R as a SpatialLinesDataFrame, so that each line
has its height attribute.

 consider a grid of points over the space, and use rgeos functions to
find the nearest contour line and its height. Assign height to that
grid point.

 That will give you a grid that will look a bit like terraces between
the contours, which you could possibly then smooth, although there may
be systematic errors with this method...

 I suspect there's a better way by looking at more than one nearby
contour line and doing some interpolation....

Actually the GRASS algorithms are discussed here:

http://grass.osgeo.org/wiki/Contour_lines_to_DEM

Barry


From b.rowlingson at lancaster.ac.uk  Thu Jul  7 20:04:28 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 7 Jul 2011 19:04:28 +0100
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
References: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>
	<CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
Message-ID: <CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>

> ?I suspect there's a better way by looking at more than one nearby
> contour line and doing some interpolation....

 I've got fairly good algorithm going now, but it requires a bit of
modification of some sp package code.

 Currently spsample can return random or regular  points on a line,
but doesn't tell you which line the point came from. Hence there's no
way to get the height of that line.

 But a bit of tweaking to the sampling code fixes that. My
modification returns a spatial points data frame of points and line
IDs. I'll not post that code here yet because Roger usually knows ways
of doing my hacky things without hacking. I know that overlay() won't
do it for you...

 Anyway, then I can get a set of (x,y,height) points on the contour
lines, and then use any standard interpolation function (interp from
akima for example) to get a grid. Looks pretty good, and also pretty
quick. A 500x500 grid from a contour set with 212 contour lines is
pretty instantaneous.

Barry


From schmidbe at in.tum.de  Thu Jul  7 20:11:04 2011
From: schmidbe at in.tum.de (Markus Schmidberger)
Date: Thu, 07 Jul 2011 20:11:04 +0200
Subject: [R-sig-Geo] Running R on a Computer Cluster in the Cloud -
	cloudnumbers.com
Message-ID: <1310062264.2480.2.camel@schmidb-TravelMate8572TG>

Dear analysts for geographical data and R users,

cloudnumbers.com provides researchers and companies with the resources
to perform high performance calculations in the cloud. As
cloudnumbers.com's community manager I may invite you to register and
test R on a computer cluster in the cloud for free:
http://my.cloudnumbers.com/register

Our aim is to change the way of research collaboration is done today by
bringing together scientists and businesses from all over the world on a
single platform. cloudnumbers.com is a Berlin (Germany) based
international high-tech startup striving for enabling everyone to
benefit from the High Performance Computing related advantages of the
cloud. We provide easy access to applications running on any kind of
computer hardware: from single core high memory machines up to 1000
cores computer clusters.

Our platform provides several advantages:

* Turn fixed into variable costs and pay only for the capacity you need.
Watch our latest saving costs with cloudnumbers.com video:
http://www.youtube.com/watch?v=ln_BSVigUhg&feature=player_embedded

* Enter the cloud using an intuitive and user friendly platform. Watch
our latest cloudnumbers.com in a nutshell video:
http://www.youtube.com/watch?v=0ZNEpR_ElV0&feature=player_embedded

* Be released from ongoing technological obsolescence and continuous
maintenance costs (e.g. linking to libraries or system dependencies)

* Accelerated your R, C, C++, Fortran, Python, ... calculations through
parallel processing and great computing capacity - more than 1000 cores
are available and GPUs are coming soon.

* Share your results worldwide (coming soon).

* Get high speed access to public databases.

* We have developed a security architecture that meets high requirements
of data security and privacy. Read our security white paper:
http://d1372nki7bx5yg.cloudfront.net/wp-content/uploads/2011/06/cloudnumberscom-security.whitepaper.pdf


This is only a selection of our top features. To get more information
check out our web-page (http://www.cloudnumbers.com/) or follow our blog
about cloud computing, HPC and HPC applications (with R):
http://cloudnumbers.com/blog

Register and test for free now at cloudnumbers.com:
http://my.cloudnumbers.com/register

We are looking forward to get your feedback and consumer insights.

Best
Markus

-- 
Dr. rer. nat. Markus Schmidberger 
Senior Community Manager 

Cloudnumbers.com GmbH
Chausseestra?e 6
10119 Berlin 

www.cloudnumbers.com 
E-Mail: markus.schmidberger at cloudnumbers.com 


************************* 
Amtsgericht M?nchen, HRB 191138 
Gesch?ftsf?hrer: Erik Muttersbach, Markus Fensterer, Moritz v. 
Petersdorff-Campen 



Diese Nachricht kann vertrauliche Informationen enthalten. Sollten Sie 
nicht der vorgesehene Empf?nger sein, so bitten wir um eine kurze 
Nachricht. Jede unbefugte Weiterleitung oder Fertigung einer Kopie ist 
unzul?ssig. Da wir nicht die Echtheit oder  Vollst?ndigkeit der in 
dieser Nachricht enthaltenen Informationen garantieren k?nnen, 
schlie?en wir die rechtliche Verbindlichkeit der vorstehenden 
Erkl?rungen und ?u?erungen aus. 
This message may contain confidential information. If yo...{{dropped:6}}


From yichingtree at gmail.com  Fri Jul  8 07:41:59 2011
From: yichingtree at gmail.com (Yiching Lin)
Date: Fri, 8 Jul 2011 13:41:59 +0800
Subject: [R-sig-Geo] GLS model
Message-ID: <CAAaJSCAzOEU+G_dr4470yTpJmNaxCAuRSom2-LP9+6pTgn11Jw@mail.gmail.com>

Dear all,

I have been using the GLS model provided by nlme package in R.  I was
wondering if it is possible to estimate an equivalent of R square for
GLS in any R package.  Nlme package did not provide such estimations.
The only application that I found is Spatial Modeling Environment
(SME).   Thank you very much!

Best,
Yiching


************************************
Yiching Lin, Ph.D.
Assistant Professor

Department of Life Science
Tunghai University
No. 181, Sec. 3
Taichung Port Rd., Taichung 40704, Taiwan
Phone: +886-4-2590121 ext. 32406
Fax: +886-4-23590296


From johan.vandewauw at gmail.com  Fri Jul  8 09:33:53 2011
From: johan.vandewauw at gmail.com (Johan Van de Wauw)
Date: Fri, 8 Jul 2011 09:33:53 +0200
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
References: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>
	<CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
Message-ID: <CAJOp35=1haV6PpmE6ys00zy7fEcXaCSeYQNxCbapdJ93QXZYNg@mail.gmail.com>

Apart from grass gis, you can also do this in saga gis, or run this
through RSAGA. Since it seems you have to do this only once, it would
be much easier to just use the GUI.

1) Open your shapefile
2) run the module grid\shapes to grid (choose a reasonable cell size)
3) run the module grid\close gaps (you now have a altitude grid)
4) run the module terrain analysis\morphometry\slope,aspect... (you
now have a slope grid)
5) you could now overlay your points, or do that in R.

http://www.saga-gis.org


Johan

On Thu, Jul 7, 2011 at 6:25 PM, Sarah Papworth
<sarah.papworth06 at imperial.ac.uk> wrote:
> Dear all,
>
> I have a jpg map of altitudinal contours in my study area which I
> would like to map and use in R to calculate the altitude and slope of
> GPS coordinates.
> So far, I have painstakingly traced these contours in ArcMap to create
> a shapefile (of polylines) with altitude. I have now imported this
> file shapefile into R.
>
> ?What I would like to do is turn it into a raster of slope and
> altitude, but I can't seem to find any method of doing this in the
> online R help archives. Does anyone have any idea which package I
> should be using, or perhaps if it is even possible to turn this type
> of shapefile into a raster?
>
> Thanks in advance!
>
> Sarah
>
>
> --
> Imperial College London
> http://www.iccs.org.uk/sarahpapworth.htm
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From juliane_struve at yahoo.co.uk  Fri Jul  8 10:58:56 2011
From: juliane_struve at yahoo.co.uk (Juliane Struve)
Date: Fri, 8 Jul 2011 09:58:56 +0100
Subject: [R-sig-Geo] creating a raster  using import.asc() nd raster()
Message-ID: <1310115536.10337.YahooMailNeo@web29517.mail.ird.yahoo.com>

Dear list,
?
I am converting an .asc object into a raster object in order to use functions from the raster package. I then use the converted file to populate an array called FishModel for the purpose of modeling. In the process the columns and rows seem to be confused a some point so that the image of FishModel has the x and y axis reversed. Would someone be able to tell to suggest where this error may arise or shed light on how the ncols and nrows information in the original file is processed by the functions that I am using? 
?
Thank you very much in advance,
?
Juliane 
?
The file bathymetry.asc that I am reading in has the following information: 
ncols???????? 864
nrows???????? 603
xllcorner???? 299380.196348
yllcorner???? 2995287.191448
cellsize????? 100
NODATA_value? -9999
?
My code:
?
import.asc("bathymetry.asc")
dim(bathymetry)
[1] 864 603
raster(bathymetry)
dim(bathymetry)
[1] 603 864?? 1
nrows <- dim(bathymetry)[1]
ncols <- dim(bathymetry)[2]
FishModel <- array(dim=c(nrows,ncols,2))
FishModel[,,1] <- as.matrix(bathymetry)
image(FishModel[,,1])
#in the resulting image x and y axes seem to be reversed


From Roger.Bivand at nhh.no  Fri Jul  8 11:32:02 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 8 Jul 2011 11:32:02 +0200 (CEST)
Subject: [R-sig-Geo] plotting latlon axes of sp object of different
 projection
In-Reply-To: <CAAzZ5K9+vrnCPw2eD+tXLN+jPSem1jFZC=cM6+UYbJ4jUw2VwQ@mail.gmail.com>
References: <CAAzZ5K_VcMa+0KRXDKZazpShtGN2nTuU+KEjfF+FOjR4-MbUSA@mail.gmail.com>
	<alpine.LRH.2.00.1107051300140.1850@reclus.nhh.no>
	<CAAzZ5K9+vrnCPw2eD+tXLN+jPSem1jFZC=cM6+UYbJ4jUw2VwQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107081118530.14955@reclus.nhh.no>

On Tue, 5 Jul 2011, Horacio Samaniego wrote:

> Thanks a lot Roger,
>
> This is a good recipe, I'ld never have figured by my own!
>
> To fine tune this, I need to place the labels on the other sides
> (north, east) of the graph. Modifying the pos column of the  grdat
> object (output of gridat()) does not do the trick. I imagine that any
> modification should happen in the coordinates of that object.
>
> So I wonder if that is achievable earlier in the process.
>
> Any helpfull thought on doing that? It would be much appreciate.

I've added an additional argument to gridat(), and committed to SVN on the 
R-forge rspatial project, module sp. Both the coordinates and the pos need 
to be changed, pos to 3 for 1 and 4 for 2. The coordinates are more 
difficult, because they must be offset by the lengths of the grid lines 
before projection. If you can install from source, please try out the 
R-forge code, otherwise wait for a new release, or try to work things out 
from for example:

sapply(slot(slot(grd, "lines")[[1]], "Lines"), LineLength)
sapply(slot(slot(grd, "lines")[[2]], "Lines"), LineLength)

and work out how to shift the coordinates, before spTransform() to 
projected coordinates.

Hope this helps,

Roger

PS. Edzer has added a function to the next rgdal release to help in 
overplotting long-lat grids.


>
> thanks!
>
> H
>
> On Tue, Jul 5, 2011 at 5:20 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Mon, 4 Jul 2011, Horacio Samaniego wrote:
>>
>>> I need to add a lat/lon axes to an equal area plot of a
>>> SpatialLinesDataFrame object currently in units of meters. Is that
>>> achievable using sp/maptools?
>>>
>>> The .prj file where the object comes from is:
>>> PROJCS["Lambert_Azimuthal_Equal_Area",GEOGCS["GCS_unnamed
>>>
>>> ellipse",DATUM["D_unknown",SPHEROID["Unknown",6370997,0]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]],PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["latitude_of_origin",45],PARAMETER["central_meridian",-100],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["Meter",1]]
>>>
>>> I'ld hate to install arcinfo to generate 1 plot! (plus the plot is
>>> already nice as it is!!! just need the axes!)
>>
>> No, the axes are in the same coordinate system as the plot, and would be
>> curves here. You can overplot a long-lat grid on a projected plot:
>>
>> library(sp)
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> proj4string(meuse) <- CRS("+init=epsg:28992")
>> plot(meuse)
>> library(rgdal)
>> meuse_ll <- spTransform(meuse, CRS("+proj=longlat +datum=WGS84"))
>> grd <- gridlines(meuse_ll)
>> grd_x <- spTransform(grd, CRS("+init=epsg:28992"))
>> plot(grd_x, add=TRUE, lty=2)
>> grdat_ll <- gridat(meuse_ll)
>> grdat_x <- spTransform(grdat_ll, CRS("+init=epsg:28992"))
>> text(coordinates(grdat_x), labels=parse(text=grdat_x$labels),
>> ?pos=grdat_x$pos, offset=grdat_x$offset)
>>
>> Hope this helps,
>>
>> Roger
>>
>>>
>>> thanks,
>>> I'll summarize!
>>>
>>> H
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From a.mosnier at gmail.com  Fri Jul  8 13:21:39 2011
From: a.mosnier at gmail.com (Arnaud Mosnier)
Date: Fri, 8 Jul 2011 07:21:39 -0400
Subject: [R-sig-Geo] GLS model
Message-ID: <CANkFkEfT41tEApynLbHHf7p5hH_w3ycGNBEcdZTS+8pnKiq5jQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110708/8f900b58/attachment.pl>

From edzer.pebesma at uni-muenster.de  Fri Jul  8 14:31:54 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 08 Jul 2011 14:31:54 +0200
Subject: [R-sig-Geo] GLS model
In-Reply-To: <CANkFkEfT41tEApynLbHHf7p5hH_w3ycGNBEcdZTS+8pnKiq5jQ@mail.gmail.com>
References: <CANkFkEfT41tEApynLbHHf7p5hH_w3ycGNBEcdZTS+8pnKiq5jQ@mail.gmail.com>
Message-ID: <4E16F8BA.2080807@uni-muenster.de>

Something to consider might be that under a mixed model, there are
essentially two types of residuals: those wrt the fixed effects, and
those wrt the fixed+random effects. You can define an R2 for each of
them. For instance,

> library(nlme)
> example(predict.lme)

yields both types of predictions.

On 07/08/2011 01:21 PM, Arnaud Mosnier wrote:
> Dear Yiching,
> 
> For now, I just use the square of the correlation between the observed
> and predicted
> values??????. But if someone has another solution, I am also very interested in
> suggestions!
> 
> Arnaud
> 
> 	[[alternative HTML version deleted]]
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Fri Jul  8 15:26:20 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 8 Jul 2011 06:26:20 -0700 (PDT)
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
Message-ID: <1310131580536-6562497.post@n2.nabble.com>

> I have a jpg map of altitudinal contours in my study area which I 
> would like to map and use in R to calculate the altitude and slope of 
> GPS coordinates. 


Estimating elevation from contours is not as common as it used to be because
of the availability of near-global high resolution raster elevation data.
What kind of spatial resolution are you after; and are you aware of the
SRTM90/30 and ASTER30 data? 

Here are some examples using techniques that Barry alluded to.


library(raster)
library(maptools)

# setting up some data:
# contour lines for volcano
cl <- ContourLines2SLDF(contourLines(volcano))
# level should be numeric
cl at data$level <- as.numeric(as.character(cl at data$level))

# RasterLayer for volcano
r <- flip(t(raster(volcano)), 'y')
plot(r)
plot(cl, add=T)


# I would like to interpolate from points, by sampling from the lines, e.g.
p <- spsample(cl, 1000, 'regular')
plot(p)

# However, as Barry mentioned spplot does not keep the attributes of the
sampled lines. 
# But in this example it seems reasonable to do:

p <- as(cl, 'SpatialPointsDataFrame')
spplot(p, 'level')

# now there are many ways to interpolate. See, e.g., the 'gstat' and
'automap' packages. See raster::interpolate for an example with splines.
# using gstat and inverse distrance weighted interpolation:

library(gstat)
g <- gstat(id="level", formula = level~1, data=p, nmax=7, set=list(idp =
.5))
x1 <- interpolate(r, g)

par(mfrow=c(1,2))
plot(x1)
plot(cl, add=T)
# compare values with original:
plot(x1, r)

# You _can_ also first rasterize the lines; which would be better if your
cells are very small relative to the inter-node distance of the lines
rr <- rasterize(cl, r, field='level', progress='window')
v <- data.frame(rasterToPoints(rr))
colnames(v)[3] = 'level'

g2 <- gstat(id="level", formula=level~1, locations=~x+y, data=v, nmax=7,
set=list(idp = .5))
x2 <- interpolate(r, g2)
par(mfrow=c(1,2))
plot(x2)
plot(cl, add=T)
plot(x2-r)
plot(cl, add=T)


# for slope and aspect
# RasterLayer must have a CRS. Making something up for this example:
projection(x1) <- "+proj=longlat +datum=WGS84"
slope <- slopeAspect(x1, out='slope')

gpspoints <- cbind(0.5, 0.5)
extract(slope, gpspoints)



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Mapping-contours-from-jpg-map-tp6558992p6562497.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul  8 15:57:56 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 8 Jul 2011 06:57:56 -0700 (PDT)
Subject: [R-sig-Geo] creating a raster  using import.asc() nd raster()
In-Reply-To: <1310115536.10337.YahooMailNeo@web29517.mail.ird.yahoo.com>
References: <1310115536.10337.YahooMailNeo@web29517.mail.ird.yahoo.com>
Message-ID: <1310133476036-6562582.post@n2.nabble.com>

> I am converting an .asc object into a raster object in order to use
functions from the raster package. I 
> then use the converted file to populate an array called FishModel for the
> purpose of modeling. In the 
> process the columns and rows seem to be confused 

Juliane, 

It is easier to answer questions if you send real code that can be
replicated. 

library(adehabitat)
library(raster)
file <-  paste(system.file(package = "adehabitat"),
"ascfiles/elevation.asc", sep = "/")

b <- import.asc(file) 
r <- raster(b) 
par(mfrow=c(1,2))
image(b)
image(r)
dim(b) 
dim(r) 

The plot shows essentially the same thing, but dims are reversed. This is
because the 'asc' object stores the transposed matrix and dim for these
objects returns (ncol, nrow). You can get a "normal" matrix of the values of
an 'asc' object like this:

d <- t(b[])
d <- d[nrow(d):1, ]

Hth, Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/creating-a-raster-using-import-asc-nd-raster-tp6561802p6562582.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Fri Jul  8 16:05:42 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 8 Jul 2011 15:05:42 +0100
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <1310131580536-6562497.post@n2.nabble.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
Message-ID: <CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>

On Fri, Jul 8, 2011 at 2:26 PM, Robert Hijmans <r.hijmans at gmail.com> wrote:



> # now there are many ways to interpolate. See, e.g., the 'gstat' and
> 'automap' packages. See raster::interpolate for an example with splines.
> # using gstat and inverse distrance weighted interpolation:
>
> library(gstat)
> g <- gstat(id="level", formula = level~1, data=p, nmax=7, set=list(idp =
> .5))
> x1 <- interpolate(r, g)

Statistical interpolation techniques may be right for this, but
thinking about it last night made me realise that contours are more
than just linear estimates of height at location. There's the
implication that between any two contour lines of height H1 and H2
there are no locations with height outside the bounds of (H1,H2).
Otherwise there would be a contour line there.

 And this may not be so uncommon in elevation models. Consider a steep
sided valley with a wide flood plain. You have close contours on
either side with a big gap between. Would a "statistical"
interpolation run down the valley side and plummet on down, then back
up the other side, turning the flood plain into a deep rounded valley
bottom? Sure it all depends on the parameters of the smoothing, but a
method that knew it was dealing with contours would constrain the
surface such that points between contour lines were always between the
contour line values.

 I think at least one of the algorithms in GRASS-GIS does this by
"drawing" the contour lines on the raster and then doing a 'flood
fill' operation between them.

 I'll have to dig out some GIS books...

Barry


From r.hijmans at gmail.com  Fri Jul  8 16:24:15 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 8 Jul 2011 07:24:15 -0700
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
Message-ID: <CANtt_hziVnguOpCS71gyPZ9qo5+dufaa+4W2h0ynMHKCzt_i4g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110708/980401dc/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Fri Jul  8 16:34:16 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 8 Jul 2011 15:34:16 +0100
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CANtt_hziVnguOpCS71gyPZ9qo5+dufaa+4W2h0ynMHKCzt_i4g@mail.gmail.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
	<CANtt_hziVnguOpCS71gyPZ9qo5+dufaa+4W2h0ynMHKCzt_i4g@mail.gmail.com>
Message-ID: <CANVKczO8cdkzSJc0WnbLoP3L6j2YoG88BMajaNo3jOyAbh3mHQ@mail.gmail.com>

On Fri, Jul 8, 2011 at 3:24 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
> For those places (valley bottoms, mountain tops), a spline interpolation do
> better ((and even better when using stream information like in Hutchinson's
> algorithm that was (is?) implemented in Arc/INFO.))

Sadly it seems that Hutchinson and ANU do not subscribe to the open
source philosophy:

http://fennerschool.anu.edu.au/publications/software/orderform-int.php

 and if he even only gets a cent on every Arc/Info license containing
ANUDEM he's probably not doing too badly...

Barry


From Roger.Bivand at nhh.no  Fri Jul  8 17:09:57 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 8 Jul 2011 17:09:57 +0200 (CEST)
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>

On Fri, 8 Jul 2011, Barry Rowlingson wrote:

> On Fri, Jul 8, 2011 at 2:26 PM, Robert Hijmans <r.hijmans at gmail.com> wrote:
>
>
>
>> # now there are many ways to interpolate. See, e.g., the 'gstat' and
>> 'automap' packages. See raster::interpolate for an example with splines.
>> # using gstat and inverse distrance weighted interpolation:
>>
>> library(gstat)
>> g <- gstat(id="level", formula = level~1, data=p, nmax=7, set=list(idp =
>> .5))
>> x1 <- interpolate(r, g)
>
> Statistical interpolation techniques may be right for this, but
> thinking about it last night made me realise that contours are more
> than just linear estimates of height at location. There's the
> implication that between any two contour lines of height H1 and H2
> there are no locations with height outside the bounds of (H1,H2).
> Otherwise there would be a contour line there.
>
> And this may not be so uncommon in elevation models. Consider a steep
> sided valley with a wide flood plain. You have close contours on
> either side with a big gap between. Would a "statistical"
> interpolation run down the valley side and plummet on down, then back
> up the other side, turning the flood plain into a deep rounded valley
> bottom? Sure it all depends on the parameters of the smoothing, but a
> method that knew it was dealing with contours would constrain the
> surface such that points between contour lines were always between the
> contour line values.
>
> I think at least one of the algorithms in GRASS-GIS does this by
> "drawing" the contour lines on the raster and then doing a 'flood
> fill' operation between them.
>
> I'll have to dig out some GIS books...

r.surf.contour in GRASS does what is required:

http://grass.osgeo.org/grass64/manuals/html64_user/r.surf.contour.html

gives its description; the input is a raster of the contours where the 
non-missing cells take the contour elevation values. I have found that 
spline interpolation can create artefacts, and geostatistical 
interpolation (or IDW for obvious reasons) does not like many neighbouring 
data points along a contour line.

Roger

>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Jose.Iparraguirre at ageuk.org.uk  Fri Jul  8 17:09:47 2011
From: Jose.Iparraguirre at ageuk.org.uk (Jose Iparraguirre)
Date: Fri, 8 Jul 2011 16:09:47 +0100
Subject: [R-sig-Geo] Add text INSIDE spplot map
Message-ID: <E0807BF04F0D0C419BF2B39803E985822DCEFEF83A@AGEPXCH002C.uk.age.local>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110708/adbbe1cb/attachment.pl>

From r.hijmans at gmail.com  Fri Jul  8 19:17:26 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 8 Jul 2011 10:17:26 -0700
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
	<alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>
Message-ID: <CANtt_hxSSM9pEXKfpTkzZ5admqnsaECA1tM7n88vzk7WbXt2_Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110708/0756d12e/attachment.pl>

From david.holstius at berkeley.edu  Fri Jul  8 20:18:34 2011
From: david.holstius at berkeley.edu (David Holstius)
Date: Fri, 8 Jul 2011 11:18:34 -0700
Subject: [R-sig-Geo] coercing SpatialGrid to SpatialPoints
Message-ID: <870C8128-001D-4579-87D4-95BE6907CE79@berkeley.edu>

Hi all, 

I'm trying to figure out why coercing a SpatialGrid directly to a SpatialPoints doesn't result in the same thing as coercing it via an intermediate SpatialPixels. Here's a minimal example:

  require(sp)
  grd <- SpatialGrid(GridTopology(c(0,0), c(10,10), c(4,4)))
  as(as(grd, "SpatialPixels"), "SpatialPoints")	# result == what I expect
  as(grd, "SpatialPoints")	# result != expected

Is this behavior as expected? Maybe I am doing it wrong?

Many thanks,
David

--
David Holstius
PhD Student in Environmental Health Sciences
UC Berkeley School of Public Health


From eboyd3 at tigers.lsu.edu  Fri Jul  8 21:04:47 2011
From: eboyd3 at tigers.lsu.edu (Ezra Boyd)
Date: Fri, 8 Jul 2011 14:04:47 -0500
Subject: [R-sig-Geo] Converting a line feature to evenly spaced points
Message-ID: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>

Hi Everyone,

I have a line feature that represents a road/trail along with a set of
GPS points taken along the trail. ?What I need to do is calculate the
distance along the pathway from the trailhead to each GPS point. ?The
best way that I can think of to accomplish this is to convert the line
feature to evenly spaced points (preferably 1 meter or 1 foot apart.)
However, all of the line-to-point conversion tools that I have found
simply create the points based on the nodes of the line feature. ?But, this
won't help me because I know that the nodes are not evenly spaced.
Does anyone know of a line-to-point conversion tool that creates
evenly spaced points? ?Otherwise, does anyone have other ideas of how
I can accomplish what I need to accomplish?

Thanks,
Ezra


From jeremy.raw at dot.gov  Fri Jul  8 21:14:50 2011
From: jeremy.raw at dot.gov (jeremy.raw at dot.gov)
Date: Fri, 8 Jul 2011 15:14:50 -0400
Subject: [R-sig-Geo] Converting a line feature to evenly spaced points
In-Reply-To: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>
References: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>
Message-ID: <B3C9A56C0E6FBF48A7D3ED79E9A7A9C004D5F7CA@OSTMAIL03VS3.ad.dot.gov>

I'd suggest looking at the raster and gdistance packages.

Jeremy Raw, P.E.
FHWA Office of Planning
jeremy.raw at dot.gov
(202) 366-0986


-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Ezra Boyd
Sent: Friday, July 08, 2011 3:05 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] Converting a line feature to evenly spaced points

Hi Everyone,

I have a line feature that represents a road/trail along with a set of
GPS points taken along the trail. ?What I need to do is calculate the
distance along the pathway from the trailhead to each GPS point. ?The
best way that I can think of to accomplish this is to convert the line
feature to evenly spaced points (preferably 1 meter or 1 foot apart.)
However, all of the line-to-point conversion tools that I have found
simply create the points based on the nodes of the line feature. ?But, this
won't help me because I know that the nodes are not evenly spaced.
Does anyone know of a line-to-point conversion tool that creates
evenly spaced points? ?Otherwise, does anyone have other ideas of how
I can accomplish what I need to accomplish?

Thanks,
Ezra

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Fri Jul  8 21:18:57 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 8 Jul 2011 20:18:57 +0100
Subject: [R-sig-Geo] Converting a line feature to evenly spaced points
In-Reply-To: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>
References: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>
Message-ID: <CANVKczP8U_13F88N6Us1xjHWtBrcDNeauincZkjnObx+e3eYXA@mail.gmail.com>

On Fri, Jul 8, 2011 at 8:04 PM, Ezra Boyd <eboyd3 at tigers.lsu.edu> wrote:
> Hi Everyone,
>
> I have a line feature that represents a road/trail along with a set of
> GPS points taken along the trail. ?What I need to do is calculate the
> distance along the pathway from the trailhead to each GPS point. ?The
> best way that I can think of to accomplish this is to convert the line
> feature to evenly spaced points (preferably 1 meter or 1 foot apart.)
> However, all of the line-to-point conversion tools that I have found
> simply create the points based on the nodes of the line feature. ?But, this
> won't help me because I know that the nodes are not evenly spaced.
> Does anyone know of a line-to-point conversion tool that creates
> evenly spaced points? ?Otherwise, does anyone have other ideas of how
> I can accomplish what I need to accomplish?

 spsample(sl, 10, "regular")

 will, if sl is SpatialLine*, produce 10 equally distanced points
along the line - not necessarily at the nodes.

 However, you cant control how far apart they are. You do know the total length:

 SpatialLinesLengths(sl)

 so can get something approximate with a bit of clever division.

 Possibly delving into the internals of spsample methods will point
the way to making it do exactly what you want...

Barry


From b.rowlingson at lancaster.ac.uk  Fri Jul  8 21:37:55 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 8 Jul 2011 20:37:55 +0100
Subject: [R-sig-Geo] Converting a line feature to evenly spaced points
In-Reply-To: <CANVKczP8U_13F88N6Us1xjHWtBrcDNeauincZkjnObx+e3eYXA@mail.gmail.com>
References: <CAPo57m-Y-W4hdwKEnJ5PwhrmdvdNtQsCE5GFD62oD3yYgWypPw@mail.gmail.com>
	<CANVKczP8U_13F88N6Us1xjHWtBrcDNeauincZkjnObx+e3eYXA@mail.gmail.com>
Message-ID: <CANVKczNysLXDv9K-PF9MvVqve8YdiwruNRFPO4SD8CxfPBmJAw@mail.gmail.com>

So I delved a bit. Second day in a row I've been messing with the guts
of sample.Line:

#' sample every distance interval along a line
#'
#' @param cc a two-column matrix of x and y coords for the line
#' @param dist distance separating sample points
#'
#' @return points along the line, separated by the given distance
measured along the line
#'
sampleEvery <- function (cc, dist){
    lengths = LineLength(cc, longlat = FALSE, sum = FALSE)
    if (any(abs(lengths) < .Machine$double.eps)) {
        wl <- which(abs(lengths) < .Machine$double.eps)
        cc <- cc[-(wl), ]
        lengths <- lengths[-(wl)]
    }
    csl = c(0, cumsum(lengths))
    maxl = csl[length(csl)]
    pts = seq(0,sum(lengths),by=dist)
    int = findInterval(pts, csl, all.inside = TRUE)
    where = (pts - csl[int])/diff(csl)[int]
    xy = cc[int, , drop = FALSE] + where * (cc[int + 1, , drop = FALSE] -
        cc[int, , drop = FALSE])
    if (nrow(xy) < 1)
        return(NULL)
    return(xy)
}

Original by Roger and Edzer, no doubt.

Barry


From hengl at spatial-analyst.net  Sat Jul  9 10:23:22 2011
From: hengl at spatial-analyst.net (Tomislav Hengl)
Date: Sat, 09 Jul 2011 10:23:22 +0200
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CAJOp35=1haV6PpmE6ys00zy7fEcXaCSeYQNxCbapdJ93QXZYNg@mail.gmail.com>
References: <CAF3P+nanj2un4235=wcYAunfYxcqK0BShaLAxudAMoGe5RzVNw@mail.gmail.com>	<CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CAJOp35=1haV6PpmE6ys00zy7fEcXaCSeYQNxCbapdJ93QXZYNg@mail.gmail.com>
Message-ID: <4E180FFA.20801@spatial-analyst.net>

On 7/8/2011 9:33 AM, Johan Van de Wauw wrote:
> Apart from grass gis, you can also do this in saga gis, or run this
> through RSAGA. Since it seems you have to do this only once, it would
> be much easier to just use the GUI.
>
> 1) Open your shapefile
> 2) run the module grid\shapes to grid (choose a reasonable cell size)
> 3) run the module grid\close gaps (you now have a altitude grid)
> 4) run the module terrain analysis\morphometry\slope,aspect... (you
> now have a slope grid)
> 5) you could now overlay your points, or do that in R.

Or if you prefer coding ;)

 > rm(volcano)
 > volcano <- ContourLines2SLDF(contourLines(volcano))
 > volcano$altitude <- as.numeric(as.character(volcano$level))
 > writeLinesShape(volcano, "volcano.shp")

 > rsaga.get.usage(lib="grid_gridding", module=0)
# SAGA 2.0.7
library name:   grid_gridding
module name :   Shapes to Grid
# interpolate lines to rasters:
 > rsaga.geoprocessor(lib="grid_gridding", module=0, 
param=list(GRID="DEM.sgrd", INPUT="volcano.shp", FIELD=0, LINE_TYPE=0, 
USER_SIZE=10))
# close gaps with splines:
 > rsaga.geoprocessor(lib="grid_tools", module=7, 
param=list(INPUT="DEM.sgrd", RESULT="DEM.sgrd")) # write to the same file


for more examples see also

http://spatial-analyst.net/book/Geomorphmapping

http://geomorphometry.org/content/uncertainty-stream-networks-derived-elevation-data


T. Hengl
http://www.wewur.wur.nl/popups/vcard.aspx?id=HENGL001


>
> http://www.saga-gis.org
>
>
> Johan
>
> On Thu, Jul 7, 2011 at 6:25 PM, Sarah Papworth
> <sarah.papworth06 at imperial.ac.uk>  wrote:
>> Dear all,
>>
>> I have a jpg map of altitudinal contours in my study area which I
>> would like to map and use in R to calculate the altitude and slope of
>> GPS coordinates.
>> So far, I have painstakingly traced these contours in ArcMap to create
>> a shapefile (of polylines) with altitude. I have now imported this
>> file shapefile into R.
>>
>>   What I would like to do is turn it into a raster of slope and
>> altitude, but I can't seem to find any method of doing this in the
>> online R help archives. Does anyone have any idea which package I
>> should be using, or perhaps if it is even possible to turn this type
>> of shapefile into a raster?
>>
>> Thanks in advance!
>>
>> Sarah
>>
>>
>> --
>> Imperial College London
>> http://www.iccs.org.uk/sarahpapworth.htm
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From Jose.Iparraguirre at ageuk.org.uk  Mon Jul 11 14:32:46 2011
From: Jose.Iparraguirre at ageuk.org.uk (Jose Iparraguirre)
Date: Mon, 11 Jul 2011 13:32:46 +0100
Subject: [R-sig-Geo] Add text INSIDE spplot map
In-Reply-To: <4E1A9F53.7080507@tum.de>
References: <E0807BF04F0D0C419BF2B39803E985822DCEFEF83A@AGEPXCH002C.uk.age.local>
	<4E1A9F53.7080507@tum.de>
Message-ID: <E0807BF04F0D0C419BF2B39803E985822DCFE415DF@AGEPXCH002C.uk.age.local>

Thanks Tom,

Here's an example using the usual dataset, meuse.

> data(meuse)
> coordinates(meuse) = ~x+y
> l1 = list("sp.text", c(179050, 330877),"Hola",col="red",font=2)
> spplot(meuse, c("ffreq"), sp.layout=list(l1), col.regions= "black", 
+ pch=c(19), key.space=list(x=0.1,y=.95,corner=c(0,1)))

Here, "Hola" is printed 'within the cloud', and it's not very legible -imagine thousands of additional points. I forgot to mention that I'd experimented with first=F/T, and the only change is that with first=TRUE, of course, the text 'Hola' is not printed. 
So, let me change the request of advice slightly: can I put such a text in such coordinates within a box, filling the box with a different colour, so that the text becomes more visible? (neither 'fill' nor 'bty' seem to work as elements of the list...).

Thanks in advance, and regards to everyone!

Jos?



Jos? Iparraguirre
Chief Economist
Age UK

T 020 303 31482
E Jose.Iparraguirre at ageuk.org.uk

Tavis House, 1- 6 Tavistock Square
London, WC1H 9NB
www.ageuk.org.uk?| ageukblog.org.uk | @AgeUKPA




-----Original Message-----
From: Tom Gottfried [mailto:tom.gottfried at tum.de] 
Sent: 11 July 2011 08:00
To: Jose Iparraguirre
Subject: Re: [R-sig-Geo] Add text INSIDE spplot map

Hi,

first guess: did you try to add 'first=FALSE' to sp.layout (see ?spplot)?

Am 08.07.2011 17:09, schrieb Jose Iparraguirre:
> Hi,
>
> Sorry if I'm not accompanying a piece of code, but the following question is general enough.
> I want to add some text markers/labels (say, the names of a couple of cities) within the figure plotted using spplot (in the sp library). I'm plotting spatial points.
> Using sp.layout I can add a text outside the points, but when I change the coordinates to place the text within the cloud of points, it seems to go 'behind' the points. Is there a way of bringing the text forward or 'superimpose' it on top of the points mapped with spplot?

For me it's not clear what means "outside the points" and "within the cloud of points". Maybe a 
reproducible example would clarify, though.

Tom

> Thanks,
>
> Jos?
>
> Jos? Iparraguirre
> Chief Economist
> Age UK
>
> T 020 303 31482
> E Jose.Iparraguirre at ageuk.org.uk<mailto:Jose.Iparraguirre at ageuk.org.uk>
>
> Tavis House, 1- 6 Tavistock Square
> London, WC1H 9NB
> www.ageuk.org.uk<http://www.ageuk.org.uk>  | ageukblog.org.uk<http://ageukblog.org.uk/>  | @AgeUKPA<http://twitter.com/ageukpa>
>
>
>
>
>
>
>
>
> Age UK  Improving later life
>
>
>
> www.ageuk.org.uk
>
>
>
>
>
> -------------------------------
>
>
>
> Age UK is a registered charity and company limited by guarantee, (registered charity number 1128267, registered company number 6825798)
>
>
>
> Registered office:207-221 Pentonville Road, London N1 9UZ
>
>
>
> ------------------------------
>
>
>
> This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you receive a message in error, please advise the sender and delete immediately.
>
>
>
> Except where this email is sent in the usual course of our business, any opinions expressed in this email are those of the author and do not necessarily reflect the opinions of Age UK or its subsidiaries and associated companies. Age UK monitors all e-mail transmissions passing through its network and may block or modify mails which are deemed to be unsuitable.
>
>
>
> Age Concern England (charity number 261794) and Help the Aged (charity number 272786) and their trading and other associated companies merged on 1st April 2009 to form Age UK, a single charity dedicated to improving the lives of  people in later life . The three national Age Concerns in Scotland, Northern Ireland and Wales have also merged with Help the Aged in these nations to form three registered charities: Age Scotland, Age NI, Age Cymru.
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> 	[[alternative HTML version deleted]]
>
>
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


Age UK  Improving later life

www.ageuk.org.uk  


-------------------------------

Age UK is a registered charity and company limited by guarantee, (registered charity number 1128267, registered company number 6825798)

Registered office:207-221 Pentonville Road, London N1 9UZ

------------------------------

This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you receive a message in error, please advise the sender and delete immediately.

Except where this email is sent in the usual course of our business, any opinions expressed in this email are those of the author and do not necessarily reflect the opinions of Age UK or its subsidiaries and associated companies. Age UK monitors all e-mail transmissions passing through its network and may block or modify mails which are deemed to be unsuitable. 

Age Concern England (charity number 261794) and Help the Aged (charity number 272786) and their trading and other associated companies merged on 1st April 2009 to form Age UK, a single charity dedicated to improving the lives of  people in later life . The three national Age Concerns in Scotland, Northern Ireland and Wales have also merged with Help the Aged in these nations to form three registered charities: Age Scotland, Age NI, Age Cymru.


From tom.gottfried at tum.de  Mon Jul 11 15:09:20 2011
From: tom.gottfried at tum.de (Tom Gottfried)
Date: Mon, 11 Jul 2011 15:09:20 +0200
Subject: [R-sig-Geo] Add text INSIDE spplot map
In-Reply-To: <E0807BF04F0D0C419BF2B39803E985822DCFE415DF@AGEPXCH002C.uk.age.local>
References: <E0807BF04F0D0C419BF2B39803E985822DCEFEF83A@AGEPXCH002C.uk.age.local>
	<4E1A9F53.7080507@tum.de>
	<E0807BF04F0D0C419BF2B39803E985822DCFE415DF@AGEPXCH002C.uk.age.local>
Message-ID: <4E1AF600.8000500@tum.de>

Hi again,

Am 11.07.2011 14:32, schrieb Jose Iparraguirre:
> Thanks Tom,
>
> Here's an example using the usual dataset, meuse.
>
>> data(meuse)
>> coordinates(meuse) = ~x+y
>> l1 = list("sp.text", c(179050, 330877),"Hola",col="red",font=2)

Explicitly giving first=FALSE in this line

l1 = list("sp.text", c(179050, 330877),"Hola",col="red",font=2, first=FALSE)

does not help. I think this is not the documented behaviour, as the layout item seems to be drawn 
before the main spplot object, which corresponds to first=TRUE. I'm sure Edzer Pebesma can clarify this.

Regards!
Tom

>> spplot(meuse, c("ffreq"), sp.layout=list(l1), col.regions= "black",
> + pch=c(19), key.space=list(x=0.1,y=.95,corner=c(0,1)))
>
> Here, "Hola" is printed 'within the cloud', and it's not very legible -imagine thousands of additional points. I forgot to mention that I'd experimented with first=F/T, and the only change is that with first=TRUE, of course, the text 'Hola' is not printed.
> So, let me change the request of advice slightly: can I put such a text in such coordinates within a box, filling the box with a different colour, so that the text becomes more visible? (neither 'fill' nor 'bty' seem to work as elements of the list...).
>
> Thanks in advance, and regards to everyone!
>
> Jos?
>
>
>
> Jos? Iparraguirre
> Chief Economist
> Age UK
>
> T 020 303 31482
> E Jose.Iparraguirre at ageuk.org.uk
>
> Tavis House, 1- 6 Tavistock Square
> London, WC1H 9NB
> www.ageuk.org.uk | ageukblog.org.uk | @AgeUKPA
>
>
>
>
> -----Original Message-----
> From: Tom Gottfried [mailto:tom.gottfried at tum.de]
> Sent: 11 July 2011 08:00
> To: Jose Iparraguirre
> Subject: Re: [R-sig-Geo] Add text INSIDE spplot map
>
> Hi,
>
> first guess: did you try to add 'first=FALSE' to sp.layout (see ?spplot)?
>
> Am 08.07.2011 17:09, schrieb Jose Iparraguirre:
>> Hi,
>>
>> Sorry if I'm not accompanying a piece of code, but the following question is general enough.
>> I want to add some text markers/labels (say, the names of a couple of cities) within the figure plotted using spplot (in the sp library). I'm plotting spatial points.
>> Using sp.layout I can add a text outside the points, but when I change the coordinates to place the text within the cloud of points, it seems to go 'behind' the points. Is there a way of bringing the text forward or 'superimpose' it on top of the points mapped with spplot?
>
> For me it's not clear what means "outside the points" and "within the cloud of points". Maybe a
> reproducible example would clarify, though.
>
> Tom
>
>> Thanks,
>>
>> Jos?
>>
>> Jos? Iparraguirre
>> Chief Economist
>> Age UK
>>
>> T 020 303 31482
>> E Jose.Iparraguirre at ageuk.org.uk<mailto:Jose.Iparraguirre at ageuk.org.uk>
>>
>> Tavis House, 1- 6 Tavistock Square
>> London, WC1H 9NB
>> www.ageuk.org.uk<http://www.ageuk.org.uk>   | ageukblog.org.uk<http://ageukblog.org.uk/>   | @AgeUKPA<http://twitter.com/ageukpa>
>>
>>
>>
>>
>>
>>
>>
>>
>> Age UK  Improving later life
>>
>>
>>
>> www.ageuk.org.uk
>>
>>
>>
>>
>>
>> -------------------------------
>>
>>
>>
>> Age UK is a registered charity and company limited by guarantee, (registered charity number 1128267, registered company number 6825798)
>>
>>
>>
>> Registered office:207-221 Pentonville Road, London N1 9UZ
>>
>>
>>
>> ------------------------------
>>
>>
>>
>> This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you receive a message in error, please advise the sender and delete immediately.
>>
>>
>>
>> Except where this email is sent in the usual course of our business, any opinions expressed in this email are those of the author and do not necessarily reflect the opinions of Age UK or its subsidiaries and associated companies. Age UK monitors all e-mail transmissions passing through its network and may block or modify mails which are deemed to be unsuitable.
>>
>>
>>
>> Age Concern England (charity number 261794) and Help the Aged (charity number 272786) and their trading and other associated companies merged on 1st April 2009 to form Age UK, a single charity dedicated to improving the lives of  people in later life . The three national Age Concerns in Scotland, Northern Ireland and Wales have also merged with Help the Aged in these nations to form three registered charities: Age Scotland, Age NI, Age Cymru.
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


From edzer.pebesma at uni-muenster.de  Mon Jul 11 15:13:46 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 11 Jul 2011 15:13:46 +0200
Subject: [R-sig-Geo] Add text INSIDE spplot map
In-Reply-To: <E0807BF04F0D0C419BF2B39803E985822DCFE415DF@AGEPXCH002C.uk.age.local>
References: <E0807BF04F0D0C419BF2B39803E985822DCEFEF83A@AGEPXCH002C.uk.age.local>	<4E1A9F53.7080507@tum.de>
	<E0807BF04F0D0C419BF2B39803E985822DCFE415DF@AGEPXCH002C.uk.age.local>
Message-ID: <4E1AF70A.6060405@uni-muenster.de>

Yes, you can, but it might not be trivial.

In particular, you will have to dive into how this is done with the
routines in package grid. The book "R graphics" and the accompanying web
site, http://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html
contain many examples.

See e.g. sp::mapLegendGrob for a function in sp that uses some functions
in package grid directly.

Hth,

On 07/11/2011 02:32 PM, Jose Iparraguirre wrote:
> Thanks Tom,
> 
> Here's an example using the usual dataset, meuse.
> 
>> data(meuse)
>> coordinates(meuse) = ~x+y
>> l1 = list("sp.text", c(179050, 330877),"Hola",col="red",font=2)
>> spplot(meuse, c("ffreq"), sp.layout=list(l1), col.regions= "black", 
> + pch=c(19), key.space=list(x=0.1,y=.95,corner=c(0,1)))
> 
> Here, "Hola" is printed 'within the cloud', and it's not very legible -imagine thousands of additional points. I forgot to mention that I'd experimented with first=F/T, and the only change is that with first=TRUE, of course, the text 'Hola' is not printed. 
> So, let me change the request of advice slightly: can I put such a text in such coordinates within a box, filling the box with a different colour, so that the text becomes more visible? (neither 'fill' nor 'bty' seem to work as elements of the list...).
> 
> Thanks in advance, and regards to everyone!
> 
> Jos?
> 
> 
> 
> Jos? Iparraguirre
> Chief Economist
> Age UK
> 
> T 020 303 31482
> E Jose.Iparraguirre at ageuk.org.uk
> 
> Tavis House, 1- 6 Tavistock Square
> London, WC1H 9NB
> www.ageuk.org.uk | ageukblog.org.uk | @AgeUKPA
> 
> 
> 
> 
> -----Original Message-----
> From: Tom Gottfried [mailto:tom.gottfried at tum.de] 
> Sent: 11 July 2011 08:00
> To: Jose Iparraguirre
> Subject: Re: [R-sig-Geo] Add text INSIDE spplot map
> 
> Hi,
> 
> first guess: did you try to add 'first=FALSE' to sp.layout (see ?spplot)?
> 
> Am 08.07.2011 17:09, schrieb Jose Iparraguirre:
>> Hi,
>>
>> Sorry if I'm not accompanying a piece of code, but the following question is general enough.
>> I want to add some text markers/labels (say, the names of a couple of cities) within the figure plotted using spplot (in the sp library). I'm plotting spatial points.
>> Using sp.layout I can add a text outside the points, but when I change the coordinates to place the text within the cloud of points, it seems to go 'behind' the points. Is there a way of bringing the text forward or 'superimpose' it on top of the points mapped with spplot?
> 
> For me it's not clear what means "outside the points" and "within the cloud of points". Maybe a 
> reproducible example would clarify, though.
> 
> Tom
> 
>> Thanks,
>>
>> Jos?
>>
>> Jos? Iparraguirre
>> Chief Economist
>> Age UK
>>
>> T 020 303 31482
>> E Jose.Iparraguirre at ageuk.org.uk<mailto:Jose.Iparraguirre at ageuk.org.uk>
>>
>> Tavis House, 1- 6 Tavistock Square
>> London, WC1H 9NB
>> www.ageuk.org.uk<http://www.ageuk.org.uk>  | ageukblog.org.uk<http://ageukblog.org.uk/>  | @AgeUKPA<http://twitter.com/ageukpa>
>>
>>
>>
>>
>>
>>
>>
>>
>> Age UK  Improving later life
>>
>>
>>
>> www.ageuk.org.uk
>>
>>
>>
>>
>>
>> -------------------------------
>>
>>
>>
>> Age UK is a registered charity and company limited by guarantee, (registered charity number 1128267, registered company number 6825798)
>>
>>
>>
>> Registered office:207-221 Pentonville Road, London N1 9UZ
>>
>>
>>
>> ------------------------------
>>
>>
>>
>> This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you receive a message in error, please advise the sender and delete immediately.
>>
>>
>>
>> Except where this email is sent in the usual course of our business, any opinions expressed in this email are those of the author and do not necessarily reflect the opinions of Age UK or its subsidiaries and associated companies. Age UK monitors all e-mail transmissions passing through its network and may block or modify mails which are deemed to be unsuitable.
>>
>>
>>
>> Age Concern England (charity number 261794) and Help the Aged (charity number 272786) and their trading and other associated companies merged on 1st April 2009 to form Age UK, a single charity dedicated to improving the lives of  people in later life . The three national Age Concerns in Scotland, Northern Ireland and Wales have also merged with Help the Aged in these nations to form three registered charities: Age Scotland, Age NI, Age Cymru.
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From vioravis at gmail.com  Mon Jul 11 15:48:05 2011
From: vioravis at gmail.com (vioravis)
Date: Mon, 11 Jul 2011 06:48:05 -0700 (PDT)
Subject: [R-sig-Geo] Kernel density based on a variable value
Message-ID: <1310392085054-6570975.post@n2.nabble.com>

I am superimposing a kernel density plot on the US map (as per the suggestion
given in this thread:
http://r-sig-geo.2731867.n2.nabble.com/Kernel-density-plot-on-a-US-map-td6196265.html) 

I have the latitude and longitude of each location in US. I also have a
variable Z whose value dictates the density. However, currently it appears
that the density is based only on the number of nearby values and not on the
absolute value of each point. 

Is there any way to plot the density according to the value of a variable??

Thank you.

Ravi

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Kernel-density-based-on-a-variable-value-tp6570975p6570975.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From vioravis at gmail.com  Mon Jul 11 16:13:25 2011
From: vioravis at gmail.com (vioravis)
Date: Mon, 11 Jul 2011 07:13:25 -0700 (PDT)
Subject: [R-sig-Geo] Kernel density based on a variable value
In-Reply-To: <1310392085054-6570975.post@n2.nabble.com>
References: <1310392085054-6570975.post@n2.nabble.com>
Message-ID: <1310393605038-6571047.post@n2.nabble.com>

I am currently using:
density(pts)

Will the density be proportional to the value of Z if I use:

density(pts,weights = Z)

Please clarify.

Thank you.

Ravi 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Kernel-density-based-on-a-variable-value-tp6570975p6571047.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Mon Jul 11 18:43:20 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 11 Jul 2011 17:43:20 +0100
Subject: [R-sig-Geo] GISRUK Call for papers
Message-ID: <CANVKczOx1r4gwx-RYY5NbFqEigx-XwA2AxGca=DoRqikBV2vwA@mail.gmail.com>

Dear R-spatialists in the UK and environs, you may be interested in this:

Call for Papers, GISRUK2012, Lancaster University - 11th to 13th April 2012

 We are pleased to invite you to submit short (~1500 word) papers for
the 20th annual GIS Research UK conference (GISRUK) which will be held
at Lancaster University between Wednesday 11th and Friday 13th April
2012.

We welcome papers covering all aspects of theoretical and applied GIS
research, particularly those within the following themes:

? Environmental Geoinformatics
? Open-Source GI
? Web2.0
? Qualitative GIS
? Spatial Ecology
? Health
? Emergency Response
? Landscape Visualisation
? Geospatial Semantics
? Location-Based Services
? Remote Sensing and Photogrammetry

 The closing date for submissions is 25th November 2011. All papers
will be subject to peer review with accepted papers allocated to oral
and poster sessions accordingly. Conference proceedings including all
papers accepted for oral and poster presentation will be made
available as a free e-book (with ISBN) and as hardcopy for purchase
via http://www.lulu.com.

 The conference will be proceeded by a Open Source GeoSpatial software
workshop and a Young Researchers Forum commencing on Tuesday 10th
April 2012.

 We are pleased to confirm that the keynote speakers for this year?s
conference will be:

 Pete Atkinson, University of Southampton, UK
 Mei-Po Kwan, Ohio State University, USA
 Tyler Mitchell, Executive Director, OSGeo, USA

 For more information and submission details please visit the
conference website: http://www.lancs.ac.uk/gisruk2012 or contact
members of the local organising committee via gisruk2012 at lancs.ac.uk.
We look forward to receiving your submissions and welcoming you to
Lancaster in 2012.

 The Local Organizing Committee: Duncan Whyatt, Gemma Davies, Ian
Gregory, Barry Rowlingson, Mike James, Pragya Agarwal, Alan Blackburn
and John Watkins.


From pleahy at law.stanford.edu  Mon Jul 11 19:10:22 2011
From: pleahy at law.stanford.edu (Patrick Leahy)
Date: Mon, 11 Jul 2011 10:10:22 -0700
Subject: [R-sig-Geo] Help with project function in rgdal library
Message-ID: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>

Hi,

I'm trying to plot a set of geographical coordinates over the polygons
in a shapefile, so I need to transform the coordinates to the same
projection. I'm currently using the project function in the rgdal
library, but?I can't seem to figure out how to format the proj string
argument correctly. (I made a couple attempts using
http://www.remotesensing.org/geotiff/proj_list/?as a reference.) The
text of the .prj file is included below.?Any help would be greatly
appreciated!

Patrick

PROJCS["NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet",
GEOGCS["GCS_North_American_1983",
DATUM["D_North_American_1983",
SPHEROID["GRS_1980",6378137.0,298.257222101]],
PRIMEM["Greenwich",0.0],
UNIT["Degree",0.0174532925199433]],
PROJECTION["Lambert_Conformal_Conic"],
PARAMETER["False_Easting",984250.0],
PARAMETER["False_Northing",0.0],
PARAMETER["Central_Meridian",-74.0],
PARAMETER["Standard_Parallel_1",40.66666666666666],
PARAMETER["Standard_Parallel_2",41.03333333333333],
PARAMETER["Latitude_Of_Origin",40.16666666666666],
UNIT["Foot_US",0.3048006096012192]]


From narayani at ku.edu  Mon Jul 11 22:29:49 2011
From: narayani at ku.edu (Narayani Barve)
Date: Mon, 11 Jul 2011 15:29:49 -0500
Subject: [R-sig-Geo] Search in number sequence
Message-ID: <CAE=+0-J71Mft6bHP7PfD2vttavsj6pvOQghez+49HApiRnZv=g@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110711/17f95ce9/attachment.pl>

From honeydelagiroday at gmail.com  Tue Jul 12 00:54:57 2011
From: honeydelagiroday at gmail.com (Honey-Marie de la Giroday)
Date: Mon, 11 Jul 2011 15:54:57 -0700
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as an
	e00 or ascii
Message-ID: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>

Dear All,

I have a pixel image (im) I received as a .RData file.? I need to
export this pixel image from R in a file format that can be imported
into Arcview 9.x (e.g., .e00 or ascii).

Below is some of the code that I have been trying to use.  I have
reviewed the manuals for rgdal, maptools, sp, and spatstat packages
but have been unable to find another approach to converting the pixel
image to an Arcview raster dataset.  Please note that I have also
searched the R-sig-geo archives and was unable to find this covered
elsewhere.

"#load spatst package
library(spatstat)

#load file with model data
load(file="C:/bestmodel2004.RData")

#Plot best model data for 2004
plot(bestmodel2004)

#Examine attributes of pixel image
attributes(bestmodel2004)
$names
 [1] "v"      "dim"    "xrange" "yrange" "xstep"  "ystep"  "xcol"   "yrow"
 [9] "type"   "units"

$class
[1] "im"

#Load sp package
library(sp)

#Coerce bestmodel2004 (pixel image) to SpatialGridDataFrame
#......how do I do this?......

#Output to Acrview = write.asciigrid(x, fname, attr=1, na.value=-9999.....
#x=SpatialGridDataFrame
#fname=filename
write.asciigrid"

Thank you for your time, and please let me know if I need to provide
further information.

Sincerely,



H.M.C de la Giroday


From mdsumner at gmail.com  Tue Jul 12 01:23:53 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 12 Jul 2011 09:23:53 +1000
Subject: [R-sig-Geo] Help with project function in rgdal library
In-Reply-To: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
References: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
Message-ID: <CAAcGz98-sK3UoJhmGWQUBCN2ZctEVR_F9jGZF0ZxwwQ9On3z7A@mail.gmail.com>

At least one way is to put the CRS text into a .prj file and read it
in and see what rgdal gives.

I created a dummy shapefile, and put your text into dummy.prj:

It may well be that this is not enough and you need to delve deeper,
but it's an easy starting point to start cross-checking the WKT
against other formats:

library(rgdal)
x <- SpatialPointsDataFrame(SpatialPoints(matrix(rnorm(10), ncol =
2)), data.frame(x = 1:5))
writeOGR(x, ".", "dummy", "ESRI Shapefile")

x <- readOGR(".", "dummy")
proj4string(x)

[1] " +proj=lcc +lat_1=40.66666666666666 +lat_2=41.03333333333333
+lat_0=40.16666666666666 +lon_0=-74 +x_0=300000 +y_0=0 +ellps=GRS80
+datum=NAD83 +units=us-ft +no_defs +towgs84=0,0,0"

Cheers, Mike.

On Tue, Jul 12, 2011 at 3:10 AM, Patrick Leahy <pleahy at law.stanford.edu> wrote:
> Hi,
>
> I'm trying to plot a set of geographical coordinates over the polygons
> in a shapefile, so I need to transform the coordinates to the same
> projection. I'm currently using the project function in the rgdal
> library, but?I can't seem to figure out how to format the proj string
> argument correctly. (I made a couple attempts using
> http://www.remotesensing.org/geotiff/proj_list/?as a reference.) The
> text of the .prj file is included below.?Any help would be greatly
> appreciated!
>
> Patrick
>
> PROJCS["NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet",
> GEOGCS["GCS_North_American_1983",
> DATUM["D_North_American_1983",
> SPHEROID["GRS_1980",6378137.0,298.257222101]],
> PRIMEM["Greenwich",0.0],
> UNIT["Degree",0.0174532925199433]],
> PROJECTION["Lambert_Conformal_Conic"],
> PARAMETER["False_Easting",984250.0],
> PARAMETER["False_Northing",0.0],
> PARAMETER["Central_Meridian",-74.0],
> PARAMETER["Standard_Parallel_1",40.66666666666666],
> PARAMETER["Standard_Parallel_2",41.03333333333333],
> PARAMETER["Latitude_Of_Origin",40.16666666666666],
> UNIT["Foot_US",0.3048006096012192]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.turner at auckland.ac.nz  Tue Jul 12 05:30:11 2011
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 12 Jul 2011 15:30:11 +1200
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an	e00 or ascii
In-Reply-To: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
Message-ID: <4E1BBFC3.6080108@auckland.ac.nz>


This is definitely a case of the blind leading the blind, but I thought 
I'd chip
in anyway.

Let "Im" be your pixel image.  Do:

xy <- as.matrix(as.data.frame(raster.xy(as.owin(Im))))
v <- lookup.im(Im,xy[,1],xy[,2])
A <- SpatialPixelsDataFrame(points=xy,data=data.frame(v))
B <- as(A,"SpatialGridDataFrame")

Then "B" is an object of class "SpatialGridDataFrame" which ***may*** be 
what
you need.  I can't really tell, since I don't understand 
SpatialGridDataFrames.

The foregoing is kludgey, almost surely sub-optimal, and quite possibly 
wrong .....
But there's a chance it will be of some use to you.

     cheers,

         Rolf Turner

On 12/07/11 10:54, Honey-Marie de la Giroday wrote:
> Dear All,
>
> I have a pixel image (im) I received as a .RData file.  I need to
> export this pixel image from R in a file format that can be imported
> into Arcview 9.x (e.g., .e00 or ascii).
>
> Below is some of the code that I have been trying to use.  I have
> reviewed the manuals for rgdal, maptools, sp, and spatstat packages
> but have been unable to find another approach to converting the pixel
> image to an Arcview raster dataset.  Please note that I have also
> searched the R-sig-geo archives and was unable to find this covered
> elsewhere.
>
> "#load spatst package
> library(spatstat)
>
> #load file with model data
> load(file="C:/bestmodel2004.RData")
>
> #Plot best model data for 2004
> plot(bestmodel2004)
>
> #Examine attributes of pixel image
> attributes(bestmodel2004)
> $names
>   [1] "v"      "dim"    "xrange" "yrange" "xstep"  "ystep"  "xcol"   "yrow"
>   [9] "type"   "units"
>
> $class
> [1] "im"
>
> #Load sp package
> library(sp)
>
> #Coerce bestmodel2004 (pixel image) to SpatialGridDataFrame
> #......how do I do this?......
>
> #Output to Acrview = write.asciigrid(x, fname, attr=1, na.value=-9999.....
> #x=SpatialGridDataFrame
> #fname=filename
> write.asciigrid"
>
> Thank you for your time, and please let me know if I need to provide
> further information.
>
> Sincerely,
>
>
>
> H.M.C de la Giroday
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Tue Jul 12 05:40:27 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 12 Jul 2011 13:40:27 +1000
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <4E1BBFC3.6080108@auckland.ac.nz>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
	<4E1BBFC3.6080108@auckland.ac.nz>
Message-ID: <CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>

Another way is to use the coercion methods in maptools (these are
considered additional to the basics provided by sp, since they
provider converters between classes in other packages):

library(maptools)
as(Im, "SpatialGridDataFrame")

In terms of the data the result is identical to Rolf's method, though
various attributes will not be.

Cheers, Mike.


On Tue, Jul 12, 2011 at 1:30 PM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
>
> This is definitely a case of the blind leading the blind, but I thought I'd
> chip
> in anyway.
>
> Let "Im" be your pixel image. ?Do:
>
> xy <- as.matrix(as.data.frame(raster.xy(as.owin(Im))))
> v <- lookup.im(Im,xy[,1],xy[,2])
> A <- SpatialPixelsDataFrame(points=xy,data=data.frame(v))
> B <- as(A,"SpatialGridDataFrame")
>
> Then "B" is an object of class "SpatialGridDataFrame" which ***may*** be
> what
> you need. ?I can't really tell, since I don't understand
> SpatialGridDataFrames.
>
> The foregoing is kludgey, almost surely sub-optimal, and quite possibly
> wrong .....
> But there's a chance it will be of some use to you.
>
> ? ?cheers,
>
> ? ? ? ?Rolf Turner
>
> On 12/07/11 10:54, Honey-Marie de la Giroday wrote:
>>
>> Dear All,
>>
>> I have a pixel image (im) I received as a .RData file. ?I need to
>> export this pixel image from R in a file format that can be imported
>> into Arcview 9.x (e.g., .e00 or ascii).
>>
>> Below is some of the code that I have been trying to use. ?I have
>> reviewed the manuals for rgdal, maptools, sp, and spatstat packages
>> but have been unable to find another approach to converting the pixel
>> image to an Arcview raster dataset. ?Please note that I have also
>> searched the R-sig-geo archives and was unable to find this covered
>> elsewhere.
>>
>> "#load spatst package
>> library(spatstat)
>>
>> #load file with model data
>> load(file="C:/bestmodel2004.RData")
>>
>> #Plot best model data for 2004
>> plot(bestmodel2004)
>>
>> #Examine attributes of pixel image
>> attributes(bestmodel2004)
>> $names
>> ?[1] "v" ? ? ?"dim" ? ?"xrange" "yrange" "xstep" ?"ystep" ?"xcol" ? "yrow"
>> ?[9] "type" ? "units"
>>
>> $class
>> [1] "im"
>>
>> #Load sp package
>> library(sp)
>>
>> #Coerce bestmodel2004 (pixel image) to SpatialGridDataFrame
>> #......how do I do this?......
>>
>> #Output to Acrview = write.asciigrid(x, fname, attr=1, na.value=-9999.....
>> #x=SpatialGridDataFrame
>> #fname=filename
>> write.asciigrid"
>>
>> Thank you for your time, and please let me know if I need to provide
>> further information.
>>
>> Sincerely,
>>
>>
>>
>> H.M.C de la Giroday
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From M.J.Cracknell at utas.edu.au  Tue Jul 12 05:59:19 2011
From: M.J.Cracknell at utas.edu.au (mattc0)
Date: Tue, 12 Jul 2011 13:59:19 +1000
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
	an	e00 or ascii
In-Reply-To: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
Message-ID: <fba1fad47f82.4e1c5337@utas.edu.au>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/40fa07dc/attachment.pl>

From mathieu.rajerison at gmail.com  Tue Jul 12 08:08:28 2011
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Tue, 12 Jul 2011 08:08:28 +0200
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <4E1BBFC3.6080108@auckland.ac.nz>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
	<4E1BBFC3.6080108@auckland.ac.nz>
Message-ID: <CAGfc75k=Y963KnpAL9ei17qVCPERE44XbwZctKT68ovv_k+3wQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/0ec165fe/attachment.pl>

From r.turner at auckland.ac.nz  Tue Jul 12 08:08:33 2011
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 12 Jul 2011 18:08:33 +1200
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>	<4E1BBFC3.6080108@auckland.ac.nz>
	<CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>
Message-ID: <4E1BE4E1.9090908@auckland.ac.nz>

On 12/07/11 15:40, Michael Sumner wrote:
> Another way is to use the coercion methods in maptools (these are
> considered additional to the basics provided by sp, since they
> provider converters between classes in other packages):
>
> library(maptools)
> as(Im, "SpatialGridDataFrame")
>
> In terms of the data the result is identical to Rolf's method, though
> various attributes will not be.

Ahhh!  I tried as(Im,"SpatialGridDataFrame") --- to no avail --- but
with only ***sp*** loaded.  I forgot that ***maptools*** was the key
ingredient.  Duhhhhhhhh!

     cheers,

             Rolf Turner


From r.turner at auckland.ac.nz  Tue Jul 12 08:12:02 2011
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 12 Jul 2011 18:12:02 +1200
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <CAGfc75k=Y963KnpAL9ei17qVCPERE44XbwZctKT68ovv_k+3wQ@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>	<4E1BBFC3.6080108@auckland.ac.nz>
	<CAGfc75k=Y963KnpAL9ei17qVCPERE44XbwZctKT68ovv_k+3wQ@mail.gmail.com>
Message-ID: <4E1BE5B2.5010601@auckland.ac.nz>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/57affd3e/attachment.pl>

From tom.gottfried at tum.de  Tue Jul 12 08:54:49 2011
From: tom.gottfried at tum.de (Tom Gottfried)
Date: Tue, 12 Jul 2011 08:54:49 +0200
Subject: [R-sig-Geo] Help with project function in rgdal library
In-Reply-To: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
References: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
Message-ID: <4E1BEFB9.6010406@tum.de>

Hi Patrick,

you can find many references in several formats (including proj4) on

http://spatialreference.org/

regards,
Tom

Am 11.07.2011 19:10, schrieb Patrick Leahy:
> Hi,
>
> I'm trying to plot a set of geographical coordinates over the polygons
> in a shapefile, so I need to transform the coordinates to the same
> projection. I'm currently using the project function in the rgdal
> library, but I can't seem to figure out how to format the proj string
> argument correctly. (I made a couple attempts using
> http://www.remotesensing.org/geotiff/proj_list/ as a reference.) The
> text of the .prj file is included below. Any help would be greatly
> appreciated!
>
> Patrick
>
> PROJCS["NAD_1983_StatePlane_New_York_Long_Island_FIPS_3104_Feet",
> GEOGCS["GCS_North_American_1983",
> DATUM["D_North_American_1983",
> SPHEROID["GRS_1980",6378137.0,298.257222101]],
> PRIMEM["Greenwich",0.0],
> UNIT["Degree",0.0174532925199433]],
> PROJECTION["Lambert_Conformal_Conic"],
> PARAMETER["False_Easting",984250.0],
> PARAMETER["False_Northing",0.0],
> PARAMETER["Central_Meridian",-74.0],
> PARAMETER["Standard_Parallel_1",40.66666666666666],
> PARAMETER["Standard_Parallel_2",41.03333333333333],
> PARAMETER["Latitude_Of_Origin",40.16666666666666],
> UNIT["Foot_US",0.3048006096012192]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Technische Universit?t M?nchen
Department f?r Pflanzenwissenschaften
Lehrstuhl f?r Gr?nlandlehre
Alte Akademie 12
85350 Freising / Germany
Phone: ++49 (0)8161 715324
Fax:   ++49 (0)8161 713243
email: tom.gottfried at wzw.tum.de
http://www.wzw.tum.de/gruenland


From r.hijmans at gmail.com  Tue Jul 12 08:57:28 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Mon, 11 Jul 2011 23:57:28 -0700 (PDT)
Subject: [R-sig-Geo] Search in number sequence
In-Reply-To: <CAE=+0-J71Mft6bHP7PfD2vttavsj6pvOQghez+49HApiRnZv=g@mail.gmail.com>
References: <CAE=+0-J71Mft6bHP7PfD2vttavsj6pvOQghez+49HApiRnZv=g@mail.gmail.com>
Message-ID: <1310453848750-6573987.post@n2.nabble.com>

> I have a vector with repeated values like 
> ...
> I want to search the sequence in this vector. And search should give me
> the 
> index of matching sequence. 

If there is not a more direct way to do this, you can perhaps use the
movingFun function in raster for this.

library(raster)
values <- c(1:10, 1:10, 1:10)
pattern <- 5:7
fun <- function(x, ...) all(x == pattern)

which( movingFun(values, length(pattern), fun, type='from') )
# [1]  5 15 25
pattern <- c(9:10,1:2)
which( movingFun(values, length(pattern), fun, type='from') )
# [1]  9 19

Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Search-in-number-sequence-tp6572599p6573987.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From edzer.pebesma at uni-muenster.de  Tue Jul 12 09:06:18 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 12 Jul 2011 09:06:18 +0200
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <4E1BE4E1.9090908@auckland.ac.nz>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>	<4E1BBFC3.6080108@auckland.ac.nz>	<CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>
	<4E1BE4E1.9090908@auckland.ac.nz>
Message-ID: <4E1BF26A.7090709@uni-muenster.de>



On 07/12/2011 08:08 AM, Rolf Turner wrote:
> 
> Ahhh!  I tried as(Im,"SpatialGridDataFrame") --- to no avail --- but
> with only ***sp*** loaded.  I forgot that ***maptools*** was the key
> ingredient.  Duhhhhhhhh!

Why not move these coercion functions from maptools to spatstat?
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From tamara_em at hotmail.com  Tue Jul 12 12:00:02 2011
From: tamara_em at hotmail.com (=?UTF-8?Q?te=5F=C3=A4r?=)
Date: Tue, 12 Jul 2011 03:00:02 -0700 (PDT)
Subject: [R-sig-Geo] Buffer series
Message-ID: <1310464802482-6574427.post@n2.nabble.com>

I'd like to automatically create buffers to points with a series of different
radii. 
I'd intuitively tried like that (but I realized while writing that it cannot
work):

for (i in 1:10)
{
west_buf[i]<-gBuffer(west,byid=T,id=NULL,width=i,capStyle="ROUND")
cent_buf[i]<-gBuffer(cent,byid=T,id=NULL,width=i,capStyle="ROUND")
east_buf[i]<-gBuffer(east,byid=T,id=NULL,width=i,capStyle="ROUND")
} 

Is there a possibility to create a series of buffers of different size, i.e.
kind of 
looping the width?

thanks,
te


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Buffer-series-tp6574427p6574427.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From M.Stevenson at massey.ac.nz  Tue Jul 12 12:29:57 2011
From: M.Stevenson at massey.ac.nz (M.Stevenson at massey.ac.nz)
Date: Tue, 12 Jul 2011 22:29:57 +1200 (NZST)
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as an
	e00 or ascii
In-Reply-To: <CAGfc75k=Y963KnpAL9ei17qVCPERE44XbwZctKT68ovv_k+3wQ@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
	<4E1BBFC3.6080108@auckland.ac.nz>
	<CAGfc75k=Y963KnpAL9ei17qVCPERE44XbwZctKT68ovv_k+3wQ@mail.gmail.com>
Message-ID: <50951.122.59.173.209.1310466597.squirrel@webmail.massey.ac.nz>

This might be of some use. Here (among other things) we kernel smooth a
point pattern using spatstat then export the raster image as an ASCII grid
ready for loading into a GIS.

Regards,

Mark Stevenson


------------------------------------------------------------------------
library(epiR); library(maptools); library(rgdal); library(shapefiles);
library(sp); library(spatstat); library(spatialkernel);
library(RColorBrewer)

data(epi.incin); dat <- epi.incin
xlim <- range(dat$xcoord); ylim <- range(dat$ycoord)
sigma <- 1200; dimyx = c(200, 200)

# Create an observation window and two ppp objects:
dat.w <- convexhull.xy(x = dat[,1], y = dat[,2])
cas.ppp <- ppp(x = dat$xcoord[dat$status == 1], y = dat$ycoord[dat$status
== 1], window = dat.w)
ctl.ppp <- ppp(x = dat$xcoord[dat$status == 0], y = dat$ycoord[dat$status
== 0], window = dat.w)
cas.den <- density(cas.ppp, sigma = sigma, dimyx = dimyx)
ctl.den <- density(ctl.ppp, sigma = sigma, dimyx = dimyx)

# Image plot showing the spatial distribution of laryngeal cancer risk:
breaks <- seq(from = 0, to = 0.4, length = 5)
col <- brewer.pal(n = 4, name = "Blues")

par(pty = "s")
plot(xlim, ylim, type = "n", xlab = "Easting (m)", ylab = "Northing (m)",
xlim = xlim, ylim = ylim)
image(x = cas.den$xcol, y = cas.den$yrow, z = (t(cas.den$v) /
t(ctl.den$v)), zlim = c(0, 0.4), col = col, breaks = breaks, add = TRUE)
points(ctl.ppp, pch = 1, col = "grey")
points(cas.ppp, pch = 16)
plot(dat.w, add = TRUE)
metre(xl = xlim[1], yb = ylim[1], xr = xlim[1] + 500, yt = ylim[1] + 5000,
lab = breaks, cols = col, shift = 0, cex = 0.75)

# Add the appropriate risk (really, an odds) estimate to each household
location. Convert the risk estimates to a SpatialGridDataFrame:

risk <- cas.den
risk$v <- (cas.den$v) / (ctl.den$v)
risk.sgdf <- as.SpatialGridDataFrame.im(risk)

# Convert the case locations to a SpatialPoints object:
cas.sp <- SpatialPoints(coords = cbind(cas.ppp$x, cas.ppp$y))

# Do a transect and add the values to the cas.sp table:
tmp.trans <- overlay(risk.sgdf, cas.sp)
cas <- data.frame(x = cas.ppp$x, y = cas.ppp$y, risk = tmp.trans$v)

# Plot the data adding the numeric estimates of risk to check:
par(pty = "s")
plot(xlim, ylim, type = "n", xlab = "Easting (m)", ylab = "Northing (m)",
xlim = xlim, ylim = ylim)
image(x = cas.den$xcol, y = cas.den$yrow, z = (t(cas.den$v) /
t(ctl.den$v)), zlim = c(0, 0.4), col = col, breaks = breaks, add = TRUE)
text(x = cas$x, cas$y, labels = round(cas$risk, digits = 2), cex = 0.50)
plot(dat.w, add = TRUE)
metre(xl = xlim[1], yb = ylim[1], xr = xlim[1] + 500, yt = ylim[1] + 5000,
lab = breaks, cols = col, shift = 0, cex = 0.75)

# As a further check, export all of the R objects you've created into a
format suitable for display in a GIS.

# First of all, export the boundary window created earlier as a shape file
using the shapefiles package:

Id <- rep(1, times = length(dat.w$bdry[[1]]$x))
X <- dat.w$bdry[[1]]$x
Y <- dat.w$bdry[[1]]$y
shpTable <- data.frame(Id, X, Y)
attTable <- data.frame(Id = 1, Name = c("VAR1"))
epiincin <- convert.to.shapefile(shpTable = shpTable, attTable = attTable,
field = "Id", type = 5)
write.shapefile(epiincin, "epiincin", arcgis = TRUE)

# Export the raster image in ESRI's asciigrid format:

xllcorner = epiincin$shp$shp[[1]]$box[1]
yllcorner = epiincin$shp$shp[[1]]$box[2]
cellsize.h <- (epiincin$shp$shp[[1]]$box[3] -
epiincin$shp$shp[[1]]$box[1]) / dimyx[1]
cellsize.v <- (epiincin$shp$shp[[1]]$box[4] -
epiincin$shp$shp[[1]]$box[2]) / dimyx[2]

risk <- t((cas.den$v) / (ctl.den$v))
ncol <- dim(risk)[1]
risk <- (risk[,ncol:1])

grd <- GridTopology(cellcentre.offset = c(xllcorner,yllcorner), cellsize =
c(cellsize.h, cellsize.v), cells.dim = dimyx)
crds <- coordinates(grd)
risk.sgdf <- SpatialGridDataFrame(grd, data = data.frame(z =
as.vector(risk)))
spplot(risk.sgdf)
writeGDAL(risk.sgdf, "risk_sgdf.asc")

# Export the household data (including the risk estimates):
write.table(cas, "cases.csv", sep = ",", row.names = FALSE, col.names = TRUE)

# These three objects can now be loaded and queried in a GIS.

------------------------------------------------------------------------

> @Rolf
>
> You mentioned:
> xy <- as.matrix(as.data.frame(raster.xy(as.owin(Im))))
> v <- lookup.im(Im,xy[,1],xy[,2])
>
> Just for information, can you tell me in which package the functions
> lookup.im and raster.xy can be found?
>
> Thanks!
>
> 2011/7/12 Rolf Turner <r.turner at auckland.ac.nz>
>
>>
>> This is definitely a case of the blind leading the blind, but I thought
>> I'd
>> chip
>> in anyway.
>>
>> Let "Im" be your pixel image.  Do:
>>
>> xy <- as.matrix(as.data.frame(**raster.xy(as.owin(Im))))
>> v <- lookup.im(Im,xy[,1],xy[,2])
>> A <- SpatialPixelsDataFrame(points=**xy,data=data.frame(v))
>> B <- as(A,"SpatialGridDataFrame")
>>
>> Then "B" is an object of class "SpatialGridDataFrame" which ***may*** be
>> what
>> you need.  I can't really tell, since I don't understand
>> SpatialGridDataFrames.
>>
>> The foregoing is kludgey, almost surely sub-optimal, and quite possibly
>> wrong .....
>> But there's a chance it will be of some use to you.
>>
>>    cheers,
>>
>>        Rolf Turner
>>
>>
>> On 12/07/11 10:54, Honey-Marie de la Giroday wrote:
>>
>>> Dear All,
>>>
>>> I have a pixel image (im) I received as a .RData file.  I need to
>>> export this pixel image from R in a file format that can be imported
>>> into Arcview 9.x (e.g., .e00 or ascii).
>>>
>>> Below is some of the code that I have been trying to use.  I have
>>> reviewed the manuals for rgdal, maptools, sp, and spatstat packages
>>> but have been unable to find another approach to converting the pixel
>>> image to an Arcview raster dataset.  Please note that I have also
>>> searched the R-sig-geo archives and was unable to find this covered
>>> elsewhere.
>>>
>>> "#load spatst package
>>> library(spatstat)
>>>
>>> #load file with model data
>>> load(file="C:/bestmodel2004.**RData")
>>>
>>> #Plot best model data for 2004
>>> plot(bestmodel2004)
>>>
>>> #Examine attributes of pixel image
>>> attributes(bestmodel2004)
>>> $names
>>>  [1] "v"      "dim"    "xrange" "yrange" "xstep"  "ystep"  "xcol"
>>> "yrow"
>>>  [9] "type"   "units"
>>>
>>> $class
>>> [1] "im"
>>>
>>> #Load sp package
>>> library(sp)
>>>
>>> #Coerce bestmodel2004 (pixel image) to SpatialGridDataFrame
>>> #......how do I do this?......
>>>
>>> #Output to Acrview = write.asciigrid(x, fname, attr=1,
>>> na.value=-9999.....
>>> #x=SpatialGridDataFrame
>>> #fname=filename
>>> write.asciigrid"
>>>
>>> Thank you for your time, and please let me know if I need to provide
>>> further information.
>>>
>>> Sincerely,
>>>
>>>
>>>
>>> H.M.C de la Giroday
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>
>> ______________________________**_________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From zutal at yahoo.es  Tue Jul 12 12:40:39 2011
From: zutal at yahoo.es (Zulima Tablado Almela)
Date: Tue, 12 Jul 2011 12:40:39 +0200
Subject: [R-sig-Geo] Real distances and elevation home ranges
In-Reply-To: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
References: <CAD3QKTr+mYK70-Urq9kzdU-8qAOz4+ir-KSp3306PJ_Uej4GRA@mail.gmail.com>
Message-ID: <4E1C24A7.1080907@yahoo.es>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/d66ee114/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Tue Jul 12 12:53:44 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Tue, 12 Jul 2011 11:53:44 +0100
Subject: [R-sig-Geo] Buffer series
In-Reply-To: <1310464802482-6574427.post@n2.nabble.com>
References: <1310464802482-6574427.post@n2.nabble.com>
Message-ID: <CANVKczOAnc_0gfEUKr6Ge3mMhH8_aaRoY9Rn7bDFdkc10izgDQ@mail.gmail.com>

On Tue, Jul 12, 2011 at 11:00 AM, te_?r <tamara_em at hotmail.com> wrote:
> I'd like to automatically create buffers to points with a series of different
> radii.
> I'd intuitively tried like that (but I realized while writing that it cannot
> work):
>
> for (i in 1:10)
> {
> west_buf[i]<-gBuffer(west,byid=T,id=NULL,width=i,capStyle="ROUND")
> cent_buf[i]<-gBuffer(cent,byid=T,id=NULL,width=i,capStyle="ROUND")
> east_buf[i]<-gBuffer(east,byid=T,id=NULL,width=i,capStyle="ROUND")
> }

 What makes you think it cannot work? I think your only problem here
is storing the result in a vector rather than a list.

> Is there a possibility to create a series of buffers of different size, i.e.
> kind of
> looping the width?

Like this:

 > pts=cbind(runif(10),runif(10))
 > pts=SpatialPoints(pts)
 > plot(pts)
 > bufs=list() # store results as elements of a list
 > for(i in 1:10){bufs[[i]]=gBuffer(pts,byid=TRUE,id=NULL,width=i/10,capStyle="ROUND")}
 > plot(bufs[[10]])
 > plot(bufs[[9]],add=TRUE,lty=2)

 You can store almost anything in a list.

Barry


From tamara_em at hotmail.com  Tue Jul 12 14:00:32 2011
From: tamara_em at hotmail.com (=?UTF-8?Q?te=5F=C3=A4r?=)
Date: Tue, 12 Jul 2011 05:00:32 -0700 (PDT)
Subject: [R-sig-Geo] Buffer series
In-Reply-To: <CANVKczOAnc_0gfEUKr6Ge3mMhH8_aaRoY9Rn7bDFdkc10izgDQ@mail.gmail.com>
References: <1310464802482-6574427.post@n2.nabble.com>
	<CANVKczOAnc_0gfEUKr6Ge3mMhH8_aaRoY9Rn7bDFdkc10izgDQ@mail.gmail.com>
Message-ID: <1310472032746-6574767.post@n2.nabble.com>

Thanks -> adapted my code and it worked!
It seems that my Points were no "Spatial-
Points" aswell... this leeded to the error:

Fehler in gBuffer(west, byid = T, id = NULL, 
width = i/10, capStyle = "ROUND") : 
 Value of SET_STRING_ELT() 
must be a 'CHARSXP' not a 'NULL'

Thanks a lot!
te

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Buffer-series-tp6574427p6574767.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From etiennebr at gmail.com  Tue Jul 12 15:40:18 2011
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Tue, 12 Jul 2011 09:40:18 -0400
Subject: [R-sig-Geo] Cost allocation from cost distance
Message-ID: <CALjAYt7iJtbGsDyBG7W1Mz0d5bFreQM4JkzwdrddY67VRm+1RQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/985190eb/attachment.pl>

From alfreale74 at gmail.com  Tue Jul 12 15:41:47 2011
From: alfreale74 at gmail.com (Alfredo Alessandrini)
Date: Tue, 12 Jul 2011 15:41:47 +0200
Subject: [R-sig-Geo] classify a raster by unique value
Message-ID: <CA+GC7G48Z2k3Xn5RknR7aEBPE6GsmGgvfCW-S=1aqgAX5fkHCw@mail.gmail.com>

Hi,

I've a raster stack with 3 layers.

I need to classify it assigning one class to each unique combination of values.

> unique(as.matrix(data_stack))
           layer_1 layer_2 layer_3
 [1,] 0.2460000000       2    -0.1
 [2,] 0.1845000000       2    -0.1
 [3,] 0.0000000001       2    -0.1
 [4,] 0.0000000001       2     0.0
 [5,] 0.1476000000       2    -0.1


I must obtain a raster stack like this:

> unique(as.matrix(data_stack))
           layer_1 layer_2 layer_3 class
 [1,] 0.2460000000       2    -0.1   1
 [2,] 0.1845000000       2    -0.1   2
 [3,] 0.0000000001       2    -0.1   3
 [4,] 0.0000000001       2     0.0   4
 [5,] 0.1476000000       2    -0.1   5



Thanks in advance,


Alfredo


From jacobvanetten at yahoo.com  Tue Jul 12 17:19:35 2011
From: jacobvanetten at yahoo.com (Jacob van Etten)
Date: Tue, 12 Jul 2011 16:19:35 +0100
Subject: [R-sig-Geo] Cost allocation from cost distance
In-Reply-To: <CALjAYt7iJtbGsDyBG7W1Mz0d5bFreQM4JkzwdrddY67VRm+1RQ@mail.gmail.com>
Message-ID: <1310483975.19869.YahooMailClassic@web29707.mail.ird.yahoo.com>

I am not aware of a function that does this in R.

But this is not difficult to program with existing raster and gdistance functions.

This toy example works:

library(gdistance)

costAll <- function(fromCoords, cost)
{
  aC <- stack(cost,cost)
  cT <- transition(cost, mean, 8)
  cT <- geoCorrection(cT, scl=FALSE)
  for(i in 1:dim(fromCoords)[1]) {aC <- stack(aC, accCost(cT, fromCoords[i,]))}
  func <- function(x) which(x == min(x))
  aC <- dropLayer(aC,1:2)
  alC <- calc(aC, func)
  return(alC)
}

fromCoords <- cbind(c(-80,50),c(50,-80))
cost <- raster(ncol=36,nrow=18)
cost <- setValues(cost,rep(1,times=ncell(cost)))
cA <- costAll(fromCoords, cost)

plot(cA)
points(fromCoords)



Jacob.

--- On Tue, 12/7/11, Etienne B. Racine <etiennebr at gmail.com> wrote:

> From: Etienne B. Racine <etiennebr at gmail.com>
> Subject: [R-sig-Geo] Cost allocation from cost distance
> To: "r-sig-geo" <R-sig-Geo at stat.math.ethz.ch>
> Date: Tuesday, 12 July, 2011, 15:40
> Hi all,
> 
> I'm looking for a function which would allow to compute on
> a matrix the id
> of the closest point according to a matrix of cost. I've
> used
> gdistance::accCost() to get the cost, but I need to relate
> that cost to
> points. A good description of the function I'm looking for
> would be from
> ESRI Cost Allocation tool [1]. I couldn't find an
> equivalent function in R.
> 
> [1]
> http://help.arcgis.com/en/arcgisdesktop/10.0/help/index.html#/Cost_Allocation/009z00000016000000/
> 
> Etienne
> 
> ??? [[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From honeydelagiroday at gmail.com  Tue Jul 12 21:20:40 2011
From: honeydelagiroday at gmail.com (Honey-Marie de la Giroday)
Date: Tue, 12 Jul 2011 12:20:40 -0700
Subject: [R-sig-Geo] Exporting spatstat 'pixel image' to Arcview 9.x as
 an e00 or ascii
In-Reply-To: <CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>
References: <CAKtLgHy5BOqFSEZTiBpjO9+m0AL4i3zxWhujZi3C8t1w9XENTw@mail.gmail.com>
	<4E1BBFC3.6080108@auckland.ac.nz>
	<CAAcGz9-McnMz92Nd-W6E+zWhvU=sGb3ry7mCEst1ZUjtXE0D9w@mail.gmail.com>
Message-ID: <CAKtLgHzjdLKW15g4ukapp79jORRshzk=Ad8G9seNj3jVdEEQ4g@mail.gmail.com>

@Michael Sumner,

Your suggestion worked, thank you very much for your help!  I was able
to covert from image to "SpatialGridDataFrame" but I now have the
following issue:

#load packages
library(spatstat)
library(maptools)
library(sp)

#load file with model data
load(file="C:/bestmodel2004.RData")

#Plot best model data for 2004
plot(bestmodel2004)

#Coerce Rdata pixel image to SpatialGridDataFrame
BM2004 <- as(bestmodel2004, "SpatialGridDataFrame")

#Did it work?
attributes(BM2004)
plot(BM2004)
summary(BM2004)

#Output to Acrview = write.asciigrid(x, fname, attr=1, na.value=-9999.....
#x=SpatialGridDataFrame
#fname=filename
write.asciigrid(bestmodel2004, fname ="C:/mb2004asc")

***Error in write.asciigrid(BM2004, fname = "C:/mb2004asc") :
  Asciigrid does not support grids with non-square cells****

My first question is, to which cells is this error message referring
(pixels of the grid or the extent of the SpatialGridDataFrame) and has
anyone found a way around this issue?  I found another posting about
this but found the explanation of the resolution is a bit difficult to
understand (a bit like a monkey trying to read braille for the first
time).  See link below.
http://r-sig-geo.2731867.n2.nabble.com/help-on-quot-non-square-quot-problem-when-using-write-asciigrid-td2762098.html
Is there another approach to converting an image (im) to a file format
that is readable by ArcGIS 9.x (AND maintain attributes and
projection/coordinates) or should this monkey go back to trying read
braille.  Thank you for your help!

Sincerely,



HMC

On Mon, Jul 11, 2011 at 8:40 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> Another way is to use the coercion methods in maptools (these are
> considered additional to the basics provided by sp, since they
> provider converters between classes in other packages):
>
> library(maptools)
> as(Im, "SpatialGridDataFrame")
>
> In terms of the data the result is identical to Rolf's method, though
> various attributes will not be.
>
> Cheers, Mike.
>
>
> On Tue, Jul 12, 2011 at 1:30 PM, Rolf Turner <r.turner at auckland.ac.nz> wrote:
>>
>> This is definitely a case of the blind leading the blind, but I thought I'd
>> chip
>> in anyway.
>>
>> Let "Im" be your pixel image. ?Do:
>>
>> xy <- as.matrix(as.data.frame(raster.xy(as.owin(Im))))
>> v <- lookup.im(Im,xy[,1],xy[,2])
>> A <- SpatialPixelsDataFrame(points=xy,data=data.frame(v))
>> B <- as(A,"SpatialGridDataFrame")
>>
>> Then "B" is an object of class "SpatialGridDataFrame" which ***may*** be
>> what
>> you need. ?I can't really tell, since I don't understand
>> SpatialGridDataFrames.
>>
>> The foregoing is kludgey, almost surely sub-optimal, and quite possibly
>> wrong .....
>> But there's a chance it will be of some use to you.
>>
>> ? ?cheers,
>>
>> ? ? ? ?Rolf Turner
>>
>> On 12/07/11 10:54, Honey-Marie de la Giroday wrote:
>>>
>>> Dear All,
>>>
>>> I have a pixel image (im) I received as a .RData file. ?I need to
>>> export this pixel image from R in a file format that can be imported
>>> into Arcview 9.x (e.g., .e00 or ascii).
>>>
>>> Below is some of the code that I have been trying to use. ?I have
>>> reviewed the manuals for rgdal, maptools, sp, and spatstat packages
>>> but have been unable to find another approach to converting the pixel
>>> image to an Arcview raster dataset. ?Please note that I have also
>>> searched the R-sig-geo archives and was unable to find this covered
>>> elsewhere.
>>>
>>> "#load spatst package
>>> library(spatstat)
>>>
>>> #load file with model data
>>> load(file="C:/bestmodel2004.RData")
>>>
>>> #Plot best model data for 2004
>>> plot(bestmodel2004)
>>>
>>> #Examine attributes of pixel image
>>> attributes(bestmodel2004)
>>> $names
>>> ?[1] "v" ? ? ?"dim" ? ?"xrange" "yrange" "xstep" ?"ystep" ?"xcol" ? "yrow"
>>> ?[9] "type" ? "units"
>>>
>>> $class
>>> [1] "im"
>>>
>>> #Load sp package
>>> library(sp)
>>>
>>> #Coerce bestmodel2004 (pixel image) to SpatialGridDataFrame
>>> #......how do I do this?......
>>>
>>> #Output to Acrview = write.asciigrid(x, fname, attr=1, na.value=-9999.....
>>> #x=SpatialGridDataFrame
>>> #fname=filename
>>> write.asciigrid"
>>>
>>> Thank you for your time, and please let me know if I need to provide
>>> further information.
>>>
>>> Sincerely,
>>>
>>>
>>>
>>> H.M.C de la Giroday
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


From Pierre.Racine at sbf.ulaval.ca  Tue Jul 12 22:29:24 2011
From: Pierre.Racine at sbf.ulaval.ca (Pierre Racine)
Date: Tue, 12 Jul 2011 16:29:24 -0400
Subject: [R-sig-Geo] How to see polygons vertex
Message-ID: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADCC@EXCH-MBX-A.ulaval.ca>

Hi,

I want to see all the vertex of a SpatialPolygonsDataFrame in a plot. Should I convert or extract the coordinates of each polygons and then plot them? How?

Thanks,

Pierre


From narayani at ku.edu  Tue Jul 12 22:29:21 2011
From: narayani at ku.edu (Narayani Barve)
Date: Tue, 12 Jul 2011 15:29:21 -0500
Subject: [R-sig-Geo] Call and Eval function inside R
Message-ID: <CAE=+0-KXFzx8Yn8vQqrHeT+RkvMkx6m7Lk2gOsi25tu0bYvUTA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/5484597f/attachment.pl>

From Pierre.Racine at sbf.ulaval.ca  Tue Jul 12 22:47:10 2011
From: Pierre.Racine at sbf.ulaval.ca (Pierre Racine)
Date: Tue, 12 Jul 2011 16:47:10 -0400
Subject: [R-sig-Geo] How to see polygons vertex
In-Reply-To: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADCC@EXCH-MBX-A.ulaval.ca>
References: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADCC@EXCH-MBX-A.ulaval.ca>
Message-ID: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADD0@EXCH-MBX-A.ulaval.ca>

Ok got it:

>plot(imagev01 at polygons[[1]]@Polygons[[1]]@coords)

Now when I plot the polygon itself (there is only one):

>plot(imagev01)

 it is much less large than the set of point and they don't matches... The heights fit though.

Am I doing something wrong?

Pierre

> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-
> project.org] On Behalf Of Pierre Racine
> Sent: Tuesday, July 12, 2011 4:29 PM
> To: r-sig-geo at r-project.org
> Subject: [R-sig-Geo] How to see polygons vertex
> 
> Hi,
> 
> I want to see all the vertex of a SpatialPolygonsDataFrame in a plot. Should I
> convert or extract the coordinates of each polygons and then plot them? How?
> 
> Thanks,
> 
> Pierre
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matevz.pavlic at gi-zrmk.si  Tue Jul 12 22:52:52 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Tue, 12 Jul 2011 22:52:52 +0200
Subject: [R-sig-Geo] anisotropy modeling
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/abe72d15/attachment.pl>

From roman.lustrik at gmail.com  Tue Jul 12 22:54:21 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 12 Jul 2011 22:54:21 +0200
Subject: [R-sig-Geo] How to see polygons vertex
In-Reply-To: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADD0@EXCH-MBX-A.ulaval.ca>
References: <87A96661E65C5541AB4D20721C2DD7F8CF9A7AADCC@EXCH-MBX-A.ulaval.ca>
	<87A96661E65C5541AB4D20721C2DD7F8CF9A7AADD0@EXCH-MBX-A.ulaval.ca>
Message-ID: <CAHT1vpj8r7T7bA_dnemvf08YjmibDBOitGKDWZLOMFDRQCGwSA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110712/61c3239b/attachment.pl>

From dylan.beaudette at gmail.com  Wed Jul 13 05:26:08 2011
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Tue, 12 Jul 2011 20:26:08 -0700
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
	<alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>
Message-ID: <CAOGWcHJj+7Q6NJREgXUoMUVx=KmZLNToMD3w2a3pdPscYJWkiQ@mail.gmail.com>

I would second Roger's comments. I have found r.surf.contour does well
in complex terrain, especially at interfaces with water (i.e. alpine
lakes). There are several related threads on the GRASS mailing list.

Dylan

On Fri, Jul 8, 2011 at 8:09 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Fri, 8 Jul 2011, Barry Rowlingson wrote:
>
>> On Fri, Jul 8, 2011 at 2:26 PM, Robert Hijmans <r.hijmans at gmail.com>
>> wrote:
>>
>>
>>
>>> # now there are many ways to interpolate. See, e.g., the 'gstat' and
>>> 'automap' packages. See raster::interpolate for an example with splines.
>>> # using gstat and inverse distrance weighted interpolation:
>>>
>>> library(gstat)
>>> g <- gstat(id="level", formula = level~1, data=p, nmax=7, set=list(idp =
>>> .5))
>>> x1 <- interpolate(r, g)
>>
>> Statistical interpolation techniques may be right for this, but
>> thinking about it last night made me realise that contours are more
>> than just linear estimates of height at location. There's the
>> implication that between any two contour lines of height H1 and H2
>> there are no locations with height outside the bounds of (H1,H2).
>> Otherwise there would be a contour line there.
>>
>> And this may not be so uncommon in elevation models. Consider a steep
>> sided valley with a wide flood plain. You have close contours on
>> either side with a big gap between. Would a "statistical"
>> interpolation run down the valley side and plummet on down, then back
>> up the other side, turning the flood plain into a deep rounded valley
>> bottom? Sure it all depends on the parameters of the smoothing, but a
>> method that knew it was dealing with contours would constrain the
>> surface such that points between contour lines were always between the
>> contour line values.
>>
>> I think at least one of the algorithms in GRASS-GIS does this by
>> "drawing" the contour lines on the raster and then doing a 'flood
>> fill' operation between them.
>>
>> I'll have to dig out some GIS books...
>
> r.surf.contour in GRASS does what is required:
>
> http://grass.osgeo.org/grass64/manuals/html64_user/r.surf.contour.html
>
> gives its description; the input is a raster of the contours where the
> non-missing cells take the contour elevation values. I have found that
> spline interpolation can create artefacts, and geostatistical interpolation
> (or IDW for obvious reasons) does not like many neighbouring data points
> along a contour line.
>
> Roger
>
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Wed Jul 13 07:34:24 2011
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Wed, 13 Jul 2011 17:34:24 +1200
Subject: [R-sig-Geo] Mapping contours from jpg map
In-Reply-To: <CAOGWcHJj+7Q6NJREgXUoMUVx=KmZLNToMD3w2a3pdPscYJWkiQ@mail.gmail.com>
References: <CAF3P+nZ2++XTSk+SH2V24rARadziSJTqzBjPDUxtzhOGdM24MQ@mail.gmail.com>
	<CANVKczN0THv9NKv+gS01fixX9+te6VCTtHPe73_AngeuU8KWvQ@mail.gmail.com>
	<CANVKczMZ8DKiXTcJa2UdP+UZC=5NVwZ+Vd0T_DqH0A351dd3DQ@mail.gmail.com>
	<1310131580536-6562497.post@n2.nabble.com>
	<CANVKczMcYBbcUA_hMEd3470PX-maO+0kS=UN3iDFFUUWQtPoeA@mail.gmail.com>
	<alpine.LRH.2.00.1107081700110.20054@reclus.nhh.no>
	<CAOGWcHJj+7Q6NJREgXUoMUVx=KmZLNToMD3w2a3pdPscYJWkiQ@mail.gmail.com>
Message-ID: <CADLQFsOaXBFm05P2KJ79+bNVv-QuQrnXWPWob8dUzUeJvrHCZw@mail.gmail.com>

There's even a dedicated page on the GRASS-wiki:
http://grass.osgeo.org/wiki/Contour_lines_to_DEM

HTH,

Pierre

2011/7/13 Dylan Beaudette <dylan.beaudette at gmail.com>:
> I would second Roger's comments. I have found r.surf.contour does well
> in complex terrain, especially at interfaces with water (i.e. alpine
> lakes). There are several related threads on the GRASS mailing list.
>
> Dylan
>
> On Fri, Jul 8, 2011 at 8:09 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Fri, 8 Jul 2011, Barry Rowlingson wrote:
>>
>>> On Fri, Jul 8, 2011 at 2:26 PM, Robert Hijmans <r.hijmans at gmail.com>
>>> wrote:
>>>
>>>
>>>
>>>> # now there are many ways to interpolate. See, e.g., the 'gstat' and
>>>> 'automap' packages. See raster::interpolate for an example with splines.
>>>> # using gstat and inverse distrance weighted interpolation:
>>>>
>>>> library(gstat)
>>>> g <- gstat(id="level", formula = level~1, data=p, nmax=7, set=list(idp =
>>>> .5))
>>>> x1 <- interpolate(r, g)
>>>
>>> Statistical interpolation techniques may be right for this, but
>>> thinking about it last night made me realise that contours are more
>>> than just linear estimates of height at location. There's the
>>> implication that between any two contour lines of height H1 and H2
>>> there are no locations with height outside the bounds of (H1,H2).
>>> Otherwise there would be a contour line there.
>>>
>>> And this may not be so uncommon in elevation models. Consider a steep
>>> sided valley with a wide flood plain. You have close contours on
>>> either side with a big gap between. Would a "statistical"
>>> interpolation run down the valley side and plummet on down, then back
>>> up the other side, turning the flood plain into a deep rounded valley
>>> bottom? Sure it all depends on the parameters of the smoothing, but a
>>> method that knew it was dealing with contours would constrain the
>>> surface such that points between contour lines were always between the
>>> contour line values.
>>>
>>> I think at least one of the algorithms in GRASS-GIS does this by
>>> "drawing" the contour lines on the raster and then doing a 'flood
>>> fill' operation between them.
>>>
>>> I'll have to dig out some GIS books...
>>
>> r.surf.contour in GRASS does what is required:
>>
>> http://grass.osgeo.org/grass64/manuals/html64_user/r.surf.contour.html
>>
>> gives its description; the input is a raster of the contours where the
>> non-missing cells take the contour elevation values. I have found that
>> spline interpolation can create artefacts, and geostatistical interpolation
>> (or IDW for obvious reasons) does not like many neighbouring data points
>> along a contour line.
>>
>> Roger
>>
>>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Scientist
Landcare Research, New Zealand


From lmorandini at ieee.org  Wed Jul 13 08:57:30 2011
From: lmorandini at ieee.org (Luca Morandini)
Date: Wed, 13 Jul 2011 08:57:30 +0200
Subject: [R-sig-Geo] Call and Eval function inside R
In-Reply-To: <CAE=+0-KXFzx8Yn8vQqrHeT+RkvMkx6m7Lk2gOsi25tu0bYvUTA@mail.gmail.com>
References: <CAE=+0-KXFzx8Yn8vQqrHeT+RkvMkx6m7Lk2gOsi25tu0bYvUTA@mail.gmail.com>
Message-ID: <ivjfkq$dqm$1@dough.gmane.org>

On 07/12/2011 10:29 PM, Narayani Barve wrote:
>
> I am writing a function where I want to supply a variable which contains a
> condition to be evaluated inside the function. For example, I have a hourval
> variable containing values like 0, 3, 6, 9, 18, 3, 6, 9, 18 0, 3, 18 ... I
> want to select the indices where hourval variable matches to 0, 6.. This 0,
> 6  could change depending upon some other parameters. Basically they are not
> fixed always. So I pass a variable g1 =  call("which", (hourval==0 | hourval
> == 6)). I want this statement to be evaluated in the program. Hence I use
> the statement x1 = eval(g1). Obviously, when I pass the variable g1, that
> time hourval variable is not generated, but it is generated just before the
> eval(g1) statement. I get error,  object 'hourval' not found. Is there any
> other way to solve this problem.

The call function's arguments are evaluated at definition, hence hourval should be 
defined beforehand.

An exmaple:

remove(c(a, b, c))
fmean<-call("mean", c(a, b, c)) # Error, a,b,c are not defined

a<-1
b<-2
c<-3
fmean<-call("mean", c(a, b, c)) # OK, a,b,c are defined

g<-function(f) {
  eval(f)
}

g(fmean) # Returns 2

a<--1
b<-0
c<-1

g(fmean) # Returns 2 as well, since a,b,c are evaluated at definition time

Regards,

Luca Morandini
http://www.lucamorandini.it


From mdsumner at gmail.com  Wed Jul 13 09:05:39 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 13 Jul 2011 17:05:39 +1000
Subject: [R-sig-Geo] Call and Eval function inside R
In-Reply-To: <CAE=+0-KXFzx8Yn8vQqrHeT+RkvMkx6m7Lk2gOsi25tu0bYvUTA@mail.gmail.com>
References: <CAE=+0-KXFzx8Yn8vQqrHeT+RkvMkx6m7Lk2gOsi25tu0bYvUTA@mail.gmail.com>
Message-ID: <CAAcGz9-HxLaRp_3ZSmm-7R7h+o+X6OG6tbomrQdsWQujdBTY4A@mail.gmail.com>

Please don't cross post:

http://stackoverflow.com/questions/6671029/call-and-eval-function-inside-r

This is not a question for R-Sig-Geo at any rate, R-help is a better
candidate and you should consult that mailing list's posting guide.

Cheers, Mike.

On Wed, Jul 13, 2011 at 6:29 AM, Narayani Barve <narayani at ku.edu> wrote:
> Hi All,
>
> I am writing a function where I want to supply a variable which contains a
> condition to be evaluated inside the function. For example, I have a hourval
> variable containing values like 0, 3, 6, 9, 18, 3, 6, 9, 18 0, 3, 18 ... I
> want to select the indices where hourval variable matches to 0, 6.. This 0,
> 6 ?could change depending upon some other parameters. Basically they are not
> fixed always. So I pass a variable g1 = ?call("which", (hourval==0 | hourval
> == 6)). I want this statement to be evaluated in the program. Hence I use
> the statement x1 = eval(g1). Obviously, when I pass the variable g1, that
> time hourval variable is not generated, but it is generated just before the
> eval(g1) statement. I get error, ?object 'hourval' not found. Is there any
> other way to solve this problem.
>
> Thanks in advance, any help is appreciated.
>
> Narayani Barve
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From edzer.pebesma at uni-muenster.de  Wed Jul 13 10:09:58 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 13 Jul 2011 10:09:58 +0200
Subject: [R-sig-Geo] anisotropy modeling
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>
Message-ID: <4E1D52D6.2050701@uni-muenster.de>



On 07/12/2011 10:52 PM, Matev? Pavli? wrote:
> Hi all, 
> 
>  
> 
> i 'm am not entirely sure I understand anisotropy kriging in R. 
> 
> I have a data set in which is (at least i think so) anisotropy is clearly visible. So I made directional variograms....
> 
> So as i understand, the only thing that is different from >normal< kriging is the  >anis< property in which you define the diffrenece of ranges? Is that coreect?

Yes. Please note that fit.variogram ignores anything about anisotropy,
it assumes the variogram to fit to is in the major (correlation)
direction (or averaged over all directions).

> 
> Bellow is the code i use :
> 
>  
> 
> a<-5000/7000
> 
> print(plot(variogram(Z ~ 1, DF, map = TRUE, cutoff = 15000, width = 100), main = "Variogram map, podlaga",col.regions = terrain.colors(64)))
> 
> v1.a<-variogram(Z~1, DF, alpha=c(45, 135)) 
> 
> (vmf.a <- fit.variogram(v1.a, vgm(2900, "Pen", 5500, 300, anis = c(135, a))))
> 
> print(plot(v1.a, pl = F, pch = 20, col = "blue"))
> 
> print(plot(v1.a, plot.numbers = F, pch = 20, col = "darkblue", model = vmf.a))
> 
>  
> 
> podlaga.aniso<-krige(Z~1, DF[-zerodist(DF)[,1],], grd, vmf.a )
> 
> print(spplot(podlaga.aniso, zcol="var1.pred", col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, key.space="right"))
> 
> print(spplot(podlaga.aniso,  zcol="var1.var", col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, key.space="right"))
> 
> writeGDAL(podlaga.aniso, "podlaga_aniso.tif")
> 
>  
> 
> thanks for info, 
> 
>  
> 
> m
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Wed Jul 13 11:34:10 2011
From: matevz.pavlic at gi-zrmk.si (=?UTF-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Wed, 13 Jul 2011 11:34:10 +0200
Subject: [R-sig-Geo] anisotropy modeling
In-Reply-To: <4E1D52D6.2050701@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>
	<4E1D52D6.2050701@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D651@gi-zrmk.si>

Hi, 

thanks for the reply. Can you explain this a little bit more :
" it assumes the variogram to fit to is in the major (correlation) direction (or averaged over all directions)."

I don't know exactly ehat it means....
m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Wednesday, July 13, 2011 10:10 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] anisotropy modeling



On 07/12/2011 10:52 PM, Matev? Pavli? wrote:
> Hi all,
> 
>  
> 
> i 'm am not entirely sure I understand anisotropy kriging in R. 
> 
> I have a data set in which is (at least i think so) anisotropy is clearly visible. So I made directional variograms....
> 
> So as i understand, the only thing that is different from >normal< kriging is the  >anis< property in which you define the diffrenece of ranges? Is that coreect?

Yes. Please note that fit.variogram ignores anything about anisotropy, it assumes the variogram to fit to is in the major (correlation) direction (or averaged over all directions).

> 
> Bellow is the code i use :
> 
>  
> 
> a<-5000/7000
> 
> print(plot(variogram(Z ~ 1, DF, map = TRUE, cutoff = 15000, width = 
> 100), main = "Variogram map, podlaga",col.regions = 
> terrain.colors(64)))
> 
> v1.a<-variogram(Z~1, DF, alpha=c(45, 135))
> 
> (vmf.a <- fit.variogram(v1.a, vgm(2900, "Pen", 5500, 300, anis = 
> c(135, a))))
> 
> print(plot(v1.a, pl = F, pch = 20, col = "blue"))
> 
> print(plot(v1.a, plot.numbers = F, pch = 20, col = "darkblue", model = 
> vmf.a))
> 
>  
> 
> podlaga.aniso<-krige(Z~1, DF[-zerodist(DF)[,1],], grd, vmf.a )
> 
> print(spplot(podlaga.aniso, zcol="var1.pred", 
> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, 
> key.space="right"))
> 
> print(spplot(podlaga.aniso,  zcol="var1.var", 
> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, 
> key.space="right"))
> 
> writeGDAL(podlaga.aniso, "podlaga_aniso.tif")
> 
>  
> 
> thanks for info,
> 
>  
> 
> m
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

From matevz.pavlic at gi-zrmk.si  Wed Jul 13 13:31:38 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Wed, 13 Jul 2011 13:31:38 +0200
Subject: [R-sig-Geo] adding text to spplot
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D684@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/110c888e/attachment.pl>

From sadz_a1000 at yahoo.co.uk  Wed Jul 13 14:15:35 2011
From: sadz_a1000 at yahoo.co.uk (Sadz A)
Date: Wed, 13 Jul 2011 13:15:35 +0100 (BST)
Subject: [R-sig-Geo] Spatial Correlogram
Message-ID: <1310559335.48523.YahooMailRC@web24607.mail.ird.yahoo.com>

Dear list,

I am trying to explore spatial patterns in some density data that I have 
(attached txt- RDdensityChange). I have successfully carried out Moran's I 
correlogram on the data using the library (pgirmess). I now wish to carry out an 
anisotropic correlogram, I have looked at the ncf and ape packages but I am 
failing to get the out put I want: 

I would like to find the direction in which the change is occurring, how 
significant it is etc.  

To do this I believe I need to calculate the distance between points 
(municipXY.txt attached is the latitude longitude location of my data points) 
when they are projected onto a perpendicular line (of angle 0 ie. north line). 
use the distances calculated to to run a new morans I. And then repeat for a new 
angle (eg 45 degrees (North east), 90 degrees (east) etc). 

Unfortunately I don't know how to do this, I am very new to spatial analysis and 
R. 
I would greatly appreciate any help on this matter. 

Thank you for your time, 
S.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/88cf001d/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: RDdensityChange.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/88cf001d/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: municipXY.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/88cf001d/attachment-0001.txt>

From matevz.pavlic at gi-zrmk.si  Wed Jul 13 14:57:54 2011
From: matevz.pavlic at gi-zrmk.si (Matev? Pavlic)
Date: Wed, 13 Jul 2011 14:57:54 +0200
Subject: [R-sig-Geo] Spatial Correlogram
In-Reply-To: <1310559335.48523.YahooMailRC@web24607.mail.ird.yahoo.com>
References: <1310559335.48523.YahooMailRC@web24607.mail.ird.yahoo.com>
Message-ID: <DE8D49CD-D857-4B67-81F3-A8EF04346F54@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/47883de8/attachment.pl>

From tom.gottfried at tum.de  Wed Jul 13 17:00:05 2011
From: tom.gottfried at tum.de (Tom Gottfried)
Date: Wed, 13 Jul 2011 17:00:05 +0200
Subject: [R-sig-Geo] adding text to spplot
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D684@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D684@gi-zrmk.si>
Message-ID: <4E1DB2F5.9070900@tum.de>

Have a look at ?sp.text

Tom

Am 13.07.2011 13:31, schrieb Matev? Pavli?:
> hi all,
>
>
>
> I have a plot to which i would like to add text labels. And i cant find a way...here is the code :
>
>
>
> enaD2<-idw(D2~1, loca=dva, newdata=grd)
>
> pts = list("sp.points",  dva,  pch = 20, cex=1.5, col = "darkred
>
> spplot(enaD2, "var1.pred",sp.layout=pts, main = "globina 60 cm", sub="D2", col.regions=terrain.colors(64), contour=T)
>
>
>
>
>
> text information is in ena$ime field,
>
>
>
> regards, m
>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matevz.pavlic at gi-zrmk.si  Wed Jul 13 17:18:14 2011
From: matevz.pavlic at gi-zrmk.si (=?UTF-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Wed, 13 Jul 2011 17:18:14 +0200
Subject: [R-sig-Geo] [R] adding text to spplot
In-Reply-To: <CAEhWdG4BRzaLKUWqRqaLr=wYxn0b_A-QGQ2VhJCVL4t4MxakKg@mail.gmail.com>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D684@gi-zrmk.si>
	<CAEhWdG4BRzaLKUWqRqaLr=wYxn0b_A-QGQ2VhJCVL4t4MxakKg@mail.gmail.com>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D6C5@gi-zrmk.si>


Hi,
still have troubles,  if I have a code like this :

spplot(enaD2, "var1.pred",sp.layout=pts,  main = "globina 60 cm", sub="D2", col.regions=terrain.colors(64), contour=T)

i get a nice plot with contours but without text.

If ia use your code :

spplot(enaD2, "var1.pred",sp.layout=pts,  main = "globina 60 cm", sub="D2", col.regions=terrain.colors(64), contour=T, panel = function(x,y,z,...) { sp.points(ena, pch=20, cex=1.5, col="red")
sp.text(coordinates(ena), ena$ime) }    )

I get eeverything else but the actual spplot (just points and labels and a key on the right).

any ideas?

m

-----Original Message-----
From: Weidong Gu [mailto:anopheles123 at gmail.com] 
Sent: Wednesday, July 13, 2011 4:03 PM
To: Matev? Pavli?
Cc: r-help at r-project.org; r-sig-geo at r-project.org
Subject: Re: [R] adding text to spplot

You may need panel function

spplot(enaD2, "var1.pred",sp.layout=pts, main = "globina 60 cm", sub="D2", col.regions=terrain.colors(64), contour=T, panel = function(x,y,z,subscripts,...) {
panel.polygonsplot(x,y,z,subscripts,...)
sp.text(coordinates(enaD2), enaD2$ime[subscripts]) }


HTH

Weidong Gu

On Wed, Jul 13, 2011 at 7:31 AM, Matev? Pavli? <matevz.pavlic at gi-zrmk.si> wrote:
> hi all,
>
>
>
> I have a plot to which i would like to add text labels. And i cant find a way...here is the code :
>
>
>
> enaD2<-idw(D2~1, loca=dva, newdata=grd)
>
> pts = list("sp.points", ?dva, ?pch = 20, cex=1.5, col = "darkred
>
> spplot(enaD2, "var1.pred",sp.layout=pts, main = "globina 60 cm", 
> sub="D2", col.regions=terrain.colors(64), contour=T)
>
>
>
>
>
> text information is in ena$ime field,
>
>
>
> regards, m
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> ______________________________________________
> R-help at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide 
> http://www.R-project.org/posting-guide.html
> and provide commented, minimal, self-contained, reproducible code.
>

From oscar.perpinan at upm.es  Wed Jul 13 18:45:58 2011
From: oscar.perpinan at upm.es (Oscar =?UTF-8?B?UGVycGnDsWFu?= Lamigueiro)
Date: Wed, 13 Jul 2011 18:45:58 +0200
Subject: [R-sig-Geo] [R] adding text to spplot
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D6C5@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D684@gi-zrmk.si>
	<CAEhWdG4BRzaLKUWqRqaLr=wYxn0b_A-QGQ2VhJCVL4t4MxakKg@mail.gmail.com>
	<AD5CA6183570B54F92AA45CE2619F9B90129D6C5@gi-zrmk.si>
Message-ID: <20110713184558.38a7fba0@upm.es>

Hi,

help(spplot):

     The ?sp.layout? argument is either a single layout item, or a list
     with a layout items. A layout item is a list with its first
     argument the name of the layout function to be called: ?sp.points?
     for SpatialPoints, ?sp.polygons? for SpatialPolygons object,
     ?sp.lines? for a SpatialLines object, and ?sp.text? for text to
     place. The second argument contains the object (or text) to be
     plotted; remaining arguments are passed to the corresponding
     ?panel.*? functions.

And first example of help(spplot):

     data(meuse)
     coordinates(meuse) <- ~x+y
     l2 = list("SpatialPolygonsRescale", layout.north.arrow(), offset =
     c(181300,329800), scale = 400)
     l3 = list("SpatialPolygonsRescale", layout.scale.bar(), offset =
     c(180500,329800), scale = 500, fill=c("transparent","black"))
     l4 = list("sp.text", c(180500,329900), "0")
     l5 = list("sp.text", c(181000,329900), "500 m")
     
     spplot(meuse, c("ffreq"), sp.layout=list(l2,l3,l4,l5),
     col.regions= "black", pch=c(1,2,3),
     key.space=list(x=0.1,y=.95,corner=c(0,1)))

Bye, 

Oscar.


El Wed, 13 Jul 2011 17:18:14 +0200
Matev? Pavli? <matevz.pavlic at gi-zrmk.si> escribi?:
> 
> Hi,
> still have troubles,  if I have a code like this :
> 
> spplot(enaD2, "var1.pred",sp.layout=pts,  main = "globina 60 cm",
> sub="D2", col.regions=terrain.colors(64), contour=T)
> 
> i get a nice plot with contours but without text.
> 
> If ia use your code :
> 
> spplot(enaD2, "var1.pred",sp.layout=pts,  main = "globina 60 cm",
> sub="D2", col.regions=terrain.colors(64), contour=T, panel =
> function(x,y,z,...) { sp.points(ena, pch=20, cex=1.5, col="red")
> sp.text(coordinates(ena), ena$ime) }    )
> 
> I get eeverything else but the actual spplot (just points and labels
> and a key on the right).
> 
> any ideas?
> 
> m

-------------
Oscar Perpi??n Lamigueiro
Dpto. de Ingenier?a El?ctrica
EUITI-UPM

http://procomun.wordpress.com


From edzer.pebesma at uni-muenster.de  Wed Jul 13 19:13:09 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Wed, 13 Jul 2011 19:13:09 +0200
Subject: [R-sig-Geo] anisotropy modeling
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D651@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>
	<4E1D52D6.2050701@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D651@gi-zrmk.si>
Message-ID: <4E1DD225.9000002@uni-muenster.de>

help(fit.variogram) has the following description:

     Fit ranges and/or sills from a simple or nested variogram model to
     a sample variogram

I suspected it would completely ignore anisotropy settings. However,
this seems not to be the case:

> library(gstat)
Loading required package: sp
Loading required package: spacetime
Loading required package: zoo
Loading required package: xts
> loadMeuse()
> v0 = variogram(zinc~1,meuse, alpha = 0, tol.hor = 45)
> v90 = variogram(zinc~1,meuse, alpha = 90, tol.hor = 45)
> v = variogram(zinc~1,meuse)
> fit.variogram(v, vgm(1, "Exp", 300, anis=c(90,1)))
  model  psill    range
1   Exp 166238 323.6674
> fit.variogram(v, vgm(1, "Exp", 300, anis=c(90,.1)))
  model  psill    range ang1 anis1
1   Exp 166238 3236.674   90   0.1
> fit.variogram(v0, vgm(1, "Exp", 300, anis=c(90,.1)))
  model    psill    range ang1 anis1
1   Exp 146068.7 2772.751   90   0.1
> fit.variogram(v90, vgm(1, "Exp", 300, anis=c(90,.1)))
  model    psill    range ang1 anis1
1   Exp 200767.2 4027.282   90   0.1
>


On 07/13/2011 11:34 AM, Matev? Pavli? wrote:
> Hi, 
> 
> thanks for the reply. Can you explain this a little bit more :
> " it assumes the variogram to fit to is in the major (correlation) direction (or averaged over all directions)."
> 
> I don't know exactly ehat it means....
> m
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Wednesday, July 13, 2011 10:10 AM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] anisotropy modeling
> 
> 
> 
> On 07/12/2011 10:52 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> i 'm am not entirely sure I understand anisotropy kriging in R. 
>>
>> I have a data set in which is (at least i think so) anisotropy is clearly visible. So I made directional variograms....
>>
>> So as i understand, the only thing that is different from >normal< kriging is the  >anis< property in which you define the diffrenece of ranges? Is that coreect?
> 
> Yes. Please note that fit.variogram ignores anything about anisotropy, it assumes the variogram to fit to is in the major (correlation) direction (or averaged over all directions).
> 
>>
>> Bellow is the code i use :
>>
>>  
>>
>> a<-5000/7000
>>
>> print(plot(variogram(Z ~ 1, DF, map = TRUE, cutoff = 15000, width = 
>> 100), main = "Variogram map, podlaga",col.regions = 
>> terrain.colors(64)))
>>
>> v1.a<-variogram(Z~1, DF, alpha=c(45, 135))
>>
>> (vmf.a <- fit.variogram(v1.a, vgm(2900, "Pen", 5500, 300, anis = 
>> c(135, a))))
>>
>> print(plot(v1.a, pl = F, pch = 20, col = "blue"))
>>
>> print(plot(v1.a, plot.numbers = F, pch = 20, col = "darkblue", model = 
>> vmf.a))
>>
>>  
>>
>> podlaga.aniso<-krige(Z~1, DF[-zerodist(DF)[,1],], grd, vmf.a )
>>
>> print(spplot(podlaga.aniso, zcol="var1.pred", 
>> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, 
>> key.space="right"))
>>
>> print(spplot(podlaga.aniso,  zcol="var1.var", 
>> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15, 
>> key.space="right"))
>>
>> writeGDAL(podlaga.aniso, "podlaga_aniso.tif")
>>
>>  
>>
>> thanks for info,
>>
>>  
>>
>> m
>>
>>
>> 	[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From etiennebr at gmail.com  Wed Jul 13 19:50:54 2011
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Wed, 13 Jul 2011 13:50:54 -0400
Subject: [R-sig-Geo] plot3D raster coordinates
In-Reply-To: <CALjAYt6cvwUtze=kb0Z=X9YSFR=h9t=xDETPHQtbbTCd0gvh2w@mail.gmail.com>
References: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>
	<CALjAYt6cvwUtze=kb0Z=X9YSFR=h9t=xDETPHQtbbTCd0gvh2w@mail.gmail.com>
Message-ID: <CALjAYt6M9SaD3J+GeAbSOZBRvdw=ABeO2zcWYkvfQscND7m-UQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/d66f51fa/attachment.pl>

From senator at ecotoxicology.de  Wed Jul 13 22:34:38 2011
From: senator at ecotoxicology.de (=?iso-8859-1?Q?Ralf_Sch=E4fer?=)
Date: Wed, 13 Jul 2011 22:34:38 +0200
Subject: [R-sig-Geo] Livestreaming during GEOSTAT summer school - Free
	analysis of spatio-temporal data with R
Message-ID: <2A8C0AC9-B878-4AFD-A235-F8023ACA4A4A@ecotoxicology.de>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110713/d50440be/attachment.pl>

From sewellpatrick at gmail.com  Thu Jul 14 08:42:33 2011
From: sewellpatrick at gmail.com (Patrick S)
Date: Thu, 14 Jul 2011 01:42:33 -0500
Subject: [R-sig-Geo] Grouping point clouds into polygons
Message-ID: <CAAvCDy-UaDeFWJcu1sGd=n=PTRUcVVbBJvNL8aBtX=igx0utaQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/e1ae5db0/attachment.pl>

From educheyne at avia-gis.be  Thu Jul 14 08:50:05 2011
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Thu, 14 Jul 2011 08:50:05 +0200
Subject: [R-sig-Geo] Grouping point clouds into polygons
In-Reply-To: <CAAvCDy-UaDeFWJcu1sGd=n=PTRUcVVbBJvNL8aBtX=igx0utaQ@mail.gmail.com>
References: <CAAvCDy-UaDeFWJcu1sGd=n=PTRUcVVbBJvNL8aBtX=igx0utaQ@mail.gmail.com>
Message-ID: <686BA533-8A68-4A37-9E80-3A5193999A12@avia-gis.be>

Hi
I think Thiessens polygons are maybe a solution for your probem
HTH
Els
On 14 Jul 2011, at 08:42, Patrick S wrote:

> This is more of a theoretical question than an R-specific question, but does
> anyone have any suggestions for grouping clouds of points into polygons
> representing clusters?
> 
> I have a spatial data set with points for each commercial land use in
> Atlanta along with the square footage. I would like to cluster these, using
> K-means probably, and then I would like to draw polygons around them so that
> all of space is filled. So I don't want alpha hulls, because I don't want
> gaps between polygons. Rather I want the space between the polygons to be
> assigned to the adjacent cluster with the strongest "pull" in terms of
> square footage.
> 
> Any thoughts?
> 
> Patrick Sewell
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From baptiste.auguie at googlemail.com  Thu Jul 14 08:51:21 2011
From: baptiste.auguie at googlemail.com (baptiste auguie)
Date: Thu, 14 Jul 2011 18:51:21 +1200
Subject: [R-sig-Geo] Grouping point clouds into polygons
In-Reply-To: <CAAvCDy-UaDeFWJcu1sGd=n=PTRUcVVbBJvNL8aBtX=igx0utaQ@mail.gmail.com>
References: <CAAvCDy-UaDeFWJcu1sGd=n=PTRUcVVbBJvNL8aBtX=igx0utaQ@mail.gmail.com>
Message-ID: <CANLFJPrxOcMzRGU2-ecS4r8iCWJ=uv6OKMhmVPhnS5Cg5wd-fA@mail.gmail.com>

Hi,

If I understand your question properly, I would suggest the following approach.

- Obtain a Voronoi tesselation from the set of points
- merge the resulting polygons according to your clustering method

Best,

baptiste

PS: it seems a similar suggestion has just been sent..

On 14 July 2011 18:42, Patrick S <sewellpatrick at gmail.com> wrote:
> This is more of a theoretical question than an R-specific question, but does
> anyone have any suggestions for grouping clouds of points into polygons
> representing clusters?
>
> I have a spatial data set with points for each commercial land use in
> Atlanta along with the square footage. I would like to cluster these, using
> K-means probably, and then I would like to draw polygons around them so that
> all of space is filled. So I don't want alpha hulls, because I don't want
> gaps between polygons. Rather I want the space between the polygons to be
> assigned to the adjacent cluster with the strongest "pull" in terms of
> square footage.
>
> Any thoughts?
>
> Patrick Sewell
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From atlasrrg at gmail.com  Thu Jul 14 17:36:04 2011
From: atlasrrg at gmail.com (atlasrrg)
Date: Thu, 14 Jul 2011 08:36:04 -0700 (PDT)
Subject: [R-sig-Geo] plotting geographic coordinates on a map
Message-ID: <1310657764042-6583747.post@n2.nabble.com>

Hello, 

I am pretty sure that I am making a novice mistake here as I've only just
begun exploring spatial data in R. I have a data.csv file that contains
geographic coordinates as follows:

SEQUENCE,longitude,latitude,altitude
AF196835_Pc_40.77_73.96_1999.71,-73.96,40.77,18
AF202541_Hs_42.76_75.82_1999.66,-75.82,42.76,456
AF260967_Ec_40.77_73.96_1999.50,-73.96,40.77,18
AF404753_Cb_39.43_76.78_2000.50,-76.78,39.43,154
AF404754_Cp_40.95_74.07_2000.50,-74.07,40.95,18
...

I simply would like to plot these on a map of the US. I've tried all sorts
of approaches, including
> map('usa', project='albers', par=c(39,34))
> points(x=data$LONGITUDE, y=data$LATITUTUDE, col='red')

[as well as several other maps in the maps package]

and 

> all_states <-map_data("state")
> p <- ggplot()
> p <-p + geom_polygon( data=all_states, aes(x=long, y=lat, group = group),
> colour='white', fill = 'grey10')
> p
> mydata <-read.csv("geo.csv", header=TRUE, row.names=1, sep=",")
> p <- ggplot()
> p <- p+ geom_point( data=mydata) 

 and 

> library(sp)
> coordinates(WNV) <- c("latitude", "longitude")
> map('world')
> plot(WNV$latitude, WNV$longitude)


I was able to plot an example file coordinates on the world map in the maps
package, but not on the US map. If someone could please point me in the
right direction I would greatly appreciate your help!!

Thank you

Rebecca

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-geographic-coordinates-on-a-map-tp6583747p6583747.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ashton at msu.edu  Thu Jul 14 18:07:35 2011
From: ashton at msu.edu (Ashton Shortridge)
Date: Thu, 14 Jul 2011 12:07:35 -0400
Subject: [R-sig-Geo] plotting geographic coordinates on a map
In-Reply-To: <1310657764042-6583747.post@n2.nabble.com>
References: <1310657764042-6583747.post@n2.nabble.com>
Message-ID: <201107141207.35216.ashton@msu.edu>

On 2011-07-14, atlasrrg, wrote:
> Hello,
> 
> I am pretty sure that I am making a novice mistake here as I've only just
> begun exploring spatial data in R. I have a data.csv file that contains
> geographic coordinates as follows:
> 
> SEQUENCE,longitude,latitude,altitude
> AF196835_Pc_40.77_73.96_1999.71,-73.96,40.77,18
> AF202541_Hs_42.76_75.82_1999.66,-75.82,42.76,456
> AF260967_Ec_40.77_73.96_1999.50,-73.96,40.77,18
> AF404753_Cb_39.43_76.78_2000.50,-76.78,39.43,154
> AF404754_Cp_40.95_74.07_2000.50,-74.07,40.95,18
> ...
> 
> I simply would like to plot these on a map of the US. I've tried all sorts
> of approaches, including
> 
> > map('usa', project='albers', par=c(39,34))
> > points(x=data$LONGITUDE, y=data$LATITUTUDE, col='red')
> 
> [as well as several other maps in the maps package]
> 
> and
> 
> > all_states <-map_data("state")
> > p <- ggplot()
> > p <-p + geom_polygon( data=all_states, aes(x=long, y=lat, group = group),
> > colour='white', fill = 'grey10')
> > p
> > mydata <-read.csv("geo.csv", header=TRUE, row.names=1, sep=",")
> > p <- ggplot()
> > p <- p+ geom_point( data=mydata)
> 
>  and
> 
> > library(sp)
> > coordinates(WNV) <- c("latitude", "longitude")
> > map('world')
> > plot(WNV$latitude, WNV$longitude)
> 
> I was able to plot an example file coordinates on the world map in the maps
> package, but not on the US map. If someone could please point me in the
> right direction I would greatly appreciate your help!!
> 
> Thank you
> 
> Rebecca
> 

Hi Rebecca,

R is case-sensitive, so assuming you read in that csv file, you would want to 
refer to the columns with lower-case letters, e.g.:
data <- read.csv('myfilename')
names(data)  # make sure they are what you think they are.
data[1:10,]    # look at the first 10 rows of the data, too!
map('usa', project='albers', par=c(39,34))
points(x=data$longitude, y=data$latitude, col='red')

Hope this helps,

Ashton
-----
Ashton Shortridge
Associate Professor			ashton at msu.edu
Dept of Geography			http://www.msu.edu/~ashton
235 Geography Building		ph (517) 432-3561
Michigan State University		fx (517) 432-1671


From matevz.pavlic at gi-zrmk.si  Thu Jul 14 18:18:32 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Thu, 14 Jul 2011 18:18:32 +0200
Subject: [R-sig-Geo] predict() LDL error
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>

Hi all, 

 

i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 

 

When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....

 

I got this code (mostly) from the net, so i have some trouble understanding it...

 

thanks for any help and info about categorical kriging, 

 

m

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/a0da5d3c/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: CatKrig.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/a0da5d3c/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: v290.csv
Type: application/octet-stream
Size: 31214 bytes
Desc: v290.csv
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/a0da5d3c/attachment.obj>

From arindam.gis at gmail.com  Thu Jul 14 18:36:58 2011
From: arindam.gis at gmail.com (ari)
Date: Thu, 14 Jul 2011 09:36:58 -0700 (PDT)
Subject: [R-sig-Geo] Download MODIS images
In-Reply-To: <00b701cb1c26$240a7070$6c1f5150$@net>
References: <AANLkTinVPgiPqo453wiehtt__bOObI1UjB_U00jhRA8v@mail.gmail.com>
	<00b701cb1c26$240a7070$6c1f5150$@net>
Message-ID: <1310661418747-6583997.post@n2.nabble.com>

Hi,
 If I want to use ocean data (for example- Sea Surface Temperature,
Chlorophyll-a Concententration etc.) or in others words download MOD 28 and
MOD 21 data using the same script for a paticular block, which ftp server
should I use?

Thanks,
A

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Download-MODIS-images-tp5251474p6583997.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rhunne at mac.com  Thu Jul 14 19:50:42 2011
From: rhunne at mac.com (Robin W Hunnewell)
Date: Thu, 14 Jul 2011 17:50:42 +0000 (GMT)
Subject: [R-sig-Geo] spTransform to convert projected coords into geog coord
Message-ID: <0b82253b-9b67-6ad1-8b8a-b356213ee24a@me.com>

Hello,?

I get an error when calling function 'spTransform' -- from package {rgdal}. I've used spTransform recently w/ no problem, to convert coordinates from one CRS to coords of another. Has this function been deprecated, or is there some other method? ?

My code below. I'll lean in for a dope slap if I've missed something simple!?
Thanks for any help.

> summary(pp)
Planar point pattern: 18 points
Average intensity 0.0928 points per square kilometer  

Window: polygonal boundary
single connected closed polygon with 7995 vertices
enclosing rectangle: [687.8542, 719.5667]x[4886.808, 4925.33]kilometer
Window area =  193.967 square kilometer 
Unit of length: 1 kilometer?
> pp.longlat <- spTransform(pp, CRS=CRS("+proj=longlat +ellps=WGS84"))
Error in function (classes, fdef, mtable)  : 
  unable to find an inherited method for function "spTransform", for signature "ppp", "CRS"

> sessionInfo()
R version 2.13.0 (2011-04-13)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_US.UTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] rgeos_0.1-4         rgdal_0.6-33        gpclib_1.5-1        maptools_0.8-6      lattice_0.19-26    
 [6] foreign_0.8-44      spatstat_1.22-3     RandomFields_2.0.45 deldir_0.0-13       mgcv_1.7-6         
[11] raster_18-12       sp_0.9-80          

loaded via a namespace (and not attached):
[1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/edd7f881/attachment.html>

From rhunne at mac.com  Thu Jul 14 23:23:00 2011
From: rhunne at mac.com (Robin W Hunnewell)
Date: Thu, 14 Jul 2011 21:23:00 +0000 (GMT)
Subject: [R-sig-Geo] spTransform to convert projected coords into geog coord
Message-ID: <9c1654b2-b730-4b20-938c-e0a64aa35563@me.com>

Re: this previous post, sorry my fault... fn applies to Spatial* objects, not "ppp" objects - my apologies.



Date: 14 July 2011 2:50:42 PM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] spTransform to convert projected coords into geog coord

Hello,?

I get an error when calling function 'spTransform' -- from package {rgdal}. I've used spTransform recently w/ no problem, to convert coordinates from one CRS to coords of another. Has this function been deprecated, or is there some other method? ?

My code below. I'll lean in for a dope slap if I've missed something simple!?
Thanks for any help.

> summary(pp)
Planar point pattern: 18 points
Average intensity 0.0928 points per square kilometer  

Window: polygonal boundary
single connected closed polygon with 7995 vertices
enclosing rectangle: [687.8542, 719.5667]x[4886.808, 4925.33]kilometer
Window area =  193.967 square kilometer 
Unit of length: 1 kilometer?
> pp.longlat <- spTransform(pp, CRS=CRS("+proj=longlat +ellps=WGS84"))
Error in function (classes, fdef, mtable)  : 
  unable to find an inherited method for function "spTransform", for signature "ppp", "CRS"

> sessionInfo()
R version 2.13.0 (2011-04-13)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_USUTF-8/en_US.UTF-8/C/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] rgeos_0.1-4         rgdal_0.6-33        gpclib_1.5-1        maptools_0.8-6      lattice_0.19-26    
 [6] foreign_0.8-44      spatstat_1.22-3     RandomFields_2.0.45 deldir_0.0-13       mgcv_1.7-6         
[11] raster_1.8-12       sp_0.9-80          

loaded via a namespace (and not attached):
[1] grid_2.13.0        Matrix_0.999375-50 nlme_3.1-101       tools_2.13.0   
_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/31999fdc/attachment.html>

From edzer.pebesma at uni-muenster.de  Thu Jul 14 23:24:42 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 14 Jul 2011 23:24:42 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>
Message-ID: <4E1F5E9A.10409@uni-muenster.de>

The error message is an indication that you're predicting (kriging) with
a singular covariance matrix. The most frequent reasons for this are
duplicate observations [1] or perfect correlation in the
coregionalization model [2]. For [1], see ?remove.duplicates, for [2]
see argument correct.diagonal in ?fit.lmc.

On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
> Hi all, 
> 
>  
> 
> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 
> 
>  
> 
> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
> 
>  
> 
> I got this code (mostly) from the net, so i have some trouble understanding it...
> 
>  
> 
> thanks for any help and info about categorical kriging, 
> 
>  
> 
> m
> 
>  
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From dkennedy at airsci.com  Fri Jul 15 00:09:43 2011
From: dkennedy at airsci.com (David Kennedy)
Date: Thu, 14 Jul 2011 15:09:43 -0700
Subject: [R-sig-Geo] Long time listener, first time caller
Message-ID: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>

Hello there,

I'm using "raster" to great effect in a little something I'm building, but having a time trying to figure out this current issue. My intent is to build a "distance raster" from a center point out to 1km with cell size of 30x30. I had a few runs yesterday where this worked, but today with a different set of coordinates and UTM zone, I have a surfeit of "NA's" and white lines in my plotted raster.  Any notion as to what is causing the error?

I thank you in advance for your time and efforts.

________________________________________
David Kennedy
dkennedy at airsci.com | www.airsci.com


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: dist_1km_code.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/f52c477e/attachment.txt>
-------------- next part --------------




From moshersteven at gmail.com  Fri Jul 15 00:18:02 2011
From: moshersteven at gmail.com (steven mosher)
Date: Thu, 14 Jul 2011 15:18:02 -0700
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
Message-ID: <CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110714/60dc4925/attachment.pl>

From dkennedy at airsci.com  Fri Jul 15 00:31:16 2011
From: dkennedy at airsci.com (dman)
Date: Thu, 14 Jul 2011 15:31:16 -0700 (PDT)
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
Message-ID: <1310682676695-6585138.post@n2.nabble.com>

@SM - I am in fact using 2.13.1 and will look into the image() call. The code
should be attached, here it is again 
http://r-sig-geo.2731867.n2.nabble.com/file/n6585138/dist_1km_code.jpg  

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585138.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From dkennedy at airsci.com  Fri Jul 15 01:07:47 2011
From: dkennedy at airsci.com (dman)
Date: Thu, 14 Jul 2011 16:07:47 -0700 (PDT)
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <1310682676695-6585138.post@n2.nabble.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
Message-ID: <1310684867194-6585234.post@n2.nabble.com>

Ah-ha, 

NA's are the cells outside my mask. 

Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster looks
fine.

D

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585234.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 15 02:19:49 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 14 Jul 2011 17:19:49 -0700 (PDT)
Subject: [R-sig-Geo] plot3D raster coordinates
In-Reply-To: <CALjAYt6M9SaD3J+GeAbSOZBRvdw=ABeO2zcWYkvfQscND7m-UQ@mail.gmail.com>
References: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>
	<CALjAYt6cvwUtze=kb0Z=X9YSFR=h9t=xDETPHQtbbTCd0gvh2w@mail.gmail.com>
	<CALjAYt6M9SaD3J+GeAbSOZBRvdw=ABeO2zcWYkvfQscND7m-UQ@mail.gmail.com>
Message-ID: <1310689189528-6585449.post@n2.nabble.com>

> (plot3D is in fact in the rasterVis package now) 
>
> There's an adjustment factor additional to the zfac parameter. It is 
> impossible to override it. The solution I've found is to comment these
> lines 
> and run the function under another name (these lines are present 2 times). 
>
>#         adj <- zlen/min(ylen,xlen) 
>#         X <- X * adj * zfac 
>#         Y <- Y * adj * zfac
>
>If you need to keep the zfac, I'd suggest to put it directly on Z. 
>Z <- t((getValues(x, format='matrix'))[nrow(x):1,]) * zfac 
>
>I'd be curious to hear why is the z scaling factor is applied in that 
>fashion. 

The zfac could be changed, but I think the main issue is the "adj" factor
that scales the x, y and z values to get a nice 3D plot. It may be possible
to do this differently, and I will try to do that; I had overlooked this
problem (of wrong coordinates on the axis, and not being able to correctly
plot vector data on top). Thanks for pointing this out, 

Robert 


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plot3D-raster-coordinates-tp6558234p6585449.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 15 02:29:34 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 14 Jul 2011 17:29:34 -0700 (PDT)
Subject: [R-sig-Geo] plotting geographic coordinates on a map
In-Reply-To: <1310657764042-6583747.post@n2.nabble.com>
References: <1310657764042-6583747.post@n2.nabble.com>
Message-ID: <1310689774486-6585473.post@n2.nabble.com>

> I simply would like to plot these on a map of the US. I've tried all sorts
of approaches, including 
>> map('usa', project='albers', par=c(39,34)) 
>> points(x=data$LONGITUDE, y=data$LATITUTUDE, col='red') 

You are plotting longitude/latitude data on an map with Albers projection.
Won't give you what you want. 
Either transform the long/lat data to Albers (with the right parameters),
e.g. using spTransform (rgdal package), or do:

library(maps)
map('usa') 
points(x=data$LONGITUDE, y=data$LATITUTUDE, col='red') 

#You can have a look at the difference in coordinates like this
map('usa') 
locator(1) # click on the center of the map
map('usa', project='albers') 
locator(1) # click on the center of the map


>> library(sp) 
>> coordinates(WNV) <- c("latitude", "longitude") 
>> map('world') 
>> plot(WNV$latitude, WNV$longitude) 

Instead, do:

map('world') 
plot(WNV, add=TRUE) 
#or
points(WNV)

Hth, Robert



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-geographic-coordinates-on-a-map-tp6583747p6585473.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 15 02:40:31 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 14 Jul 2011 17:40:31 -0700 (PDT)
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <1310684867194-6585234.post@n2.nabble.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
Message-ID: <1310690431480-6585499.post@n2.nabble.com>

> Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster
looks fine. 

When plotting a Raster* object, raster calls the 'image' function. spplot
uses 'levelplot'. Both are affected by these white lines in R 2.13.1 on
Windows, I think (anyone seeing this on Mac or Linux? or not seeing this on
Windows?). Here is a simple test:

image(t(volcano)[ncol(volcano):1,])

In some cases there are only lines such that it seems that there are no data
values. I would expect that this will be fixed soon, but I am changing
'raster' so that the next version calls 'rasterImage' (which is not affected
and should be more efficient) in stead of 'image'.

Please correct me if I am wrong, but I think that for now one should not use
R 2.13.1 on Windows (and perhaps other OSs) if you want to plot raster data. 
Robert

> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: i386-pc-mingw32/i386 (32-bit)


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585499.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From adamhsparks at gmail.com  Fri Jul 15 02:48:43 2011
From: adamhsparks at gmail.com (Adam Sparks)
Date: Fri, 15 Jul 2011 08:48:43 +0800
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <1310690431480-6585499.post@n2.nabble.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
	<1310690431480-6585499.post@n2.nabble.com>
Message-ID: <CAJmQPwFD8P4-86_wub2wkFaL-1J3deUmyUCgSKhZQ77gjJSieQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110715/3c8e1cb9/attachment.pl>

From mdsumner at gmail.com  Fri Jul 15 02:54:23 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 15 Jul 2011 10:54:23 +1000
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <1310690431480-6585499.post@n2.nabble.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
	<1310690431480-6585499.post@n2.nabble.com>
Message-ID: <CAAcGz9-kqAMJ=dC1pQ3O=20pN34Xo6o2dBbbsD35jJJVGgj+ng@mail.gmail.com>

I see the same on Windows 7 64-bit, with 32-bit R and 64bit R.

There's no need for the transpose/flip btw:

image(volcano)

but raster graphics don't product it, so it's the underlying image C
code (which is rect under the hood)

image(volcano, useRaster = TRUE)

plot(0, xlim = c(0, 1), ylim = c(0, 1))

rasterImage((volcano - min(volcano, na.rm = TRUE)) /
diff(range(volcano, na.rm = TRUE)), 0, 0, 1, 1, interpolate = FALSE)

plot(0, xlim = c(0, 1), ylim = c(0, 1))

rasterImage((volcano - min(volcano, na.rm = TRUE)) /
diff(range(volcano, na.rm = TRUE)), 0, 0, 1, 1)

I'd like to investigate more, but will have to wait for now.

Cheers, Mike.


On Fri, Jul 15, 2011 at 10:40 AM, Robert Hijmans <r.hijmans at gmail.com> wrote:
>> Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster
> looks fine.
>
> When plotting a Raster* object, raster calls the 'image' function. spplot
> uses 'levelplot'. Both are affected by these white lines in R 2.13.1 on
> Windows, I think (anyone seeing this on Mac or Linux? or not seeing this on
> Windows?). Here is a simple test:
>
> image(t(volcano)[ncol(volcano):1,])
>
> In some cases there are only lines such that it seems that there are no data
> values. I would expect that this will be fixed soon, but I am changing
> 'raster' so that the next version calls 'rasterImage' (which is not affected
> and should be more efficient) in stead of 'image'.
>
> Please correct me if I am wrong, but I think that for now one should not use
> R 2.13.1 on Windows (and perhaps other OSs) if you want to plot raster data.
> Robert
>
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585499.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From r.hijmans at gmail.com  Fri Jul 15 03:16:07 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 14 Jul 2011 18:16:07 -0700 (PDT)
Subject: [R-sig-Geo] classify a raster by unique value
In-Reply-To: <CA+GC7G48Z2k3Xn5RknR7aEBPE6GsmGgvfCW-S=1aqgAX5fkHCw@mail.gmail.com>
References: <CA+GC7G48Z2k3Xn5RknR7aEBPE6GsmGgvfCW-S=1aqgAX5fkHCw@mail.gmail.com>
Message-ID: <1310692567465-6585606.post@n2.nabble.com>

> I've a raster stack with 3 layers. 
> 
> I need to classify it assigning one class to each unique combination of
> values. 

Perhaps the below works. It may be very slow if unq has many rows. 

unq <- unique(as.matrix(data_stack)) 

fun  <- function(x, ...) {
	r <- rep(NA, nrow(x))
	for (i in 1:nrow(unq)) {
		r[ which(apply(x == unq[i,], 1, sum) == ncol(unq)) ] <- i
	}
	r
}

x  <- calc(data_stack, fun)


Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/classify-a-raster-by-unique-value-tp6575119p6585606.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lestes at princeton.edu  Fri Jul 15 03:32:41 2011
From: lestes at princeton.edu (Lyndon Estes)
Date: Thu, 14 Jul 2011 21:32:41 -0400
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <CAAcGz9-kqAMJ=dC1pQ3O=20pN34Xo6o2dBbbsD35jJJVGgj+ng@mail.gmail.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
	<1310690431480-6585499.post@n2.nabble.com>
	<CAAcGz9-kqAMJ=dC1pQ3O=20pN34Xo6o2dBbbsD35jJJVGgj+ng@mail.gmail.com>
Message-ID: <CALuVVab8xZTr3gktzRg=giSH0++AzTdpXq-6FR_y_+LyQOs_bA@mail.gmail.com>

Hi Robert,

On my Mac the plot displays fine with no lines.

R version 2.13.1 (2011-07-08)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)
[13] raster_1.8-39      sp_0.9-83

Cheers, Lyndon


On Thu, Jul 14, 2011 at 8:54 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> I see the same on Windows 7 64-bit, with 32-bit R and 64bit R.
>
> There's no need for the transpose/flip btw:
>
> image(volcano)
>
> but raster graphics don't product it, so it's the underlying image C
> code (which is rect under the hood)
>
> image(volcano, useRaster = TRUE)
>
> plot(0, xlim = c(0, 1), ylim = c(0, 1))
>
> rasterImage((volcano - min(volcano, na.rm = TRUE)) /
> diff(range(volcano, na.rm = TRUE)), 0, 0, 1, 1, interpolate = FALSE)
>
> plot(0, xlim = c(0, 1), ylim = c(0, 1))
>
> rasterImage((volcano - min(volcano, na.rm = TRUE)) /
> diff(range(volcano, na.rm = TRUE)), 0, 0, 1, 1)
>
> I'd like to investigate more, but will have to wait for now.
>
> Cheers, Mike.
>
>
> On Fri, Jul 15, 2011 at 10:40 AM, Robert Hijmans <r.hijmans at gmail.com> wrote:
>>> Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster
>> looks fine.
>>
>> When plotting a Raster* object, raster calls the 'image' function. spplot
>> uses 'levelplot'. Both are affected by these white lines in R 2.13.1 on
>> Windows, I think (anyone seeing this on Mac or Linux? or not seeing this on
>> Windows?). Here is a simple test:
>>
>> image(t(volcano)[ncol(volcano):1,])
>>
>> In some cases there are only lines such that it seems that there are no data
>> values. I would expect that this will be fixed soon, but I am changing
>> 'raster' so that the next version calls 'rasterImage' (which is not affected
>> and should be more efficient) in stead of 'image'.
>>
>> Please correct me if I am wrong, but I think that for now one should not use
>> R 2.13.1 on Windows (and perhaps other OSs) if you want to plot raster data.
>> Robert
>>
>>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>>
>>
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585499.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Lyndon Estes
Research Associate
Woodrow Wilson School
Princeton University
+1-609-258-2392 (o)
+1-609-258-6082 (f)
+1-202-431-0496 (m)
lestes at princeton.edu


From lee.kitty at yahoo.com  Fri Jul 15 04:36:32 2011
From: lee.kitty at yahoo.com (Kitty Lee)
Date: Thu, 14 Jul 2011 19:36:32 -0700 (PDT)
Subject: [R-sig-Geo] Fill in empty links with nearest neighbors
Message-ID: <1310697392.59857.YahooMailClassic@web36304.mail.mud.yahoo.com>

Hi. I have a shapefile. I guess because of cartography problem, the border of some of the units that are supposed to be physically connected are 'snapped' properly. As a result, when I use poly2nb, there are empty links. 

I know I can set zero.policy=T in nb2listw. But I'm trying to use skater() function. I notice that it won't accept spatial weight matrix with empty link.

Any advice on how can I easily fix the matrix? Is there a way I can fill in empty link with nearest neighbors? 

I'd really appreciate advice on how to manually tweak the connectivity matrix.

Thanks in advance!

K.


From renaud.lancelot at cirad.fr  Fri Jul 15 09:51:35 2011
From: renaud.lancelot at cirad.fr (lancelot)
Date: Fri, 15 Jul 2011 09:51:35 +0200
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <1310690431480-6585499.post@n2.nabble.com>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
	<1310690431480-6585499.post@n2.nabble.com>
Message-ID: <4E1FF187.9000903@cirad.fr>

Dear Robert,

Working with:

 > sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
[3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
[5] LC_TIME=French_France.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_1.8-42  sp_0.9-84      fortunes_1.4-2

loaded via a namespace (and not attached):
[1] grid_2.13.1     lattice_0.19-30 tools_2.13.1


The issue is not specific to the GUI. I also see it with Rterm. I'm 
seeing the white lines on the windows() device (screen), as well as on 
jpeg, png, and postscript devices (though much finer lines for the 
latter). Conversely, pdf outputs don't seen to have the problem (also 
tested with other raster images).

All the best,

Renaud




Le 15/07/2011 02:40, Robert Hijmans a ?crit :
>> Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster
> looks fine.
>
> When plotting a Raster* object, raster calls the 'image' function. spplot
> uses 'levelplot'. Both are affected by these white lines in R 2.13.1 on
> Windows, I think (anyone seeing this on Mac or Linux? or not seeing this on
> Windows?). Here is a simple test:
>
> image(t(volcano)[ncol(volcano):1,])
>
> In some cases there are only lines such that it seems that there are no data
> values. I would expect that this will be fixed soon, but I am changing
> 'raster' so that the next version calls 'rasterImage' (which is not affected
> and should be more efficient) in stead of 'image'.
>
> Please correct me if I am wrong, but I think that for now one should not use
> R 2.13.1 on Windows (and perhaps other OSs) if you want to plot raster data.
> Robert
>
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585499.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Renaud Lancelot
EDENext Project, coordinator: http://www.edenext.eu/

CIRAD, UMR15, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From atlasrrg at gmail.com  Fri Jul 15 10:05:57 2011
From: atlasrrg at gmail.com (atlasrrg)
Date: Fri, 15 Jul 2011 01:05:57 -0700 (PDT)
Subject: [R-sig-Geo] plotting geographic coordinates on a map
In-Reply-To: <1310689774486-6585473.post@n2.nabble.com>
References: <1310657764042-6583747.post@n2.nabble.com>
	<1310689774486-6585473.post@n2.nabble.com>
Message-ID: <1310717157455-6586184.post@n2.nabble.com>

Thank you Ashton for your response. I mistyped in the email; it wasn't a
problem with the capitalization.

Robert, I closed everything out and began anew with your first set of
instruction. That worked perfectly. 

Thank you so much for your help! 

Best,

Rebecca

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plotting-geographic-coordinates-on-a-map-tp6583747p6586184.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From matevz.pavlic at gi-zrmk.si  Fri Jul 15 10:23:36 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Fri, 15 Jul 2011 10:23:36 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <4E1F5E9A.10409@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>
	<4E1F5E9A.10409@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>

Hi, thanks for your time....

I am sure the problem is in same locations...but i dont know why remove.duplicates() does not remove duplicates... 
When i try this :

>coordinates(DF)<-~X+Y
> zerodist(DF)
     [,1] [,2]
[1,]   83   84
[2,]  242  243
[3,]  266  267
[4,]  431  432
[5,]  439  440
[6,]  731  732
[7,]  817  818
[8,]  820  821

>remove.duplicates(DF, zero=0, remove.second = TRUE)
...
1113 (99447.1, 459012)     7019   290.17   286.57      6
1114 (99465.2, 458975)     7022   291.97   287.27      0
1115   (99410, 458997)     7015   291.04   288.74      6
1116   (99495, 458978)     7016   290.62   288.72      6
1117 (99438.3, 458992)     7018   291.28   288.38      6
1118   (99813, 458891)     7021   290.08   285.58      0

> zerodist(DF)
     [,1] [,2]
[1,]   83   84
[2,]  242  243
[3,]  266  267
[4,]  431  432
[5,]  439  440
[6,]  731  732
[7,]  817  818
[8,]  820  821

it stays the same...shouln't it remove the duplicates?


thanks, m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Thursday, July 14, 2011 11:25 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

The error message is an indication that you're predicting (kriging) with a singular covariance matrix. The most frequent reasons for this are duplicate observations [1] or perfect correlation in the coregionalization model [2]. For [1], see ?remove.duplicates, for [2] see argument correct.diagonal in ?fit.lmc.

On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
> Hi all,
> 
>  
> 
> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 
> 
>  
> 
> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
> 
>  
> 
> I got this code (mostly) from the net, so i have some trouble understanding it...
> 
>  
> 
> thanks for any help and info about categorical kriging,
> 
>  
> 
> m
> 
>  
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From educheyne at avia-gis.be  Fri Jul 15 10:33:33 2011
From: educheyne at avia-gis.be (Els Ducheyne)
Date: Fri, 15 Jul 2011 10:33:33 +0200
Subject: [R-sig-Geo] Long time listener, first time caller
In-Reply-To: <4E1FF187.9000903@cirad.fr>
References: <3B6417D8-128C-4529-81A7-D270193B9B92@airsci.com>
	<CAFFLneRJ+o12pNX0-uYB-CDGFyHX7uz4u87-Ui8PqhsjBFMLrw@mail.gmail.com>
	<1310682676695-6585138.post@n2.nabble.com>
	<1310684867194-6585234.post@n2.nabble.com>
	<1310690431480-6585499.post@n2.nabble.com>
	<4E1FF187.9000903@cirad.fr>
Message-ID: <C6C0DA01-59AD-416A-891D-278D4A04ABDB@avia-gis.be>

Dear Robert
i have tested using our example and it seems to work fine on mac

Best
On 15 Jul 2011, at 09:51, lancelot wrote:

> Dear Robert,
> 
> Working with:
> 
> > sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: i386-pc-mingw32/i386 (32-bit)
> 
> locale:
> [1] LC_COLLATE=French_France.1252  LC_CTYPE=French_France.1252
> [3] LC_MONETARY=French_France.1252 LC_NUMERIC=C
> [5] LC_TIME=French_France.1252
> 
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> 
> other attached packages:
> [1] raster_1.8-42  sp_0.9-84      fortunes_1.4-2
> 
> loaded via a namespace (and not attached):
> [1] grid_2.13.1     lattice_0.19-30 tools_2.13.1
> 
> 
> The issue is not specific to the GUI. I also see it with Rterm. I'm seeing the white lines on the windows() device (screen), as well as on jpeg, png, and postscript devices (though much finer lines for the latter). Conversely, pdf outputs don't seen to have the problem (also tested with other raster images).
> 
> All the best,
> 
> Renaud
> 
> 
> 
> 
> Le 15/07/2011 02:40, Robert Hijmans a ?crit :
>>> Lines appear to be a GUI issue, went back to 2.13.0 and plot of raster
>> looks fine.
>> 
>> When plotting a Raster* object, raster calls the 'image' function. spplot
>> uses 'levelplot'. Both are affected by these white lines in R 2.13.1 on
>> Windows, I think (anyone seeing this on Mac or Linux? or not seeing this on
>> Windows?). Here is a simple test:
>> 
>> image(t(volcano)[ncol(volcano):1,])
>> 
>> In some cases there are only lines such that it seems that there are no data
>> values. I would expect that this will be fixed soon, but I am changing
>> 'raster' so that the next version calls 'rasterImage' (which is not affected
>> and should be more efficient) in stead of 'image'.
>> 
>> Please correct me if I am wrong, but I think that for now one should not use
>> R 2.13.1 on Windows (and perhaps other OSs) if you want to plot raster data.
>> Robert
>> 
>>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: i386-pc-mingw32/i386 (32-bit)
>> 
>> 
>> --
>> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-tp6585078p6585499.html
>> Sent from the R-sig-geo mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Renaud Lancelot
> EDENext Project, coordinator: http://www.edenext.eu/
> 
> CIRAD, UMR15, Campus International de Baillarguet TA A-DIR / B
> F34398 Montpellier
> 
> Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
> Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Fri Jul 15 11:15:23 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 15 Jul 2011 11:15:23 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>	<4E1F5E9A.10409@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>
Message-ID: <4E20052B.9030208@uni-muenster.de>

to remove duplicates in DF you need to replace it:

DF = remove.duplicates(DF, zero=0, remove.second = TRUE)
zerodist(DF)

On 07/15/2011 10:23 AM, Matev? Pavli? wrote:
> Hi, thanks for your time....
> 
> I am sure the problem is in same locations...but i dont know why remove.duplicates() does not remove duplicates... 
> When i try this :
> 
>> coordinates(DF)<-~X+Y
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
>> remove.duplicates(DF, zero=0, remove.second = TRUE)
> ...
> 1113 (99447.1, 459012)     7019   290.17   286.57      6
> 1114 (99465.2, 458975)     7022   291.97   287.27      0
> 1115   (99410, 458997)     7015   291.04   288.74      6
> 1116   (99495, 458978)     7016   290.62   288.72      6
> 1117 (99438.3, 458992)     7018   291.28   288.38      6
> 1118   (99813, 458891)     7021   290.08   285.58      0
> 
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
> it stays the same...shouln't it remove the duplicates?
> 
> 
> thanks, m
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Thursday, July 14, 2011 11:25 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] predict() LDL error
> 
> The error message is an indication that you're predicting (kriging) with a singular covariance matrix. The most frequent reasons for this are duplicate observations [1] or perfect correlation in the coregionalization model [2]. For [1], see ?remove.duplicates, for [2] see argument correct.diagonal in ?fit.lmc.
> 
> On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 
>>
>>  
>>
>> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
>>
>>  
>>
>> I got this code (mostly) from the net, so i have some trouble understanding it...
>>
>>  
>>
>> thanks for any help and info about categorical kriging,
>>
>>  
>>
>> m
>>
>>  
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From alobolistas at gmail.com  Fri Jul 15 12:10:48 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 15 Jul 2011 12:10:48 +0200
Subject: [R-sig-Geo] raster: croping and aggregating
Message-ID: <CAG4NReLgQjK5oeZFCcC2Gxoxx0sx-SvuAawppKEUWWdH6-gKgQ@mail.gmail.com>

I have 2 raster objects

> show(CODEQP)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 438048.4, 439048.4, 4633415, 4634415  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=31 +ellps=intl +units=m +no_defs
values      : in memory
min value   : 1
max value   : 1

> dem = raster("mde10mny.tif")
> show(dem)
class       : RasterLayer
dimensions  : 2333, 2788, 6504404  (nrow, ncol, ncell)
resolution  : 10, 10  (x, y)
extent      : 435926.9, 463806.9, 4613063, 4636393  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : /media/Iomega_HDD/DIPU2011/RVISITANTS/mde10mny.tif
min         : ?
max         : ?

and want to make a thrid object "dem100" perfectly aligned to CODEQP.

I've tried with crop() but, as noted in the help page, the input
extent is actually modified to get aligned to the input
raster pixels and I actually would like the opposite:

> dem100 = crop(dem,extent(CODEQP))
> show(dem100)
class       : RasterLayer
dimensions  : 100, 100, 10000  (nrow, ncol, ncell)
resolution  : 10, 10  (x, y)
extent      : 438046.9, 439046.9, 4633413, 4634413  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : in memory
min value   : 549.4215
max value   : 627.9377

> show(CODEQP)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 438048.4, 439048.4, 4633415, 4634415  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=utm +zone=31 +ellps=intl +units=m +no_defs
values      : in memory
min value   : 1
max value   : 1

Note they are not identical.

Is there any way (besides using grass from within R) to get dem100 to
have the same geometry (extent and pixel size) than CODEQP?

Thanks

Agus


From alobolistas at gmail.com  Fri Jul 15 13:00:55 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 15 Jul 2011 13:00:55 +0200
Subject: [R-sig-Geo] create raster using extent and resolution?
Message-ID: <CAG4NReJLQ7nYtNQdjNdJusF2fywzCAbGKeeUibReMoXVCPM-xg@mail.gmail.com>

Hi!

Is it possible to create a raster object using extent and resolution,
thus having
raster() to calculate the required nb. of rows and columns? Something like,

a = raster (ext=miextent, res=100)

(Obviously the nb. of pixels would have to be rounded)

Thanks!

Agus


From b.rowlingson at lancaster.ac.uk  Fri Jul 15 13:27:51 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 15 Jul 2011 12:27:51 +0100
Subject: [R-sig-Geo] create raster using extent and resolution?
In-Reply-To: <CAG4NReJLQ7nYtNQdjNdJusF2fywzCAbGKeeUibReMoXVCPM-xg@mail.gmail.com>
References: <CAG4NReJLQ7nYtNQdjNdJusF2fywzCAbGKeeUibReMoXVCPM-xg@mail.gmail.com>
Message-ID: <CANVKczN7q2G34W8Fez4eRUhxbrGDy+u32Lp+XAFfZ1OB72WXhw@mail.gmail.com>

On Fri, Jul 15, 2011 at 12:00 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Hi!
>
> Is it possible to create a raster object using extent and resolution,
> thus having
> raster() to calculate the required nb. of rows and columns? Something like,
>
> a = raster (ext=miextent, res=100)
>
> (Obviously the nb. of pixels would have to be rounded)

In two steps: create the raster and then set the resolution using "res<-"

> e
class       : Extent
xmin        : 178400
xmax        : 181600
ymin        : 329400
ymax        : 334000
> a = raster(e); res(a)=c(100,100)
> a
class       : RasterLayer
dimensions  : 46, 32, 1472  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : none

- it chooses the dimensions, rounding if necessary.

Barry


From b.rowlingson at lancaster.ac.uk  Fri Jul 15 14:09:26 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 15 Jul 2011 13:09:26 +0100
Subject: [R-sig-Geo] raster: croping and aggregating
In-Reply-To: <CAG4NReLgQjK5oeZFCcC2Gxoxx0sx-SvuAawppKEUWWdH6-gKgQ@mail.gmail.com>
References: <CAG4NReLgQjK5oeZFCcC2Gxoxx0sx-SvuAawppKEUWWdH6-gKgQ@mail.gmail.com>
Message-ID: <CANVKczO_1gWYaF2XEugQGL_Zj1b5rieTWAysk4a3gF2pnWMkEg@mail.gmail.com>

On Fri, Jul 15, 2011 at 11:10 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> I have 2 raster objects
>
>> show(CODEQP)
> class ? ? ? : RasterLayer
> dimensions ?: 10, 10, 100 ?(nrow, ncol, ncell)
> resolution ?: 100, 100 ?(x, y)
> extent ? ? ?: 438048.4, 439048.4, 4633415, 4634415 ?(xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=31 +ellps=intl +units=m +no_defs
> values ? ? ?: in memory
> min value ? : 1
> max value ? : 1
>
>> dem = raster("mde10mny.tif")
>> show(dem)
> class ? ? ? : RasterLayer
> dimensions ?: 2333, 2788, 6504404 ?(nrow, ncol, ncell)
> resolution ?: 10, 10 ?(x, y)
> extent ? ? ?: 435926.9, 463806.9, 4613063, 4636393 ?(xmin, xmax, ymin, ymax)
> coord. ref. : NA
> values ? ? ?: /media/Iomega_HDD/DIPU2011/RVISITANTS/mde10mny.tif
> min ? ? ? ? : ?
> max ? ? ? ? : ?
>
> and want to make a thrid object "dem100" perfectly aligned to CODEQP.
>
> I've tried with crop() but, as noted in the help page, the input
> extent is actually modified to get aligned to the input
> raster pixels and I actually would like the opposite:
>
>> dem100 = crop(dem,extent(CODEQP))
>> show(dem100)
> class ? ? ? : RasterLayer
> dimensions ?: 100, 100, 10000 ?(nrow, ncol, ncell)
> resolution ?: 10, 10 ?(x, y)
> extent ? ? ?: 438046.9, 439046.9, 4633413, 4634413 ?(xmin, xmax, ymin, ymax)
> coord. ref. : NA
> values ? ? ?: in memory
> min value ? : 549.4215
> max value ? : 627.9377
>
>> show(CODEQP)
> class ? ? ? : RasterLayer
> dimensions ?: 10, 10, 100 ?(nrow, ncol, ncell)
> resolution ?: 100, 100 ?(x, y)
> extent ? ? ?: 438048.4, 439048.4, 4633415, 4634415 ?(xmin, xmax, ymin, ymax)
> coord. ref. : +proj=utm +zone=31 +ellps=intl +units=m +no_defs
> values ? ? ?: in memory
> min value ? : 1
> max value ? : 1
>
> Note they are not identical.
>
> Is there any way (besides using grass from within R) to get dem100 to
> have the same geometry (extent and pixel size) than CODEQP?

 I think that doing a crop() can only return cells that are directly
taken from the input raster. Your CODEQP raster doesn't align to the
dem raster, so what you want is not a crop but will involve some kind
of interpolation, as your target extent cells overlap more than one
input raster cells.

 Possibly extract() will do it?

Barry


From etiennebr at gmail.com  Fri Jul 15 15:46:27 2011
From: etiennebr at gmail.com (Etienne B. Racine)
Date: Fri, 15 Jul 2011 09:46:27 -0400
Subject: [R-sig-Geo] plot3D raster coordinates
In-Reply-To: <1310689189528-6585449.post@n2.nabble.com>
References: <CALjAYt4NcpYfgtN1-v-tKD77Tf845Z_mmcmO_-+QJWKMG7LbCg@mail.gmail.com>
	<CALjAYt6cvwUtze=kb0Z=X9YSFR=h9t=xDETPHQtbbTCd0gvh2w@mail.gmail.com>
	<CALjAYt6M9SaD3J+GeAbSOZBRvdw=ABeO2zcWYkvfQscND7m-UQ@mail.gmail.com>
	<1310689189528-6585449.post@n2.nabble.com>
Message-ID: <CALjAYt5BOvri0jw_Ah6U4W8bHByZuC==P=3xCRBkE0_BR9OjnA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110715/40a48820/attachment.pl>

From r.hijmans at gmail.com  Fri Jul 15 16:22:25 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 15 Jul 2011 07:22:25 -0700 (PDT)
Subject: [R-sig-Geo] classify a raster by unique value
In-Reply-To: <1310692567465-6585606.post@n2.nabble.com>
References: <CA+GC7G48Z2k3Xn5RknR7aEBPE6GsmGgvfCW-S=1aqgAX5fkHCw@mail.gmail.com>
	<1310692567465-6585606.post@n2.nabble.com>
Message-ID: <1310739745136-6587070.post@n2.nabble.com>


>> I've a raster stack with 3 layers. 
>> 
>> I need to classify it assigning one class to each unique combination of
>> values. 

> Perhaps the below works. It may be very slow if unq has many rows. 

That was not quite right, I think it works when you do:

unq <- unique(as.matrix(data_stack)) 

fun  <- function(x, ...) { 
        r <- rep(NA, nrow(x)) 
        for (i in 1:nrow(unq)) { 
                r[ which(apply(t(x) == unq[i,], 2, sum) == ncol(unq)) ] <- i 
        } 
        r 
} 

x  <- calc(data_stack, fun) 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/classify-a-raster-by-unique-value-tp6575119p6587070.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 15 16:25:03 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 15 Jul 2011 07:25:03 -0700
Subject: [R-sig-Geo] raster: croping and aggregating
In-Reply-To: <CANVKczO_1gWYaF2XEugQGL_Zj1b5rieTWAysk4a3gF2pnWMkEg@mail.gmail.com>
References: <CAG4NReLgQjK5oeZFCcC2Gxoxx0sx-SvuAawppKEUWWdH6-gKgQ@mail.gmail.com>
	<CANVKczO_1gWYaF2XEugQGL_Zj1b5rieTWAysk4a3gF2pnWMkEg@mail.gmail.com>
Message-ID: <CANtt_hy6XzLB9FkkUi9Dw_s_wQcn789xzPzbodW4wR8Jw8vpUA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110715/dbdf0326/attachment.pl>

From alobolistas at gmail.com  Fri Jul 15 21:12:07 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 15 Jul 2011 21:12:07 +0200
Subject: [R-sig-Geo] create raster using extent and resolution?
In-Reply-To: <CANVKczN7q2G34W8Fez4eRUhxbrGDy+u32Lp+XAFfZ1OB72WXhw@mail.gmail.com>
References: <CAG4NReJLQ7nYtNQdjNdJusF2fywzCAbGKeeUibReMoXVCPM-xg@mail.gmail.com>
	<CANVKczN7q2G34W8Fez4eRUhxbrGDy+u32Lp+XAFfZ1OB72WXhw@mail.gmail.com>
Message-ID: <CAG4NReJ5A8LZGh7+dyx5m+GJ_refJTAcfU1hJE5Ozaojyd3rfw@mail.gmail.com>

Barry,

I tried that first, but by some reason (my raster version?), the
result here is different than yours:
> CODEQP <- raster(extent(PNMlimit))
> show(CODEQP)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 2586.382, 1886.275  (x, y)
extent      : 438048.4, 463912.3, 4615552, 4634415  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : none

> res(CODEQP)<-c(100,100)
> show(CODEQP)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 438048.4, 439048.4, 4633415, 4634415  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : none

Note res() keeps the same nb. of pixels and changes (a lot) the extent.
In your example:
> a = raster(e)
> show(a)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 320, 460  (x, y)
extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : none

> res(a)=c(100,100)
> show(a)
class       : RasterLayer
dimensions  : 10, 10, 100  (nrow, ncol, ncell)
resolution  : 100, 100  (x, y)
extent      : 178400, 179400, 333000, 334000  (xmin, xmax, ymin, ymax)
coord. ref. : NA
values      : none

Agus

> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: i486-pc-linux-gnu (32-bit)

locale:
 [1] LC_CTYPE=en_US.UTF-8          LC_NUMERIC=C
LC_TIME=en_US.UTF-8
 [4] LC_COLLATE=en_US.UTF-8        LC_MONETARY=en_US.UTF-8
LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8          LC_NAME=en_US.UTF-8
LC_ADDRESS=en_US.UTF-8
[10] LC_TELEPHONE=en_US.UTF-8      LC_MEASUREMENT=en_US.UTF-8
LC_IDENTIFICATION=en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-31  raster_1.8-42 sp_0.9-83     rkward_0.5.6

loaded via a namespace (and not attached):
[1] grid_2.13.1     lattice_0.19-30 tools_2.13.1


Agus


2011/7/15 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>:
> On Fri, Jul 15, 2011 at 12:00 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Hi!
>>
>> Is it possible to create a raster object using extent and resolution,
>> thus having
>> raster() to calculate the required nb. of rows and columns? Something like,
>>
>> a = raster (ext=miextent, res=100)
>>
>> (Obviously the nb. of pixels would have to be rounded)
>
> In two steps: create the raster and then set the resolution using "res<-"
>
>> e
> class ? ? ? : Extent
> xmin ? ? ? ?: 178400
> xmax ? ? ? ?: 181600
> ymin ? ? ? ?: 329400
> ymax ? ? ? ?: 334000
>> a = raster(e); res(a)=c(100,100)
>> a
> class ? ? ? : RasterLayer
> dimensions ?: 46, 32, 1472 ?(nrow, ncol, ncell)
> resolution ?: 100, 100 ?(x, y)
> extent ? ? ?: 178400, 181600, 329400, 334000 ?(xmin, xmax, ymin, ymax)
> coord. ref. : NA
> values ? ? ?: none
>
> - it chooses the dimensions, rounding if necessary.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Fri Jul 15 21:24:58 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Fri, 15 Jul 2011 12:24:58 -0700
Subject: [R-sig-Geo] create raster using extent and resolution?
In-Reply-To: <CAG4NReJ5A8LZGh7+dyx5m+GJ_refJTAcfU1hJE5Ozaojyd3rfw@mail.gmail.com>
References: <CAG4NReJLQ7nYtNQdjNdJusF2fywzCAbGKeeUibReMoXVCPM-xg@mail.gmail.com>
	<CANVKczN7q2G34W8Fez4eRUhxbrGDy+u32Lp+XAFfZ1OB72WXhw@mail.gmail.com>
	<CAG4NReJ5A8LZGh7+dyx5m+GJ_refJTAcfU1hJE5Ozaojyd3rfw@mail.gmail.com>
Message-ID: <CANtt_hyYmXKZW0H8=qCLx16XRpP48reEPtPG1=JXKt+zCkrHDA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110715/adb074e4/attachment.pl>

From r.aluizio at gmail.com  Sat Jul 16 14:55:36 2011
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Sat, 16 Jul 2011 09:55:36 -0300
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
Message-ID: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110716/ca6b87e4/attachment.pl>

From roman.lustrik at gmail.com  Sat Jul 16 15:02:32 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 16 Jul 2011 15:02:32 +0200
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
In-Reply-To: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
Message-ID: <CAHT1vphE1bcXSOOVm-Wg8nEeJOt=a2Bsq4uxidhDZ+jJFWF8-A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110716/683299b9/attachment.pl>

From edzer.pebesma at uni-muenster.de  Sat Jul 16 15:09:14 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sat, 16 Jul 2011 15:09:14 +0200
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
In-Reply-To: <CAHT1vphE1bcXSOOVm-Wg8nEeJOt=a2Bsq4uxidhDZ+jJFWF8-A@mail.gmail.com>
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
	<CAHT1vphE1bcXSOOVm-Wg8nEeJOt=a2Bsq4uxidhDZ+jJFWF8-A@mail.gmail.com>
Message-ID: <4E218D7A.70902@uni-muenster.de>

Although I can't reproduce the problem on my Ubuntu laptop,

https://stat.ethz.ch/pipermail/r-help/2011-July/283568.html

suggests 2.13.1 introduced a problem with image(), which is out of "our"
hands (ie. cannot be fixed by the developers of spatial packages)

Let me know if you see this differently,

On 07/16/2011 03:02 PM, Roman Lu?trik wrote:
> I'm afraid that without seeing the script(s), it will be hard to pinpoint
> the problem.
> 
> Cheers,
> Roman
> 
> 
> 
> On Sat, Jul 16, 2011 at 2:55 PM, Rodrigo Aluizio <r.aluizio at gmail.com>wrote:
> 
>> Hi SIG List. I recently installed the new version of R (2.13.1, updated my
>> packages and checked the built). After that, I needed "replot" some maps I
>> had. Well, these maps were ok when plotted using the previous version of R
>> (2.13.0), but when I ran the same script in the new version the image
>> quality just get really low, almost incomprehensive (sometimes it doesn't
>> even appear). I would like to ask you, if this problem is just mine, or if
>> it's due to some kind of incompatibility between the new R release and some
>> of the packages I'm using? And, if the problem is local, how can I fix it?
>> Should I go back to R 2.13.0?
>>
>>
>>
>> Thank you for the attention, bellow is a link to an example of the actual
>> final output of the image {sp} function (for a SpatialGridDataFrame).
>>
>> P.s.: The GeoTIFF was imported using the readGDAL {rgdal} function.
>>
>>
>>
>> http://dl.dropbox.com/u/2613625/BaciaPotiguarGE.png
>>
>>
>>
>> sessionInfo()
>>
>> R version 2.13.1 (2011-07-08)
>>
>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>
>>
>>
>> locale:
>>
>> [1] LC_COLLATE=Portuguese_Brazil.1252
>>
>> [2] LC_CTYPE=Portuguese_Brazil.1252
>>
>> [3] LC_MONETARY=Portuguese_Brazil.1252
>>
>> [4] LC_NUMERIC=C
>>
>> [5] LC_TIME=Portuguese_Brazil.1252
>>
>>
>>
>> attached base packages:
>>
>> [1] grDevices datasets  splines   graphics  stats
>>
>> [6] tcltk     utils     methods   base
>>
>>
>>
>> other attached packages:
>>
>> [1] rgdal_0.7-1     maptools_0.8-9  lattice_0.19-30
>>
>> [4] sp_0.9-83       foreign_0.8-44  mapdata_2.1-4
>>
>>  [7] maps_2.1-6      RODBC_1.3-2     svSocket_0.9-51
>>
>> [10] TinnR_1.0.3     R2HTML_2.2      Hmisc_3.8-3
>>
>> [13] survival_2.36-9
>>
>>
>>
>> loaded via a namespace (and not attached):
>>
>> [1] cluster_1.14.0 grid_2.13.1    svMisc_0.9-61
>>
>> [4] tools_2.13.1
>>
>>
>>
>> -------------------------------------------------------------------
>>
>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>
>>
>>
>>
>>        [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From r.hijmans at gmail.com  Sat Jul 16 15:09:44 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Sat, 16 Jul 2011 06:09:44 -0700 (PDT)
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
In-Reply-To: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
Message-ID: <1310821784060-6589557.post@n2.nabble.com>

>when I ran the same script in the new version the image 
>quality just get really low, almost incomprehensive (sometimes it doesn't 
>even appear). I would like to ask you, if this problem is just mine, or if 
>it's due to some kind of incompatibility between the new R release and some 
>of the packages I'm using? 

It is a general problem; see the discussion here: 

http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-td6585078.html


>Should I go back to R 2.13.0? 

I think so

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Problems-Plotting-GeoTIFF-tp6589525p6589557.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.aluizio at gmail.com  Sat Jul 16 15:32:21 2011
From: r.aluizio at gmail.com (Rodrigo Aluizio)
Date: Sat, 16 Jul 2011 10:32:21 -0300
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
In-Reply-To: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
Message-ID: <CAJWMqFbCqqyz0X4J3RWvGptRb67KpqDM3D9+xL5GfebvFBXU0Q@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110716/2d9e4a66/attachment.pl>

From advaitgodbole at gmail.com  Sat Jul 16 21:27:56 2011
From: advaitgodbole at gmail.com (Advait Godbole)
Date: Sat, 16 Jul 2011 15:27:56 -0400
Subject: [R-sig-Geo] choosing spatial domain, islanding issue
Message-ID: <CAFdqCxvmE590+cpiC9VyTM_ZQWtmVH=qhpW=6Vi9GkfeX2r9YQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110716/592a059f/attachment.pl>

From cristhine.arj at gmail.com  Mon Jul 18 08:14:05 2011
From: cristhine.arj at gmail.com (CRISTINA ARJONA)
Date: Mon, 18 Jul 2011 08:14:05 +0200
Subject: [R-sig-Geo] PREGUNTA A LA LLISTA GEO-R
In-Reply-To: <CAKO7WnY0Qvwn0Lbrp4y0h4oV0rX28+6QoBszXukMd3UwKzmxjA@mail.gmail.com>
References: <CAKO7WnY0Qvwn0Lbrp4y0h4oV0rX28+6QoBszXukMd3UwKzmxjA@mail.gmail.com>
Message-ID: <CAKO7Wnb-DUdYMcr=90uJqVcwXRSkUjAdSaLypXdGMHW7k_q9Lg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/640ee279/attachment.pl>

From matevz.pavlic at gi-zrmk.si  Mon Jul 18 08:46:32 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Mon, 18 Jul 2011 08:46:32 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <4E20052B.9030208@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>	<4E1F5E9A.10409@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>
	<4E20052B.9030208@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si>

Hi Edzer, thanks for the help, 

i managed to use the predict() function now. But when I try to plot the predictions using spplot() i get this error :

"Error in parse(text = x) : <text>:1:3: unexpected symbol 1: 0.pred" 

Where 0.pred is the the prediction to plot. 

Does anyone has any ideas to what this could mean? I've searcehd the forum, but failed to get any answers. 

(attached is the code I use).

Thanks for  your time, m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Friday, July 15, 2011 11:15 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

to remove duplicates in DF you need to replace it:

DF = remove.duplicates(DF, zero=0, remove.second = TRUE)
zerodist(DF)

On 07/15/2011 10:23 AM, Matev? Pavli? wrote:
> Hi, thanks for your time....
> 
> I am sure the problem is in same locations...but i dont know why remove.duplicates() does not remove duplicates... 
> When i try this :
> 
>> coordinates(DF)<-~X+Y
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
>> remove.duplicates(DF, zero=0, remove.second = TRUE)
> ...
> 1113 (99447.1, 459012)     7019   290.17   286.57      6
> 1114 (99465.2, 458975)     7022   291.97   287.27      0
> 1115   (99410, 458997)     7015   291.04   288.74      6
> 1116   (99495, 458978)     7016   290.62   288.72      6
> 1117 (99438.3, 458992)     7018   291.28   288.38      6
> 1118   (99813, 458891)     7021   290.08   285.58      0
> 
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
> it stays the same...shouln't it remove the duplicates?
> 
> 
> thanks, m
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org 
> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Thursday, July 14, 2011 11:25 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] predict() LDL error
> 
> The error message is an indication that you're predicting (kriging) with a singular covariance matrix. The most frequent reasons for this are duplicate observations [1] or perfect correlation in the coregionalization model [2]. For [1], see ?remove.duplicates, for [2] see argument correct.diagonal in ?fit.lmc.
> 
> On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 
>>
>>  
>>
>> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
>>
>>  
>>
>> I got this code (mostly) from the net, so i have some trouble understanding it...
>>
>>  
>>
>> thanks for any help and info about categorical kriging,
>>
>>  
>>
>> m
>>
>>  
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From matevz.pavlic at gi-zrmk.si  Mon Jul 18 08:50:17 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Mon, 18 Jul 2011 08:50:17 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>	<4E1F5E9A.10409@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si><4E20052B.9030208@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D87E@gi-zrmk.si>

...and attachement...

r, m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Matev? Pavli?
Sent: Monday, July 18, 2011 8:47 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

Hi Edzer, thanks for the help, 

i managed to use the predict() function now. But when I try to plot the predictions using spplot() i get this error :

"Error in parse(text = x) : <text>:1:3: unexpected symbol 1: 0.pred" 

Where 0.pred is the the prediction to plot. 

Does anyone has any ideas to what this could mean? I've searcehd the forum, but failed to get any answers. 

(attached is the code I use).

Thanks for  your time, m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Friday, July 15, 2011 11:15 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

to remove duplicates in DF you need to replace it:

DF = remove.duplicates(DF, zero=0, remove.second = TRUE)
zerodist(DF)

On 07/15/2011 10:23 AM, Matev? Pavli? wrote:
> Hi, thanks for your time....
> 
> I am sure the problem is in same locations...but i dont know why remove.duplicates() does not remove duplicates... 
> When i try this :
> 
>> coordinates(DF)<-~X+Y
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
>> remove.duplicates(DF, zero=0, remove.second = TRUE)
> ...
> 1113 (99447.1, 459012)     7019   290.17   286.57      6
> 1114 (99465.2, 458975)     7022   291.97   287.27      0
> 1115   (99410, 458997)     7015   291.04   288.74      6
> 1116   (99495, 458978)     7016   290.62   288.72      6
> 1117 (99438.3, 458992)     7018   291.28   288.38      6
> 1118   (99813, 458891)     7021   290.08   285.58      0
> 
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
> 
> it stays the same...shouln't it remove the duplicates?
> 
> 
> thanks, m
> 
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org 
> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Thursday, July 14, 2011 11:25 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] predict() LDL error
> 
> The error message is an indication that you're predicting (kriging) with a singular covariance matrix. The most frequent reasons for this are duplicate observations [1] or perfect correlation in the coregionalization model [2]. For [1], see ?remove.duplicates, for [2] see argument correct.diagonal in ?fit.lmc.
> 
> On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>  
>>
>> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data. 
>>
>>  
>>
>> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
>>
>>  
>>
>> I got this code (mostly) from the net, so i have some trouble understanding it...
>>
>>  
>>
>> thanks for any help and info about categorical kriging,
>>
>>  
>>
>> m
>>
>>  
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: CatKrig.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/658a66a1/attachment.txt>

From matevz.pavlic at gi-zrmk.si  Mon Jul 18 09:27:52 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Mon, 18 Jul 2011 09:27:52 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <CAFZw66H9z2ea9RqxEQEb2GtroL=-OQqLeRj1z02ArtOJYZzzYw@mail.gmail.com>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si><4E1F5E9A.10409@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si><4E20052B.9030208@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si><AD5CA6183570B54F92AA45CE2619F9B90129D87E@gi-zrmk.si>
	<CAFZw66H9z2ea9RqxEQEb2GtroL=-OQqLeRj1z02ArtOJYZzzYw@mail.gmail.com>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D88C@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/45388eed/attachment.pl>

From caspar.hallmann at gmail.com  Mon Jul 18 09:44:02 2011
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Mon, 18 Jul 2011 09:44:02 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129D88C@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>
	<4E1F5E9A.10409@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>
	<4E20052B.9030208@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si>
	<AD5CA6183570B54F92AA45CE2619F9B90129D87E@gi-zrmk.si>
	<CAFZw66H9z2ea9RqxEQEb2GtroL=-OQqLeRj1z02ArtOJYZzzYw@mail.gmail.com>
	<AD5CA6183570B54F92AA45CE2619F9B90129D88C@gi-zrmk.si>
Message-ID: <CAFZw66EAGt9PgE1+OfVMQtmvp8BVNy3aGnSDwf=kwAMzyWrbwA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/9220db4c/attachment.pl>

From matevz.pavlic at gi-zrmk.si  Mon Jul 18 11:05:26 2011
From: matevz.pavlic at gi-zrmk.si (=?UTF-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Mon, 18 Jul 2011 11:05:26 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <CAFZw66EAGt9PgE1+OfVMQtmvp8BVNy3aGnSDwf=kwAMzyWrbwA@mail.gmail.com>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si><4E1F5E9A.10409@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si><4E20052B.9030208@uni-muenster.de><AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si><AD5CA6183570B54F92AA45CE2619F9B90129D87E@gi-zrmk.si><CAFZw66H9z2ea9RqxEQEb2GtroL=-OQqLeRj1z02ArtOJYZzzYw@mail.gmail.com><AD5CA6183570B54F92AA45CE2619F9B90129D88C@gi-zrmk.si>
	<CAFZw66EAGt9PgE1+OfVMQtmvp8BVNy3aGnSDwf=kwAMzyWrbwA@mail.gmail.com>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D8B3@gi-zrmk.si>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/fa785d34/attachment.pl>

From rikavons at hotmail.com  Mon Jul 18 11:07:40 2011
From: rikavons at hotmail.com (Erika von Schneidemesser)
Date: Mon, 18 Jul 2011 04:07:40 -0500
Subject: [R-sig-Geo] plotting x y z data from an irregular grid
Message-ID: <BAY153-w473EBDE1722187727AF63DA4A0@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/2b2edf96/attachment.pl>

From cristhine.arj at gmail.com  Mon Jul 18 14:42:53 2011
From: cristhine.arj at gmail.com (CRISTINA ARJONA)
Date: Mon, 18 Jul 2011 14:42:53 +0200
Subject: [R-sig-Geo] Cannot use spgrass6 under windows7
Message-ID: <CAKO7WnbQacAhVU2m7xbLH9ECrqOwAdJ-rEYSowS3nom3MBnC9w@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/1a9674a0/attachment.pl>

From alfreale74 at gmail.com  Mon Jul 18 16:34:12 2011
From: alfreale74 at gmail.com (Alfredo Alessandrini)
Date: Mon, 18 Jul 2011 16:34:12 +0200
Subject: [R-sig-Geo] subs and the name of column
Message-ID: <CA+GC7G4vg-65_AAhLr=zq3MwF6j4F-0TmEGqPVSFHhzPkdF6oA@mail.gmail.com>

Hi to all,

I'm trying to use subs function, but I've an error when I use "by="
with the name of the column. But if I use the column number it work:


> subs(raster_cluster,data_6SV_cluster,by=1,which=2)
class       : RasterLayer
dimensions  : 55, 66, 3630  (nrow, ncol, ncell)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : 99.48333, 100.0333, 2.275, 2.733333  (xmin, xmax, ymin, ymax)
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0
values      : in memory
min value   : -0.03073237
max value   : -0.02022671

> subs(raster_cluster,data_6SV_cluster,by=1,which=2)
class       : RasterLayer
dimensions  : 55, 66, 3630  (nrow, ncol, ncell)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : 99.48333, 100.0333, 2.275, 2.733333  (xmin, xmax, ymin, ymax)
projection  : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0
values      : in memory
min value   : -0.03073237
max value   : -0.02022671

> colnames(data_6SV_cluster)
[1] "cluster"     "intercept"   "coefficient"
> subs(raster_cluster,data_6SV_cluster,by="cluster",which=2)
Error in `[.data.frame`(y, , c(by, which)) : undefined columns selected


From Roger.Bivand at nhh.no  Mon Jul 18 20:14:40 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 18 Jul 2011 20:14:40 +0200 (CEST)
Subject: [R-sig-Geo] Cannot use spgrass6 under windows7
In-Reply-To: <CAKO7WnbQacAhVU2m7xbLH9ECrqOwAdJ-rEYSowS3nom3MBnC9w@mail.gmail.com>
References: <CAKO7WnbQacAhVU2m7xbLH9ECrqOwAdJ-rEYSowS3nom3MBnC9w@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107182009300.3951@reclus.nhh.no>

On Mon, 18 Jul 2011, CRISTINA ARJONA wrote:

> Please disregard my previous message, I included wrong details.
> This is what I actually do and cannot get GRASS commands to work from R
> under Windows7. I try both from R with no GRASS session running and starting
> R from within the GRASS shell console:

If you are using an existing location, always start GRASS first then start 
R within GRASS. This was covered in a thread on this list recently - 
initGRASS() is only for use with throwaway locations created to access 
GRASS functionality for R data:

https://stat.ethz.ch/pipermail/r-sig-geo/2011-May/011671.html

Roger

PS: in Windows, GRASS executables are called with the exe extension, so 
use execGRASS("g.region", flags="p", intern=TRUE) to provide the 
system-dependent treatment required, not as below.

>
> If I start R outside GRASS (and with GRASS not running):
>> setwd("D:/1_MASTER_SIG/1-0_PROJECTE/CALCULS")
>> require(rgdal)
> Loading required package: rgdal
> Loading required package: sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
> Path to GDAL shared files: C:/Program Files/R/R-2.13.0/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: C:/Program Files/R/R-2.13.0/library/rgdal/proj
>> require(raster)
> Loading required package: raster
> raster version 1.8-39 (3-July-2011)
> Warning message:
> package 'raster' was built under R version 2.13.1
>> require(spgrass6)
> Loading required package: spgrass6
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: (GRASS not running)
> Warning message:
> package 'spgrass6' was built under R version 2.13.1
>>  gmeta6()  #ara treballem des de r amb grass
> Error in system(cmd0, intern = TRUE) : 'g.region.exe' not found
> Error in parseGRASS(cmd) : g.region not found
>> initGRASS(gisBase= "C:/Program Files (x86)/Quantum GIS
> Wroclaw/apps/grass/grass-6.4.1/bin", home=tempdir(),
> gisDbase="D:/GRASSDATA", location= "MNSY2", mapset="MNSYGRASS", override =
> F, use_g.dirseps.exe = FALSE)
> Error in system(cmd0, intern = TRUE) : 'g.region.exe' not found
> In addition: Warning messages:
> 1: In dir.create(gisDbase) : 'D:\GRASSDATA' already exists
> 2: In dir.create(gisDbase) :
>  cannot create dir 'D:\GRASSDATA', reason 'No error'
> 3: In dir.create(loc_path) : 'D:\GRASSDATA\MNSY2' already exists
> 4: In dir.create(loc_path) :
>  cannot create dir 'D:\GRASSDATA\MNSY2', reason 'No error'
> Error in parseGRASS(cmd) : g.region not found
>
> If I start R from within the GRASS console (through the QGIS grass plugin):
> (having navigated to my R working directory and started up R with
> "C:\Program Files\R\R-2.13.0\bin\i386\Rgui.exe" ):
> My R workspace is loaded normally,
> Then I do:
>> require(rgdal)
> Loading required package: rgdal
> Loading required package: sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23
> Path to GDAL shared files: C:/Program Files/R/R-2.13.0/library/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009
> Path to PROJ.4 shared files: C:/Program Files/R/R-2.13.0/library/rgdal/proj
>> require(raster)
> Loading required package: raster
> raster version 1.8-39 (3-July-2011)
> Warning message:
> package 'raster' was built under R version 2.13.1
>> require(spgrass6)
> Loading required package: spgrass6
> Loading required package: XML
> GRASS GIS interface loaded with GRASS version: GRASS 6.4.1 (2011)
> and location: MNSY2
> Warning message:
> package 'spgrass6' was built under R version 2.13.1
>> gmeta6()
> gisdbase    D:/GRASSDATA
> location    MNSY2
> mapset      MNSYGRASS
> rows        549
> columns     1000
> north       4636820
> south       4613150
> west        429462
> east        472499
> nsres       43.11475
> ewres       43.037
> projection  +proj=utm +no_defs +zone=31 +a=6378388 +rf=297
> +towgs84=-87,-98,-121,0,0,0,0 +to_meter=1
>>
>
> which is correct. But then, when I try to run any GRASS command, I get an
> error:
>> system("g.region -p",intern=T)
> Error in system("g.region -p", intern = T) : 'g.region' not found
>
> I've tried with initGRASS(), but
>> initGRASS(gisBase= "C:/Program Files (x86)/Quantum GIS
> Wroclaw/apps/grass/grass-6.4.1/bin", home=tempdir(),
> gisDbase="D:/GRASSDATA", location= "MNSY2", mapset="MNSYGRASS", override =
> F, use_g.dirseps.exe = FALSE)
> Error in initGRASS(gisBase = "C:/Program Files (x86)/Quantum GIS
> Wroclaw/apps/grass/grass-6.4.1/bin",  :
>  A GRASS location is already in use; to override, set override=TRUE
>
> Any help on what am I doing wrong? Do I have to start R from within GRASS
> under linux?
>
> Thanks!
>
> Cristina,
>> sessionInfo()
> R version 2.13.0 (2011-04-13)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=Spanish_Spain.1252  LC_CTYPE=Spanish_Spain.1252
> LC_MONETARY=Spanish_Spain.1252 LC_NUMERIC=C
> LC_TIME=Spanish_Spain.1252
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] spgrass6_0.6-27 XML_3.4-0.2     raster_1.8-39   rgdal_0.6-33
> sp_0.9-81
>
> loaded via a namespace (and not attached):
> [1] grid_2.13.0     lattice_0.19-23
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Mon Jul 18 20:21:10 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 18 Jul 2011 20:21:10 +0200 (CEST)
Subject: [R-sig-Geo] Fill in empty links with nearest neighbors
In-Reply-To: <1310697392.59857.YahooMailClassic@web36304.mail.mud.yahoo.com>
References: <1310697392.59857.YahooMailClassic@web36304.mail.mud.yahoo.com>
Message-ID: <alpine.LRH.2.00.1107182018440.3951@reclus.nhh.no>

On Thu, 14 Jul 2011, Kitty Lee wrote:

> Hi. I have a shapefile. I guess because of cartography problem, the 
> border of some of the units that are supposed to be physically connected 
> are 'snapped' properly. As a result, when I use poly2nb, there are empty 
> links.

Did you notice on the help page for poly2nb() that you can snap within the 
function? Had you quoted your code verbatim, and added the output of 
sessionInfo(), replying would have been easier. If you did use the snap= 
argument, are your polygons malformed? Can you clean then in a topological 
GIS first?

Hope this helps,

Roger

>
> I know I can set zero.policy=T in nb2listw. But I'm trying to use 
> skater() function. I notice that it won't accept spatial weight matrix 
> with empty link.
>
> Any advice on how can I easily fix the matrix? Is there a way I can fill 
> in empty link with nearest neighbors?
>
> I'd really appreciate advice on how to manually tweak the connectivity 
> matrix.
>
> Thanks in advance!
>
> K.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From jpshweta at gmail.com  Mon Jul 18 20:27:41 2011
From: jpshweta at gmail.com (shweta jp)
Date: Mon, 18 Jul 2011 14:27:41 -0400
Subject: [R-sig-Geo] anisotropy modeling
In-Reply-To: <4E1DD225.9000002@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>
	<4E1D52D6.2050701@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D651@gi-zrmk.si>
	<4E1DD225.9000002@uni-muenster.de>
Message-ID: <CAMRBF3B9e1mDOpkpdDU7bOnX17Dxb-VG2Y6tBrG1EmBo_2zqvQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/c884e0f9/attachment.pl>

From matevz.pavlic at gi-zrmk.si  Mon Jul 18 21:16:59 2011
From: matevz.pavlic at gi-zrmk.si (=?UTF-8?B?TWF0ZXbFviBQYXZsacSN?=)
Date: Mon, 18 Jul 2011 21:16:59 +0200
Subject: [R-sig-Geo] predict() LDL error
In-Reply-To: <CAHT1vpg244MP21g5nZRG=7dcgBhBgJ18kV=jM6pVJsQvorxHjA@mail.gmail.com>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D7A5@gi-zrmk.si>
	<4E1F5E9A.10409@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D7DF@gi-zrmk.si>
	<4E20052B.9030208@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129D87D@gi-zrmk.si>
	<AD5CA6183570B54F92AA45CE2619F9B90129D87E@gi-zrmk.si>
	<CAFZw66H9z2ea9RqxEQEb2GtroL=-OQqLeRj1z02ArtOJYZzzYw@mail.gmail.com>
	<AD5CA6183570B54F92AA45CE2619F9B90129D88C@gi-zrmk.si>
	<CAFZw66EAGt9PgE1+OfVMQtmvp8BVNy3aGnSDwf=kwAMzyWrbwA@mail.gmail.com>
	<AD5CA6183570B54F92AA45CE2619F9B90129D8B3@gi-zrmk.si>
	<CAHT1vpg244MP21g5nZRG=7dcgBhBgJ18kV=jM6pVJsQvorxHjA@mail.gmail.com>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129D905@gi-zrmk.si>

Hi all, 

 

ok i managed to create a prediction with predict() (with gstat object). 

However, what i get now is a set of predictions and covariances grids for each class. Which is great of course, but what i would really like is to create a map of these classes.

I suppose the maximum value of the prediction on the cell would do, but i can not find a way to make these work. I would need to create a code that would check which value of these predictions (clasess) is the greatest for each cell and set this cell to have a name of the predicted class. 

Attached is simplified output of the prediction, where ena.pred, dva.pred, tri.pred??..devet.pred columns represent the prediction (probability) and columns X and Y represent coordinates. So what i would like to do is to generate a code that would check which value is the greates in each X and Y coordinates and assign the name of that column (prediction)

 

I hope I explained it ok, if not i'll try more?

Thanks for the hlep, 

 

m

From: romunov at gmail.com [mailto:romunov at gmail.com] On Behalf Of Roman Lu?trik
Sent: Monday, July 18, 2011 11:21 AM
To: Matev? Pavli?
Subject: Re: [R-sig-Geo] predict() LDL error

 

Oj,

 

pred ?asom smo ustanovili lokalno skupino za R, poimenovana Rkoholiki. Navadno se sestajamo v Ljubljani (oddelek za biologijo). Sicer je ?ez poletje bolj po?asno, je pa v ?asu ne-dopustov kar ?ivahno s sre?anji. V kolikor bi te zanimalo, se nam lahko pridru?i? na http://groups.google.com/group/rkoholiki kamor obe?amo informacije o dru?enjih in podobno.

 

lp,

Roman

 

 

 

On Mon, Jul 18, 2011 at 11:05 AM, Matev? Pavli? <matevz.pavlic at gi-zrmk.si> wrote:

Hi,



thanks for the help. I renamed it to letters and it works perfectly now.



Thanks again for your time, m




From: caspar hallmann [mailto:caspar.hallmann at gmail.com]

Sent: Monday, July 18, 2011 9:44 AM
To: Matev? Pavli?
Cc: r-sig-geo at r-project.org

Subject: Re: [R-sig-Geo] predict() LDL error



ah...

I think it has to do with the names. Try renaming your columns so that they dont start with a number but rather a character.



names(z)<-paste(letters[1:ncol(z)],names=z,sep="_")

print(spplot(z, zcol=grep("0.pred",z)), col.regions=terrain.colors(64), contour=T, pretty=T, cuts=8, key.space="right")

hope it helps



Caspar



On Mon, Jul 18, 2011 at 9:27 AM, Matev? Pavli? <matevz.pavlic at gi-zrmk.si> wrote:

Hi Caspar,



still get the same error. The str(z) shows this info :



> str(z)

Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots

 ..@ data       :'data.frame': 8736 obs. of  9 variables:

 .. ..$ 0.pred : num [1:8736] 0.174 0.174 0.174 0.174 0.176 ...

 .. ..$ 0.var  : num [1:8736] 0.236 0.236 0.236 0.236 0.236 ...

 .. ..$ 1.pred : num [1:8736] 0.134 0.134 0.134 0.134 0.117 ...

 .. ..$ 1.var  : num [1:8736] 0.136 0.136 0.136 0.136 0.136 ...

 .. ..$ 2.pred : num [1:8736] 0.233 0.233 0.233 0.233 0.234 ...

 .. ..$ 2.var  : num [1:8736] 0.0613 0.0613 0.0613 0.0613 0.0613 ...

 .. ..$ cov.0.1: num [1:8736] -0.0509 -0.0509 -0.0509 -0.0509 -0.0509 ...

 .. ..$ cov.0.2: num [1:8736] -0.0171 -0.0171 -0.0171 -0.0171 -0.0171 ...

 .. ..$ cov.1.2: num [1:8736] -0.0164 -0.0164 -0.0164 -0.0164 -0.0164 ... > str(z)

...



But when i use :


> print(spplot(z, zcol=which(names(z)=="0.pred")), col.regions=terrain.colors(64), contour=T, pretty=T, cuts=8, key.space="right")




i get the same error :


Error in parse(text = x) : <text>:1:3: unexpected symbol

1: 0.pred

   ^



thanks for help,m



From: caspar hallmann [mailto:caspar.hallmann at gmail.com]
Sent: Monday, July 18, 2011 8:58 AM
To: Matev? Pavli?

Subject: Re: [R-sig-Geo] predict() LDL error




Hi Matev?




try:



print(spplot(z, zcol=which(names(z)=="0.pred")), col.regions=terrain.colors(64), contour=T, pretty=T, cuts=8, key.space="right")



Greets



Caspar





2011/7/18 Matev? Pavli? <matevz.pavlic at gi-zrmk.si>

...and attachement...

r, m


-----Original Message-----

From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Matev? Pavli?
Sent: Monday, July 18, 2011 8:47 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

Hi Edzer, thanks for the help,

i managed to use the predict() function now. But when I try to plot the predictions using spplot() i get this error :

"Error in parse(text = x) : <text>:1:3: unexpected symbol 1: 0.pred"

Where 0.pred is the the prediction to plot.

Does anyone has any ideas to what this could mean? I've searcehd the forum, but failed to get any answers.

(attached is the code I use).

Thanks for  your time, m

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Friday, July 15, 2011 11:15 AM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] predict() LDL error

to remove duplicates in DF you need to replace it:

DF = remove.duplicates(DF, zero=0, remove.second = TRUE)
zerodist(DF)

On 07/15/2011 10:23 AM, Matev? Pavli? wrote:
> Hi, thanks for your time....
>
> I am sure the problem is in same locations...but i dont know why remove.duplicates() does not remove duplicates...
> When i try this :
>
>> coordinates(DF)<-~X+Y
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
>
>> remove.duplicates(DF, zero=0, remove.second = TRUE)
> ...
> 1113 (99447.1, 459012)     7019   290.17   286.57      6
> 1114 (99465.2, 458975)     7022   291.97   287.27      0
> 1115   (99410, 458997)     7015   291.04   288.74      6
> 1116   (99495, 458978)     7016   290.62   288.72      6
> 1117 (99438.3, 458992)     7018   291.28   288.38      6
> 1118   (99813, 458891)     7021   290.08   285.58      0
>
>> zerodist(DF)
>      [,1] [,2]
> [1,]   83   84
> [2,]  242  243
> [3,]  266  267
> [4,]  431  432
> [5,]  439  440
> [6,]  731  732
> [7,]  817  818
> [8,]  820  821
>
> it stays the same...shouln't it remove the duplicates?
>
>
> thanks, m
>
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org
> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Thursday, July 14, 2011 11:25 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] predict() LDL error
>
> The error message is an indication that you're predicting (kriging) with a singular covariance matrix. The most frequent reasons for this are duplicate observations [1] or perfect correlation in the coregionalization model [2]. For [1], see ?remove.duplicates, for [2] see argument correct.diagonal in ?fit.lmc.
>

> On 07/14/2011 06:18 PM, Matev? Pavli? wrote:
>> Hi all,
>>
>>
>>
>> i am trying to use categorical kriging for prediction of soil classes in an area. I am pretty new to using cat. kriging in R soI probably am making some beginers mistakes. Attached is a reproducable sample with sample data.
>>
>>
>>
>> When i try to use predict() i geta n error- I am pretty sure because some points are duplicated....in krige() function i use zerodist() which eliminates the LDL error, but i can't find a way to use it here....
>>
>>
>>
>> I got this code (mostly) from the net, so i have some trouble understanding it...
>>
>>
>>
>> thanks for any help and info about categorical kriging,
>>
>>
>>
>> m
>>
>>
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Edzer Pebesma

> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081 <tel:%2B49%20251%208333081>  <tel:%2B49%20251%208333081> , Fax: +49 251 8339763 <tel:%2B49%20251%208339763>  <tel:%2B49%20251%208339763>   http://ifgi.uni-muenster.de <http://ifgi.uni-muenster.de/>  <http://ifgi.uni-muenster.de/>


> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma

Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081 <tel:%2B49%20251%208333081>  <tel:%2B49%20251%208333081> , Fax: +49 251 8339763 <tel:%2B49%20251%208339763>  <tel:%2B49%20251%208339763>   http://ifgi.uni-muenster.de <http://ifgi.uni-muenster.de/>  <http://ifgi.uni-muenster.de/>


http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo





      [[alternative HTML version deleted]]


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo




       [[alternative HTML version deleted]]


_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo




-- 
In God we trust, all others bring data.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/7fd0bc7e/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: catK_result.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110718/7fd0bc7e/attachment.txt>

From davidonelson at mac.com  Tue Jul 19 02:46:34 2011
From: davidonelson at mac.com (David Nelson)
Date: Mon, 18 Jul 2011 17:46:34 -0700
Subject: [R-sig-Geo] newbie qx on differences between WGS84 and NAD83
Message-ID: <2205D77F-D431-4D94-81CE-0B1EAEEDB8C3@mac.com>

In my first foray into spatial data, I'm dealing with both NAD83 and WGS84 coordinates.

Now, I understand that (1) they use slightly different reference ellipses and (2) the centers of the two ellipses track different things (apparently, the North American Plate vs. earth's center of mass).

But I don't understand exactly HOW they both define zero degrees longitude. Do they both use the IERS reference median, or does NAD83 use something else, like Airy's prime meridian?

Seems simple, but I can't find the answer. Hints and pointers would be greatly appreciated.

Thanks,

David Nelson


From r.hijmans at gmail.com  Tue Jul 19 04:51:24 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Mon, 18 Jul 2011 19:51:24 -0700 (PDT)
Subject: [R-sig-Geo] subs and the name of column
In-Reply-To: <CA+GC7G4vg-65_AAhLr=zq3MwF6j4F-0TmEGqPVSFHhzPkdF6oA@mail.gmail.com>
References: <CA+GC7G4vg-65_AAhLr=zq3MwF6j4F-0TmEGqPVSFHhzPkdF6oA@mail.gmail.com>
Message-ID: <1311043884878-6597311.post@n2.nabble.com>

> I'm trying to use subs function, but I've an error when I use "by=" 
> with the name of the column. But if I use the column number it work: 

>> colnames(data_6SV_cluster) 
>[1] "cluster"     "intercept"   "coefficient" 
>> subs(raster_cluster,data_6SV_cluster,by="cluster",which=2) 
> Error in `[.data.frame`(y, , c(by, which)) : undefined columns selected 

Alfredo, 

Currently, the columns should be either indicated by their position (a
number) or by their name; but you cannot mix the two. These alternatives
should work:

subs(raster_cluster,data_6SV_cluster,by="cluster",which="intercept") 

subs(raster_cluster,data_6SV_cluster,by=1,which=2) # the default

Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/subs-and-the-name-of-column-tp6594997p6597311.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lists at remoteinformation.com.au  Tue Jul 19 04:55:28 2011
From: lists at remoteinformation.com.au (Ben Madin)
Date: Tue, 19 Jul 2011 10:55:28 +0800
Subject: [R-sig-Geo] newbie qx on differences between WGS84 and NAD83
In-Reply-To: <2205D77F-D431-4D94-81CE-0B1EAEEDB8C3@mac.com>
References: <2205D77F-D431-4D94-81CE-0B1EAEEDB8C3@mac.com>
Message-ID: <57E71BC6-6502-45CF-8DA2-168B6115B56B@remoteinformation.com.au>

David

You need to look at the underlying definition - you can find it at http://spatialreference.org/ - this is the Human readable OGC WKT

WGS84 = EPSG: 4326

GEOGCS["WGS 84",
    DATUM["WGS_1984",
        SPHEROID["WGS 84",6378137,298.257223563,
            AUTHORITY["EPSG","7030"]],
        AUTHORITY["EPSG","6326"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.01745329251994328,
        AUTHORITY["EPSG","9122"]],
    AUTHORITY["EPSG","4326"]]

NAD83 = EPSG: 4269

GEOGCS["NAD83",
    DATUM["North_American_Datum_1983",
        SPHEROID["GRS 1980",6378137,298.257222101,
            AUTHORITY["EPSG","7019"]],
        AUTHORITY["EPSG","6269"]],
    PRIMEM["Greenwich",0,
        AUTHORITY["EPSG","8901"]],
    UNIT["degree",0.01745329251994328,
        AUTHORITY["EPSG","9122"]],
    AUTHORITY["EPSG","4269"]]

It would seem that the different datums use the different spheroid, but the same prime meridian and units. I confess to not understanding the Authority fully, nor why the NAD83 shown at http://spatialreference.org/ref/epsg/4269/ seems to cover almost all of the northern hemisphere except North America...

cheers

Ben





On 19/07/2011, at 8:46 AM, David Nelson wrote:

> In my first foray into spatial data, I'm dealing with both NAD83 and WGS84 coordinates.
> 
> Now, I understand that (1) they use slightly different reference ellipses and (2) the centers of the two ellipses track different things (apparently, the North American Plate vs. earth's center of mass).
> 
> But I don't understand exactly HOW they both define zero degrees longitude. Do they both use the IERS reference median, or does NAD83 use something else, like Airy's prime meridian?
> 
> Seems simple, but I can't find the answer. Hints and pointers would be greatly appreciated.
> 
> Thanks,
> 
> David Nelson
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Tue Jul 19 09:58:43 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Tue, 19 Jul 2011 09:58:43 +0200
Subject: [R-sig-Geo] anisotropy modeling
In-Reply-To: <CAMRBF3B9e1mDOpkpdDU7bOnX17Dxb-VG2Y6tBrG1EmBo_2zqvQ@mail.gmail.com>
References: <AD5CA6183570B54F92AA45CE2619F9B90129D60A@gi-zrmk.si>	<4E1D52D6.2050701@uni-muenster.de>	<AD5CA6183570B54F92AA45CE2619F9B90129D651@gi-zrmk.si>	<4E1DD225.9000002@uni-muenster.de>
	<CAMRBF3B9e1mDOpkpdDU7bOnX17Dxb-VG2Y6tBrG1EmBo_2zqvQ@mail.gmail.com>
Message-ID: <4E253933.8070708@uni-muenster.de>

The description says:

  The automatic fitting is done through fit.variogram.

estimateAnisotropy {intamap} does fit anistropy coefficients.



On 07/18/2011 08:27 PM, shweta jp wrote:
> Is the same true for autofitVariogram {automap} ?
> 
> Shweta
> 
> On Wed, Jul 13, 2011 at 1:13 PM, Edzer Pebesma <
> edzer.pebesma at uni-muenster.de> wrote:
> 
>> help(fit.variogram) has the following description:
>>
>>     Fit ranges and/or sills from a simple or nested variogram model to
>>     a sample variogram
>>
>> I suspected it would completely ignore anisotropy settings. However,
>> this seems not to be the case:
>>
>>> library(gstat)
>> Loading required package: sp
>> Loading required package: spacetime
>> Loading required package: zoo
>> Loading required package: xts
>>> loadMeuse()
>>> v0 = variogram(zinc~1,meuse, alpha = 0, tol.hor = 45)
>>> v90 = variogram(zinc~1,meuse, alpha = 90, tol.hor = 45)
>>> v = variogram(zinc~1,meuse)
>>> fit.variogram(v, vgm(1, "Exp", 300, anis=c(90,1)))
>>  model  psill    range
>> 1   Exp 166238 323.6674
>>> fit.variogram(v, vgm(1, "Exp", 300, anis=c(90,.1)))
>>  model  psill    range ang1 anis1
>> 1   Exp 166238 3236.674   90   0.1
>>> fit.variogram(v0, vgm(1, "Exp", 300, anis=c(90,.1)))
>>  model    psill    range ang1 anis1
>> 1   Exp 146068.7 2772.751   90   0.1
>>> fit.variogram(v90, vgm(1, "Exp", 300, anis=c(90,.1)))
>>  model    psill    range ang1 anis1
>> 1   Exp 200767.2 4027.282   90   0.1
>>>
>>
>>
>> On 07/13/2011 11:34 AM, Matev? Pavli? wrote:
>>> Hi,
>>>
>>> thanks for the reply. Can you explain this a little bit more :
>>> " it assumes the variogram to fit to is in the major (correlation)
>> direction (or averaged over all directions)."
>>>
>>> I don't know exactly ehat it means....
>>> m
>>>
>>> -----Original Message-----
>>> From: r-sig-geo-bounces at r-project.org [mailto:
>> r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
>>> Sent: Wednesday, July 13, 2011 10:10 AM
>>> To: r-sig-geo at r-project.org
>>> Subject: Re: [R-sig-Geo] anisotropy modeling
>>>
>>>
>>>
>>> On 07/12/2011 10:52 PM, Matev? Pavli? wrote:
>>>> Hi all,
>>>>
>>>>
>>>>
>>>> i 'm am not entirely sure I understand anisotropy kriging in R.
>>>>
>>>> I have a data set in which is (at least i think so) anisotropy is
>> clearly visible. So I made directional variograms....
>>>>
>>>> So as i understand, the only thing that is different from >normal<
>> kriging is the  >anis< property in which you define the diffrenece of
>> ranges? Is that coreect?
>>>
>>> Yes. Please note that fit.variogram ignores anything about anisotropy, it
>> assumes the variogram to fit to is in the major (correlation) direction (or
>> averaged over all directions).
>>>
>>>>
>>>> Bellow is the code i use :
>>>>
>>>>
>>>>
>>>> a<-5000/7000
>>>>
>>>> print(plot(variogram(Z ~ 1, DF, map = TRUE, cutoff = 15000, width =
>>>> 100), main = "Variogram map, podlaga",col.regions =
>>>> terrain.colors(64)))
>>>>
>>>> v1.a<-variogram(Z~1, DF, alpha=c(45, 135))
>>>>
>>>> (vmf.a <- fit.variogram(v1.a, vgm(2900, "Pen", 5500, 300, anis =
>>>> c(135, a))))
>>>>
>>>> print(plot(v1.a, pl = F, pch = 20, col = "blue"))
>>>>
>>>> print(plot(v1.a, plot.numbers = F, pch = 20, col = "darkblue", model =
>>>> vmf.a))
>>>>
>>>>
>>>>
>>>> podlaga.aniso<-krige(Z~1, DF[-zerodist(DF)[,1],], grd, vmf.a )
>>>>
>>>> print(spplot(podlaga.aniso, zcol="var1.pred",
>>>> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15,
>>>> key.space="right"))
>>>>
>>>> print(spplot(podlaga.aniso,  zcol="var1.var",
>>>> col.regions=terrain.colors(64), contour=T, pretty=T, cuts=15,
>>>> key.space="right"))
>>>>
>>>> writeGDAL(podlaga.aniso, "podlaga_aniso.tif")
>>>>
>>>>
>>>>
>>>> thanks for info,
>>>>
>>>>
>>>>
>>>> m
>>>>
>>>>
>>>>      [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> --
>>> Edzer Pebesma
>>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e
>> 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763
>> http://ifgi.uni-muenster.de
>>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster
>> Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
>> 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From karl at huftis.org  Tue Jul 19 10:14:40 2011
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Tue, 19 Jul 2011 10:14:40 +0200
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
	<1310821784060-6589557.post@n2.nabble.com>
Message-ID: <j03edf$3k1$1@dough.gmane.org>

Robert Hijmans wrote:

>>when I ran the same script in the new version the image
>>quality just get really low, almost incomprehensive (sometimes it doesn't
>>even appear). I would like to ask you, if this problem is just mine, or if
>>it's due to some kind of incompatibility between the new R release and
>>some of the packages I'm using?
> 
> It is a general problem; see the discussion here:
> 
> http://r-sig-geo.2731867.n2.nabble.com/Long-time-listener-first-time-caller-td6585078.html

FYI, this is now fixed:
http://developer.r-project.org/blosxom.cgi/R-devel/2011/07/19#c2011-07-19

Quote:
  The fix for PR#14583 caused inconsistent behaviour in other areas,
  e.g. PR#14628, extra lines appearing in image displays, and uneven
  bases on histograms PR#14632. 

-- 
Karl Ove Hufthammer


From Roger.Bivand at nhh.no  Tue Jul 19 11:10:15 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 19 Jul 2011 11:10:15 +0200 (CEST)
Subject: [R-sig-Geo] Problems Plotting GeoTIFF
In-Reply-To: <4E218D7A.70902@uni-muenster.de>
References: <000001cc43b7$add7a9d0$0986fd70$@gmail.com>
	<CAHT1vphE1bcXSOOVm-Wg8nEeJOt=a2Bsq4uxidhDZ+jJFWF8-A@mail.gmail.com>
	<4E218D7A.70902@uni-muenster.de>
Message-ID: <alpine.LRH.2.00.1107191109290.6495@reclus.nhh.no>

On Sat, 16 Jul 2011, Edzer Pebesma wrote:

> Although I can't reproduce the problem on my Ubuntu laptop,
>
> https://stat.ethz.ch/pipermail/r-help/2011-July/283568.html
>
> suggests 2.13.1 introduced a problem with image(), which is out of "our"
> hands (ie. cannot be fixed by the developers of spatial packages)

Fixed in 2.13.1 patched (Windows):

https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=14628

Roger

>
> Let me know if you see this differently,
>
> On 07/16/2011 03:02 PM, Roman Lu?trik wrote:
>> I'm afraid that without seeing the script(s), it will be hard to pinpoint
>> the problem.
>>
>> Cheers,
>> Roman
>>
>>
>>
>> On Sat, Jul 16, 2011 at 2:55 PM, Rodrigo Aluizio <r.aluizio at gmail.com>wrote:
>>
>>> Hi SIG List. I recently installed the new version of R (2.13.1, updated my
>>> packages and checked the built). After that, I needed "replot" some maps I
>>> had. Well, these maps were ok when plotted using the previous version of R
>>> (2.13.0), but when I ran the same script in the new version the image
>>> quality just get really low, almost incomprehensive (sometimes it doesn't
>>> even appear). I would like to ask you, if this problem is just mine, or if
>>> it's due to some kind of incompatibility between the new R release and some
>>> of the packages I'm using? And, if the problem is local, how can I fix it?
>>> Should I go back to R 2.13.0?
>>>
>>>
>>>
>>> Thank you for the attention, bellow is a link to an example of the actual
>>> final output of the image {sp} function (for a SpatialGridDataFrame).
>>>
>>> P.s.: The GeoTIFF was imported using the readGDAL {rgdal} function.
>>>
>>>
>>>
>>> http://dl.dropbox.com/u/2613625/BaciaPotiguarGE.png
>>>
>>>
>>>
>>> sessionInfo()
>>>
>>> R version 2.13.1 (2011-07-08)
>>>
>>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>>
>>>
>>>
>>> locale:
>>>
>>> [1] LC_COLLATE=Portuguese_Brazil.1252
>>>
>>> [2] LC_CTYPE=Portuguese_Brazil.1252
>>>
>>> [3] LC_MONETARY=Portuguese_Brazil.1252
>>>
>>> [4] LC_NUMERIC=C
>>>
>>> [5] LC_TIME=Portuguese_Brazil.1252
>>>
>>>
>>>
>>> attached base packages:
>>>
>>> [1] grDevices datasets  splines   graphics  stats
>>>
>>> [6] tcltk     utils     methods   base
>>>
>>>
>>>
>>> other attached packages:
>>>
>>> [1] rgdal_0.7-1     maptools_0.8-9  lattice_0.19-30
>>>
>>> [4] sp_0.9-83       foreign_0.8-44  mapdata_2.1-4
>>>
>>>  [7] maps_2.1-6      RODBC_1.3-2     svSocket_0.9-51
>>>
>>> [10] TinnR_1.0.3     R2HTML_2.2      Hmisc_3.8-3
>>>
>>> [13] survival_2.36-9
>>>
>>>
>>>
>>> loaded via a namespace (and not attached):
>>>
>>> [1] cluster_1.14.0 grid_2.13.1    svMisc_0.9-61
>>>
>>> [4] tools_2.13.1
>>>
>>>
>>>
>>> -------------------------------------------------------------------
>>>
>>> MSc.  <mailto:r.aluizio at gmail.com> Rodrigo Aluizio
>>>
>>>
>>>
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From julia.dechamps at jesus.ox.ac.uk  Tue Jul 19 12:59:53 2011
From: julia.dechamps at jesus.ox.ac.uk (Julia Dechamps)
Date: Tue, 19 Jul 2011 11:59:53 +0100
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance
 credible or due to misspecification of the model?
Message-ID: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>

Dear list,

I am new to spatial statistics and am working on the following: I have a dataset of annual grain yields over 9 years for each of 91 (irregularly spaced) areas. To begin with I averaged the yields over the 9 years, so that I have 91 data points, which I would now like to test for the presence of spatial autocorrelation via a global Moran I test (moran.test in package spdep). 

Here is how I proceeded (where in steps 2. onwards I am trying to follow Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9): 

1. I obtained approximate geographical point coordinates (lat and long) for the 91 areas using the online service http://www.gpsvisualizer.com/geocoder/.

2. I created a spatial object:
myCRS <- CRS("+proj=longlat +ellps=WGS84")
mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
colnames(mycoordmat) <- c("long","lat")
areanames <- paste("SD",1:91,sep="")
rownames(mycoordmat) <- areanames
sum(duplicated(mycoordmat))	          # 7
mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
coords <- coordinates(mydata_sp)

3. I created a distance based nbd:
mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
mydata_nb <- dnearneigh(coords, 0, all.linked)

4. I created spatial weights for the nb object:
# approach A: default style W:
mydata_lw_W <- nb2listw(mydata_nb, style="W")

# approach A: binary style B:
mydata_lw_B <- nb2listw(mydata_nb, style="B")

# approach C: weights proportional to inverse distance btw. points representing the areas
# (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
idw <- lapply(dsts, function(x) 1/x)
mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
summary(unlist(mydata_lw_idwW$weights))

5. Here are the resulting p-values from the global Moran tests:
# approach A: 
moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
# Moran's I test under randomisation: p-value = 0.9967

# approach B:
moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
# Moran's I test under randomisation: p-value = 0.9968

# approach C:
moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
# Moran's I test under randomisation: p-value < 2.2e-16

Now my questions:

Approach C seems to suggests strong evidence for rejecting the null of no spatial autocorrelation, whereas the other two approaches show absolutely no evidence for rejecting the null of no spatial autocorrelation. Bivand et al. repeatedly warn that apparent spatial autocorrelation may actually stem from misspecification of the model, and I am wondering whether this is the case here. I do not have any auxiliary variables such as spatially patterned ecological variables that I could include in my model for the mean function. I can therefore only really alter the choice of neighbour relationships and spatial weights.

With regard to the neighbourhood relationships: I decided to choose distance based neighbours such that all areas have at least one neighbour (via all.linked). Contiguity-based or grid-based neighbours are not appropriate for my data; with graph-based neighbours I run into troubles because 7 of my coordinates are duplicated. Knn or higher order neighbours ran into issues when I tried to implement them. In light of these observations and my data, is my distance-based approach sensible?

With regard to the assignment of spatial weights: I would have believed that it is sensible to assume that the strength of potential spatial autocorrelation in yields attenuates with distance between the areas under consideration. I therefore favour approach C conceptually. However Bivand et al. warn that if we know little about the assumed spatial process we should avoid moving far from the binary representation of a wight of unity for neighbours, which is what styles W and B (approaches A and B) both implement as far as I understand? In light of these observations and given the test results, which approach seems to be most appropriate in my case?

I would be extremely grateful for any advice you could give me.
Thank you!

Julia


From Roger.Bivand at nhh.no  Tue Jul 19 14:08:37 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 19 Jul 2011 14:08:37 +0200 (CEST)
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
 Significance credible or due to misspecification of the model?
In-Reply-To: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>
References: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>
Message-ID: <alpine.LRH.2.00.1107191358510.6495@reclus.nhh.no>

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear list,
>
> I am new to spatial statistics and am working on the following: I have a 
> dataset of annual grain yields over 9 years for each of 91 (irregularly 
> spaced) areas. To begin with I averaged the yields over the 9 years, so 
> that I have 91 data points, which I would now like to test for the 
> presence of spatial autocorrelation via a global Moran I test 
> (moran.test in package spdep).
>
> Here is how I proceeded (where in steps 2. onwards I am trying to follow 
> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>
> 1. I obtained approximate geographical point coordinates (lat and long) 
> for the 91 areas using the online service 
> http://www.gpsvisualizer.com/geocoder/.
>
> 2. I created a spatial object:
> myCRS <- CRS("+proj=longlat +ellps=WGS84")
> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
> colnames(mycoordmat) <- c("long","lat")
> areanames <- paste("SD",1:91,sep="")
> rownames(mycoordmat) <- areanames
> sum(duplicated(mycoordmat))	          # 7
> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
> coords <- coordinates(mydata_sp)
>
> 3. I created a distance based nbd:
> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
> mydata_nb <- dnearneigh(coords, 0, all.linked)

What is all.linked - is it a large distance (in km)? What does 
summary(mydata_nb) say? Are most points connected to each other?

>
> 4. I created spatial weights for the nb object:
> # approach A: default style W:
> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>
> # approach A: binary style B:
> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>
> # approach C: weights proportional to inverse distance btw. points representing the areas
> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
> idw <- lapply(dsts, function(x) 1/x)
> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
> summary(unlist(mydata_lw_idwW$weights))
>
> 5. Here are the resulting p-values from the global Moran tests:
> # approach A:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
> # Moran's I test under randomisation: p-value = 0.9967
>
> # approach B:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
> # Moran's I test under randomisation: p-value = 0.9968
>

The two above are actually significant negative autocorrelation, if you 
change alternative to other than "greater" - the default. I think that 
almost all observations are connected to each other, leading to this 
effect.

> # approach C:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
> # Moran's I test under randomisation: p-value < 2.2e-16
>
> Now my questions:
>
> Approach C seems to suggests strong evidence for rejecting the null of 
> no spatial autocorrelation, whereas the other two approaches show 
> absolutely no evidence for rejecting the null of no spatial 
> autocorrelation. Bivand et al. repeatedly warn that apparent spatial 
> autocorrelation may actually stem from misspecification of the model, 
> and I am wondering whether this is the case here. I do not have any 
> auxiliary variables such as spatially patterned ecological variables 
> that I could include in my model for the mean function. I can therefore 
> only really alter the choice of neighbour relationships and spatial 
> weights.

No, see above.

>
> With regard to the neighbourhood relationships: I decided to choose 
> distance based neighbours such that all areas have at least one 
> neighbour (via all.linked). Contiguity-based or grid-based neighbours 
> are not appropriate for my data; with graph-based neighbours I run into 
> troubles because 7 of my coordinates are duplicated. Knn or higher order 
> neighbours ran into issues when I tried to implement them. In light of 
> these observations and my data, is my distance-based approach sensible?

Beware of inverse distance when points are duplicated, the effects may be 
perverse. Either aggregate the duplicated points, or disambiguate them - 
move them apart. Your determination of position is likely to incur 
measurement error when the geocoder defaults to an approximation. Can you 
get more precise coordinates by zooming in on for example Google Earth, 
marking points, and dumping to KML? The KML can be read with readOGR() in 
rgdal. With disambiguated points, you can use graph-based neighbours.

Hope this helps,

Roger

>
> With regard to the assignment of spatial weights: I would have believed 
> that it is sensible to assume that the strength of potential spatial 
> autocorrelation in yields attenuates with distance between the areas 
> under consideration. I therefore favour approach C conceptually. However 
> Bivand et al. warn that if we know little about the assumed spatial 
> process we should avoid moving far from the binary representation of a 
> wight of unity for neighbours, which is what styles W and B (approaches 
> A and B) both implement as far as I understand? In light of these 
> observations and given the test results, which approach seems to be most 
> appropriate in my case?
>
> I would be extremely grateful for any advice you could give me.
> Thank you!
>
> Julia
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From julia.dechamps at jesus.ox.ac.uk  Tue Jul 19 15:46:07 2011
From: julia.dechamps at jesus.ox.ac.uk (Julia Dechamps)
Date: Tue, 19 Jul 2011 14:46:07 +0100
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
 Significance credible or due to misspecification of the model?
In-Reply-To: <alpine.LRH.2.00.1107191358510.6495@reclus.nhh.no>
References: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>,
	<alpine.LRH.2.00.1107191358510.6495@reclus.nhh.no>
Message-ID: <F9EB2235ED697C48BC07DCDC4DD85A492744791B97@EXMBX06.ad.oak.ox.ac.uk>

Dear Roger,

Thank you very much for your quick reply! Further to what you were asking ad 3.:

> all.linked
[1] 780.2701

> summary(mydata_nb)
Neighbour list object:
Number of regions: 91 
Number of nonzero links: 8168 
Percentage nonzero weights: 98.63543 
Average number of links: 89.75824 
Link number distribution:

87 88 89 90 
 4  3  4 80 
4 least connected regions:
8 10 12 15 with 87 links
80 most connected regions:
1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links 

So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 0.9967
# "two.sided" p-value = 0.00668
# "less" p-value = 0.00334

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = 0.9968
# "two-sided" p-value = 0.0064
# "less" p-value = 0.0032

# approach C:
# inverse: Moran's I test under randomisation:
# "greater" p-value < 2.2e-16
# "two.sided" p-value < 2.2e-16
# "less" p-value = 1

Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 0.5
# "two.sided" p-value = 1
# "less" p-value = 0.5

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = NA
# "two-sided" p-value = 1
# "less" p-value = NA

# approach C:
# inverse: Moran's I test under randomisation:
# "greater" p-value < 2.2e-16
# "two.sided" p-value < 2.2e-16
# "less" p-value = 1

I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...

I appreciate any further comments or suggestions you might have.

Regards,
Julia




________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 19 July 2011 13:08
To: Julia Dechamps
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear list,
>
> I am new to spatial statistics and am working on the following: I have a
> dataset of annual grain yields over 9 years for each of 91 (irregularly
> spaced) areas. To begin with I averaged the yields over the 9 years, so
> that I have 91 data points, which I would now like to test for the
> presence of spatial autocorrelation via a global Moran I test
> (moran.test in package spdep).
>
> Here is how I proceeded (where in steps 2. onwards I am trying to follow
> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>
> 1. I obtained approximate geographical point coordinates (lat and long)
> for the 91 areas using the online service
> http://www.gpsvisualizer.com/geocoder/.
>
> 2. I created a spatial object:
> myCRS <- CRS("+proj=longlat +ellps=WGS84")
> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
> colnames(mycoordmat) <- c("long","lat")
> areanames <- paste("SD",1:91,sep="")
> rownames(mycoordmat) <- areanames
> sum(duplicated(mycoordmat))             # 7
> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
> coords <- coordinates(mydata_sp)
>
> 3. I created a distance based nbd:
> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
> mydata_nb <- dnearneigh(coords, 0, all.linked)

What is all.linked - is it a large distance (in km)? What does
summary(mydata_nb) say? Are most points connected to each other?

>
> 4. I created spatial weights for the nb object:
> # approach A: default style W:
> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>
> # approach A: binary style B:
> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>
> # approach C: weights proportional to inverse distance btw. points representing the areas
> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
> idw <- lapply(dsts, function(x) 1/x)
> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
> summary(unlist(mydata_lw_idwW$weights))
>
> 5. Here are the resulting p-values from the global Moran tests:
> # approach A:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
> # Moran's I test under randomisation: p-value = 0.9967
>
> # approach B:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
> # Moran's I test under randomisation: p-value = 0.9968
>

The two above are actually significant negative autocorrelation, if you
change alternative to other than "greater" - the default. I think that
almost all observations are connected to each other, leading to this
effect.

> # approach C:
> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
> # Moran's I test under randomisation: p-value < 2.2e-16
>
> Now my questions:
>
> Approach C seems to suggests strong evidence for rejecting the null of
> no spatial autocorrelation, whereas the other two approaches show
> absolutely no evidence for rejecting the null of no spatial
> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
> autocorrelation may actually stem from misspecification of the model,
> and I am wondering whether this is the case here. I do not have any
> auxiliary variables such as spatially patterned ecological variables
> that I could include in my model for the mean function. I can therefore
> only really alter the choice of neighbour relationships and spatial
> weights.

No, see above.

>
> With regard to the neighbourhood relationships: I decided to choose
> distance based neighbours such that all areas have at least one
> neighbour (via all.linked). Contiguity-based or grid-based neighbours
> are not appropriate for my data; with graph-based neighbours I run into
> troubles because 7 of my coordinates are duplicated. Knn or higher order
> neighbours ran into issues when I tried to implement them. In light of
> these observations and my data, is my distance-based approach sensible?

Beware of inverse distance when points are duplicated, the effects may be
perverse. Either aggregate the duplicated points, or disambiguate them -
move them apart. Your determination of position is likely to incur
measurement error when the geocoder defaults to an approximation. Can you
get more precise coordinates by zooming in on for example Google Earth,
marking points, and dumping to KML? The KML can be read with readOGR() in
rgdal. With disambiguated points, you can use graph-based neighbours.

Hope this helps,

Roger

>
> With regard to the assignment of spatial weights: I would have believed
> that it is sensible to assume that the strength of potential spatial
> autocorrelation in yields attenuates with distance between the areas
> under consideration. I therefore favour approach C conceptually. However
> Bivand et al. warn that if we know little about the assumed spatial
> process we should avoid moving far from the binary representation of a
> wight of unity for neighbours, which is what styles W and B (approaches
> A and B) both implement as far as I understand? In light of these
> observations and given the test results, which approach seems to be most
> appropriate in my case?
>
> I would be extremely grateful for any advice you could give me.
> Thank you!
>
> Julia
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From Roger.Bivand at nhh.no  Tue Jul 19 16:15:16 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 19 Jul 2011 16:15:16 +0200 (CEST)
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
 Significance credible or due to misspecification of the model?
In-Reply-To: <F9EB2235ED697C48BC07DCDC4DD85A492744791B97@EXMBX06.ad.oak.ox.ac.uk>
References: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>,
	<alpine.LRH.2.00.1107191358510.6495@reclus.nhh.no>
	<F9EB2235ED697C48BC07DCDC4DD85A492744791B97@EXMBX06.ad.oak.ox.ac.uk>
Message-ID: <alpine.LRH.2.00.1107191601410.6495@reclus.nhh.no>

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear Roger,
>
> Thank you very much for your quick reply! Further to what you were asking ad 3.:
>
>> all.linked
> [1] 780.2701

Yes, this is the reason for the problems. I suggest improving the 
coordinate measurements first, then constructing a graph-based neighbour 
object, as your observations are very unevenly spaced. The construction of 
the weights depends on the kind of spatial process you envision, which may 
be contagion or perhaps diffusion in some form.

Note also that your temporal aggregation may smooth the data. I'm not 
aware of appropriate tests for spatio-temporal processes, and that may be 
what you really need. You may be aware that Cressie & Wikle (2011) has 
appeared, and that space-time data is a very active area at the moment.

Roger

>
>> summary(mydata_nb)
> Neighbour list object:
> Number of regions: 91
> Number of nonzero links: 8168
> Percentage nonzero weights: 98.63543
> Average number of links: 89.75824
> Link number distribution:
>
> 87 88 89 90
> 4  3  4 80
> 4 least connected regions:
> 8 10 12 15 with 87 links
> 80 most connected regions:
> 1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links
>
> So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.9967
> # "two.sided" p-value = 0.00668
> # "less" p-value = 0.00334
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = 0.9968
> # "two-sided" p-value = 0.0064
> # "less" p-value = 0.0032
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
> When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.5
> # "two.sided" p-value = 1
> # "less" p-value = 0.5
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = NA
> # "two-sided" p-value = 1
> # "less" p-value = NA
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...
>
> I appreciate any further comments or suggestions you might have.
>
> Regards,
> Julia
>
>
>
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 19 July 2011 13:08
> To: Julia Dechamps
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?
>
> On Tue, 19 Jul 2011, Julia Dechamps wrote:
>
>> Dear list,
>>
>> I am new to spatial statistics and am working on the following: I have a
>> dataset of annual grain yields over 9 years for each of 91 (irregularly
>> spaced) areas. To begin with I averaged the yields over the 9 years, so
>> that I have 91 data points, which I would now like to test for the
>> presence of spatial autocorrelation via a global Moran I test
>> (moran.test in package spdep).
>>
>> Here is how I proceeded (where in steps 2. onwards I am trying to follow
>> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>>
>> 1. I obtained approximate geographical point coordinates (lat and long)
>> for the 91 areas using the online service
>> http://www.gpsvisualizer.com/geocoder/.
>>
>> 2. I created a spatial object:
>> myCRS <- CRS("+proj=longlat +ellps=WGS84")
>> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
>> colnames(mycoordmat) <- c("long","lat")
>> areanames <- paste("SD",1:91,sep="")
>> rownames(mycoordmat) <- areanames
>> sum(duplicated(mycoordmat))             # 7
>> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
>> coords <- coordinates(mydata_sp)
>>
>> 3. I created a distance based nbd:
>> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
>> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
>> mydata_nb <- dnearneigh(coords, 0, all.linked)
>
> What is all.linked - is it a large distance (in km)? What does
> summary(mydata_nb) say? Are most points connected to each other?
>
>>
>> 4. I created spatial weights for the nb object:
>> # approach A: default style W:
>> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>>
>> # approach A: binary style B:
>> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>>
>> # approach C: weights proportional to inverse distance btw. points representing the areas
>> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
>> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
>> idw <- lapply(dsts, function(x) 1/x)
>> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
>> summary(unlist(mydata_lw_idwW$weights))
>>
>> 5. Here are the resulting p-values from the global Moran tests:
>> # approach A:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
>> # Moran's I test under randomisation: p-value = 0.9967
>>
>> # approach B:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
>> # Moran's I test under randomisation: p-value = 0.9968
>>
>
> The two above are actually significant negative autocorrelation, if you
> change alternative to other than "greater" - the default. I think that
> almost all observations are connected to each other, leading to this
> effect.
>
>> # approach C:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
>> # Moran's I test under randomisation: p-value < 2.2e-16
>>
>> Now my questions:
>>
>> Approach C seems to suggests strong evidence for rejecting the null of
>> no spatial autocorrelation, whereas the other two approaches show
>> absolutely no evidence for rejecting the null of no spatial
>> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
>> autocorrelation may actually stem from misspecification of the model,
>> and I am wondering whether this is the case here. I do not have any
>> auxiliary variables such as spatially patterned ecological variables
>> that I could include in my model for the mean function. I can therefore
>> only really alter the choice of neighbour relationships and spatial
>> weights.
>
> No, see above.
>
>>
>> With regard to the neighbourhood relationships: I decided to choose
>> distance based neighbours such that all areas have at least one
>> neighbour (via all.linked). Contiguity-based or grid-based neighbours
>> are not appropriate for my data; with graph-based neighbours I run into
>> troubles because 7 of my coordinates are duplicated. Knn or higher order
>> neighbours ran into issues when I tried to implement them. In light of
>> these observations and my data, is my distance-based approach sensible?
>
> Beware of inverse distance when points are duplicated, the effects may be
> perverse. Either aggregate the duplicated points, or disambiguate them -
> move them apart. Your determination of position is likely to incur
> measurement error when the geocoder defaults to an approximation. Can you
> get more precise coordinates by zooming in on for example Google Earth,
> marking points, and dumping to KML? The KML can be read with readOGR() in
> rgdal. With disambiguated points, you can use graph-based neighbours.
>
> Hope this helps,
>
> Roger
>
>>
>> With regard to the assignment of spatial weights: I would have believed
>> that it is sensible to assume that the strength of potential spatial
>> autocorrelation in yields attenuates with distance between the areas
>> under consideration. I therefore favour approach C conceptually. However
>> Bivand et al. warn that if we know little about the assumed spatial
>> process we should avoid moving far from the binary representation of a
>> wight of unity for neighbours, which is what styles W and B (approaches
>> A and B) both implement as far as I understand? In light of these
>> observations and given the test results, which approach seems to be most
>> appropriate in my case?
>>
>> I would be extremely grateful for any advice you could give me.
>> Thank you!
>>
>> Julia
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From julia.dechamps at jesus.ox.ac.uk  Tue Jul 19 20:01:14 2011
From: julia.dechamps at jesus.ox.ac.uk (Julia Dechamps)
Date: Tue, 19 Jul 2011 19:01:14 +0100
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
 Significance credible or due to misspecification of the model?
In-Reply-To: <alpine.LRH.2.00.1107191601410.6495@reclus.nhh.no>
References: <F9EB2235ED697C48BC07DCDC4DD85A492744791B96@EXMBX06.ad.oak.ox.ac.uk>,
	<alpine.LRH.2.00.1107191358510.6495@reclus.nhh.no>
	<F9EB2235ED697C48BC07DCDC4DD85A492744791B97@EXMBX06.ad.oak.ox.ac.uk>,
	<alpine.LRH.2.00.1107191601410.6495@reclus.nhh.no>
Message-ID: <F9EB2235ED697C48BC07DCDC4DD85A492744791B99@EXMBX06.ad.oak.ox.ac.uk>

Dear Roger,

I now used Google Maps to obtain (hopefully) more accurate coordinates of the areas. As it turns out, only for 44 out of the 91 areas, the coordinates seem to make sense/ were available. So I am now only looking at "mydata" which only contains 44 data points that are no longer representative of the original sample. This rather concerns me, but I can?t see a way out of it at the moment. 

When using Delauny triangulation, I obtain the following nb object:
> mydata_nb2 <- tri2nb(coordinates(mydata_sp))
> summary(irrig_nb2)
Neighbour list object:
Number of regions: 44 
Number of nonzero links: 242 
Percentage nonzero weights: 12.5 
Average number of links: 5.5 
Link number distribution:

 3  4  5  6  7  8 10 
 1  8 15 12  6  1  1 
1 least connected region:
7 with 3 links
1 most connected region:
8 with 10 links

Using approach A and B from before for the construction of spatial weights I get the following test results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 6.438e-09
# "two.sided" p-value = 1.288e-08
# "less" p-value = 1

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = 1.874e-08
# "two-sided" p-value = 3.748e-08
# "less" p-value = 1

Having no experience in spatial statistics at all, I?m finding it difficult to envisage what spatial process (and hence what type of weights) would be appropriate for my data. I wouldn?t have thought that contagion would necessarily be appropriate (I might be misunderstanding contagion though, in which case I apologise): The grain under consideration is irrigated wheat and I wouldn?t expect yields to be influenced by similar agricultural practices spreading from one region to the next. I could imagine that nearby areas are influenced by similar weather phenomenons, however weather tends to be quite local, so maybe that?s not right either. 

Another point to mention about my data is that my yields have already been smoothed prior to the averaging over years since they are aggregate yields from smaller subareas (for which no coordinates are available though). This might contribute to the origin of the apparent negative autocorrelation. When conducting a moran test for each of the 9 years separately (rather than for the average over the 9 years), the results do not change noticeably. 

I am wondering whether I should maybe look for ways other than the moran test to get a rough idea whether spatial autocorrelation is present in the data or not...

Thank you very much for your time! I greatly appreciate your advice!

Regards,
Julia

________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 19 July 2011 15:15
To: Julia Dechamps
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear Roger,
>
> Thank you very much for your quick reply! Further to what you were asking ad 3.:
>
>> all.linked
> [1] 780.2701

Yes, this is the reason for the problems. I suggest improving the
coordinate measurements first, then constructing a graph-based neighbour
object, as your observations are very unevenly spaced. The construction of
the weights depends on the kind of spatial process you envision, which may
be contagion or perhaps diffusion in some form.

Note also that your temporal aggregation may smooth the data. I'm not
aware of appropriate tests for spatio-temporal processes, and that may be
what you really need. You may be aware that Cressie & Wikle (2011) has
appeared, and that space-time data is a very active area at the moment.

Roger

>
>> summary(mydata_nb)
> Neighbour list object:
> Number of regions: 91
> Number of nonzero links: 8168
> Percentage nonzero weights: 98.63543
> Average number of links: 89.75824
> Link number distribution:
>
> 87 88 89 90
> 4  3  4 80
> 4 least connected regions:
> 8 10 12 15 with 87 links
> 80 most connected regions:
> 1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links
>
> So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.9967
> # "two.sided" p-value = 0.00668
> # "less" p-value = 0.00334
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = 0.9968
> # "two-sided" p-value = 0.0064
> # "less" p-value = 0.0032
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
> When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.5
> # "two.sided" p-value = 1
> # "less" p-value = 0.5
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = NA
> # "two-sided" p-value = 1
> # "less" p-value = NA
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...
>
> I appreciate any further comments or suggestions you might have.
>
> Regards,
> Julia
>
>
>
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 19 July 2011 13:08
> To: Julia Dechamps
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?
>
> On Tue, 19 Jul 2011, Julia Dechamps wrote:
>
>> Dear list,
>>
>> I am new to spatial statistics and am working on the following: I have a
>> dataset of annual grain yields over 9 years for each of 91 (irregularly
>> spaced) areas. To begin with I averaged the yields over the 9 years, so
>> that I have 91 data points, which I would now like to test for the
>> presence of spatial autocorrelation via a global Moran I test
>> (moran.test in package spdep).
>>
>> Here is how I proceeded (where in steps 2. onwards I am trying to follow
>> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>>
>> 1. I obtained approximate geographical point coordinates (lat and long)
>> for the 91 areas using the online service
>> http://www.gpsvisualizer.com/geocoder/.
>>
>> 2. I created a spatial object:
>> myCRS <- CRS("+proj=longlat +ellps=WGS84")
>> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
>> colnames(mycoordmat) <- c("long","lat")
>> areanames <- paste("SD",1:91,sep="")
>> rownames(mycoordmat) <- areanames
>> sum(duplicated(mycoordmat))             # 7
>> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
>> coords <- coordinates(mydata_sp)
>>
>> 3. I created a distance based nbd:
>> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
>> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
>> mydata_nb <- dnearneigh(coords, 0, all.linked)
>
> What is all.linked - is it a large distance (in km)? What does
> summary(mydata_nb) say? Are most points connected to each other?
>
>>
>> 4. I created spatial weights for the nb object:
>> # approach A: default style W:
>> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>>
>> # approach A: binary style B:
>> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>>
>> # approach C: weights proportional to inverse distance btw. points representing the areas
>> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
>> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
>> idw <- lapply(dsts, function(x) 1/x)
>> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
>> summary(unlist(mydata_lw_idwW$weights))
>>
>> 5. Here are the resulting p-values from the global Moran tests:
>> # approach A:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
>> # Moran's I test under randomisation: p-value = 0.9967
>>
>> # approach B:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
>> # Moran's I test under randomisation: p-value = 0.9968
>>
>
> The two above are actually significant negative autocorrelation, if you
> change alternative to other than "greater" - the default. I think that
> almost all observations are connected to each other, leading to this
> effect.
>
>> # approach C:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
>> # Moran's I test under randomisation: p-value < 2.2e-16
>>
>> Now my questions:
>>
>> Approach C seems to suggests strong evidence for rejecting the null of
>> no spatial autocorrelation, whereas the other two approaches show
>> absolutely no evidence for rejecting the null of no spatial
>> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
>> autocorrelation may actually stem from misspecification of the model,
>> and I am wondering whether this is the case here. I do not have any
>> auxiliary variables such as spatially patterned ecological variables
>> that I could include in my model for the mean function. I can therefore
>> only really alter the choice of neighbour relationships and spatial
>> weights.
>
> No, see above.
>
>>
>> With regard to the neighbourhood relationships: I decided to choose
>> distance based neighbours such that all areas have at least one
>> neighbour (via all.linked). Contiguity-based or grid-based neighbours
>> are not appropriate for my data; with graph-based neighbours I run into
>> troubles because 7 of my coordinates are duplicated. Knn or higher order
>> neighbours ran into issues when I tried to implement them. In light of
>> these observations and my data, is my distance-based approach sensible?
>
> Beware of inverse distance when points are duplicated, the effects may be
> perverse. Either aggregate the duplicated points, or disambiguate them -
> move them apart. Your determination of position is likely to incur
> measurement error when the geocoder defaults to an approximation. Can you
> get more precise coordinates by zooming in on for example Google Earth,
> marking points, and dumping to KML? The KML can be read with readOGR() in
> rgdal. With disambiguated points, you can use graph-based neighbours.
>
> Hope this helps,
>
> Roger
>
>>
>> With regard to the assignment of spatial weights: I would have believed
>> that it is sensible to assume that the strength of potential spatial
>> autocorrelation in yields attenuates with distance between the areas
>> under consideration. I therefore favour approach C conceptually. However
>> Bivand et al. warn that if we know little about the assumed spatial
>> process we should avoid moving far from the binary representation of a
>> wight of unity for neighbours, which is what styles W and B (approaches
>> A and B) both implement as far as I understand? In light of these
>> observations and given the test results, which approach seems to be most
>> appropriate in my case?
>>
>> I would be extremely grateful for any advice you could give me.
>> Thank you!
>>
>> Julia
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From dkennedy at airsci.com  Tue Jul 19 23:05:19 2011
From: dkennedy at airsci.com (dman)
Date: Tue, 19 Jul 2011 14:05:19 -0700 (PDT)
Subject: [R-sig-Geo] spgrass6 "r.in.wms"
Message-ID: <1311109519878-6600318.post@n2.nabble.com>

All,

I'm trying to get some .wms info to plug into a process I have developed in
R. 

Has anyone tried to implement "r.in.wms" via R opened within GRASS? Here is
my swing at it.
http://r-sig-geo.2731867.n2.nabble.com/file/n6600318/question_to_r-sig_re_wms.txt
question_to_r-sig_re_wms.txt 
 
the error is around the maxrow, and maxcol not being integers. Is this a
issue of using "list"? or possibly something else?

As per, your august help and guidance is much appreciated. 

D



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spgrass6-r-in-wms-tp6600318p6600318.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From kevinwang at kpmg.com.au  Wed Jul 20 01:31:34 2011
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Wed, 20 Jul 2011 09:31:34 +1000
Subject: [R-sig-Geo] Changing Shapefile's Coordinates
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA031EB5BD@AUSYDEXC37.au.kworld.kpmg.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110720/cc86ad2d/attachment.pl>

From tgriffin at uaex.edu  Wed Jul 20 01:52:50 2011
From: tgriffin at uaex.edu (Terry Griffin)
Date: Tue, 19 Jul 2011 18:52:50 -0500 (CDT)
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
	Significance credible or due to misspecification of the model?
In-Reply-To: <F9EB2235ED697C48BC07DCDC4DD85A492744791B99@EXMBX06.ad.oak.ox.ac.uk>
Message-ID: <bd3bb199-9caf-4654-a562-f1f1d198dffa@zmail.uaex.edu>

Julia,

>From you initial question I had assumed you had 91 sub-field observations but your latest response has me questioning if I understood the original question.  Are your 91 observations in a single field or do you have 91 separate fields across a larger geographic region? I've added another comment below.

Terry


Terry Griffin, Ph.D.
Associate Professor - Economics
University of Arkansas - Division of Agriculture


----- Original Message -----
From: "Julia Dechamps" <julia.dechamps at jesus.ox.ac.uk>
To: "Roger Bivand" <Roger.Bivand at nhh.no>
Cc: r-sig-geo at r-project.org
Sent: Tuesday, July 19, 2011 1:01:14 PM
Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

Dear Roger,

I now used Google Maps to obtain (hopefully) more accurate coordinates of the areas. As it turns out, only for 44 out of the 91 areas, the coordinates seem to make sense/ were available. So I am now only looking at "mydata" which only contains 44 data points that are no longer representative of the original sample. This rather concerns me, but I can?t see a way out of it at the moment.

When using Delauny triangulation, I obtain the following nb object:
> mydata_nb2 <- tri2nb(coordinates(mydata_sp))
> summary(irrig_nb2)
Neighbour list object:
Number of regions: 44
Number of nonzero links: 242
Percentage nonzero weights: 12.5
Average number of links: 5.5
Link number distribution:

 3  4  5  6  7  8 10
 1  8 15 12  6  1  1
1 least connected region:
7 with 3 links
1 most connected region:
8 with 10 links

Using approach A and B from before for the construction of spatial weights I get the following test results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 6.438e-09
# "two.sided" p-value = 1.288e-08
# "less" p-value = 1

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = 1.874e-08
# "two-sided" p-value = 3.748e-08
# "less" p-value = 1

Having no experience in spatial statistics at all, I?m finding it difficult to envisage what spatial process (and hence what type of weights) would be appropriate for my data. I wouldn?t have thought that contagion would necessarily be appropriate (I might be misunderstanding contagion though, in which case I apologise): The grain under consideration is irrigated wheat and I wouldn?t expect yields to be influenced by similar agricultural practices spreading from one region to the next. I could imagine that nearby areas are influenced by similar weather phenomenons, however weather tends to be quite local, so maybe that?s not right either.

>>From Terry: one debate in agricultural yield data is whether the spatial error process or spatial lag process models are most appropriate; the spatial diagnostics sometimes point to a spatial lag process even when crop yield is the dependent variable which is in conflict with agronomic concepts. Based on conceptual reasons, I prefer to use the spatial error process model for these types of data where the contagion is in an underlying variable.

Another point to mention about my data is that my yields have already been smoothed prior to the averaging over years since they are aggregate yields from smaller subareas (for which no coordinates are available though). This might contribute to the origin of the apparent negative autocorrelation. When conducting a moran test for each of the 9 years separately (rather than for the average over the 9 years), the results do not change noticeably.

I am wondering whether I should maybe look for ways other than the moran test to get a rough idea whether spatial autocorrelation is present in the data or not...

Thank you very much for your time! I greatly appreciate your advice!

Regards,
Julia

________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 19 July 2011 15:15
To: Julia Dechamps
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear Roger,
>
> Thank you very much for your quick reply! Further to what you were asking ad 3.:
>
>> all.linked
> [1] 780.2701

Yes, this is the reason for the problems. I suggest improving the
coordinate measurements first, then constructing a graph-based neighbour
object, as your observations are very unevenly spaced. The construction of
the weights depends on the kind of spatial process you envision, which may
be contagion or perhaps diffusion in some form.

Note also that your temporal aggregation may smooth the data. I'm not
aware of appropriate tests for spatio-temporal processes, and that may be
what you really need. You may be aware that Cressie & Wikle (2011) has
appeared, and that space-time data is a very active area at the moment.

Roger

>
>> summary(mydata_nb)
> Neighbour list object:
> Number of regions: 91
> Number of nonzero links: 8168
> Percentage nonzero weights: 98.63543
> Average number of links: 89.75824
> Link number distribution:
>
> 87 88 89 90
> 4  3  4 80
> 4 least connected regions:
> 8 10 12 15 with 87 links
> 80 most connected regions:
> 1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links
>
> So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.9967
> # "two.sided" p-value = 0.00668
> # "less" p-value = 0.00334
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = 0.9968
> # "two-sided" p-value = 0.0064
> # "less" p-value = 0.0032
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
> When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.5
> # "two.sided" p-value = 1
> # "less" p-value = 0.5
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = NA
> # "two-sided" p-value = 1
> # "less" p-value = NA
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...
>
> I appreciate any further comments or suggestions you might have.
>
> Regards,
> Julia
>
>
>
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 19 July 2011 13:08
> To: Julia Dechamps
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?
>
> On Tue, 19 Jul 2011, Julia Dechamps wrote:
>
>> Dear list,
>>
>> I am new to spatial statistics and am working on the following: I have a
>> dataset of annual grain yields over 9 years for each of 91 (irregularly
>> spaced) areas. To begin with I averaged the yields over the 9 years, so
>> that I have 91 data points, which I would now like to test for the
>> presence of spatial autocorrelation via a global Moran I test
>> (moran.test in package spdep).
>>
>> Here is how I proceeded (where in steps 2. onwards I am trying to follow
>> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>>
>> 1. I obtained approximate geographical point coordinates (lat and long)
>> for the 91 areas using the online service
>> http://www.gpsvisualizer.com/geocoder/.
>>
>> 2. I created a spatial object:
>> myCRS <- CRS("+proj=longlat +ellps=WGS84")
>> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
>> colnames(mycoordmat) <- c("long","lat")
>> areanames <- paste("SD",1:91,sep="")
>> rownames(mycoordmat) <- areanames
>> sum(duplicated(mycoordmat))             # 7
>> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
>> coords <- coordinates(mydata_sp)
>>
>> 3. I created a distance based nbd:
>> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
>> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
>> mydata_nb <- dnearneigh(coords, 0, all.linked)
>
> What is all.linked - is it a large distance (in km)? What does
> summary(mydata_nb) say? Are most points connected to each other?
>
>>
>> 4. I created spatial weights for the nb object:
>> # approach A: default style W:
>> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>>
>> # approach A: binary style B:
>> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>>
>> # approach C: weights proportional to inverse distance btw. points representing the areas
>> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
>> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
>> idw <- lapply(dsts, function(x) 1/x)
>> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
>> summary(unlist(mydata_lw_idwW$weights))
>>
>> 5. Here are the resulting p-values from the global Moran tests:
>> # approach A:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
>> # Moran's I test under randomisation: p-value = 0.9967
>>
>> # approach B:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
>> # Moran's I test under randomisation: p-value = 0.9968
>>
>
> The two above are actually significant negative autocorrelation, if you
> change alternative to other than "greater" - the default. I think that
> almost all observations are connected to each other, leading to this
> effect.
>
>> # approach C:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
>> # Moran's I test under randomisation: p-value < 2.2e-16
>>
>> Now my questions:
>>
>> Approach C seems to suggests strong evidence for rejecting the null of
>> no spatial autocorrelation, whereas the other two approaches show
>> absolutely no evidence for rejecting the null of no spatial
>> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
>> autocorrelation may actually stem from misspecification of the model,
>> and I am wondering whether this is the case here. I do not have any
>> auxiliary variables such as spatially patterned ecological variables
>> that I could include in my model for the mean function. I can therefore
>> only really alter the choice of neighbour relationships and spatial
>> weights.
>
> No, see above.
>
>>
>> With regard to the neighbourhood relationships: I decided to choose
>> distance based neighbours such that all areas have at least one
>> neighbour (via all.linked). Contiguity-based or grid-based neighbours
>> are not appropriate for my data; with graph-based neighbours I run into
>> troubles because 7 of my coordinates are duplicated. Knn or higher order
>> neighbours ran into issues when I tried to implement them. In light of
>> these observations and my data, is my distance-based approach sensible?
>
> Beware of inverse distance when points are duplicated, the effects may be
> perverse. Either aggregate the duplicated points, or disambiguate them -
> move them apart. Your determination of position is likely to incur
> measurement error when the geocoder defaults to an approximation. Can you
> get more precise coordinates by zooming in on for example Google Earth,
> marking points, and dumping to KML? The KML can be read with readOGR() in
> rgdal. With disambiguated points, you can use graph-based neighbours.
>
> Hope this helps,
>
> Roger
>
>>
>> With regard to the assignment of spatial weights: I would have believed
>> that it is sensible to assume that the strength of potential spatial
>> autocorrelation in yields attenuates with distance between the areas
>> under consideration. I therefore favour approach C conceptually. However
>> Bivand et al. warn that if we know little about the assumed spatial
>> process we should avoid moving far from the binary representation of a
>> wight of unity for neighbours, which is what styles W and B (approaches
>> A and B) both implement as far as I understand? In light of these
>> observations and given the test results, which approach seems to be most
>> appropriate in my case?
>>
>> I would be extremely grateful for any advice you could give me.
>> Thank you!
>>
>> Julia
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From lists at remoteinformation.com.au  Wed Jul 20 08:51:43 2011
From: lists at remoteinformation.com.au (Ben Madin)
Date: Wed, 20 Jul 2011 14:51:43 +0800
Subject: [R-sig-Geo] Problem re-projecting Spatstat ppm model from lonlat to
	utm
Message-ID: <1444A54A-1331-4B53-8F04-14FFDED1426B@remoteinformation.com.au>

G'day all,

I have been using the ppm() function to try (mainly successfully) to fit an outbreak pattern from the spatstat library (1-22)

This was giving me results that were consistent with my observations, showing a trend related to a village density and increasing towards the east of the region. However, the scalebar was somewhat out of range, and I've realised I was working in longitude/latitude for my coordinates. 

I've transformed all of the data to utm, and gone through the same process, but when I try to fit the same model, I'm getting the following messages:

fit2.utm <- ppm(outbreaks.utm.ppp, ~ x + y + dens, covariates=list(dens=vill.dens.utm), use.gam=TRUE)
Warning messages:
1: In countingweights(id, areas) :
 Some tiles with zero area contain points
2: In countingweights(id, areas) : Some weights are zero

The two (one) data sets are given below :
> summary(outbreaks.ll.ppp)
Marked planar point pattern: 2231 points
Average intensity 12.9 points per square unit  
Multitype:
       frequency proportion intensity
A             222    0.09950    1.2800
Asia1           7    0.00314    0.0403
O            1090    0.48900    6.2800
Unknown       912    0.40900    5.2600

Window: polygonal boundary
single connected closed polygon with 2222 vertices
enclosing rectangle: [92.20499, 109.46484]x[1.269528, 28.546524]units
Window area =  173.539 square units 

*** 36 illegal points stored in attr(,?rejects?) ***
> summary(outbreaks.utm.ppp)
Marked planar point pattern: 2102 points
Average intensity 1.01e-09 points per square unit  
Multitype:
       frequency proportion intensity
A             215    0.10200  1.03e-10
Asia1           6    0.00285  2.88e-12
O            1000    0.47600  4.80e-10
Unknown       880    0.41900  4.22e-10

Window: polygonal boundary
single connected closed polygon with 2222 vertices
enclosing rectangle: [417539.8, 2308845.2]x[142732, 3166241]units
Window area =  2.08442e+12 square units 

*** 165 illegal points stored in attr(,?rejects?) ***



The result of the two models are given below :

> fit2.ll
Nonstationary multitype Poisson process
Possible marks: 
A Asia1 O Unknown

Trend formula: ~x + y + dens

Fitted coefficients for trend formula:
 (Intercept)             x             y          dens 
0.3513215637  0.0141986623 -0.0176586862  0.0004128483 

                Estimate         S.E. Ztest       CI95.lo       CI95.hi
(Intercept)  0.3513215637 4.494623e-01       -0.5296082814  1.2322514088
x            0.0141986623 4.211134e-03   ***  0.0059449912  0.0224523335
y           -0.0176586862 2.966964e-03   *** -0.0234738292 -0.0118435432
dens         0.0004128483 4.701333e-05   ***  0.0003207039  0.0005049927
Warning message:
model was fitted by gam(); asymptotic variance calculation ignores this 
> fit2.utm
Nonstationary multitype Poisson process
Possible marks: 
A Asia1 O Unknown

Trend formula: ~x + y + dens

Fitted coefficients for trend formula:
 (Intercept)             x             y          dens 
-2.193521e+01  1.991195e-07 -1.734678e-07  5.609414e+00 

Warning message:
model was fitted by gam(); asymptotic variance calculation ignores this 

and any attempt to plot fit2.utm fails - I suspect this is to do with 'empty' cells or the cell intensity? Is there some way around this?

cheers

Ben


sessionInfo()
R version 2.13.0 Patched (2011-05-26 r55996)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] en_AU.UTF-8/en_AU.UTF-8/C/C/en_AU.UTF-8/en_AU.UTF-8

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] spatstat_1.22-3     RandomFields_2.0.45 deldir_0.0-14      
 [4] mgcv_1.7-6          rgdal_0.6-33        Cairo_1.4-9        
 [7] surveillance_1.2-1  Matrix_0.999375-50  msm_1.0.1          
[10] vcd_1.2-11          colorspace_1.1-0    MASS_7.3-13        
[13] maptools_0.8-9      lattice_0.19-30     foreign_0.8-44     
[16] spc_0.4.0           xtable_1.5-6        rgeos_0.1-4        
[19] stringr_0.5         sp_0.9-83           zoo_1.6-5          
[22] RColorBrewer_1.0-5  RPostgreSQL_0.1-7   DBI_0.2-5          

loaded via a namespace (and not attached):
[1] mvtnorm_0.9-9991 nlme_3.1-101     plyr_1.5.2       splines_2.13.0  
[5] survival_2.36-9  tools_2.13.0   

From julia.dechamps at jesus.ox.ac.uk  Wed Jul 20 10:23:47 2011
From: julia.dechamps at jesus.ox.ac.uk (Julia Dechamps)
Date: Wed, 20 Jul 2011 09:23:47 +0100
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
 Significance credible or due to misspecification of the model?
In-Reply-To: <bd3bb199-9caf-4654-a562-f1f1d198dffa@zmail.uaex.edu>
References: <F9EB2235ED697C48BC07DCDC4DD85A492744791B99@EXMBX06.ad.oak.ox.ac.uk>,
	<bd3bb199-9caf-4654-a562-f1f1d198dffa@zmail.uaex.edu>
Message-ID: <F9EB2235ED697C48BC07DCDC4DD85A492744791B9A@EXMBX06.ad.oak.ox.ac.uk>

Julia,

>From you initial question I had assumed you had 91 sub-field observations but your latest response has me questioning if I understood the original question.  Are your 91 observations in a single field or do you have 91 separate fields across a larger geographic region? I've added another comment below.

>> Thank you for your comment below.
>> I have 91 areas across a large geopgraphic area. For each area, crop yield estimation was carried out in order to obtain a representative yield estimate.

Terry


Terry Griffin, Ph.D.
Associate Professor - Economics
University of Arkansas - Division of Agriculture


----- Original Message -----
From: "Julia Dechamps" <julia.dechamps at jesus.ox.ac.uk>
To: "Roger Bivand" <Roger.Bivand at nhh.no>
Cc: r-sig-geo at r-project.org
Sent: Tuesday, July 19, 2011 1:01:14 PM
Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

Dear Roger,

I now used Google Maps to obtain (hopefully) more accurate coordinates of the areas. As it turns out, only for 44 out of the 91 areas, the coordinates seem to make sense/ were available. So I am now only looking at "mydata" which only contains 44 data points that are no longer representative of the original sample. This rather concerns me, but I can?t see a way out of it at the moment.

When using Delauny triangulation, I obtain the following nb object:
> mydata_nb2 <- tri2nb(coordinates(mydata_sp))
> summary(irrig_nb2)
Neighbour list object:
Number of regions: 44
Number of nonzero links: 242
Percentage nonzero weights: 12.5
Average number of links: 5.5
Link number distribution:

 3  4  5  6  7  8 10
 1  8 15 12  6  1  1
1 least connected region:
7 with 3 links
1 most connected region:
8 with 10 links

Using approach A and B from before for the construction of spatial weights I get the following test results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 6.438e-09
# "two.sided" p-value = 1.288e-08
# "less" p-value = 1

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = 1.874e-08
# "two-sided" p-value = 3.748e-08
# "less" p-value = 1

Having no experience in spatial statistics at all, I?m finding it difficult to envisage what spatial process (and hence what type of weights) would be appropriate for my data. I wouldn?t have thought that contagion would necessarily be appropriate (I might be misunderstanding contagion though, in which case I apologise): The grain under consideration is irrigated wheat and I wouldn?t expect yields to be influenced by similar agricultural practices spreading from one region to the next. I could imagine that nearby areas are influenced by similar weather phenomenons, however weather tends to be quite local, so maybe that?s not right either.

>>From Terry: one debate in agricultural yield data is whether the spatial error process or spatial lag process models are most appropriate; the spatial diagnostics sometimes point to a spatial lag process even when crop yield is the dependent variable which is in conflict with agronomic concepts. Based on conceptual reasons, I prefer to use the spatial error process model for these types of data where the contagion is in an underlying variable.

Another point to mention about my data is that my yields have already been smoothed prior to the averaging over years since they are aggregate yields from smaller subareas (for which no coordinates are available though). This might contribute to the origin of the apparent negative autocorrelation. When conducting a moran test for each of the 9 years separately (rather than for the average over the 9 years), the results do not change noticeably.

I am wondering whether I should maybe look for ways other than the moran test to get a rough idea whether spatial autocorrelation is present in the data or not...

Thank you very much for your time! I greatly appreciate your advice!

Regards,
Julia

________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 19 July 2011 15:15
To: Julia Dechamps
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear Roger,
>
> Thank you very much for your quick reply! Further to what you were asking ad 3.:
>
>> all.linked
> [1] 780.2701

Yes, this is the reason for the problems. I suggest improving the
coordinate measurements first, then constructing a graph-based neighbour
object, as your observations are very unevenly spaced. The construction of
the weights depends on the kind of spatial process you envision, which may
be contagion or perhaps diffusion in some form.

Note also that your temporal aggregation may smooth the data. I'm not
aware of appropriate tests for spatio-temporal processes, and that may be
what you really need. You may be aware that Cressie & Wikle (2011) has
appeared, and that space-time data is a very active area at the moment.

Roger

>
>> summary(mydata_nb)
> Neighbour list object:
> Number of regions: 91
> Number of nonzero links: 8168
> Percentage nonzero weights: 98.63543
> Average number of links: 89.75824
> Link number distribution:
>
> 87 88 89 90
> 4  3  4 80
> 4 least connected regions:
> 8 10 12 15 with 87 links
> 80 most connected regions:
> 1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links
>
> So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.9967
> # "two.sided" p-value = 0.00668
> # "less" p-value = 0.00334
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = 0.9968
> # "two-sided" p-value = 0.0064
> # "less" p-value = 0.0032
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
> When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.5
> # "two.sided" p-value = 1
> # "less" p-value = 0.5
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = NA
> # "two-sided" p-value = 1
> # "less" p-value = NA
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...
>
> I appreciate any further comments or suggestions you might have.
>
> Regards,
> Julia
>
>
>
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 19 July 2011 13:08
> To: Julia Dechamps
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?
>
> On Tue, 19 Jul 2011, Julia Dechamps wrote:
>
>> Dear list,
>>
>> I am new to spatial statistics and am working on the following: I have a
>> dataset of annual grain yields over 9 years for each of 91 (irregularly
>> spaced) areas. To begin with I averaged the yields over the 9 years, so
>> that I have 91 data points, which I would now like to test for the
>> presence of spatial autocorrelation via a global Moran I test
>> (moran.test in package spdep).
>>
>> Here is how I proceeded (where in steps 2. onwards I am trying to follow
>> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>>
>> 1. I obtained approximate geographical point coordinates (lat and long)
>> for the 91 areas using the online service
>> http://www.gpsvisualizer.com/geocoder/.
>>
>> 2. I created a spatial object:
>> myCRS <- CRS("+proj=longlat +ellps=WGS84")
>> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
>> colnames(mycoordmat) <- c("long","lat")
>> areanames <- paste("SD",1:91,sep="")
>> rownames(mycoordmat) <- areanames
>> sum(duplicated(mycoordmat))             # 7
>> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
>> coords <- coordinates(mydata_sp)
>>
>> 3. I created a distance based nbd:
>> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
>> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
>> mydata_nb <- dnearneigh(coords, 0, all.linked)
>
> What is all.linked - is it a large distance (in km)? What does
> summary(mydata_nb) say? Are most points connected to each other?
>
>>
>> 4. I created spatial weights for the nb object:
>> # approach A: default style W:
>> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>>
>> # approach A: binary style B:
>> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>>
>> # approach C: weights proportional to inverse distance btw. points representing the areas
>> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
>> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
>> idw <- lapply(dsts, function(x) 1/x)
>> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
>> summary(unlist(mydata_lw_idwW$weights))
>>
>> 5. Here are the resulting p-values from the global Moran tests:
>> # approach A:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
>> # Moran's I test under randomisation: p-value = 0.9967
>>
>> # approach B:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
>> # Moran's I test under randomisation: p-value = 0.9968
>>
>
> The two above are actually significant negative autocorrelation, if you
> change alternative to other than "greater" - the default. I think that
> almost all observations are connected to each other, leading to this
> effect.
>
>> # approach C:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
>> # Moran's I test under randomisation: p-value < 2.2e-16
>>
>> Now my questions:
>>
>> Approach C seems to suggests strong evidence for rejecting the null of
>> no spatial autocorrelation, whereas the other two approaches show
>> absolutely no evidence for rejecting the null of no spatial
>> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
>> autocorrelation may actually stem from misspecification of the model,
>> and I am wondering whether this is the case here. I do not have any
>> auxiliary variables such as spatially patterned ecological variables
>> that I could include in my model for the mean function. I can therefore
>> only really alter the choice of neighbour relationships and spatial
>> weights.
>
> No, see above.
>
>>
>> With regard to the neighbourhood relationships: I decided to choose
>> distance based neighbours such that all areas have at least one
>> neighbour (via all.linked). Contiguity-based or grid-based neighbours
>> are not appropriate for my data; with graph-based neighbours I run into
>> troubles because 7 of my coordinates are duplicated. Knn or higher order
>> neighbours ran into issues when I tried to implement them. In light of
>> these observations and my data, is my distance-based approach sensible?
>
> Beware of inverse distance when points are duplicated, the effects may be
> perverse. Either aggregate the duplicated points, or disambiguate them -
> move them apart. Your determination of position is likely to incur
> measurement error when the geocoder defaults to an approximation. Can you
> get more precise coordinates by zooming in on for example Google Earth,
> marking points, and dumping to KML? The KML can be read with readOGR() in
> rgdal. With disambiguated points, you can use graph-based neighbours.
>
> Hope this helps,
>
> Roger
>
>>
>> With regard to the assignment of spatial weights: I would have believed
>> that it is sensible to assume that the strength of potential spatial
>> autocorrelation in yields attenuates with distance between the areas
>> under consideration. I therefore favour approach C conceptually. However
>> Bivand et al. warn that if we know little about the assumed spatial
>> process we should avoid moving far from the binary representation of a
>> wight of unity for neighbours, which is what styles W and B (approaches
>> A and B) both implement as far as I understand? In light of these
>> observations and given the test results, which approach seems to be most
>> appropriate in my case?
>>
>> I would be extremely grateful for any advice you could give me.
>> Thank you!
>>
>> Julia
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From b.rowlingson at lancaster.ac.uk  Wed Jul 20 13:20:53 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Wed, 20 Jul 2011 12:20:53 +0100
Subject: [R-sig-Geo] Changing Shapefile's Coordinates
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA031EB5BD@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA031EB5BD@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <CANVKczPyjhzH8JJQWA0vSiuZjTwFOMGpx4LBRw7R3n9S33rQqw@mail.gmail.com>

On Wed, Jul 20, 2011 at 12:31 AM, Wang, Kevin (SYD)
<kevinwang at kpmg.com.au> wrote:
> Hi,
>
>
>
> I'm just wondering if it's possible, in R, to modify a shapefile's
> coordinates?
>
>
>
> I've shapefiles for each state/territory of Australia, and in them there
> are local government areas coordinates. ?Using readShapePoly(), I am
> able to read them in and plot each state with its local government
> areas.
>
>
>
> However, I also want to be able to "merge" local government areas into
> roughly north-east-south-west - i.e. draw a state then divide it roughly
> into four quadrants (or divide it in other ways by merging various local
> government areas). ? Is there any easy way that I can manipulate the
> shapefile to do this?
>

 Another job for rgeos!

 Can do something with gUnionCascaded?:

library(maptools);library(rgeos)
xx <- readShapeSpatial(system.file("shapes/sids.shp",
package="maptools")[1],IDvar="FIPSNO", proj4string=CRS("+proj=longlat
+ellps=clrk66"))

# plot it, label it:

 plot(xx)
 text(coordinates(xx),as.character(1:nrow(xx)))

# now suppose we want to merge these regions:

 z1 = c(10,24,9,71)

# we do:
zx=gUnionCascaded(xx[z1,])


# which gives us a SpatialPolygons object with (in this case) one ring:

 plot(zx,add=TRUE,col="#80808080")


Repeat for each of your regions and splat everything together as a
SpatialPolygonsDataFrame if thats what you need.

Look out for digitising errors which result in slivers and other junk
where adjacent polygons dont match up.

Barry


From Roger.Bivand at nhh.no  Wed Jul 20 13:54:40 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 20 Jul 2011 13:54:40 +0200 (CEST)
Subject: [R-sig-Geo] spgrass6 "r.in.wms"
In-Reply-To: <1311109519878-6600318.post@n2.nabble.com>
References: <1311109519878-6600318.post@n2.nabble.com>
Message-ID: <alpine.LRH.2.00.1107201346550.10491@reclus.nhh.no>

On Tue, 19 Jul 2011, dman wrote:

> All,
>
> I'm trying to get some .wms info to plug into a process I have developed in
> R.
>
> Has anyone tried to implement "r.in.wms" via R opened within GRASS? Here is
> my swing at it.
> http://r-sig-geo.2731867.n2.nabble.com/file/n6600318/question_to_r-sig_re_wms.txt
> question_to_r-sig_re_wms.txt
>
> the error is around the maxrow, and maxcol not being integers. Is this a
> issue of using "list"? or possibly something else?

Your input:

pars<-list(mapserver="http://wms.jpl.nasa.gov/wms.cgi", format="jpeg",
   maxrows=5, maxcols=5, method="nearest")

is not correct. When GRASS wants an integer, it has to be an integer. The 
command works with:

pars<-list(mapserver="http://wms.jpl.nasa.gov/wms.cgi", format="jpeg",
   maxrows=as.integer(5), maxcols=as.integer(5), method="nearest")

and

pars<-list(mapserver="http://wms.jpl.nasa.gov/wms.cgi", format="jpeg",
   maxrows=5L, maxcols=5L, method="nearest")

where 5L defines an integer constant.

See

is.integer(5)

a numeric constant, and

is.integer(5L)

If you need WMS access directly from R, and if your GDAL is build with WMS 
support, you may also be able to use readGDAL() or similar rgdal functions 
directly.

Hope this helps,

Roger

>
> As per, your august help and guidance is much appreciated.
>
> D
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spgrass6-r-in-wms-tp6600318p6600318.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From kevinwang at kpmg.com.au  Thu Jul 21 08:59:57 2011
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Thu, 21 Jul 2011 16:59:57 +1000
Subject: [R-sig-Geo] Changing Shapefile's Coordinates
In-Reply-To: <CANVKczPyjhzH8JJQWA0vSiuZjTwFOMGpx4LBRw7R3n9S33rQqw@mail.gmail.com>
References: <378EB90FD48A9E47A49222E07DF06BAA031EB5BD@AUSYDEXC37.au.kworld.kpmg.com>
	<CANVKczPyjhzH8JJQWA0vSiuZjTwFOMGpx4LBRw7R3n9S33rQqw@mail.gmail.com>
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA03246F1A@AUSYDEXC37.au.kworld.kpmg.com>

Thanks Barry, it worked!

By the way, is there a way to "rescale" the map (other than enlarge plotting window once the map is drawn)?  I'm asking this because there are a few local government areas that are too small (and hence I can't see the text (coordinates) plotted on it).

Cheers
Kevin

-----Original Message-----
From: b.rowlingson at googlemail.com [mailto:b.rowlingson at googlemail.com] On Behalf Of Barry Rowlingson
Sent: Wednesday, 20 July 2011 9:21 PM
To: Wang, Kevin (SYD)
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Changing Shapefile's Coordinates

On Wed, Jul 20, 2011 at 12:31 AM, Wang, Kevin (SYD) <kevinwang at kpmg.com.au> wrote:
> Hi,
>
>
>
> I'm just wondering if it's possible, in R, to modify a shapefile's 
> coordinates?
>
>
>
> I've shapefiles for each state/territory of Australia, and in them 
> there are local government areas coordinates. ?Using readShapePoly(), 
> I am able to read them in and plot each state with its local 
> government areas.
>
>
>
> However, I also want to be able to "merge" local government areas into 
> roughly north-east-south-west - i.e. draw a state then divide it 
> roughly into four quadrants (or divide it in other ways by merging 
> various local government areas). ? Is there any easy way that I can 
> manipulate the shapefile to do this?
>

 Another job for rgeos!

 Can do something with gUnionCascaded?:

library(maptools);library(rgeos)
xx <- readShapeSpatial(system.file("shapes/sids.shp",
package="maptools")[1],IDvar="FIPSNO", proj4string=CRS("+proj=longlat
+ellps=clrk66"))

# plot it, label it:

 plot(xx)
 text(coordinates(xx),as.character(1:nrow(xx)))

# now suppose we want to merge these regions:

 z1 = c(10,24,9,71)

# we do:
zx=gUnionCascaded(xx[z1,])


# which gives us a SpatialPolygons object with (in this case) one ring:

 plot(zx,add=TRUE,col="#80808080")


Repeat for each of your regions and splat everything together as a SpatialPolygonsDataFrame if thats what you need.

Look out for digitising errors which result in slivers and other junk where adjacent polygons dont match up.

Barry


******************************************************************

The information in this e-mail is confidential and may be legally
privileged. It is intended solely for the addressee. Access to this
e-mail by anyone else is unauthorised. If you have received this
communication in error, please notify us immediately by return
e-mail with the subject heading "Received in error" or telephone
+61 2 93357000, then delete the email and destroy any copies of it.
If you are not the intended recipient, any disclosure, copying,
distribution or any action taken or omitted to be taken in reliance
on it, is prohibited and may be unlawful. Any opinions or advice
contained in this e-mail are subject to the terms and conditions
expressed in the governing KPMG client engagement letter. Opinions,
conclusions and other information in this e-mail and any
attachments that do not relate to the official business of the firm
are neither given nor endorsed by it. 

KPMG cannot guarantee that e-mail communications are secure or
error-free, as information could be intercepted, corrupted,
amended, lost, destroyed, arrive late or incomplete, or contain
viruses. 

KPMG, an Australian partnership and a member firm of the KPMG
network of independent member firms affiliated with KPMG
International Cooperative (?KPMG International?), a Swiss entity. 
KPMG International provides no services to clients.  

Liability limited by a scheme approved under Professional Standards
Legislation. 

******************************************************************


From francescokar at gmail.com  Thu Jul 21 10:21:19 2011
From: francescokar at gmail.com (Francesco Carrer)
Date: Thu, 21 Jul 2011 10:21:19 +0200
Subject: [R-sig-Geo] raw residual calculation
Message-ID: <CAKEj=di03nHQAmQvc8wATi0hQ+apPoAay_R54Mmo1dVx3dUrkw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110721/69332d94/attachment.pl>

From paul.hiemstra at knmi.nl  Thu Jul 21 10:48:17 2011
From: paul.hiemstra at knmi.nl (Paul Hiemstra)
Date: Thu, 21 Jul 2011 08:48:17 +0000
Subject: [R-sig-Geo] raw residual calculation
In-Reply-To: <CAKEj=di03nHQAmQvc8wATi0hQ+apPoAay_R54Mmo1dVx3dUrkw@mail.gmail.com>
References: <CAKEj=di03nHQAmQvc8wATi0hQ+apPoAay_R54Mmo1dVx3dUrkw@mail.gmail.com>
Message-ID: <4E27E7D1.1020208@knmi.nl>

 On 07/21/2011 08:21 AM, Francesco Carrer wrote:
> Hello!
>
> I am using R for locational modeling of mountain sites against environmental
> variables. I have carried out a multivariate regression analysis of my sites
> with two independent variables, but I need a method to calculate raw
> residuals of my distribution. What am I supposed to do?
>
> Thank you very much indeed!
>
> Francesco
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
Hi,

As I understand your (brief) question, take a look at the residuals
generic function.

lm.cars = lm(speed~dist, cars)
residuals(lm.cars)

cheers,
Paul

-- 
Paul Hiemstra, Ph.D.
Global Climate Division
Royal Netherlands Meteorological Institute (KNMI)
Wilhelminalaan 10 | 3732 GK | De Bilt | Kamer B 3.39
P.O. Box 201 | 3730 AE | De Bilt
tel: +31 30 2206 494

http://intamap.geo.uu.nl/~paul
http://nl.linkedin.com/pub/paul-hiemstra/20/30b/770


From paul.hiemstra at knmi.nl  Thu Jul 21 11:23:54 2011
From: paul.hiemstra at knmi.nl (Paul Hiemstra)
Date: Thu, 21 Jul 2011 09:23:54 +0000
Subject: [R-sig-Geo] alpha parameter in autofitVariogram
In-Reply-To: <EE7BEBF36F8790498BED43062183FF510476752F@e14mbx20n.Enterprise.emory.net>
References: <EE7BEBF36F8790498BED43062183FF510476752F@e14mbx20n.Enterprise.emory.net>
Message-ID: <4E27F02A.3090202@knmi.nl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110721/f01838fe/attachment.pl>

From c.lloyd at qub.ac.uk  Thu Jul 21 12:29:01 2011
From: c.lloyd at qub.ac.uk (Christopher Lloyd)
Date: Thu, 21 Jul 2011 11:29:01 +0100
Subject: [R-sig-Geo] dwt(wavelets)
Message-ID: <91ABC2E2A013C64D890FC0D7105D376310E97C706C@EX2K7-VIRT-2.ads.qub.ac.uk>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110721/592a2477/attachment.pl>

From karl at huftis.org  Thu Jul 21 13:18:44 2011
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Thu, 21 Jul 2011 13:18:44 +0200
Subject: [R-sig-Geo] =?utf-8?q?Calculating_areas_on_Earth=E2=80=99s_surfac?=
	=?utf-8?q?e?=
Message-ID: <j091uj$q3a$1@dough.gmane.org>

Calculating areas on Earth?s surface

I?m interested in the distortion in apparent area from various projections,
and need to calculate the *real* area of various polygons (or grid cells).
In an earlier post on this list, it was suggested to use a equal-area
projection. This partly works, but the accuracy is not good enough for
measuring the distortion for my purpose (I guess an accuracy < 0.05% for
moderately large areas would be OK).
 
Here?s a simple example:

library(sp)
library(rgdal)

unproj=CRS("+init=epsg:4326")                  # Unprojected, i.e. longitudes and latitudes
xy=GridTopology(c(0,55),c(8, 4), c(5,5))       # Small grid (covering Norway)
xy=as.SpatialPolygons.GridTopology(xy, unproj) # Grid as polygons

# Calculate the area of a polygons using the 'proj' projection
calcArea=function(xy, proj) {
  xy.trans=spTransform(xy, proj)
  sapply( xy.trans at polygons, function(x) x at area)/1e6
}

# Various equal-area projections
proj1=CRS("+proj=moll +lat_0=65 +lon_0=10") # Mollweide
proj2=CRS("+proj=sinu +lat_0=65 +lon_0=10") # Sinusoidal
proj3=CRS("+proj=tcea +lat_0=65 +lon_0=10") # Transverse Cylindrical
proj4=CRS("+init=epsg:32633")               # UTM 33N (*not* equal area)

# Areas according to the different projections all differ
a1=calcArea(xy, proj1)
a2=calcArea(xy, proj2)
a3=calcArea(xy, proj3)
a4=calcArea(xy, proj4)

# All areas calculated using Mollweide are small than the areas
# calculated using the sinusoidal projection:
all(a1<a2)

Since the areas from the various projections all differ, I?m not sure which 
one is most accurate. Does anyone know of a ?real? area function available 
somewhere in R, which can calculate the area of simple polygons on the WGS 84
ellipsoid (or perhaps even a spherical approximation would be good enough).
It would be very useful for drawing maps showing the distortion in area for
various projections.

-- 
Karl Ove Hufthammer


From carson.farmer at gmail.com  Thu Jul 21 13:58:17 2011
From: carson.farmer at gmail.com (Carson Farmer)
Date: Thu, 21 Jul 2011 12:58:17 +0100
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
Message-ID: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>

Dear list,

I'm sure there is a simple solution to my question, but I've scoured
the archives and tried every combination of parameters I can think of,
and still can't find a solution. All I want to do is 'remove' the
bounding box around my spplot plots. For those of you who like
reproducible examples, try the following:

library(lattice)
data(meuse)
coordinates(meuse) <- ~x+y
spplot(meuse, zcol="zinc")

Notice the black box around the plot (with the legend below). How can
I remove this bounding box?

Thanks in advance,

Carson

P.S.

sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-pc-linux-gnu (64-bit)

locale:
 [1] LC_CTYPE=en_IE.utf8       LC_NUMERIC=C
LC_TIME=en_IE.utf8
 [3] LC_COLLATE=en_IE.utf8     LC_MONETARY=C
LC_MESSAGES=en_IE.utf8
 [5] LC_PAPER=en_IE.utf8      LC_NAME=C                 LC_ADDRESS=C
 [8] LC_TELEPHONE=C            LC_MEASUREMENT=en_IE.utf8 LC_IDENTIFICATION=C

attached base packages:
[1] grid      stats     graphics  grDevices utils     datasets
methods   base

other attached packages:
 [1] maptools_0.8-6  lattice_0.19-30 foreign_0.8-44  rgeos_0.1-4
stringr_0.4     rgdal_0.6-33
 [7] classInt_0.1-14 e1071_1.5-25    class_7.3-3     sp_0.9-80
MASS_7.3-13

loaded via a namespace (and not attached):
[1] plyr_1.5.2   tools_2.13.1


From b.rowlingson at lancaster.ac.uk  Thu Jul 21 14:35:02 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 21 Jul 2011 13:35:02 +0100
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
Message-ID: <CANVKczNMjaMTBvRBZYRRg-RPCN-qV_x4B4CsoG4CMyX5quQtcA@mail.gmail.com>

On Thu, Jul 21, 2011 at 12:58 PM, Carson Farmer <carson.farmer at gmail.com> wrote:
> Dear list,
>
> I'm sure there is a simple solution to my question, but I've scoured
> the archives and tried every combination of parameters I can think of,
> and still can't find a solution. All I want to do is 'remove' the
> bounding box around my spplot plots. For those of you who like
> reproducible examples, try the following:
>
> library(lattice)
> data(meuse)
> coordinates(meuse) <- ~x+y
> spplot(meuse, zcol="zinc")
>
> Notice the black box around the plot (with the legend below). How can
> I remove this bounding box?

 After trawling through the documentation and delving deep into the
labyrinth of code that is trellis, my conclusion is:

 save the plot as an SVG and delete the box using Inkscape...

 Hopefully someone will have a better option, possibly involving
trellis.par.set (but I couldn't find it there).

Barry


From caspar.hallmann at gmail.com  Thu Jul 21 14:39:38 2011
From: caspar.hallmann at gmail.com (caspar hallmann)
Date: Thu, 21 Jul 2011 14:39:38 +0200
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CANVKczNMjaMTBvRBZYRRg-RPCN-qV_x4B4CsoG4CMyX5quQtcA@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
	<CANVKczNMjaMTBvRBZYRRg-RPCN-qV_x4B4CsoG4CMyX5quQtcA@mail.gmail.com>
Message-ID: <CAFZw66FynhhHqPfZatMcFmOkjUYJ4xkMaARoeeZzWXvn9LM=Eg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110721/005399fc/attachment.pl>

From carson.farmer at gmail.com  Thu Jul 21 15:04:13 2011
From: carson.farmer at gmail.com (Carson Farmer)
Date: Thu, 21 Jul 2011 14:04:13 +0100
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CAFZw66FynhhHqPfZatMcFmOkjUYJ4xkMaARoeeZzWXvn9LM=Eg@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
	<CANVKczNMjaMTBvRBZYRRg-RPCN-qV_x4B4CsoG4CMyX5quQtcA@mail.gmail.com>
	<CAFZw66FynhhHqPfZatMcFmOkjUYJ4xkMaARoeeZzWXvn9LM=Eg@mail.gmail.com>
Message-ID: <CADB6tZvgkm8gYBYMHnALN2m8eFvou3+a7gf+yzQjnWX+F_crAw@mail.gmail.com>

Caspar,
> One way out (since in R there are usually more) is
> trellis.par.set(axis.line=list(col=NA))
> then
> spplot(... etc
Cool, this works nicely...
> but then also the box around the legend dissapears. SOme one one this list
> has sent me code that corrects this bit but I cant seem to be able to find
> it at the moment.
This is indeed a bit of a problem, but for now it will work...
hopefully that someone from the list that sent you the code to correct
this is reading this :-P I'm really surprised this is such a difficult
thing to do... no wonder I keep defaulting to base graphics!

Cheers,

Carson


>
> On Thu, Jul 21, 2011 at 2:35 PM, Barry Rowlingson
> <b.rowlingson at lancaster.ac.uk> wrote:
>>
>> On Thu, Jul 21, 2011 at 12:58 PM, Carson Farmer <carson.farmer at gmail.com>
>> wrote:
>> > Dear list,
>> >
>> > I'm sure there is a simple solution to my question, but I've scoured
>> > the archives and tried every combination of parameters I can think of,
>> > and still can't find a solution. All I want to do is 'remove' the
>> > bounding box around my spplot plots. For those of you who like
>> > reproducible examples, try the following:
>> >
>> > library(lattice)
>> > data(meuse)
>> > coordinates(meuse) <- ~x+y
>> > spplot(meuse, zcol="zinc")
>> >
>> > Notice the black box around the plot (with the legend below). How can
>> > I remove this bounding box?
>>
>> ?After trawling through the documentation and delving deep into the
>> labyrinth of code that is trellis, my conclusion is:
>>
>> ?save the plot as an SVG and delete the box using Inkscape...
>>
>> ?Hopefully someone will have a better option, possibly involving
>> trellis.par.set (but I couldn't find it there).
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Carson J. Q. Farmer
ISSP Doctoral Fellow
National Centre for Geocomputation
National University of Ireland, Maynooth,
http://www.carsonfarmer.com/


From b.rowlingson at lancaster.ac.uk  Thu Jul 21 15:05:01 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 21 Jul 2011 14:05:01 +0100
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CAFZw66FynhhHqPfZatMcFmOkjUYJ4xkMaARoeeZzWXvn9LM=Eg@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
	<CANVKczNMjaMTBvRBZYRRg-RPCN-qV_x4B4CsoG4CMyX5quQtcA@mail.gmail.com>
	<CAFZw66FynhhHqPfZatMcFmOkjUYJ4xkMaARoeeZzWXvn9LM=Eg@mail.gmail.com>
Message-ID: <CANVKczPW8xrkXogNL4LHB2Tg9BZ=J1HH92+O2X_29T-8M9UDFg@mail.gmail.com>

On Thu, Jul 21, 2011 at 1:39 PM, caspar hallmann
<caspar.hallmann at gmail.com> wrote:
> One way out (since in R there are usually more) is
>
> trellis.par.set(axis.line=list(col=NA))
> then
> spplot(... etc
>
> but then also the box around the legend dissapears. SOme one one this list
> has sent me code that corrects this bit but I cant seem to be able to find
> it at the moment.

 I don't see a box around the legend anyway, with or without this
option... Has something changed? I'm using what some would say is an
'obsolete' version of R:

Barry

R version 2.12.1 (2010-12-16)
Platform: i486-pc-linux-gnu (32-bit)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] sp_0.9-81      lattice_0.18-3

loaded via a namespace (and not attached):
[1] grid_2.12.1  tools_2.12.1


From dkennedy at airsci.com  Thu Jul 21 19:57:41 2011
From: dkennedy at airsci.com (dman)
Date: Thu, 21 Jul 2011 10:57:41 -0700 (PDT)
Subject: [R-sig-Geo] spgrass6 "r.in.wms"
In-Reply-To: <alpine.LRH.2.00.1107201346550.10491@reclus.nhh.no>
References: <1311109519878-6600318.post@n2.nabble.com>
	<alpine.LRH.2.00.1107201346550.10491@reclus.nhh.no>
Message-ID: <1311271061637-6607855.post@n2.nabble.com>

Thank you Roger, 

I am currently chasing down the GDAL method you refer to instead of using
the GRASS method, will post results when they occur.

D

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/spgrass6-r-in-wms-tp6600318p6607855.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From djmuser at gmail.com  Thu Jul 21 21:36:58 2011
From: djmuser at gmail.com (Dennis Murphy)
Date: Thu, 21 Jul 2011 12:36:58 -0700
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
Message-ID: <CADv2QyEweLZsq_JogW-dhcVmFbkzZPd5=aUJxQY10uYFOXC3xw@mail.gmail.com>

Hi:

Is this what you had in mind?

# library(lattice)
spplot(meuse, zcol = 'zinc',
           par.settings = list(axis.line = list(col = 'transparent')))

The par.settings = part comes from the graphical parameters in
lattice. See trellis.par.get('axis.line') to get a list of the
(default) settings; par.settings() allows you to change the defaults
temporarily in the current call. See Chapter 7 of the Lattice book for
more details.

Reproducible examples are a Good Thing :)

HTH,
Dennis

On Thu, Jul 21, 2011 at 4:58 AM, Carson Farmer <carson.farmer at gmail.com> wrote:
> Dear list,
>
> I'm sure there is a simple solution to my question, but I've scoured
> the archives and tried every combination of parameters I can think of,
> and still can't find a solution. All I want to do is 'remove' the
> bounding box around my spplot plots. For those of you who like
> reproducible examples, try the following:
>
> library(lattice)
> data(meuse)
> coordinates(meuse) <- ~x+y
> spplot(meuse, zcol="zinc")
>
> Notice the black box around the plot (with the legend below). How can
> I remove this bounding box?
>
> Thanks in advance,
>
> Carson
>
> P.S.
>
> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-pc-linux-gnu (64-bit)
>
> locale:
> ?[1] LC_CTYPE=en_IE.utf8 ? ? ? LC_NUMERIC=C
> LC_TIME=en_IE.utf8
> ?[3] LC_COLLATE=en_IE.utf8 ? ? LC_MONETARY=C
> LC_MESSAGES=en_IE.utf8
> ?[5] LC_PAPER=en_IE.utf8 ? ? ?LC_NAME=C ? ? ? ? ? ? ? ? LC_ADDRESS=C
> ?[8] LC_TELEPHONE=C ? ? ? ? ? ?LC_MEASUREMENT=en_IE.utf8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] grid ? ? ?stats ? ? graphics ?grDevices utils ? ? datasets
> methods ? base
>
> other attached packages:
> ?[1] maptools_0.8-6 ?lattice_0.19-30 foreign_0.8-44 ?rgeos_0.1-4
> stringr_0.4 ? ? rgdal_0.6-33
> ?[7] classInt_0.1-14 e1071_1.5-25 ? ?class_7.3-3 ? ? sp_0.9-80
> MASS_7.3-13
>
> loaded via a namespace (and not attached):
> [1] plyr_1.5.2 ? tools_2.13.1
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From edzer.pebesma at uni-muenster.de  Thu Jul 21 21:50:32 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Thu, 21 Jul 2011 21:50:32 +0200
Subject: [R-sig-Geo] avoid plot frame (bounding box) in spplot
In-Reply-To: <CADv2QyEweLZsq_JogW-dhcVmFbkzZPd5=aUJxQY10uYFOXC3xw@mail.gmail.com>
References: <CADB6tZuogVAyoEm2vrHV3DTTMGUQH6x-xfBpZX8smDtF_CGm9g@mail.gmail.com>
	<CADv2QyEweLZsq_JogW-dhcVmFbkzZPd5=aUJxQY10uYFOXC3xw@mail.gmail.com>
Message-ID: <4E288308.8020701@uni-muenster.de>

(Cc:'ing to Deepayan) -- the problem refered to earlier seems to be that in

library(sp)
loadMeuse()
spplot(meuse.grid["dist"], par.settings =
    list(axis.line = list(col =  'transparent')))

not only the frame around the plot, but also the line around the legend
disappears. AFAICS lattice:::draw.colorkey is instructed right at the
start, at:

    axis.line <- trellis.par.get("axis.line")
    axis.text <- trellis.par.get("axis.text")

to use the same line characteristics that control the plot frame.
--
Edzer


On 07/21/2011 09:36 PM, Dennis Murphy wrote:
> Hi:
> 
> Is this what you had in mind?
> 
> # library(lattice)
> spplot(meuse, zcol = 'zinc',
>            par.settings = list(axis.line = list(col = 'transparent')))
> 
> The par.settings = part comes from the graphical parameters in
> lattice. See trellis.par.get('axis.line') to get a list of the
> (default) settings; par.settings() allows you to change the defaults
> temporarily in the current call. See Chapter 7 of the Lattice book for
> more details.
> 
> Reproducible examples are a Good Thing :)
> 
> HTH,
> Dennis
> 
> On Thu, Jul 21, 2011 at 4:58 AM, Carson Farmer <carson.farmer at gmail.com> wrote:
>> Dear list,
>>
>> I'm sure there is a simple solution to my question, but I've scoured
>> the archives and tried every combination of parameters I can think of,
>> and still can't find a solution. All I want to do is 'remove' the
>> bounding box around my spplot plots. For those of you who like
>> reproducible examples, try the following:
>>
>> library(lattice)
>> data(meuse)
>> coordinates(meuse) <- ~x+y
>> spplot(meuse, zcol="zinc")
>>
>> Notice the black box around the plot (with the legend below). How can
>> I remove this bounding box?
>>
>> Thanks in advance,
>>
>> Carson
>>
>> P.S.
>>
>> sessionInfo()
>> R version 2.13.1 (2011-07-08)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>>
>> locale:
>>  [1] LC_CTYPE=en_IE.utf8       LC_NUMERIC=C
>> LC_TIME=en_IE.utf8
>>  [3] LC_COLLATE=en_IE.utf8     LC_MONETARY=C
>> LC_MESSAGES=en_IE.utf8
>>  [5] LC_PAPER=en_IE.utf8      LC_NAME=C                 LC_ADDRESS=C
>>  [8] LC_TELEPHONE=C            LC_MEASUREMENT=en_IE.utf8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] grid      stats     graphics  grDevices utils     datasets
>> methods   base
>>
>> other attached packages:
>>  [1] maptools_0.8-6  lattice_0.19-30 foreign_0.8-44  rgeos_0.1-4
>> stringr_0.4     rgdal_0.6-33
>>  [7] classInt_0.1-14 e1071_1.5-25    class_7.3-3     sp_0.9-80
>> MASS_7.3-13
>>
>> loaded via a namespace (and not attached):
>> [1] plyr_1.5.2   tools_2.13.1
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From tgriffin at uaex.edu  Fri Jul 22 00:30:57 2011
From: tgriffin at uaex.edu (Terry Griffin)
Date: Thu, 21 Jul 2011 17:30:57 -0500 (CDT)
Subject: [R-sig-Geo] Moran Test for Spatial Autocorrelation -
	Significance credible or due to misspecification of the model?
In-Reply-To: <F9EB2235ED697C48BC07DCDC4DD85A492744791B9A@EXMBX06.ad.oak.ox.ac.uk>
Message-ID: <f1c81d62-a206-4221-8e53-ec382cad2755@zmail.uaex.edu>

Julia,

There are some techniques that may be useful to determine the proper connectedness of the spatial weights matrix. One method is the  spatial correlogram. I've played around with other techniques such as LM tests on the residuals of the aspatial model.

The two things you are looking for; 1) the proper connectedness of the spatial weights matrix and 2) whether the spatial range of your data is great enough to warrant spatial process model or simply use apatial ANOVA. Since your data are essentially point estimates (where the point represents the administrative unit or 'field' if I understand correctly) and these points are geographically far apart, there is good chance that the distance apart is greater than the spatial range such that no they are 'independent'.



Terry Griffin, Ph.D.
Associate Professor - Economics
University of Arkansas - Division of Agriculture
501.249.6360 (SMS)
tgriffin at uaex.edu




----- Original Message -----
From: "Julia Dechamps" <julia.dechamps at jesus.ox.ac.uk>
To: "Terry Griffin" <tgriffin at uaex.edu>
Cc: r-sig-geo at r-project.org
Sent: Wednesday, July 20, 2011 3:23:47 AM
Subject: RE: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

Julia,

>From you initial question I had assumed you had 91 sub-field observations but your latest response has me questioning if I understood the original question.  Are your 91 observations in a single field or do you have 91 separate fields across a larger geographic region? I've added another comment below.

>> Thank you for your comment below.
>> I have 91 areas across a large geopgraphic area. For each area, crop yield estimation was carried out in order to obtain a representative yield estimate.

Terry


Terry Griffin, Ph.D.
Associate Professor - Economics
University of Arkansas - Division of Agriculture


----- Original Message -----
From: "Julia Dechamps" <julia.dechamps at jesus.ox.ac.uk>
To: "Roger Bivand" <Roger.Bivand at nhh.no>
Cc: r-sig-geo at r-project.org
Sent: Tuesday, July 19, 2011 1:01:14 PM
Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

Dear Roger,

I now used Google Maps to obtain (hopefully) more accurate coordinates of the areas. As it turns out, only for 44 out of the 91 areas, the coordinates seem to make sense/ were available. So I am now only looking at "mydata" which only contains 44 data points that are no longer representative of the original sample. This rather concerns me, but I can?t see a way out of it at the moment.

When using Delauny triangulation, I obtain the following nb object:
> mydata_nb2 <- tri2nb(coordinates(mydata_sp))
> summary(irrig_nb2)
Neighbour list object:
Number of regions: 44
Number of nonzero links: 242
Percentage nonzero weights: 12.5
Average number of links: 5.5
Link number distribution:

 3  4  5  6  7  8 10
 1  8 15 12  6  1  1
1 least connected region:
7 with 3 links
1 most connected region:
8 with 10 links

Using approach A and B from before for the construction of spatial weights I get the following test results:

# approach A:
# default: Moran's I test under randomisation:
# "greater" p-value = 6.438e-09
# "two.sided" p-value = 1.288e-08
# "less" p-value = 1

# approach B:
# binary: Moran's I test under randomisation:
# "greater" p-value = 1.874e-08
# "two-sided" p-value = 3.748e-08
# "less" p-value = 1

Having no experience in spatial statistics at all, I?m finding it difficult to envisage what spatial process (and hence what type of weights) would be appropriate for my data. I wouldn?t have thought that contagion would necessarily be appropriate (I might be misunderstanding contagion though, in which case I apologise): The grain under consideration is irrigated wheat and I wouldn?t expect yields to be influenced by similar agricultural practices spreading from one region to the next. I could imagine that nearby areas are influenced by similar weather phenomenons, however weather tends to be quite local, so maybe that?s not right either.

>>From Terry: one debate in agricultural yield data is whether the spatial error process or spatial lag process models are most appropriate; the spatial diagnostics sometimes point to a spatial lag process even when crop yield is the dependent variable which is in conflict with agronomic concepts. Based on conceptual reasons, I prefer to use the spatial error process model for these types of data where the contagion is in an underlying variable.

Another point to mention about my data is that my yields have already been smoothed prior to the averaging over years since they are aggregate yields from smaller subareas (for which no coordinates are available though). This might contribute to the origin of the apparent negative autocorrelation. When conducting a moran test for each of the 9 years separately (rather than for the average over the 9 years), the results do not change noticeably.

I am wondering whether I should maybe look for ways other than the moran test to get a rough idea whether spatial autocorrelation is present in the data or not...

Thank you very much for your time! I greatly appreciate your advice!

Regards,
Julia

________________________________________
From: Roger Bivand [Roger.Bivand at nhh.no]
Sent: 19 July 2011 15:15
To: Julia Dechamps
Cc: r-sig-geo at r-project.org
Subject: RE: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?

On Tue, 19 Jul 2011, Julia Dechamps wrote:

> Dear Roger,
>
> Thank you very much for your quick reply! Further to what you were asking ad 3.:
>
>> all.linked
> [1] 780.2701

Yes, this is the reason for the problems. I suggest improving the
coordinate measurements first, then constructing a graph-based neighbour
object, as your observations are very unevenly spaced. The construction of
the weights depends on the kind of spatial process you envision, which may
be contagion or perhaps diffusion in some form.

Note also that your temporal aggregation may smooth the data. I'm not
aware of appropriate tests for spatio-temporal processes, and that may be
what you really need. You may be aware that Cressie & Wikle (2011) has
appeared, and that space-time data is a very active area at the moment.

Roger

>
>> summary(mydata_nb)
> Neighbour list object:
> Number of regions: 91
> Number of nonzero links: 8168
> Percentage nonzero weights: 98.63543
> Average number of links: 89.75824
> Link number distribution:
>
> 87 88 89 90
> 4  3  4 80
> 4 least connected regions:
> 8 10 12 15 with 87 links
> 80 most connected regions:
> 1 3 4 5 6 9 11 13 14 16 17 18 19 20 22 23 24 25 27 28 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 51 52 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 with 90 links
>
> So yes, most points seem connected to eachother. I repeated the tests (approaches A-C) with a two-sided alternative as well as a one-sided less than alternative and got the following results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.9967
> # "two.sided" p-value = 0.00668
> # "less" p-value = 0.00334
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = 0.9968
> # "two-sided" p-value = 0.0064
> # "less" p-value = 0.0032
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> Why might the fact that most of the areas are connected lead to significant negative autocorrelation tough?
> When aggregating the duplicated points (of which they are 7 in total) and repeating steps 2.-5. I end up with the following test results:
>
> # approach A:
> # default: Moran's I test under randomisation:
> # "greater" p-value = 0.5
> # "two.sided" p-value = 1
> # "less" p-value = 0.5
>
> # approach B:
> # binary: Moran's I test under randomisation:
> # "greater" p-value = NA
> # "two-sided" p-value = 1
> # "less" p-value = NA
>
> # approach C:
> # inverse: Moran's I test under randomisation:
> # "greater" p-value < 2.2e-16
> # "two.sided" p-value < 2.2e-16
> # "less" p-value = 1
>
> I think it is quite likely that the GPS coordinates I obtained are heavily approximated (the ares are quite large as they represent subdistricts in large states). I shall now try and obtain possibly more accurate coordinates for the 91 areas using the zoom on GoogleEarth...
>
> I appreciate any further comments or suggestions you might have.
>
> Regards,
> Julia
>
>
>
>
> ________________________________________
> From: Roger Bivand [Roger.Bivand at nhh.no]
> Sent: 19 July 2011 13:08
> To: Julia Dechamps
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Moran Test for Spatial Autocorrelation - Significance credible or due to misspecification of the model?
>
> On Tue, 19 Jul 2011, Julia Dechamps wrote:
>
>> Dear list,
>>
>> I am new to spatial statistics and am working on the following: I have a
>> dataset of annual grain yields over 9 years for each of 91 (irregularly
>> spaced) areas. To begin with I averaged the yields over the 9 years, so
>> that I have 91 data points, which I would now like to test for the
>> presence of spatial autocorrelation via a global Moran I test
>> (moran.test in package spdep).
>>
>> Here is how I proceeded (where in steps 2. onwards I am trying to follow
>> Roger Bivand et al: Applied Spatial Data Analysis with R, ch.9):
>>
>> 1. I obtained approximate geographical point coordinates (lat and long)
>> for the 91 areas using the online service
>> http://www.gpsvisualizer.com/geocoder/.
>>
>> 2. I created a spatial object:
>> myCRS <- CRS("+proj=longlat +ellps=WGS84")
>> mycoordmat <- matrix(c(mydata.agg$longitude,mydata.agg$latitude),ncol=2)
>> colnames(mycoordmat) <- c("long","lat")
>> areanames <- paste("SD",1:91,sep="")
>> rownames(mycoordmat) <- areanames
>> sum(duplicated(mycoordmat))             # 7
>> mydata_sp <- SpatialPoints(mycoordmat, proj4string=myCRS)
>> coords <- coordinates(mydata_sp)
>>
>> 3. I created a distance based nbd:
>> mydata_nb1 <- knn2nb(knearneigh(coords, k=1, longlat=TRUE))
>> all.linked <- max(unlist(nbdists(mydata_nb1, coords, longlat=TRUE)))
>> mydata_nb <- dnearneigh(coords, 0, all.linked)
>
> What is all.linked - is it a large distance (in km)? What does
> summary(mydata_nb) say? Are most points connected to each other?
>
>>
>> 4. I created spatial weights for the nb object:
>> # approach A: default style W:
>> mydata_lw_W <- nb2listw(mydata_nb, style="W")
>>
>> # approach A: binary style B:
>> mydata_lw_B <- nb2listw(mydata_nb, style="B")
>>
>> # approach C: weights proportional to inverse distance btw. points representing the areas
>> # (believing that the strength of the neighbour relationship, i.e. (??) autocorrelation attenuates with distance):
>> dsts <- nbdists(mydata_nb, coords, longlat=TRUE)
>> idw <- lapply(dsts, function(x) 1/x)
>> mydata_lw_idwW <- nb2listw(mydata_nb, glist=idw, style="W")
>> summary(unlist(mydata_lw_idwW$weights))
>>
>> 5. Here are the resulting p-values from the global Moran tests:
>> # approach A:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_W)
>> # Moran's I test under randomisation: p-value = 0.9967
>>
>> # approach B:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_B)
>> # Moran's I test under randomisation: p-value = 0.9968
>>
>
> The two above are actually significant negative autocorrelation, if you
> change alternative to other than "greater" - the default. I think that
> almost all observations are connected to each other, leading to this
> effect.
>
>> # approach C:
>> moran.test(mydata.agg$yr1to9avg, listw=irrig_lw_idwW)
>> # Moran's I test under randomisation: p-value < 2.2e-16
>>
>> Now my questions:
>>
>> Approach C seems to suggests strong evidence for rejecting the null of
>> no spatial autocorrelation, whereas the other two approaches show
>> absolutely no evidence for rejecting the null of no spatial
>> autocorrelation. Bivand et al. repeatedly warn that apparent spatial
>> autocorrelation may actually stem from misspecification of the model,
>> and I am wondering whether this is the case here. I do not have any
>> auxiliary variables such as spatially patterned ecological variables
>> that I could include in my model for the mean function. I can therefore
>> only really alter the choice of neighbour relationships and spatial
>> weights.
>
> No, see above.
>
>>
>> With regard to the neighbourhood relationships: I decided to choose
>> distance based neighbours such that all areas have at least one
>> neighbour (via all.linked). Contiguity-based or grid-based neighbours
>> are not appropriate for my data; with graph-based neighbours I run into
>> troubles because 7 of my coordinates are duplicated. Knn or higher order
>> neighbours ran into issues when I tried to implement them. In light of
>> these observations and my data, is my distance-based approach sensible?
>
> Beware of inverse distance when points are duplicated, the effects may be
> perverse. Either aggregate the duplicated points, or disambiguate them -
> move them apart. Your determination of position is likely to incur
> measurement error when the geocoder defaults to an approximation. Can you
> get more precise coordinates by zooming in on for example Google Earth,
> marking points, and dumping to KML? The KML can be read with readOGR() in
> rgdal. With disambiguated points, you can use graph-based neighbours.
>
> Hope this helps,
>
> Roger
>
>>
>> With regard to the assignment of spatial weights: I would have believed
>> that it is sensible to assume that the strength of potential spatial
>> autocorrelation in yields attenuates with distance between the areas
>> under consideration. I therefore favour approach C conceptually. However
>> Bivand et al. warn that if we know little about the assumed spatial
>> process we should avoid moving far from the binary representation of a
>> wight of unity for neighbours, which is what styles W and B (approaches
>> A and B) both implement as far as I understand? In light of these
>> observations and given the test results, which approach seems to be most
>> appropriate in my case?
>>
>> I would be extremely grateful for any advice you could give me.
>> Thank you!
>>
>> Julia
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
>

--
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From axel.urbiz at gmail.com  Fri Jul 22 01:33:43 2011
From: axel.urbiz at gmail.com (Axel Urbiz)
Date: Thu, 21 Jul 2011 19:33:43 -0400
Subject: [R-sig-Geo] SpatialPolygonsDataFrame to map conversion?
Message-ID: <CAAyVsXL-_BHByatui9Vo0d1R-LCfWQ9Ey2_Qs6wWJ0N5fV8WpQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110721/8b3f156c/attachment.pl>

From lestes at princeton.edu  Fri Jul 22 04:41:21 2011
From: lestes at princeton.edu (Lyndon Estes)
Date: Thu, 21 Jul 2011 22:41:21 -0400
Subject: [R-sig-Geo] raster Median function very slow on stack compared to
	mean: expected behavior?
Message-ID: <CALuVVaa8kvtQG7CfVZBuVvQRVWka_Ov6cooNV59r5=7H_qyNLQ@mail.gmail.com>

Dear List,

I am trying to extract the per-pixel median from a raster stack, and
am finding that the process takes a very long time relative to taking
the per-pixel mean. It is long enough that I have never actually seen
whether it successfully completes on my data, but this dummy example
shows the code structure I am using and the time differences between
the two functions:

stk <- stack(lapply(1:10, function(x) {
 r <- raster(nrow = 1000, ncol = 1000)
 r2 <- setValues(r, sample(1:100, size = ncell(r), replace = T, prob = NULL))
}))

setOptions(todisk = TRUE)  # I used this option to rule out memory issues
t1 <- Sys.time()
med <- calc(stk, Median, filename = "med.tif", datatype = "INT2S",
overwrite = T)
Sys.time() - t1  # 7.26 mins

t2 <- Sys.time()
med <- calc(stk, mean, filename = "mean.tif", datatype = "INT2S", overwrite = T)
Sys.time() - t2  # 2.34 secs
setOptions(todisk = FALSE)

Am I doing something wrong with my code, or is the speed difference I
am seeing expected?

Thanks in advance for your advice.

Cheers, Lyndon


> sessionInfo()
R version 2.13.1 (2011-07-08)
Platform: x86_64-apple-darwin9.8.0/x86_64 (64-bit)

locale:
[1] C/en_US.UTF-8/C/C/C/C

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets
methods   base

other attached packages:
 [1] doBy_4.4.0         MASS_7.3-13        snow_0.3-5
lme4_0.999375-39   Matrix_0.999375-50 lattice_0.19-30
multcomp_1.2-6
 [8] mvtnorm_0.9-999    R2HTML_2.2         survival_2.36-9
fields_6.3         spam_0.23-0        rgdal_0.7-1        raster_1.8-39
[15] sp_0.9-83

loaded via a namespace (and not attached):
[1] grid_2.13.1   nlme_3.1-101  stats4_2.13.1 tools_2.13.1


From E.Couce.07 at bristol.ac.uk  Fri Jul 22 13:14:41 2011
From: E.Couce.07 at bristol.ac.uk (Elena Couce Molina)
Date: Fri, 22 Jul 2011 12:14:41 +0100
Subject: [R-sig-Geo] Subsetting a SpatialPixels object: different behaviour
	with different versions of R and sp
Message-ID: <11306858-A276-4F2B-BCCE-D3F9D351B29B@bristol.ac.uk>


Dear all,

I have a code written under R version 2.10.1 and sp package 0.9-65  
that gives different results when it is run in a colleague's computer  
with a newer version of R and sp (R version 2.13.1 and sp version  
0.9-83). The code is simply the selection of a subset of a  
SpatialPixelsDataFrame object.

In my computer, the code behaves as I would expect:

 > summary(ModelData)

Object of class SpatialPixelsDataFrame
Coordinates:
   min max
x -180 180
y  -90  90
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 64800
Grid attributes:
  cellcentre.offset cellsize cells.dim
x            -179.5        1       360
y             -89.5        1       180
Data attributes:
   Temp_mean              Arag
  Min.   :   -1.884   Min.   :    1.259
  1st Qu.:    1.703   1st Qu.:    1.816
  Median :   16.251   Median :    2.814
  Mean   :   14.017   Mean   :    2.756
  3rd Qu.:   24.365   3rd Qu.:    3.599
  Max.   :   31.396   Max.   :    4.504
  NA's   :23457.000   NA's   :23734.000

# Selecting a subset:
lat_ok <- intersect(which(coordinates(ModelData)[, 2] <=
60),which(coordinates(ModelData)[, 2] >= -60))
ModelData_new <- ModelData[lat_ok,]

 > summary(ModelData_new)

Object of class SpatialPixelsDataFrame
Coordinates:
   min max
x -180 180
y  -60  60
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 43200
Grid attributes:
  cellcentre.offset cellsize cells.dim
x            -179.5        1       360
y             -59.5        1       120
Data attributes:
   Temp_mean               Arag
  Min.   :   -0.4695   Min.   :    1.380
  1st Qu.:   12.6654   1st Qu.:    2.539
  Median :   21.0919   Median :    3.220
  Mean   :   18.8588   Mean   :    3.107
  3rd Qu.:   25.4367   3rd Qu.:    3.746
  Max.   :   31.3959   Max.   :    4.504
  NA's   :11964.0000   NA's   :11968.000


In my friend's computer, although the bounding box of subsetted object  
changes, the "Grid attributes" dont:

 > summary(ModelData)

Object of class SpatialPixelsDataFrame
Coordinates:
  min max
x -180 180
y  -90  90
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 64800
Grid attributes:
  cellcentre.offset cellsize cells.dim
x            -179.5        1       360
y             -89.5        1       180
Data attributes:
  Temp_mean              Arag
  Min.   :   -1.884   Min.   :    1.259
  1st Qu.:    1.703   1st Qu.:    1.816
  Median :   16.251   Median :    2.814
  Mean   :   14.017   Mean   :    2.756
  3rd Qu.:   24.365   3rd Qu.:    3.599
  Max.   :   31.396   Max.   :    4.504
  NA's   :23457.000   NA's   :23734.000

 > # Selecting a subset:
 > lat_ok <- intersect(which(coordinates(ModelData)[, 2] <=
60),which(coordinates(ModelData)[, 2] >= -60))
 > ModelData_new <- ModelData[lat_ok,]

 > summary(ModelData_new)

Object of class SpatialPixelsDataFrame
Coordinates:
  min max
x -180 180
y  -60  60
Is projected: FALSE
proj4string : [+proj=longlat +ellps=WGS84]
Number of points: 43200
Grid attributes:
  cellcentre.offset cellsize cells.dim
x            -179.5        1       360
y             -89.5        1       180
Data attributes:
  Temp_mean               Arag
  Min.   :   -0.4695   Min.   :    1.380
  1st Qu.:   12.6654   1st Qu.:    2.539
  Median :   21.0919   Median :    3.220
  Mean   :   18.8588   Mean   :    3.107
  3rd Qu.:   25.4367   3rd Qu.:    3.746
  Max.   :   31.3959   Max.   :    4.504
  NA's   :11964.0000   NA's   :11968.000


Is this a bug? This creates problems later in the code when we try to  
convert the object into SpatialGrid class and get different bounding  
boxes...

Thanks for your help,
Elena


Details of the versions of R and installed packages we are using:

1) In my computer:

 > sessionInfo()

R version 2.10.1 (2009-12-14)
x86_64-apple-darwin9.8.0

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/
en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-24 sp_0.9-65

loaded via a namespace (and not attached):
[1] grid_2.10.1    lattice_0.18-3


2) For my friend's computer:

 > sessionInfo()

R version 2.13.1 (2011-07-08)
Platform: i386-apple-darwin9.8.0/i386 (32-bit)

locale:
[1] en_GB.UTF-8/en_GB.UTF-8/C/C/en_GB.UTF-8/en_GB.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.6-33 sp_0.9-83

loaded via a namespace (and not attached):
[1] grid_2.13.1     lattice_0.19-30


From edzer.pebesma at uni-muenster.de  Fri Jul 22 13:25:06 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 22 Jul 2011 13:25:06 +0200
Subject: [R-sig-Geo] Subsetting a SpatialPixels object: different
 behaviour with different versions of R and sp
In-Reply-To: <11306858-A276-4F2B-BCCE-D3F9D351B29B@bristol.ac.uk>
References: <11306858-A276-4F2B-BCCE-D3F9D351B29B@bristol.ac.uk>
Message-ID: <4E295E12.7090908@uni-muenster.de>

On 07/22/2011 01:14 PM, Elena Couce Molina wrote:
> 
> Is this a bug? This creates problems later in the code when we try to
> convert the object into SpatialGrid class and get different bounding
> boxes...

No, it was done on purpose. I shared it with the rspatial-devel list in
this message:

http://lists.r-forge.r-project.org/pipermail/rspatial-devel/2011-May/000001.html

but when it got released, indeed did not inform the r-sig-geo
subscribers -- which would have been a good idea.

You should get the old behaviour (for both old and new sp versions) by
adding drop=TRUE to the selection, as in

meuse.grid[1:10, drop=TRUE]

Please let me know if this resolves your problem.
-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From aelmore at usgs.gov  Fri Jul 22 16:45:57 2011
From: aelmore at usgs.gov (ahelmore)
Date: Fri, 22 Jul 2011 07:45:57 -0700 (PDT)
Subject: [R-sig-Geo] looping sp data
Message-ID: <1311345957939-6610701.post@n2.nabble.com>

Hi there,

I have a rather lengthy bit of code I want to run on a series of point
files, but I can't even figure out how to load shapefiles in a simple loop. 
Since readOGR takes shapefile names without the .shp extension, I thought I
could make a list of unduplicated file names, sans extensions and use that
to run the loop, but I'm getting a missing layer error.  After staring at it
for way too long, I'm looking for a leg up.  Can anyone tell me where my
thinking/code is off?

Here's what isn't working:

patt.xml <- ".*eden.*xml.*"
patt.shp <- ".*eden.*shp.*"
data.shp.xml <-list.files(pattern=patt.shp) # list of eden .shp & .shp.xml
data
data.xml <-list.files(pattern=patt.xml) # list of eden .shp.xml data
data.shp <- data.shp.xml[!data.shp.xml %in% data.xml] # list of .shp files
data.eden <- gsub(".shp","",data.shp) #stripping the extension


for (x in 1:length(data.eden)) {
     data<-readOGR(x) 
     summary(data)   
}

It gives me:  Error in readOGR(x) : missing layer

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/looping-sp-data-tp6610701p6610701.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From b.rowlingson at lancaster.ac.uk  Fri Jul 22 17:30:57 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Fri, 22 Jul 2011 16:30:57 +0100
Subject: [R-sig-Geo] looping sp data
In-Reply-To: <1311345957939-6610701.post@n2.nabble.com>
References: <1311345957939-6610701.post@n2.nabble.com>
Message-ID: <CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>

On Fri, Jul 22, 2011 at 3:45 PM, ahelmore <aelmore at usgs.gov> wrote:
> Hi there,
>
> I have a rather lengthy bit of code I want to run on a series of point
> files, but I can't even figure out how to load shapefiles in a simple loop.
> Since readOGR takes shapefile names without the .shp extension, I thought I
> could make a list of unduplicated file names, sans extensions and use that
> to run the loop, but I'm getting a missing layer error. ?After staring at it
> for way too long, I'm looking for a leg up. ?Can anyone tell me where my
> thinking/code is off?
>
> Here's what isn't working:
>
> patt.xml <- ".*eden.*xml.*"
> patt.shp <- ".*eden.*shp.*"
> data.shp.xml <-list.files(pattern=patt.shp) # list of eden .shp & .shp.xml
> data
> data.xml <-list.files(pattern=patt.xml) # list of eden .shp.xml data
> data.shp <- data.shp.xml[!data.shp.xml %in% data.xml] # list of .shp files
> data.eden <- gsub(".shp","",data.shp) #stripping the extension
>
>
> for (x in 1:length(data.eden)) {
> ? ? data<-readOGR(x)
> ? ? summary(data)
> }
>
> It gives me: ?Error in readOGR(x) : missing layer

 readOGR takes the directory or folder with the shapefile and the
truncated shapefile name. So to load ca.shp that is in my current
directory I do:

 > ca=readOGR(".","ca")
 OGR data source with driver: ESRI Shapefile
 Source: ".", layer: "ca"
 with 58 features and 15 fields
 Feature type: wkbPoint with 2 dimensions

Technically the source is the directory, and ca.shp is the layer, in
OGR terminology.

 You might find readShapeSpatial() in maptools useful, it loads
shapefiles given the path to a .shp file:

 > ca2 = readShapeSpatial("ca.shp")

however ca and ca2 aren't identical - I think its just minor
differences in the attributes...

Barry


From M.U.Kemp at uva.nl  Fri Jul 22 17:37:43 2011
From: M.U.Kemp at uva.nl (Kemp, Michael)
Date: Fri, 22 Jul 2011 17:37:43 +0200
Subject: [R-sig-Geo] looping sp data
In-Reply-To: <CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>
References: <1311345957939-6610701.post@n2.nabble.com>
	<CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>
Message-ID: <37382E8DCB905042969BA78541F6570601590138@kwek.ic.uva.nl>

Hello,

It also appears that there is an error in your loop.  Instead of...

for (x in 1:length(data.eden)) {
     data<-readOGR(x) 
     summary(data)   
}

Try...

for (x in 1:length(data.eden)) {
     data<-readOGR(data.eden[x]) 
     summary(data)   
}

Or...

for (x in data.eden) {
     data<-readOGR(x) 
     summary(data)   
}


Hope this helps,

Michael U. Kemp
University of Amsterdam
Computational Geo-Ecology

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Barry Rowlingson
Sent: Friday, July 22, 2011 5:31 PM
To: ahelmore
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] looping sp data

On Fri, Jul 22, 2011 at 3:45 PM, ahelmore <aelmore at usgs.gov> wrote:
> Hi there,
>
> I have a rather lengthy bit of code I want to run on a series of point
> files, but I can't even figure out how to load shapefiles in a simple loop.
> Since readOGR takes shapefile names without the .shp extension, I thought I
> could make a list of unduplicated file names, sans extensions and use that
> to run the loop, but I'm getting a missing layer error. ?After staring at it
> for way too long, I'm looking for a leg up. ?Can anyone tell me where my
> thinking/code is off?
>
> Here's what isn't working:
>
> patt.xml <- ".*eden.*xml.*"
> patt.shp <- ".*eden.*shp.*"
> data.shp.xml <-list.files(pattern=patt.shp) # list of eden .shp & .shp.xml
> data
> data.xml <-list.files(pattern=patt.xml) # list of eden .shp.xml data
> data.shp <- data.shp.xml[!data.shp.xml %in% data.xml] # list of .shp files
> data.eden <- gsub(".shp","",data.shp) #stripping the extension
>
>
> for (x in 1:length(data.eden)) {
> ? ? data<-readOGR(x)
> ? ? summary(data)
> }
>
> It gives me: ?Error in readOGR(x) : missing layer

 readOGR takes the directory or folder with the shapefile and the
truncated shapefile name. So to load ca.shp that is in my current
directory I do:

 > ca=readOGR(".","ca")
 OGR data source with driver: ESRI Shapefile
 Source: ".", layer: "ca"
 with 58 features and 15 fields
 Feature type: wkbPoint with 2 dimensions

Technically the source is the directory, and ca.shp is the layer, in
OGR terminology.

 You might find readShapeSpatial() in maptools useful, it loads
shapefiles given the path to a .shp file:

 > ca2 = readShapeSpatial("ca.shp")

however ca and ca2 aren't identical - I think its just minor
differences in the attributes...

Barry

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From sturgeon09 at gmail.com  Fri Jul 22 17:43:51 2011
From: sturgeon09 at gmail.com (Samuel Turgeon)
Date: Fri, 22 Jul 2011 11:43:51 -0400
Subject: [R-sig-Geo] looping sp data
In-Reply-To: <CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>
References: <1311345957939-6610701.post@n2.nabble.com>
	<CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>
Message-ID: <CAH3FZ05VekmCw+bRswmCnd6JApjN+nk+4BR_ZWQ2yA28QoJsvA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110722/5cb70f2f/attachment.pl>

From alexander.arpaci at boku.ac.at  Fri Jul 22 17:47:49 2011
From: alexander.arpaci at boku.ac.at (Alexander Arpaci)
Date: Fri, 22 Jul 2011 17:47:49 +0200
Subject: [R-sig-Geo] use Buffer for calculation on raster
Message-ID: <4E29B7C50200000300021B1D@gwia1.boku.ac.at>

Hello list,



I have created a list of buffer "spatialpolygons" which are stored in a list (thx to Barry) but what I want to do, is now use the area of each buffer to calculate an mean from  a set of pixel values falling into that buffer. I thought the easiest way is to create shape files and use them with the raster package but I am struggeling with creating  shape files from that list 
Maybe I am thinking too complicated ?
my code so far
wb_new<-readShapeSpatial("G:/Students/Nelson/wb_studyarea.shp")#spatial points used for the buffers


bufs=list() # store results as elements of a list


for(i in 1:98){bufs[[i]]=gBuffer(wb_new[i,],byid=TRUE,id=NULL,width=500,capStyle="ROUND")}
plot(sc)# the raster where I want to use the buffere areas
for (i in 1:98){
plot(bufs[[i]],add=TRUE)}
#so I can plot everything together but still missing the next steps
every help is appreciated
alex
 sessionInfo()
R version 2.12.2 (2011-02-25)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=German_Austria.1252  LC_CTYPE=German_Austria.1252   
[3] LC_MONETARY=German_Austria.1252 LC_NUMERIC=C                   
[5] LC_TIME=German_Austria.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] rgdal_0.7-1     rgeos_0.1-8     spatstat_1.22-1 deldir_0.0-13  
 [5] mgcv_1.7-6      SDMTools_1.1-5  maptools_0.8-9  lattice_0.19-26
 [9] raster_1.8-31   sp_0.9-83       foreign_0.8-42 

loaded via a namespace (and not attached):
[1] grid_2.12.2        Matrix_0.999375-50 nlme_3.1-98  


MSc. Alexander Arpaci
Assistant researcher

Department of Forest - and Soil Sciences
Institute of Silviculture
Tel. +43-1-47654-4081
e-mail: alexander.arpaci at boku.ac.at
www.wabo.boku.ac.at 


From aelmore at usgs.gov  Fri Jul 22 18:42:35 2011
From: aelmore at usgs.gov (Annette H Elmore)
Date: Fri, 22 Jul 2011 12:42:35 -0400
Subject: [R-sig-Geo] looping sp data
In-Reply-To: <37382E8DCB905042969BA78541F6570601590139@kwek.ic.uva.nl>
References: <1311345957939-6610701.post@n2.nabble.com>
	<CANVKczPp9U9Gz6Yq1pX-aTdcPuv21AQtvcsv+7Ds+oaJh=wD6w@mail.gmail.com>
	<37382E8DCB905042969BA78541F6570601590138@kwek.ic.uva.nl>
	<OF065300EF.C3D7ECA6-ON852578D5.0055FF7E-852578D5.00561A69@usgs.gov>
	<37382E8DCB905042969BA78541F6570601590139@kwek.ic.uva.nl>
Message-ID: <OF1893120D.EDE3C8EE-ON852578D5.005A48FB-852578D5.005BC5BB@usgs.gov>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110722/db1c4948/attachment.pl>

From r.hijmans at gmail.com  Fri Jul 22 18:50:04 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 22 Jul 2011 09:50:04 -0700 (PDT)
Subject: [R-sig-Geo] raster Median function very slow on stack compared
 to mean: expected behavior?
In-Reply-To: <CALuVVaa8kvtQG7CfVZBuVvQRVWka_Ov6cooNV59r5=7H_qyNLQ@mail.gmail.com>
References: <CALuVVaa8kvtQG7CfVZBuVvQRVWka_Ov6cooNV59r5=7H_qyNLQ@mail.gmail.com>
Message-ID: <1311353404479-6611150.post@n2.nabble.com>

> I am trying to extract the per-pixel median from a raster stack, and 
> am finding that the process takes a very long time relative to taking 
> the per-pixel mean. It is long enough that I have never actually seen 
> whether it successfully completes on my data, but this dummy example 
> shows the code structure I am using and the time differences between 
> the two functions: 
> 
> stk <- stack(lapply(1:10, function(x) { 
>  r <- raster(nrow = 1000, ncol = 1000) 
>  r2 <- setValues(r, sample(1:100, size = ncell(r), replace = T, prob =
> NULL)) 
> })) 
>
> setOptions(todisk = TRUE)  # I used this option to rule out memory issues 
> t1 <- Sys.time() 
> med <- calc(stk, Median, filename = "med.tif", datatype = "INT2S", 
> overwrite = T) 
> Sys.time() - t1  # 7.26 mins 
>
> t2 <- Sys.time() 
> med <- calc(stk, mean, filename = "mean.tif", datatype = "INT2S",
> overwrite = T) 
> Sys.time() - t2  # 2.34 secs 
> setOptions(todisk = FALSE) 
> 
>
> Am I doing something wrong with my code, or is the speed difference I 
> am seeing expected? 
>

Lyndon, 

Median (big M) was intended for use like Median(s) not for use in calc
(which did not exist yet); but I am surprised how slow it is in calc. Now we
have calc, you can use median (small m) and that is much quicker; and about
the same as Median(s); I think I will remove Median as it is no longer
needed. 

Either way, median will be slower than mean, which is expected:

> v = runif(1e+7)
> system.time(mean(v))
   user  system elapsed 
   0.09    0.00    0.09 
> system.time(median(v))  # 7 times slower
   user  system elapsed 
   0.56    0.06    0.63 
> 
> s <- stack(sapply(1:10, function(x) setValues(r, runif(ncell(r)))))
> r <- raster()
> 
> system.time(mean(s))
   user  system elapsed 
   4.75    0.02    4.79 
> system.time(calc(s, mean))
   user  system elapsed 
   0.25    0.00    0.26 

> system.time(Median(s))
   user  system elapsed 
   7.73    0.00    7.75 
> system.time(calc(s, median))
   user  system elapsed 
   8.48    0.00    8.54 
> system.time(calc(s, Median)) # slow!
   user  system elapsed 
  28.15    0.03   28.27 
> 
> 


Robert




--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-Median-function-very-slow-on-stack-compared-to-mean-expected-behavior-tp6609202p6611150.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Fri Jul 22 19:02:54 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 22 Jul 2011 10:02:54 -0700 (PDT)
Subject: [R-sig-Geo] use Buffer for calculation on raster
In-Reply-To: <4E29B7C50200000300021B1D@gwia1.boku.ac.at>
References: <4E29B7C50200000300021B1D@gwia1.boku.ac.at>
Message-ID: <1311354174374-6611183.post@n2.nabble.com>

> I have created a list of buffer "spatialpolygons" which are stored in a
list (thx to Barry) but what I want
> to do, is now use the area of each buffer to calculate an mean from  a set
> of pixel values falling into
> that buffer. I thought the easiest way is to create shape files and use
> them with the raster package but
> I am struggeling with creating  shape files from that list
> Maybe I am thinking too complicated ?

How about this:

wb_new <- readShapeSpatial("G:/Students/Nelson/wb_studyarea.shp")#spatial
points used for the buffers 

library(rgeos)
# no loops!
bufs = gBuffer(wb_new, byid=TRUE, id=NULL, width=500, capStyle="ROUND") 

library(raster)
x <- extract(sc, bufs)

x should be a list with a length equal to the number of points in wb_new

Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/use-Buffer-for-calculation-on-raster-tp6610936p6611183.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From csilva at ipimar.pt  Fri Jul 22 19:58:57 2011
From: csilva at ipimar.pt (Cristina Silva)
Date: Fri, 22 Jul 2011 18:58:57 +0100
Subject: [R-sig-Geo] Problem with "image" function
Message-ID: <4E29BA61.7050505@ipimar.pt>

Dear list members,

I have a SpatialGridDataFrame with sea depths. I have previously plotted 
this object using "image" with a grey scale. I have used exactly the 
same script and now the result is crossed by horizontal white lines.

As the script used was based in chunk no. 91 of cm_mod.R (book ASDAR, 
figure 2.7), I repeated this script

> oopar <- par(mar=c(1,1,1,1)+0.1)
> grys <- grey.colors(8, 0.55, 0.95, 2.2)
> image(auck_el1, "band1", col=grys)
> plot(auck_gshhs, add=TRUE, pbg="white")
> transect_sp <- SpatialPoints(coords=cbind(seq(174.458,175.3,0.000833333),
>   c(-37.03625)), proj4string=CRS("+proj=longlat +ellps=WGS84"))
> plot(transect_sp, add=TRUE, pch="-", cex=2)
> legend_image(c(174.2,174.25), c(-37.5,-37.2), auck_el1$band1, 
> vertical=TRUE,
>  offset.leg=0.8, col=grys)
> par(oopar)

and the result was also crossed by the same white horizontal lines.

I am using R version 2.13.1. I didn't have any problems with previous 
versions.

Thanks for your attention

Cristina

-- 
------------------------------------------
Cristina Silva
INRB/L-IPIMAR
Unidade de Recursos Marinhos e Sustentabilidade
Av. de Bras?lia, 1449-006 Lisboa
Portugal
Tel.: 351 21 3027096
Fax: 351 21 3015948
csilva at ipimar.pt


From matthew at matthewvavrek.com  Fri Jul 22 20:14:38 2011
From: matthew at matthewvavrek.com (Matthew Vavrek)
Date: Fri, 22 Jul 2011 14:14:38 -0400
Subject: [R-sig-Geo] Calculating areas on Earth?s surface
In-Reply-To: <mailman.11.1311328803.31685.r-sig-geo@r-project.org>
References: <mailman.11.1311328803.31685.r-sig-geo@r-project.org>
Message-ID: <4E29BE0E.1020609@matthewvavrek.com>

Karl,

have you looked at the PBSmapping package? It has a calcArea() function 
that might do what you need it to do. However, you need to get your data 
converted to a PolySet rather than a SpatialPolygons object.

library(sp)
library(rgdal)
library(maptools) #provides the SpaltialPolygons to PolySet converter
library(PBSmapping)

unproj=CRS("+init=epsg:4326")
xy=GridTopology(c(0,55),c(8, 4), c(5,5))
xy=as.SpatialPolygons.GridTopology(xy, unproj)

#convert to PolySet
ps.xy<-SpatialPolygons2PolySet(xy)
ps.xy<-as.PolySet(ps.xy, 'LL')
calcArea(ps.xy)

Cheers
Matthew


From roman.lustrik at gmail.com  Sat Jul 23 00:39:39 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 23 Jul 2011 00:39:39 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
Message-ID: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110723/e92221d3/attachment.pl>

From alexander.arpaci at boku.ac.at  Sat Jul 23 00:43:55 2011
From: alexander.arpaci at boku.ac.at (Alexander Arpaci)
Date: Sat, 23 Jul 2011 00:43:55 +0200
Subject: [R-sig-Geo] Antw: Re:  use Buffer for calculation on raster
Message-ID: <4E2A194B0200000300021B4F@gwia1.boku.ac.at>

Thank you very much for that quick reply and indeed I was too complicated...
your approach works great!But things are more complicated... I have different buffer width depending on the data accuracy

thats why I used primarily a loop. Now I run it again in a loop for creating the buffers and extracting the pixel values; its slow but it works. but the next problem is some of the buffer are extending over the raster extent so they yield NA values  
when I run than a sapply function to calculate the mean I get warnings and all values are NA. I seem not to be able to set a na.rm into the sapply function..


my code after your recommendation with result all bufferwidth equal even when I use the variable where different accuracy values are stored
bufs=gBuffer(wb_new,byid=TRUE,id=NULL,width=wb_new$DS_KO,capStyle="ROUND")
try<-extract(sc,bufs)
m<-sapply(try,FUN=mean)
plot(sc)
plot(bufs,add=TRUE)



my new loop code
for(i in 1:98){bufers[[i]]=gBuffer(wb_new[i,],byid=TRUE,id=NULL,width=wb_new$DS_KO[i],capStyle="ROUND")}

ext<-list()
for (i in 1:98){
ext[[i]]<- extract(sc,bufers[[i]])

}
mean_bufers<-sapply(ext,FUN=mean,na.rm=TRUE)
Es gab 50 oder mehr Warnungen (Anzeige der ersten 50 mit warnings())
mean_bufers
 [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 
any suggestions

thanks
alex



MSc. Alexander Arpaci
Assistant researcher

Department of Forest - and Soil Sciences
Institute of Silviculture
Tel. +43-1-47654-4081
e-mail: alexander.arpaci at boku.ac.at
www.wabo.boku.ac.at 
>>> Robert Hijmans  22.07.11 19.03 Uhr >>>
> I have created a list of buffer "spatialpolygons" which are stored in a
list (thx to Barry) but what I want
> to do, is now use the area of each buffer to calculate an mean from  a set
> of pixel values falling into
> that buffer. I thought the easiest way is to create shape files and use
> them with the raster package but
> I am struggeling with creating  shape files from that list
> Maybe I am thinking too complicated ?

How about this:

wb_new <- readShapeSpatial("G:/Students/Nelson/wb_studyarea.shp")#spatial
points used for the buffers 

library(rgeos)
# no loops!
bufs = gBuffer(wb_new, byid=TRUE, id=NULL, width=500, capStyle="ROUND") 

library(raster)
x <- extract(sc, bufs)

x should be a list with a length equal to the number of points in wb_new

Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/use-Buffer-for-calculation-on-raster-tp6610936p6611183.html
Sent from the R-sig-geo mailing list archive at Nabble.com.

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From renaud.lancelot at cirad.fr  Sat Jul 23 09:45:39 2011
From: renaud.lancelot at cirad.fr (lancelot)
Date: Sat, 23 Jul 2011 09:45:39 +0200
Subject: [R-sig-Geo] Problem with "image" function
In-Reply-To: <4E29BA61.7050505@ipimar.pt>
References: <4E29BA61.7050505@ipimar.pt>
Message-ID: <4E2A7C23.40505@cirad.fr>

Update R to the latest patched version.

R

Le 22/07/2011 19:58, Cristina Silva a ?crit :
> Dear list members,
>
> I have a SpatialGridDataFrame with sea depths. I have previously plotted
> this object using "image" with a grey scale. I have used exactly the
> same script and now the result is crossed by horizontal white lines.
>
> As the script used was based in chunk no. 91 of cm_mod.R (book ASDAR,
> figure 2.7), I repeated this script
>
>> oopar <- par(mar=c(1,1,1,1)+0.1)
>> grys <- grey.colors(8, 0.55, 0.95, 2.2)
>> image(auck_el1, "band1", col=grys)
>> plot(auck_gshhs, add=TRUE, pbg="white")
>> transect_sp <- SpatialPoints(coords=cbind(seq(174.458,175.3,0.000833333),
>> c(-37.03625)), proj4string=CRS("+proj=longlat +ellps=WGS84"))
>> plot(transect_sp, add=TRUE, pch="-", cex=2)
>> legend_image(c(174.2,174.25), c(-37.5,-37.2), auck_el1$band1,
>> vertical=TRUE,
>> offset.leg=0.8, col=grys)
>> par(oopar)
>
> and the result was also crossed by the same white horizontal lines.
>
> I am using R version 2.13.1. I didn't have any problems with previous
> versions.
>
> Thanks for your attention
>
> Cristina
>

-- 
Renaud Lancelot
EDENext Project, coordinator: http://www.edenext.eu/

CIRAD, UMR15, Campus International de Baillarguet TA A-DIR / B
F34398 Montpellier

Tel.  +33 4 67 59 37 17  -  Fax  +33 4 67 59 37 95
Secr. +33 4 67 59 37 37  - Cell. +33 6 77 52 08 69


From Roger.Bivand at nhh.no  Sat Jul 23 10:51:45 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 23 Jul 2011 10:51:45 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>

On Sat, 23 Jul 2011, Roman Lu?trik wrote:

> Dear list,
>
> I'm trying to read a gpx file using rgdal::readOGR function. I get the
> following error, as demonstrated by using the example from the help file of
> readOGR.

You have installed GDAL yourself. What does ogrinfo --formats or 
ogrDrivers() show? Do you have a GDAL built with expat to include the GPX 
driver?

Roger

>
> dsn <- system.file("vectors/test_trk2.gpx", package = "rgdal")[1]
> dsn
>  [1]
> "C:/Users/romunov/Documents/R/win-library/2.13/rgdal/vectors/test_trk2.gpx"
> test_trk2 <- try(readOGR(dsn=dsn, layer="tracks"))
>  Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>    Cannot open file
>
>
> I've traced the ogrInfo and it stops at the line where it makes a .Call to
> "ogrInfo" function.
>
> debug: ogrinfo <- .Call("ogrInfo", as.character(dsn), as.character(layer),
>    PACKAGE = "rgdal")
> Browse[3]> n
> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
> input_field_name_encoding) :
>  Cannot open file
>
>
> What am I missing?
>
> Here's my sessionInfo.
>
>> sessionInfo()
> R version 2.13.1 (2011-07-08)
> Platform: x86_64-pc-mingw32/x64 (64-bit)
> locale:
> [1] LC_COLLATE=Slovenian_Slovenia.1250  LC_CTYPE=Slovenian_Slovenia.1250
> [3] LC_MONETARY=Slovenian_Slovenia.1250 LC_NUMERIC=C
> [5] LC_TIME=Slovenian_Slovenia.1250
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
> other attached packages:
> [1] rgdal_0.7-1 sp_0.9-79
> loaded via a namespace (and not attached):
> [1] grid_2.13.1     lattice_0.19-30 tools_2.13.1
>
>
> Any tips on how to solve this will be much appreciated.
>
>
> Cheers,
> Roman
>
>
>
>   --
> In God we trust, all others bring data.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From axel.urbiz at gmail.com  Sat Jul 23 12:46:26 2011
From: axel.urbiz at gmail.com (Axel Urbiz)
Date: Sat, 23 Jul 2011 06:46:26 -0400
Subject: [R-sig-Geo] Problem with read.shape in maptools
Message-ID: <CAAyVsXLNrdJaZ+5fCFe5jgNRQ3JHEA+neZ6eSHhSyi6RxGyQjw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110723/02faa6ee/attachment.pl>

From Roger.Bivand at nhh.no  Sat Jul 23 13:19:12 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 23 Jul 2011 13:19:12 +0200 (CEST)
Subject: [R-sig-Geo] Problem with read.shape in maptools
In-Reply-To: <CAAyVsXLNrdJaZ+5fCFe5jgNRQ3JHEA+neZ6eSHhSyi6RxGyQjw@mail.gmail.com>
References: <CAAyVsXLNrdJaZ+5fCFe5jgNRQ3JHEA+neZ6eSHhSyi6RxGyQjw@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107231318480.13773@reclus.nhh.no>

On Sat, 23 Jul 2011, Axel Urbiz wrote:

> Hi,
>
> I'd like to read a shapefile into a Map object. This is exactly what
> read.shape{maptools} is suppoed to do, according to the documentation I
> found in the link below.

Do search the archives properly; the second hit on googling 
"list:R-sig-geo read.shape" is relevant. Summarize to the list when you've 
resolved your problem. In addition, R is case specific, so an S3 Map 
object is not an S3 map object.

Your previous mail refers to a function in the maps package, which does
things that may be supported elsewhere. The only function that seems to
convert SpatialPolygonsDataFrame to a list like the map class is
fortify.SpatialPolygonsDataFrame() in ggplot2, but I don't know if this
does what you need. To be honest, you havent't explained what you want to
do with smooth.map that you cannot do with sp objects - please do read the
available documentation before cross-posting (first post).

Roger

>
> However, this doesn't seem to work
>
>
> library(maptools)x <- read.shape(system.file("shapes/sids.shp",
> package="maptools")[1])Error: could not find function "read.shape"
>
>
>
> I haven't found this function on the documentation from the latest
> release of the package, so I assume is no longer supported. Is there
> an alternative way of doing this?
>
>
>
> http://rss.acs.unt.edu/Rdoc/library/maptools/html/read.shape.html
>
> Thanks,
>
> Axel.
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no


From roman.lustrik at gmail.com  Sat Jul 23 17:55:40 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 23 Jul 2011 17:55:40 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
Message-ID: <CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110723/4e77a850/attachment.pl>

From b.rowlingson at lancaster.ac.uk  Sat Jul 23 18:39:45 2011
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Sat, 23 Jul 2011 17:39:45 +0100
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
Message-ID: <CANVKczNUvqTeKevf1nFgpDDZtgjbMAKVtAQ=UhSYOezRo6H2Bg@mail.gmail.com>

On Sat, Jul 23, 2011 at 4:55 PM, Roman Lu?trik <roman.lustrik at gmail.com> wrote:
> Thank you Roger for taking interest in this. Your time is very appreciated.
>
> I do have a "standalone" gdal version installed (from a while back) but I
> think it may be "dead". I can't access ogrinfo through a command prompt
> (only if I run a special .bat that sets up the SDK shell) even though I have
> the /gdal/bin in my PATH. If I run ogrinfo in the aforementioned SDK shell,

 Is it permissions or access rights on the file? system.file only
checks for existence, not readability.

 Try foo = scan(dsn,what="") and see if that reads it.

Barry


From roman.lustrik at gmail.com  Sat Jul 23 19:45:04 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 23 Jul 2011 19:45:04 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <CANVKczNUvqTeKevf1nFgpDDZtgjbMAKVtAQ=UhSYOezRo6H2Bg@mail.gmail.com>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
	<CANVKczNUvqTeKevf1nFgpDDZtgjbMAKVtAQ=UhSYOezRo6H2Bg@mail.gmail.com>
Message-ID: <CAHT1vpjdZheFPgcP1Zf4RST5p3nQw=3ABO4mQhTXxw-eKYxexg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110723/4ab8f08d/attachment.pl>

From Roger.Bivand at nhh.no  Sat Jul 23 19:59:32 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 23 Jul 2011 19:59:32 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107231955520.14739@reclus.nhh.no>

On Sat, 23 Jul 2011, Roman Lu?trik wrote:

> Thank you Roger for taking interest in this. Your time is very appreciated.

Unfortunately, the GPX driver may be built write-only if GDAL was not 
built with expat - the same applies to KML. This appears to be your 
situation. I suggest upgrading your GDAL, and making sure that it is built 
with expat.

Roger

>
> I do have a "standalone" gdal version installed (from a while back) but I
> think it may be "dead". I can't access ogrinfo through a command prompt
> (only if I run a special .bat that sets up the SDK shell) even though I have
> the /gdal/bin in my PATH. If I run ogrinfo in the aforementioned SDK shell,
> I get this output.
>
> C:\gdal>ogrinfo --formats
> Supported Formats:
>  -> "ESRI Shapefile" (read/write)
>  -> "MapInfo File" (read/write)
>  -> "UK .NTF" (readonly)
>  -> "SDTS" (readonly)
>  -> "TIGER" (read/write)
>  -> "S57" (read/write)
>  -> "DGN" (read/write)
>  -> "VRT" (readonly)
>  -> "REC" (readonly)
>  -> "Memory" (read/write)
>  -> "BNA" (read/write)
>  -> "CSV" (read/write)
>  -> "NAS" (readonly)
>  -> "GML" (read/write)
> *  -> "GPX" (read/write)*
>  -> "KML" (read/write)
>  -> "GeoJSON" (read/write)
>  -> "GMT" (read/write)
>  -> "SQLite" (read/write)
>  -> "ODBC" (read/write)
>  -> "PGeo" (readonly)
>  -> "MSSQLSpatial" (read/write)
>  -> "PostgreSQL" (read/write)
>  -> "MySQL" (read/write)
>  -> "PCIDSK" (read/write)
>  -> "XPlane" (readonly)
>  -> "AVCBin" (readonly)
>  -> "AVCE00" (readonly)
>  -> "DXF" (read/write)
>  -> "Geoconcept" (read/write)
>  -> "GeoRSS" (read/write)
>  -> "GPSTrackMaker" (read/write)
>  -> "VFK" (readonly)
>  -> "PGDump" (read/write)
>  -> "GPSBabel" (read/write)
>  -> "SUA" (readonly)
>  -> "OpenAir" (readonly)
>  -> "PDS" (readonly)
>  -> "WFS" (readonly)
>  -> "HTF" (readonly)
>  -> "AeronavFAA" (readonly)
>
> ogrDrivers() gives out this:
>
>> ogrDrivers()
>             name write
> 1          AVCBin FALSE
> 2          AVCE00 FALSE
> 3             BNA  TRUE
> 4             CSV  TRUE
> 5             DGN  TRUE
> 6             DXF  TRUE
> 7  ESRI Shapefile  TRUE
> 8      Geoconcept  TRUE
> 9         GeoJSON  TRUE
> 10         GeoRSS  TRUE
> 11            GML  TRUE
> 12            GMT  TRUE
> 13  GPSTrackMaker  TRUE
> *14            GPX  TRUE*
> 15            KML  TRUE
> 16   MapInfo File  TRUE
> 17         Memory  TRUE
> 18         PCIDSK FALSE
> 19            REC FALSE
> 20            S57  TRUE
> 21           SDTS FALSE
> 22          TIGER  TRUE
> 23        UK .NTF FALSE
> 24            VFK FALSE
> 25            VRT FALSE
> 26         XPlane FALSE
>
> Cheers,
> Roman
>
>
>
> On Sat, Jul 23, 2011 at 10:51 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sat, 23 Jul 2011, Roman Lu?trik wrote:
>>
>>  Dear list,
>>>
>>> I'm trying to read a gpx file using rgdal::readOGR function. I get the
>>> following error, as demonstrated by using the example from the help file
>>> of
>>> readOGR.
>>>
>>
>> You have installed GDAL yourself. What does ogrinfo --formats or
>> ogrDrivers() show? Do you have a GDAL built with expat to include the GPX
>> driver?
>>
>> Roger
>>
>>
>>> dsn <- system.file("vectors/test_**trk2.gpx", package = "rgdal")[1]
>>> dsn
>>>  [1]
>>> "C:/Users/romunov/Documents/R/**win-library/2.13/rgdal/**
>>> vectors/test_trk2.gpx"
>>> test_trk2 <- try(readOGR(dsn=dsn, layer="tracks"))
>>>  Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>>> input_field_name_encoding) :
>>>   Cannot open file
>>>
>>>
>>> I've traced the ogrInfo and it stops at the line where it makes a .Call to
>>> "ogrInfo" function.
>>>
>>> debug: ogrinfo <- .Call("ogrInfo", as.character(dsn), as.character(layer),
>>>   PACKAGE = "rgdal")
>>> Browse[3]> n
>>> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>>> input_field_name_encoding) :
>>>  Cannot open file
>>>
>>>
>>> What am I missing?
>>>
>>> Here's my sessionInfo.
>>>
>>>  sessionInfo()
>>>>
>>> R version 2.13.1 (2011-07-08)
>>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>> locale:
>>> [1] LC_COLLATE=Slovenian_Slovenia.**1250  LC_CTYPE=Slovenian_Slovenia.**
>>> 1250
>>> [3] LC_MONETARY=Slovenian_**Slovenia.1250 LC_NUMERIC=C
>>> [5] LC_TIME=Slovenian_Slovenia.**1250
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>> other attached packages:
>>> [1] rgdal_0.7-1 sp_0.9-79
>>> loaded via a namespace (and not attached):
>>> [1] grid_2.13.1     lattice_0.19-30 tools_2.13.1
>>>
>>>
>>> Any tips on how to solve this will be much appreciated.
>>>
>>>
>>> Cheers,
>>> Roman
>>>
>>>
>>>
>>>  --
>>> In God we trust, all others bring data.
>>>
>>>        [[alternative HTML version deleted]]
>>>
>>> ______________________________**_________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/**listinfo/r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From roman.lustrik at gmail.com  Sat Jul 23 20:55:59 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Sat, 23 Jul 2011 20:55:59 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <alpine.LRH.2.00.1107231955520.14739@reclus.nhh.no>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
	<alpine.LRH.2.00.1107231955520.14739@reclus.nhh.no>
Message-ID: <CAHT1vpgqS+QdEbuJJndV82m+ZLzOu5uyZwYcxRJVt-NkPsnbCA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110723/239cda3e/attachment.pl>

From lestes at princeton.edu  Sat Jul 23 21:45:50 2011
From: lestes at princeton.edu (Lyndon Estes)
Date: Sat, 23 Jul 2011 15:45:50 -0400
Subject: [R-sig-Geo] raster Median function very slow on stack compared
 to mean: expected behavior?
In-Reply-To: <1311353404479-6611150.post@n2.nabble.com>
References: <CALuVVaa8kvtQG7CfVZBuVvQRVWka_Ov6cooNV59r5=7H_qyNLQ@mail.gmail.com>
	<1311353404479-6611150.post@n2.nabble.com>
Message-ID: <CALuVVabQKR9-WFcKbik2G5TsHzE+YUOCWPb5eKFAvqqddJFSHQ@mail.gmail.com>

Hi Robert,

Many thanks for the answer.  I tried this again using "median" rather
than "Median", and got the following results on my example:

setOptions(todisk = TRUE)  # I used this option to rule out memory issues
system.time(med <- calc(stk, median, filename = "med.tif", datatype =
"INT2S", overwrite = T))
#   user  system elapsed
#108.856   1.158 115.998

system.time(med <- calc(stk, mean, filename = "mean.tif", datatype =
"INT2S", overwrite = T))
setOptions(todisk = FALSE)
#   user  system elapsed
#  1.232   0.336   1.663

So slower than mean, of course, but I can now get a result on my
larger rasters.

Thanks again,

Lyndon

On Fri, Jul 22, 2011 at 12:50 PM, Robert Hijmans <r.hijmans at gmail.com> wrote:
>> I am trying to extract the per-pixel median from a raster stack, and
>> am finding that the process takes a very long time relative to taking
>> the per-pixel mean. It is long enough that I have never actually seen
>> whether it successfully completes on my data, but this dummy example
>> shows the code structure I am using and the time differences between
>> the two functions:
>>
>> stk <- stack(lapply(1:10, function(x) {
>> ?r <- raster(nrow = 1000, ncol = 1000)
>> ?r2 <- setValues(r, sample(1:100, size = ncell(r), replace = T, prob =
>> NULL))
>> }))
>>
>> setOptions(todisk = TRUE) ?# I used this option to rule out memory issues
>> t1 <- Sys.time()
>> med <- calc(stk, Median, filename = "med.tif", datatype = "INT2S",
>> overwrite = T)
>> Sys.time() - t1 ?# 7.26 mins
>>
>> t2 <- Sys.time()
>> med <- calc(stk, mean, filename = "mean.tif", datatype = "INT2S",
>> overwrite = T)
>> Sys.time() - t2 ?# 2.34 secs
>> setOptions(todisk = FALSE)
>>
>>
>> Am I doing something wrong with my code, or is the speed difference I
>> am seeing expected?
>>
>
> Lyndon,
>
> Median (big M) was intended for use like Median(s) not for use in calc
> (which did not exist yet); but I am surprised how slow it is in calc. Now we
> have calc, you can use median (small m) and that is much quicker; and about
> the same as Median(s); I think I will remove Median as it is no longer
> needed.
>
> Either way, median will be slower than mean, which is expected:
>
>> v = runif(1e+7)
>> system.time(mean(v))
> ? user ?system elapsed
> ? 0.09 ? ?0.00 ? ?0.09
>> system.time(median(v)) ?# 7 times slower
> ? user ?system elapsed
> ? 0.56 ? ?0.06 ? ?0.63
>>
>> s <- stack(sapply(1:10, function(x) setValues(r, runif(ncell(r)))))
>> r <- raster()
>>
>> system.time(mean(s))
> ? user ?system elapsed
> ? 4.75 ? ?0.02 ? ?4.79
>> system.time(calc(s, mean))
> ? user ?system elapsed
> ? 0.25 ? ?0.00 ? ?0.26
>
>> system.time(Median(s))
> ? user ?system elapsed
> ? 7.73 ? ?0.00 ? ?7.75
>> system.time(calc(s, median))
> ? user ?system elapsed
> ? 8.48 ? ?0.00 ? ?8.54
>> system.time(calc(s, Median)) # slow!
> ? user ?system elapsed
> ?28.15 ? ?0.03 ? 28.27
>>
>>
>
>
> Robert
>
>
>
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/raster-Median-function-very-slow-on-stack-compared-to-mean-expected-behavior-tp6609202p6611150.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From drf28 at cornell.edu  Sun Jul 24 04:50:04 2011
From: drf28 at cornell.edu (Daniel Fuka)
Date: Sat, 23 Jul 2011 22:50:04 -0400
Subject: [R-sig-Geo] AGU Session dedicated to R: R's Emerging Environmental
	Modeling Community
Message-ID: <CAB9w6XyA2m4Oq-cdnVOHCWYz7avDT3bh8vZYw8s8k9s3=OD5=A@mail.gmail.com>

Hello!

The American Geophysical Union (AGU) Fall Meeting, ?Dec. 5-9, San
Francisco, CA, USA, will have a dedicated session this year. I am
sorry for cross-posting, but for the session we are looking to have R
users and modelers in all fields loosely related to "Environmental
Modeling" feel free to join us. If you think this might be of
interest, please feel free to contact me directly outside of the R
mailing lists or submit an abstract by August 4th. Session link and
description are found below.

Enjoy,
Daniel Fuka

http://sites.agu.org/fallmeeting/scientific-program/session-search/477
H57: R's Emerging Environmental Modeling Community

Sponsors: Hydrology (H), Atmospheric Sciences (A), Biogeosciences (B),
Earth and Space Science Informatics (IN)
Description:
Most environmental modeling efforts rely on a dedicated, centralized,
core group of developers. However, a unique, decentralized community
of environmental modelers appears to be organically evolving within
the R-project. R is an open-source programming language that has grown
into something like a combination of S, MATLAB(Reg), GIS, and Python.
One aspect of the R-project that lends itself to community modeling is
a well-managed system for developing sharable code packages (R-Forge)
and archiving them (CRAN). Recent contributions to R-Forge/CRAN
include a suite of hydrological modeling tools, functions, and
complete watershed models (e.g., TOPMODEL). This session invites
R-modelers to share their projects and ideas about community modeling.


From Roger.Bivand at nhh.no  Sun Jul 24 08:49:07 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 24 Jul 2011 08:49:07 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <CAHT1vpgqS+QdEbuJJndV82m+ZLzOu5uyZwYcxRJVt-NkPsnbCA@mail.gmail.com>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
	<alpine.LRH.2.00.1107231955520.14739@reclus.nhh.no>
	<CAHT1vpgqS+QdEbuJJndV82m+ZLzOu5uyZwYcxRJVt-NkPsnbCA@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107240846350.16717@reclus.nhh.no>

On Sat, 23 Jul 2011, Roman Lu?trik wrote:

> I've installed a build of GDAL from http://www.gisinternals.com/sdk/. The
> information for the build I'm using (GDAL 1.8.1, 64 bit) says that
> expat-2.0.1-VS10 has been used to compile GDAL. Still no dice.
>
> FWIW, this is the output I get when I load rgdal.
>
>> library(rgdal)
> Loading required package: sp
> Geospatial Data Abstraction Library extensions to R successfully loaded
> Loaded GDAL runtime: GDAL 1.7.2, released 2010/04/23

You have multiple installed GDAL libraries. The one found when installin 
rgdal is the one you see with gdal-config --version without any extra 
steps. Disambiguate your GDAL installations, or, better, install expat 
(perhaps binary) then GDAL from source. Many binary builds on Linux are 
badly made and confusing.

Roger

> Path to GDAL shared files:
> C:/Users/romunov/Documents/R/win-library/2.13/rgdal/gdal
> Loaded PROJ.4 runtime: Rel. 4.7.1, 23 September 2009, [PJ_VERSION: 470]
> Path to PROJ.4 shared files:
> C:/Users/romunov/Documents/R/win-library/2.13/rgdal/proj
>
>
> Cheers,
> Roman
>
>
> On Sat, Jul 23, 2011 at 7:59 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
>> On Sat, 23 Jul 2011, Roman Lu?trik wrote:
>>
>>  Thank you Roger for taking interest in this. Your time is very
>>> appreciated.
>>>
>>
>> Unfortunately, the GPX driver may be built write-only if GDAL was not built
>> with expat - the same applies to KML. This appears to be your situation. I
>> suggest upgrading your GDAL, and making sure that it is built with expat.
>>
>> Roger
>>
>>
>>> I do have a "standalone" gdal version installed (from a while back) but I
>>> think it may be "dead". I can't access ogrinfo through a command prompt
>>> (only if I run a special .bat that sets up the SDK shell) even though I
>>> have
>>> the /gdal/bin in my PATH. If I run ogrinfo in the aforementioned SDK
>>> shell,
>>> I get this output.
>>>
>>> C:\gdal>ogrinfo --formats
>>> Supported Formats:
>>>  -> "ESRI Shapefile" (read/write)
>>>  -> "MapInfo File" (read/write)
>>>  -> "UK .NTF" (readonly)
>>>  -> "SDTS" (readonly)
>>>  -> "TIGER" (read/write)
>>>  -> "S57" (read/write)
>>>  -> "DGN" (read/write)
>>>  -> "VRT" (readonly)
>>>  -> "REC" (readonly)
>>>  -> "Memory" (read/write)
>>>  -> "BNA" (read/write)
>>>  -> "CSV" (read/write)
>>>  -> "NAS" (readonly)
>>>  -> "GML" (read/write)
>>> *  -> "GPX" (read/write)*
>>>  -> "KML" (read/write)
>>>  -> "GeoJSON" (read/write)
>>>  -> "GMT" (read/write)
>>>  -> "SQLite" (read/write)
>>>  -> "ODBC" (read/write)
>>>  -> "PGeo" (readonly)
>>>  -> "MSSQLSpatial" (read/write)
>>>  -> "PostgreSQL" (read/write)
>>>  -> "MySQL" (read/write)
>>>  -> "PCIDSK" (read/write)
>>>  -> "XPlane" (readonly)
>>>  -> "AVCBin" (readonly)
>>>  -> "AVCE00" (readonly)
>>>  -> "DXF" (read/write)
>>>  -> "Geoconcept" (read/write)
>>>  -> "GeoRSS" (read/write)
>>>  -> "GPSTrackMaker" (read/write)
>>>  -> "VFK" (readonly)
>>>  -> "PGDump" (read/write)
>>>  -> "GPSBabel" (read/write)
>>>  -> "SUA" (readonly)
>>>  -> "OpenAir" (readonly)
>>>  -> "PDS" (readonly)
>>>  -> "WFS" (readonly)
>>>  -> "HTF" (readonly)
>>>  -> "AeronavFAA" (readonly)
>>>
>>> ogrDrivers() gives out this:
>>>
>>>  ogrDrivers()
>>>>
>>>            name write
>>> 1          AVCBin FALSE
>>> 2          AVCE00 FALSE
>>> 3             BNA  TRUE
>>> 4             CSV  TRUE
>>> 5             DGN  TRUE
>>> 6             DXF  TRUE
>>> 7  ESRI Shapefile  TRUE
>>> 8      Geoconcept  TRUE
>>> 9         GeoJSON  TRUE
>>> 10         GeoRSS  TRUE
>>> 11            GML  TRUE
>>> 12            GMT  TRUE
>>> 13  GPSTrackMaker  TRUE
>>> *14            GPX  TRUE*
>>> 15            KML  TRUE
>>> 16   MapInfo File  TRUE
>>> 17         Memory  TRUE
>>> 18         PCIDSK FALSE
>>> 19            REC FALSE
>>> 20            S57  TRUE
>>> 21           SDTS FALSE
>>> 22          TIGER  TRUE
>>> 23        UK .NTF FALSE
>>> 24            VFK FALSE
>>> 25            VRT FALSE
>>> 26         XPlane FALSE
>>>
>>> Cheers,
>>> Roman
>>>
>>>
>>>
>>> On Sat, Jul 23, 2011 at 10:51 AM, Roger Bivand <Roger.Bivand at nhh.no>
>>> wrote:
>>>
>>>  On Sat, 23 Jul 2011, Roman Lu?trik wrote:
>>>>
>>>>  Dear list,
>>>>
>>>>>
>>>>> I'm trying to read a gpx file using rgdal::readOGR function. I get the
>>>>> following error, as demonstrated by using the example from the help file
>>>>> of
>>>>> readOGR.
>>>>>
>>>>>
>>>> You have installed GDAL yourself. What does ogrinfo --formats or
>>>> ogrDrivers() show? Do you have a GDAL built with expat to include the GPX
>>>> driver?
>>>>
>>>> Roger
>>>>
>>>>
>>>>  dsn <- system.file("vectors/test_****trk2.gpx", package = "rgdal")[1]
>>>>> dsn
>>>>>  [1]
>>>>> "C:/Users/romunov/Documents/R/****win-library/2.13/rgdal/**
>>>>> vectors/test_trk2.gpx"
>>>>> test_trk2 <- try(readOGR(dsn=dsn, layer="tracks"))
>>>>>  Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>>>>> input_field_name_encoding) :
>>>>>  Cannot open file
>>>>>
>>>>>
>>>>> I've traced the ogrInfo and it stops at the line where it makes a .Call
>>>>> to
>>>>> "ogrInfo" function.
>>>>>
>>>>> debug: ogrinfo <- .Call("ogrInfo", as.character(dsn),
>>>>> as.character(layer),
>>>>>  PACKAGE = "rgdal")
>>>>> Browse[3]> n
>>>>> Error in ogrInfo(dsn = dsn, layer = layer, input_field_name_encoding =
>>>>> input_field_name_encoding) :
>>>>>  Cannot open file
>>>>>
>>>>>
>>>>> What am I missing?
>>>>>
>>>>> Here's my sessionInfo.
>>>>>
>>>>>  sessionInfo()
>>>>>
>>>>>>
>>>>>>  R version 2.13.1 (2011-07-08)
>>>>> Platform: x86_64-pc-mingw32/x64 (64-bit)
>>>>> locale:
>>>>> [1] LC_COLLATE=Slovenian_Slovenia.****1250
>>>>>  LC_CTYPE=Slovenian_Slovenia.**
>>>>> 1250
>>>>> [3] LC_MONETARY=Slovenian_****Slovenia.1250 LC_NUMERIC=C
>>>>> [5] LC_TIME=Slovenian_Slovenia.****1250
>>>>> attached base packages:
>>>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>>> other attached packages:
>>>>> [1] rgdal_0.7-1 sp_0.9-79
>>>>> loaded via a namespace (and not attached):
>>>>> [1] grid_2.13.1     lattice_0.19-30 tools_2.13.1
>>>>>
>>>>>
>>>>> Any tips on how to solve this will be much appreciated.
>>>>>
>>>>>
>>>>> Cheers,
>>>>> Roman
>>>>>
>>>>>
>>>>>
>>>>>  --
>>>>> In God we trust, all others bring data.
>>>>>
>>>>>       [[alternative HTML version deleted]]
>>>>>
>>>>> ______________________________****_________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/****listinfo/r-sig-geo<https://stat.ethz.ch/mailman/**listinfo/r-sig-geo>
>>>>> <https://**stat.ethz.ch/mailman/listinfo/**r-sig-geo<https://stat.ethz.ch/mailman/listinfo/r-sig-geo>
>>>>>>
>>>>>
>>>>>
>>>>>  --
>>>> Roger Bivand
>>>> Department of Economics, NHH Norwegian School of Economics,
>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>>>> e-mail: Roger.Bivand at nhh.no
>>>>
>>>>
>>>
>>>
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, NHH Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 95 43
>> e-mail: Roger.Bivand at nhh.no
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From matevz.pavlic at gi-zrmk.si  Sun Jul 24 18:22:29 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sun, 24 Jul 2011 18:22:29 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>

Hi list users, 

 

i am trying to do indicator kriging on a set of soild samples. 

 

I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 

 

After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 

 

I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 

 

Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.

 

I hope i explained ok, if not i'll try again. 

 

Thanks for any ideas or help, m

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110724/d65f6e00/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: temp.png
Type: image/png
Size: 16254 bytes
Desc: temp.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110724/d65f6e00/attachment.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: temp.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110724/d65f6e00/attachment.txt>

From edzer.pebesma at uni-muenster.de  Sun Jul 24 20:04:19 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 24 Jul 2011 20:04:19 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
Message-ID: <4E2C5EA3.4090200@uni-muenster.de>

Matevz, try

z$class = factor(apply(cbind(z$dva.pred, z$ena.pred, z$nic.pred,
	z$stiri.pred, z$tri.pred), 1, which.max),
	labels=c("dva", "ena", "nic", "stiri", "tri"))
spplot(z["class"])


On 07/24/2011 06:22 PM, Matev? Pavli? wrote:
> Hi list users, 
> 
>  
> 
> i am trying to do indicator kriging on a set of soild samples. 
> 
>  
> 
> I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 
> 
>  
> 
> After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 
> 
>  
> 
> I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 
> 
>  
> 
> Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.
> 
>  
> 
> I hope i explained ok, if not i'll try again. 
> 
>  
> 
> Thanks for any ideas or help, m
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Sun Jul 24 20:52:59 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sun, 24 Jul 2011 20:52:59 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <4E2C5EA3.4090200@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
	<4E2C5EA3.4090200@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>

Hi Edzer, 

thanks for the help. It works ok on the sampleI provided, even if I enlarge the number of classes to 10. But when i try to use it on my dataset which has identical names of predictions and number of predisctions and covarinaces I get an error :

Error in factor(apply(cbind(z$nic.pred, z$ena.pred, z$dva.pred, z$tri.pred,  : 
  invalid labels; length 10 should be 1 or 8

This is the oputput of the prediction whit

> str(z):
Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
  ..@ data       :'data.frame':	8736 obs. of  65 variables:
  .. ..$ devet.pred     : num [1:8736] 0.001153 0.000876 0.100325 0.101093 0.102047 ...
  .. ..$ devet.var      : num [1:8736] 0.00548 0.00548 0.00549 0.0055 0.00551 ...
  .. ..$ dva.pred       : num [1:8736] 0.182 0.185 0.177 0.194 0.191 ...
  .. ..$ dva.var        : num [1:8736] 0.0744 0.0744 0.0745 0.0752 0.0753 ...
  .. ..$ ena.pred       : num [1:8736] 0.2009 0.1895 0.0476 0.0522 0.0482 ...
  .. ..$ ena.var        : num [1:8736] 0.149 0.149 0.15 0.155 0.155 ...
  .. ..$ nic.pred       : num [1:8736] 0.139 0.142 0.206 0.0252 0.0234 ...
  .. ..$ nic.var        : num [1:8736] 0.258 0.259 0.26 0.267 0.268 ...
  .. ..$ osem.pred      : num [1:8736] 9.15e-05 0.00 5.56e-05 6.82e-04 1.13e-03 ...
  .. ..$ osem.var       : num [1:8736] 0.00381 0.00382 0.00382 0.00386 0.00386 ...
  .. ..$ pet.pred       : num [1:8736] 0.000115 0.000303 0.000875 0.000423 0.000345 ...
  .. ..$ pet.var        : num [1:8736] 0.0126 0.0126 0.0126 0.0133 0.0133 ...
  .. ..$ sedem.pred     : num [1:8736] 0.0934 0.0924 0.0756 0.1084 0.1157 ...
  .. ..$ sedem.var      : num [1:8736] 0.0848 0.085 0.0852 0.0874 0.0877 ...
  .. ..$ set.pred       : num [1:8736] 0.271 0.278 0.27 0.395 0.389 ...
  .. ..$ set.var        : num [1:8736] 0.0881 0.0882 0.0885 0.0902 0.0904 ...
  .. ..$ stiri.pred     : num [1:8736] 0.001931 0.000777 0.0046 0 0 ...
  .. ..$ stiri.var      : num [1:8736] 0.101 0.101 0.101 0.106 0.106 ...
  .. ..$ tri.pred       : num [1:8736] 0.11 0.111 0.118 0.123 0.129 ...
  .. ..$ tri.var        : num [1:8736] 0.134 0.134 0.134 0.136 0.136 ...

I would like to create a map from predictions of course. 

What i found out is that your latest code works until labels line gets called.But funny thing is , when  I use this line :
z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))

i get :

> levels(z$class)
[1] "1" "2" "3" "4" "5" "6" "7" "8"

Any ideas? 

tnx, m
-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
Sent: Sunday, July 24, 2011 8:04 PM
To: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Indicator kriging map creation

Matevz, try

z$class = factor(apply(cbind(z$dva.pred, z$ena.pred, z$nic.pred,
	z$stiri.pred, z$tri.pred), 1, which.max),
	labels=c("dva", "ena", "nic", "stiri", "tri"))
spplot(z["class"])


On 07/24/2011 06:22 PM, Matev? Pavli? wrote:
> Hi list users,
> 
>  
> 
> i am trying to do indicator kriging on a set of soild samples. 
> 
>  
> 
> I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 
> 
>  
> 
> After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 
> 
>  
> 
> I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 
> 
>  
> 
> Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.
> 
>  
> 
> I hope i explained ok, if not i'll try again. 
> 
>  
> 
> Thanks for any ideas or help, m
> 
> 
> 
> 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Sun Jul 24 21:30:45 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 24 Jul 2011 21:30:45 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
	<4E2C5EA3.4090200@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>
Message-ID: <4E2C72E5.8030403@uni-muenster.de>

You have to dive a little bit into what factor() does. One or more of
your classes never has the highest probability, it seems:

> factor(c(1,2,3,5))
[1] 1 2 3 5
Levels: 1 2 3 5
> factor(c(1,2,3,5), labels = c("1", "2", "3", "4", "5"))
Error in factor(c(1, 2, 3, 5), labels = c("1", "2", "3", "4", "5")) :
  invalid labels; length 5 should be 1 or 4
> levels(factor(c(1,2,3,5)))
[1] "1" "2" "3" "5"
> factor(c(1,2,3,5), levels=1:5, labels = c("1", "2", "3", "4", "5"))
[1] 1 2 3 5
Levels: 1 2 3 4 5
> factor(c(1,2,3,5), levels=1:5, labels = c("a", "b", "c", "d", "e"))
[1] a b c e
Levels: a b c d e


On 07/24/2011 08:52 PM, Matev? Pavli? wrote:
> Hi Edzer, 
> 
> thanks for the help. It works ok on the sampleI provided, even if I enlarge the number of classes to 10. But when i try to use it on my dataset which has identical names of predictions and number of predisctions and covarinaces I get an error :
> 
> Error in factor(apply(cbind(z$nic.pred, z$ena.pred, z$dva.pred, z$tri.pred,  : 
>   invalid labels; length 10 should be 1 or 8
> 
> This is the oputput of the prediction whit
> 
>> str(z):
> Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
>   ..@ data       :'data.frame':	8736 obs. of  65 variables:
>   .. ..$ devet.pred     : num [1:8736] 0.001153 0.000876 0.100325 0.101093 0.102047 ...
>   .. ..$ devet.var      : num [1:8736] 0.00548 0.00548 0.00549 0.0055 0.00551 ...
>   .. ..$ dva.pred       : num [1:8736] 0.182 0.185 0.177 0.194 0.191 ...
>   .. ..$ dva.var        : num [1:8736] 0.0744 0.0744 0.0745 0.0752 0.0753 ...
>   .. ..$ ena.pred       : num [1:8736] 0.2009 0.1895 0.0476 0.0522 0.0482 ...
>   .. ..$ ena.var        : num [1:8736] 0.149 0.149 0.15 0.155 0.155 ...
>   .. ..$ nic.pred       : num [1:8736] 0.139 0.142 0.206 0.0252 0.0234 ...
>   .. ..$ nic.var        : num [1:8736] 0.258 0.259 0.26 0.267 0.268 ...
>   .. ..$ osem.pred      : num [1:8736] 9.15e-05 0.00 5.56e-05 6.82e-04 1.13e-03 ...
>   .. ..$ osem.var       : num [1:8736] 0.00381 0.00382 0.00382 0.00386 0.00386 ...
>   .. ..$ pet.pred       : num [1:8736] 0.000115 0.000303 0.000875 0.000423 0.000345 ...
>   .. ..$ pet.var        : num [1:8736] 0.0126 0.0126 0.0126 0.0133 0.0133 ...
>   .. ..$ sedem.pred     : num [1:8736] 0.0934 0.0924 0.0756 0.1084 0.1157 ...
>   .. ..$ sedem.var      : num [1:8736] 0.0848 0.085 0.0852 0.0874 0.0877 ...
>   .. ..$ set.pred       : num [1:8736] 0.271 0.278 0.27 0.395 0.389 ...
>   .. ..$ set.var        : num [1:8736] 0.0881 0.0882 0.0885 0.0902 0.0904 ...
>   .. ..$ stiri.pred     : num [1:8736] 0.001931 0.000777 0.0046 0 0 ...
>   .. ..$ stiri.var      : num [1:8736] 0.101 0.101 0.101 0.106 0.106 ...
>   .. ..$ tri.pred       : num [1:8736] 0.11 0.111 0.118 0.123 0.129 ...
>   .. ..$ tri.var        : num [1:8736] 0.134 0.134 0.134 0.136 0.136 ...
> 
> I would like to create a map from predictions of course. 
> 
> What i found out is that your latest code works until labels line gets called.But funny thing is , when  I use this line :
> z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))
> 
> i get :
> 
>> levels(z$class)
> [1] "1" "2" "3" "4" "5" "6" "7" "8"
> 
> Any ideas? 
> 
> tnx, m
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Sunday, July 24, 2011 8:04 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Indicator kriging map creation
> 
> Matevz, try
> 
> z$class = factor(apply(cbind(z$dva.pred, z$ena.pred, z$nic.pred,
> 	z$stiri.pred, z$tri.pred), 1, which.max),
> 	labels=c("dva", "ena", "nic", "stiri", "tri"))
> spplot(z["class"])
> 
> 
> On 07/24/2011 06:22 PM, Matev? Pavli? wrote:
>> Hi list users,
>>
>>  
>>
>> i am trying to do indicator kriging on a set of soild samples. 
>>
>>  
>>
>> I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 
>>
>>  
>>
>> After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 
>>
>>  
>>
>> I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 
>>
>>  
>>
>> Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.
>>
>>  
>>
>> I hope i explained ok, if not i'll try again. 
>>
>>  
>>
>> Thanks for any ideas or help, m
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Sun Jul 24 22:30:38 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sun, 24 Jul 2011 22:30:38 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <4E2C72E5.8030403@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
	<4E2C5EA3.4090200@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>
	<4E2C72E5.8030403@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129DB05@gi-zrmk.si>

Hi, 

Thanks for the help! I realize I have a lot to learn , but sometimes you just get stuck. 

What i don't understad is this :
when I use the first line of your code :
>z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))

and check levels :
>levels(z$class) 
[1] "1" "2" "3" "4" "5" "6" "7" "8"

the levels are numerical.  I read in the help that " optional vector of the values that x might have taken. The default is the unique set of values taken by as.character(x), sorted into increasing order of x". 

I would like to create several IK maps with depth (every meter of depth). With doing that there will be areas that will not include all of the soil classes (or in this case factor levels). Will this be a problem with factor labels and map creating, if some of the soil classes will be missing? 

Also, you wrote " One or more of your classes never has the highest probability, it seems ". 
As i understand the apply functions it checks the rows in grid and assignes the maximum values of pred to the cell. So  i do not understand how some predictions never have the highest probability since i have prediction in a SpatialGridDataFrame for each of the 10 classes? Could it be because the values in some cells are equal? 

Thanks again for the answer and your time, 

matevz
 

-----Original Message-----
From: Edzer Pebesma [mailto:edzer.pebesma at uni-muenster.de] 
Sent: Sunday, July 24, 2011 9:31 PM
To: Matev? Pavli?
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Indicator kriging map creation

You have to dive a little bit into what factor() does. One or more of your classes never has the highest probability, it seems:

> factor(c(1,2,3,5))
[1] 1 2 3 5
Levels: 1 2 3 5
> factor(c(1,2,3,5), labels = c("1", "2", "3", "4", "5"))
Error in factor(c(1, 2, 3, 5), labels = c("1", "2", "3", "4", "5")) :
  invalid labels; length 5 should be 1 or 4
> levels(factor(c(1,2,3,5)))
[1] "1" "2" "3" "5"
> factor(c(1,2,3,5), levels=1:5, labels = c("1", "2", "3", "4", "5"))
[1] 1 2 3 5
Levels: 1 2 3 4 5
> factor(c(1,2,3,5), levels=1:5, labels = c("a", "b", "c", "d", "e"))
[1] a b c e
Levels: a b c d e


On 07/24/2011 08:52 PM, Matev? Pavli? wrote:
> Hi Edzer,
> 
> thanks for the help. It works ok on the sampleI provided, even if I enlarge the number of classes to 10. But when i try to use it on my dataset which has identical names of predictions and number of predisctions and covarinaces I get an error :
> 
> Error in factor(apply(cbind(z$nic.pred, z$ena.pred, z$dva.pred, z$tri.pred,  : 
>   invalid labels; length 10 should be 1 or 8
> 
> This is the oputput of the prediction whit
> 
>> str(z):
> Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
>   ..@ data       :'data.frame':	8736 obs. of  65 variables:
>   .. ..$ devet.pred     : num [1:8736] 0.001153 0.000876 0.100325 0.101093 0.102047 ...
>   .. ..$ devet.var      : num [1:8736] 0.00548 0.00548 0.00549 0.0055 0.00551 ...
>   .. ..$ dva.pred       : num [1:8736] 0.182 0.185 0.177 0.194 0.191 ...
>   .. ..$ dva.var        : num [1:8736] 0.0744 0.0744 0.0745 0.0752 0.0753 ...
>   .. ..$ ena.pred       : num [1:8736] 0.2009 0.1895 0.0476 0.0522 0.0482 ...
>   .. ..$ ena.var        : num [1:8736] 0.149 0.149 0.15 0.155 0.155 ...
>   .. ..$ nic.pred       : num [1:8736] 0.139 0.142 0.206 0.0252 0.0234 ...
>   .. ..$ nic.var        : num [1:8736] 0.258 0.259 0.26 0.267 0.268 ...
>   .. ..$ osem.pred      : num [1:8736] 9.15e-05 0.00 5.56e-05 6.82e-04 1.13e-03 ...
>   .. ..$ osem.var       : num [1:8736] 0.00381 0.00382 0.00382 0.00386 0.00386 ...
>   .. ..$ pet.pred       : num [1:8736] 0.000115 0.000303 0.000875 0.000423 0.000345 ...
>   .. ..$ pet.var        : num [1:8736] 0.0126 0.0126 0.0126 0.0133 0.0133 ...
>   .. ..$ sedem.pred     : num [1:8736] 0.0934 0.0924 0.0756 0.1084 0.1157 ...
>   .. ..$ sedem.var      : num [1:8736] 0.0848 0.085 0.0852 0.0874 0.0877 ...
>   .. ..$ set.pred       : num [1:8736] 0.271 0.278 0.27 0.395 0.389 ...
>   .. ..$ set.var        : num [1:8736] 0.0881 0.0882 0.0885 0.0902 0.0904 ...
>   .. ..$ stiri.pred     : num [1:8736] 0.001931 0.000777 0.0046 0 0 ...
>   .. ..$ stiri.var      : num [1:8736] 0.101 0.101 0.101 0.106 0.106 ...
>   .. ..$ tri.pred       : num [1:8736] 0.11 0.111 0.118 0.123 0.129 ...
>   .. ..$ tri.var        : num [1:8736] 0.134 0.134 0.134 0.136 0.136 ...
> 
> I would like to create a map from predictions of course. 
> 
> What i found out is that your latest code works until labels line gets called.But funny thing is , when  I use this line :
> z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))
> 
> i get :
> 
>> levels(z$class)
> [1] "1" "2" "3" "4" "5" "6" "7" "8"
> 
> Any ideas? 
> 
> tnx, m
> -----Original Message-----
> From: r-sig-geo-bounces at r-project.org 
> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
> Sent: Sunday, July 24, 2011 8:04 PM
> To: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Indicator kriging map creation
> 
> Matevz, try
> 
> z$class = factor(apply(cbind(z$dva.pred, z$ena.pred, z$nic.pred,
> 	z$stiri.pred, z$tri.pred), 1, which.max),
> 	labels=c("dva", "ena", "nic", "stiri", "tri"))
> spplot(z["class"])
> 
> 
> On 07/24/2011 06:22 PM, Matev? Pavli? wrote:
>> Hi list users,
>>
>>  
>>
>> i am trying to do indicator kriging on a set of soild samples. 
>>
>>  
>>
>> I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 
>>
>>  
>>
>> After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 
>>
>>  
>>
>> I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 
>>
>>  
>>
>> Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.
>>
>>  
>>
>> I hope i explained ok, if not i'll try again. 
>>
>>  
>>
>> Thanks for any ideas or help, m
>>
>>
>>
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

--
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From edzer.pebesma at uni-muenster.de  Sun Jul 24 23:28:38 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 24 Jul 2011 23:28:38 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129DB05@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
	<4E2C5EA3.4090200@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>
	<4E2C72E5.8030403@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB05@gi-zrmk.si>
Message-ID: <4E2C8E86.9040308@uni-muenster.de>



On 07/24/2011 10:30 PM, Matev? Pavli? wrote:
> Hi, 
> 
> Thanks for the help! I realize I have a lot to learn , but sometimes you just get stuck. 
> 
> What i don't understad is this :
> when I use the first line of your code :
>> z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))
> 
> and check levels :
>> levels(z$class) 
> [1] "1" "2" "3" "4" "5" "6" "7" "8"
> 
> the levels are numerical.  I read in the help that " optional vector of the values that x might have taken. The default is the unique set of values taken by as.character(x), sorted into increasing order of x". 
> 
> I would like to create several IK maps with depth (every meter of depth). With doing that there will be areas that will not include all of the soil classes (or in this case factor levels). Will this be a problem with factor labels and map creating, if some of the soil classes will be missing? 

It might be annoying, and after all, it is your sole responsibility to
make sure the right labels end up in the right place. R can only prevent
you from making mistakes that are too obvious.

> 
> Also, you wrote " One or more of your classes never has the highest probability, it seems ". 
> As i understand the apply functions it checks the rows in grid and assignes the maximum values of pred to the cell. So  i do not understand how some predictions never have the highest probability since i have prediction in a SpatialGridDataFrame for each of the 10 classes? Could it be because the values in some cells are equal? 

Not so likely; I think it comes with simple kriging -- rare classes
often show weak autocorrelation, resulting in low estimates everywhere.
Without having seen your data, I suspect your classes 9 and 10 are like
that.

Please do read ?which.max

> 
> Thanks again for the answer and your time, 
> 
> matevz
>  
> 
> -----Original Message-----
> From: Edzer Pebesma [mailto:edzer.pebesma at uni-muenster.de] 
> Sent: Sunday, July 24, 2011 9:31 PM
> To: Matev? Pavli?
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Indicator kriging map creation
> 
> You have to dive a little bit into what factor() does. One or more of your classes never has the highest probability, it seems:
> 
>> factor(c(1,2,3,5))
> [1] 1 2 3 5
> Levels: 1 2 3 5
>> factor(c(1,2,3,5), labels = c("1", "2", "3", "4", "5"))
> Error in factor(c(1, 2, 3, 5), labels = c("1", "2", "3", "4", "5")) :
>   invalid labels; length 5 should be 1 or 4
>> levels(factor(c(1,2,3,5)))
> [1] "1" "2" "3" "5"
>> factor(c(1,2,3,5), levels=1:5, labels = c("1", "2", "3", "4", "5"))
> [1] 1 2 3 5
> Levels: 1 2 3 4 5
>> factor(c(1,2,3,5), levels=1:5, labels = c("a", "b", "c", "d", "e"))
> [1] a b c e
> Levels: a b c d e
> 
> 
> On 07/24/2011 08:52 PM, Matev? Pavli? wrote:
>> Hi Edzer,
>>
>> thanks for the help. It works ok on the sampleI provided, even if I enlarge the number of classes to 10. But when i try to use it on my dataset which has identical names of predictions and number of predisctions and covarinaces I get an error :
>>
>> Error in factor(apply(cbind(z$nic.pred, z$ena.pred, z$dva.pred, z$tri.pred,  : 
>>   invalid labels; length 10 should be 1 or 8
>>
>> This is the oputput of the prediction whit
>>
>>> str(z):
>> Formal class 'SpatialPixelsDataFrame' [package "sp"] with 7 slots
>>   ..@ data       :'data.frame':	8736 obs. of  65 variables:
>>   .. ..$ devet.pred     : num [1:8736] 0.001153 0.000876 0.100325 0.101093 0.102047 ...
>>   .. ..$ devet.var      : num [1:8736] 0.00548 0.00548 0.00549 0.0055 0.00551 ...
>>   .. ..$ dva.pred       : num [1:8736] 0.182 0.185 0.177 0.194 0.191 ...
>>   .. ..$ dva.var        : num [1:8736] 0.0744 0.0744 0.0745 0.0752 0.0753 ...
>>   .. ..$ ena.pred       : num [1:8736] 0.2009 0.1895 0.0476 0.0522 0.0482 ...
>>   .. ..$ ena.var        : num [1:8736] 0.149 0.149 0.15 0.155 0.155 ...
>>   .. ..$ nic.pred       : num [1:8736] 0.139 0.142 0.206 0.0252 0.0234 ...
>>   .. ..$ nic.var        : num [1:8736] 0.258 0.259 0.26 0.267 0.268 ...
>>   .. ..$ osem.pred      : num [1:8736] 9.15e-05 0.00 5.56e-05 6.82e-04 1.13e-03 ...
>>   .. ..$ osem.var       : num [1:8736] 0.00381 0.00382 0.00382 0.00386 0.00386 ...
>>   .. ..$ pet.pred       : num [1:8736] 0.000115 0.000303 0.000875 0.000423 0.000345 ...
>>   .. ..$ pet.var        : num [1:8736] 0.0126 0.0126 0.0126 0.0133 0.0133 ...
>>   .. ..$ sedem.pred     : num [1:8736] 0.0934 0.0924 0.0756 0.1084 0.1157 ...
>>   .. ..$ sedem.var      : num [1:8736] 0.0848 0.085 0.0852 0.0874 0.0877 ...
>>   .. ..$ set.pred       : num [1:8736] 0.271 0.278 0.27 0.395 0.389 ...
>>   .. ..$ set.var        : num [1:8736] 0.0881 0.0882 0.0885 0.0902 0.0904 ...
>>   .. ..$ stiri.pred     : num [1:8736] 0.001931 0.000777 0.0046 0 0 ...
>>   .. ..$ stiri.var      : num [1:8736] 0.101 0.101 0.101 0.106 0.106 ...
>>   .. ..$ tri.pred       : num [1:8736] 0.11 0.111 0.118 0.123 0.129 ...
>>   .. ..$ tri.var        : num [1:8736] 0.134 0.134 0.134 0.136 0.136 ...
>>
>> I would like to create a map from predictions of course. 
>>
>> What i found out is that your latest code works until labels line gets called.But funny thing is , when  I use this line :
>> z$class = factor(apply(cbind(z$nic.pred,z$ena.pred, z$dva.pred, z$tri.pred, z$stiri.pred,   z$pet.pred, z$set.pred, z$sedem.pred, z$osem.pred, z$devet.pred), 1, which.max))
>>
>> i get :
>>
>>> levels(z$class)
>> [1] "1" "2" "3" "4" "5" "6" "7" "8"
>>
>> Any ideas? 
>>
>> tnx, m
>> -----Original Message-----
>> From: r-sig-geo-bounces at r-project.org 
>> [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Edzer Pebesma
>> Sent: Sunday, July 24, 2011 8:04 PM
>> To: r-sig-geo at r-project.org
>> Subject: Re: [R-sig-Geo] Indicator kriging map creation
>>
>> Matevz, try
>>
>> z$class = factor(apply(cbind(z$dva.pred, z$ena.pred, z$nic.pred,
>> 	z$stiri.pred, z$tri.pred), 1, which.max),
>> 	labels=c("dva", "ena", "nic", "stiri", "tri"))
>> spplot(z["class"])
>>
>>
>> On 07/24/2011 06:22 PM, Matev? Pavli? wrote:
>>> Hi list users,
>>>
>>>  
>>>
>>> i am trying to do indicator kriging on a set of soild samples. 
>>>
>>>  
>>>
>>> I manage to do the predction of several classes  into a  "SpatialPixelsDataFrame" using the gstat object and predict() function. First a created a  gstat object of several soil classes which I later fitted with a linear model of coregonalization. 
>>>
>>>  
>>>
>>> After that i used predict() to generate a SpatialPixelsDataFrame which hold information about predictions, variance and covariances. 
>>>
>>>  
>>>
>>> I am mostly interested in predoctions of each class. I know how to create a spplot or levelplot of each of the predicted classes on its own, but what i would like to achieve is to create a map of this predictions, so that the class with highest value (from 0-1) would prevail on each of the grid cell. In this way i would get a map of soil classes. 
>>>
>>>  
>>>
>>> Attached is the reproducible sample and a picture of prediction that i would like covert to a map of Soil classes (SoilFactor). But i get stuck when i try to create a actual map. That means getting the max value of each pixels and assign a name to that pixel.
>>>
>>>  
>>>
>>> I hope i explained ok, if not i'll try again. 
>>>
>>>  
>>>
>>> Thanks for any ideas or help, m
>>>
>>>
>>>
>>>
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Edzer Pebesma
>> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
>> http://www.52north.org/geostatistics      e.pebesma at wwu.de
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> --
> Edzer Pebesma
> Institute for Geoinformatics (ifgi), University of M?nster Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251 8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
> http://www.52north.org/geostatistics      e.pebesma at wwu.de

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From amorenos1 at ucentral.edu.co  Mon Jul 25 01:42:18 2011
From: amorenos1 at ucentral.edu.co (Angelo Moreno)
Date: Sun, 24 Jul 2011 16:42:18 -0700 (PDT)
Subject: [R-sig-Geo] Static map with markers -RgoogleMaps
Message-ID: <1311550938176-6616705.post@n2.nabble.com>

Hi, My name is Angelo. I'm from Bogota, Colombia,I'm trying to generate this
static map with markers,with  RgoogleMaps Package:
 
lat = c(4.667122,4.656577,4.666017)
lon = c(-74.05354,-74.05762,-74.05635)
center = c(mean(lat), mean(lon))
zoom <- min(MaxZoom(range(lat), range(lon)))
MyMap <- GetMap(center=center, zoom=zoom,markers =
"color:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635",
destfile = "MyTile2.png")
 
 but the software shows me the next error: 
 
[1]
"color:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635"
[1]
"http://maps.google.com/maps/api/staticmap?center=4.66323866666667,-74.0558366666667&zoom=16&size=640x640&maptype=terrain&format=png32&sensor=truecolor:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635"
Error en download.file(url, destfile, mode = "wb", quiet = TRUE) : 
  no fue posible abrir la URL
'http://maps.google.com/maps/api/staticmap?center=4.66323866666667,-74.0558366666667&zoom=16&size=640x640&maptype=terrain&format=png32&sensor=truecolor:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635'
Adem?s: Mensajes de aviso perdidos
In download.file(url, destfile, mode = "wb", quiet = TRUE) :
  no fue posible abrir: el status HTTP fue '403 Forbidden'
 
Could somebody help me?.Thanks a lot.
 
 
 
Angelo Moreno
Central University,Bogot?, Colombia- South America

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Static-map-with-markers-RgoogleMaps-tp6616705p6616705.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From pierre.roudier at gmail.com  Mon Jul 25 02:41:01 2011
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Mon, 25 Jul 2011 12:41:01 +1200
Subject: [R-sig-Geo] Static map with markers -RgoogleMaps
In-Reply-To: <1311550938176-6616705.post@n2.nabble.com>
References: <1311550938176-6616705.post@n2.nabble.com>
Message-ID: <CADLQFsO+mFKZgKNntYa_vwasV60z4bVt8p_zQDYw2RFS21Ghhg@mail.gmail.com>

Hi Angelo,

It seems to be impossible for the function to get the data from
internet. Can you access the web from your machine? Are you behind a
proxy?

Pierre

2011/7/25 Angelo Moreno <amorenos1 at ucentral.edu.co>:
> Hi, My name is Angelo. I'm from Bogota, Colombia,I'm trying to generate this
> static map with markers,with ?RgoogleMaps Package:
>
> lat = c(4.667122,4.656577,4.666017)
> lon = c(-74.05354,-74.05762,-74.05635)
> center = c(mean(lat), mean(lon))
> zoom <- min(MaxZoom(range(lat), range(lon)))
> MyMap <- GetMap(center=center, zoom=zoom,markers =
> "color:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635",
> destfile = "MyTile2.png")
>
> ?but the software shows me the next error:
>
> [1]
> "color:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635"
> [1]
> "http://maps.google.com/maps/api/staticmap?center=4.66323866666667,-74.0558366666667&zoom=16&size=640x640&maptype=terrain&format=png32&sensor=truecolor:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635"
> Error en download.file(url, destfile, mode = "wb", quiet = TRUE) :
> ?no fue posible abrir la URL
> 'http://maps.google.com/maps/api/staticmap?center=4.66323866666667,-74.0558366666667&zoom=16&size=640x640&maptype=terrain&format=png32&sensor=truecolor:blue|label:S|4.667122,-74.05354,markers=color:green|label:G|4.656577,-74.05762,markers=color:red|color:red|label:C|4.666017,-74.05635'
> Adem?s: Mensajes de aviso perdidos
> In download.file(url, destfile, mode = "wb", quiet = TRUE) :
> ?no fue posible abrir: el status HTTP fue '403 Forbidden'
>
> Could somebody help me?.Thanks a lot.
>
>
>
> Angelo Moreno
> Central University,Bogot?, Colombia- South America
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Static-map-with-markers-RgoogleMaps-tp6616705p6616705.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Scientist
Landcare Research, New Zealand


From john.callahan at udel.edu  Mon Jul 25 03:29:33 2011
From: john.callahan at udel.edu (John Callahan)
Date: Sun, 24 Jul 2011 21:29:33 -0400
Subject: [R-sig-Geo] Static map with markers -RgoogleMaps
In-Reply-To: <1311550938176-6616705.post@n2.nabble.com>
References: <1311550938176-6616705.post@n2.nabble.com>
Message-ID: <CAL=axXn6BTHGX7_h=Y8N085foN84g8KqAhW2ZJWbKFkx0O+9SA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110724/4a66b06f/attachment.pl>

From kevinwang at kpmg.com.au  Mon Jul 25 04:17:31 2011
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Mon, 25 Jul 2011 12:17:31 +1000
Subject: [R-sig-Geo] Shapefile Compatibility
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA0327FDBD@AUSYDEXC37.au.kworld.kpmg.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110725/9195c39e/attachment.pl>

From mdsumner at gmail.com  Mon Jul 25 04:37:44 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 25 Jul 2011 12:37:44 +1000
Subject: [R-sig-Geo] Shapefile Compatibility
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA0327FDBD@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA0327FDBD@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <CAAcGz9-mMMdt_cbTBQ_qd6uXzhXj70+coekK6Sa323jFOSMuFQ@mail.gmail.com>

As it stands, this is not reproducible code. Can you please replace
the file.choose() calls with the path to the actual .shp file, then we
could download the file and do the same. Also include full details of
exactly which file you download.

In case your R or packages are not up to date, please check that as
well and provide us with your sessionInfo() details.


Cheers, Mike.

On Mon, Jul 25, 2011 at 12:17 PM, Wang, Kevin (SYD)
<kevinwang at kpmg.com.au> wrote:
> Hi all,
>
>
>
> It's probably a [silly] question that's more to do with "Shapefiles"
> than R.
>
>
>
> I was just trying to read in a shape file from
> http://www.abs.gov.au/AUSSTATS/abs at .nsf/DetailsPage/1270.0.55.003July%20
> 2011?OpenDocument
>
>> Suburb10aAust.shp <- readShapePoly(file.choose(),
> proj4string=CRS("+proj=longlat"))
>
> Shapefile type: PolygonM (25), # of Shapes: 8529
>
>
>
> Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
>
> ?Shapefile type not (yet) handled by this function
>
>
>
> I've also tried:
>
>> Suburb10aAust.shp <- readShapeSpatial(file.choose(),
> proj4string=CRS("+proj=longlat"))
>
> Error in readShapeSpatial(file.choose(), proj4string =
> CRS("+proj=longlat")) :
>
> ?File type cannot be read
>
>
>
> Does this mean that the source file isn't a proper shapefile?
>
>
>
> Kind regards
>
>
> Kevin Wang
>
> Manager, Government Advisory Services
> Advisory
>
> KPMG
> 10 Shelley Street
> Sydney ?NSW ?2000 ?Australia
>
>
>
> Tel
>
> ? ? ? ?+61 2 9335 8282
>
> Fax
>
> ? ? ? ?+61 2 9335 7001
>
> Mob
>
> ? ? ? ?0419 374 580
>
> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au>
>
>
>
> kpmg.com.au <http://kpmg.com.au>
>
>
>
> Protect the environment: please think before you print
>
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From kevinwang at kpmg.com.au  Mon Jul 25 04:43:13 2011
From: kevinwang at kpmg.com.au (Wang, Kevin (SYD))
Date: Mon, 25 Jul 2011 12:43:13 +1000
Subject: [R-sig-Geo] Shapefile Compatibility
In-Reply-To: <CAAcGz9-mMMdt_cbTBQ_qd6uXzhXj70+coekK6Sa323jFOSMuFQ@mail.gmail.com>
References: <378EB90FD48A9E47A49222E07DF06BAA0327FDBD@AUSYDEXC37.au.kworld.kpmg.com>
	<CAAcGz9-mMMdt_cbTBQ_qd6uXzhXj70+coekK6Sa323jFOSMuFQ@mail.gmail.com>
Message-ID: <378EB90FD48A9E47A49222E07DF06BAA0327FE48@AUSYDEXC37.au.kworld.kpmg.com>

Hi all,

Apologies for the non-reproducible code.

I've downloaded the following two files from the website:
  * State Suburbs ASGS Non ABS Structures Ed 2011 Digital Boundaries in ESRI Shapefile Format
  * Australian Drainage Divisions ASGS Non ABS Structures Ed 2011 Digital Boundaries in MapInfo ESRI Shapefile Format

I then unzipped them into a folder and tried to read in:
  * SSC_2011_AUST.shp
  * ADD_2011_AUST.shp
using the code I mentioned (separately, of course).

sessionInfo() gave me:
> sessionInfo()
R version 2.13.0 (2011-04-13)
Platform: i386-pc-mingw32/i386 (32-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252   
[3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                      
[5] LC_TIME=English_Australia.1252    

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] rgdal_0.7-1     rgeos_0.1-8     stringr_0.5     gdata_2.8.2     classInt_0.1-14
 [6] e1071_1.5-26    class_7.3-3     maptools_0.8-9  lattice_0.19-23 sp_0.9-83      
[11] foreign_0.8-43  gpclib_1.5-1    rcom_2.2-3.1    rscproxy_1.3-1 

loaded via a namespace (and not attached):
[1] grid_2.13.0  gtools_2.6.2 plyr_1.5.2   tools_2.13.0

Thanks!

Kevin



 

-----Original Message-----
From: Michael Sumner [mailto:mdsumner at gmail.com] 
Sent: Monday, 25 July 2011 12:38 PM
To: Wang, Kevin (SYD)
Cc: r-sig-geo at r-project.org
Subject: Re: [R-sig-Geo] Shapefile Compatibility

As it stands, this is not reproducible code. Can you please replace the file.choose() calls with the path to the actual .shp file, then we could download the file and do the same. Also include full details of exactly which file you download.

In case your R or packages are not up to date, please check that as well and provide us with your sessionInfo() details.


Cheers, Mike.

On Mon, Jul 25, 2011 at 12:17 PM, Wang, Kevin (SYD) <kevinwang at kpmg.com.au> wrote:
> Hi all,
>
>
>
> It's probably a [silly] question that's more to do with "Shapefiles"
> than R.
>
>
>
> I was just trying to read in a shape file from 
> http://www.abs.gov.au/AUSSTATS/abs at .nsf/DetailsPage/1270.0.55.003July%
> 20
> 2011?OpenDocument
>
>> Suburb10aAust.shp <- readShapePoly(file.choose(),
> proj4string=CRS("+proj=longlat"))
>
> Shapefile type: PolygonM (25), # of Shapes: 8529
>
>
>
> Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
>
> ?Shapefile type not (yet) handled by this function
>
>
>
> I've also tried:
>
>> Suburb10aAust.shp <- readShapeSpatial(file.choose(),
> proj4string=CRS("+proj=longlat"))
>
> Error in readShapeSpatial(file.choose(), proj4string =
> CRS("+proj=longlat")) :
>
> ?File type cannot be read
>
>
>
> Does this mean that the source file isn't a proper shapefile?
>
>
>
> Kind regards
>
>
> Kevin Wang
>
> Manager, Government Advisory Services
> Advisory
>
> KPMG
> 10 Shelley Street
> Sydney ?NSW ?2000 ?Australia
>
>
>
> Tel
>
> ? ? ? ?+61 2 9335 8282
>
> Fax
>
> ? ? ? ?+61 2 9335 7001
>
> Mob
>
> ? ? ? ?0419 374 580
>
> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au>
>
>
>
> kpmg.com.au <http://kpmg.com.au>
>
>
>
> Protect the environment: please think before you print
>
>
>
>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



--
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
e-mail: mdsumner at gmail.com

******************************************************************

The information in this e-mail is confidential and may be legally
privileged. It is intended solely for the addressee. Access to this
e-mail by anyone else is unauthorised. If you have received this
communication in error, please notify us immediately by return
e-mail with the subject heading "Received in error" or telephone
+61 2 93357000, then delete the email and destroy any copies of it.
If you are not the intended recipient, any disclosure, copying,
distribution or any action taken or omitted to be taken in reliance
on it, is prohibited and may be unlawful. Any opinions or advice
contained in this e-mail are subject to the terms and conditions
expressed in the governing KPMG client engagement letter. Opinions,
conclusions and other information in this e-mail and any
attachments that do not relate to the official business of the firm
are neither given nor endorsed by it. 

KPMG cannot guarantee that e-mail communications are secure or
error-free, as information could be intercepted, corrupted,
amended, lost, destroyed, arrive late or incomplete, or contain
viruses. 

KPMG, an Australian partnership and a member firm of the KPMG
network of independent member firms affiliated with KPMG
International Cooperative (?KPMG International?), a Swiss entity. 
KPMG International provides no services to clients.  

Liability limited by a scheme approved under Professional Standards
Legislation. 

******************************************************************

From mdsumner at gmail.com  Mon Jul 25 05:04:30 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 25 Jul 2011 13:04:30 +1000
Subject: [R-sig-Geo] Shapefile Compatibility
In-Reply-To: <378EB90FD48A9E47A49222E07DF06BAA0327FE48@AUSYDEXC37.au.kworld.kpmg.com>
References: <378EB90FD48A9E47A49222E07DF06BAA0327FDBD@AUSYDEXC37.au.kworld.kpmg.com>
	<CAAcGz9-mMMdt_cbTBQ_qd6uXzhXj70+coekK6Sa323jFOSMuFQ@mail.gmail.com>
	<378EB90FD48A9E47A49222E07DF06BAA0327FE48@AUSYDEXC37.au.kworld.kpmg.com>
Message-ID: <CAAcGz99ygd0P47_rCgoLM9EdeHe3PD3LJR3+A8Btb28OmDTqgw@mail.gmail.com>

Ok, here's what I get - readShapePoly says it's an M-shapefile - as
there are 4 coordinate attributes, X, Y, Z, and M* on the vertices. I
would use rgdal if you can - OGR does not support the M coordinate but
it does Z, though these are discarded by readOGR. (They don't really
sensibly fit in any "flat" polygon data model but that's a long
story).

*  the fourth is not really a coordinate but a relative "Measure"
usually to store distance from a start point, but can be used to store
time (or other geometric dimension)

library(maptools)
 d <- readShapePoly("SSC_2011_AUST.shp")
Shapefile type: PolygonM (25), # of Shapes: 8529

Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
  Shapefile type not (yet) handled by this function


Move to rgdal, this gives us useable 2D geometry data.

library(rgdal)

d <- readOGR(".", "SSC_2011_AUST")
OGR data source with driver: ESRI Shapefile
Source: ".", layer: "SSC_2011_AUST"
with 8529 features and 4 fields
Feature type: wkbPolygon with 3 dimensions
Warning messages:
1: In readOGR(".", "SSC_2011_AUST") :
  Dropping null geometries: 2627, 2628, 2629, 4174, 4175, 4176, 6036,
6037, 6884, 6885, 6886, 7774, 7775, 8196, 8197, 8198, 8415, 8416,
8520, 8521, 8522, 8528, 8529
2: In readOGR(".", "SSC_2011_AUST") : Z-dimension discarded


> sessionInfo()
R version 2.13.1 Patched (2011-07-09 r56344)
Platform: x86_64-pc-mingw32/x64 (64-bit)

locale:
[1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252
   LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
  LC_TIME=English_Australia.1252

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] rgdal_0.7-1     maptools_0.8-9  lattice_0.19-30 sp_0.9-83
foreign_0.8-44

loaded via a namespace (and not attached):
[1] grid_2.13.1  tools_2.13.1

On Mon, Jul 25, 2011 at 12:43 PM, Wang, Kevin (SYD)
<kevinwang at kpmg.com.au> wrote:
> Hi all,
>
> Apologies for the non-reproducible code.
>
> I've downloaded the following two files from the website:
> ?* State Suburbs ASGS Non ABS Structures Ed 2011 Digital Boundaries in ESRI Shapefile Format
> ?* Australian Drainage Divisions ASGS Non ABS Structures Ed 2011 Digital Boundaries in MapInfo ESRI Shapefile Format
>
> I then unzipped them into a folder and tried to read in:
> ?* SSC_2011_AUST.shp
> ?* ADD_2011_AUST.shp
> using the code I mentioned (separately, of course).
>
> sessionInfo() gave me:
>> sessionInfo()
> R version 2.13.0 (2011-04-13)
> Platform: i386-pc-mingw32/i386 (32-bit)
>
> locale:
> [1] LC_COLLATE=English_Australia.1252 ?LC_CTYPE=English_Australia.1252
> [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C
> [5] LC_TIME=English_Australia.1252
>
> attached base packages:
> [1] stats ? ? graphics ?grDevices datasets ?utils ? ? methods ? base
>
> other attached packages:
> ?[1] rgdal_0.7-1 ? ? rgeos_0.1-8 ? ? stringr_0.5 ? ? gdata_2.8.2 ? ? classInt_0.1-14
> ?[6] e1071_1.5-26 ? ?class_7.3-3 ? ? maptools_0.8-9 ?lattice_0.19-23 sp_0.9-83
> [11] foreign_0.8-43 ?gpclib_1.5-1 ? ?rcom_2.2-3.1 ? ?rscproxy_1.3-1
>
> loaded via a namespace (and not attached):
> [1] grid_2.13.0 ?gtools_2.6.2 plyr_1.5.2 ? tools_2.13.0
>
> Thanks!
>
> Kevin
>
>
>
>
>
> -----Original Message-----
> From: Michael Sumner [mailto:mdsumner at gmail.com]
> Sent: Monday, 25 July 2011 12:38 PM
> To: Wang, Kevin (SYD)
> Cc: r-sig-geo at r-project.org
> Subject: Re: [R-sig-Geo] Shapefile Compatibility
>
> As it stands, this is not reproducible code. Can you please replace the file.choose() calls with the path to the actual .shp file, then we could download the file and do the same. Also include full details of exactly which file you download.
>
> In case your R or packages are not up to date, please check that as well and provide us with your sessionInfo() details.
>
>
> Cheers, Mike.
>
> On Mon, Jul 25, 2011 at 12:17 PM, Wang, Kevin (SYD) <kevinwang at kpmg.com.au> wrote:
>> Hi all,
>>
>>
>>
>> It's probably a [silly] question that's more to do with "Shapefiles"
>> than R.
>>
>>
>>
>> I was just trying to read in a shape file from
>> http://www.abs.gov.au/AUSSTATS/abs at .nsf/DetailsPage/1270.0.55.003July%
>> 20
>> 2011?OpenDocument
>>
>>> Suburb10aAust.shp <- readShapePoly(file.choose(),
>> proj4string=CRS("+proj=longlat"))
>>
>> Shapefile type: PolygonM (25), # of Shapes: 8529
>>
>>
>>
>> Error in read.shape(filen = fn, verbose = verbose, repair = repair) :
>>
>> ?Shapefile type not (yet) handled by this function
>>
>>
>>
>> I've also tried:
>>
>>> Suburb10aAust.shp <- readShapeSpatial(file.choose(),
>> proj4string=CRS("+proj=longlat"))
>>
>> Error in readShapeSpatial(file.choose(), proj4string =
>> CRS("+proj=longlat")) :
>>
>> ?File type cannot be read
>>
>>
>>
>> Does this mean that the source file isn't a proper shapefile?
>>
>>
>>
>> Kind regards
>>
>>
>> Kevin Wang
>>
>> Manager, Government Advisory Services
>> Advisory
>>
>> KPMG
>> 10 Shelley Street
>> Sydney ?NSW ?2000 ?Australia
>>
>>
>>
>> Tel
>>
>> ? ? ? ?+61 2 9335 8282
>>
>> Fax
>>
>> ? ? ? ?+61 2 9335 7001
>>
>> Mob
>>
>> ? ? ? ?0419 374 580
>>
>> kevinwang at kpmg.com.au <mailto:kevinwang at kpmg.com.au>
>>
>>
>>
>> kpmg.com.au <http://kpmg.com.au>
>>
>>
>>
>> Protect the environment: please think before you print
>>
>>
>>
>>
>>
>> ? ? ? ?[[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
> --
> Michael Sumner
> Institute for Marine and Antarctic Studies, University of Tasmania Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> ******************************************************************
>
> The information in this e-mail is confidential and may be legally
> privileged. It is intended solely for the addressee. Access to this
> e-mail by anyone else is unauthorised. If you have received this
> communication in error, please notify us immediately by return
> e-mail with the subject heading "Received in error" or telephone
> +61 2 93357000, then delete the email and destroy any copies of it.
> If you are not the intended recipient, any disclosure, copying,
> distribution or any action taken or omitted to be taken in reliance
> on it, is prohibited and may be unlawful. Any opinions or advice
> contained in this e-mail are subject to the terms and conditions
> expressed in the governing KPMG client engagement letter. Opinions,
> conclusions and other information in this e-mail and any
> attachments that do not relate to the official business of the firm
> are neither given nor endorsed by it.
>
> KPMG cannot guarantee that e-mail communications are secure or
> error-free, as information could be intercepted, corrupted,
> amended, lost, destroyed, arrive late or incomplete, or contain
> viruses.
>
> KPMG, an Australian partnership and a member firm of the KPMG
> network of independent member firms affiliated with KPMG
> International Cooperative (?KPMG International?), a Swiss entity.
> KPMG International provides no services to clients.
>
> Liability limited by a scheme approved under Professional Standards
> Legislation.
>
> ******************************************************************



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From karl at huftis.org  Mon Jul 25 11:14:35 2011
From: karl at huftis.org (Karl Ove Hufthammer)
Date: Mon, 25 Jul 2011 11:14:35 +0200
Subject: [R-sig-Geo] Calculating areas on Earth's surface
References: <mailman.11.1311328803.31685.r-sig-geo@r-project.org>
	<4E29BE0E.1020609@matthewvavrek.com>
Message-ID: <j0jc5l$o83$1@dough.gmane.org>

Matthew Vavrek wrote:

> have you looked at the PBSmapping package? It has a calcArea() function
> that might do what you need it to do. However, you need to get your data
> converted to a PolySet rather than a SpatialPolygons object.

Thanks for the suggestion. It seems that PBSmapping uses an UTM 
transformation based on the location of the (entire) PolySet.
The accuracy is thus not good enough (e.g., if you want to see
the distortion caused *by* a standard UTM projection), but it gave
me an idea:

For each polygon / grid cell, create an projection tailored to this 
exact polygon, for example a non-standard transverse Mercator projection.
Use this to calculate the area of the polygon. If the polygon isn?t too 
big, this should work well.

Here?s some example code, that aims to visually present the amount of
area distortion caused by an UTM zone 33 projection. Note the use
of +k=1.0 to make the distortion in the transverse Mercator projection
be ~0 in the *middle* of each polygon.

#########################################################################
# Various packages used
library(rgdal)
library(mapdata)
library(maptools)

# Bounding box
xl=c(4,30)
yl=c(57,72)

unproj=CRS("+init=epsg:4326") # Unprojected (longlat)
proj=CRS("+init=epsg:32633")  # UTM zone 33

# Fetch a simple map for overlaying
wmap=map("worldHires", c("Norway","Sweden","Denmark"), xlim=xl, ylim=yl, fill=TRUE, plot=FALSE, resolution=0)
wmap.sp=map2SpatialPolygons(wmap, wmap$names, proj4string=unproj)
wmap.sp.proj=spTransform(wmap.sp, proj)

# Create a grid 
bb=bbox(wmap.sp.proj)
grid.lowerleft=floor(c(bb[1,1],bb[2,1]))
cell.s=50*c(1e3,1e3)
cell.d=ceiling((c(diff(bb[1,]),diff(bb[2,])))/cell.s)
cells=as.SpatialPolygons.GridTopology(GridTopology(grid.lowerleft, cell.s, cell.d))
proj4string(cells)=proj

# Transform the grid cells to longlat, so that we can extract their
# centroid longlat coordinates for use in determining an appropriate projection
cells.ll=spTransform(cells, unproj)
areas=numeric(length(cells.ll)) # Vector to hold the cell areas
for(i in seq_along(cells.ll)) {
  cell=cells.ll[i,]
  pos=coordinates(cell)
  tproj=CRS(paste("+proj=tmerc +lat_0=", pos[2]," +lon_0=",pos[1], " +k=1.0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0",sep=""))
  areas[i]=spTransform(cell, tproj)@polygons[[1]]@area/1e6
}

# Convert the grid cells to a SpatialPolygonsDataFrame
# holding the areas of each cell
cells=as(cells, "SpatialPolygonsDataFrame")
cells$dummy=areas
cell.area.exp=prod(cell.s)/1e6
maxdiff=ceiling(max(abs(areas-cell.area.exp)))
spplot(cells, sp.layout = list(list("sp.polygons", wmap.sp.proj,lw=2)),
              at=seq(cell.area.exp-maxdiff,cell.area.exp+maxdiff, length=18))
#########################################################################

The result does at least look *reasonable*, with the least amount of 
distortion not in the centre of the UTM projection, but in two bands
a few degrees east/west of the centre.

I wouldn?t trust the results too much, though, as other choices of
projections (e.g., ?omerc? instead of ?tmerc?) gives other results.
I?m not sure which projection to use to ensure optimal results. 

-- 
Karl Ove Hufthammer


From E.Couce.07 at bristol.ac.uk  Mon Jul 25 11:56:16 2011
From: E.Couce.07 at bristol.ac.uk (ElenaC)
Date: Mon, 25 Jul 2011 02:56:16 -0700 (PDT)
Subject: [R-sig-Geo] Subsetting a SpatialPixels object: different
 behaviour with different versions of R and sp
In-Reply-To: <4E295E12.7090908@uni-muenster.de>
References: <11306858-A276-4F2B-BCCE-D3F9D351B29B@bristol.ac.uk>
	<4E295E12.7090908@uni-muenster.de>
Message-ID: <1311587776334-6617711.post@n2.nabble.com>


Thank you very much, Edzer!!  Adding "drop=TRUE" does indeed solve the
problem  

Cheers
Elena

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Subsetting-a-SpatialPixels-object-different-behaviour-with-different-versions-of-R-and-sp-tp6610117p6617711.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From muhammad.rahiz at ouce.ox.ac.uk  Mon Jul 25 13:01:27 2011
From: muhammad.rahiz at ouce.ox.ac.uk (Muhammad Rahiz)
Date: Mon, 25 Jul 2011 12:01:27 +0100
Subject: [R-sig-Geo] plot border
Message-ID: <alpine.LRH.2.02.1107251157530.32171@norway.ouce.ox.ac.uk>

Hi all,

When running the following script, I can plot the image.
Does anyone know how I can get the outline/border of the image? 
Sample data is attached.

Thanks - Muhammad

library(ncdf)
library(maptools)

dat <- get.var.ncdf(open.ncdf("obs.r06q7.nc"))
lon <- x0$dim[[1]]$val
lat <- x0$dim[[2]]$val
image(lon,lat,dat)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: obs.r06q7.nc
Type: application/x-netcdf
Size: 13480 bytes
Desc: 
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110725/589d37f6/attachment.nc>

From csilva at ipimar.pt  Mon Jul 25 13:26:18 2011
From: csilva at ipimar.pt (Cristina Silva)
Date: Mon, 25 Jul 2011 12:26:18 +0100
Subject: [R-sig-Geo] Problem with "image" function
In-Reply-To: <4E2A7C23.40505@cirad.fr>
References: <4E29BA61.7050505@ipimar.pt> <4E2A7C23.40505@cirad.fr>
Message-ID: <4E2D52DA.9070008@ipimar.pt>

Thank you for your e-mail. I'm working in Windows environment and had 
never used a patched version before. It worked.

Regards,

Cristina

On 23/07/2011 08:45, lancelot wrote:
> Update R to the latest patched version.
>
> R
>
> Le 22/07/2011 19:58, Cristina Silva a ?crit :
>> Dear list members,
>>
>> I have a SpatialGridDataFrame with sea depths. I have previously plotted
>> this object using "image" with a grey scale. I have used exactly the
>> same script and now the result is crossed by horizontal white lines.
>>
>> As the script used was based in chunk no. 91 of cm_mod.R (book ASDAR,
>> figure 2.7), I repeated this script
>>
>>> oopar <- par(mar=c(1,1,1,1)+0.1)
>>> grys <- grey.colors(8, 0.55, 0.95, 2.2)
>>> image(auck_el1, "band1", col=grys)
>>> plot(auck_gshhs, add=TRUE, pbg="white")
>>> transect_sp <- 
>>> SpatialPoints(coords=cbind(seq(174.458,175.3,0.000833333),
>>> c(-37.03625)), proj4string=CRS("+proj=longlat +ellps=WGS84"))
>>> plot(transect_sp, add=TRUE, pch="-", cex=2)
>>> legend_image(c(174.2,174.25), c(-37.5,-37.2), auck_el1$band1,
>>> vertical=TRUE,
>>> offset.leg=0.8, col=grys)
>>> par(oopar)
>>
>> and the result was also crossed by the same white horizontal lines.
>>
>> I am using R version 2.13.1. I didn't have any problems with previous
>> versions.
>>
>> Thanks for your attention
>>
>> Cristina
>>
>


-- 
------------------------------------------
Cristina Silva
INRB/L-IPIMAR
Unidade de Recursos Marinhos e Sustentabilidade
Av. de Bras?lia, 1449-006 Lisboa
Portugal
Tel.: 351 21 3027096
Fax: 351 21 3015948
csilva at ipimar.pt


From alobolistas at gmail.com  Mon Jul 25 15:48:33 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Mon, 25 Jul 2011 15:48:33 +0200
Subject: [R-sig-Geo] initGRASS() under linux
Message-ID: <CAG4NReLfGCnpeTgjcuAuhJs1_=o87oGj7wpzbMD3F0U5i5Etug@mail.gmail.com>

Is it necessary to start R from within the GRASS console to use
spgrass6 under linux?
My understanding was that initGRASS() would let you set the grass environment
not having GRASS actually running.

Thanks

Agus


From r.m.krug at gmail.com  Mon Jul 25 15:56:28 2011
From: r.m.krug at gmail.com (Rainer M Krug)
Date: Mon, 25 Jul 2011 15:56:28 +0200
Subject: [R-sig-Geo] initGRASS() under linux
In-Reply-To: <CAG4NReLfGCnpeTgjcuAuhJs1_=o87oGj7wpzbMD3F0U5i5Etug@mail.gmail.com>
References: <CAG4NReLfGCnpeTgjcuAuhJs1_=o87oGj7wpzbMD3F0U5i5Etug@mail.gmail.com>
Message-ID: <CAGhLh6ECZk1ZGuoiQEC3Zope4MfO2j=35vmCwPymkvEtRjz6Ug@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110725/b7726c41/attachment.pl>

From j.m.signer at gmail.com  Mon Jul 25 15:57:42 2011
From: j.m.signer at gmail.com (Johannes Signer)
Date: Mon, 25 Jul 2011 09:57:42 -0400
Subject: [R-sig-Geo] initGRASS() under linux
In-Reply-To: <CAG4NReLfGCnpeTgjcuAuhJs1_=o87oGj7wpzbMD3F0U5i5Etug@mail.gmail.com>
References: <CAG4NReLfGCnpeTgjcuAuhJs1_=o87oGj7wpzbMD3F0U5i5Etug@mail.gmail.com>
Message-ID: <CAC8qavs2C-xd=wkLaKZ_E=4Kj=AF68g2NmQ69PJjmv7FyM5YRw@mail.gmail.com>

Hello,

yes you can, the following worked for me with Ubuntu 10.10:

initGRASS(gisBase=gisBase,gisDbase=gisDbase, location=name_location,
mapset=name_mapset,override=override)

# execute a command
execGRASS("g.region", parameters=list(res=as.character("1"))

HTH
Johannes

On Mon, Jul 25, 2011 at 9:48 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Is it necessary to start R from within the GRASS console to use
> spgrass6 under linux?
> My understanding was that initGRASS() would let you set the grass environment
> not having GRASS actually running.
>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From lmorandini at ieee.org  Mon Jul 25 16:18:55 2011
From: lmorandini at ieee.org (Luca Morandini)
Date: Mon, 25 Jul 2011 16:18:55 +0200
Subject: [R-sig-Geo] Wavelet and anisotropy
Message-ID: <j0ju0f$93f$1@dough.gmane.org>

Folks,

I was not able to find a wavelet-based methods in R to analyse anisotropy in point 
processes: could someone give me some pointers on this topic ?

Regards,

Luca Morandini
http://www.lucamorandini.it


From jochen.albrecht at gmail.com  Mon Jul 25 18:54:21 2011
From: jochen.albrecht at gmail.com (Jochen Albrecht)
Date: Mon, 25 Jul 2011 12:54:21 -0400
Subject: [R-sig-Geo] time slot in space-time sparse data frame (spacetime
	package)
Message-ID: <CAKRQQ2TGC3h5VX=SW3uDDsvYdxwhX6+L==t-OrHCiexyzrB4Kg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110725/b5db50ac/attachment.pl>

From edzer.pebesma at uni-muenster.de  Mon Jul 25 19:26:07 2011
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 25 Jul 2011 19:26:07 +0200
Subject: [R-sig-Geo] time slot in space-time sparse data frame
 (spacetime package)
In-Reply-To: <CAKRQQ2TGC3h5VX=SW3uDDsvYdxwhX6+L==t-OrHCiexyzrB4Kg@mail.gmail.com>
References: <CAKRQQ2TGC3h5VX=SW3uDDsvYdxwhX6+L==t-OrHCiexyzrB4Kg@mail.gmail.com>
Message-ID: <4E2DA72F.9090600@uni-muenster.de>

Hi Jochen, thanks for your useful questions;

On 07/25/2011 06:54 PM, Jochen Albrecht wrote:
> Hi:
> 1. I am working with the spacetime package and have successfully ingested a
> dataset into its *irregular* space-time data frame using coordinates for
> space, an xts object for time and auxiliary data for the attribute data.
> Next I tried to create a sparse space-time data frame (i.e. a grid) using
> the same pieces of data is successfully used before, plus the additional
> index. The STSDF function choked on the xts data that I tried to provide it
> with. The documentation on the sparse space-time data frame is, excuse the
> pun, sparse. 

Where exactly had you expected more information?

> There is no indication that the data structure to represent
> time is any different. The exact error message I get is:
> Error in checkSlotAssignment(object, name, value) :
>   c("assignment of an object of class \"POSIXct\" is not valid for slot
> \"time\" in an object of class \"ST\"; is(value, \"xts\") is not TRUE",
> "assignment of an object of class \"POSIXt\" is not valid for slot \"time\"
> in an object of class \"ST\"; is(value, \"xts\") is not TRUE")


This is indeed a bit cryptic for non-R-developers, and we try to catch
these things and provide sth more useful. It will work in the next
spacetime release, but for now you can try, if time is your times array:

time = xts(1:length(time), time)

and pass that to STSDF (this worked, by mistake, only for STFDF and STIDF)

> 
> 2.  Unrelated to this I have a more general question of understanding. After
> creating and plotting the irregular space-time data frame, I tried to coerce
> it into a full grid, alas without success. Section 7.2 of the vignette
> illustrates how to move from a full grid to a sparse or irregular one and
> then back again. Could it be that starting with an irregular one does not
> work? I kind of would understand that because mere coercion does not provide
> all the information needed - which is why I ended up trying to create the
> gridded data frames directly (my first question).

What exactly didn't work? If you force irregular data into a grid, it
will, afaics, simply be VERY sparse...; pushed that into a full grid, it
will be VERY memory demanding.

> 
> 3.  Finally, the data that I am trying to massage are buoy paths expressed
> as a good 22 million individual space-time points. I was thinking of using
> the irregular space-time data frame structure to create the 14,855 buoy
> paths (all buoys send their location information every six hours, some buoys
> survive for up to eight years) and then to interpolate ocean current
> surfaces similar to the Irish wind example in the spacetime vignette. The
> vignette example uses full grids; will I be able to do that with the sparse
> space-time data frames because the full matrix of the full grid would
> certainly go beyond the capabilities of 'R'?

There is no "will I be able", there is only a "how will I", and the more
relevant question whether it will save you time, or cost you time,
relative to plan b -- and what plan b involves...

Are the time instances you mention aligned, or can you align them
yourself? Have you seen the vignette on proxying PostGIS tables with
spacetime objects?
http://cran.r-project.org/web/packages/spacetime/vignettes/stpg.pdf

Output of your analyses, or better, examples that we can reproduce make
it easier to provide helpful answers.

With best regards,

> 
> Cheers,
>      Jochen
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Edzer Pebesma
Institute for Geoinformatics (ifgi), University of M?nster
Weseler Stra?e 253, 48151 M?nster, Germany. Phone: +49 251
8333081, Fax: +49 251 8339763  http://ifgi.uni-muenster.de
http://www.52north.org/geostatistics      e.pebesma at wwu.de


From matevz.pavlic at gi-zrmk.si  Mon Jul 25 22:32:06 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Mon, 25 Jul 2011 22:32:06 +0200
Subject: [R-sig-Geo] Indicator kriging map creation
In-Reply-To: <4E2C8E86.9040308@uni-muenster.de>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DAFC@gi-zrmk.si>
	<4E2C5EA3.4090200@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB03@gi-zrmk.si>
	<4E2C72E5.8030403@uni-muenster.de>
	<AD5CA6183570B54F92AA45CE2619F9B90129DB05@gi-zrmk.si>
	<4E2C8E86.9040308@uni-muenster.de>
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129DB9E@gi-zrmk.si>

Hi Edzer, 

sorry for the long time to  reply.

>It might be annoying, and after all, it is your sole responsibility to make sure the right labels end up in the right place. R can only prevent you from making mistakes that are too obvious.

What do you think would be the best thing to do about that? Predict the classes on 3D grid? I mean, i would like to create a code that would generate maps of several classes (variing numbers of them) each depth interval. I think that prediction on 3D grid would be the right thing?
	

>Not so likely; I think it comes with simple kriging -- rare classes often show weak autocorrelation, resulting in low estimates everywhere.
>Without having seen your data, I suspect your classes 9 and 10 are like that.

Attached are the co-variograms of ten classes. As i can see there are few classes (devet=level 10 , osem=level 9...) that have nugget (pure nugget effect). This is probably because there are only a few point with that class in the area :

devet   dva   ena   nic  osem   pet sedem   set stiri   tri 
    5    50    85   209     3     7    83    71    49    89

Is there a way to fix this without discarding this classes?

Regards, 

m 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: variogram.png
Type: image/png
Size: 26318 bytes
Desc: variogram.png
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110725/487b5c82/attachment.png>

From roman.lustrik at gmail.com  Tue Jul 26 00:06:16 2011
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Tue, 26 Jul 2011 00:06:16 +0200
Subject: [R-sig-Geo] reading gpx using readOGR
In-Reply-To: <alpine.LRH.2.00.1107240846350.16717@reclus.nhh.no>
References: <CAHT1vpjyj76LJZP1iELUkL5UMa20hN_O7DsxzCyx4WhtfWqA1A@mail.gmail.com>
	<alpine.LRH.2.00.1107231050150.13472@reclus.nhh.no>
	<CAHT1vpj9AxjmO5ufbi6wxapQHX6FWj4mHYqh3EYA9dJ=q1RVsQ@mail.gmail.com>
	<alpine.LRH.2.00.1107231955520.14739@reclus.nhh.no>
	<CAHT1vpgqS+QdEbuJJndV82m+ZLzOu5uyZwYcxRJVt-NkPsnbCA@mail.gmail.com>
	<alpine.LRH.2.00.1107240846350.16717@reclus.nhh.no>
Message-ID: <CAHT1vpg1Xmo8DL6tVXfqK7eXuvbT6+Cj=mofK-adsWDCdsTvHw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110726/8bc2a15b/attachment.pl>

From janverbesselt at gmail.com  Tue Jul 26 14:43:03 2011
From: janverbesselt at gmail.com (Jan Verbesselt)
Date: Tue, 26 Jul 2011 14:43:03 +0200
Subject: [R-sig-Geo] extracting time series data from a raster brick of
	AVHRR satellite data
Message-ID: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110726/cb0839a1/attachment.pl>

From alobolistas at gmail.com  Tue Jul 26 14:46:31 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 26 Jul 2011 14:46:31 +0200
Subject: [R-sig-Geo] empty brick?
Message-ID: <CAG4NReK2gTbcFF88JE=2LPxqS1zJ70jwpzwxNcVC6GigvHas_Q@mail.gmail.com>

I have a process that creates a set of (large) raster layers.
Does it make sense defining an empty brick object
and then putting each layer as band of the brick?
Or is it better saving each layer and then make the brick?
Agus


From alfreale74 at gmail.com  Tue Jul 26 15:33:46 2011
From: alfreale74 at gmail.com (Alfredo Alessandrini)
Date: Tue, 26 Jul 2011 15:33:46 +0200
Subject: [R-sig-Geo] crop by pixel
Message-ID: <CA+GC7G46zD80C=SAhhahhv4WFpP5v4AaWoxHtH2BbzXVngsjsA@mail.gmail.com>

Hi,

I need to crop a raster by pixel value, from upper X,Y left.

I'm using this:

spot <- raster(.........)

x_shift <- 2

y_shift <- 2

crop(spot,extent(xmin(spot)+res(spot)[1]*x_shift,xmax(spot),ymin(spot),ymax(spot)-res(spot)[2]*y_shift))


It's work, but is there another way?



Thanks,

Alfredo


From martin_brandt at gmx.net  Tue Jul 26 16:26:04 2011
From: martin_brandt at gmx.net (Martin)
Date: Tue, 26 Jul 2011 07:26:04 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
Message-ID: <1311690364859-6622389.post@n2.nabble.com>

what I do to extract a pixel is:

>row=40
>col=58

>test = mybrick[i,j]

>s=ts(test, start=2001, end=c(2003, 36), frequency=36)


this is extremely fast, but you need to know the row and col of the pixel... 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6622389.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Tue Jul 26 17:27:16 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Tue, 26 Jul 2011 17:27:16 +0200
Subject: [R-sig-Geo] overlay with 2 bricks?
Message-ID: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>

I'm trying to combine 2 operations into one to speed up a process.
It's simple calculating a median raster across layers of a brick object, but
the values that must be considered NA are defined by a second brick.
Normally, we first set the NA in the brick and then calculate the median:

fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
decadaN_v2 <- overlay(decadaN, decadaS, fun=fun1, overwrite=TRUE)
a <- overlay(decadaN_v2, fun=median, na.rm=T, overwrite=TRUE)

But this is too slow (we actually try to do this for 36 bricks within
a loop). So I tried:

mimedian <- function(x,y) {
 x[y!=248 & y!=232] <- NA
 median(x,na.rm=T)
}

And then try to use overlay only once:

a <- overlay(decadaN, decadaS, fun=mimedian, na.rm=T, overwrite=TRUE)

but raster complains that the function is not vectorized.
Is there any way around? I suspect the problem is that overlay works
across layers if one brick is provided,
but not if 2 bricks are provided. In other words, we want x in
mimedian to be a vector of 1 pixel across layers but
actually is a brick object.

Agus


From cam.plouffe at gmail.com  Tue Jul 26 17:54:46 2011
From: cam.plouffe at gmail.com (Cam Plouffe)
Date: Tue, 26 Jul 2011 11:54:46 -0400
Subject: [R-sig-Geo] Using the gDifference function
Message-ID: <CAAN3GgDZmw23N5AFdJWOoCP7OyZ7zKdDiy4Eb8=or9f6cT5k3g@mail.gmail.com>

Hi everybody,

I would like to use the gDifference function from the rgeos package to find
the difference between 2 groups of polygons (poly1 and poly2).  I've tried
the gDifference function with my given polygons (I made 2 shapefiles of 3
simple polygons that overlap so I could see how the function was working)
and attached the output plot to this email.  I attached the gDifference
between the gUnion and the gIntersection of the 2 shapefiles, because it
shows you all the polygons from both shapefiles(in red), and where they
intersect (in white).  The gDifference function seemed to work for 2 of the
sets of overlapping polygons, but the 3rd (or rather the 1st, in the top
left) set of polygons was not affected (as far as I know).  I believe this
is because in the 2 overlapping polygons in the top left, the polygon from
poly2 is COMPLETELY contained within the polygon from poly1.  Ideally, I
would like the output to have a white hole where the overlapping polygon
from poly2 is currently (like the other polygons).

Here is the code I am using:

poly1 = polygons(spdf1)
poly2 = polygons(spdf2)

p_u = gUnion(poly1, poly2)
p_int = gIntersection(poly1, poly2)

p_diff = gDifference(p_u, p_int)
plot(p_diff, col = "red")


I tried using gSymdifference, and also tried using the original polygons as
opposed to the gUnion and gIntersection for the arguments
(gSymdifference(poly1, poly2) gives the same output plot as above), but the
same problem is always present.  I'm sure this problem can be rectified, but
I imagine the same situation will come up when analysing larger data sets,
so I'm going to look into it now.  There is a good chance I am not
interpreting the data properly, as I'm very new to R, but I would appreciate
any insight that could be provided.  I can provide more information
regarding my problem if it is needed/requested.

Thanks a lot,
Cam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110726/d00cb2b1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gDifference.png
Type: image/png
Size: 4234 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110726/d00cb2b1/attachment.png>

From martin_brandt at gmx.net  Tue Jul 26 19:32:00 2011
From: martin_brandt at gmx.net (Martin)
Date: Tue, 26 Jul 2011 10:32:00 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <1311690364859-6622389.post@n2.nabble.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
Message-ID: <1311701520849-6623034.post@n2.nabble.com>

sorry, it has to be:

>row=40 
>col=58 

>test = mybrick[row,col] 

btw: does anyone know how to get the row, col information in QGIS or GRASS?

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6623034.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From lberner at whrc.org  Tue Jul 26 22:21:16 2011
From: lberner at whrc.org (lberner at whrc.org)
Date: Tue, 26 Jul 2011 13:21:16 -0700 (PDT)
Subject: [R-sig-Geo] questions on RasterStack/Brick
In-Reply-To: <AANLkTi=3=VVyC26hu5vtBgekbfg_vTZ6tZSy8m7HO-HM@mail.gmail.com>
References: <1285055383938-5553580.post@n2.nabble.com>
	<AANLkTi=3=VVyC26hu5vtBgekbfg_vTZ6tZSy8m7HO-HM@mail.gmail.com>
Message-ID: <1311711676166-6623580.post@n2.nabble.com>

Dear all, 

Robert suggested that, with a little patience, the following code could be
used to correlate two raster stacks:

 r <- raster(s1)
for (i in 1:ncell(r)) {
    r[i] <- cor(as.vector(cellValues(s1, i)), as.vector(cellValues(s2, i)))
} 

Not having that much patience, my co-worked Pieter Beck and I wrote a
function to correlate two raster stacks of same x, y, and z extents. The
function is considerably faster than the code above: 

stack.correlation <- function(stack1, stack2, cor.method, na.val, na.rm =
T){
  # output template
  cor.map <- raster(stack1)
  # combine stacks
  T12 <- stack(stack1,stack2)
  NAvalue(T12) = na.val
  
  # the function takes a vector, partitions it in half, then correlates
  # the two sections, returning the correlation coefficient. 
  stack.sequence.cor <- function(myvec,na.rm=T){
    myvecT1<-myvec[1:(length(myvec)/2)]
    myvecT2<-myvec[(length(myvec)/2+1):length(myvec)]
    return(cor(myvecT1,myvecT2, method =  cor.method))
    }

  # apply the function above to each cell and write the correlation
  # coefficient to the output template. 
  cor.map <- stackApply(T12, indices = rep(1, length(jul_mckenney)), 
    fun = stack.sequence.cor, na.rm = TRUE)
  
  return(cor.map)
}

example call:
my.cor.map <- stack.correlation(tmp.jul, tmp.aug, cor.method = "spearman",
na.val = -9999)

Hope this helps, 

Logan Berner
lberner at whrc.org
The Woods Hole Research Center


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/questions-on-RasterStack-Brick-tp5553580p6623580.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From greenberg at ucdavis.edu  Tue Jul 26 23:13:57 2011
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Tue, 26 Jul 2011 14:13:57 -0700
Subject: [R-sig-Geo] wkbMultiPoint and rgdal
Message-ID: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>

R-sig-geo'ers:

I have an ESRI shapefile which has multi-point geometry, and I'm
trying to get it into R for use with sp() and raster().  Using:

points=readOGR(dsn=getwd(),layer="tnf_sub_2_TreeDig_pts_110725_v02")
returns:

Error in readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02",  :
  Incompatible geometry: 4
In addition: There were 50 or more warnings (use warnings() to see the first 50)

the warnings all say:
...
50: In readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02",  ... :
  eType not chosen

What I really want is to, in the end, have a SpatialPointsDataFrame
where each multi-point feature is converted to individual points that
have the attribute of what multi-point feature it came from.  What is
the best way to do this?  I'm attaching the zipped shapefile to this
email (hopefully it won't get bounced).

--j

-- 
Jonathan A. Greenberg, PhD
Assistant Project Scientist
Center for Spatial Technologies and Remote Sensing (CSTARS)
Department of Land, Air and Water Resources
University of California, Davis
One Shields Avenue
Davis, CA 95616
Phone: 415-763-5476
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tnf_sub_2_TreeDig_pts_110725_v02.zip
Type: application/zip
Size: 24005 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110726/8444e48e/attachment.zip>

From dylan.beaudette at gmail.com  Tue Jul 26 23:28:42 2011
From: dylan.beaudette at gmail.com (Dylan Beaudette)
Date: Tue, 26 Jul 2011 14:28:42 -0700
Subject: [R-sig-Geo] wkbMultiPoint and rgdal
In-Reply-To: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>
References: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>
Message-ID: <CAOGWcHL83io-yrkNBrhfG8KEEKJzZyH8bSoNwSOzdRgnT+HMgQ@mail.gmail.com>

Hi Jonathan,

My tool of choice for this operation is PostGIS. If you happen to have
a postgis db ready to go, simply import your problem file using the
postgis shapefile import tool and process there. Some tips here:

http://amercader.net/blog/2011/04/exploding-multigeometries-with-postgis

Cheers,
Dylan

On Tue, Jul 26, 2011 at 2:13 PM, Jonathan Greenberg
<greenberg at ucdavis.edu> wrote:
> R-sig-geo'ers:
>
> I have an ESRI shapefile which has multi-point geometry, and I'm
> trying to get it into R for use with sp() and raster(). ?Using:
>
> points=readOGR(dsn=getwd(),layer="tnf_sub_2_TreeDig_pts_110725_v02")
> returns:
>
> Error in readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?:
> ?Incompatible geometry: 4
> In addition: There were 50 or more warnings (use warnings() to see the first 50)
>
> the warnings all say:
> ...
> 50: In readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?... :
> ?eType not chosen
>
> What I really want is to, in the end, have a SpatialPointsDataFrame
> where each multi-point feature is converted to individual points that
> have the attribute of what multi-point feature it came from. ?What is
> the best way to do this? ?I'm attaching the zipped shapefile to this
> email (hopefully it won't get bounced).
>
> --j
>
> --
> Jonathan A. Greenberg, PhD
> Assistant Project Scientist
> Center for Spatial Technologies and Remote Sensing (CSTARS)
> Department of Land, Air and Water Resources
> University of California, Davis
> One Shields Avenue
> Davis, CA 95616
> Phone: 415-763-5476
> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>


From ccorreac at ucentral.edu.co  Wed Jul 27 05:15:22 2011
From: ccorreac at ucentral.edu.co (carocorrea)
Date: Tue, 26 Jul 2011 20:15:22 -0700 (PDT)
Subject: [R-sig-Geo] function Persp
Message-ID: <1311736522373-6624658.post@n2.nabble.com>

Dear All, 

I am trying to visualize the surface of a kernel of density estimate. I
generate the density plot with "persp" but I couldn?t use the same colors
that in a density plot. 

...
M1=ppp(C1$CX,C1$CY,c(80000,106000),c(90000,129000),marks=ACTCIIU3)
den1=density(M1,1000)
persp(den1,theta = 20, phi = 30, main="Business Location Density",
colmap=c("darkblue","mediumblue","aquamarine3","aquamarine","mediumaquamarine","limegreen","green","greenyellow","Yellow","lightyellow","white"),border="black",
xlab="East",ylab="North",zlab="Industry Density")
....

So, I want that the colors are the same if I draw it:

plot(den1,cex=0.8,font =2)


Thanks, 

Carolina 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/function-Persp-tp6624658p6624658.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From ccorreac at ucentral.edu.co  Wed Jul 27 05:24:31 2011
From: ccorreac at ucentral.edu.co (carocorrea)
Date: Tue, 26 Jul 2011 20:24:31 -0700 (PDT)
Subject: [R-sig-Geo] function persp II
Message-ID: <1311737071173-6624674.post@n2.nabble.com>

Dear All, 


I made ??a kernel density using "persp", but I would overlay a shape in the
kernel, that is, I want my shape coordinates are on the XY plane of the
kernel. can I do this?

Thanks, 
Carolina 

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/function-persp-II-tp6624674p6624674.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Eugeniusz.Kaluza at polsl.pl  Wed Jul 27 11:25:23 2011
From: Eugeniusz.Kaluza at polsl.pl (=?iso-8859-2?Q?Eugeniusz_Ka=B3u=BFa?=)
Date: Wed, 27 Jul 2011 11:25:23 +0200
Subject: [R-sig-Geo] How to find description of plot gps positions on map
Message-ID: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110727/50d8d200/attachment.pl>

From janverbesselt at gmail.com  Wed Jul 27 14:25:12 2011
From: janverbesselt at gmail.com (janverbesselt)
Date: Wed, 27 Jul 2011 05:25:12 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <1311701520849-6623034.post@n2.nabble.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
	<1311701520849-6623034.post@n2.nabble.com>
Message-ID: <1311769512352-6625919.post@n2.nabble.com>

I have done the following:

1. read a small subset of the modis image time series (2000-2011, i.e. 262
images) in and save as a raster stack.
2. below read in the .grd file as a brick with 262 layers and dim = 17,13
containing integer values
3. now I am trying to extract time series per pixel for further processing,
this however is very slow.
It takes more than 30sec for one time series. I have tried modis[row,col]
but this is not faster.

Any advice? Should I do this via Python or can this be done via R but more
efficient?


> ## read in Brick
> modis <- brick("modis.grd")
> nlayers(modis)
[1] 262
> dim(modis)
[1]  17  13 262
> 
> (system.time(test <- extract(modis,1)))
   user  system elapsed 
 35.985   0.084  36.194 
> (system.time(test <- modis[1,1]))
   user  system elapsed 
 35.847   0.076  36.051 



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6625919.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From carstennh at aol.com  Wed Jul 27 20:42:19 2011
From: carstennh at aol.com (Carsten Neumann)
Date: Wed, 27 Jul 2011 20:42:19 +0200
Subject: [R-sig-Geo] problems with predict() in package raster
Message-ID: <4E305C0B.1040806@aol.com>

  Dear all,

after updating package raster_1.8-38 and randomForest_4.6-2 the 
predict() function fails to calculate a resulting rasterLayer. The 
Script always functioned well, before. Here is the problem:

###############################
pred <- predict(b1, model1)
class(b1) -> RasterStack
class(model1) -> randomForest

Warnmeldungen:
1: NAs durch Umwandlung erzeugt
2: NAs durch Umwandlung erzeugt
###############################
The Error tells me that NA's are produced through conversion. But why??? 
What do I have to change in comparison to former trials?
(Input for randomForest: 1. factor variable   2. dataframe)

I am thankfull for any help, because I want to present this function 
students on Friday.

With best regards

Carsten


From r.hijmans at gmail.com  Wed Jul 27 21:23:44 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Wed, 27 Jul 2011 12:23:44 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <1311769512352-6625919.post@n2.nabble.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
	<1311701520849-6623034.post@n2.nabble.com>
	<1311769512352-6625919.post@n2.nabble.com>
Message-ID: <1311794624771-6627415.post@n2.nabble.com>

Jan,

> Any advice? Should I do this via Python or can this be done via R but more
> efficient? 

Interesting problem, that I had not noticed before. I think this is because
a loop that can perhaps be omitted or else perhaps needs to move to a C
routine. I need to investigate that. For now, for speed, either read the
values into memory (if possible; perhaps a spatial subset, via 'crop'), or
perhaps use ncdf files (see example below). 

> library(raster)
Loading required package: sp
raster version 1.9-3 (27-July-2011)
> b <- brick(nc=10, nr=10, nl=648)
> b <- setValues(b, matrix(rep(1:100, 648), nc=648))
> system.time(v <- b[1])
   user  system elapsed 
      0       0       0 
> 
> d <- writeRaster(b, 'test.grd', overwrite=TRUE)
> inMemory(d)
[1] FALSE
> system.time(v <- d[1])  # too slow
   user  system elapsed 
  61.54    0.14   61.98 
> 
> d <- readAll(d)
> inMemory(d)
[1] TRUE
> system.time(v <- d[1])  # OK
   user  system elapsed 
      0       0       0 
> 
> e <- writeRaster(b, 'test.nc', overwrite=TRUE)
Loading required package: ncdf
> inMemory(e)
[1] FALSE
> system.time(v <- e[1]) # OK
   user  system elapsed 
   0.01    0.00    0.02 
> 


Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6627415.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Jul 27 21:38:47 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Wed, 27 Jul 2011 12:38:47 -0700 (PDT)
Subject: [R-sig-Geo] crop by pixel
In-Reply-To: <CA+GC7G46zD80C=SAhhahhv4WFpP5v4AaWoxHtH2BbzXVngsjsA@mail.gmail.com>
References: <CA+GC7G46zD80C=SAhhahhv4WFpP5v4AaWoxHtH2BbzXVngsjsA@mail.gmail.com>
Message-ID: <1311795527510-6627446.post@n2.nabble.com>

> I need to crop a raster by pixel value, from upper X,Y left. 
> I'm using this: 
> spot <- raster(.........) 
> x_shift <- 2 
> y_shift <- 2 
> crop(spot,extent(xmin(spot)+res(spot)[1]*x_shift,xmax(spot),ymin(spot),ymax(spot)-res(spot)[2]*y_shift)) 
> It works, but is there another way? 

A little bit less verbose:

x <- crop( spot, extent(spot, x_shift, nrow(spot), y_shift, ncol(spot)) )


For smaller raster files, you could also consider (notice the drop=FALSE
argument):

x <- spot[x_shift:nrow(spot), y_shift:ncol(spot),  drop=FALSE]

Robert



--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/crop-by-pixel-tp6622234p6627446.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Jul 27 21:41:43 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Wed, 27 Jul 2011 12:41:43 -0700 (PDT)
Subject: [R-sig-Geo] crop by pixel
In-Reply-To: <1311795527510-6627446.post@n2.nabble.com>
References: <CA+GC7G46zD80C=SAhhahhv4WFpP5v4AaWoxHtH2BbzXVngsjsA@mail.gmail.com>
	<1311795527510-6627446.post@n2.nabble.com>
Message-ID: <1311795703486-6627457.post@n2.nabble.com>

>> I need to crop a raster by pixel value, from upper X,Y left. 
>> I'm using this: 
>> spot <- raster(.........) 
>> x_shift <- 2 
>> y_shift <- 2 
>> crop(spot,extent(xmin(spot)+res(spot)[1]*x_shift,xmax(spot),ymin(spot),ymax(spot)-res(spot)[2]*y_shift)) 
>> It works, but is there another way? 

>A little bit less verbose: 
>x <- crop( spot, extent(spot, x_shift, nrow(spot), y_shift, ncol(spot)) ) 
>For smaller raster files, you could also consider (notice the drop=FALSE
argument): 
>x <- spot[x_shift:nrow(spot), y_shift:ncol(spot),  drop=FALSE] 

In the above I made a mistake: I reversed x_shift and y_shift. It should be:

x <- crop( spot, extent(spot, y_shift, nrow(spot), x_shift, ncol(spot)) ) 

x <- spot[y_shift:nrow(spot), x_shift:ncol(spot),  drop=FALSE] 

Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/crop-by-pixel-tp6622234p6627457.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Jul 27 22:01:57 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 27 Jul 2011 13:01:57 -0700
Subject: [R-sig-Geo] overlay with 2 bricks?
In-Reply-To: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
References: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
Message-ID: <CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110727/89744aca/attachment.pl>

From r.hijmans at gmail.com  Wed Jul 27 22:15:04 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Wed, 27 Jul 2011 13:15:04 -0700 (PDT)
Subject: [R-sig-Geo] empty brick?
In-Reply-To: <CAG4NReK2gTbcFF88JE=2LPxqS1zJ70jwpzwxNcVC6GigvHas_Q@mail.gmail.com>
References: <CAG4NReK2gTbcFF88JE=2LPxqS1zJ70jwpzwxNcVC6GigvHas_Q@mail.gmail.com>
Message-ID: <1311797704995-6627540.post@n2.nabble.com>

> I have a process that creates a set of (large) raster layers. 
> Does it make sense defining an empty brick object 
> and then putting each layer as band of the brick? 
> Or is it better saving each layer and then make the brick? 

Agus, 

The simplest is certainly to write single layer raster files and then make a
RasterStack. 

To write to a single multi-layer file via the methods provided by 'raster'
you would need to process, chunk by chunk, all layers. I.e., process the
first chunk of all layers, and write the results to file, then move to the
second chunk, etc. There is currently no method in 'raster', I think, that
allows you to write the first layer, then the second, etc. But that is
something that I could probably add if there is interest. 

There is a method for a RasterBrick that already has a file, but that is
probably not useful here (and I do not know if it would be efficient):

b <- brick(nc=10, nr=10, nl=10)
b <- setValues(b, matrix(1:100, nc=10, nr=100))
b <- writeRaster(b, 'test.tif', overwrite=T)
b <- update(b, v=100:1, cell=1, band=2)
plot(b, 1:3)

Best, Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/empty-brick-tp6622064p6627540.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Wed Jul 27 22:23:10 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Wed, 27 Jul 2011 13:23:10 -0700 (PDT)
Subject: [R-sig-Geo] plot border
In-Reply-To: <alpine.LRH.2.02.1107251157530.32171@norway.ouce.ox.ac.uk>
References: <alpine.LRH.2.02.1107251157530.32171@norway.ouce.ox.ac.uk>
Message-ID: <1311798190310-6627574.post@n2.nabble.com>


> When running the following script, I can plot the image. 
> Does anyone know how I can get the outline/border of the image? 
> Sample data is attached. 

Muhammad, 

I have no idea what you mean with  "how can I get the outline/border of the
image?", but perhaps the below helps: 

library(raster)
r <- raster("obs.r06q7.nc")
image(r)
x11()
plot(r)

Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/plot-border-tp6617841p6627574.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alobolistas at gmail.com  Wed Jul 27 23:23:02 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 27 Jul 2011 23:23:02 +0200
Subject: [R-sig-Geo] overlay with 2 bricks?
In-Reply-To: <CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>
References: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
	<CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>
Message-ID: <CAG4NReKkLr3GE3i3FkVLrfH0YwzkUEyfOzuYQYDnrvLAeF-MNQ@mail.gmail.com>

I think the problem is that I do not quite understand
the relationship between the objects passed within overlay (s1 and s2 in
your example) and what
the function within overlay is actually getting.

In your example,
x3 <- overlay(s1, s2, fun=fun3)

s1 and s3 are stacks of 10x10x3 but what is fun3 getting?
A matrix? Note we want to calculate the median across layers,
thus vectors of 3 elements for each pixel. As you use
apply(x,1,median,na.rm=TRUE)

it seems that x within fun3 is a matrix of 10x10 rows and 3 columns,
is this correct?

Also, why are you doing
fun3(s1[1:3], s2[1:3])

instead of
fun3(s1, s2)
?

Agus

2011/7/27 Robert J. Hijmans <r.hijmans at gmail.com>:
> Agus,
>
> This problem arises because you are combing what are (for calc anyway)
> different types of functions. The second part is called with apply, the
> first part not. I think you can fix that using my 'fun3' (see below).
>
>
> r1 <- r2 <- raster(nc=10, nr=10)
> r1[] <- round(runif(ncell(r1))) * 248
> r2[] <- round(runif(ncell(r2))) * 232
>
> s1 <- stack(r1, r1, r2)
> s2 <- stack(r2, r2, r1)
>
> fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>
> fun2 <- function(x,y) {
> x[y!=248 & y!=232] <- NA
> median(x,na.rm=T)
> }
>
> fun3 <- function(x,y) {
> x[y!=248 & y!=232] <- NA
> apply(x,1,median,na.rm=TRUE)
> }
>
> fun1(s1[1:3], s2[1:3])
> fun2(s1[1:3], s2[1:3]) # not good. only returns a single value
> fun3(s1[1:3], s2[1:3]) # looks good
>
> x1 <- overlay(s1, s2, fun=fun1)
> x2 <- overlay(s1, s2, fun=fun2) # not good
> x3 <- overlay(s1, s2, fun=fun3) # OK
>
>
>
> OK means that no error is thrown. I have not checked if the results are
> meaningful, but I expect they are.
>
> Robert
>
>
>
> On Tue, Jul 26, 2011 at 8:27 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> I'm trying to combine 2 operations into one to speed up a process.
>> It's simple calculating a median raster across layers of a brick object,
>> but
>> the values that must be considered NA are defined by a second brick.
>> Normally, we first set the NA in the brick and then calculate the median:
>>
>> fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>> decadaN_v2 <- overlay(decadaN, decadaS, fun=fun1, overwrite=TRUE)
>> a <- overlay(decadaN_v2, fun=median, na.rm=T, overwrite=TRUE)
>>
>> But this is too slow (we actually try to do this for 36 bricks within
>> a loop). So I tried:
>>
>> mimedian <- function(x,y) {
>> ?x[y!=248 & y!=232] <- NA
>> ?median(x,na.rm=T)
>> }
>>
>> And then try to use overlay only once:
>>
>> a <- overlay(decadaN, decadaS, fun=mimedian, na.rm=T, overwrite=TRUE)
>>
>> but raster complains that the function is not vectorized.
>> Is there any way around? I suspect the problem is that overlay works
>> across layers if one brick is provided,
>> but not if 2 bricks are provided. In other words, we want x in
>> mimedian to be a vector of 1 pixel across layers but
>> actually is a brick object.
>>
>> Agus
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.hijmans at gmail.com  Wed Jul 27 23:30:58 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 27 Jul 2011 14:30:58 -0700
Subject: [R-sig-Geo] overlay with 2 bricks?
In-Reply-To: <CAG4NReKkLr3GE3i3FkVLrfH0YwzkUEyfOzuYQYDnrvLAeF-MNQ@mail.gmail.com>
References: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
	<CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>
	<CAG4NReKkLr3GE3i3FkVLrfH0YwzkUEyfOzuYQYDnrvLAeF-MNQ@mail.gmail.com>
Message-ID: <CANtt_hzOJf-u2bZceRiszwopz76d3k0VspmMPAa4tgR5V7Oiaw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110727/0748be37/attachment.pl>

From r.hijmans at gmail.com  Thu Jul 28 00:47:04 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 27 Jul 2011 15:47:04 -0700
Subject: [R-sig-Geo] problems with predict() in package raster
In-Reply-To: <4E305C0B.1040806@aol.com>
References: <4E305C0B.1040806@aol.com>
Message-ID: <CANtt_hxou2EYkwhFP9uxTNW_2wrzEhWxeMeWGyUAwgWVrDF4Pw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110727/4948344c/attachment.pl>

From carstennh at aol.com  Thu Jul 28 02:28:03 2011
From: carstennh at aol.com (Carsten Neumann)
Date: Thu, 28 Jul 2011 02:28:03 +0200
Subject: [R-sig-Geo] problem plot raster objects
Message-ID: <4E30AD13.2010205@aol.com>

Dear all,

there seems to be a problem ploting RasterLayer objects with plot(). 
After updating to new raster version plot did not take "zlim" argument 
and the "at" argument when passing "breaks" and "axis.args" together.

The error message:

##############################################################
brk=c(0,0.25,0.6,0.8,1)
plot(ndvi, col=vi.palette(4), breaks=brk, legend.shrink = 0.8, 
axis.args=list(at=c(0.15,0.45,0.7,0.9), 
labels=c("Sa.","Sen.","Gra.","Wal.")),
zlim=c(0,1), main="Aggregierung", legend.width=1.2)
##############################################################

Error in axis(side = 4, mgp = c(3, 1, 0), las = 2, at = c(0, 0.25, 0.6,  :
   formal Argument "at" matches to several given Arguments
Zus?tzlich: Warnmeldungen:
1: In plot.window(...) : "zlim" is no Grafikparameter
2: In plot.xy(xy, type, ...) : "zlim" is no Grafikparameter
3: In axis(side = side, at = at, labels = labels, ...) :
   "zlim" is no  Grafikparameter
4: In axis(side = side, at = at, labels = labels, ...) :
   "zlim" is no Grafikparameter
5: In box(...) : "zlim" is no Grafikparameter
6: In title(...) : "zlim" isno  Grafikparameter

Normally plot() with raster objects accepts arguments from image.plot() 
The code above works for older raster versions.

Very great thanks for any help.

Carsten


From alobolistas at gmail.com  Thu Jul 28 07:37:38 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 28 Jul 2011 07:37:38 +0200
Subject: [R-sig-Geo] overlay with 2 bricks?
In-Reply-To: <CANtt_hzOJf-u2bZceRiszwopz76d3k0VspmMPAa4tgR5V7Oiaw@mail.gmail.com>
References: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
	<CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>
	<CAG4NReKkLr3GE3i3FkVLrfH0YwzkUEyfOzuYQYDnrvLAeF-MNQ@mail.gmail.com>
	<CANtt_hzOJf-u2bZceRiszwopz76d3k0VspmMPAa4tgR5V7Oiaw@mail.gmail.com>
Message-ID: <CAG4NReLDf9Sj=1bR6zEPV9Z=q1yodJRRiE6Ej8OSvFoZjO0o1Q@mail.gmail.com>

ok, then, as I understand it,
given a raster stack  or brick s1 with dimensions n*c*b
(thus, 3D, being n,c,b, respectively, nb of rows, columns and layers),
overlay(s1,fun(x),...) would reshape s1 and pass it to fun as  a 2D
matrix x of dimensions
(n*c) rows and b layers,
and
given r1 as a n*c raster layer
(being n,c, respectively, nb of rows and columns),
overlay(r1,fun(x),...) would reshape r1 and pass it to fun as a vector
x of dimensions
(n*c) rows and 1 layers,

Correct?

Thus, if we want to apply an eigenvector matrix u of dimensions b*b to
s1 of dimensions (n*c*b),
we could just use

funortho <- function(x,u){ x%*%u}

a <- overlay(s1,u,fun=funortho(x,u))

as x would have dimensions (n*c) rows and b columns

Correct?

Thanks!

Agus

2011/7/27 Robert J. Hijmans <r.hijmans at gmail.com>:
> On Wed, Jul 27, 2011 at 2:23 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> I think the problem is that I do not quite understand
>> the relationship between the objects passed within overlay (s1 and s2 in
>> your example) and what
>> the function within overlay is actually getting.
>>
>
> It gets a matrix where the columns are layers and the rows are cells.
>
>
>>
>> In your example,
>> x3 <- overlay(s1, s2, fun=fun3)
>>
>> s1 and s3 are stacks of 10x10x3 but what is fun3 getting?
>> A matrix?
>
>
> yes, two matrices of 100*3 ?(or a chunk thereof if the raster is very large)
>
> ?Note we want to calculate the median across layers,
>
>> thus vectors of 3 elements for each pixel. As you use
>> apply(x,1,median,na.rm=TRUE)
>>
>> it seems that x within fun3 is a matrix of 10x10 rows and 3 columns,
>> is this correct?
>>
>> Also, why are you doing
>> fun3(s1[1:3], s2[1:3])
>>
>>
> Because I am trying it for three cells, using the type of matrix that calc
> gets: ?s1[1:3]
>
>
>> instead of
>> fun3(s1, s2)
>> ?
>>
>>
> Because fun3 may not know what to do with a RasterStack.
>
>
>
>> Agus
>>
>>
> Hth, Robert
>
>
>
>> 2011/7/27 Robert J. Hijmans <r.hijmans at gmail.com>:
>> > Agus,
>> >
>> > This problem arises because you are combing what are (for calc anyway)
>> > different types of functions. The second part is called with apply, the
>> > first part not. I think you can fix that using my 'fun3' (see below).
>> >
>> >
>> > r1 <- r2 <- raster(nc=10, nr=10)
>> > r1[] <- round(runif(ncell(r1))) * 248
>> > r2[] <- round(runif(ncell(r2))) * 232
>> >
>> > s1 <- stack(r1, r1, r2)
>> > s2 <- stack(r2, r2, r1)
>> >
>> > fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>> >
>> > fun2 <- function(x,y) {
>> > x[y!=248 & y!=232] <- NA
>> > median(x,na.rm=T)
>> > }
>> >
>> > fun3 <- function(x,y) {
>> > x[y!=248 & y!=232] <- NA
>> > apply(x,1,median,na.rm=TRUE)
>> > }
>> >
>> > fun1(s1[1:3], s2[1:3])
>> > fun2(s1[1:3], s2[1:3]) # not good. only returns a single value
>> > fun3(s1[1:3], s2[1:3]) # looks good
>> >
>> > x1 <- overlay(s1, s2, fun=fun1)
>> > x2 <- overlay(s1, s2, fun=fun2) # not good
>> > x3 <- overlay(s1, s2, fun=fun3) # OK
>> >
>> >
>> >
>> > OK means that no error is thrown. I have not checked if the results are
>> > meaningful, but I expect they are.
>> >
>> > Robert
>> >
>> >
>> >
>> > On Tue, Jul 26, 2011 at 8:27 AM, Agustin Lobo <alobolistas at gmail.com>
>> wrote:
>> >
>> >> I'm trying to combine 2 operations into one to speed up a process.
>> >> It's simple calculating a median raster across layers of a brick object,
>> >> but
>> >> the values that must be considered NA are defined by a second brick.
>> >> Normally, we first set the NA in the brick and then calculate the
>> median:
>> >>
>> >> fun1 <- function(x,y) { x[y!=248 & y!=232] <- NA; return(x)}
>> >> decadaN_v2 <- overlay(decadaN, decadaS, fun=fun1, overwrite=TRUE)
>> >> a <- overlay(decadaN_v2, fun=median, na.rm=T, overwrite=TRUE)
>> >>
>> >> But this is too slow (we actually try to do this for 36 bricks within
>> >> a loop). So I tried:
>> >>
>> >> mimedian <- function(x,y) {
>> >> ?x[y!=248 & y!=232] <- NA
>> >> ?median(x,na.rm=T)
>> >> }
>> >>
>> >> And then try to use overlay only once:
>> >>
>> >> a <- overlay(decadaN, decadaS, fun=mimedian, na.rm=T, overwrite=TRUE)
>> >>
>> >> but raster complains that the function is not vectorized.
>> >> Is there any way around? I suspect the problem is that overlay works
>> >> across layers if one brick is provided,
>> >> but not if 2 bricks are provided. In other words, we want x in
>> >> mimedian to be a vector of 1 pixel across layers but
>> >> actually is a brick object.
>> >>
>> >> Agus
>> >>
>> >
>> > ? ? ? ?[[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>
> ? ? ? ?[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Thu Jul 28 07:47:30 2011
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 28 Jul 2011 07:47:30 +0200
Subject: [R-sig-Geo] empty brick?
In-Reply-To: <1311797704995-6627540.post@n2.nabble.com>
References: <CAG4NReK2gTbcFF88JE=2LPxqS1zJ70jwpzwxNcVC6GigvHas_Q@mail.gmail.com>
	<1311797704995-6627540.post@n2.nabble.com>
Message-ID: <CAG4NReJVYUPnDNMLLGBsi2T+9Zq11QR7tA+_i50NJvQphiFOrQ@mail.gmail.com>

Thanks,
In case of large raster objects, I understand we should make sure
that each raster layer is written to disk (so that inMemory=F) and then
make a raster stack (perhaps converting to brick to eliminate the
individual files as ulterior processing would be more efficient).

It would be more transparent if the brick could be just filled

s1 <- brick(nc=nc1, nr=nr1, nb=nb1)
for (i in 1:nb1){
r <- results of processing
s1[i] <- r
}


Agus

2011/7/27 Robert Hijmans <r.hijmans at gmail.com>:
>> I have a process that creates a set of (large) raster layers.
>> Does it make sense defining an empty brick object
>> and then putting each layer as band of the brick?
>> Or is it better saving each layer and then make the brick?
>
> Agus,
>
> The simplest is certainly to write single layer raster files and then make a
> RasterStack.
>
> To write to a single multi-layer file via the methods provided by 'raster'
> you would need to process, chunk by chunk, all layers. I.e., process the
> first chunk of all layers, and write the results to file, then move to the
> second chunk, etc. There is currently no method in 'raster', I think, that
> allows you to write the first layer, then the second, etc. But that is
> something that I could probably add if there is interest.
>
> There is a method for a RasterBrick that already has a file, but that is
> probably not useful here (and I do not know if it would be efficient):
>
> b <- brick(nc=10, nr=10, nl=10)
> b <- setValues(b, matrix(1:100, nc=10, nr=100))
> b <- writeRaster(b, 'test.tif', overwrite=T)
> b <- update(b, v=100:1, cell=1, band=2)
> plot(b, 1:3)
>
> Best, Robert
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/empty-brick-tp6622064p6627540.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From pierre.roudier at gmail.com  Thu Jul 28 08:13:33 2011
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Thu, 28 Jul 2011 18:13:33 +1200
Subject: [R-sig-Geo] Transparency of Raster* objects
Message-ID: <CADLQFsMXx8ohK9+DbROVrri6ZSqj8WAzEwxZW0gYanbYXhjpXA@mail.gmail.com>

Hi,

I there a mean to plot Raster* objects at a given level of transparency?

I understand it's not directly possible using the graphics::image()
function, so I wonder if anybody got a workaround that...

Pierre

-- 
Scientist
Landcare Research, New Zealand


From jianyun.fred.wu at gmail.com  Thu Jul 28 08:45:25 2011
From: jianyun.fred.wu at gmail.com (Jianyun Wu)
Date: Thu, 28 Jul 2011 16:45:25 +1000
Subject: [R-sig-Geo] missing coordinates problems?
Message-ID: <CAOMGRDJuJdQVY_r2gJxF3nVRO3Gtii33qHVVzSjF415OGts3Nw@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110728/7fda96f4/attachment.pl>

From rikavons at hotmail.com  Thu Jul 28 10:48:00 2011
From: rikavons at hotmail.com (Erika von Schneidemesser)
Date: Thu, 28 Jul 2011 03:48:00 -0500
Subject: [R-sig-Geo] quilt.plot
Message-ID: <BAY153-W4705D3579F931A72C21DA2DA340@phx.gbl>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110728/82e5ff5d/attachment.pl>

From janverbesselt at gmail.com  Thu Jul 28 10:53:54 2011
From: janverbesselt at gmail.com (janverbesselt)
Date: Thu, 28 Jul 2011 01:53:54 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <1311794624771-6627415.post@n2.nabble.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
	<1311701520849-6623034.post@n2.nabble.com>
	<1311769512352-6625919.post@n2.nabble.com>
	<1311794624771-6627415.post@n2.nabble.com>
Message-ID: <CAHKDjo5pmKchp1xYxW4C3Zw6yrxhOAfxc0JkJWoDtvVXRtprKg@mail.gmail.com>

Robert,

I have tried the different options - and based on your example below with
the simulated raster brick everything works fine.
However when applying it to my dataset a few things/errors occur.

This is my dataset:
> b
class       : RasterStack
dimensions  : 17, 13, 262  (nrow, ncol, nlayers)
resolution  : 231.6564, 231.6564  (x, y)
extent      : 305554.7, 308566.3, 5713341, 5717279  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181
+b=6371007.181 +units=m +no_defs
min values  : 2874  535 2526 3779 3626 4520 5747 4820  502 4962 ...
max values  : 7671 9126 7660 7181 8723 8217 8513 8581 8979 8854 ...

1/ when trying:
> nc <- writeRaster(b,'modis.nc',overwrite=TRUE) # ,datatype='INT2U'
Error in `dataType<-`(`*tmp*`, value = "FLT4S") :
  Cannot set datatype of a RasterStack

I tried setting the datatype to ,datatype='INT2U' but this gave the same
error. How could this be solved?

2/ When doing the following in a new R session:
modis <- stack("modis.grd")
modis <- readAll(modis)
> inMemory(modis)
[1] FALSE

somehow when loading the file from disk in a new R session and then doing
readAll() is does not load it into memory and when trying modis[1] is
remains slow. How can I make sure that the file loads into memory?

3/ therefore I currently opted for the following:

> system.time(m <- getValues(modis))
   user  system elapsed
  0.347   0.030   0.453

## create a time series
d <- as.vector(m[70,]) # extract cell 70 from the matrix m

Thanks for your help. I really like the 'raster' package so let me know how
I can help testing the package.


On Wed, Jul 27, 2011 at 9:23 PM, Robert Hijmans [via R-sig-geo] <
ml-node+6627415-691589920-304146 at n2.nabble.com> wrote:

> Jan,
>
> > Any advice? Should I do this via Python or can this be done via R but
> more efficient?
>
> Interesting problem, that I had not noticed before. I think this is because
> a loop that can perhaps be omitted or else perhaps needs to move to a C
> routine. I need to investigate that. For now, for speed, either read the
> values into memory (if possible; perhaps a spatial subset, via 'crop'), or
> perhaps use ncdf files (see example below).
>
> > library(raster)
> Loading required package: sp
> raster version 1.9-3 (27-July-2011)
> > b <- brick(nc=10, nr=10, nl=648)
> > b <- setValues(b, matrix(rep(1:100, 648), nc=648))
> > system.time(v <- b[1])
>    user  system elapsed
>       0       0       0
> >
> > d <- writeRaster(b, 'test.grd', overwrite=TRUE)
> > inMemory(d)
> [1] FALSE
> > system.time(v <- d[1])  # too slow
>    user  system elapsed
>   61.54    0.14   61.98
> >
> > d <- readAll(d)
> > inMemory(d)
> [1] TRUE
> > system.time(v <- d[1])  # OK
>    user  system elapsed
>       0       0       0
> >
> > e <- writeRaster(b, 'test.nc', overwrite=TRUE)
> Loading required package: ncdf
> > inMemory(e)
> [1] FALSE
> > system.time(v <- e[1]) # OK
>    user  system elapsed
>    0.01    0.00    0.02
> >
>
>
> Robert
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6627415.html
>  To unsubscribe from extracting time series data from a raster brick of
> AVHRR satellite data, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=6622055&code=amFudmVyYmVzc2VsdEBnbWFpbC5jb218NjYyMjA1NXwtMTAxMTIxMDUxNQ==>.
>
>


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6629146.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From janverbesselt at gmail.com  Thu Jul 28 11:01:14 2011
From: janverbesselt at gmail.com (janverbesselt)
Date: Thu, 28 Jul 2011 02:01:14 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <1311794624771-6627415.post@n2.nabble.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
	<1311701520849-6623034.post@n2.nabble.com>
	<1311769512352-6625919.post@n2.nabble.com>
	<1311794624771-6627415.post@n2.nabble.com>
Message-ID: <CAHKDjo7+ofuJX1Cb4Nwjpmje-Yit=Y6QDh4Hy9wuNFa6SDr=og@mail.gmail.com>

I have also made the 'modis.grd' data available via:
## Public Link
download.file("http://dl.dropbox.com/u/8150174/raster/modis.grd","m.grd")
download.file("http://dl.dropbox.com/u/8150174/raster/modis.gri","m.gri")

More info here:
https://r-forge.r-project.org/forum/forum.php?thread_id=3881&forum_id=962&group_id=294

Thanks, Jan


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6629166.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Thu Jul 28 11:24:20 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 28 Jul 2011 02:24:20 -0700
Subject: [R-sig-Geo] problem plot raster objects
In-Reply-To: <4E30AD13.2010205@aol.com>
References: <4E30AD13.2010205@aol.com>
Message-ID: <CANtt_hxomsu_97eTed1rqO6rNnfhYXg4b4vmDXr_ntn=9e7=eg@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110728/31bf7725/attachment.pl>

From r.hijmans at gmail.com  Thu Jul 28 11:32:06 2011
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Thu, 28 Jul 2011 02:32:06 -0700
Subject: [R-sig-Geo] overlay with 2 bricks?
In-Reply-To: <CAG4NReLDf9Sj=1bR6zEPV9Z=q1yodJRRiE6Ej8OSvFoZjO0o1Q@mail.gmail.com>
References: <CAG4NRe+HKuw-DrVKV4miHvPCXmSrqawqkDU5mLHqNXgNSX9ivA@mail.gmail.com>
	<CANtt_hwqRG8663TXXoA1uCDwwwUvVpDaW-OSM_cs85pPPbx_EQ@mail.gmail.com>
	<CAG4NReKkLr3GE3i3FkVLrfH0YwzkUEyfOzuYQYDnrvLAeF-MNQ@mail.gmail.com>
	<CANtt_hzOJf-u2bZceRiszwopz76d3k0VspmMPAa4tgR5V7Oiaw@mail.gmail.com>
	<CAG4NReLDf9Sj=1bR6zEPV9Z=q1yodJRRiE6Ej8OSvFoZjO0o1Q@mail.gmail.com>
Message-ID: <CANtt_hx_K6VtB-Jem5OB_zNMMZEQyPN_R5DLYWLZfGKeeL79wA@mail.gmail.com>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110728/570ecff9/attachment.pl>

From r.hijmans at gmail.com  Thu Jul 28 11:53:05 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 28 Jul 2011 02:53:05 -0700 (PDT)
Subject: [R-sig-Geo] extracting time series data from a raster brick of
 AVHRR satellite data
In-Reply-To: <CAHKDjo5pmKchp1xYxW4C3Zw6yrxhOAfxc0JkJWoDtvVXRtprKg@mail.gmail.com>
References: <CAHKDjo4BNorjxaXrNjHKhgWpvW2pc3M1DezeQdUUgqo5hHnLXw@mail.gmail.com>
	<1311690364859-6622389.post@n2.nabble.com>
	<1311701520849-6623034.post@n2.nabble.com>
	<1311769512352-6625919.post@n2.nabble.com>
	<1311794624771-6627415.post@n2.nabble.com>
	<CAHKDjo5pmKchp1xYxW4C3Zw6yrxhOAfxc0JkJWoDtvVXRtprKg@mail.gmail.com>
Message-ID: <CANtt_hy9pTzrxCOvZvZg2=pUsoVYsAyCCYQ2TNLs-pC5D_rGWQ@mail.gmail.com>

On Thu, Jul 28, 2011 at 1:53 AM, janverbesselt [via R-sig-geo] <
ml-node+6629146-1537221348-149542 at n2.nabble.com> wrote:

> Robert,
>
> I have tried the different options - and based on your example below with
> the simulated raster brick everything works fine.
> However when applying it to my dataset a few things/errors occur.
>
> This is my dataset:
> > b
> class       : RasterStack
> dimensions  : 17, 13, 262  (nrow, ncol, nlayers)
> resolution  : 231.6564, 231.6564  (x, y)
> extent      : 305554.7, 308566.3, 5713341, 5717279  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +a=6371007.181
> +b=6371007.181 +units=m +no_defs
> min values  : 2874  535 2526 3779 3626 4520 5747 4820  502 4962 ...
> max values  : 7671 9126 7660 7181 8723 8217 8513 8581 8979 8854 ...
>
> 1/ when trying:
> > nc <- writeRaster(b,'modis.nc',overwrite=TRUE) # ,datatype='INT2U'
> Error in `dataType<-`(`*tmp*`, value = "FLT4S") :
>   Cannot set datatype of a RasterStack
>
> I tried setting the datatype to ,datatype='INT2U' but this gave the same
> error. How could this be solved?
>


Ah, bug, happens when values of b are in memory, not when they are on disk.
Fixed in devel version. Thanks, Robert



>
> 2/ When doing the following in a new R session:
> modis <- stack("modis.grd")
> modis <- readAll(modis)
> > inMemory(modis)
> [1] FALSE
>
> somehow when loading the file from disk in a new R session and then doing
> readAll() is does not load it into memory and when trying modis[1] is
> remains slow. How can I make sure that the file loads into memory?
>
>
Oh, that not right either (readAll with a RasterStack does not set the
inMemory flag correctly).

modis <- brick("modis.grd")
modis <- readAll(modis)



> 3/ therefore I currently opted for the following:
>
> > system.time(m <- getValues(modis))
>    user  system elapsed
>   0.347   0.030   0.453
>
> ## create a time series
> d <- as.vector(m[70,]) # extract cell 70 from the matrix m
>
> Thanks for your help. I really like the 'raster' package so let me know how
> I can help testing the package.
>
>
Precisely by sending these type of reports.
Thanks, Robert.



>
> On Wed, Jul 27, 2011 at 9:23 PM, Robert Hijmans [via R-sig-geo] <[hidden
> email] <http://user/SendEmail.jtp?type=node&node=6629146&i=0>> wrote:
>
>> Jan,
>>
>> > Any advice? Should I do this via Python or can this be done via R but
>> more efficient?
>>
>> Interesting problem, that I had not noticed before. I think this is
>> because a loop that can perhaps be omitted or else perhaps needs to move to
>> a C routine. I need to investigate that. For now, for speed, either read the
>> values into memory (if possible; perhaps a spatial subset, via 'crop'), or
>> perhaps use ncdf files (see example below).
>>
>> > library(raster)
>> Loading required package: sp
>> raster version 1.9-3 (27-July-2011)
>> > b <- brick(nc=10, nr=10, nl=648)
>> > b <- setValues(b, matrix(rep(1:100, 648), nc=648))
>> > system.time(v <- b[1])
>>    user  system elapsed
>>       0       0       0
>> >
>> > d <- writeRaster(b, 'test.grd', overwrite=TRUE)
>> > inMemory(d)
>> [1] FALSE
>> > system.time(v <- d[1])  # too slow
>>    user  system elapsed
>>   61.54    0.14   61.98
>> >
>> > d <- readAll(d)
>> > inMemory(d)
>> [1] TRUE
>> > system.time(v <- d[1])  # OK
>>    user  system elapsed
>>       0       0       0
>> >
>> > e <- writeRaster(b, 'test.nc', overwrite=TRUE)
>> Loading required package: ncdf
>> > inMemory(e)
>> [1] FALSE
>> > system.time(v <- e[1]) # OK
>>    user  system elapsed
>>    0.01    0.00    0.02
>> >
>>
>>
>> Robert
>>
>>
>> ------------------------------
>>  If you reply to this email, your message will be added to the discussion
>> below:
>>
>> http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6627415.html
>>  To unsubscribe from extracting time series data from a raster brick of
>> AVHRR satellite data, click here.
>>
>
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6629146.html
>  To unsubscribe from extracting time series data from a raster brick of
> AVHRR satellite data, click here<http://r-sig-geo.2731867.n2.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=6622055&code=ci5oaWptYW5zQGdtYWlsLmNvbXw2NjIyMDU1fC0xMDIyNzY3NTQ3>.
>
>


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/extracting-time-series-data-from-a-raster-brick-of-AVHRR-satellite-data-tp6622055p6629299.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Greg.Snow at imail.org  Thu Jul 28 15:37:46 2011
From: Greg.Snow at imail.org (Greg Snow)
Date: Thu, 28 Jul 2011 07:37:46 -0600
Subject: [R-sig-Geo] How to find description of plot gps positions on map
In-Reply-To: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>
References: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>
Message-ID: <B37C0A15B8FB3C468B5BC7EBC7DA14CC6349F62697@LP-EXMBVS10.CO.IHC.COM>

This probably does not answer the full question, but you may want to start by looking at the RgoogleMaps package which will download maps from google, plot them, and overlay your data on the map.

-----Original Message-----
From: r-sig-geo-bounces at r-project.org [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Eugeniusz Kaluza
Sent: Wednesday, July 27, 2011 3:25 AM
To: r-sig-geo at r-project.org
Subject: [R-sig-Geo] How to find description of plot gps positions on map


Dear all,
How to plot gps readings (lat, lon)
on map
with appropriate scale (to compare lateron with google maps

could you please suggest any topic discussed before 
(maybe with filtration  of gps readings that is changing 
even if velocoty is =0 (during night) due to position error

Thanks,
EK



	[[alternative HTML version deleted]]

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From HodgessE at uhd.edu  Thu Jul 28 15:44:55 2011
From: HodgessE at uhd.edu (Hodgess, Erin)
Date: Thu, 28 Jul 2011 08:44:55 -0500
Subject: [R-sig-Geo] How to find description of plot gps positions on map
References: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>
	<B37C0A15B8FB3C468B5BC7EBC7DA14CC6349F62697@LP-EXMBVS10.CO.IHC.COM>
Message-ID: <586A4828D7AAA04CA9B258C50A28DA206DBA14@BALI.uhd.campus>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110728/21ec5ec1/attachment.pl>

From lists at remoteinformation.com.au  Thu Jul 28 16:12:56 2011
From: lists at remoteinformation.com.au (Ben Madin)
Date: Thu, 28 Jul 2011 22:12:56 +0800
Subject: [R-sig-Geo] How to find description of plot gps positions on map
In-Reply-To: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>
References: <4D81F24AB1569B4984BCB79755E34DDF0154CFD4@styks.polsl.pl>
Message-ID: <3A260B98-73D2-4197-AED5-2C5DF247E92B@remoteinformation.com.au>

EK,

This has a number of steps, including importing, re-projecting, filtering, plotting (with your choice of background etc), so

I'd start with a quick look at http://cran.csiro.au/web/views/Spatial.html, 

then in R type :

> vignette("sp")

Then get down to the library or bookshop and get a copy of 

Bivand, R. S., Pebesma, E. J., & Gomez-Rubio, V. (2008). Applied spatial data analysis with R. Use R!, Use R! Series (p. 378). Springer.

cheers

Ben



On 27/07/2011, at 5:25 PM, Eugeniusz Ka?u?a wrote:

> 
> Dear all,
> How to plot gps readings (lat, lon)
> on map
> with appropriate scale (to compare lateron with google maps
> 
> could you please suggest any topic discussed before 
> (maybe with filtration  of gps readings that is changing 
> even if velocoty is =0 (during night) due to position error
> 
> Thanks,
> EK
> 
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From verocrespoperez at gmail.com  Thu Jul 28 19:36:19 2011
From: verocrespoperez at gmail.com (Vero)
Date: Thu, 28 Jul 2011 10:36:19 -0700 (PDT)
Subject: [R-sig-Geo] Generating a regular point pattern
Message-ID: <1311874579846-6630657.post@n2.nabble.com>

Dear all,

I need to generate a regular point pattern on a square-shaped grid. Can
anyone tell me of an easy way to do this? 

Thank you,
Vero

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Generating-a-regular-point-pattern-tp6630657p6630657.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From sarah.goslee at gmail.com  Thu Jul 28 19:39:13 2011
From: sarah.goslee at gmail.com (Sarah Goslee)
Date: Thu, 28 Jul 2011 13:39:13 -0400
Subject: [R-sig-Geo] Generating a regular point pattern
In-Reply-To: <1311874579846-6630657.post@n2.nabble.com>
References: <1311874579846-6630657.post@n2.nabble.com>
Message-ID: <CAM_vjukjAZ69_e-PbKGHvCdbB9r34TsMteTAuHz84baNUkOraw@mail.gmail.com>

Lacking any actual information on your problem, what about:
expand.grid(x=1:10, y=1:10)
modified as appropriate?

On Thu, Jul 28, 2011 at 1:36 PM, Vero <verocrespoperez at gmail.com> wrote:
> Dear all,
>
> I need to generate a regular point pattern on a square-shaped grid. Can
> anyone tell me of an easy way to do this?
>
> Thank you,
> Vero


-- 
Sarah Goslee
http://www.functionaldiversity.org


From marcelino.delacruz at upm.es  Thu Jul 28 19:50:49 2011
From: marcelino.delacruz at upm.es (marcelino.delacruz at upm.es)
Date: Thu, 28 Jul 2011 18:50:49 +0100
Subject: [R-sig-Geo] Generating a regular point pattern
In-Reply-To: <CAM_vjukjAZ69_e-PbKGHvCdbB9r34TsMteTAuHz84baNUkOraw@mail.gmail.com>
Message-ID: <AClBR18v.1311875449.4269170.marcelino.delacruz@upm.es>

If, instead of a grid, you mean a real point pattern (from a point
pattern process) you may try several functions in spatstat.

For example,
library(spatstat)
rSSI(r=0.5, n=15, win = owin(c(0,10),c(0,10)))

generates  following a realisation (15 points) of the Simple Sequential
Inhibition (SSI) process with  inhibition radius of 0.5 (m) in a window
of 10 x 10 (m)

Other appropriate functions are rMatern and rStrauss

Cheers,
Marcelino



Con fecha 28/7/2011, "Sarah Goslee" <sarah.goslee at gmail.com> escribi?:

>Lacking any actual information on your problem, what about:
>expand.grid(x=1:10, y=1:10)
>modified as appropriate?
>
>On Thu, Jul 28, 2011 at 1:36 PM, Vero <verocrespoperez at gmail.com> wrote:
>> Dear all,
>>
>> I need to generate a regular point pattern on a square-shaped grid. Can
>> anyone tell me of an easy way to do this?
>>
>> Thank you,
>> Vero
>
>
>--
>Sarah Goslee
>http://www.functionaldiversity.org
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From greenberg at ucdavis.edu  Thu Jul 28 21:57:54 2011
From: greenberg at ucdavis.edu (Jonathan Greenberg)
Date: Thu, 28 Jul 2011 12:57:54 -0700
Subject: [R-sig-Geo] wkbMultiPoint and rgdal
In-Reply-To: <CAOGWcHL83io-yrkNBrhfG8KEEKJzZyH8bSoNwSOzdRgnT+HMgQ@mail.gmail.com>
References: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>
	<CAOGWcHL83io-yrkNBrhfG8KEEKJzZyH8bSoNwSOzdRgnT+HMgQ@mail.gmail.com>
Message-ID: <CABG0rfuFu+K+f6oGrF0he2oRHUcB=wtzizoyZiV7c0cNVAZH4Q@mail.gmail.com>

Hi Dylan:

Thanks -- I'm a bit of a PostGIS noob so I ended converting it to a
normal point file with the XTools extension in Arc.  I'm surprised
there is no support for this data type in any R package, since I would
think it is a fairly common type.  Ah well!

--j

On Tue, Jul 26, 2011 at 2:28 PM, Dylan Beaudette
<dylan.beaudette at gmail.com> wrote:
> Hi Jonathan,
>
> My tool of choice for this operation is PostGIS. If you happen to have
> a postgis db ready to go, simply import your problem file using the
> postgis shapefile import tool and process there. Some tips here:
>
> http://amercader.net/blog/2011/04/exploding-multigeometries-with-postgis
>
> Cheers,
> Dylan
>
> On Tue, Jul 26, 2011 at 2:13 PM, Jonathan Greenberg
> <greenberg at ucdavis.edu> wrote:
>> R-sig-geo'ers:
>>
>> I have an ESRI shapefile which has multi-point geometry, and I'm
>> trying to get it into R for use with sp() and raster(). ?Using:
>>
>> points=readOGR(dsn=getwd(),layer="tnf_sub_2_TreeDig_pts_110725_v02")
>> returns:
>>
>> Error in readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?:
>> ?Incompatible geometry: 4
>> In addition: There were 50 or more warnings (use warnings() to see the first 50)
>>
>> the warnings all say:
>> ...
>> 50: In readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?... :
>> ?eType not chosen
>>
>> What I really want is to, in the end, have a SpatialPointsDataFrame
>> where each multi-point feature is converted to individual points that
>> have the attribute of what multi-point feature it came from. ?What is
>> the best way to do this? ?I'm attaching the zipped shapefile to this
>> email (hopefully it won't get bounced).
>>
>> --j
>>
>> --
>> Jonathan A. Greenberg, PhD
>> Assistant Project Scientist
>> Center for Spatial Technologies and Remote Sensing (CSTARS)
>> Department of Land, Air and Water Resources
>> University of California, Davis
>> One Shields Avenue
>> Davis, CA 95616
>> Phone: 415-763-5476
>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>



-- 
Jonathan A. Greenberg, PhD
Assistant Project Scientist
Center for Spatial Technologies and Remote Sensing (CSTARS)
Department of Land, Air and Water Resources
University of California, Davis
One Shields Avenue
Davis, CA 95616
Phone: 415-763-5476
AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307


From r.hijmans at gmail.com  Thu Jul 28 23:40:36 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Thu, 28 Jul 2011 14:40:36 -0700 (PDT)
Subject: [R-sig-Geo] Transparency of Raster* objects
In-Reply-To: <CADLQFsMXx8ohK9+DbROVrri6ZSqj8WAzEwxZW0gYanbYXhjpXA@mail.gmail.com>
References: <CADLQFsMXx8ohK9+DbROVrri6ZSqj8WAzEwxZW0gYanbYXhjpXA@mail.gmail.com>
Message-ID: <1311889236089-6631467.post@n2.nabble.com>

Pierre,

There are two ways. You can use the alpha argument in plot, or in a function
that generates a vector of colors, see below. But note that this works in
the previous and in the next version of raster, but in the current version
only with 'oldstyle=TRUE'.  

>From ?slopeAspect

library(raster)
dem <- getData('alt', country='CHE')
slas <- slopeAspect(dem)
hill <- hillShade(slas[[1]], slas[[2]], 40, 270)

plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
plot(dem, col=rainbow(25, alpha=0.35), add=TRUE)

plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
plot(dem, col=rainbow(25), alpha=0.35, add=TRUE)

# for the current version, use oldstyle=T
plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
plot(dem, col=rainbow(25, alpha=0.35), add=TRUE, oldstyle=T)

Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Transparency-of-Raster-objects-tp6628801p6631467.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From pierre.roudier at gmail.com  Fri Jul 29 00:11:23 2011
From: pierre.roudier at gmail.com (Pierre Roudier)
Date: Fri, 29 Jul 2011 10:11:23 +1200
Subject: [R-sig-Geo] Transparency of Raster* objects
In-Reply-To: <1311889236089-6631467.post@n2.nabble.com>
References: <CADLQFsMXx8ohK9+DbROVrri6ZSqj8WAzEwxZW0gYanbYXhjpXA@mail.gmail.com>
	<1311889236089-6631467.post@n2.nabble.com>
Message-ID: <CADLQFsPBRSjvaU2EO=AMK-BuUzcMRWuSnihqfwbyfZ+_mYJauw@mail.gmail.com>

Thanks Robert,

The trick is I'm using RColorBrewer, who does not provides this
posibility. But I coded a workaround, which basically turns an alpha
number between 0 an1 into a hex code, then insert that hex code in the
colours hex string. This is working.

However, what I'm still stuck at using a variable transparency in
space, eg in the meuse.grid dataset, how to make transparency a
function of the distance to the river (the dist attribute) ?

Cheers,

Pierre

2011/7/29 Robert Hijmans <r.hijmans at gmail.com>:
> Pierre,
>
> There are two ways. You can use the alpha argument in plot, or in a function
> that generates a vector of colors, see below. But note that this works in
> the previous and in the next version of raster, but in the current version
> only with 'oldstyle=TRUE'.
>
> >From ?slopeAspect
>
> library(raster)
> dem <- getData('alt', country='CHE')
> slas <- slopeAspect(dem)
> hill <- hillShade(slas[[1]], slas[[2]], 40, 270)
>
> plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
> plot(dem, col=rainbow(25, alpha=0.35), add=TRUE)
>
> plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
> plot(dem, col=rainbow(25), alpha=0.35, add=TRUE)
>
> # for the current version, use oldstyle=T
> plot(hill, col=grey(0:100/100), legend=FALSE, main='Switzerland')
> plot(dem, col=rainbow(25, alpha=0.35), add=TRUE, oldstyle=T)
>
> Robert
>
> --
> View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Transparency-of-Raster-objects-tp6628801p6631467.html
> Sent from the R-sig-geo mailing list archive at Nabble.com.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Scientist
Landcare Research, New Zealand


From g.lionel at lycos.com  Fri Jul 29 07:59:28 2011
From: g.lionel at lycos.com (glionel)
Date: Thu, 28 Jul 2011 22:59:28 -0700 (PDT)
Subject: [R-sig-Geo] Generating a regular point pattern
In-Reply-To: <1311874579846-6630657.post@n2.nabble.com>
References: <1311874579846-6630657.post@n2.nabble.com>
Message-ID: <1212732169.58567.1311918754277.JavaMail.mail@webmail06>





Dear Vero, Please find this script below. This is to generate an uniform point pattern in library(splancs) library(spatstat) n=100 pf&lt;-runifpoint(n, win=owin(c(0,1),c(0,1)), giveup=1000) plot(pf) 


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Generating-a-regular-point-pattern-tp6630657p6632469.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From Roger.Bivand at nhh.no  Fri Jul 29 09:57:13 2011
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 29 Jul 2011 09:57:13 +0200 (CEST)
Subject: [R-sig-Geo] wkbMultiPoint and rgdal
In-Reply-To: <CABG0rfuFu+K+f6oGrF0he2oRHUcB=wtzizoyZiV7c0cNVAZH4Q@mail.gmail.com>
References: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>
	<CAOGWcHL83io-yrkNBrhfG8KEEKJzZyH8bSoNwSOzdRgnT+HMgQ@mail.gmail.com>
	<CABG0rfuFu+K+f6oGrF0he2oRHUcB=wtzizoyZiV7c0cNVAZH4Q@mail.gmail.com>
Message-ID: <alpine.LRH.2.00.1107290948200.11052@reclus.nhh.no>

On Thu, 28 Jul 2011, Jonathan Greenberg wrote:

> Hi Dylan:
>
> Thanks -- I'm a bit of a PostGIS noob so I ended converting it to a
> normal point file with the XTools extension in Arc.  I'm surprised
> there is no support for this data type in any R package, since I would
> think it is a fairly common type.  Ah well!

Jonathan,

Not really, as this is the first time I can recall it being mentioned in 8 
years. It is far from obvious what one could do with it that couldn't more 
properly be done with a SpatialPointsDataFrame with a grouping factor. 
What is the implied support of the data? What are the attributes attached 
to - say var1 was observed at which of the member points? All of them 
simultaneously? If they form a line or polygon, then support is clear(er), 
but if a multipoint observation is better handled as described above, then 
it should be. Support is absolutely crucial for clarity in analysis (and 
visualization), I think.

Roger

PS: this is a similar case to that of the unusual M coordinate in some 
shapefiles - if it cannot be shown how this relates consistently to 
support, it shouldn't be admitted, I think. If we lose clear understanding 
of support for observation attributes, we cease to be able to interact 
with statisticians, and that interaction really matters.

>
> --j
>
> On Tue, Jul 26, 2011 at 2:28 PM, Dylan Beaudette
> <dylan.beaudette at gmail.com> wrote:
>> Hi Jonathan,
>>
>> My tool of choice for this operation is PostGIS. If you happen to have
>> a postgis db ready to go, simply import your problem file using the
>> postgis shapefile import tool and process there. Some tips here:
>>
>> http://amercader.net/blog/2011/04/exploding-multigeometries-with-postgis
>>
>> Cheers,
>> Dylan
>>
>> On Tue, Jul 26, 2011 at 2:13 PM, Jonathan Greenberg
>> <greenberg at ucdavis.edu> wrote:
>>> R-sig-geo'ers:
>>>
>>> I have an ESRI shapefile which has multi-point geometry, and I'm
>>> trying to get it into R for use with sp() and raster(). ?Using:
>>>
>>> points=readOGR(dsn=getwd(),layer="tnf_sub_2_TreeDig_pts_110725_v02")
>>> returns:
>>>
>>> Error in readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?:
>>> ?Incompatible geometry: 4
>>> In addition: There were 50 or more warnings (use warnings() to see the first 50)
>>>
>>> the warnings all say:
>>> ...
>>> 50: In readOGR(dsn = getwd(), layer = "tnf_sub_2_TreeDig_pts_110725_v02", ?... :
>>> ?eType not chosen
>>>
>>> What I really want is to, in the end, have a SpatialPointsDataFrame
>>> where each multi-point feature is converted to individual points that
>>> have the attribute of what multi-point feature it came from. ?What is
>>> the best way to do this? ?I'm attaching the zipped shapefile to this
>>> email (hopefully it won't get bounced).
>>>
>>> --j
>>>
>>> --
>>> Jonathan A. Greenberg, PhD
>>> Assistant Project Scientist
>>> Center for Spatial Technologies and Remote Sensing (CSTARS)
>>> Department of Land, Air and Water Resources
>>> University of California, Davis
>>> One Shields Avenue
>>> Davis, CA 95616
>>> Phone: 415-763-5476
>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, NHH Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 95 43
e-mail: Roger.Bivand at nhh.no

From r.hijmans at gmail.com  Fri Jul 29 10:50:49 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 29 Jul 2011 01:50:49 -0700 (PDT)
Subject: [R-sig-Geo] Transparency of Raster* objects
In-Reply-To: <CADLQFsPBRSjvaU2EO=AMK-BuUzcMRWuSnihqfwbyfZ+_mYJauw@mail.gmail.com>
References: <CADLQFsMXx8ohK9+DbROVrri6ZSqj8WAzEwxZW0gYanbYXhjpXA@mail.gmail.com>
	<1311889236089-6631467.post@n2.nabble.com>
	<CADLQFsPBRSjvaU2EO=AMK-BuUzcMRWuSnihqfwbyfZ+_mYJauw@mail.gmail.com>
Message-ID: <1311929449249-6632801.post@n2.nabble.com>

Pierre, 

> The trick is I'm using RColorBrewer, who does not provides this 
> posibility. 

No, but the alpha argument to plot (with a Raster* object) does:

r <- raster(system.file("external/test.grd", package="raster"))
library(RColorBrewer)
col <- brewer.pal(9, 'GnBu')
plot(r, col=col, alpha=0.3)

> However, what I'm still stuck at using a variable transparency in 
> space, eg in the meuse.grid dataset, how to make transparency a 
> function of the distance to the river (the dist attribute) ? 

I do not know; the below is ugly, but perhaps it provides some ideas:



library(raster)

data(meuse.grid)
coordinates(meuse.grid) <- ~x+y
proj4string(meuse.grid) <- CRS("+init=epsg:28992")
gridded(meuse.grid) <- TRUE
data(meuse.riv)
meuse.sr =
SpatialPolygons(list(Polygons(list(Polygon(meuse.riv)),"meuse.riv")))

r <- raster(meuse.grid, 'dist')
riv <- rasterize(meuse.sr, r)

d <- distance(riv)
d[d > 1000] <- 1000
d <- 254 * d/1000

a <- c(0:9, LETTERS[1:6])

bw <- paste("#000000", rep(a, each=16), rep(a, times=16), sep='')
plot(r)
plot(d, col=bw, add=T)

x11()
ter <- paste(substr(terrain.colors(254), 1, 7), rep(a, each=16), rep(a,
times=16), sep='')
plot(r, col=gray(1:255/255))
plot(d, col=ter, add=T)

Best, Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/Transparency-of-Raster-objects-tp6628801p6632801.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From alfreale74 at gmail.com  Fri Jul 29 12:38:23 2011
From: alfreale74 at gmail.com (Alfredo Alessandrini)
Date: Fri, 29 Jul 2011 12:38:23 +0200
Subject: [R-sig-Geo] replace NA value error
Message-ID: <CA+GC7G6p53zLjGQ8EWMY5_NX-3ra7TJvMe8nWEEwmJMOkUahrQ@mail.gmail.com>

Hi,

I'm trying to replace NA value with 0. But the function replace all
the value with zero:

R version 2.13.1 (2011-07-08)

raster version 1.9-2 (23-July-2011)

> dem
class       : RasterLayer
dimensions  : 57, 68, 3876  (nrow, ncol, ncell)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : 99.475, 100.0417, 2.266667, 2.741667  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0
values      : in memory
min value   : 100
max value   : 900

> dem[is.na(dem[])]
 [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[24] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[47] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA
[70] NA NA NA NA NA NA NA NA NA NA NA
>
> dem[is.na(dem[])] <- 0
> dem
class       : RasterLayer
dimensions  : 57, 68, 3876  (nrow, ncol, ncell)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : 99.475, 100.0417, 2.266667, 2.741667  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0
values      : in memory
min value   : 0
max value   : 0

>

Thanks,

Alfredo


From r.hijmans at gmail.com  Fri Jul 29 16:15:57 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 29 Jul 2011 07:15:57 -0700 (PDT)
Subject: [R-sig-Geo] replace NA value error
In-Reply-To: <CA+GC7G6p53zLjGQ8EWMY5_NX-3ra7TJvMe8nWEEwmJMOkUahrQ@mail.gmail.com>
References: <CA+GC7G6p53zLjGQ8EWMY5_NX-3ra7TJvMe8nWEEwmJMOkUahrQ@mail.gmail.com>
Message-ID: <1311948957650-6633712.post@n2.nabble.com>


> I'm trying to replace NA value with 0. But the function replace all 
> the value with zero: 
> dem[is.na(dem[])] <- 0 

Alfredo, that is indeed incorrect; fixed in version 1.9-5. Another way to do
this also works in 1.9-2:

dem[is.na(dem)] <- 0 
 
Thanks, Robert


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/replace-NA-value-error-tp6633025p6633712.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From rrasterr at gmail.com  Fri Jul 29 17:05:21 2011
From: rrasterr at gmail.com (Ana)
Date: Fri, 29 Jul 2011 16:05:21 +0100
Subject: [R-sig-Geo] HIRHAM netcdf file
Message-ID: <CAErHZW18HXvho7uTquapVETchGMcieXtFRUUdHja4SA8biFFSg@mail.gmail.com>

Can someone help me out with a "small" problem?

I've started using netcdf files recently, and I want to extract the
grid id and also the coordinates from a HIRHAM netcdf file.
I know how to extract a slice of dataset both in space and in time and
I also know the area that this file should cover, however I have no
idea regarding the reference for both LAT/LON and RLAT/RLON.

I tried already tried is ArcGIS to give the Lambert Conformal Conic
projection as the spatial reference, by default arcgis gets the rlat
and rlon for coordinates. however the resulting raster is displaced
from were it should be.

Can someone help me with this?

Thanks

A.R.


From lberner at whrc.org  Fri Jul 29 22:48:47 2011
From: lberner at whrc.org (lberner at whrc.org)
Date: Fri, 29 Jul 2011 13:48:47 -0700 (PDT)
Subject: [R-sig-Geo] questions on RasterStack/Brick
In-Reply-To: <1311711676166-6623580.post@n2.nabble.com>
References: <1285055383938-5553580.post@n2.nabble.com>
	<AANLkTi=3=VVyC26hu5vtBgekbfg_vTZ6tZSy8m7HO-HM@mail.gmail.com>
	<1311711676166-6623580.post@n2.nabble.com>
Message-ID: <1311972527202-6634917.post@n2.nabble.com>

Apologies-- there was an error in the stack correlation function of my last
post. Below is an updated version of the function.  

stack.correlation <- function(stack1, stack2, cor.method, na.val, na.rm =
T){
  # output template
  cor.map <- raster(stack1)
  # combine stacks
  combined.stack <- stack(stack1,stack2)
  NAvalue(combined.stack) = na.val
  
  # The function takes a vector of cell values (z-dimension), partitions it
in half, then correlates
  # the two sections, returning the correlation coefficient.
  stack.sequence.cor <- function(full.vec,na.rm=T){
    vec1<-full.vec[1:(length(full.vec)/2)]
    vec2<-full.vec[(length(full.vec)/2+1):length(full.vec)]
    return(cor(vec1,vec2, method=cor.method))
    }

  # Apply the function above to each xy cell and write the correlation
  # coefficient to the output template.
  cor.map <- stackApply(combined.stack, indices = rep(1,
length(combined.stack)), 
    fun = stack.sequence.cor, na.rm = TRUE)
  return(cor.map)
}

example call: 
my.cor.map <- stack.correlation(august_temp, july_temp, "spearman", -9999)
#plot(my.cor.map)


Logan


--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/questions-on-RasterStack-Brick-tp5553580p6634917.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From r.hijmans at gmail.com  Sat Jul 30 00:53:15 2011
From: r.hijmans at gmail.com (Robert Hijmans)
Date: Fri, 29 Jul 2011 15:53:15 -0700 (PDT)
Subject: [R-sig-Geo] questions on RasterStack/Brick
In-Reply-To: <1311972527202-6634917.post@n2.nabble.com>
References: <1285055383938-5553580.post@n2.nabble.com>
	<AANLkTi=3=VVyC26hu5vtBgekbfg_vTZ6tZSy8m7HO-HM@mail.gmail.com>
	<1311711676166-6623580.post@n2.nabble.com>
	<1311972527202-6634917.post@n2.nabble.com>
Message-ID: <1311979995877-6635224.post@n2.nabble.com>


> Apologies-- there was an error in the stack correlation function of my
> last post. Below is an updated 
> version of the function.   

Thanks Logan, 
That is very useful, but I would not use stackApply, but the simpler calc.
Below a reworked version of your function:


stackcor <- function(s1, s2, method='spearman') {
	mycor <- function(v) {
		x <- v[1:split]
		y <- v[(split+1):(2*split)]
		cor(x, y, method=method)
	}
	s <- stack(s1, s2)
	split <- nlayers(s)/2
	calc(s, fun=mycor )
}

Best, Robert

--
View this message in context: http://r-sig-geo.2731867.n2.nabble.com/questions-on-RasterStack-Brick-tp5553580p6635224.html
Sent from the R-sig-geo mailing list archive at Nabble.com.


From mdsumner at gmail.com  Sat Jul 30 02:13:24 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 30 Jul 2011 10:13:24 +1000
Subject: [R-sig-Geo] wkbMultiPoint and rgdal
In-Reply-To: <alpine.LRH.2.00.1107290948200.11052@reclus.nhh.no>
References: <CABG0rfs-GnznPbyumNUVTUJYpO_rBR4QWx3Zx1BUowwgd-p6ag@mail.gmail.com>
	<CAOGWcHL83io-yrkNBrhfG8KEEKJzZyH8bSoNwSOzdRgnT+HMgQ@mail.gmail.com>
	<CABG0rfuFu+K+f6oGrF0he2oRHUcB=wtzizoyZiV7c0cNVAZH4Q@mail.gmail.com>
	<alpine.LRH.2.00.1107290948200.11052@reclus.nhh.no>
Message-ID: <CAAcGz9_mRwW56AgxsVoJTcDJQSGGFRv7JhkON72=wtzXN3=3qg@mail.gmail.com>

This is a fundamental philosophical point that I haven't seen made
explicitly before, and I appreciate hearing it and I'm sorry if I've
missed it being laid out previously.

There is another example, similar (I think) to the multipoint one
(you'll find an implementation of multipoint inheriting from lines in
the ASDAR book btw, similar to how 'polygons' inherit from lines in
almost all software I am aware of).

sp's data structures purposely do not support the Z attribute on
vertices either, let alone the M one. If it were up to me I would
stick to the the GDAL/OGR (or OGC model) and let users take the
responsibility of what sense it makes. Points and lines present
absolutely no topological problems for n-dimensional geometry -
polygons do but that's because they are not true 2D topology.

I work in data transfer far more than I do in statistical analytics so
I guess that is mainly where the difference in perspective comes from.
I've come close to being able to modify the designs to do things how I
would like but it's mostly beyond me, I'm not complaining I wish I had
the skills to branch and write my own versions.

Cheers, Mike.


On Fri, Jul 29, 2011 at 5:57 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Thu, 28 Jul 2011, Jonathan Greenberg wrote:
>
>> Hi Dylan:
>>
>> Thanks -- I'm a bit of a PostGIS noob so I ended converting it to a
>> normal point file with the XTools extension in Arc. ?I'm surprised
>> there is no support for this data type in any R package, since I would
>> think it is a fairly common type. ?Ah well!
>
> Jonathan,
>
> Not really, as this is the first time I can recall it being mentioned in 8
> years. It is far from obvious what one could do with it that couldn't more
> properly be done with a SpatialPointsDataFrame with a grouping factor. What
> is the implied support of the data? What are the attributes attached to -
> say var1 was observed at which of the member points? All of them
> simultaneously? If they form a line or polygon, then support is clear(er),
> but if a multipoint observation is better handled as described above, then
> it should be. Support is absolutely crucial for clarity in analysis (and
> visualization), I think.
>
> Roger
>
> PS: this is a similar case to that of the unusual M coordinate in some
> shapefiles - if it cannot be shown how this relates consistently to support,
> it shouldn't be admitted, I think. If we lose clear understanding of support
> for observation attributes, we cease to be able to interact with
> statisticians, and that interaction really matters.
>
>>
>> --j
>>
>> On Tue, Jul 26, 2011 at 2:28 PM, Dylan Beaudette
>> <dylan.beaudette at gmail.com> wrote:
>>>
>>> Hi Jonathan,
>>>
>>> My tool of choice for this operation is PostGIS. If you happen to have
>>> a postgis db ready to go, simply import your problem file using the
>>> postgis shapefile import tool and process there. Some tips here:
>>>
>>> http://amercader.net/blog/2011/04/exploding-multigeometries-with-postgis
>>>
>>> Cheers,
>>> Dylan
>>>
>>> On Tue, Jul 26, 2011 at 2:13 PM, Jonathan Greenberg
>>> <greenberg at ucdavis.edu> wrote:
>>>>
>>>> R-sig-geo'ers:
>>>>
>>>> I have an ESRI shapefile which has multi-point geometry, and I'm
>>>> trying to get it into R for use with sp() and raster(). ?Using:
>>>>
>>>> points=readOGR(dsn=getwd(),layer="tnf_sub_2_TreeDig_pts_110725_v02")
>>>> returns:
>>>>
>>>> Error in readOGR(dsn = getwd(), layer =
>>>> "tnf_sub_2_TreeDig_pts_110725_v02", ?:
>>>> ?Incompatible geometry: 4
>>>> In addition: There were 50 or more warnings (use warnings() to see the
>>>> first 50)
>>>>
>>>> the warnings all say:
>>>> ...
>>>> 50: In readOGR(dsn = getwd(), layer =
>>>> "tnf_sub_2_TreeDig_pts_110725_v02", ?... :
>>>> ?eType not chosen
>>>>
>>>> What I really want is to, in the end, have a SpatialPointsDataFrame
>>>> where each multi-point feature is converted to individual points that
>>>> have the attribute of what multi-point feature it came from. ?What is
>>>> the best way to do this? ?I'm attaching the zipped shapefile to this
>>>> email (hopefully it won't get bounced).
>>>>
>>>> --j
>>>>
>>>> --
>>>> Jonathan A. Greenberg, PhD
>>>> Assistant Project Scientist
>>>> Center for Spatial Technologies and Remote Sensing (CSTARS)
>>>> Department of Land, Air and Water Resources
>>>> University of California, Davis
>>>> One Shields Avenue
>>>> Davis, CA 95616
>>>> Phone: 415-763-5476
>>>> AIM: jgrn307, MSN: jgrn307 at hotmail.com, Gchat: jgrn307
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>
>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, NHH Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 95 43
> e-mail: Roger.Bivand at nhh.no
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From mdsumner at gmail.com  Sat Jul 30 02:38:24 2011
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 30 Jul 2011 10:38:24 +1000
Subject: [R-sig-Geo] HIRHAM netcdf file
In-Reply-To: <CAErHZW18HXvho7uTquapVETchGMcieXtFRUUdHja4SA8biFFSg@mail.gmail.com>
References: <CAErHZW18HXvho7uTquapVETchGMcieXtFRUUdHja4SA8biFFSg@mail.gmail.com>
Message-ID: <CAAcGz98LuCrUgH4HXuv0MfrZ8LScApDPQurKgH0TeedJ7G4avg@mail.gmail.com>

You can use the ncdf (or RNetCDF) package to access all the dimensions
and variables directly from the file.

There is support for netcdf in the raster package, and optionally in
the rgdal package if you compile it. rasters depends on ncdf, and
rgdal on the GDAL driver implementation. Both have to perform the
minimum translation from the NetCDF data model to a GIS-raster-layer
one, and it does depend on details in the file quite a lot.

Cheers, Mike.


On Sat, Jul 30, 2011 at 1:05 AM, Ana <rrasterr at gmail.com> wrote:
> Can someone help me out with a "small" problem?
>
> I've started using netcdf files recently, and I want to extract the
> grid id and also the coordinates from a HIRHAM netcdf file.
> I know how to extract a slice of dataset both in space and in time and
> I also know the area that this file should cover, however I have no
> idea regarding the reference for both LAT/LON and RLAT/RLON.
>
> I tried already tried is ArcGIS to give the Lambert Conformal Conic
> projection as the spatial reference, by default arcgis gets the rlat
> and rlon for coordinates. however the resulting raster is displaced
> from were it should be.
>
> Can someone help me with this?
>
> Thanks
>
> A.R.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Michael Sumner
Institute for Marine and Antarctic Studies, University of Tasmania
Hobart, Australia
e-mail: mdsumner at gmail.com


From matevz.pavlic at gi-zrmk.si  Sun Jul 31 13:36:12 2011
From: matevz.pavlic at gi-zrmk.si (=?iso-8859-2?Q?Matev=BE_Pavli=E8?=)
Date: Sun, 31 Jul 2011 13:36:12 +0200
Subject: [R-sig-Geo] problems with universal kriging
Message-ID: <AD5CA6183570B54F92AA45CE2619F9B90129DDF2@gi-zrmk.si>

Hi all, 

 

i have some problems with universal kriging predictions. 

I would like to create a map using the X and Y as co-predictors. 

Attached is a sample data set  (temp.csv) and code (UK.txt) which is used in the predictions. 

 

The problem is, when i use universal kriging  i get really strange results. 

When I use this line for predicting :

 

z.uk<-krige(Globina~I(Y^2)+I(X^2)+I(X)+I(Y), DF, grd, vrmf.u)

 

the results are really strange: as you can see the Globina variable is reanging from 1.2 to 40 but predictions are from 457.6 to 2594.0.

 

> summary(DF$Globina)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 

   1.20   10.00   12.00   12.96   15.00   40.00 

 

> summary(z.uk$var1.pred)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 

  457.6  1206.0  1524.0  1525.0  1843.0  2594.0 

 

 

When i use thisl line for prediction :

z.uk<-krige(Globina~I(Y^2)+I(X^2)+I(X)+I(Y), DF, grd, vrmf.u)

 

the results are still strange, but different. Again Globina is ranging from 1.2 to 40 and the predicted values are ranging from -230.6 to  -207.6 !

 

> summary(DF$Globina)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 

   1.20   10.00   12.00   12.96   15.00   40.00 

 

> summary(z.uk$var1.pred)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 

 -230.6  -223.0  -221.6  -221.4  -220.0  -207.2 

 

What am I doing wrong?

 

thanks for the help, m

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110731/a84d6d11/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: temp1.csv
Type: application/octet-stream
Size: 19472 bytes
Desc: temp1.csv
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110731/a84d6d11/attachment.obj>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: UK.txt
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20110731/a84d6d11/attachment.txt>

From vetter at pik-potsdam.de  Sun Jul 31 14:37:29 2011
From: vetter at pik-potsdam.de (Tobias Vetter)
Date: Sun, 31 Jul 2011 14:37:29 +0200
Subject: [R-sig-Geo] problems with universal kriging
In-Reply-To: <AD5CA6183570B54F92AA45CE2619F9B90129DDF2@gi-zrmk.si>
References: <AD5CA6183570B54F92AA45CE2619F9B90129DDF2@gi-zrmk.si>
Message-ID: <20110731123729.0D3B5A28A@smtp.pik-potsdam.de>

Try small letters. Strange, but seems to work: 

GridRes<-0.1
grd<-expand.grid(x=seq(from=x.range[1], to=x.range[2], by=GridRes),
y=seq(from=y.range[1], to=y.range[2], by=GridRes))
names(grd)=c("x","y")
coordinates(grd)<-~x+y
gridded(grd)<-T 


newframe<-cbind(coordinates(DF),DF at data)
names(newframe)[1]="x"
names(newframe)[2]="y"
coordinates(newframe)=~x+y
z.uk<-krige(Globina~x+y,newframe,grd,vrm.u) 

 

> Hi all,  
> 
>   
> 
> i have some problems with universal kriging predictions.  
> 
> I would like to create a map using the X and Y as co-predictors.  
> 
> Attached is a sample data set  (temp.csv) and code (UK.txt) which is used in the predictions.  
> 
>   
> 
> The problem is, when i use universal kriging  i get really strange results.  
> 
> When I use this line for predicting : 
> 
>   
> 
> z.uk<-krige(Globina~I(Y^2)+I(X^2)+I(X)+I(Y), DF, grd, vrmf.u) 
> 
>   
> 
> the results are really strange: as you can see the Globina variable is reanging from 1.2 to 40 but predictions are from 457.6 to 2594.0. 
> 
>   
> 
>> summary(DF$Globina)
> 
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  
> 
>    1.20   10.00   12.00   12.96   15.00   40.00  
> 
>   
> 
>> summary(z.uk$var1.pred)
> 
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  
> 
>   457.6  1206.0  1524.0  1525.0  1843.0  2594.0  
> 
>   
> 
>   
> 
> When i use thisl line for prediction : 
> 
> z.uk<-krige(Globina~I(Y^2)+I(X^2)+I(X)+I(Y), DF, grd, vrmf.u) 
> 
>   
> 
> the results are still strange, but different. Again Globina is ranging from 1.2 to 40 and the predicted values are ranging from -230.6 to  -207.6 ! 
> 
>   
> 
>> summary(DF$Globina)
> 
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  
> 
>    1.20   10.00   12.00   12.96   15.00   40.00  
> 
>   
> 
>> summary(z.uk$var1.pred)
> 
>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  
> 
>  -230.6  -223.0  -221.6  -221.4  -220.0  -207.2  
> 
>   
> 
> What am I doing wrong? 
> 
>   
> 
> thanks for the help, m 
> 
>   
>


