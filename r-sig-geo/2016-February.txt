From tyler.j.frazier at icloud.com  Mon Feb  1 02:03:12 2016
From: tyler.j.frazier at icloud.com (Tyler Frazier)
Date: Sun, 31 Jan 2016 20:03:12 -0500
Subject: [R-sig-Geo] Tearing of polygons using ggmap & readOGR
In-Reply-To: <alpine.LFD.2.20.1601312128360.18713@reclus.nhh.no>
References: <AAD62D6C-EC13-43B2-A702-2904C8629417@icloud.com>
	<alpine.LFD.2.20.1601312128360.18713@reclus.nhh.no>
Message-ID: <A6A0AEED-9098-497E-8A30-BDEE40C5148B@icloud.com>

Hi Roger, 

Thanks for your reply and pointers.  I was looking for a simplified shapefile of American state boundaries and downloaded this one from ESRI, states_basic.

https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5 <https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5>

The .shp is only about 222 KB which was OK for plotting speed in R as well as its appearance.  I tried 

states <- getData('GADM', country='USA', level=1)

as well as the census state subdivisions, but the resolution seemed to be too much for R to handle in a plot.

The states_basic file from ESRI plots just fine with 

plot(states)  ? I think the summary() command returns what would be expected of a shapefile that was read into R as SPDF.

> summary(states)
Object of class SpatialPolygonsDataFrame
Coordinates:
         min       max
x -178.21760 -66.96927
y   18.92179  71.40624
Is projected: FALSE 
proj4string :
[+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0]
Data attributes:
      STATE_NAME    DRAWSEQ       STATE_FIPS              SUB_REGION   STATE_ABBR
 Alabama   : 1   Min.   : 1.0   01     : 1   South Atlantic    : 9   AK     : 1  
 Alaska    : 1   1st Qu.:13.5   02     : 1   Mountain          : 8   AL     : 1  
 Arizona   : 1   Median :26.0   04     : 1   West North Central: 7   AR     : 1  
 Arkansas  : 1   Mean   :26.0   05     : 1   New England       : 6   AZ     : 1  
 California: 1   3rd Qu.:38.5   06     : 1   East North Central: 5   CA     : 1  
 Colorado  : 1   Max.   :51.0   08     : 1   Pacific           : 5   CO     : 1  
 (Other)   :45                  (Other):45   (Other)           :11   (Other):45  
> states at data
             STATE_NAME DRAWSEQ STATE_FIPS         SUB_REGION STATE_ABBR
0                Hawaii       1         15            Pacific         HI
1            Washington       2         53            Pacific         WA
2               Montana       3         30           Mountain         MT

etc?

sounds like I need to look into exactly what is happening as part of the fortify() command in order to achieve some consistency of integrating SpatialPolygonsDataFrames with the ggmap() function.  I may eventually go to tmap or mapview or perhaps leaflet, but have found ggplot:: / ggmap:: to be very useful packages (+geom_polygons, + geom_points etc?)and was hoping to keep working with their grammar of graphics.

Tyler


> On Jan 31, 2016, at 3:35 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> 
> On Sun, 31 Jan 2016, Tyler Frazier wrote:
> 
>> I'm trying to incorporate a simple shapefile of US states with ggmap and keep getting "tearing" of my polygons. I tried changing group=id to group=group which seemed to partially solve the problem, but not entirely.
>> 
>> library(rgdal)
>> 
>> states <- readOGR(dsn="shapefiles", layer="states")
>> 
>> proj4string(states)
>> 
>> [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>> 
>> states <- spTransform(states, CRS("+proj=longlat +datum=WGS84"))
> 
> Unnecessary, as you should know from the +towgs84= tag.
> 
>> 
>> states <- fortify(states)
> 
> The fortify methods turn data from marine animals with structure into fish soup (a data frame adding attribute values spuriously to each coordinate, I believe). Unless the objects are exactly as fortify wants them, it derails.
> 
> Do you know that they were polygons? Where did the shapefile come from? Did you plot it? Did you check that it contained what you thought it contained (summary())?
> 
> Have you considered alternatives (tmap, mapview, ...)?
> 
>> 
>> sstates <- get_map(location = c(-81, 35, -69, 45), zoom = 4, maptype = "watercolor")
>> 
>> sstates <- ggmap(sstates)
>> 
>> sstates <- sstates + geom_polygon(aes(x = long, y = lat, group=group), data = states, color ="white", fill ="orangered4", alpha = .4, size = .2)
>> 
>> Here is an image of the output.
>> 
>> http://pasteboard.co/1d7kiRfw.png <http://pasteboard.co/1d7kiRfw.png>
>> 
> 
> Image posted OK, but posting HTML (unnecessary).
> 
>> 
>> 	[[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
> 
> -- 
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412


	[[alternative HTML version deleted]]


From bob at rudis.net  Mon Feb  1 04:12:07 2016
From: bob at rudis.net (boB Rudis)
Date: Sun, 31 Jan 2016 22:12:07 -0500
Subject: [R-sig-Geo] Tearing of polygons using ggmap & readOGR
In-Reply-To: <A6A0AEED-9098-497E-8A30-BDEE40C5148B@icloud.com>
References: <AAD62D6C-EC13-43B2-A702-2904C8629417@icloud.com>
	<alpine.LFD.2.20.1601312128360.18713@reclus.nhh.no>
	<A6A0AEED-9098-497E-8A30-BDEE40C5148B@icloud.com>
Message-ID: <CAJ4QxaO=chvSHBx6ksfQDWyfWxEmvEw0g5kAOhiKaWwcXeWg2w@mail.gmail.com>

Clip the state polygons with gIntersection. You cross-posted to
StackOverflow & here so there's a complete answer there as it's more
amenable to source code + commentary + images and will be around for
quite a while despite what folks may opine about mailing lists.

On Sun, Jan 31, 2016 at 8:03 PM, Tyler Frazier
<tyler.j.frazier at icloud.com> wrote:
> Hi Roger,
>
> Thanks for your reply and pointers.  I was looking for a simplified shapefile of American state boundaries and downloaded this one from ESRI, states_basic.
>
> https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5 <https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5>
>
> The .shp is only about 222 KB which was OK for plotting speed in R as well as its appearance.  I tried
>
> states <- getData('GADM', country='USA', level=1)
>
> as well as the census state subdivisions, but the resolution seemed to be too much for R to handle in a plot.
>
> The states_basic file from ESRI plots just fine with
>
> plot(states)  ? I think the summary() command returns what would be expected of a shapefile that was read into R as SPDF.
>
>> summary(states)
> Object of class SpatialPolygonsDataFrame
> Coordinates:
>          min       max
> x -178.21760 -66.96927
> y   18.92179  71.40624
> Is projected: FALSE
> proj4string :
> [+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0]
> Data attributes:
>       STATE_NAME    DRAWSEQ       STATE_FIPS              SUB_REGION   STATE_ABBR
>  Alabama   : 1   Min.   : 1.0   01     : 1   South Atlantic    : 9   AK     : 1
>  Alaska    : 1   1st Qu.:13.5   02     : 1   Mountain          : 8   AL     : 1
>  Arizona   : 1   Median :26.0   04     : 1   West North Central: 7   AR     : 1
>  Arkansas  : 1   Mean   :26.0   05     : 1   New England       : 6   AZ     : 1
>  California: 1   3rd Qu.:38.5   06     : 1   East North Central: 5   CA     : 1
>  Colorado  : 1   Max.   :51.0   08     : 1   Pacific           : 5   CO     : 1
>  (Other)   :45                  (Other):45   (Other)           :11   (Other):45
>> states at data
>              STATE_NAME DRAWSEQ STATE_FIPS         SUB_REGION STATE_ABBR
> 0                Hawaii       1         15            Pacific         HI
> 1            Washington       2         53            Pacific         WA
> 2               Montana       3         30           Mountain         MT
>
> etc?
>
> sounds like I need to look into exactly what is happening as part of the fortify() command in order to achieve some consistency of integrating SpatialPolygonsDataFrames with the ggmap() function.  I may eventually go to tmap or mapview or perhaps leaflet, but have found ggplot:: / ggmap:: to be very useful packages (+geom_polygons, + geom_points etc?)and was hoping to keep working with their grammar of graphics.
>
> Tyler
>
>
>> On Jan 31, 2016, at 3:35 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>> On Sun, 31 Jan 2016, Tyler Frazier wrote:
>>
>>> I'm trying to incorporate a simple shapefile of US states with ggmap and keep getting "tearing" of my polygons. I tried changing group=id to group=group which seemed to partially solve the problem, but not entirely.
>>>
>>> library(rgdal)
>>>
>>> states <- readOGR(dsn="shapefiles", layer="states")
>>>
>>> proj4string(states)
>>>
>>> [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>>
>>> states <- spTransform(states, CRS("+proj=longlat +datum=WGS84"))
>>
>> Unnecessary, as you should know from the +towgs84= tag.
>>
>>>
>>> states <- fortify(states)
>>
>> The fortify methods turn data from marine animals with structure into fish soup (a data frame adding attribute values spuriously to each coordinate, I believe). Unless the objects are exactly as fortify wants them, it derails.
>>
>> Do you know that they were polygons? Where did the shapefile come from? Did you plot it? Did you check that it contained what you thought it contained (summary())?
>>
>> Have you considered alternatives (tmap, mapview, ...)?
>>
>>>
>>> sstates <- get_map(location = c(-81, 35, -69, 45), zoom = 4, maptype = "watercolor")
>>>
>>> sstates <- ggmap(sstates)
>>>
>>> sstates <- sstates + geom_polygon(aes(x = long, y = lat, group=group), data = states, color ="white", fill ="orangered4", alpha = .4, size = .2)
>>>
>>> Here is an image of the output.
>>>
>>> http://pasteboard.co/1d7kiRfw.png <http://pasteboard.co/1d7kiRfw.png>
>>>
>>
>> Image posted OK, but posting HTML (unnecessary).
>>
>>>
>>>      [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>> http://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> http://depsy.org/person/434412
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From tyler.j.frazier at icloud.com  Mon Feb  1 04:58:16 2016
From: tyler.j.frazier at icloud.com (Tyler Frazier)
Date: Sun, 31 Jan 2016 22:58:16 -0500
Subject: [R-sig-Geo] Tearing of polygons using ggmap & readOGR
In-Reply-To: <CAJ4QxaO=chvSHBx6ksfQDWyfWxEmvEw0g5kAOhiKaWwcXeWg2w@mail.gmail.com>
References: <AAD62D6C-EC13-43B2-A702-2904C8629417@icloud.com>
	<alpine.LFD.2.20.1601312128360.18713@reclus.nhh.no>
	<A6A0AEED-9098-497E-8A30-BDEE40C5148B@icloud.com>
	<CAJ4QxaO=chvSHBx6ksfQDWyfWxEmvEw0g5kAOhiKaWwcXeWg2w@mail.gmail.com>
Message-ID: <F8137141-B4F6-4555-A719-CAC7525D8628@icloud.com>

That?s great, works like a charm.

> On Jan 31, 2016, at 10:12 PM, boB Rudis <bob at rudis.net> wrote:
> 
> Clip the state polygons with gIntersection. You cross-posted to
> StackOverflow & here so there's a complete answer there as it's more
> amenable to source code + commentary + images and will be around for
> quite a while despite what folks may opine about mailing lists.
> 
> On Sun, Jan 31, 2016 at 8:03 PM, Tyler Frazier
> <tyler.j.frazier at icloud.com <mailto:tyler.j.frazier at icloud.com>> wrote:
>> Hi Roger,
>> 
>> Thanks for your reply and pointers.  I was looking for a simplified shapefile of American state boundaries and downloaded this one from ESRI, states_basic.
>> 
>> https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5 <https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5> <https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5 <https://www.arcgis.com/home/item.html?id=f7f805eb65eb4ab787a0a3e1116ca7e5>>
>> 
>> The .shp is only about 222 KB which was OK for plotting speed in R as well as its appearance.  I tried
>> 
>> states <- getData('GADM', country='USA', level=1)
>> 
>> as well as the census state subdivisions, but the resolution seemed to be too much for R to handle in a plot.
>> 
>> The states_basic file from ESRI plots just fine with
>> 
>> plot(states)  ? I think the summary() command returns what would be expected of a shapefile that was read into R as SPDF.
>> 
>>> summary(states)
>> Object of class SpatialPolygonsDataFrame
>> Coordinates:
>>         min       max
>> x -178.21760 -66.96927
>> y   18.92179  71.40624
>> Is projected: FALSE
>> proj4string :
>> [+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0]
>> Data attributes:
>>      STATE_NAME    DRAWSEQ       STATE_FIPS              SUB_REGION   STATE_ABBR
>> Alabama   : 1   Min.   : 1.0   01     : 1   South Atlantic    : 9   AK     : 1
>> Alaska    : 1   1st Qu.:13.5   02     : 1   Mountain          : 8   AL     : 1
>> Arizona   : 1   Median :26.0   04     : 1   West North Central: 7   AR     : 1
>> Arkansas  : 1   Mean   :26.0   05     : 1   New England       : 6   AZ     : 1
>> California: 1   3rd Qu.:38.5   06     : 1   East North Central: 5   CA     : 1
>> Colorado  : 1   Max.   :51.0   08     : 1   Pacific           : 5   CO     : 1
>> (Other)   :45                  (Other):45   (Other)           :11   (Other):45
>>> states at data
>>             STATE_NAME DRAWSEQ STATE_FIPS         SUB_REGION STATE_ABBR
>> 0                Hawaii       1         15            Pacific         HI
>> 1            Washington       2         53            Pacific         WA
>> 2               Montana       3         30           Mountain         MT
>> 
>> etc?
>> 
>> sounds like I need to look into exactly what is happening as part of the fortify() command in order to achieve some consistency of integrating SpatialPolygonsDataFrames with the ggmap() function.  I may eventually go to tmap or mapview or perhaps leaflet, but have found ggplot:: / ggmap:: to be very useful packages (+geom_polygons, + geom_points etc?)and was hoping to keep working with their grammar of graphics.
>> 
>> Tyler
>> 
>> 
>>> On Jan 31, 2016, at 3:35 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> 
>>> On Sun, 31 Jan 2016, Tyler Frazier wrote:
>>> 
>>>> I'm trying to incorporate a simple shapefile of US states with ggmap and keep getting "tearing" of my polygons. I tried changing group=id to group=group which seemed to partially solve the problem, but not entirely.
>>>> 
>>>> library(rgdal)
>>>> 
>>>> states <- readOGR(dsn="shapefiles", layer="states")
>>>> 
>>>> proj4string(states)
>>>> 
>>>> [1] "+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,0"
>>>> 
>>>> states <- spTransform(states, CRS("+proj=longlat +datum=WGS84"))
>>> 
>>> Unnecessary, as you should know from the +towgs84= tag.
>>> 
>>>> 
>>>> states <- fortify(states)
>>> 
>>> The fortify methods turn data from marine animals with structure into fish soup (a data frame adding attribute values spuriously to each coordinate, I believe). Unless the objects are exactly as fortify wants them, it derails.
>>> 
>>> Do you know that they were polygons? Where did the shapefile come from? Did you plot it? Did you check that it contained what you thought it contained (summary())?
>>> 
>>> Have you considered alternatives (tmap, mapview, ...)?
>>> 
>>>> 
>>>> sstates <- get_map(location = c(-81, 35, -69, 45), zoom = 4, maptype = "watercolor")
>>>> 
>>>> sstates <- ggmap(sstates)
>>>> 
>>>> sstates <- sstates + geom_polygon(aes(x = long, y = lat, group=group), data = states, color ="white", fill ="orangered4", alpha = .4, size = .2)
>>>> 
>>>> Here is an image of the output.
>>>> 
>>>> http://pasteboard.co/1d7kiRfw.png <http://pasteboard.co/1d7kiRfw.png>
>>>> 
>>> 
>>> Image posted OK, but posting HTML (unnecessary).
>>> 
>>>> 
>>>>     [[alternative HTML version deleted]]
>>>> 
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> 
>>> 
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>> http://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> http://depsy.org/person/434412
>> 
>> 
>>        [[alternative HTML version deleted]]
>> 
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo <https://stat.ethz.ch/mailman/listinfo/r-sig-geo>

	[[alternative HTML version deleted]]


From clement.gorin at univ-st-etienne.fr  Mon Feb  1 10:36:40 2016
From: clement.gorin at univ-st-etienne.fr (=?utf-8?Q?Cl=C3=A9ment_Gorin?=)
Date: Mon, 1 Feb 2016 10:36:40 +0100
Subject: [R-sig-Geo] SAR Poisson GLM model
References: <mailman.315.1454316976.3865.r-sig-geo@r-project.org>
Message-ID: <6452B3A5-473A-4D33-BDAA-593EEB1F604B@univ-st-etienne.fr>

Hi,
I am estimating a gravity model of migration on cross-sectional data. The Moran I statistic indicates a positive and significant spatial autocorrelation in the residuals of the a-spatail model, and the Lagrange Multiplier test points to the Spatial Autoregressive (SAR) model as the preferred specification. While I have no issue fitting a linear SAR (Le Sage and Pace 2008) to my data, it does not accommodate the very large number of zeroes (> 90%) in my dependent variable. This clearly point to a Poisson process (Santos Silva and Tenreyro 2006). 

In short, I am having trouble running the SAR Poisson GLM. I had two questions:

(1) Is there a method to run a SAR Poisson GLM in R? (I searched a lot before posting here)

(2) If answer to (1) is no, I should at least use a spatially filtered Poisson GLM. Yet, both SptatialFiltering() and ME() crash even using a very simple connectivity structure (symmetric knn = 5). I mean that it did not give any message error but RStudio simply "lost the connection with the R session". I suspect this is due to the large number of observation (278 784). Do you have tips to increase computational efficiency?

Best,
Cl?ment Gorin
PhD student, GATE LSE

From Roger.Bivand at nhh.no  Mon Feb  1 11:15:28 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 1 Feb 2016 11:15:28 +0100
Subject: [R-sig-Geo] SAR Poisson GLM model
In-Reply-To: <6452B3A5-473A-4D33-BDAA-593EEB1F604B@univ-st-etienne.fr>
References: <mailman.315.1454316976.3865.r-sig-geo@r-project.org>
	<6452B3A5-473A-4D33-BDAA-593EEB1F604B@univ-st-etienne.fr>
Message-ID: <alpine.LFD.2.20.1602011044110.3803@reclus.nhh.no>

On Mon, 1 Feb 2016, Cl?ment Gorin wrote:

> Hi,

> I am estimating a gravity model of migration on cross-sectional data. 
> The Moran I statistic indicates a positive and significant spatial 
> autocorrelation in the residuals of the a-spatail model, and the 
> Lagrange Multiplier test points to the Spatial Autoregressive (SAR) 
> model as the preferred specification. While I have no issue fitting a 
> linear SAR (Le Sage and Pace 2008) to my data, it does not accommodate 
> the very large number of zeroes (> 90%) in my dependent variable. This 
> clearly point to a Poisson process (Santos Silva and Tenreyro 2006).
>
> In short, I am having trouble running the SAR Poisson GLM. I had two 
> questions:
>
> (1) Is there a method to run a SAR Poisson GLM in R? (I searched a lot 
> before posting here)

Look at your model first. A gravity model estimated as Poisson implies the 
278k are interactions, that is origin/destination pairs, not counts of 
origins or destinations. sqrt(278784) is 528, which I think is your real 
n. Your data are zero-inflated, so maybe you need to use a zero-inflated 
approach. Just saying you want to run a SAR Poisson (where your use of SAR 
is ambiguous - you mean y ~ rho W y + X beta, but SAR really means 
simultaneous autoregressive, a distinction from conditional autoregressive 
(CAR)), suggests autocorrelation in the interactions, but the spatial 
autocorrelation is likely in the origin and destination fixed effects, not 
in the interactions.

Did you look at the spatial regression section of the Spatial task view?

There is a SAR Poisson approach (in your terms) in INLA - the slm latent 
model does something like this, but will not handle the zero-inflation, 
and most likely isn't appropriate to your setting. In any case, a Poisson 
approach without an offset (log expected interactions) may not be 
sensible, in addition to the spatial autocorrelation actually "belonging 
to" the origins and destinations, not the interactions.

>
> (2) If answer to (1) is no, I should at least use a spatially filtered 
> Poisson GLM. Yet, both SptatialFiltering() and ME() crash even using a 
> very simple connectivity structure (symmetric knn = 5). I mean that it 
> did not give any message error but RStudio simply "lost the connection 
> with the R session". I suspect this is due to the large number of 
> observation (278 784). Do you have tips to increase computational 
> efficiency?

Never run sensitive processes under RStudio. They have not yet (tens of 
months' waiting) replied to a query of this kind, and the problem in some 
cases may be with them. In a former case under Windows, a similar message 
was seen under RStudio, but the underlying command (not yours) ran to 
completion in RGui. Always report the output of sessionInfo() - your 
platform is unknown.

Why would you think that a dense 278k x 278k matrix could be handled? 
SF/ME work by selecting eigenvectors from the weights (knn is pretty 
unsatisfactory too - it does not yield a planar graph). Your initial 
memory needs are roughly 600GB, so this is probably not the way to go.

If the earlier comments are correct, you actually have n=528, meaning that 
you'd need first to align the SF processes with the origin and destination 
fixed effects (or adding WX to the X) - see work by Griffith and Chun - 
Yongwan Chun may even have code for DOI: 10.1080/00045608.2011.561070 and 
other publications. IIRC you roll out the eigenvectors to the nxn 
interactions like other fixed effects.

Hope this clarifies,

Roger

>
> Best,
> Cl?ment Gorin
> PhD student, GATE LSE
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From paolo.piras at uniroma3.it  Tue Feb  2 01:15:25 2016
From: paolo.piras at uniroma3.it (Paolo Piras)
Date: Tue, 2 Feb 2016 00:15:25 +0000
Subject: [R-sig-Geo] smoothing spline with known error in y
In-Reply-To: <alpine.LFD.2.20.1602011044110.3803@reclus.nhh.no>
References: <mailman.315.1454316976.3865.r-sig-geo@r-project.org>
	<6452B3A5-473A-4D33-BDAA-593EEB1F604B@univ-st-etienne.fr>,
	<alpine.LFD.2.20.1602011044110.3803@reclus.nhh.no>
Message-ID: <HE1PR04MB116126AAE21646FAA6FC3C84B3DF0@HE1PR04MB1161.eurprd04.prod.outlook.com>

Hi folks,
I write in order to ask an advice on how to correctly set a smoothing spline model where I know the error associated to each y (univariate) observation. After reading about it, I suppose I need a weighted spline model (in this case I would like to know how to use experimental error in the weight argument) but I really would like to hear something from the community.
Thanks in advance for any advice
best
paolo


 

From francescoperugini07 at gmail.com  Tue Feb  2 16:15:17 2016
From: francescoperugini07 at gmail.com (Francesco Perugini)
Date: Tue, 2 Feb 2016 16:15:17 +0100
Subject: [R-sig-Geo] globalG.test - x vector with different lenght as the
	neighbours list
Message-ID: <CAEG8zh5049_F9Wdz7Q2P0uBowukXZqW7sFZt1fFoCVZHO48EcA@mail.gmail.com>

Dear all,
I've a routine to create spatial weight matrix for different k and then to
implement, for each of the created spatial weighted matrix, the Global G
test for autocorrelation.
The point is that I'll try to do this test on multiple variables but then
lenghts are different

> length(dlwknn.B$neighbours)
[1] 49
> length(var)
[1] 1

Any help on how to code this?
Thanks a lot.
franc.per90


______________________________
This is the routine:

library(spdep)
example(columbus)
#data(columbus)
#attach(columbus)
coord <- coordinates(columbus)


z <- c(1,2,3,4,5,6,7,8,9)
neighbors.knn <- list()

for (val in z)
  {
  neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
longlat=F), sym=F)))
}

class(neighbors.knn)

class(neighbors.knn[[1]])
plot(neighbors.knn[[1]], coord)

class(neighbors.knn[[2]])
plot(neighbors.knn[[2]], coord)
....


ndists <- length(z)
ZG <- vector(mode="list", length=ndists)
names(ZG) <- as.character(z)

f <- c(CRIME, INC)
for (val in z) {
  dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
  temp <- list()

  for (var in f)
  {
    temp <- c(temp, list(globalG.test(var, dlwknn.B, zero.policy=F)))
  }
  ZG[[val]] <- temp
}

t(sapply(ZG, function(var) c(var$estimate[1], var$statistic,
p.value=unname(var$p.value))))

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Feb  2 16:36:23 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 2 Feb 2016 16:36:23 +0100
Subject: [R-sig-Geo] globalG.test - x vector with different lenght as
 the	neighbours list
In-Reply-To: <CAEG8zh5049_F9Wdz7Q2P0uBowukXZqW7sFZt1fFoCVZHO48EcA@mail.gmail.com>
References: <CAEG8zh5049_F9Wdz7Q2P0uBowukXZqW7sFZt1fFoCVZHO48EcA@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602021629010.8042@reclus.nhh.no>

On Tue, 2 Feb 2016, Francesco Perugini wrote:

> Dear all,
> I've a routine to create spatial weight matrix for different k and then to
> implement, for each of the created spatial weighted matrix, the Global G
> test for autocorrelation.
> The point is that I'll try to do this test on multiple variables but then
> lenghts are different
>
>> length(dlwknn.B$neighbours)
> [1] 49
>> length(var)
> [1] 1
>
> Any help on how to code this?
> Thanks a lot.
> franc.per90
>
>
> ______________________________
> This is the routine:
>
> library(spdep)
> example(columbus)
> #data(columbus)
> #attach(columbus)
> coord <- coordinates(columbus)
>
>
> z <- c(1,2,3,4,5,6,7,8,9)
> neighbors.knn <- list()
>
> for (val in z)
>  {
>  neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
> longlat=F), sym=F)))
> }
>
> class(neighbors.knn)
>
> class(neighbors.knn[[1]])
> plot(neighbors.knn[[1]], coord)
>
> class(neighbors.knn[[2]])
> plot(neighbors.knn[[2]], coord)
> ....
>
>
> ndists <- length(z)
> ZG <- vector(mode="list", length=ndists)
> names(ZG) <- as.character(z)

The lists are too complicated at this stage. Now each k in ZG is a list of 
two htest objects.

>
> f <- c(CRIME, INC)

Fails if columbus not attached - do not attach as this confuses everything 
here. Use:

f <- c("CRIME", "INC")


> for (val in z) {
>  dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
>  temp <- list()
>
>  for (var in f)
>  {
>    temp <- c(temp, list(globalG.test(var, dlwknn.B, zero.policy=F)))


temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B, zero.policy=F)))


>  }
>  ZG[[val]] <- temp
> }
>
> t(sapply(ZG, function(var) c(var$estimate[1], var$statistic,
> p.value=unname(var$p.value))))
>

Extract the variables one-by-one in the order of the f vector:

t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
   var$statistic, p.value=unname(var$p.value))))

t(sapply(lapply(ZG, "[[", 2), function(var) c(var$estimate[1],
  var$statistic, p.value=unname(var$p.value))))

Roger


> 	[[alternative HTML version deleted]]

Plain text, please.

>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From Roger.Bivand at nhh.no  Wed Feb  3 10:21:27 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 3 Feb 2016 10:21:27 +0100
Subject: [R-sig-Geo] rgdal readOGR() problem
In-Reply-To: <alpine.LFD.2.20.1601280814550.13018@reclus.nhh.no>
References: <43D886B7-BD94-469D-BDD6-3483BF4987E0@unimelb.edu.au>
	<alpine.LFD.2.20.1601280814550.13018@reclus.nhh.no>
Message-ID: <alpine.LFD.2.20.1602031006130.30322@reclus.nhh.no>

Following contact offlist, it appears that the handling of *List fields in 
the GDAL/OGR 1.7.3 GeoJSON driver is broken (release over 5 years old, 
support for *List field splitting in ogr2ogr from 1.8.0, etc.). The only 
resolution is upgrading GDAL on the production system.

Incidentally, note that GDAL 1.11.4 may be the last 1.* series bug-fix 
release; 2.0.2 is the current release, and 2.1.0 is in progress as the 
development release. Fedora is at GDAL 2.0.1, but Debian-based 
distributions are at best at 1.11.*. Debian and Ubuntu users and 
derivatives should consider installing from source unless upstream 
packages depend on outdated GDAL versions. Note the GDAL version reported 
when rgdal is loaded - bug fixes occur all the time, so keeping close to 
current removes the risk of user errors being down to out-of-date GDAL 
support.

Roger

On Thu, 28 Jan 2016, Roger Bivand wrote:

> On Thu, 28 Jan 2016, Philip Greenwood wrote:
>
>>  I am trying to compute distance spatial weight matrices using rgdal. This
>>  works fine in my local test system, but when I deploy my code to our
>>  production system I receive the following error when readOGR is executed:
>>
>>  Source: "/tmp/geojson_writer2529085113493086718.json", layer: "OGRGeoJSON"
>>  with 195 features
>>  It has 26 fields, of which 1 list fields
>>  Error : length(fldnms1) == nflds is not TRUE
>
> Pleaase run traceback() after the error.
>
> Please run ogrInfo() on both systems, and compare the output.
>
> Please check that GDAL is the same version on both systems (I guess it isn't 
> - if the file is the same on both systems, it is the only other variable 
> element). The GDAL version can be shown by:
>
> getGDALVersionInfo()
>
> and compare with:
>
> getGDALCheckVersion()
>
> to ensure that rgdal was installed using the same version as the GDAL shared 
> object that is loaded (this is shown when rgdal is loaded unless startup 
> messages are suppressed).
>
> If you check the source code - traceback() shows which function to look in - 
> you'll see that this is about the names of list fields (data fields that 
> include a list of fields of the same type). Does your input file include such 
> list fields?
>
> Hope this helps,
>
> Roger
>
>>
>>  Any ideas about what the error means?
>>
>>  My local system and the production system are using the same version of
>>  rgdal. Here is the sessionInfo for the system that is having trouble:
>> 
>> >  sessionInfo()
>>  R version 3.1.3 (2015-03-09)
>>  Platform: x86_64-redhat-linux-gnu (64-bit)
>>  Running under: CentOS release 6.5 (Final)
>>
>>  locale:
>>  [1] LC_CTYPE=en_AU.UTF-8       LC_NUMERIC=C
>>  [3] LC_TIME=en_AU.UTF-8        LC_COLLATE=en_AU.UTF-8
>>  [5] LC_MONETARY=en_AU.UTF-8    LC_MESSAGES=en_AU.UTF-8
>>  [7] LC_PAPER=en_AU.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>  [11] LC_MEASUREMENT=en_AU.UTF-8 LC_IDENTIFICATION=C
>>
>>  attached base packages:
>>  [1] grid      stats     graphics  grDevices utils     methods   base
>>
>>  other attached packages:
>>  [1] log4r_0.2          PBSmapping_2.69.76 rgeos_0.3-8        gpclib_1.5-5
>>  [5] maptools_0.8-36    gdata_2.16.1       RJSONIO_1.3-0      spdep_0.5-88
>>  [9] Matrix_1.1-5       rgdal_0.9-2        sp_1.1-0           Hmisc_3.16-0
>>  [13] ggplot2_1.0.1      Formula_1.2-1      survival_2.38-1
>>  lattice_0.20-30
>>  [17] psych_1.5.4        classInt_0.1-22
>>
>>  loaded via a namespace (and not attached):
>>  [1] acepack_1.3-3.3     boot_1.3-15         class_7.3-12
>>  [4] cluster_2.0.1       coda_0.17-1         colorspace_1.2-6
>>  [7] deldir_0.1-9        digest_0.6.8        e1071_1.6-4
>>  [10] foreign_0.8-63      gridExtra_0.9.1     gtable_0.1.2
>>  [13] gtools_3.4.2        latticeExtra_0.6-26 LearnBayes_2.15
>>  [16] magrittr_1.5        MASS_7.3-39         mnormt_1.5-2
>>  [19] munsell_0.4.2       nlme_3.1-120        nnet_7.3-9
>>  [22] parallel_3.1.3      plyr_1.8.2          proto_0.3-10
>>  [25] RColorBrewer_1.1-2  Rcpp_0.11.6         reshape2_1.4.1
>>  [28] rpart_4.1-9         scales_0.2.4        splines_3.1
>>
>>  Thanks.
>>  Phil
>>
>>  ---
>>  Philip Greenwood
>>  Senior Software Developer
>>  Australian Urban Research Infrastructure Network (AURIN)
>>  Level 2 West, Alice Hoy Building, University of Melbourne
>>  T: +61-(0)3-9035-8549
>>  E: philip.greenwood at unimelb.edu.au
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From uzzal at gist.ac.kr  Wed Feb  3 11:37:38 2016
From: uzzal at gist.ac.kr (Uzzal)
Date: Wed, 3 Feb 2016 19:37:38 +0900 (KST)
Subject: [R-sig-Geo] Is there any way to work with non-normal data for
	Ordinary kriging analysis without doing any kind of data
	transformation using gstat package?
Message-ID: <853538828.1454495858215.JavaMail.root@eunhasu>

I have a dataset contains hourly PM10 concentrations for 90 days of 83 sites. My data is not in normal distribution. But I don't want to log-transfer or any other transfer of this data for variogram plotiing as well as ordinary kriging analysis.  Is there any way to deal with non-normal data for kriging analysis in stead of log or any transformation in gstat? If I use 'cressie = TRUE' in 'variogram' functionin gstat in case of working with non-normal data then is it equvalent to work with the data with normal distribution? code :library(gstat)
seoul050506_varcressie = TRUE) Orpheus
  




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160203/7402d423/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bannerBottom.gif
Type: image/gif
Size: 21674 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160203/7402d423/attachment.gif>

From francescoperugini07 at gmail.com  Wed Feb  3 15:08:07 2016
From: francescoperugini07 at gmail.com (Francesco Perugini)
Date: Wed, 3 Feb 2016 15:08:07 +0100
Subject: [R-sig-Geo] globalG.test - plotting from routine
Message-ID: <CAEG8zh5wwYTygiQBnwyT72f-aWdNurUCmTnnD_56x1gwhEvSmA@mail.gmail.com>

Dear all,
I've a routine (see below) that computes the Global G statistics for
different k-neighbor spatial matrix and for different variables.
Now I want to plot (for each var) the difference between Global G statistic
computed at k neighbour with the one computed at k-1 on the y-axes, with
the number of k on the x-axis.
I guess I need to extract the Global G statistics from the ZG lists and
then plot them.This is my attempt:

library(rlist)
list(ZG)
list.extract(ZG,'var$estimate[1]')

plot(c(var$estimate[1], border="grey60",xlab="k",ylab="Global G statistic",
     xlim=NULL, axes=TRUE)
title(main="Global G at different k")

Any suggestion on this?
Thanks a lot.
franc.per

_____________
this is the routine:

library(spdep)
example(columbus)
coord <- coordinates(columbus)

z <- c(1,2,3,4,5,6,7,8,9)
neighbors.knn <- list()

for (val in z)
  {
  neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
longlat=F), sym=F)))
}

ndists <- length(z)
ZG <- vector(mode="list", length=ndists)
names(ZG) <- as.character(z)

f <- c("CRIME", "INC")
for (val in z)
              {
   dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
   temp <- list()

for (var in f)
              {
   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
zero.policy=F)))
              }
ZG[[val]] <- temp
              }

t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
                                                var$statistic,
p.value=unname(var$p.value))))

t(sapply(lapply(ZG, "[[", 2), function(var) c(var$estimate[1],
                                              var$statistic,
p.value=unname(var$p.value))))

	[[alternative HTML version deleted]]


From mauricio.zambrano at ufrontera.cl  Wed Feb  3 15:26:05 2016
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Wed, 3 Feb 2016 11:26:05 -0300
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
	netcdf4 (PERSIANN-CDR)
Message-ID: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>

Dear spatial community,

While reading some netCDFfiles with the raster package , I got a
"rotated" file, where the columns where read as rows and vice versa:

------------- START ----------------
x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
Loading required namespace: ncdf4
plot(x)
x
class       : RasterLayer
dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
resolution  : 0.25, 0.25  (x, y)
extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
coord. ref. : NA
data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
names       : NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
z-value     : 2009-01-01
zvar        : precipitation
------------- END ----------------

The previous summary shows that the spatial extent of the file is
60W-60E and 0-360N, while the correct extent should be: 60S, 60N, 0E,
360E.

The file can be downloaded from:
ftp://data.ncdc.noaa.gov/cdr/persiann/files/2009/PERSIANN-CDR_v01r01_20090101_c20140523.nc


After contacting the providers of the file, they mentioned that when
reading the file I have to provide the dimension information, i.e.,
480 rows and 1440 columns, while the raster package detects the other
way around.

I would highly appreciate if you could tell me:

1) is the previous situation a bug of my netCDF driver (netCDF 4.1.3,
GDAL 1.11.2, released 2015/02/10) or a problem of the dimensions
actually recorded in the netCDF file ?

2) is there any way to  overwrite the dimensions detected by netcdf4
when reading the file with the 'raster' command ?


My sessionInfo():
R version 3.2.3 (2015-12-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.2 LTS

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_GB.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

other attached packages:
[1] raster_2.5-2 sp_1.2-1

loaded via a namespace (and not attached):
[1] tools_3.2.3     Rcpp_0.12.3     ncdf4_1.15      grid_3.2.3
[5] lattice_0.20-33


Thanks in advance and kind regards

Mauricio Zambrano-Bigiarini, PhD

=====================================
Dept. of Civil Engineering
Faculty of Engineering and Sciences
Universidad de La Frontera
PO Box 54-D, Temuco, Chile
http://ingenieriacivil.ufro.cl/
=====================================
mailto     : mauricio.zambrano at ufrontera.cl
work-phone : +56 45 259 2812
=====================================
"In the end, it's not the years in your life that count.
 It's the life in your years". (Abraham Lincoln)
=====================================
Linux user #454569 -- Linux Mint user

-- 
La informaci?n contenida en este correo electr?nico y cualquier anexo o 
respuesta relacionada, puede contener datos e informaci?n confidencial y no 
puede ser usada o difundida por personas distintas a su(s) destinatario(s). 
Si usted no es el destinatario de esta comunicaci?n, le informamos que 
cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye 
un delito conforme a la ley chilena. Si lo ha recibido por error, por favor 
borre el mensaje y todos sus anexos y notifique al remitente.


From mdsumner at gmail.com  Wed Feb  3 15:34:03 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 03 Feb 2016 14:34:03 +0000
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
 netcdf4 (PERSIANN-CDR)
In-Reply-To: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
References: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
Message-ID: <CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>

On Thu, 4 Feb 2016 at 01:26 MAURICIO ZAMBRANO BIGIARINI <
mauricio.zambrano at ufrontera.cl> wrote:

> Dear spatial community,
>
> While reading some netCDFfiles with the raster package , I got a
> "rotated" file, where the columns where read as rows and vice versa:
>
> ------------- START ----------------
> x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
> Loading required namespace: ncdf4
> plot(x)
> x
> class       : RasterLayer
> dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
> resolution  : 0.25, 0.25  (x, y)
> extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
> coord. ref. : NA
> data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
> names       : NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
> z-value     : 2009-01-01
> zvar        : precipitation
> ------------- END ----------------
>
>
Transpose might be sufficient?

tx <- t(x)

plot(tx)
tx

HTH


The previous summary shows that the spatial extent of the file is
> 60W-60E and 0-360N, while the correct extent should be: 60S, 60N, 0E,
> 360E.
>
> The file can be downloaded from:
>
> ftp://data.ncdc.noaa.gov/cdr/persiann/files/2009/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>
>
> After contacting the providers of the file, they mentioned that when
> reading the file I have to provide the dimension information, i.e.,
> 480 rows and 1440 columns, while the raster package detects the other
> way around.
>
> I would highly appreciate if you could tell me:
>
> 1) is the previous situation a bug of my netCDF driver (netCDF 4.1.3,
> GDAL 1.11.2, released 2015/02/10) or a problem of the dimensions
> actually recorded in the netCDF file ?
>
> 2) is there any way to  overwrite the dimensions detected by netcdf4
> when reading the file with the 'raster' command ?
>
>
> My sessionInfo():
> R version 3.2.3 (2015-12-10)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.2 LTS
>
> locale:
>  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
>  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_GB.UTF-8
>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods   base
>
> other attached packages:
> [1] raster_2.5-2 sp_1.2-1
>
> loaded via a namespace (and not attached):
> [1] tools_3.2.3     Rcpp_0.12.3     ncdf4_1.15      grid_3.2.3
> [5] lattice_0.20-33
>
>
> Thanks in advance and kind regards
>
> Mauricio Zambrano-Bigiarini, PhD
>
> =====================================
> Dept. of Civil Engineering
> Faculty of Engineering and Sciences
> Universidad de La Frontera
> PO Box 54-D, Temuco, Chile
> http://ingenieriacivil.ufro.cl/
> =====================================
> mailto     : mauricio.zambrano at ufrontera.cl
> work-phone : +56 45 259 2812
> =====================================
> "In the end, it's not the years in your life that count.
>  It's the life in your years". (Abraham Lincoln)
> =====================================
> Linux user #454569 -- Linux Mint user
>
> --
> La informaci?n contenida en este correo electr?nico y cualquier anexo o
> respuesta relacionada, puede contener datos e informaci?n confidencial y no
> puede ser usada o difundida por personas distintas a su(s) destinatario(s).
> Si usted no es el destinatario de esta comunicaci?n, le informamos que
> cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye
> un delito conforme a la ley chilena. Si lo ha recibido por error, por favor
> borre el mensaje y todos sus anexos y notifique al remitente.
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Wed Feb  3 15:34:28 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Wed, 3 Feb 2016 15:34:28 +0100
Subject: [R-sig-Geo] globalG.test - plotting from routine
In-Reply-To: <CAEG8zh5wwYTygiQBnwyT72f-aWdNurUCmTnnD_56x1gwhEvSmA@mail.gmail.com>
References: <CAEG8zh5wwYTygiQBnwyT72f-aWdNurUCmTnnD_56x1gwhEvSmA@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602031533010.30322@reclus.nhh.no>

On Wed, 3 Feb 2016, Francesco Perugini wrote:

> Dear all,
> I've a routine (see below) that computes the Global G statistics for
> different k-neighbor spatial matrix and for different variables.
> Now I want to plot (for each var) the difference between Global G statistic
> computed at k neighbour with the one computed at k-1 on the y-axes, with
> the number of k on the x-axis.
> I guess I need to extract the Global G statistics from the ZG lists and
> then plot them.This is my attempt:
>
> library(rlist)
> list(ZG)
> list.extract(ZG,'var$estimate[1]')
>
> plot(c(var$estimate[1], border="grey60",xlab="k",ylab="Global G statistic",
>     xlim=NULL, axes=TRUE)
> title(main="Global G at different k")

This works for me, using the tabular results I showed you how to get in my 
previous reply:

> crime <- t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
   var$statistic, p.value=unname(var$p.value))))
> plot(z, crime[,1],xlab="k",ylab="Global G statistic", xlim=NULL,
   axes=TRUE)

The increase looks almost linear.

Roger

>
> Any suggestion on this?
> Thanks a lot.
> franc.per
>
> _____________
> this is the routine:
>
> library(spdep)
> example(columbus)
> coord <- coordinates(columbus)
>
> z <- c(1,2,3,4,5,6,7,8,9)
> neighbors.knn <- list()
>
> for (val in z)
>  {
>  neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
> longlat=F), sym=F)))
> }
>
> ndists <- length(z)
> ZG <- vector(mode="list", length=ndists)
> names(ZG) <- as.character(z)
>
> f <- c("CRIME", "INC")
> for (val in z)
>              {
>   dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
>   temp <- list()
>
> for (var in f)
>              {
>   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
> zero.policy=F)))
>              }
> ZG[[val]] <- temp
>              }
>
> t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>                                                var$statistic,
> p.value=unname(var$p.value))))
>
> t(sapply(lapply(ZG, "[[", 2), function(var) c(var$estimate[1],
>                                              var$statistic,
> p.value=unname(var$p.value))))
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From mauricio.zambrano at ufrontera.cl  Wed Feb  3 16:20:36 2016
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Wed, 3 Feb 2016 12:20:36 -0300
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
 netcdf4 (PERSIANN-CDR)
In-Reply-To: <CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>
References: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
	<CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>
Message-ID: <CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>

On 3 February 2016 at 11:34, Michael Sumner <mdsumner at gmail.com> wrote:
>
>
> On Thu, 4 Feb 2016 at 01:26 MAURICIO ZAMBRANO BIGIARINI
> <mauricio.zambrano at ufrontera.cl> wrote:
>>
>> Dear spatial community,
>>
>> While reading some netCDFfiles with the raster package , I got a
>> "rotated" file, where the columns where read as rows and vice versa:
>>
>> ------------- START ----------------
>> x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
>> Loading required namespace: ncdf4
>> plot(x)
>> x
>> class       : RasterLayer
>> dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
>> resolution  : 0.25, 0.25  (x, y)
>> extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
>> coord. ref. : NA
>> data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>> names       : NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
>> z-value     : 2009-01-01
>> zvar        : precipitation
>> ------------- END ----------------
>>
>
> Transpose might be sufficient?
>
> tx <- t(x)
>
> plot(tx)
> tx


Thanks Michale,

In fact, that is what I'm doing for reading the files, and the spatial
extent is correct and the precipitation values also seems to be right.

However, my question was more "conceptual", in the sense that the
provider says that the original file is NOT rotated, while the only
way  I have to get the correct files is rotating the original file
with the 't' command you mentioned.

In addition, while reading the file with the latest version of GRASS
GIS (7.0.3), and I got the following error message:

"
(Tue Feb  2 19:41:29 2016)
r.in.gdal input=/home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
output=PERSIANN_CDR_v01r01_20090101_c20140523 -e
Warning 1: dimension #2 (lat) is not a Longitude/X
dimension.
Warning 1: dimension #1 (lon) is not a Latitude/Y dimension.
ERROR: Input raster map is flipped or rotated - cannot import. You may
use 'gdalwarp' to transform the map to North-up.
"


So, I'm quite sure that the original file IS rotated, but I didn't
have more technical arguments to give to the data provider to
demonstrate that the file is rotated, because they insist that the
rotation is because R is not reading the file in the proper way....

mzb

=====================================
"In the end, it's not the years in your life that count.
 It's the life in your years". (Abraham Lincoln)
=====================================
Linux user #454569 -- Linux Mint user

>> 60W-60E and 0-360N, while the correct extent should be: 60S, 60N, 0E,
>> 360E.
>>
>> The file can be downloaded from:
>>
>> ftp://data.ncdc.noaa.gov/cdr/persiann/files/2009/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>>
>>
>> After contacting the providers of the file, they mentioned that when
>> reading the file I have to provide the dimension information, i.e.,
>> 480 rows and 1440 columns, while the raster package detects the other
>> way around.
>>
>> I would highly appreciate if you could tell me:
>>
>> 1) is the previous situation a bug of my netCDF driver (netCDF 4.1.3,
>> GDAL 1.11.2, released 2015/02/10) or a problem of the dimensions
>> actually recorded in the netCDF file ?
>>
>> 2) is there any way to  overwrite the dimensions detected by netcdf4
>> when reading the file with the 'raster' command ?
>>
>>
>> My sessionInfo():
>> R version 3.2.3 (2015-12-10)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 14.04.2 LTS
>>
>> locale:
>>  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
>>  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
>>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_GB.UTF-8
>>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>
>> other attached packages:
>> [1] raster_2.5-2 sp_1.2-1
>>
>> loaded via a namespace (and not attached):
>> [1] tools_3.2.3     Rcpp_0.12.3     ncdf4_1.15      grid_3.2.3
>> [5] lattice_0.20-33
>>
>>
>> Thanks in advance and kind regards
>>
>> Mauricio Zambrano-Bigiarini, PhD
>>
>> =====================================
>> Dept. of Civil Engineering
>> Faculty of Engineering and Sciences
>> Universidad de La Frontera
>> PO Box 54-D, Temuco, Chile
>> http://ingenieriacivil.ufro.cl/
>> =====================================
>> mailto     : mauricio.zambrano at ufrontera.cl
>> work-phone : +56 45 259 2812
>> =====================================
>> "In the end, it's not the years in your life that count.
>>  It's the life in your years". (Abraham Lincoln)
>> =====================================
>> Linux user #454569 -- Linux Mint user
>>
>> --
>> La informaci?n contenida en este correo electr?nico y cualquier anexo o
>> respuesta relacionada, puede contener datos e informaci?n confidencial y
>> no
>> puede ser usada o difundida por personas distintas a su(s)
>> destinatario(s).
>> Si usted no es el destinatario de esta comunicaci?n, le informamos que
>> cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye
>> un delito conforme a la ley chilena. Si lo ha recibido por error, por
>> favor
>> borre el mensaje y todos sus anexos y notifique al remitente.
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>

-- 
La informaci?n contenida en este correo electr?nico y cualquier anexo o 
respuesta relacionada, puede contener datos e informaci?n confidencial y no 
puede ser usada o difundida por personas distintas a su(s) destinatario(s). 
Si usted no es el destinatario de esta comunicaci?n, le informamos que 
cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye 
un delito conforme a la ley chilena. Si lo ha recibido por error, por favor 
borre el mensaje y todos sus anexos y notifique al remitente.


From mdsumner at gmail.com  Wed Feb  3 16:56:08 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 03 Feb 2016 15:56:08 +0000
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
 netcdf4 (PERSIANN-CDR)
In-Reply-To: <CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>
References: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
	<CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>
	<CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>
Message-ID: <CAAcGz983W3J8XHygJMEz1OpSbPuCePhNLJ+NvApv7F2=py49BQ@mail.gmail.com>

On Thu, 4 Feb 2016 at 02:20 MAURICIO ZAMBRANO BIGIARINI <
mauricio.zambrano at ufrontera.cl> wrote:

> On 3 February 2016 at 11:34, Michael Sumner <mdsumner at gmail.com> wrote:
> >
> >
> > On Thu, 4 Feb 2016 at 01:26 MAURICIO ZAMBRANO BIGIARINI
> > <mauricio.zambrano at ufrontera.cl> wrote:
> >>
> >> Dear spatial community,
> >>
> >> While reading some netCDFfiles with the raster package , I got a
> >> "rotated" file, where the columns where read as rows and vice versa:
> >>
> >> ------------- START ----------------
> >> x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
> >> Loading required namespace: ncdf4
> >> plot(x)
> >> x
> >> class       : RasterLayer
> >> dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
> >> resolution  : 0.25, 0.25  (x, y)
> >> extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
> >> coord. ref. : NA
> >> data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
> >> names       :
> NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
> >> z-value     : 2009-01-01
> >> zvar        : precipitation
> >> ------------- END ----------------
> >>
> >
> > Transpose might be sufficient?
> >
> > tx <- t(x)
> >
> > plot(tx)
> > tx
>
>
> Thanks Michale,
>
> In fact, that is what I'm doing for reading the files, and the spatial
> extent is correct and the precipitation values also seems to be right.
>
> However, my question was more "conceptual", in the sense that the
> provider says that the original file is NOT rotated, while the only
> way  I have to get the correct files is rotating the original file
> with the 't' command you mentioned.
>
>
In addition, while reading the file with the latest version of GRASS
> GIS (7.0.3), and I got the following error message:
>
> "
> (Tue Feb  2 19:41:29 2016)
> r.in.gdal input=/home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
> output=PERSIANN_CDR_v01r01_20090101_c20140523 -e
> Warning 1: dimension #2 (lat) is not a Longitude/X
> dimension.
> Warning 1: dimension #1 (lon) is not a Latitude/Y dimension.
> ERROR: Input raster map is flipped or rotated - cannot import. You may
> use 'gdalwarp' to transform the map to North-up.
> "
>
>
> So, I'm quite sure that the original file IS rotated, but I didn't
> have more technical arguments to give to the data provider to
> demonstrate that the file is rotated, because they insist that the
> rotation is because R is not reading the file in the proper way....
>
>

I wouldn't bother with the conversation if I were you. Just get your
toolkit in order and make sure you know what it's doing and why.  If you
explore their tools you might quickly understand why they're so adamant,
but it's not worth the time IMO.

library(fortunes)
fortune("illogical")

If there's a predictable pattern in the file you might explore a patch for
raster to auto-detect and handle it? I'd be happy to do that - if you
provide the data and as much information about it and its kind as you can
find.  If you want to know more I would start with ncdf4 directly, so you
see what raster has to do down there.

BTW, there's nothing strange about the way raster handles this in general,
if you peek under the hood in many software packages they all have the same
zoo of exceptions and special cases. NetCDF is incredibly general and that
flexibility gets pretty thoroughly abused. I have no patience for talk of
standards and conventions when it comes to this format, the data that
floods in just has to be dealt with, and that means your toolkit is full of
special cases (raster the details exceptionally well for its portion of
file variants).

Cheers, Mike.


> mzb
>
> =====================================
> "In the end, it's not the years in your life that count.
>  It's the life in your years". (Abraham Lincoln)
> =====================================
> Linux user #454569 -- Linux Mint user
>
> >> 60W-60E and 0-360N, while the correct extent should be: 60S, 60N, 0E,
> >> 360E.
> >>
> >> The file can be downloaded from:
> >>
> >>
> ftp://data.ncdc.noaa.gov/cdr/persiann/files/2009/PERSIANN-CDR_v01r01_20090101_c20140523.nc
> >>
> >>
> >> After contacting the providers of the file, they mentioned that when
> >> reading the file I have to provide the dimension information, i.e.,
> >> 480 rows and 1440 columns, while the raster package detects the other
> >> way around.
> >>
> >> I would highly appreciate if you could tell me:
> >>
> >> 1) is the previous situation a bug of my netCDF driver (netCDF 4.1.3,
> >> GDAL 1.11.2, released 2015/02/10) or a problem of the dimensions
> >> actually recorded in the netCDF file ?
> >>
> >> 2) is there any way to  overwrite the dimensions detected by netcdf4
> >> when reading the file with the 'raster' command ?
> >>
> >>
> >> My sessionInfo():
> >> R version 3.2.3 (2015-12-10)
> >> Platform: x86_64-pc-linux-gnu (64-bit)
> >> Running under: Ubuntu 14.04.2 LTS
> >>
> >> locale:
> >>  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
> >>  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
> >>  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_GB.UTF-8
> >>  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
> >>  [9] LC_ADDRESS=C               LC_TELEPHONE=C
> >> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
> >>
> >> attached base packages:
> >> [1] stats     graphics  grDevices utils     datasets  methods   base
> >>
> >> other attached packages:
> >> [1] raster_2.5-2 sp_1.2-1
> >>
> >> loaded via a namespace (and not attached):
> >> [1] tools_3.2.3     Rcpp_0.12.3     ncdf4_1.15      grid_3.2.3
> >> [5] lattice_0.20-33
> >>
> >>
> >> Thanks in advance and kind regards
> >>
> >> Mauricio Zambrano-Bigiarini, PhD
> >>
> >> =====================================
> >> Dept. of Civil Engineering
> >> Faculty of Engineering and Sciences
> >> Universidad de La Frontera
> >> PO Box 54-D, Temuco, Chile
> >> http://ingenieriacivil.ufro.cl/
> >> =====================================
> >> mailto     : mauricio.zambrano at ufrontera.cl
> >> work-phone : +56 45 259 2812
> >> =====================================
> >> "In the end, it's not the years in your life that count.
> >>  It's the life in your years". (Abraham Lincoln)
> >> =====================================
> >> Linux user #454569 -- Linux Mint user
> >>
> >> --
> >> La informaci?n contenida en este correo electr?nico y cualquier anexo o
> >> respuesta relacionada, puede contener datos e informaci?n confidencial y
> >> no
> >> puede ser usada o difundida por personas distintas a su(s)
> >> destinatario(s).
> >> Si usted no es el destinatario de esta comunicaci?n, le informamos que
> >> cualquier divulgaci?n, distribuci?n o copia de esta informaci?n
> constituye
> >> un delito conforme a la ley chilena. Si lo ha recibido por error, por
> >> favor
> >> borre el mensaje y todos sus anexos y notifique al remitente.
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > Dr. Michael Sumner
> > Software and Database Engineer
> > Australian Antarctic Division
> > 203 Channel Highway
> > Kingston Tasmania 7050 Australia
> >
>
> --
> La informaci?n contenida en este correo electr?nico y cualquier anexo o
> respuesta relacionada, puede contener datos e informaci?n confidencial y no
> puede ser usada o difundida por personas distintas a su(s) destinatario(s).
> Si usted no es el destinatario de esta comunicaci?n, le informamos que
> cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye
> un delito conforme a la ley chilena. Si lo ha recibido por error, por favor
> borre el mensaje y todos sus anexos y notifique al remitente.
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Wed Feb  3 17:01:21 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Wed, 3 Feb 2016 17:01:21 +0100
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
 netcdf4 (PERSIANN-CDR)
In-Reply-To: <CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>
References: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
	<CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>
	<CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>
Message-ID: <56B22451.8090505@uni-marburg.de>

If you look at the file with ncview and analyse the header with ncdump - 
h you will find that en extent is missing.
The standard tool ncview shows also a "flipped version"

Try to use gdal more directly like this snippet

library(raster)
library(gdalUtils)
library(mapview)

# necessary because of nc file see configuration options 
http://www.gdal.org/frmt_netcdf.html
Sys.setenv(GDAL_NETCDF_BOTTOMUP="NO")
extentNC <- extent(0, 360,-60, 60)
proj4str <- '+proj=longlat +datum=WGS84 +no_defs'
ncfilename <- "PERSIANN-CDR_v01r01_20090101_c20140523.nc"
dataset<- "precipitation"
band <-1

x<-gdal_translate(paste0("NETCDF:",ncfilename,":",dataset), 
paste0(ncfilename,".tif"),
                b=band,
                of="GTiff",
                output_Raster=TRUE,
                verbose=TRUE,
                overwrite=TRUE)
# due to GDAL_NETCDF_BOTTOMUP="NO" we have to flip the raster
x <- flip(x, direction='y')
extent(x) <- extentNC
projection(x) <- proj4str

mapview(x)
plot(x)


cheers Chris


Am 03.02.2016 um 16:20 schrieb MAURICIO ZAMBRANO BIGIARINI:
> On 3 February 2016 at 11:34, Michael Sumner <mdsumner at gmail.com> wrote:
>>
>> On Thu, 4 Feb 2016 at 01:26 MAURICIO ZAMBRANO BIGIARINI
>> <mauricio.zambrano at ufrontera.cl> wrote:
>>> Dear spatial community,
>>>
>>> While reading some netCDFfiles with the raster package , I got a
>>> "rotated" file, where the columns where read as rows and vice versa:
>>>
>>> ------------- START ----------------
>>> x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
>>> Loading required namespace: ncdf4
>>> plot(x)
>>> x
>>> class       : RasterLayer
>>> dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
>>> resolution  : 0.25, 0.25  (x, y)
>>> extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
>>> coord. ref. : NA
>>> data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>>> names       : NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
>>> z-value     : 2009-01-01
>>> zvar        : precipitation
>>> ------------- END ----------------
>>>
>> Transpose might be sufficient?
>>
>> tx <- t(x)
>>
>> plot(tx)
>> tx
>
> Thanks Michale,
>
> In fact, that is what I'm doing for reading the files, and the spatial
> extent is correct and the precipitation values also seems to be right.
>
> However, my question was more "conceptual", in the sense that the
> provider says that the original file is NOT rotated, while the only
> way  I have to get the correct files is rotating the original file
> with the 't' command you mentioned.
>
> In addition, while reading the file with the latest version of GRASS
> GIS (7.0.3), and I got the following error message:
>
> "
> (Tue Feb  2 19:41:29 2016)
> r.in.gdal input=/home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
> output=PERSIANN_CDR_v01r01_20090101_c20140523 -e
> Warning 1: dimension #2 (lat) is not a Longitude/X
> dimension.
> Warning 1: dimension #1 (lon) is not a Latitude/Y dimension.
> ERROR: Input raster map is flipped or rotated - cannot import. You may
> use 'gdalwarp' to transform the map to North-up.
> "
>
>
> So, I'm quite sure that the original file IS rotated, but I didn't
> have more technical arguments to give to the data provider to
> demonstrate that the file is rotated, because they insist that the
> rotation is because R is not reading the file in the proper way....
>
> mzb
>
> =====================================
> "In the end, it's not the years in your life that count.
>   It's the life in your years". (Abraham Lincoln)
> =====================================
> Linux user #454569 -- Linux Mint user
>
>>> 60W-60E and 0-360N, while the correct extent should be: 60S, 60N, 0E,
>>> 360E.
>>>
>>> The file can be downloaded from:
>>>
>>> ftp://data.ncdc.noaa.gov/cdr/persiann/files/2009/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>>>
>>>
>>> After contacting the providers of the file, they mentioned that when
>>> reading the file I have to provide the dimension information, i.e.,
>>> 480 rows and 1440 columns, while the raster package detects the other
>>> way around.
>>>
>>> I would highly appreciate if you could tell me:
>>>
>>> 1) is the previous situation a bug of my netCDF driver (netCDF 4.1.3,
>>> GDAL 1.11.2, released 2015/02/10) or a problem of the dimensions
>>> actually recorded in the netCDF file ?
>>>
>>> 2) is there any way to  overwrite the dimensions detected by netcdf4
>>> when reading the file with the 'raster' command ?
>>>
>>>
>>> My sessionInfo():
>>> R version 3.2.3 (2015-12-10)
>>> Platform: x86_64-pc-linux-gnu (64-bit)
>>> Running under: Ubuntu 14.04.2 LTS
>>>
>>> locale:
>>>   [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C
>>>   [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8
>>>   [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_GB.UTF-8
>>>   [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
>>>   [9] LC_ADDRESS=C               LC_TELEPHONE=C
>>> [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C
>>>
>>> attached base packages:
>>> [1] stats     graphics  grDevices utils     datasets  methods   base
>>>
>>> other attached packages:
>>> [1] raster_2.5-2 sp_1.2-1
>>>
>>> loaded via a namespace (and not attached):
>>> [1] tools_3.2.3     Rcpp_0.12.3     ncdf4_1.15      grid_3.2.3
>>> [5] lattice_0.20-33
>>>
>>>
>>> Thanks in advance and kind regards
>>>
>>> Mauricio Zambrano-Bigiarini, PhD
>>>
>>> =====================================
>>> Dept. of Civil Engineering
>>> Faculty of Engineering and Sciences
>>> Universidad de La Frontera
>>> PO Box 54-D, Temuco, Chile
>>> http://ingenieriacivil.ufro.cl/
>>> =====================================
>>> mailto     : mauricio.zambrano at ufrontera.cl
>>> work-phone : +56 45 259 2812
>>> =====================================
>>> "In the end, it's not the years in your life that count.
>>>   It's the life in your years". (Abraham Lincoln)
>>> =====================================
>>> Linux user #454569 -- Linux Mint user
>>>
>>> --
>>> La informaci?n contenida en este correo electr?nico y cualquier anexo o
>>> respuesta relacionada, puede contener datos e informaci?n confidencial y
>>> no
>>> puede ser usada o difundida por personas distintas a su(s)
>>> destinatario(s).
>>> Si usted no es el destinatario de esta comunicaci?n, le informamos que
>>> cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye
>>> un delito conforme a la ley chilena. Si lo ha recibido por error, por
>>> favor
>>> borre el mensaje y todos sus anexos y notifique al remitente.
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>


From mauricio.zambrano at ufrontera.cl  Wed Feb  3 17:38:42 2016
From: mauricio.zambrano at ufrontera.cl (MAURICIO ZAMBRANO BIGIARINI)
Date: Wed, 3 Feb 2016 13:38:42 -0300
Subject: [R-sig-Geo] raster pkg: overwriting the dimensions detected by
 netcdf4 (PERSIANN-CDR)
In-Reply-To: <CAAcGz983W3J8XHygJMEz1OpSbPuCePhNLJ+NvApv7F2=py49BQ@mail.gmail.com>
References: <CAP6Varujhy8M9yqL9fk9dXBRue9Knm3T+y=-TXZCWQSzfF4r8A@mail.gmail.com>
	<CAAcGz99JHwAFACz_78L9c0LwQCDSCoBcC4aKBzZzfrYSpksfPw@mail.gmail.com>
	<CAP6Vartx7kr46RM7-0Md3pN9i97Y9D9LnoVtp5KFDFqYBARrng@mail.gmail.com>
	<CAAcGz983W3J8XHygJMEz1OpSbPuCePhNLJ+NvApv7F2=py49BQ@mail.gmail.com>
Message-ID: <CAP6Varsr6zn4kKGFYSf_xEgdvnLLuNE_gvT0uAhe+ifvFr0EoQ@mail.gmail.com>

On 3 February 2016 at 12:56, Michael Sumner <mdsumner at gmail.com> wrote:
>
>
> On Thu, 4 Feb 2016 at 02:20 MAURICIO ZAMBRANO BIGIARINI
> <mauricio.zambrano at ufrontera.cl> wrote:
>>
>> On 3 February 2016 at 11:34, Michael Sumner <mdsumner at gmail.com> wrote:
>> >
>> >
>> > On Thu, 4 Feb 2016 at 01:26 MAURICIO ZAMBRANO BIGIARINI
>> > <mauricio.zambrano at ufrontera.cl> wrote:
>> >>
>> >> Dear spatial community,
>> >>
>> >> While reading some netCDFfiles with the raster package , I got a
>> >> "rotated" file, where the columns where read as rows and vice versa:
>> >>
>> >> ------------- START ----------------
>> >> x <- raster("PERSIANN-CDR_v01r01_20090101_c20140523.nc")
>> >> Loading required namespace: ncdf4
>> >> plot(x)
>> >> x
>> >> class       : RasterLayer
>> >> dimensions  : 1440, 480, 691200  (nrow, ncol, ncell)
>> >> resolution  : 0.25, 0.25  (x, y)
>> >> extent      : -60, 60, 0, 360  (xmin, xmax, ymin, ymax)
>> >> coord. ref. : NA
>> >> data source : /home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>> >> names       :
>> >> NOAA.Climate.Data.Record.of.PERSIANN.CDR.daily.precipitation
>> >> z-value     : 2009-01-01
>> >> zvar        : precipitation
>> >> ------------- END ----------------
>> >>
>> >
>> > Transpose might be sufficient?
>> >
>> > tx <- t(x)
>> >
>> > plot(tx)
>> > tx
>>
>>
>> Thanks Michale,
>>
>> In fact, that is what I'm doing for reading the files, and the spatial
>> extent is correct and the precipitation values also seems to be right.
>>
>> However, my question was more "conceptual", in the sense that the
>> provider says that the original file is NOT rotated, while the only
>> way  I have to get the correct files is rotating the original file
>> with the 't' command you mentioned.
>>
>
>> In addition, while reading the file with the latest version of GRASS
>> GIS (7.0.3), and I got the following error message:
>>
>> "
>> (Tue Feb  2 19:41:29 2016)
>> r.in.gdal input=/home/hzambran/PERSIANN-CDR_v01r01_20090101_c20140523.nc
>> output=PERSIANN_CDR_v01r01_20090101_c20140523 -e
>> Warning 1: dimension #2 (lat) is not a Longitude/X
>> dimension.
>> Warning 1: dimension #1 (lon) is not a Latitude/Y dimension.
>> ERROR: Input raster map is flipped or rotated - cannot import. You may
>> use 'gdalwarp' to transform the map to North-up.
>> "
>>
>>
>> So, I'm quite sure that the original file IS rotated, but I didn't
>> have more technical arguments to give to the data provider to
>> demonstrate that the file is rotated, because they insist that the
>> rotation is because R is not reading the file in the proper way....
>>
>
>
> I wouldn't bother with the conversation if I were you. Just get your toolkit
> in order and make sure you know what it's doing and why.  If you explore
> their tools you might quickly understand why they're so adamant, but it's
> not worth the time IMO.

>
> library(fortunes)
> fortune("illogical")
>
> If there's a predictable pattern in the file you might explore a patch for
> raster to auto-detect and handle it? I'd be happy to do that - if you
> provide the data and as much information about it and its kind as you can
> find.  If you want to know more I would start with ncdf4 directly, so you
> see what raster has to do down there.


Thanks your very much Michael and Chris for your comments.

In fact, reading the file with gdal_translate I got a warning message
about the dimensions:

Checking gdal_installation...
Scanning for GDAL installations...
Checking Sys.which...
GDAL version 1.11.2
GDAL command being used: "/usr/bin/gdal_translate" -of "GTiff" -b "1"
"NETCDF:PERSIANN-CDR_v01r01_20090101_c20140523.nc:precipitation"
"PERSIANN-CDR_v01r01_20090101_c20140523.nc.tif"
Warning 1: dimension #2 (lat) is not a Longitude/X dimension.
Warning 1: dimension #1 (lon) is not a Latitude/Y dimension.


also, 'ncview' indicates that the Y variable corresponds to longitude,
going from 0.125 to 359.875, while the X variable corresponds to
latitude, with values going from 59.75 to -59.875.

However, 'ncdump -h ' shows that the attributes are correctly stored
within the file (but with no extent):

netcdf PERSIANN-CDR_v01r01_20090101_c20140523 {
dimensions:
time = 1 ;
lat = 480 ;
lon = 1440 ;
nv = 2 ;
variables:
int time(time) ;
time:standard_name = "time" ;
time:long_name = "time" ;
time:units = "days since 1979-01-01 0:0:0" ;
float lat(lat) ;
lat:standard_name = "latitude" ;
lat:long_name = "latitude" ;
lat:units = "degrees_north" ;
lat:valid_max = 60.f ;
lat:valid_min = -60.f ;
lat:bounds = "lat_bnds" ;
float lon(lon) ;
lon:standard_name = "longitude" ;
lon:long_name = "longitude" ;
lon:units = "degrees_east" ;
lon:valid_max = 360.f ;
lon:valid_min = 0.f ;
lon:bounds = "lon_bnds" ;


>
> BTW, there's nothing strange about the way raster handles this in general,
> if you peek under the hood in many software packages they all have the same
> zoo of exceptions and special cases. NetCDF is incredibly general and that
> flexibility gets pretty thoroughly abused. I have no patience for talk of
> standards and conventions when it comes to this format, the data that floods
> in just has to be dealt with, and that means your toolkit is full of special
> cases (raster the details exceptionally well for its portion of file
> variants).


Thanks for that comment (and the fortunes citation). In the end, I'll
continue rotating the file with 't' knowing that the contnet of the
file is actually rotated.

Kind regards,


Mauricio


=====================================
Dept. of Civil Engineering
Faculty of Engineering and Sciences
Universidad de La Frontera
PO Box 54-D, Temuco, Chile
http://ingenieriacivil.ufro.cl/
=====================================
mailto     : mauricio.zambrano at ufrontera.cl
work-phone : +56 45 259 2812
=====================================
"In the end, it's not the years in your life that count.
 It's the life in your years". (Abraham Lincoln)
=====================================
Linux user #454569 -- Linux Mint user

-- 
La informaci?n contenida en este correo electr?nico y cualquier anexo o 
respuesta relacionada, puede contener datos e informaci?n confidencial y no 
puede ser usada o difundida por personas distintas a su(s) destinatario(s). 
Si usted no es el destinatario de esta comunicaci?n, le informamos que 
cualquier divulgaci?n, distribuci?n o copia de esta informaci?n constituye 
un delito conforme a la ley chilena. Si lo ha recibido por error, por favor 
borre el mensaje y todos sus anexos y notifique al remitente.


From argantonio65 at gmail.com  Thu Feb  4 15:56:35 2016
From: argantonio65 at gmail.com (=?UTF-8?Q?Antonio_Manuel_Moreno_R=C3=B3denas?=)
Date: Thu, 4 Feb 2016 15:56:35 +0100
Subject: [R-sig-Geo] Ordinary kriging variance of the prediction with error
	structure
Message-ID: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>

Dear r-sig-geo community,

I would like to bring a conceptual question on the implementation of
ordinary kriging in gstat.

I'm trying to account for my measurement error in a OK scheme. I assume
that my sampled vector Y(x_i) is a noisy realisation of S(x_i) (the real
variable), thus:
Y(x_i) = S(x_i) + e_i, where e_i is ~N(0,tau^2).

If that error is assumed to follow a certain set of conditions (unbiased,
uncorrelated between itself/the variable and tau=constant), this is
analogous to the solution of the kriging system with a nugget effect in the
Covariance structure.

I coded the kriging system and its solution. In order to assess if my
implementation is correct I contrasted it with the krige function in gstat.
The predicted value at each point is the same, meaning that I got correctly
the weights of the system.

However, I'm really confused when dealing with the variance in the
prediction. Which should have this form:

Var(S(x_o) | Y) = Var(S(x_o)) - w' * C_oi - mu

w' weights vector
C_oi vector Covariance between predicted and sampled coordinates
mu lagrange multiplier

If my objective would be to predict the signal of the variable S(x_o), the
term of Var(S(x_o)) will correspond to the partial variance, (*the sill
without the nugget*). This is what I understood by following the notation
of Model-based Geostatistics from Peter J.Diggle, where it is explicitly
mentioned in (pag 137 (6.8)).

However, I only get agreement in my comparison with the krige (gstat)
variance results if I use the total sill as Var(S(x_o)) that is (partial
variance + nugget). So my question is:

I'am right by thinking that still Var(S(x_o)) should not include the nugget?
What is the outcome of krige in gstat when you consider a nugget? is it the
prediction of the signal? or is it the prediction of what you would measure
at that location?

Kind regards,

Antonio

	[[alternative HTML version deleted]]


From jecogeo at gmail.com  Thu Feb  4 16:14:21 2016
From: jecogeo at gmail.com (Jefferson Ferreira-Ferreira)
Date: Thu, 4 Feb 2016 11:14:21 -0400
Subject: [R-sig-Geo] Floods' Prediction Approach
Message-ID: <CAFFT+Y4j+dnxujm_0_0vmNPS01NXjE448A0d-HBQB55PiTSf2w@mail.gmail.com>

Hello everybody. I don't know exactly if this post could be considered an
off-topic, and sorry if so. I would like to exchange some ideas with you
all regarding a problem and, hopefully, someone is able to help.

I have a series of flood maps derived from remote sensing. Each map (13
maps) represent the flooded area in a specific water level height (with
binary values, 1=flooded / 0=not flooded) . I would like "predict" the
flooded areas in intermediate water level heights where we haven't maps,
thus trying to simulate the evolution of the flood inside the floodplain.

I used a pixel-by-pixel logistic regression approach, with the dependent
variable as the flood status (0 or 1) in each flood map and the independent
variable as the correspondent water stage height. It predicted quite well,
considering It's a very simple approach, giving the probabilities of a
given pixel to be flooded at all water stage values from the drought to the
maximum seasonal water level. But I'm getting significative errors yet
regarding my field observations (sensors monitoring the floods scattered in
my study area). I'm calculating the number of days per year some pixels
remains flooded (as I know the water levels on each day in a given year)
and I'm getting up to 120 days of difference between the predicted and
observed days of flood in a given pixel.

As I said before, It's a quite simple approach. I'm realizing that more
sofisticated techniques could perform better. I also have some other
variables to include, like a digital terrain model and rasters of daily
precipitation.

Has anyone some idea, some different approach (e.g. cokriging neural
networks) ? As I'm dealing with a categoric response variable I'm not sure
yet what is possible and what isn't. I'll continue my readings here and
trying to find some idea. But if someone has some time to think a little
bit and write a comment, it'll be very appreciated.

 Thank you all!
Best,

-- 

*Jefferson Ferreira-Ferreira*

Ge?grafo ? GEOPROCESSAMENTO IDSM | Coordenadoria de TI


Jefferson.ferreira at mamiraua.org.br

*Instituto de Desenvolvimento Sustent?vel Mamirau?*

Minist?rio da Ci?ncia, Tecnologia e Inova??o

Telefone: +55 97 3343-9710

*Google Maps* - Mapas deste e-mail:

Exibir mapa ampliado
<https://maps.google.com.br/maps?q=-3.355557,-64.731151&ll=-3.355471,-64.731145&spn=0.004632,0.006968&num=1&t=h&z=18>


*Contatos particulares:*
*(55) 9615-0100*

	[[alternative HTML version deleted]]


From madiazl at gmail.com  Thu Feb  4 17:07:02 2016
From: madiazl at gmail.com (Andres Diaz)
Date: Thu, 4 Feb 2016 17:07:02 +0100
Subject: [R-sig-Geo] Floods' Prediction Approach
In-Reply-To: <CAFFT+Y4j+dnxujm_0_0vmNPS01NXjE448A0d-HBQB55PiTSf2w@mail.gmail.com>
References: <CAFFT+Y4j+dnxujm_0_0vmNPS01NXjE448A0d-HBQB55PiTSf2w@mail.gmail.com>
Message-ID: <CAMXOh=2kZft5_9OhZhHiAjVxNHJSEwOEFUCHG7ENt8Ve2MFBBw@mail.gmail.com>

Dear Jefferson,

The flood prone area delimitation is a science which usually involve the
hydrology + hydraulic study (in rivers) and tidal + hydrodynamics
 simulation (in coastal zones). Your approximation is pretty interesting
and I will be glad to see some results from your analysis (because it seems
is a simple approach).

Nevertheless, other approach exist to simplifying the flood maps
delimitation through topographic indexes. Attached you will find some
references in which the flood prone area delimitation is done ONLY using a
DEM (Digital Elevation Model), and in that way you can avoid to make the
complete studies for obtain the maps.

https://www.researchgate.net/publication/280308186_Samela_C_Manfreda_S_Paola_F_Giugni_M_Sole_A_and_Fiorentino_M_2015_DEM-Based_Approaches_for_the_Delineation_of_Flood-Prone_Areas_in_an_Ungauged_Basin_in_Africa_J_Hydrol_Eng_101061ASCEHE1943-55840001272_06015010

https://www.researchgate.net/publication/279243744_Flood-prone_areas_assessment_using_linear_binary_classifiers_based_on_flood_maps_obtained_from_1D_and_2D_hydraulic_models
<http://www.gits.ws/exchweb/bin/redir.asp?URL=https://www.researchgate.net/publication/279243744_Flood-prone_areas_assessment_using_linear_binary_classifiers_based_on_flood_maps_obtained_from_1D_and_2D_hydraulic_models>

If you want to comment the topic, or have problems with the algorithms
implementation, do not hesitate to contact me.

Best,


Andr?s D?az
Postdoctoral Researcher
Institute for Environmental Studies - IVM
VU University Amsterdam
De Boelelaan 1085 (visiting address)
De Boelelaan 1087 (postal address)
1081 HV Amsterdam, The Netherlands
email: andres.diazloaiza at vu.nl
Office: A567
IVM - Because the Earth matters



2016-02-04 16:14 GMT+01:00 Jefferson Ferreira-Ferreira <jecogeo at gmail.com>:

> Hello everybody. I don't know exactly if this post could be considered an
> off-topic, and sorry if so. I would like to exchange some ideas with you
> all regarding a problem and, hopefully, someone is able to help.
>
> I have a series of flood maps derived from remote sensing. Each map (13
> maps) represent the flooded area in a specific water level height (with
> binary values, 1=flooded / 0=not flooded) . I would like "predict" the
> flooded areas in intermediate water level heights where we haven't maps,
> thus trying to simulate the evolution of the flood inside the floodplain.
>
> I used a pixel-by-pixel logistic regression approach, with the dependent
> variable as the flood status (0 or 1) in each flood map and the independent
> variable as the correspondent water stage height. It predicted quite well,
> considering It's a very simple approach, giving the probabilities of a
> given pixel to be flooded at all water stage values from the drought to the
> maximum seasonal water level. But I'm getting significative errors yet
> regarding my field observations (sensors monitoring the floods scattered in
> my study area). I'm calculating the number of days per year some pixels
> remains flooded (as I know the water levels on each day in a given year)
> and I'm getting up to 120 days of difference between the predicted and
> observed days of flood in a given pixel.
>
> As I said before, It's a quite simple approach. I'm realizing that more
> sofisticated techniques could perform better. I also have some other
> variables to include, like a digital terrain model and rasters of daily
> precipitation.
>
> Has anyone some idea, some different approach (e.g. cokriging neural
> networks) ? As I'm dealing with a categoric response variable I'm not sure
> yet what is possible and what isn't. I'll continue my readings here and
> trying to find some idea. But if someone has some time to think a little
> bit and write a comment, it'll be very appreciated.
>
>  Thank you all!
> Best,
>
> --
>
> *Jefferson Ferreira-Ferreira*
>
> Ge?grafo ? GEOPROCESSAMENTO IDSM | Coordenadoria de TI
>
>
> Jefferson.ferreira at mamiraua.org.br
>
> *Instituto de Desenvolvimento Sustent?vel Mamirau?*
>
> Minist?rio da Ci?ncia, Tecnologia e Inova??o
>
> Telefone: +55 97 3343-9710
>
> *Google Maps* - Mapas deste e-mail:
>
> Exibir mapa ampliado
> <
> https://maps.google.com.br/maps?q=-3.355557,-64.731151&ll=-3.355471,-64.731145&spn=0.004632,0.006968&num=1&t=h&z=18
> >
>
>
> *Contatos particulares:*
> *(55) 9615-0100*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From aolinto.lst at gmail.com  Thu Feb  4 17:49:59 2016
From: aolinto.lst at gmail.com (Antonio Silva)
Date: Thu, 4 Feb 2016 14:49:59 -0200
Subject: [R-sig-Geo] converting shapes to raster
Message-ID: <CAE8g1gMQ8gfQ-xG-b8BMvO_Zo6maMzRu53-MiXn4g-oxBN3VKQ@mail.gmail.com>

Dear list members



In order to run a niche overlap analysis with nicheOverlap (dismo package)
I need to convert some shapefiles to raster. I dropped a shapefile as
example at https://www.dropbox.com/s/g6o0vfdx7lr34ma/Species1Shape.rar?dl=0

Marine fish abundance data is aggregated in quadrants of 10 x 10 nautical
miles. As I have a coast line some quadrants are cut and also I have a
blank area (land area).

I tried many things like:

shp.frtcost <- readShapePoly("BL10_FRT_COSTEIRA.shp")

plot(shp.frtcost,axes=TRUE,xlim=c(-48,-45),border="grey")

text(coordinates(shp.frtcost),labels=as.character(shp.frtcost at data
$DENS),cex=0.7)

r <- raster(extent(shp.frtcost),nrows=10,ncols=15)

# or raster(extent(shp.frtcost),nrows=10,ncols=15,vals=shp.frtcost at data
$DENS)

r <- rasterize(shp.frtcost,r,fun="first")

plot(shp.frtcost,axes=TRUE,xlim=c(-48,-45),border="grey")

plot(r,add=TRUE)



Shape and raster don't overlay correctly and also I could not pass
densities values to raster.


Limits indicated at extent function do not indicate the limits of my grid.



Thanks for any help.



Best regards


Ant?nio Olinto ?vila da Silva
Instituto de Pesca (Fisheries Institute)
S?o Paulo, Brasil

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Feb  5 07:12:16 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 05 Feb 2016 06:12:16 +0000
Subject: [R-sig-Geo] converting shapes to raster
In-Reply-To: <CAE8g1gMQ8gfQ-xG-b8BMvO_Zo6maMzRu53-MiXn4g-oxBN3VKQ@mail.gmail.com>
References: <CAE8g1gMQ8gfQ-xG-b8BMvO_Zo6maMzRu53-MiXn4g-oxBN3VKQ@mail.gmail.com>
Message-ID: <CAAcGz9_JLo_u=4=7_edS-rZnfd65BLN-YTnDWMziWQqWaxdwYQ@mail.gmail.com>

On Fri, 5 Feb 2016 at 03:50 Antonio Silva <aolinto.lst at gmail.com> wrote:

> Dear list members
>
>
>
> In order to run a niche overlap analysis with nicheOverlap (dismo package)
> I need to convert some shapefiles to raster. I dropped a shapefile as
> example at
> https://www.dropbox.com/s/g6o0vfdx7lr34ma/Species1Shape.rar?dl=0
>
> Marine fish abundance data is aggregated in quadrants of 10 x 10 nautical
> miles. As I have a coast line some quadrants are cut and also I have a
> blank area (land area).
>
> I tried many things like:
>
> shp.frtcost <- readShapePoly("BL10_FRT_COSTEIRA.shp")
>
> plot(shp.frtcost,axes=TRUE,xlim=c(-48,-45),border="grey")
>
> text(coordinates(shp.frtcost),labels=as.character(shp.frtcost at data
> $DENS),cex=0.7)
>
> r <- raster(extent(shp.frtcost),nrows=10,ncols=15)
>
> # or raster(extent(shp.frtcost),nrows=10,ncols=15,vals=shp.frtcost at data
> $DENS)
>
> r <- rasterize(shp.frtcost,r,fun="first")
>
> plot(shp.frtcost,axes=TRUE,xlim=c(-48,-45),border="grey")
>
> plot(r,add=TRUE)
>
>
I can' reproduce the problem? I did this, slightly simpler:

library(raster)

## if you have rgdal available
shp.frtcost <- shapefile("BL10_FRT_COSTEIRA.shp")

## no dropping of projection metadata
r <- raster(shp.frtcost,nrows=10,ncols=15)

r <- rasterize(shp.frtcost,r,fun="first")
plot(shp.frtcost,axes=TRUE,xlim=c(-48,-45),border="grey")
plot(r,add=TRUE)



HTH



>
>
> Shape and raster don't overlay correctly and also I could not pass
> densities values to raster.
>
>
> Limits indicated at extent function do not indicate the limits of my grid.
>
>
>
> Thanks for any help.
>
>
>
> Best regards
>
>
> Ant?nio Olinto ?vila da Silva
> Instituto de Pesca (Fisheries Institute)
> S?o Paulo, Brasil
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From francescoperugini07 at gmail.com  Fri Feb  5 10:03:36 2016
From: francescoperugini07 at gmail.com (Francesco Perugini)
Date: Fri, 5 Feb 2016 10:03:36 +0100
Subject: [R-sig-Geo] globalG.test - routine with distance based neighbours
Message-ID: <CAEG8zh4Ju1jaOHfCgeWcN=VydEQ_y6GSmxRQj152xivZ7adP2A@mail.gmail.com>

Dear all,
I've routine that plot Glogal G statistics at different k-neighbours. I've
tried to run it using distance based neighbours method but I got this
message:

Error in dnb[[val]] : subscript out of bounds

Any suggestion on this?

Thanks a lot.

franc.per

_______________

this is the routine

library(spdep)
example(columbus)
coord <- coordinates(columbus)

#k-nearest neighbours
#z <- c(1:20)
#neighbors.knn <- list()


#Distance-based neighbours
k1 <- knn2nb(knearneigh(coord,k=1,longlat=F))
all.linkedT <- max(unlist(nbdists(k1, coord,longlat=F)))
all.linkedT

z <- c(620, 650, 700)
dnb <- list()
for (val in z)
  {
  dnb <- c(dnb, list(dnearneigh(coord, 0, val, longlat=F)))
# neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
longlat=F), sym=F)))
  }
list(dnb)


ndists <- length(z)
ZG <- vector(mode="list", length=ndists)
names(ZG) <- as.character(z)

f <- c("CRIME", "INC")
for (val in z)
  {
# dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
  dlwdnb.B <- nb2listw(dnb[[val]], style="B", zero.policy=TRUE)
  temp <- list()

  for (var in f)
  {
#   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
zero.policy=F)))
    temp <- c(temp, list(globalG.test(columbus[[var]], dlwdnb.B,
zero.policy=F)))
  }
  ZG[[val]] <- temp
}

t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
                                      var$statistic,
p.value=unname(var$p.value))))
CRIME <- t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
                                      var$statistic,
p.value=unname(var$p.value))))
plot(z, CRIME[,1], xlab="distance", ylab="Global G", xlim=NULL,
axes=TRUE, type="o", col="blue")

	[[alternative HTML version deleted]]


From rubenfcasal at gmail.com  Fri Feb  5 10:56:40 2016
From: rubenfcasal at gmail.com (rubenfcasal)
Date: Fri, 5 Feb 2016 10:56:40 +0100
Subject: [R-sig-Geo] Ordinary kriging variance of the prediction with
 error structure
In-Reply-To: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>
References: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>
Message-ID: <56B471D8.40208@gmail.com>

Kriging the noiseless version of Y is not ?the solution of the 
(standard) kriging system with a nugget effect in the Covariance 
structure? (the semivariances/variogram at lag 0 may not be zero).
See e.g. Cressie, 1993, p. 128 (for instance, eq. 3.2.27 shows the 
correct expression of the kriging variance).

Best regards, Ruben.

El 04/02/2016 a las 15:56, Antonio Manuel Moreno R?denas escribi?:
> Dear r-sig-geo community,
>
> I would like to bring a conceptual question on the implementation of
> ordinary kriging in gstat.
>
> I'm trying to account for my measurement error in a OK scheme. I assume
> that my sampled vector Y(x_i) is a noisy realisation of S(x_i) (the real
> variable), thus:
> Y(x_i) = S(x_i) + e_i, where e_i is ~N(0,tau^2).
>
> If that error is assumed to follow a certain set of conditions (unbiased,
> uncorrelated between itself/the variable and tau=constant), this is
> analogous to the solution of the kriging system with a nugget effect in the
> Covariance structure.
>
> I coded the kriging system and its solution. In order to assess if my
> implementation is correct I contrasted it with the krige function in gstat.
> The predicted value at each point is the same, meaning that I got correctly
> the weights of the system.
>
> However, I'm really confused when dealing with the variance in the
> prediction. Which should have this form:
>
> Var(S(x_o) | Y) = Var(S(x_o)) - w' * C_oi - mu
>
> w' weights vector
> C_oi vector Covariance between predicted and sampled coordinates
> mu lagrange multiplier
>
> If my objective would be to predict the signal of the variable S(x_o), the
> term of Var(S(x_o)) will correspond to the partial variance, (*the sill
> without the nugget*). This is what I understood by following the notation
> of Model-based Geostatistics from Peter J.Diggle, where it is explicitly
> mentioned in (pag 137 (6.8)).
>
> However, I only get agreement in my comparison with the krige (gstat)
> variance results if I use the total sill as Var(S(x_o)) that is (partial
> variance + nugget). So my question is:
>
> I'am right by thinking that still Var(S(x_o)) should not include the nugget?
> What is the outcome of krige in gstat when you consider a nugget? is it the
> prediction of the signal? or is it the prediction of what you would measure
> at that location?
>
> Kind regards,
>
> Antonio
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


	[[alternative HTML version deleted]]


From argantonio65 at gmail.com  Fri Feb  5 11:48:40 2016
From: argantonio65 at gmail.com (=?UTF-8?Q?Antonio_Manuel_Moreno_R=C3=B3denas?=)
Date: Fri, 5 Feb 2016 11:48:40 +0100
Subject: [R-sig-Geo] Ordinary kriging variance of the prediction with
 error structure
In-Reply-To: <56B471D8.40208@gmail.com>
References: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>
	<56B471D8.40208@gmail.com>
Message-ID: <CAHX-Q64dTXgOeij0ZNPVfsmJQ6v-vjOPDWLXX8Z8eyVMK9pyXA@mail.gmail.com>

Hello Ruben,

Thanks for your answer,
I tried to check your reference, but still I'm having the same issue,

Cressie 1993, he says in 3.2.27:
var(S|Y) = Sum(w_i)*V_io + m - c_me

Being:
[w_i, vector of weights]
[V_io, Semivariogram value from the sampled point to the predictied]
[m, lagrange multiplier]
[c_me, nugget (due to measurement error)]

This is equivalent to the notation I posted previously as C(h>0)= partial
variance + nugget - V(h>0)
[C, Covariance function]
[V, Semivariogram function]

Substituting V_io and knowing that Sum(w_i)= 1, this gives:

Var(S| Y) = partial variance - Sum(w_i) * C_oi - m
[C_oi, vector Covariance between predicted and sampled coordinates]

This is the expression that I'm working with, in which the nugget should
not appear (unless x_o=x_i) isn't it?

I'm working with the covariance matrix as the nugget will only affect
C(h=0) and not C(h>0) which is a property I need. And then the layout of
the kriging system should be the same yet adding a nugget term in the
diagonal of the covariance matrix.

Am I misunderstanding something?

Thanks and kind regards
Antonio


On 5 February 2016 at 10:56, rubenfcasal <rubenfcasal at gmail.com> wrote:

> Kriging the noiseless version of Y is not ?the solution of the
> (standard) kriging system with a nugget effect in the Covariance
> structure? (the semivariances/variogram at lag 0 may not be zero).
> See e.g. Cressie, 1993, p. 128 (for instance, eq. 3.2.27 shows the
> correct expression of the kriging variance).
>
> Best regards, Ruben.
>
> El 04/02/2016 a las 15:56, Antonio Manuel Moreno R?denas escribi?:
> > Dear r-sig-geo community,
> >
> > I would like to bring a conceptual question on the implementation of
> > ordinary kriging in gstat.
> >
> > I'm trying to account for my measurement error in a OK scheme. I assume
> > that my sampled vector Y(x_i) is a noisy realisation of S(x_i) (the real
> > variable), thus:
> > Y(x_i) = S(x_i) + e_i, where e_i is ~N(0,tau^2).
> >
> > If that error is assumed to follow a certain set of conditions (unbiased,
> > uncorrelated between itself/the variable and tau=constant), this is
> > analogous to the solution of the kriging system with a nugget effect in
> the
> > Covariance structure.
> >
> > I coded the kriging system and its solution. In order to assess if my
> > implementation is correct I contrasted it with the krige function in
> gstat.
> > The predicted value at each point is the same, meaning that I got
> correctly
> > the weights of the system.
> >
> > However, I'm really confused when dealing with the variance in the
> > prediction. Which should have this form:
> >
> > Var(S(x_o) | Y) = Var(S(x_o)) - w' * C_oi - mu
> >
> > w' weights vector
> > C_oi vector Covariance between predicted and sampled coordinates
> > mu lagrange multiplier
> >
> > If my objective would be to predict the signal of the variable S(x_o),
> the
> > term of Var(S(x_o)) will correspond to the partial variance, (*the sill
> > without the nugget*). This is what I understood by following the notation
> > of Model-based Geostatistics from Peter J.Diggle, where it is explicitly
> > mentioned in (pag 137 (6.8)).
> >
> > However, I only get agreement in my comparison with the krige (gstat)
> > variance results if I use the total sill as Var(S(x_o)) that is (partial
> > variance + nugget). So my question is:
> >
> > I'am right by thinking that still Var(S(x_o)) should not include the
> nugget?
> > What is the outcome of krige in gstat when you consider a nugget? is it
> the
> > prediction of the signal? or is it the prediction of what you would
> measure
> > at that location?
> >
> > Kind regards,
> >
> > Antonio
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>
>         [[alternative HTML version deleted]]
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Fri Feb  5 12:10:52 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 5 Feb 2016 12:10:52 +0100
Subject: [R-sig-Geo] Ordinary kriging variance of the prediction with
 error structure
In-Reply-To: <CAHX-Q64dTXgOeij0ZNPVfsmJQ6v-vjOPDWLXX8Z8eyVMK9pyXA@mail.gmail.com>
References: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>
	<56B471D8.40208@gmail.com>
	<CAHX-Q64dTXgOeij0ZNPVfsmJQ6v-vjOPDWLXX8Z8eyVMK9pyXA@mail.gmail.com>
Message-ID: <56B4833C.5010305@uni-muenster.de>

Manuel,

gstat does kriging (exact interpolatoin) when specifying a nugget
variance, and smoothing when defining this nugget as an Err (measurement
error) term instead:

library(sp)
library(gstat)
demo(meuse, ask = FALSE, echo = FALSE)
krige(log(zinc)~1, meuse, meuse[1,],vgm(.6, "Sph", 900, .05))
krige(log(zinc)~1, meuse, meuse[1,],vgm(.6, "Sph", 900, Err = .05))

# From:

krige(log(zinc)~1, meuse[1:5,], meuse[1,],
   vgm(.6, "Sph", 900, .05), set = list(debug = 32))
krige(log(zinc)~1, meuse[1:5,], meuse[1,],
   vgm(.6, "Sph", 900, Err = .05), set = list(debug = 32))

You'll see that the difference is in the right-hand-side, the covariance
between observations and prediction location (C0).

Hth,


On 05/02/16 11:48, Antonio Manuel Moreno R?denas wrote:
> Hello Ruben,
> 
> Thanks for your answer,
> I tried to check your reference, but still I'm having the same issue,
> 
> Cressie 1993, he says in 3.2.27:
> var(S|Y) = Sum(w_i)*V_io + m - c_me
> 
> Being:
> [w_i, vector of weights]
> [V_io, Semivariogram value from the sampled point to the predictied]
> [m, lagrange multiplier]
> [c_me, nugget (due to measurement error)]
> 
> This is equivalent to the notation I posted previously as C(h>0)= partial
> variance + nugget - V(h>0)
> [C, Covariance function]
> [V, Semivariogram function]
> 
> Substituting V_io and knowing that Sum(w_i)= 1, this gives:
> 
> Var(S| Y) = partial variance - Sum(w_i) * C_oi - m
> [C_oi, vector Covariance between predicted and sampled coordinates]
> 
> This is the expression that I'm working with, in which the nugget should
> not appear (unless x_o=x_i) isn't it?
> 
> I'm working with the covariance matrix as the nugget will only affect
> C(h=0) and not C(h>0) which is a property I need. And then the layout of
> the kriging system should be the same yet adding a nugget term in the
> diagonal of the covariance matrix.
> 
> Am I misunderstanding something?
> 
> Thanks and kind regards
> Antonio
> 
> 
> On 5 February 2016 at 10:56, rubenfcasal <rubenfcasal at gmail.com> wrote:
> 
>> Kriging the noiseless version of Y is not ?the solution of the
>> (standard) kriging system with a nugget effect in the Covariance
>> structure? (the semivariances/variogram at lag 0 may not be zero).
>> See e.g. Cressie, 1993, p. 128 (for instance, eq. 3.2.27 shows the
>> correct expression of the kriging variance).
>>
>> Best regards, Ruben.
>>
>> El 04/02/2016 a las 15:56, Antonio Manuel Moreno R?denas escribi?:
>>> Dear r-sig-geo community,
>>>
>>> I would like to bring a conceptual question on the implementation of
>>> ordinary kriging in gstat.
>>>
>>> I'm trying to account for my measurement error in a OK scheme. I assume
>>> that my sampled vector Y(x_i) is a noisy realisation of S(x_i) (the real
>>> variable), thus:
>>> Y(x_i) = S(x_i) + e_i, where e_i is ~N(0,tau^2).
>>>
>>> If that error is assumed to follow a certain set of conditions (unbiased,
>>> uncorrelated between itself/the variable and tau=constant), this is
>>> analogous to the solution of the kriging system with a nugget effect in
>> the
>>> Covariance structure.
>>>
>>> I coded the kriging system and its solution. In order to assess if my
>>> implementation is correct I contrasted it with the krige function in
>> gstat.
>>> The predicted value at each point is the same, meaning that I got
>> correctly
>>> the weights of the system.
>>>
>>> However, I'm really confused when dealing with the variance in the
>>> prediction. Which should have this form:
>>>
>>> Var(S(x_o) | Y) = Var(S(x_o)) - w' * C_oi - mu
>>>
>>> w' weights vector
>>> C_oi vector Covariance between predicted and sampled coordinates
>>> mu lagrange multiplier
>>>
>>> If my objective would be to predict the signal of the variable S(x_o),
>> the
>>> term of Var(S(x_o)) will correspond to the partial variance, (*the sill
>>> without the nugget*). This is what I understood by following the notation
>>> of Model-based Geostatistics from Peter J.Diggle, where it is explicitly
>>> mentioned in (pag 137 (6.8)).
>>>
>>> However, I only get agreement in my comparison with the krige (gstat)
>>> variance results if I use the total sill as Var(S(x_o)) that is (partial
>>> variance + nugget). So my question is:
>>>
>>> I'am right by thinking that still Var(S(x_o)) should not include the
>> nugget?
>>> What is the outcome of krige in gstat when you consider a nugget? is it
>> the
>>> prediction of the signal? or is it the prediction of what you would
>> measure
>>> at that location?
>>>
>>> Kind regards,
>>>
>>> Antonio
>>>
>>>       [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>>         [[alternative HTML version deleted]]
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160205/7aec5e65/attachment.bin>

From Roger.Bivand at nhh.no  Fri Feb  5 13:27:33 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Feb 2016 13:27:33 +0100
Subject: [R-sig-Geo] globalG.test - routine with distance based
 neighbours
In-Reply-To: <CAEG8zh4Ju1jaOHfCgeWcN=VydEQ_y6GSmxRQj152xivZ7adP2A@mail.gmail.com>
References: <CAEG8zh4Ju1jaOHfCgeWcN=VydEQ_y6GSmxRQj152xivZ7adP2A@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602051324270.6132@reclus.nhh.no>

On Fri, 5 Feb 2016, Francesco Perugini wrote:

> Dear all,
> I've routine that plot Glogal G statistics at different k-neighbours. I've
> tried to run it using distance based neighbours method but I got this
> message:
>
> Error in dnb[[val]] : subscript out of bounds

val is defined in for (val in z), and z in z <- c(620, 650, 700) - 
arguably should be c(0.620, 0.650, 0.700) given all.linkedT as 0.619. 
There is no dnb[[620]], it is length(dnb) == length(z) long.

Roger

>
> Any suggestion on this?
>
> Thanks a lot.
>
> franc.per
>
> _______________
>
> this is the routine
>
> library(spdep)
> example(columbus)
> coord <- coordinates(columbus)
>
> #k-nearest neighbours
> #z <- c(1:20)
> #neighbors.knn <- list()
>
>
> #Distance-based neighbours
> k1 <- knn2nb(knearneigh(coord,k=1,longlat=F))
> all.linkedT <- max(unlist(nbdists(k1, coord,longlat=F)))
> all.linkedT
>
> z <- c(620, 650, 700)
> dnb <- list()
> for (val in z)
>  {
>  dnb <- c(dnb, list(dnearneigh(coord, 0, val, longlat=F)))
> # neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
> longlat=F), sym=F)))
>  }
> list(dnb)
>
>
> ndists <- length(z)
> ZG <- vector(mode="list", length=ndists)
> names(ZG) <- as.character(z)
>
> f <- c("CRIME", "INC")
> for (val in z)
>  {
> # dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
>  dlwdnb.B <- nb2listw(dnb[[val]], style="B", zero.policy=TRUE)
>  temp <- list()
>
>  for (var in f)
>  {
> #   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
> zero.policy=F)))
>    temp <- c(temp, list(globalG.test(columbus[[var]], dlwdnb.B,
> zero.policy=F)))
>  }
>  ZG[[val]] <- temp
> }
>
> t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>                                      var$statistic,
> p.value=unname(var$p.value))))
> CRIME <- t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>                                      var$statistic,
> p.value=unname(var$p.value))))
> plot(z, CRIME[,1], xlab="distance", ylab="Global G", xlim=NULL,
> axes=TRUE, type="o", col="blue")
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From argantonio65 at gmail.com  Fri Feb  5 13:47:24 2016
From: argantonio65 at gmail.com (=?UTF-8?Q?Antonio_Manuel_Moreno_R=C3=B3denas?=)
Date: Fri, 5 Feb 2016 13:47:24 +0100
Subject: [R-sig-Geo] Ordinary kriging variance of the prediction with
 error structure
In-Reply-To: <56B4833C.5010305@uni-muenster.de>
References: <CAHX-Q650nAV6t+AtOuUPV7UcYFpXcpFrpvoK-iF0KuHP=ef9aQ@mail.gmail.com>
	<56B471D8.40208@gmail.com>
	<CAHX-Q64dTXgOeij0ZNPVfsmJQ6v-vjOPDWLXX8Z8eyVMK9pyXA@mail.gmail.com>
	<56B4833C.5010305@uni-muenster.de>
Message-ID: <CAHX-Q65w7_XiTFZ9x-cjJ7PJZS6yOWAkpZdmLdRX8HjhS4JzUg@mail.gmail.com>

Thanks a lot Edzer!

Indeed, now everything goes as it should. My bad I didn't notice the
existence of the Err argument, and I was assuming that nugget would
automatically smooth the prediction.

With this everything is solved.
Best regards

On 5 February 2016 at 12:10, Edzer Pebesma <edzer.pebesma at uni-muenster.de>
wrote:

> Manuel,
>
> gstat does kriging (exact interpolatoin) when specifying a nugget
> variance, and smoothing when defining this nugget as an Err (measurement
> error) term instead:
>
> library(sp)
> library(gstat)
> demo(meuse, ask = FALSE, echo = FALSE)
> krige(log(zinc)~1, meuse, meuse[1,],vgm(.6, "Sph", 900, .05))
> krige(log(zinc)~1, meuse, meuse[1,],vgm(.6, "Sph", 900, Err = .05))
>
> # From:
>
> krige(log(zinc)~1, meuse[1:5,], meuse[1,],
>    vgm(.6, "Sph", 900, .05), set = list(debug = 32))
> krige(log(zinc)~1, meuse[1:5,], meuse[1,],
>    vgm(.6, "Sph", 900, Err = .05), set = list(debug = 32))
>
> You'll see that the difference is in the right-hand-side, the covariance
> between observations and prediction location (C0).
>
> Hth,
>
>
> On 05/02/16 11:48, Antonio Manuel Moreno R?denas wrote:
> > Hello Ruben,
> >
> > Thanks for your answer,
> > I tried to check your reference, but still I'm having the same issue,
> >
> > Cressie 1993, he says in 3.2.27:
> > var(S|Y) = Sum(w_i)*V_io + m - c_me
> >
> > Being:
> > [w_i, vector of weights]
> > [V_io, Semivariogram value from the sampled point to the predictied]
> > [m, lagrange multiplier]
> > [c_me, nugget (due to measurement error)]
> >
> > This is equivalent to the notation I posted previously as C(h>0)= partial
> > variance + nugget - V(h>0)
> > [C, Covariance function]
> > [V, Semivariogram function]
> >
> > Substituting V_io and knowing that Sum(w_i)= 1, this gives:
> >
> > Var(S| Y) = partial variance - Sum(w_i) * C_oi - m
> > [C_oi, vector Covariance between predicted and sampled coordinates]
> >
> > This is the expression that I'm working with, in which the nugget should
> > not appear (unless x_o=x_i) isn't it?
> >
> > I'm working with the covariance matrix as the nugget will only affect
> > C(h=0) and not C(h>0) which is a property I need. And then the layout of
> > the kriging system should be the same yet adding a nugget term in the
> > diagonal of the covariance matrix.
> >
> > Am I misunderstanding something?
> >
> > Thanks and kind regards
> > Antonio
> >
> >
> > On 5 February 2016 at 10:56, rubenfcasal <rubenfcasal at gmail.com> wrote:
> >
> >> Kriging the noiseless version of Y is not ?the solution of the
> >> (standard) kriging system with a nugget effect in the Covariance
> >> structure? (the semivariances/variogram at lag 0 may not be zero).
> >> See e.g. Cressie, 1993, p. 128 (for instance, eq. 3.2.27 shows the
> >> correct expression of the kriging variance).
> >>
> >> Best regards, Ruben.
> >>
> >> El 04/02/2016 a las 15:56, Antonio Manuel Moreno R?denas escribi?:
> >>> Dear r-sig-geo community,
> >>>
> >>> I would like to bring a conceptual question on the implementation of
> >>> ordinary kriging in gstat.
> >>>
> >>> I'm trying to account for my measurement error in a OK scheme. I assume
> >>> that my sampled vector Y(x_i) is a noisy realisation of S(x_i) (the
> real
> >>> variable), thus:
> >>> Y(x_i) = S(x_i) + e_i, where e_i is ~N(0,tau^2).
> >>>
> >>> If that error is assumed to follow a certain set of conditions
> (unbiased,
> >>> uncorrelated between itself/the variable and tau=constant), this is
> >>> analogous to the solution of the kriging system with a nugget effect in
> >> the
> >>> Covariance structure.
> >>>
> >>> I coded the kriging system and its solution. In order to assess if my
> >>> implementation is correct I contrasted it with the krige function in
> >> gstat.
> >>> The predicted value at each point is the same, meaning that I got
> >> correctly
> >>> the weights of the system.
> >>>
> >>> However, I'm really confused when dealing with the variance in the
> >>> prediction. Which should have this form:
> >>>
> >>> Var(S(x_o) | Y) = Var(S(x_o)) - w' * C_oi - mu
> >>>
> >>> w' weights vector
> >>> C_oi vector Covariance between predicted and sampled coordinates
> >>> mu lagrange multiplier
> >>>
> >>> If my objective would be to predict the signal of the variable S(x_o),
> >> the
> >>> term of Var(S(x_o)) will correspond to the partial variance, (*the sill
> >>> without the nugget*). This is what I understood by following the
> notation
> >>> of Model-based Geostatistics from Peter J.Diggle, where it is
> explicitly
> >>> mentioned in (pag 137 (6.8)).
> >>>
> >>> However, I only get agreement in my comparison with the krige (gstat)
> >>> variance results if I use the total sill as Var(S(x_o)) that is
> (partial
> >>> variance + nugget). So my question is:
> >>>
> >>> I'am right by thinking that still Var(S(x_o)) should not include the
> >> nugget?
> >>> What is the outcome of krige in gstat when you consider a nugget? is it
> >> the
> >>> prediction of the signal? or is it the prediction of what you would
> >> measure
> >>> at that location?
> >>>
> >>> Kind regards,
> >>>
> >>> Antonio
> >>>
> >>>       [[alternative HTML version deleted]]
> >>>
> >>> _______________________________________________
> >>> R-sig-Geo mailing list
> >>> R-sig-Geo at r-project.org
> >>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>
> >>
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >
> >       [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> --
> Edzer Pebesma
> Institute for Geoinformatics  (ifgi),  University of M?nster
> Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
> Journal of Statistical Software:   http://www.jstatsoft.org/
> Computers & Geosciences:   http://elsevier.com/locate/cageo/
> Spatial Statistics Society http://www.spatialstatistics.info
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From francescoperugini07 at gmail.com  Fri Feb  5 16:42:37 2016
From: francescoperugini07 at gmail.com (Francesco Perugini)
Date: Fri, 5 Feb 2016 16:42:37 +0100
Subject: [R-sig-Geo] globalG.test - routine with distance based
	neighbours
In-Reply-To: <alpine.LFD.2.20.1602051324270.6132@reclus.nhh.no>
References: <CAEG8zh4Ju1jaOHfCgeWcN=VydEQ_y6GSmxRQj152xivZ7adP2A@mail.gmail.com>
	<alpine.LFD.2.20.1602051324270.6132@reclus.nhh.no>
Message-ID: <CAEG8zh5gXX8gSmmuEBYMqaM+QCqACrUA7KoheUYCUna2u3QT4w@mail.gmail.com>

Dear Prof. Bivand,
thanks a lot for the reply.
sure, it should be c(0.620, 0.650, 0.700).
sorry but "There is no dnb[[620]], it is length(dnb) == length(z) long", is
not clear to me.
Many thanks.
Regards.
franc.per

2016-02-05 13:27 GMT+01:00 Roger Bivand <Roger.Bivand at nhh.no>:

> On Fri, 5 Feb 2016, Francesco Perugini wrote:
>
> Dear all,
>> I've routine that plot Glogal G statistics at different k-neighbours. I've
>> tried to run it using distance based neighbours method but I got this
>> message:
>>
>> Error in dnb[[val]] : subscript out of bounds
>>
>
> val is defined in for (val in z), and z in z <- c(620, 650, 700) -
> arguably should be c(0.620, 0.650, 0.700) given all.linkedT as 0.619. There
> is no dnb[[620]], it is length(dnb) == length(z) long.
>
> Roger
>
>
>> Any suggestion on this?
>>
>> Thanks a lot.
>>
>> franc.per
>>
>> _______________
>>
>> this is the routine
>>
>> library(spdep)
>> example(columbus)
>> coord <- coordinates(columbus)
>>
>> #k-nearest neighbours
>> #z <- c(1:20)
>> #neighbors.knn <- list()
>>
>>
>> #Distance-based neighbours
>> k1 <- knn2nb(knearneigh(coord,k=1,longlat=F))
>> all.linkedT <- max(unlist(nbdists(k1, coord,longlat=F)))
>> all.linkedT
>>
>> z <- c(620, 650, 700)
>> dnb <- list()
>> for (val in z)
>>  {
>>  dnb <- c(dnb, list(dnearneigh(coord, 0, val, longlat=F)))
>> # neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
>> longlat=F), sym=F)))
>>  }
>> list(dnb)
>>
>>
>> ndists <- length(z)
>> ZG <- vector(mode="list", length=ndists)
>> names(ZG) <- as.character(z)
>>
>> f <- c("CRIME", "INC")
>> for (val in z)
>>  {
>> # dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
>>  dlwdnb.B <- nb2listw(dnb[[val]], style="B", zero.policy=TRUE)
>>  temp <- list()
>>
>>  for (var in f)
>>  {
>> #   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
>> zero.policy=F)))
>>    temp <- c(temp, list(globalG.test(columbus[[var]], dlwdnb.B,
>> zero.policy=F)))
>>  }
>>  ZG[[val]] <- temp
>> }
>>
>> t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>>                                      var$statistic,
>> p.value=unname(var$p.value))))
>> CRIME <- t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>>                                      var$statistic,
>> p.value=unname(var$p.value))))
>> plot(z, CRIME[,1], xlab="distance", ylab="Global G", xlim=NULL,
>> axes=TRUE, type="o", col="blue")
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Fri Feb  5 19:17:36 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 5 Feb 2016 19:17:36 +0100
Subject: [R-sig-Geo] globalG.test - routine with distance based
 neighbours
In-Reply-To: <CAEG8zh5gXX8gSmmuEBYMqaM+QCqACrUA7KoheUYCUna2u3QT4w@mail.gmail.com>
References: <CAEG8zh4Ju1jaOHfCgeWcN=VydEQ_y6GSmxRQj152xivZ7adP2A@mail.gmail.com>
	<alpine.LFD.2.20.1602051324270.6132@reclus.nhh.no>
	<CAEG8zh5gXX8gSmmuEBYMqaM+QCqACrUA7KoheUYCUna2u3QT4w@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602051916190.15103@reclus.nhh.no>

On Fri, 5 Feb 2016, Francesco Perugini wrote:

> Dear Prof. Bivand,
> thanks a lot for the reply.
> sure, it should be c(0.620, 0.650, 0.700).
> sorry but "There is no dnb[[620]], it is length(dnb) == length(z) long", is

You cannot use (val in z) to index dnb, which takes the integers 1:3 only. 
Previously, your k was an integer sequence.

Roger

> not clear to me.
> Many thanks.
> Regards.
> franc.per
>
> 2016-02-05 13:27 GMT+01:00 Roger Bivand <Roger.Bivand at nhh.no>:
>
>> On Fri, 5 Feb 2016, Francesco Perugini wrote:
>>
>> Dear all,
>>> I've routine that plot Glogal G statistics at different k-neighbours. I've
>>> tried to run it using distance based neighbours method but I got this
>>> message:
>>>
>>> Error in dnb[[val]] : subscript out of bounds
>>>
>>
>> val is defined in for (val in z), and z in z <- c(620, 650, 700) -
>> arguably should be c(0.620, 0.650, 0.700) given all.linkedT as 0.619. There
>> is no dnb[[620]], it is length(dnb) == length(z) long.
>>
>> Roger
>>
>>
>>> Any suggestion on this?
>>>
>>> Thanks a lot.
>>>
>>> franc.per
>>>
>>> _______________
>>>
>>> this is the routine
>>>
>>> library(spdep)
>>> example(columbus)
>>> coord <- coordinates(columbus)
>>>
>>> #k-nearest neighbours
>>> #z <- c(1:20)
>>> #neighbors.knn <- list()
>>>
>>>
>>> #Distance-based neighbours
>>> k1 <- knn2nb(knearneigh(coord,k=1,longlat=F))
>>> all.linkedT <- max(unlist(nbdists(k1, coord,longlat=F)))
>>> all.linkedT
>>>
>>> z <- c(620, 650, 700)
>>> dnb <- list()
>>> for (val in z)
>>>  {
>>>  dnb <- c(dnb, list(dnearneigh(coord, 0, val, longlat=F)))
>>> # neighbors.knn <- c(neighbors.knn, list(knn2nb(knearneigh(coord, val,
>>> longlat=F), sym=F)))
>>>  }
>>> list(dnb)
>>>
>>>
>>> ndists <- length(z)
>>> ZG <- vector(mode="list", length=ndists)
>>> names(ZG) <- as.character(z)
>>>
>>> f <- c("CRIME", "INC")
>>> for (val in z)
>>>  {
>>> # dlwknn.B <- nb2listw(neighbors.knn[[val]], style="B", zero.policy=TRUE)
>>>  dlwdnb.B <- nb2listw(dnb[[val]], style="B", zero.policy=TRUE)
>>>  temp <- list()
>>>
>>>  for (var in f)
>>>  {
>>> #   temp <- c(temp, list(globalG.test(columbus[[var]], dlwknn.B,
>>> zero.policy=F)))
>>>    temp <- c(temp, list(globalG.test(columbus[[var]], dlwdnb.B,
>>> zero.policy=F)))
>>>  }
>>>  ZG[[val]] <- temp
>>> }
>>>
>>> t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>>>                                      var$statistic,
>>> p.value=unname(var$p.value))))
>>> CRIME <- t(sapply(lapply(ZG, "[[", 1), function(var) c(var$estimate[1],
>>>                                      var$statistic,
>>> p.value=unname(var$p.value))))
>>> plot(z, CRIME[,1], xlab="distance", ylab="Global G", xlim=NULL,
>>> axes=TRUE, type="o", col="blue")
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>> http://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> http://depsy.org/person/434412
>>
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From abkppb at gmail.com  Sun Feb  7 19:07:11 2016
From: abkppb at gmail.com (Abhishek Padhi)
Date: Sun, 7 Feb 2016 23:37:11 +0530
Subject: [R-sig-Geo] spdep not available
Message-ID: <CAMXidyWJssp1efrFy1OMUo=DXZn4QTgXw3JWt7KxX1JSveva8A@mail.gmail.com>

Hello Sir,

spdep package is not available for R version 3.2.2.

Thanks

*Regards*
*Abhishek Padhi*
*B.E. (Hons.) Civil Engineering*
Birla Institute of Technology & Science, *Pilani *

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Sun Feb  7 21:16:01 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 7 Feb 2016 21:16:01 +0100
Subject: [R-sig-Geo] spdep not available
In-Reply-To: <CAMXidyWJssp1efrFy1OMUo=DXZn4QTgXw3JWt7KxX1JSveva8A@mail.gmail.com>
References: <CAMXidyWJssp1efrFy1OMUo=DXZn4QTgXw3JWt7KxX1JSveva8A@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602072100100.18352@reclus.nhh.no>

On Sun, 7 Feb 2016, Abhishek Padhi wrote:

> Hello Sir,
>
> spdep package is not available for R version 3.2.2.

Please check properly, and document your claim. Of course the source is 
available, as are the OSX and Windows binaries:

https://cran.r-project.org/web/packages/spdep/index.html

The mirror you are using may be stale, or there may be other reasons, but 
an undocumented claim like this is of no help in resolving your problem 
(no OS, no mirror, etc.).

Roger

>
> Thanks
>
> *Regards*
> *Abhishek Padhi*
> *B.E. (Hons.) Civil Engineering*
> Birla Institute of Technology & Science, *Pilani *
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From englishchristophera at gmail.com  Mon Feb  8 09:57:31 2016
From: englishchristophera at gmail.com (chris english)
Date: Mon, 8 Feb 2016 10:57:31 +0200
Subject: [R-sig-Geo] spdep not available
In-Reply-To: <alpine.LFD.2.20.1602072100100.18352@reclus.nhh.no>
References: <CAMXidyWJssp1efrFy1OMUo=DXZn4QTgXw3JWt7KxX1JSveva8A@mail.gmail.com>
	<alpine.LFD.2.20.1602072100100.18352@reclus.nhh.no>
Message-ID: <CAASFQpT1P_u_3X=+jVqKANPAQx7rO8C9xaHhdfdsSC7ta3+0bQ@mail.gmail.com>

Abhishek:

chooseCRANmirror() is your best friend here as it allows you to select a
different mirror once you've found a given mirror reports "package is not
available for R version 3.2.x" As Roger points out, staleness happens and
if it isn't up to date at USA/CA1 it might quite likely be up to date at
USA/PA1 or Berlin or somewhere.
HTH,
chris

On Sun, Feb 7, 2016 at 10:16 PM, Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Sun, 7 Feb 2016, Abhishek Padhi wrote:
>
> Hello Sir,
>>
>> spdep package is not available for R version 3.2.2.
>>
>
> Please check properly, and document your claim. Of course the source is
> available, as are the OSX and Windows binaries:
>
> https://cran.r-project.org/web/packages/spdep/index.html
>
> The mirror you are using may be stale, or there may be other reasons, but
> an undocumented claim like this is of no help in resolving your problem (no
> OS, no mirror, etc.).
>
> Roger
>
>
>> Thanks
>>
>> *Regards*
>> *Abhishek Padhi*
>> *B.E. (Hons.) Civil Engineering*
>> Birla Institute of Technology & Science, *Pilani *
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From joshmobrien at gmail.com  Mon Feb  8 18:59:24 2016
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Mon, 8 Feb 2016 09:59:24 -0800
Subject: [R-sig-Geo] rgeos::gBuffer() fails when passed a
 SpatialPolygonsDataFrame containing a single multi-part @Polygons object.
Message-ID: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>

Hello,

Not sure if this would be considered a bug, but it did recently bite
me (and might bite others using gBuffer(..., byid=TRUE)
programatically).


    library(sp)
    library(rgdal)
    library(rgeos)

    ## Example SpatialPolygonsDataFrame
    x <- readOGR(system.file("etc/shapes", package="spdep"), "sids")[c(89,28),]
    plot(x, col=c('dodgerblue', 'wheat'))

    ## Works fine on object with multiple @Polygons in @polygons, even
    ## if one of the @Polygons is multi-part
    gBuffer(x, width=0.01, byid=TRUE)

    ## Works with a single single-part @Polygons object in @polygons
    gBuffer(x[1,], width=0.01, byid=TRUE)

    ## Fails with a single _multi-part_ @Polygons object in @polygons
    gBuffer(x[2,], width=0.01, byid=TRUE)


Thanks (and please let me know an rgeos-specific note like this would
be better posted elsewhere),

Josh O'Brien


From joshmobrien at gmail.com  Mon Feb  8 19:02:55 2016
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Mon, 8 Feb 2016 10:02:55 -0800
Subject: [R-sig-Geo] rgeos::gBuffer() fails when passed a
 SpatialPolygonsDataFrame containing a single multi-part @Polygons object.
In-Reply-To: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
References: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
Message-ID: <CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>

Oops. The post's title should have read "rgeos::gBuffer( , byid=TRUE)
fails when...". (I inadvertently left out the `byid=TRUE` bit).

My apologies.

On Mon, Feb 8, 2016 at 9:59 AM, Josh O'Brien <joshmobrien at gmail.com> wrote:
> Hello,
>
> Not sure if this would be considered a bug, but it did recently bite
> me (and might bite others using gBuffer(..., byid=TRUE)
> programatically).
>
>
>     library(sp)
>     library(rgdal)
>     library(rgeos)
>
>     ## Example SpatialPolygonsDataFrame
>     x <- readOGR(system.file("etc/shapes", package="spdep"), "sids")[c(89,28),]
>     plot(x, col=c('dodgerblue', 'wheat'))
>
>     ## Works fine on object with multiple @Polygons in @polygons, even
>     ## if one of the @Polygons is multi-part
>     gBuffer(x, width=0.01, byid=TRUE)
>
>     ## Works with a single single-part @Polygons object in @polygons
>     gBuffer(x[1,], width=0.01, byid=TRUE)
>
>     ## Fails with a single _multi-part_ @Polygons object in @polygons
>     gBuffer(x[2,], width=0.01, byid=TRUE)
>
>
> Thanks (and please let me know an rgeos-specific note like this would
> be better posted elsewhere),
>
> Josh O'Brien


From jworrall at fs.fed.us  Mon Feb  8 19:17:00 2016
From: jworrall at fs.fed.us (Worrall, James -FS)
Date: Mon, 8 Feb 2016 18:17:00 +0000
Subject: [R-sig-Geo] Opening non-spatial layer/feature class in gdb
Message-ID: <558ED6D2BF4F5742885443480CC85E3301862AFE@001FSN2MPN1-061.001f.mgd2.msft.net>


I've been playing with getting info on and opening geodatabases.  I was pleasantly surprised to find that rgdal could examine and open layers from them.  But I wonder if it can open non-spatial objects in them?  Or if there is any other R way to do that?

I have a geodatabase that looks like this:

> ogrListLayers( "D:USvegNRIS.gdb" )
[1] "NRIS_VegCharacterizations" "NRIS_VegDisturbances"      "NRIS_VegGisCalcs"          "NRIS_VegPolyLinks"
[5] "NRIS_VegSubpopulations"    "NRIS_VegPointLinks"        "NRIS_VegLocations"         "NRIS_VegPoint"
[9] "NRIS_VegPoly"
attr(,"driver")
[1] "OpenFileGDB"
attr(,"nlayers")
[1] 9




I can open NRIS_VegPoly as a SpatialPolygonsDataFrame with readOGR() (at least I can in another gdb with a similar layer, but this one is too enormous and R crashes).

But I am also interested in NRIS_VegSubpopulation.  This is simply a table, with multiple rows per polygon, with IDs linking them to polygons, but no spatial data.  Trying to open it doesn't work:

Error in readOGR(dsn = "USVEGNRIS.gdb", layer = "NRIS_VegSubpopulations") :
  no features found
In addition: Warning message:
  In ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv = use_iconv,  :
               ogrInfo: all features NULL

Can you think of a way to get at such data within R?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160208/8ea58267/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: image001.gif
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160208/8ea58267/attachment.gif>

From ruettenauer at sowi.uni-kl.de  Mon Feb  8 19:33:42 2016
From: ruettenauer at sowi.uni-kl.de (=?iso-8859-1?Q?Tobias_R=FCttenauer?=)
Date: Mon, 8 Feb 2016 19:33:42 +0100
Subject: [R-sig-Geo] LM test for spatial dependence with panel data
Message-ID: <004601d1629f$3c8f9560$b5aec020$@sowi.uni-kl.de>

Dear list members,

I?m currently estimating a fixed effects panel model and I want to control
for spatial dependence. Thus, I also estimated two spatial fe-models, one
with a spatial error term and one with a spatial error term and spatial lag
variable. Both lambda and rho are highly significant and the independent
variables of the models differ considerably. 

However, I would like to control the model specifications with a Lagrange
Multiplier test. More precisely, I would like to test for spatial lag
dependence (while allowing possible spatial error dependence) and for
spatial error dependence (while allowing possible spatial lag dependence)
like described by Anselin/ Bera/ Florax/ Yoon (1996), which is possible for
cross-sectional data using lm.LMtests (spdep). Is there a possibility to
estimate a similar test for panel data? If I?m not mistaking, the
splm-implemented tests do not account for spatial lag dependence?

Thank you very much in advance for your help!

Best, 
Tobi


From Roger.Bivand at nhh.no  Mon Feb  8 21:30:10 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 8 Feb 2016 21:30:10 +0100
Subject: [R-sig-Geo] rgeos::gBuffer(, byid=TRUE) fails
In-Reply-To: <CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>
References: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
	<CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602082118460.1967@reclus.nhh.no>

On Mon, 8 Feb 2016, Josh O'Brien wrote:

> Oops. The post's title should have read "rgeos::gBuffer( , byid=TRUE)
> fails when...". (I inadvertently left out the `byid=TRUE` bit).
>
> My apologies.
>
> On Mon, Feb 8, 2016 at 9:59 AM, Josh O'Brien <joshmobrien at gmail.com> wrote:
>> Hello,
>>
>> Not sure if this would be considered a bug, but it did recently bite
>> me (and might bite others using gBuffer(..., byid=TRUE)
>> programatically).
>>

Thanks for a reproducible example - for rgeos 0.3-14 this gives a 
segfault, in 0.3-16 an error as the data.frame has only one row, but three 
Polygons objects are returned. As you note, the issue is triggered by 
byid=TRUE but there is only one input object; only one buffer is created, 
around the NE island.

I'll look into this - it'll need debugging in C, close to recent bug-fixes 
(then concerned with pre-sp-MultiPoint object signalling - multiple 
objects making up features).

And yes, this is a reasonable place to report, it should give users a 
realistic view of how many corner cases actually exist and require 
someone's attention.

Roger

>>
>>     library(sp)
>>     library(rgdal)
>>     library(rgeos)
>>
>>     ## Example SpatialPolygonsDataFrame
>>     x <- readOGR(system.file("etc/shapes", package="spdep"), "sids")[c(89,28),]
>>     plot(x, col=c('dodgerblue', 'wheat'))
>>
>>     ## Works fine on object with multiple @Polygons in @polygons, even
>>     ## if one of the @Polygons is multi-part
>>     gBuffer(x, width=0.01, byid=TRUE)
>>
>>     ## Works with a single single-part @Polygons object in @polygons
>>     gBuffer(x[1,], width=0.01, byid=TRUE)
>>
>>     ## Fails with a single _multi-part_ @Polygons object in @polygons
>>     gBuffer(x[2,], width=0.01, byid=TRUE)
>>
>>
>> Thanks (and please let me know an rgeos-specific note like this would
>> be better posted elsewhere),
>>
>> Josh O'Brien
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From brian.vanhezewijk at canada.ca  Mon Feb  8 23:54:49 2016
From: brian.vanhezewijk at canada.ca (Van Hezewijk, Brian (NRCan/RNCan))
Date: Mon, 8 Feb 2016 22:54:49 +0000
Subject: [R-sig-Geo] Only holes in the first polygon rasterized
Message-ID: <201602082254.u18MsuUC004834@hypatia.math.ethz.ch>

I am trying to rasterize() a shapefile using the raster package and am encountering erratic behaviour.  I think I've tracked it down to rasterize only identifying holes in the first Polygons in a SpatialPolygons object.  The following modification of the example code from rasterize reproduces the behaviour.  Am I missing something here or is it possibly a bug?

Thanks, Brian.  (using R 3.1.2, raster 2.5-2, Windows 7)


#first the original example code

p1 <- rbind(c(-180,-20), c(-140,55), c(10, 0), c(-140,-60), c(-180,-20))
hole <- rbind(c(-150,-20), c(-100,-10), c(-110,20), c(-150,-20))
p1 <- list(p1, hole)
p2 <- rbind(c(-10,0), c(140,60), c(160,0), c(140,-55), c(-10,0))
p3 <- rbind(c(-125,0), c(0,60), c(40,5), c(15,-45), c(-125,0))

pols <- spPolygons(p1, p2, p3)

r <- raster(ncol=90, nrow=45)
r <- rasterize(pols, r, fun=sum)

## Not run:

plot(r)
plot(pols, add=T)


## Now add a hole to p2

hole2 <- rbind(c(100,0), c(120,20), c(90,30), c(100,0))
p2 <- list(p2, hole2)

pols <- spPolygons(p1, p2, p3)

r <- raster(ncol=90, nrow=45)
r <- rasterize(pols, r, fun=sum)


## Not run:

plot(r)                  #rasterize doesn't recognize the hole in p2
plot(pols, add=T)


## Make p2 the first polygon with a hole

pols <- spPolygons(p2, p1, p3)

r <- raster(ncol=90, nrow=45)
r <- rasterize(pols, r, fun=sum)


## Not run:

plot(r)                  #Now the hole in p2 is good but p1 doesn't work
plot(pols, add=T)




Dr. Brian Van Hezewijk
Research Scientist - Insect Ecology
Canadian Forest Service / Service canadien des for?ts
Natural Resources Canada / Ressources naturelles Canada
506 West Burnside Road / 506 chemin Burnside ouest
Victoria, BC V8Z 1M5 / Victoria, (C.-B.) V8Z 1M5
Tel./T?l?. (250) 298-2373
Fax/T?l?copieur (250) 363-6004
Email/Courriel:  Brian.vanhezewijk at canada.ca




	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Tue Feb  9 05:42:26 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 09 Feb 2016 04:42:26 +0000
Subject: [R-sig-Geo] Opening non-spatial layer/feature class in gdb
In-Reply-To: <558ED6D2BF4F5742885443480CC85E3301862AFE@001FSN2MPN1-061.001f.mgd2.msft.net>
References: <558ED6D2BF4F5742885443480CC85E3301862AFE@001FSN2MPN1-061.001f.mgd2.msft.net>
Message-ID: <CAAcGz98MdsVb9SsaF0B9CanNM_ZgKTS_jdOA5r0ADzGwOwpdyQ@mail.gmail.com>

On Tue, 9 Feb 2016 at 05:18 Worrall, James -FS <jworrall at fs.fed.us> wrote:

> [image: image001.gif]
>
> I?ve been playing with getting info on and opening geodatabases.  I was
> pleasantly surprised to find that rgdal could examine and open layers from
> them.  But I wonder if it can open non-spatial objects in them?  Or if
> there is any other R way to do that?
>
>
>
> I have a geodatabase that looks like this:
>
>
>
> > ogrListLayers( "D:USvegNRIS.gdb" )
>
> [1] "NRIS_VegCharacterizations" "NRIS_VegDisturbances"
> "NRIS_VegGisCalcs"          "NRIS_VegPolyLinks"
>
> [5] "NRIS_VegSubpopulations"    "NRIS_VegPointLinks"
>    "NRIS_VegLocations"         "NRIS_VegPoint"
>
> [9] "NRIS_VegPoly"
>
> attr(,"driver")
>
> [1] "OpenFileGDB"
>
> attr(,"nlayers")
>
> [1] 9
>
> I can open NRIS_VegPoly as a SpatialPolygonsDataFrame with readOGR() (at
> least I can in another gdb with a similar layer, but this one is too
> enormous and R crashes).
>
>
>
> But I am also interested in NRIS_VegSubpopulation.  This is simply a
> table, with multiple rows per polygon, with IDs linking them to polygons,
> but no spatial data.  Trying to open it doesn?t work:
>
>
>
> Error in readOGR(dsn = "USVEGNRIS.gdb", layer = "NRIS_VegSubpopulations")
> :
>
>   no features found
>
> In addition: Warning message:
>
>   In ogrInfo(dsn = dsn, layer = layer, encoding = encoding, use_iconv =
> use_iconv,  :
>
>                ogrInfo: all features NULL
>
>
>
> Can you think of a way to get at such data within R?
>
>
>

I don't think this is possible in R with readOGR. Pretty sure you can use
the GDAL command line tools to do  it though.  I would try something like

ogr2ogr -f CSV output.csv USVEGNRIS.gdb NRIS_VegSubpopulations

There are better output formats obviously, but what works best will depend.

gdalUtils can be used to drive the command line tools.

Cheers, Mike.

> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160209/2557588b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160209/2557588b/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 92 bytes
Desc: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160209/2557588b/attachment-0001.gif>

From Gema.FAviles at uclm.es  Tue Feb  9 12:41:07 2016
From: Gema.FAviles at uclm.es (GEMA FERNANDEZ-AVILES CALDERON)
Date: Tue, 9 Feb 2016 11:41:07 +0000
Subject: [R-sig-Geo] Error in Universal Kriging with 2nd order trend in geoR
Message-ID: <VI1PR01MB0973753210A313FA87F0C74697D60@VI1PR01MB0973.eurprd01.prod.exchangelabs.com>

Dear list,

I have two problems related with UK in geoR package.

Q1) I can't perform UK with a 2nd order trend. The krige.conv() and ksline() functions reports me the same error all the time.

Q2) I can't understand how carrying out an UK with 1st order trend and choosing moving neighborhood of prediction with ksline() function, the smaller the neigborhood, the highest the error prediction.

I can send you the data.

Thanks in advance,
Gema





###****###

### Q1 ###

###****###

> summary(obj.uk.house)
Number of data points: 1000

Coordinates summary
    longitud latitud
min   -3.789   40.34
max   -3.555   40.53

Distance summary
      min       max
6.708e-06 2.511e-01

Data summary
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
   7.14    7.94    8.17    8.17    8.40    9.42

##semivariogram
wls.nwind  <- variofit( bin.nwind, cov.model="sph", ini = c(0.05, 0.05), nug = 0.03)


## UK, 2nd order trend
UK.krig.2 <- krige.conv(obj.uk.house, loc = loci.cuadro, borders = bordes.munimadrid,
              krige = krige.control(obj.model=wls.nwind, trend.l ="2nd", trend.d = "2nd"))

krige.conv: results will be returned only for prediction locations inside the borders
krige.conv: model with mean given by a 2nd order polynomial on the coordinates
Error in solve.default(ttivtt, crossprod(ivtt, as.vector(data))) :
  sistema es computacionalmente singular: n?mero de condici?n rec?proco = 7.65008e-19



###****###

### Q2 ###

###****###

uk.2.nwind.250= ksline(obj.uk.house, coords = obj.uk.house$coords, data = obj.uk.house$data,
       loc = loci.cuadro, borders = bordes.munimadrid,
       cov.model = "sph", cov.pars = c(0.059, 0.045), nug = 0.037,
       lambda = 1, m0 = "kt", nwin = 250,
       trend = 1, d = 2 )







	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Feb  9 14:01:08 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 9 Feb 2016 14:01:08 +0100
Subject: [R-sig-Geo] rgeos::gBuffer(, byid=TRUE) fails
In-Reply-To: <alpine.LFD.2.20.1602082118460.1967@reclus.nhh.no>
References: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
	<CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>
	<alpine.LFD.2.20.1602082118460.1967@reclus.nhh.no>
Message-ID: <alpine.LFD.2.20.1602091357060.14152@reclus.nhh.no>

On Mon, 8 Feb 2016, Roger Bivand wrote:

> On Mon, 8 Feb 2016, Josh O'Brien wrote:
>
>>  Oops. The post's title should have read "rgeos::gBuffer( , byid=TRUE)
>>  fails when...". (I inadvertently left out the `byid=TRUE` bit).
>>
>>  My apologies.
>>
>>  On Mon, Feb 8, 2016 at 9:59 AM, Josh O'Brien <joshmobrien at gmail.com>
>>  wrote:
>> >  Hello,
>> > 
>> >  Not sure if this would be considered a bug, but it did recently bite
>> >  me (and might bite others using gBuffer(..., byid=TRUE)
>> >  programatically).
>> > 
>
> Thanks for a reproducible example - for rgeos 0.3-14 this gives a segfault, 
> in 0.3-16 an error as the data.frame has only one row, but three Polygons 
> objects are returned. As you note, the issue is triggered by byid=TRUE but 
> there is only one input object; only one buffer is created, around the NE 
> island.
>
> I'll look into this - it'll need debugging in C, close to recent bug-fixes 
> (then concerned with pre-sp-MultiPoint object signalling - multiple objects 
> making up features).

I have committed a fix to R-Forge (checking whether the length of spgeom 
== 1 and byid == TRUE, if so set byid=FALSE and warn). The problem was 
visible in the C code, but there we don't have an sp-class generic 
"length" measure of the # features, so the modification is at the R level.

Which OS would you like to test under?

Best wishes,

Roger

>
> And yes, this is a reasonable place to report, it should give users a 
> realistic view of how many corner cases actually exist and require someone's 
> attention.
>
> Roger
>
>> > 
>> >      library(sp)
>> >      library(rgdal)
>> >      library(rgeos)
>> > 
>> >      ## Example SpatialPolygonsDataFrame
>> >      x <- readOGR(system.file("etc/shapes", package="spdep"), 
>> >      "sids")[c(89,28),]
>> >      plot(x, col=c('dodgerblue', 'wheat'))
>> > 
>> >      ## Works fine on object with multiple @Polygons in @polygons, even
>> >      ## if one of the @Polygons is multi-part
>> >      gBuffer(x, width=0.01, byid=TRUE)
>> > 
>> >      ## Works with a single single-part @Polygons object in @polygons
>> >      gBuffer(x[1,], width=0.01, byid=TRUE)
>> > 
>> >      ## Fails with a single _multi-part_ @Polygons object in @polygons
>> >      gBuffer(x[2,], width=0.01, byid=TRUE)
>> > 
>> > 
>> >  Thanks (and please let me know an rgeos-specific note like this would
>> >  be better posted elsewhere),
>> > 
>> >  Josh O'Brien
>>
>>  _______________________________________________
>>  R-sig-Geo mailing list
>>  R-sig-Geo at r-project.org
>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> 
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From joshmobrien at gmail.com  Tue Feb  9 17:39:04 2016
From: joshmobrien at gmail.com (Josh O'Brien)
Date: Tue, 9 Feb 2016 08:39:04 -0800
Subject: [R-sig-Geo] rgeos::gBuffer(, byid=TRUE) fails
In-Reply-To: <alpine.LFD.2.20.1602091357060.14152@reclus.nhh.no>
References: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
	<CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>
	<alpine.LFD.2.20.1602082118460.1967@reclus.nhh.no>
	<alpine.LFD.2.20.1602091357060.14152@reclus.nhh.no>
Message-ID: <CAOwKfPT4wcpiMc=DX1qKsKK66uAd4ndah+o4XsAacLzKT-P3xA@mail.gmail.com>

On Tue, Feb 9, 2016 at 5:01 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
> On Mon, 8 Feb 2016, Roger Bivand wrote:
>
>> On Mon, 8 Feb 2016, Josh O'Brien wrote:
>>
>>>  Oops. The post's title should have read "rgeos::gBuffer( , byid=TRUE)
>>>  fails when...". (I inadvertently left out the `byid=TRUE` bit).
>>>
>>>  My apologies.
>>>
>>>  On Mon, Feb 8, 2016 at 9:59 AM, Josh O'Brien <joshmobrien at gmail.com>
>>>  wrote:
>>> >  Hello,
>>> > >  Not sure if this would be considered a bug, but it did recently bite
>>> >  me (and might bite others using gBuffer(..., byid=TRUE)
>>> >  programatically).
>>> >
>>
>>
>> Thanks for a reproducible example - for rgeos 0.3-14 this gives a
>> segfault, in 0.3-16 an error as the data.frame has only one row, but three
>> Polygons objects are returned. As you note, the issue is triggered by
>> byid=TRUE but there is only one input object; only one buffer is created,
>> around the NE island.
>>
>> I'll look into this - it'll need debugging in C, close to recent bug-fixes
>> (then concerned with pre-sp-MultiPoint object signalling - multiple objects
>> making up features).
>
>
> I have committed a fix to R-Forge (checking whether the length of spgeom ==
> 1 and byid == TRUE, if so set byid=FALSE and warn). The problem was visible
> in the C code, but there we don't have an sp-class generic "length" measure
> of the # features, so the modification is at the R level.
>
> Which OS would you like to test under?
>

I'm using it on Windows (with R-3.2.3) and Ubuntu 14.04 (with
R-3.2.2), but am afraid I don't know how to install from sources on
either. I'll test under both, but if I had to pick one, would go with
Ubuntu, since that's where I'm doing my production work.

Thanks so much,

- Josh


> Best wishes,
>
> Roger
>
>
>>
>> And yes, this is a reasonable place to report, it should give users a
>> realistic view of how many corner cases actually exist and require someone's
>> attention.
>>
>> Roger
>>
>>> > >      library(sp)
>>> >      library(rgdal)
>>> >      library(rgeos)
>>> > >      ## Example SpatialPolygonsDataFrame
>>> >      x <- readOGR(system.file("etc/shapes", package="spdep"), >
>>> > "sids")[c(89,28),]
>>> >      plot(x, col=c('dodgerblue', 'wheat'))
>>> > >      ## Works fine on object with multiple @Polygons in @polygons,
>>> > > even
>>> >      ## if one of the @Polygons is multi-part
>>> >      gBuffer(x, width=0.01, byid=TRUE)
>>> > >      ## Works with a single single-part @Polygons object in @polygons
>>> >      gBuffer(x[1,], width=0.01, byid=TRUE)
>>> > >      ## Fails with a single _multi-part_ @Polygons object in
>>> > > @polygons
>>> >      gBuffer(x[2,], width=0.01, byid=TRUE)
>>> > > >  Thanks (and please let me know an rgeos-specific note like this
>>> > > > would
>>> >  be better posted elsewhere),
>>> > >  Josh O'Brien
>>>
>>>  _______________________________________________
>>>  R-sig-Geo mailing list
>>>  R-sig-Geo at r-project.org
>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412


From markpayneatwork at gmail.com  Wed Feb 10 12:27:26 2016
From: markpayneatwork at gmail.com (Mark R Payne)
Date: Wed, 10 Feb 2016 12:27:26 +0100
Subject: [R-sig-Geo] Geographic/Spatial Clustering - pyCluster for R?
Message-ID: <CAGBzUO881h7ssnWP2xgGOT_tb9BPe-4RZFTtTU9Sg8SohVfMew@mail.gmail.com>

Hi,

I have recently stumbled across the pyCluster package in Python that does
Geographical/Spatial clustering i.e. aggregating spatial pixels/polygons
together based on both their "similarity" and being geographical neighbours
- see here: https://pypi.python.org/pypi/clusterPy/0.9.9

Does anyone know of an interface to use this library in R, or an
implementation of similar tools in R?

The clustering algorithms availabe in the package are:

   - Arisel [Duque_Church2004]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-church2004>:
   - AZP [Openshaw_Rao1995]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>:
   - AZP-Simulated Annealing [Openshaw_Rao1995]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
   - AZP-Tabu [Openshaw_Rao1995]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
   - AZP-R-Tabu [Openshaw_Rao1995]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
   - Max-p-regions (Tabu) [Duque_Anselin_Rey2010]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-anselin-rey2010>.
   - AMOEBA [Alstadt_Getis2006]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#alstadt-getis2006>,
   [Duque_Alstadt_Velasquez_Franco_Betancourt2010]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-alstadt-velasquez-franco-betancourt2010>
   .
   - SOM [Kohonen1990]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#kohonen1990>.
   - geoSOM [Bacao_Lobo_Painho2004]
   <https://pypi.python.org/pypi/clusterPy/0.9.9#bacao-lobo-painho2004>.
   - Random

Best wishes,

Mark

	[[alternative HTML version deleted]]


From clayms at gmail.com  Wed Feb 10 13:20:47 2016
From: clayms at gmail.com (Clay S)
Date: Thu, 11 Feb 2016 01:20:47 +1300
Subject: [R-sig-Geo] wtms data into R
In-Reply-To: <CAFkR0r9YnO0sOtDmQmAuwnG30wLyF+oNtdOAvCHDUJvENSV1ZQ@mail.gmail.com>
References: <CAFkR0r9YnO0sOtDmQmAuwnG30wLyF+oNtdOAvCHDUJvENSV1ZQ@mail.gmail.com>
Message-ID: <CAFkR0r8bpXZS+sBm9LXttdL_oB+r3dEJvBTod60hOoPjTOyeNQ@mail.gmail.com>

Is there a quick way to load Web Map Tiling Service (WMTS) data into R?

Thanks

	[[alternative HTML version deleted]]


From thi_veloso at yahoo.com.br  Wed Feb 10 18:27:11 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 10 Feb 2016 17:27:11 +0000 (UTC)
Subject: [R-sig-Geo] Time index is lost after masking raster stack
References: <1250988325.1664534.1455125231893.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1250988325.1664534.1455125231893.JavaMail.yahoo@mail.yahoo.com>

Dear all,

I usually have to crop - and mask - multilayer raster objects (derived from netcdf files) using a polygon.


I noticed that all time (date) information of the raster objects are lost after the masking operation. Please see this example:

--------------------------
library(raster)

# Create the date sequence
idx <- seq(as.Date("2000/1/1"), as.Date("2000/12/31"), by = "day")

# Create raster stack and assign dates
r <- raster(ncol=20, nrow=20)
s <- stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r)))))
s <- setZ(s, idx)
getZ(s) # everything looks good

# Create spatial objects for cropping
e <- extent(-80, -40, -50, -20)
p <- as(e, 'SpatialPolygons')

# Crop and mask
c <- crop(s, e)
getZ(c) # everything still looks good

m <- mask(c, p)
getZ(m) # this returns NULL

--------------------------

Of course it would be easy to manually assign the time index on the masked object - something like m <- setZ(m, getZ(c)) - but it would be great to have a "native" way of preserving it.

Am I doing something wrong with the mask function or is this something that could be addressed in the next release of raster? 
Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


From tech_dev at wildintellect.com  Wed Feb 10 18:42:19 2016
From: tech_dev at wildintellect.com (Alex M)
Date: Wed, 10 Feb 2016 09:42:19 -0800
Subject: [R-sig-Geo] wtms data into R
In-Reply-To: <CAFkR0r8bpXZS+sBm9LXttdL_oB+r3dEJvBTod60hOoPjTOyeNQ@mail.gmail.com>
References: <CAFkR0r9YnO0sOtDmQmAuwnG30wLyF+oNtdOAvCHDUJvENSV1ZQ@mail.gmail.com>
	<CAFkR0r8bpXZS+sBm9LXttdL_oB+r3dEJvBTod60hOoPjTOyeNQ@mail.gmail.com>
Message-ID: <56BB767B.2050807@wildintellect.com>

On 02/10/2016 04:20 AM, Clay S wrote:
> Is there a quick way to load Web Map Tiling Service (WMTS) data into R?
> 
> Thanks
> 

Theoretically yes, as of GDAL 2.1
http://gdal.org/frmt_wmts.html

there is potential to use rgdal or gdalUtils as noted in this older thread
http://r-sig-geo.2731867.n2.nabble.com/Access-WMS-and-alike-services-from-R-td7586257.html

I'm haven't seen a simple working example yet though.

Of course the other way to got about this is to generate a Leaflet
(There are at least 2 R packages) map with the WMTS plugin and then view
your map in the browser.

Anyone else have working examples?

Enjoy,
Alex


From franciscodmoreira at gmail.com  Wed Feb 10 18:45:54 2016
From: franciscodmoreira at gmail.com (Francisco Moreira)
Date: Wed, 10 Feb 2016 17:45:54 +0000
Subject: [R-sig-Geo] Anysotropic distance using gdistance
Message-ID: <CA+P-iqYKsHESL718QuTUTsjYGOvW1WngosLFxD52Af7e3P4Q5g@mail.gmail.com>

Dear all,

I'm having a problem using the gdistance package to compute anysotropic
distances. Basically, I'm trying to use an exponential function to compute
the accumulated cost surface to predict the dispersion of an animal based
on slope. My problem is that, for whatever reason, the package always does
the absolute of the slope whether I use the abs() function (as in the
example given in the package) or not. However, I want negative slope values
to be increasingly easier to cross (unlike humans). Basically it's an
exponential function that tends to infinite permeability as we approach a
-90? slope and 0 in the 90? slope. I made a little example to illustrate my
problem using the package?s data:



library(gdistance)

library(raster)

r <- raster(system.file("external/maungawhau.grd", package="gdistance"))

plot(r)

altDiff <- function(x){x[2] - x[1]}

hd <- transition(r, altDiff, 8, symm=FALSE)

slope <- geoCorrection(hd)

adj <- adjacent(r, cells=1:ncell(r), pairs=TRUE, directions=8)

speed <- slope

speed[adj] <- 6 * exp(-3.5 * (slope[adj]))  #Transformed the hicking
function to a exponencial to illustrate the function I'd like to apply

Conductance <- geoCorrection(speed)

A <- cbind(2667675, 6478975)

cost_dist<-accCost(Conductance, A)



B <- cbind(2667675, 6478985)

C <- cbind(2667675, 6478965)



extract(cost_dist, B)
1.527031

extract(cost_dist, C)
1.527031



Basically, when I check the value of accCost from point A (altitude = 153)
to points B (altitude = 149) or C (altitude = 157), I get the same cost for
both of them. And I get the same value if I add abs() to the slope in the
function. If I understand this correctly, this shouldn?t be the case
considering the function I?m using and the fact that the slope is negative
for B, and positive for C.



Any ideas on how to solve this problem? Is it possible to do what I want it
to do? Any suggestion would be highly appreciated.


Best regards,

Francisco

	[[alternative HTML version deleted]]


From senator at ecotoxicology.de  Wed Feb 10 22:54:50 2016
From: senator at ecotoxicology.de (=?utf-8?Q?Ralf_Sch=C3=A4fer?=)
Date: Wed, 10 Feb 2016 22:54:50 +0100
Subject: [R-sig-Geo] Fwd: International Summer Academy on Spatial
	Ecotoxicology 12-25.09.2016
Message-ID: <5CAE5430-BC4D-4333-868F-98E155EBDEBE@ecotoxicology.de>

FYI
An international Summer Academy that uses R and GRASS GIS in the different modules!
The interesting bit: The course is fully funded by the DAAD, which means that people from developing countries can participate for free/all costs of travel, accomodation and course fees will be covered

Best regards
Ralf


> International Summer Academy on Spatial Ecotoxicology and Ecotoxicological Risk Assessment, 
> 12 - 25 September 2016
> 
> Dear all,
> 
> we will host the ?International Summer Academy?on Spatial Ecotoxicology and Ecotoxicological Risk Assessment <http://www.summeracademy-landau.de/> - Using an Open Community Approach? from 12.-25. September 2016 at University Koblenz-Landau, Campus Landau, Germany. 
> 
> Further details and registration are available on our website: 
> www.summeracademy-landau.de <http://www.summeracademy-landau.de/>
> 
> Developing countries are particularly affected with high contamination, but often have inadequate control mechanisms and insufficient resources for risk assessment. Spatial analysis offers more and more applications and potential within ecological risk assessment. Our ?International Summer Academy on Spatial Ecotoxicology and Ecotoxicological Risk Assessment? gives an overview of ecotoxicological risk assessment with a focus on the use of freely available methods and resources for remote sensing and spatial analysis using GIS.  The course provides young scientists with inexpensive tools that are oriented for use in both developing and developed countries.
> Topics: 
> - Problem formulation
> - Hazard assessment of chemical stressors
> - Characterization of effects on One Health
> - Pesticide pollution and vulnerability concepts
> - Earth-to-space-based observing systems for environmental risk assessment and disaster management
> - Use of Open Source spatial analysis tool
> - Open community approach in One Health risk mapping
> - Creation of global pesticide application maps
> - Risk assessment and data availability in developing countries
> The Summer Academy is funded by the DAAD (German Academic Exchange Service) with financial support from the Federal Foreign Office. 
> 
> We are looking forward to welcome you in Landau!
> 
> Best regards, 
> the Organizing Team 
> 
> 
> 
> University Koblenz-Landau
> Institute for Environmental Sciences
> Fortstrasse 7
> D-76829 Landau / Germany
> sommerakademie at uni-landau.de <mailto:sommerakademie at uni-landau.de>
> www.summeracademy-landau.de <http://www.summeracademy-landau.de/>
> 
> 

	[[alternative HTML version deleted]]


From anandnautiyal23 at gmail.com  Thu Feb 11 11:13:43 2016
From: anandnautiyal23 at gmail.com (Anand Nautiyal)
Date: Thu, 11 Feb 2016 15:43:43 +0530
Subject: [R-sig-Geo] GEOLIFE dataset
Message-ID: <CAK9ypTHVSe-UqNY-z1tR=gWhGYTr-i-x7sBKP1VvGsb1viESSQ@mail.gmail.com>

I have been working with the Microsoft GEOLIFE dataset v 1.3. I want to
find the distance between the 182 objects represented by 182 folders
respectively. But all the 182 folders have different no of files. So how
can I calculate the distance between the objects?

	[[alternative HTML version deleted]]


From clayms at gmail.com  Thu Feb 11 21:40:07 2016
From: clayms at gmail.com (Clay S)
Date: Fri, 12 Feb 2016 09:40:07 +1300
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
Message-ID: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>

Hi

Is it possible to import a Lidar LAS file into R with the
rsaga.geoprocessor function of the RSAGA package.  The following code runs
without an error, but all I get in R is the SAGA console output.

The R code below does save a SAGA point cloud file called "test" in my
working directory.  If I delete the `POINTS = "test"` parameter, then
nothing happens as expected.  However, I want to work with the data in R,
and pass the point cloud to other SAGA modules. This can be done in SAGA
without having to save the point cloud.  Can the same be done from R?

How can I get the point cloud imported into the R environment?  Do I need
to coerce it into a matrix, data frame, or Spatial Points object?


R code:

###############

library(RSAGA)


# Set RSAGA environment.

env <- rsaga.env()


# SET WORKING DIRECTORY FIRST!!

dir <- getwd()


# Get module parameters

lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
recursive=FALSE)


# send command to RSAGA

test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
Files",
                   param = list(FILES = lasfilelist[1], POINTS = "test",
                                T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
u=FALSE,
                                n=TRUE, R=FALSE, G=FALSE, B=FALSE, e=FALSE,
d=FALSE,
                                p=FALSE, C=FALSE, VALID=FALSE,
RGB_RANGE=FALSE),
                   env = env)

###################


Here is the console output (the test variable stores the same thing):

###########

library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
library name: Import/Export - LAS
tool name   : Import LAS Files
author      : O. Conrad, V. Wichmann (c) 2009

Parameters

Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
Point Clouds: No objects
gps-time: yes
intensity: yes
scan angle: no
number of the return: yes
classification: no
user data: no
number of returns of given pulse: yes
red channel color: no
green channel color: no
blue channel color: no
edge of flight line flag: no
direction of scan flag: no
point source ID: no
rgb color: no
Check Point Validity: no
R,G,B value range: 16 bit

Parsing AX300711.las ...
Save point cloud: test...

################


Here is my env:

################

> env

$workspace

[1] "."


$cmd

[1] "saga_cmd.exe"


$path

[1] "C:\\OSGeo4W64\\apps\\saga"


$modules

[1] "C:\\OSGeo4W64\\apps\\saga/modules"


$version

[1] "2.1.2"


$cores

[1] NA


$parallel

[1] FALSE


$lib.prefix

[1] ""

#################

	[[alternative HTML version deleted]]


From xgoodyear at yahoo.com  Thu Feb 11 23:45:47 2016
From: xgoodyear at yahoo.com (=?UTF-8?Q?XAVIER_BUENA=C3=BFffffffffffd1O?=)
Date: Thu, 11 Feb 2016 22:45:47 +0000 (UTC)
Subject: [R-sig-Geo] Intrinsic random functions of order k (IRF-k) - Drift
 treatment for variogram determination in R
References: <456601226.2958035.1455230747737.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <456601226.2958035.1455230747737.JavaMail.yahoo@mail.yahoo.com>

Hello everybody:
The dataset that I am analyzing? shows a clear drift that it is not possible to treat with a polynomial fitting. I am trying to detrend.Currently, the experimental variogram is unbounded. According to Chiles & Delfiner, 2012, a definitive solution is intrinsic random functions of order k.I don't know if is there any package in R to use this technique ?
Thanks for your help.
Xavier Buena?o


	[[alternative HTML version deleted]]


From mtreglia at gmail.com  Fri Feb 12 00:26:25 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Thu, 11 Feb 2016 17:26:25 -0600
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
Message-ID: <CAPKp32vezkFp40Atke1LDUh4ysX3=+p6svoXUK149g3xzXuskw@mail.gmail.com>

Hi Clay,

At some point I was looking into something similar, and don't think you can
do that with RSAGA.  rsaga.geoprocessor() is running things as a system
commands (like running from the command line directly), so it is not
bringing the Lidar data into R, if I recall correctly.

One package you might want to look into is rLidar:
https://cran.r-project.org/web/packages/rLiDAR/index.html - it has some
good functionality for importing data (they get imported as a matrix which
can then be processed in various ways), visualization, and processing,
largely in a forestry context.

Hope that helps,
Mike

On Thu, Feb 11, 2016 at 2:40 PM, Clay S <clayms at gmail.com> wrote:

> Hi
>
> Is it possible to import a Lidar LAS file into R with the
> rsaga.geoprocessor function of the RSAGA package.  The following code runs
> without an error, but all I get in R is the SAGA console output.
>
> The R code below does save a SAGA point cloud file called "test" in my
> working directory.  If I delete the `POINTS = "test"` parameter, then
> nothing happens as expected.  However, I want to work with the data in R,
> and pass the point cloud to other SAGA modules. This can be done in SAGA
> without having to save the point cloud.  Can the same be done from R?
>
> How can I get the point cloud imported into the R environment?  Do I need
> to coerce it into a matrix, data frame, or Spatial Points object?
>
>
> R code:
>
> ###############
>
> library(RSAGA)
>
>
> # Set RSAGA environment.
>
> env <- rsaga.env()
>
>
> # SET WORKING DIRECTORY FIRST!!
>
> dir <- getwd()
>
>
> # Get module parameters
>
> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
> recursive=FALSE)
>
>
> # send command to RSAGA
>
> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
> Files",
>                    param = list(FILES = lasfilelist[1], POINTS = "test",
>                                 T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
> u=FALSE,
>                                 n=TRUE, R=FALSE, G=FALSE, B=FALSE, e=FALSE,
> d=FALSE,
>                                 p=FALSE, C=FALSE, VALID=FALSE,
> RGB_RANGE=FALSE),
>                    env = env)
>
> ###################
>
>
> Here is the console output (the test variable stores the same thing):
>
> ###########
>
> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
> library name: Import/Export - LAS
> tool name   : Import LAS Files
> author      : O. Conrad, V. Wichmann (c) 2009
>
> Parameters
>
> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
> Point Clouds: No objects
> gps-time: yes
> intensity: yes
> scan angle: no
> number of the return: yes
> classification: no
> user data: no
> number of returns of given pulse: yes
> red channel color: no
> green channel color: no
> blue channel color: no
> edge of flight line flag: no
> direction of scan flag: no
> point source ID: no
> rgb color: no
> Check Point Validity: no
> R,G,B value range: 16 bit
>
> Parsing AX300711.las ...
> Save point cloud: test...
>
> ################
>
>
> Here is my env:
>
> ################
>
> > env
>
> $workspace
>
> [1] "."
>
>
> $cmd
>
> [1] "saga_cmd.exe"
>
>
> $path
>
> [1] "C:\\OSGeo4W64\\apps\\saga"
>
>
> $modules
>
> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>
>
> $version
>
> [1] "2.1.2"
>
>
> $cores
>
> [1] NA
>
>
> $parallel
>
> [1] FALSE
>
>
> $lib.prefix
>
> [1] ""
>
> #################
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Fri Feb 12 07:44:33 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 12 Feb 2016 06:44:33 +0000
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
Message-ID: <CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>

Try rLidar::readLAS as a straightforward alternative, it's not bullet proof
but works fine for a lot of examples. Happy to help extend it if your
format is not supported.

Cheers, Mike

On Fri, 12 Feb 2016 7:41 am Clay S <clayms at gmail.com> wrote:

> Hi
>
> Is it possible to import a Lidar LAS file into R with the
> rsaga.geoprocessor function of the RSAGA package.  The following code runs
> without an error, but all I get in R is the SAGA console output.
>
> The R code below does save a SAGA point cloud file called "test" in my
> working directory.  If I delete the `POINTS = "test"` parameter, then
> nothing happens as expected.  However, I want to work with the data in R,
> and pass the point cloud to other SAGA modules. This can be done in SAGA
> without having to save the point cloud.  Can the same be done from R?
>
> How can I get the point cloud imported into the R environment?  Do I need
> to coerce it into a matrix, data frame, or Spatial Points object?
>
>
> R code:
>
> ###############
>
> library(RSAGA)
>
>
> # Set RSAGA environment.
>
> env <- rsaga.env()
>
>
> # SET WORKING DIRECTORY FIRST!!
>
> dir <- getwd()
>
>
> # Get module parameters
>
> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
> recursive=FALSE)
>
>
> # send command to RSAGA
>
> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
> Files",
>                    param = list(FILES = lasfilelist[1], POINTS = "test",
>                                 T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
> u=FALSE,
>                                 n=TRUE, R=FALSE, G=FALSE, B=FALSE, e=FALSE,
> d=FALSE,
>                                 p=FALSE, C=FALSE, VALID=FALSE,
> RGB_RANGE=FALSE),
>                    env = env)
>
> ###################
>
>
> Here is the console output (the test variable stores the same thing):
>
> ###########
>
> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
> library name: Import/Export - LAS
> tool name   : Import LAS Files
> author      : O. Conrad, V. Wichmann (c) 2009
>
> Parameters
>
> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
> Point Clouds: No objects
> gps-time: yes
> intensity: yes
> scan angle: no
> number of the return: yes
> classification: no
> user data: no
> number of returns of given pulse: yes
> red channel color: no
> green channel color: no
> blue channel color: no
> edge of flight line flag: no
> direction of scan flag: no
> point source ID: no
> rgb color: no
> Check Point Validity: no
> R,G,B value range: 16 bit
>
> Parsing AX300711.las ...
> Save point cloud: test...
>
> ################
>
>
> Here is my env:
>
> ################
>
> > env
>
> $workspace
>
> [1] "."
>
>
> $cmd
>
> [1] "saga_cmd.exe"
>
>
> $path
>
> [1] "C:\\OSGeo4W64\\apps\\saga"
>
>
> $modules
>
> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>
>
> $version
>
> [1] "2.1.2"
>
>
> $cores
>
> [1] NA
>
>
> $parallel
>
> [1] FALSE
>
>
> $lib.prefix
>
> [1] ""
>
> #################
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From clayms at gmail.com  Fri Feb 12 07:47:49 2016
From: clayms at gmail.com (Clay S)
Date: Fri, 12 Feb 2016 19:47:49 +1300
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAPKp32vezkFp40Atke1LDUh4ysX3=+p6svoXUK149g3xzXuskw@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
	<CAPKp32vezkFp40Atke1LDUh4ysX3=+p6svoXUK149g3xzXuskw@mail.gmail.com>
Message-ID: <CAFkR0r9rhj=ggKinJaKwMyHfVMeQ5n=AZgAm-UMPUQS_f0mgnQ@mail.gmail.com>

Thanks Michael.

I did try the rLidar package.  What I was trying to do is run a series of
SAGA modules on the Lidar data and then load the final raster output into
R.  I don't necessarily need the Lidar data in R.  But how do I pass the
Lidar data to the next SAGA module within R?  I assume this can be done in
Python or in a Command batch file without having to save each step.  So,
how do I do the same thing in R?

Thanks
Clay

On Fri, Feb 12, 2016 at 12:26 PM, Michael Treglia <mtreglia at gmail.com>
wrote:

> Hi Clay,
>
> At some point I was looking into something similar, and don't think you
> can do that with RSAGA.  rsaga.geoprocessor() is running things as a system
> commands (like running from the command line directly), so it is not
> bringing the Lidar data into R, if I recall correctly.
>
> One package you might want to look into is rLidar:
> https://cran.r-project.org/web/packages/rLiDAR/index.html - it has some
> good functionality for importing data (they get imported as a matrix which
> can then be processed in various ways), visualization, and processing,
> largely in a forestry context.
>
> Hope that helps,
> Mike
>
> On Thu, Feb 11, 2016 at 2:40 PM, Clay S <clayms at gmail.com> wrote:
>
>> Hi
>>
>> Is it possible to import a Lidar LAS file into R with the
>> rsaga.geoprocessor function of the RSAGA package.  The following code runs
>> without an error, but all I get in R is the SAGA console output.
>>
>> The R code below does save a SAGA point cloud file called "test" in my
>> working directory.  If I delete the `POINTS = "test"` parameter, then
>> nothing happens as expected.  However, I want to work with the data in R,
>> and pass the point cloud to other SAGA modules. This can be done in SAGA
>> without having to save the point cloud.  Can the same be done from R?
>>
>> How can I get the point cloud imported into the R environment?  Do I need
>> to coerce it into a matrix, data frame, or Spatial Points object?
>>
>>
>> R code:
>>
>> ###############
>>
>> library(RSAGA)
>>
>>
>> # Set RSAGA environment.
>>
>> env <- rsaga.env()
>>
>>
>> # SET WORKING DIRECTORY FIRST!!
>>
>> dir <- getwd()
>>
>>
>> # Get module parameters
>>
>> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
>> recursive=FALSE)
>>
>>
>> # send command to RSAGA
>>
>> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
>> Files",
>>                    param = list(FILES = lasfilelist[1], POINTS = "test",
>>                                 T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
>> u=FALSE,
>>                                 n=TRUE, R=FALSE, G=FALSE, B=FALSE,
>> e=FALSE,
>> d=FALSE,
>>                                 p=FALSE, C=FALSE, VALID=FALSE,
>> RGB_RANGE=FALSE),
>>                    env = env)
>>
>> ###################
>>
>>
>> Here is the console output (the test variable stores the same thing):
>>
>> ###########
>>
>> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
>> library name: Import/Export - LAS
>> tool name   : Import LAS Files
>> author      : O. Conrad, V. Wichmann (c) 2009
>>
>> Parameters
>>
>> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
>> Point Clouds: No objects
>> gps-time: yes
>> intensity: yes
>> scan angle: no
>> number of the return: yes
>> classification: no
>> user data: no
>> number of returns of given pulse: yes
>> red channel color: no
>> green channel color: no
>> blue channel color: no
>> edge of flight line flag: no
>> direction of scan flag: no
>> point source ID: no
>> rgb color: no
>> Check Point Validity: no
>> R,G,B value range: 16 bit
>>
>> Parsing AX300711.las ...
>> Save point cloud: test...
>>
>> ################
>>
>>
>> Here is my env:
>>
>> ################
>>
>> > env
>>
>> $workspace
>>
>> [1] "."
>>
>>
>> $cmd
>>
>> [1] "saga_cmd.exe"
>>
>>
>> $path
>>
>> [1] "C:\\OSGeo4W64\\apps\\saga"
>>
>>
>> $modules
>>
>> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>>
>>
>> $version
>>
>> [1] "2.1.2"
>>
>>
>> $cores
>>
>> [1] NA
>>
>>
>> $parallel
>>
>> [1] FALSE
>>
>>
>> $lib.prefix
>>
>> [1] ""
>>
>> #################
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From clayms at gmail.com  Fri Feb 12 07:51:49 2016
From: clayms at gmail.com (Clay S)
Date: Fri, 12 Feb 2016 19:51:49 +1300
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
	<CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>
Message-ID: <CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>

Thanks Michael Sumner

rLidar works well.  But how do I pass the lidar data to another SAGA module
within R without saving the output of each step as a file in a whole series
of SAGA module calls from R?

I would like something like the dplyr %>% pipe command.

Thanks
Clay

On Fri, Feb 12, 2016 at 7:44 PM, Michael Sumner <mdsumner at gmail.com> wrote:

> Try rLidar::readLAS as a straightforward alternative, it's not bullet
> proof but works fine for a lot of examples. Happy to help extend it if your
> format is not supported.
>
> Cheers, Mike
>
> On Fri, 12 Feb 2016 7:41 am Clay S <clayms at gmail.com> wrote:
>
>> Hi
>>
>> Is it possible to import a Lidar LAS file into R with the
>> rsaga.geoprocessor function of the RSAGA package.  The following code runs
>> without an error, but all I get in R is the SAGA console output.
>>
>> The R code below does save a SAGA point cloud file called "test" in my
>> working directory.  If I delete the `POINTS = "test"` parameter, then
>> nothing happens as expected.  However, I want to work with the data in R,
>> and pass the point cloud to other SAGA modules. This can be done in SAGA
>> without having to save the point cloud.  Can the same be done from R?
>>
>> How can I get the point cloud imported into the R environment?  Do I need
>> to coerce it into a matrix, data frame, or Spatial Points object?
>>
>>
>> R code:
>>
>> ###############
>>
>> library(RSAGA)
>>
>>
>> # Set RSAGA environment.
>>
>> env <- rsaga.env()
>>
>>
>> # SET WORKING DIRECTORY FIRST!!
>>
>> dir <- getwd()
>>
>>
>> # Get module parameters
>>
>> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
>> recursive=FALSE)
>>
>>
>> # send command to RSAGA
>>
>> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
>> Files",
>>                    param = list(FILES = lasfilelist[1], POINTS = "test",
>>                                 T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
>> u=FALSE,
>>                                 n=TRUE, R=FALSE, G=FALSE, B=FALSE,
>> e=FALSE,
>> d=FALSE,
>>                                 p=FALSE, C=FALSE, VALID=FALSE,
>> RGB_RANGE=FALSE),
>>                    env = env)
>>
>> ###################
>>
>>
>> Here is the console output (the test variable stores the same thing):
>>
>> ###########
>>
>> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
>> library name: Import/Export - LAS
>> tool name   : Import LAS Files
>> author      : O. Conrad, V. Wichmann (c) 2009
>>
>> Parameters
>>
>> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
>> Point Clouds: No objects
>> gps-time: yes
>> intensity: yes
>> scan angle: no
>> number of the return: yes
>> classification: no
>> user data: no
>> number of returns of given pulse: yes
>> red channel color: no
>> green channel color: no
>> blue channel color: no
>> edge of flight line flag: no
>> direction of scan flag: no
>> point source ID: no
>> rgb color: no
>> Check Point Validity: no
>> R,G,B value range: 16 bit
>>
>> Parsing AX300711.las ...
>> Save point cloud: test...
>>
>> ################
>>
>>
>> Here is my env:
>>
>> ################
>>
>> > env
>>
>> $workspace
>>
>> [1] "."
>>
>>
>> $cmd
>>
>> [1] "saga_cmd.exe"
>>
>>
>> $path
>>
>> [1] "C:\\OSGeo4W64\\apps\\saga"
>>
>>
>> $modules
>>
>> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>>
>>
>> $version
>>
>> [1] "2.1.2"
>>
>>
>> $cores
>>
>> [1] NA
>>
>>
>> $parallel
>>
>> [1] FALSE
>>
>>
>> $lib.prefix
>>
>> [1] ""
>>
>> #################
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Fri Feb 12 09:32:46 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Fri, 12 Feb 2016 09:32:46 +0100
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
	<CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>
	<CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>
Message-ID: <56BD98AE.4020200@uni-marburg.de>

Hi Clay,

RSAGA provides a comfortable platform independent system wrapper for 
SAGA but as stated  no two-way bindings.

If you want to make use of SAGA algorithms () it is IMHO the most 
straightforward way to import and export the raster files using the e.g. 
gdalUtils. If you use raster() directly please note that it may produce 
problems writing SAGA files directly. To avoid format complications  I 
use  most of the time GTiff. You can easily integrate the power of 
rLidar in this workaround concept.
A typical work flow may look like:


  # gdalwarp is used to convert the data format to SAGA
  # you may assign the projection information to the data (like example 
or change it with t_srs=)
   gdalwarp(file.in, file.out, overwrite=TRUE, 
s_srs=paste0('EPSG:',epsg.code), of='SAGA')

  # do something in SAGA using the files on the disk storage as "interface"
  # note SAGA works much more stable under differnet platforms when you 
provide the env settings

   # e.g. calculate wood's terrain indices   wood= 
1=planar,2=pit,3=channel,4=pass,5=ridge,6=peak
     rsaga.geoprocessor('ta_morphometry',"Morphometric Features",env=myenv,
                        list(DEM='mp_dem.sgrd',
                             FEATURES='mp_wood.sgrd',
                             SLOPE='mp_slope.sgrd',
                             LONGC='mp_longcurv.sgrd',
                             CROSC='mp_crosscurv.sgrd',
                             MINIC='mp_mincurv.sgrd',
                             MAXIC='mp_maxcurv.sgrd',
                             TOL_SLOPE=14.000000
                             TOL_CURVE=0.00001
                             EXPONENT=0.000000
                             ZSCALE=1.000000))

     # read whatever you wand directly using raster()
     peak.area<-raster('mp_wood.sdat')

For using SAGA and/or GRASS in a "mixed" environment with R you may find 
some help at our course pages:
  http://moc.environmentalinformatics-marburg.de/doku.php?id=courses:msc:advanced-gis:lecture-notes:ag-ln-06

cheers Chris


Am 12.02.2016 um 07:51 schrieb Clay S:
> Thanks Michael Sumner
>
> rLidar works well.  But how do I pass the lidar data to another SAGA module
> within R without saving the output of each step as a file in a whole series
> of SAGA module calls from R?
>
> I would like something like the dplyr %>% pipe command.
>
> Thanks
> Clay
>
> On Fri, Feb 12, 2016 at 7:44 PM, Michael Sumner <mdsumner at gmail.com> wrote:
>
>> Try rLidar::readLAS as a straightforward alternative, it's not bullet
>> proof but works fine for a lot of examples. Happy to help extend it if your
>> format is not supported.
>>
>> Cheers, Mike
>>
>> On Fri, 12 Feb 2016 7:41 am Clay S <clayms at gmail.com> wrote:
>>
>>> Hi
>>>
>>> Is it possible to import a Lidar LAS file into R with the
>>> rsaga.geoprocessor function of the RSAGA package.  The following code runs
>>> without an error, but all I get in R is the SAGA console output.
>>>
>>> The R code below does save a SAGA point cloud file called "test" in my
>>> working directory.  If I delete the `POINTS = "test"` parameter, then
>>> nothing happens as expected.  However, I want to work with the data in R,
>>> and pass the point cloud to other SAGA modules. This can be done in SAGA
>>> without having to save the point cloud.  Can the same be done from R?
>>>
>>> How can I get the point cloud imported into the R environment?  Do I need
>>> to coerce it into a matrix, data frame, or Spatial Points object?
>>>
>>>
>>> R code:
>>>
>>> ###############
>>>
>>> library(RSAGA)
>>>
>>>
>>> # Set RSAGA environment.
>>>
>>> env <- rsaga.env()
>>>
>>>
>>> # SET WORKING DIRECTORY FIRST!!
>>>
>>> dir <- getwd()
>>>
>>>
>>> # Get module parameters
>>>
>>> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
>>> recursive=FALSE)
>>>
>>>
>>> # send command to RSAGA
>>>
>>> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
>>> Files",
>>>                     param = list(FILES = lasfilelist[1], POINTS = "test",
>>>                                  T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
>>> u=FALSE,
>>>                                  n=TRUE, R=FALSE, G=FALSE, B=FALSE,
>>> e=FALSE,
>>> d=FALSE,
>>>                                  p=FALSE, C=FALSE, VALID=FALSE,
>>> RGB_RANGE=FALSE),
>>>                     env = env)
>>>
>>> ###################
>>>
>>>
>>> Here is the console output (the test variable stores the same thing):
>>>
>>> ###########
>>>
>>> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
>>> library name: Import/Export - LAS
>>> tool name   : Import LAS Files
>>> author      : O. Conrad, V. Wichmann (c) 2009
>>>
>>> Parameters
>>>
>>> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
>>> Point Clouds: No objects
>>> gps-time: yes
>>> intensity: yes
>>> scan angle: no
>>> number of the return: yes
>>> classification: no
>>> user data: no
>>> number of returns of given pulse: yes
>>> red channel color: no
>>> green channel color: no
>>> blue channel color: no
>>> edge of flight line flag: no
>>> direction of scan flag: no
>>> point source ID: no
>>> rgb color: no
>>> Check Point Validity: no
>>> R,G,B value range: 16 bit
>>>
>>> Parsing AX300711.las ...
>>> Save point cloud: test...
>>>
>>> ################
>>>
>>>
>>> Here is my env:
>>>
>>> ################
>>>
>>>> env
>>> $workspace
>>>
>>> [1] "."
>>>
>>>
>>> $cmd
>>>
>>> [1] "saga_cmd.exe"
>>>
>>>
>>> $path
>>>
>>> [1] "C:\\OSGeo4W64\\apps\\saga"
>>>
>>>
>>> $modules
>>>
>>> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>>>
>>>
>>> $version
>>>
>>> [1] "2.1.2"
>>>
>>>
>>> $cores
>>>
>>> [1] NA
>>>
>>>
>>> $parallel
>>>
>>> [1] FALSE
>>>
>>>
>>> $lib.prefix
>>>
>>> [1] ""
>>>
>>> #################
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mtreglia at gmail.com  Fri Feb 12 17:24:59 2016
From: mtreglia at gmail.com (Michael Treglia)
Date: Fri, 12 Feb 2016 10:24:59 -0600
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <56BD98AE.4020200@uni-marburg.de>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
	<CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>
	<CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>
	<56BD98AE.4020200@uni-marburg.de>
Message-ID: <CAPKp32snZazE1gQ_GZEtLq6v6B89fHCaSg7w6k1h=1wgzJWLKQ@mail.gmail.com>

In case it's of any use to others, I've been scripting some LiDAR
processing from R using LASTools, focused on dealing with many individual
las files.  At this point we've just been extracting a bunch of metadata
fields to get a sense of what we have, fixing some metadata errors that
we're aware of, and reprojecting data. We've got lots of data for a region
that are in various projections, and sometimes the LAS metadata are just
incorrect, so the functions as written are designed to help us deal with
those issues, but can easily be adapted for other purposes.

These functions use foreach and doparallel to use multi-core processors to
speed things along, running LasTools via system commands.  This work is
still in fairly early stages and admittedly needs some better organization
and documentation.  At this point, we've exclusively been calling on
LasTools functions that do not require a paid license, and plan to keep it
as such for now.

Also, we were exploring use on both linux and windows systems on an
external server, and the linux setups have been a lot faster, so functions
ending in unix.R are the most up to date [the changes to go back to windows
are pretty simple].  (as I said, we need to organize, but it is functional
for our purposes now...).

The code is available in a github repository:
https://github.com/mltConsEcol/OK_LiDAR_Processing

Feel free to contact me with questions on this code, suggestions, or want
to contribute any additions (and I'd be curious to hear if anybody does end
up using it). I think some future functions will call on the rLidar
package, and we'll see where our next steps take us...

Best,
mike






On Fri, Feb 12, 2016 at 2:32 AM, Chris Reudenbach <reudenbach at uni-marburg.de
> wrote:

> Hi Clay,
>
> RSAGA provides a comfortable platform independent system wrapper for SAGA
> but as stated  no two-way bindings.
>
> If you want to make use of SAGA algorithms () it is IMHO the most
> straightforward way to import and export the raster files using the e.g.
> gdalUtils. If you use raster() directly please note that it may produce
> problems writing SAGA files directly. To avoid format complications  I use
> most of the time GTiff. You can easily integrate the power of rLidar in
> this workaround concept.
> A typical work flow may look like:
>
>
>  # gdalwarp is used to convert the data format to SAGA
>  # you may assign the projection information to the data (like example or
> change it with t_srs=)
>   gdalwarp(file.in, file.out, overwrite=TRUE,
> s_srs=paste0('EPSG:',epsg.code), of='SAGA')
>
>  # do something in SAGA using the files on the disk storage as "interface"
>  # note SAGA works much more stable under differnet platforms when you
> provide the env settings
>
>   # e.g. calculate wood's terrain indices   wood=
> 1=planar,2=pit,3=channel,4=pass,5=ridge,6=peak
>     rsaga.geoprocessor('ta_morphometry',"Morphometric Features",env=myenv,
>                        list(DEM='mp_dem.sgrd',
>                             FEATURES='mp_wood.sgrd',
>                             SLOPE='mp_slope.sgrd',
>                             LONGC='mp_longcurv.sgrd',
>                             CROSC='mp_crosscurv.sgrd',
>                             MINIC='mp_mincurv.sgrd',
>                             MAXIC='mp_maxcurv.sgrd',
>                             TOL_SLOPE=14.000000
>                             TOL_CURVE=0.00001
>                             EXPONENT=0.000000
>                             ZSCALE=1.000000))
>
>     # read whatever you wand directly using raster()
>     peak.area<-raster('mp_wood.sdat')
>
> For using SAGA and/or GRASS in a "mixed" environment with R you may find
> some help at our course pages:
>
> http://moc.environmentalinformatics-marburg.de/doku.php?id=courses:msc:advanced-gis:lecture-notes:ag-ln-06
>
> cheers Chris
>
>
>
> Am 12.02.2016 um 07:51 schrieb Clay S:
>
>> Thanks Michael Sumner
>>
>> rLidar works well.  But how do I pass the lidar data to another SAGA
>> module
>> within R without saving the output of each step as a file in a whole
>> series
>> of SAGA module calls from R?
>>
>> I would like something like the dplyr %>% pipe command.
>>
>> Thanks
>> Clay
>>
>> On Fri, Feb 12, 2016 at 7:44 PM, Michael Sumner <mdsumner at gmail.com>
>> wrote:
>>
>> Try rLidar::readLAS as a straightforward alternative, it's not bullet
>>> proof but works fine for a lot of examples. Happy to help extend it if
>>> your
>>> format is not supported.
>>>
>>> Cheers, Mike
>>>
>>> On Fri, 12 Feb 2016 7:41 am Clay S <clayms at gmail.com> wrote:
>>>
>>> Hi
>>>>
>>>> Is it possible to import a Lidar LAS file into R with the
>>>> rsaga.geoprocessor function of the RSAGA package.  The following code
>>>> runs
>>>> without an error, but all I get in R is the SAGA console output.
>>>>
>>>> The R code below does save a SAGA point cloud file called "test" in my
>>>> working directory.  If I delete the `POINTS = "test"` parameter, then
>>>> nothing happens as expected.  However, I want to work with the data in
>>>> R,
>>>> and pass the point cloud to other SAGA modules. This can be done in SAGA
>>>> without having to save the point cloud.  Can the same be done from R?
>>>>
>>>> How can I get the point cloud imported into the R environment?  Do I
>>>> need
>>>> to coerce it into a matrix, data frame, or Spatial Points object?
>>>>
>>>>
>>>> R code:
>>>>
>>>> ###############
>>>>
>>>> library(RSAGA)
>>>>
>>>>
>>>> # Set RSAGA environment.
>>>>
>>>> env <- rsaga.env()
>>>>
>>>>
>>>> # SET WORKING DIRECTORY FIRST!!
>>>>
>>>> dir <- getwd()
>>>>
>>>>
>>>> # Get module parameters
>>>>
>>>> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
>>>> recursive=FALSE)
>>>>
>>>>
>>>> # send command to RSAGA
>>>>
>>>> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
>>>> Files",
>>>>                     param = list(FILES = lasfilelist[1], POINTS =
>>>> "test",
>>>>                                  T=TRUE, i=TRUE, a=FALSE, r=TRUE,
>>>> c=FALSE,
>>>> u=FALSE,
>>>>                                  n=TRUE, R=FALSE, G=FALSE, B=FALSE,
>>>> e=FALSE,
>>>> d=FALSE,
>>>>                                  p=FALSE, C=FALSE, VALID=FALSE,
>>>> RGB_RANGE=FALSE),
>>>>                     env = env)
>>>>
>>>> ###################
>>>>
>>>>
>>>> Here is the console output (the test variable stores the same thing):
>>>>
>>>> ###########
>>>>
>>>> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
>>>> library name: Import/Export - LAS
>>>> tool name   : Import LAS Files
>>>> author      : O. Conrad, V. Wichmann (c) 2009
>>>>
>>>> Parameters
>>>>
>>>> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
>>>> Point Clouds: No objects
>>>> gps-time: yes
>>>> intensity: yes
>>>> scan angle: no
>>>> number of the return: yes
>>>> classification: no
>>>> user data: no
>>>> number of returns of given pulse: yes
>>>> red channel color: no
>>>> green channel color: no
>>>> blue channel color: no
>>>> edge of flight line flag: no
>>>> direction of scan flag: no
>>>> point source ID: no
>>>> rgb color: no
>>>> Check Point Validity: no
>>>> R,G,B value range: 16 bit
>>>>
>>>> Parsing AX300711.las ...
>>>> Save point cloud: test...
>>>>
>>>> ################
>>>>
>>>>
>>>> Here is my env:
>>>>
>>>> ################
>>>>
>>>> env
>>>>>
>>>> $workspace
>>>>
>>>> [1] "."
>>>>
>>>>
>>>> $cmd
>>>>
>>>> [1] "saga_cmd.exe"
>>>>
>>>>
>>>> $path
>>>>
>>>> [1] "C:\\OSGeo4W64\\apps\\saga"
>>>>
>>>>
>>>> $modules
>>>>
>>>> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>>>>
>>>>
>>>> $version
>>>>
>>>> [1] "2.1.2"
>>>>
>>>>
>>>> $cores
>>>>
>>>> [1] NA
>>>>
>>>>
>>>> $parallel
>>>>
>>>> [1] FALSE
>>>>
>>>>
>>>> $lib.prefix
>>>>
>>>> [1] ""
>>>>
>>>> #################
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>> --
>>> Dr. Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> 203 Channel Highway
>>> Kingston Tasmania 7050 Australia
>>>
>>>
>>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From clayms at gmail.com  Sat Feb 13 08:17:43 2016
From: clayms at gmail.com (Clay S)
Date: Sat, 13 Feb 2016 20:17:43 +1300
Subject: [R-sig-Geo] LiDAR LAS file import into R via RSAGA
In-Reply-To: <CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>
References: <CAFkR0r_Eb=AqkMdG1a8oFQyP3uNmb8vx+ZeOmhOzWuAvVoM6Cw@mail.gmail.com>
	<CAAcGz9-4UYH0v0HaOA9=i4z41W_44e7FMNvncGOzQD6s+gjvRg@mail.gmail.com>
	<CAFkR0r9vHgh0P+MNLKx=tJyqQsPZ1DinGs9qXgKcCXcNPtmq0w@mail.gmail.com>
Message-ID: <CAFkR0r-YWsbsCjk9+zSFoXZyZ1AXO5mKpzJTM_G5igSy=GS0_g@mail.gmail.com>

Another option would be to create a SAGA tool chain XML file following the
tutorials by Michael Bock, Olaf Conrad, Volker Wichmann, and drag that XML
file into the SAGA module library.  Does anyone know if you can access your
own SAGA tool chains with the RSAGA::rsaga.geoprocessor command?  I suppose
the parameters for each module in the chain would be set according to the
XML file.  If that is the case, then I also suppose you could edit the XML
file with R before you run the tool chain.  But I am getting ahead of
myself.

Unfortunately, the most recent version of SAGA that the OSGeo4W is 2.1.2-1,
which does not have the tool chains feature. That was added in SAGA 2.1.3.
Does anyone know when OSGeo4W will get updated?





On Fri, Feb 12, 2016 at 7:51 PM, Clay S <clayms at gmail.com> wrote:

> Thanks Michael Sumner
>
> rLidar works well.  But how do I pass the lidar data to another SAGA
> module within R without saving the output of each step as a file in a whole
> series of SAGA module calls from R?
>
> I would like something like the dplyr %>% pipe command.
>
> Thanks
> Clay
>
> On Fri, Feb 12, 2016 at 7:44 PM, Michael Sumner <mdsumner at gmail.com>
> wrote:
>
>> Try rLidar::readLAS as a straightforward alternative, it's not bullet
>> proof but works fine for a lot of examples. Happy to help extend it if your
>> format is not supported.
>>
>> Cheers, Mike
>>
>> On Fri, 12 Feb 2016 7:41 am Clay S <clayms at gmail.com> wrote:
>>
>>> Hi
>>>
>>> Is it possible to import a Lidar LAS file into R with the
>>> rsaga.geoprocessor function of the RSAGA package.  The following code
>>> runs
>>> without an error, but all I get in R is the SAGA console output.
>>>
>>> The R code below does save a SAGA point cloud file called "test" in my
>>> working directory.  If I delete the `POINTS = "test"` parameter, then
>>> nothing happens as expected.  However, I want to work with the data in R,
>>> and pass the point cloud to other SAGA modules. This can be done in SAGA
>>> without having to save the point cloud.  Can the same be done from R?
>>>
>>> How can I get the point cloud imported into the R environment?  Do I need
>>> to coerce it into a matrix, data frame, or Spatial Points object?
>>>
>>>
>>> R code:
>>> ###############
>>> library(RSAGA)
>>> # Set RSAGA environment.
>>> env <- rsaga.env()
>>>
>>> # SET WORKING DIRECTORY FIRST!!
>>> dir <- getwd()
>>>
>>> # Get module parameters
>>> lasfilelist <- list.files(dir, pattern =".las$", full.names=TRUE,
>>> recursive=FALSE)
>>>
>>> # send command to RSAGA
>>> test <- rsaga.geoprocessor(lib = "io_shapes_las", module = "Import LAS
>>> Files",
>>>                    param = list(FILES = lasfilelist[1], POINTS = "test",
>>>                                 T=TRUE, i=TRUE, a=FALSE, r=TRUE, c=FALSE,
>>> u=FALSE,
>>>                                 n=TRUE, R=FALSE, G=FALSE, B=FALSE,
>>> e=FALSE,
>>> d=FALSE,
>>>                                 p=FALSE, C=FALSE, VALID=FALSE,
>>> RGB_RANGE=FALSE),
>>>                    env = env)
>>> ###################
>>> Here is the console output (the test variable stores the same thing):
>>> ###########
>>> library path: C:\OSGEO4~1\apps\saga\modules\io_shapes_las.dll
>>> library name: Import/Export - LAS
>>> tool name   : Import LAS Files
>>> author      : O. Conrad, V. Wichmann (c) 2009
>>>
>>> Parameters
>>>
>>> Input Files: "C:/Users/whcms0/'.CPT/Tarewa/Lidar/AX300711.las"
>>> Point Clouds: No objects
>>> gps-time: yes
>>> intensity: yes
>>> scan angle: no
>>> number of the return: yes
>>> classification: no
>>> user data: no
>>> number of returns of given pulse: yes
>>> red channel color: no
>>> green channel color: no
>>> blue channel color: no
>>> edge of flight line flag: no
>>> direction of scan flag: no
>>> point source ID: no
>>> rgb color: no
>>> Check Point Validity: no
>>> R,G,B value range: 16 bit
>>>
>>> Parsing AX300711.las ...
>>> Save point cloud: test...
>>>
>>> ################
>>> Here is my env:
>>> ################
>>> > env
>>> $workspace
>>> [1] "."
>>> $cmd
>>> [1] "saga_cmd.exe"
>>> $path
>>> [1] "C:\\OSGeo4W64\\apps\\saga"
>>> $modules
>>> [1] "C:\\OSGeo4W64\\apps\\saga/modules"
>>> $version
>>> [1] "2.1.2"
>>> $cores
>>> [1] NA
>>> $parallel
>>> [1] FALSE
>>> $lib.prefix
>>> [1] ""
>>> #################
>>>
>>>         [[alternative HTML version deleted]]
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Sat Feb 13 15:19:05 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 13 Feb 2016 15:19:05 +0100
Subject: [R-sig-Geo] LM test for spatial dependence with panel data
In-Reply-To: <004601d1629f$3c8f9560$b5aec020$@sowi.uni-kl.de>
References: <004601d1629f$3c8f9560$b5aec020$@sowi.uni-kl.de>
Message-ID: <alpine.LFD.2.20.1602131512150.12570@reclus.nhh.no>

On Mon, 8 Feb 2016, Tobias R?ttenauer wrote:

> Dear list members,
>
> I'm currently estimating a fixed effects panel model and I want to control
> for spatial dependence. Thus, I also estimated two spatial fe-models, one
> with a spatial error term and one with a spatial error term and spatial lag
> variable. Both lambda and rho are highly significant and the independent
> variables of the models differ considerably.
>
> However, I would like to control the model specifications with a Lagrange
> Multiplier test. More precisely, I would like to test for spatial lag
> dependence (while allowing possible spatial error dependence) and for
> spatial error dependence (while allowing possible spatial lag dependence)
> like described by Anselin/ Bera/ Florax/ Yoon (1996), which is possible for
> cross-sectional data using lm.LMtests (spdep). Is there a possibility to
> estimate a similar test for panel data? If I'm not mistaking, the
> splm-implemented tests do not account for spatial lag dependence?
>

You may be able to test the pooled model only using lm() on the data and 
taking a Kronecker product of your spatial weights by a time-dimensioned 
identity matrix, and using the function for cross-sectional models, but I 
guess that this is not what you want. You'd need to identify an 
appropriate test in the literature, and see whether it can be implemented 
(and whether then it actually works). In many cases, significant lag and 
error processes together are related to missing variables, and to spatial 
processes not matching the spatial units - aggregates - you are using.

Hope this helps,

Roger

> Thank you very much in advance for your help!
>
> Best,
> Tobi
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From Roger.Bivand at nhh.no  Sat Feb 13 15:37:32 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sat, 13 Feb 2016 15:37:32 +0100
Subject: [R-sig-Geo] Geographic/Spatial Clustering - pyCluster for R?
In-Reply-To: <CAGBzUO881h7ssnWP2xgGOT_tb9BPe-4RZFTtTU9Sg8SohVfMew@mail.gmail.com>
References: <CAGBzUO881h7ssnWP2xgGOT_tb9BPe-4RZFTtTU9Sg8SohVfMew@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602131534510.12570@reclus.nhh.no>

On Wed, 10 Feb 2016, Mark R Payne wrote:

> Hi,
>
> I have recently stumbled across the pyCluster package in Python that does
> Geographical/Spatial clustering i.e. aggregating spatial pixels/polygons
> together based on both their "similarity" and being geographical neighbours
> - see here: https://pypi.python.org/pypi/clusterPy/0.9.9
>
> Does anyone know of an interface to use this library in R, or an
> implementation of similar tools in R?

Feel free to contribute an interface. There is spdep::skater for 
regionalisation, and some functions in DCluster answering rather 
different questions - my guess is that Skater is more efficient than these 
largely legacy methods. However, comparisons would be very useful.

Roger

>
> The clustering algorithms availabe in the package are:
>
>   - Arisel [Duque_Church2004]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-church2004>:
>   - AZP [Openshaw_Rao1995]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>:
>   - AZP-Simulated Annealing [Openshaw_Rao1995]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
>   - AZP-Tabu [Openshaw_Rao1995]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
>   - AZP-R-Tabu [Openshaw_Rao1995]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#openshaw-rao1995>.
>   - Max-p-regions (Tabu) [Duque_Anselin_Rey2010]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-anselin-rey2010>.
>   - AMOEBA [Alstadt_Getis2006]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#alstadt-getis2006>,
>   [Duque_Alstadt_Velasquez_Franco_Betancourt2010]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#duque-alstadt-velasquez-franco-betancourt2010>
>   .
>   - SOM [Kohonen1990]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#kohonen1990>.
>   - geoSOM [Bacao_Lobo_Painho2004]
>   <https://pypi.python.org/pypi/clusterPy/0.9.9#bacao-lobo-painho2004>.
>   - Random
>
> Best wishes,
>
> Mark
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From Roger.Bivand at nhh.no  Sun Feb 14 13:47:47 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 14 Feb 2016 13:47:47 +0100
Subject: [R-sig-Geo] rgeos::gBuffer(, byid=TRUE) fails
In-Reply-To: <CAOwKfPT4wcpiMc=DX1qKsKK66uAd4ndah+o4XsAacLzKT-P3xA@mail.gmail.com>
References: <CAOwKfPQeeMNrZhp=j-a6WxgD4HJjaynxWJvm9LNkwvbL4A6Muw@mail.gmail.com>
	<CAOwKfPRvowAiy9hfCZNgW+ueNnMjHwGYREoidjWFKMX8kydJaA@mail.gmail.com>
	<alpine.LFD.2.20.1602082118460.1967@reclus.nhh.no>
	<alpine.LFD.2.20.1602091357060.14152@reclus.nhh.no>
	<CAOwKfPT4wcpiMc=DX1qKsKK66uAd4ndah+o4XsAacLzKT-P3xA@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602141345440.24716@reclus.nhh.no>

On Tue, 9 Feb 2016, Josh O'Brien wrote:

> On Tue, Feb 9, 2016 at 5:01 AM, Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> On Mon, 8 Feb 2016, Roger Bivand wrote:
>>
>>> On Mon, 8 Feb 2016, Josh O'Brien wrote:
>>>
>>>>  Oops. The post's title should have read "rgeos::gBuffer( , byid=TRUE)
>>>>  fails when...". (I inadvertently left out the `byid=TRUE` bit).
>>>>
>>>>  My apologies.
>>>>
>>>>  On Mon, Feb 8, 2016 at 9:59 AM, Josh O'Brien <joshmobrien at gmail.com>
>>>>  wrote:
>>>>>  Hello,
>>>>>>  Not sure if this would be considered a bug, but it did recently bite
>>>>>  me (and might bite others using gBuffer(..., byid=TRUE)
>>>>>  programatically).
>>>>>
>>>
>>>
>>> Thanks for a reproducible example - for rgeos 0.3-14 this gives a
>>> segfault, in 0.3-16 an error as the data.frame has only one row, but three
>>> Polygons objects are returned. As you note, the issue is triggered by
>>> byid=TRUE but there is only one input object; only one buffer is created,
>>> around the NE island.
>>>
>>> I'll look into this - it'll need debugging in C, close to recent bug-fixes
>>> (then concerned with pre-sp-MultiPoint object signalling - multiple objects
>>> making up features).
>>
>>
>> I have committed a fix to R-Forge (checking whether the length of spgeom ==
>> 1 and byid == TRUE, if so set byid=FALSE and warn). The problem was visible
>> in the C code, but there we don't have an sp-class generic "length" measure
>> of the # features, so the modification is at the R level.
>>
>> Which OS would you like to test under?
>>
>
> I'm using it on Windows (with R-3.2.3) and Ubuntu 14.04 (with
> R-3.2.2), but am afraid I don't know how to install from sources on
> either. I'll test under both, but if I had to pick one, would go with
> Ubuntu, since that's where I'm doing my production work.

After some exchanges off-list, rgeos 0.3-17 has now reached CRAN with 
modifications handling the problem. Once again, the key was the simple, 
reproducible example.

Thanks to Josh for his help,

Roger

>
> Thanks so much,
>
> - Josh
>
>
>> Best wishes,
>>
>> Roger
>>
>>
>>>
>>> And yes, this is a reasonable place to report, it should give users a
>>> realistic view of how many corner cases actually exist and require someone's
>>> attention.
>>>
>>> Roger
>>>
>>>>>>      library(sp)
>>>>>      library(rgdal)
>>>>>      library(rgeos)
>>>>>>      ## Example SpatialPolygonsDataFrame
>>>>>      x <- readOGR(system.file("etc/shapes", package="spdep"), >
>>>>> "sids")[c(89,28),]
>>>>>      plot(x, col=c('dodgerblue', 'wheat'))
>>>>>>      ## Works fine on object with multiple @Polygons in @polygons,
>>>>>> even
>>>>>      ## if one of the @Polygons is multi-part
>>>>>      gBuffer(x, width=0.01, byid=TRUE)
>>>>>>      ## Works with a single single-part @Polygons object in @polygons
>>>>>      gBuffer(x[1,], width=0.01, byid=TRUE)
>>>>>>      ## Fails with a single _multi-part_ @Polygons object in
>>>>>> @polygons
>>>>>      gBuffer(x[2,], width=0.01, byid=TRUE)
>>>>>>>  Thanks (and please let me know an rgeos-specific note like this
>>>>>>> would
>>>>>  be better posted elsewhere),
>>>>>>  Josh O'Brien
>>>>
>>>>  _______________________________________________
>>>>  R-sig-Geo mailing list
>>>>  R-sig-Geo at r-project.org
>>>>  https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>> --
>> Roger Bivand
>> Department of Economics, Norwegian School of Economics,
>> Helleveien 30, N-5045 Bergen, Norway.
>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> e-mail: Roger.Bivand at nhh.no
>> http://orcid.org/0000-0003-2392-6140
>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> http://depsy.org/person/434412
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From bakht013 at umn.edu  Mon Feb 15 03:58:42 2016
From: bakht013 at umn.edu (Maryia Bakhtsiyarava)
Date: Sun, 14 Feb 2016 20:58:42 -0600
Subject: [R-sig-Geo] AIC/R^2 in splm
Message-ID: <CAKFowAiRdSkFHdAr3qp6zeH2_wvMXZNetwv+tjAGZRUX9CUEdg@mail.gmail.com>

Dear list members,

I am estimating a spatial lag model with time-period fixed effects using
package splm. I would like to obtain some goodness-of-fit measures for my
models but I cannot figure out how to do it. The traditional AIC extraction
function doesn't work for a an object of class "splm".

The only thing I can extract is the log likelihood, using which in theory I
can calculate AIC, but even in that case I am not sure about the degrees of
freedom to use in the calculation (do I count time dummies, lag and
intercept as parameters?). I tried df.residual(model) but I got NULL.

Is there another way to obtain AIC and/or R^2? I am sure people encountered
this problem before, so if you have any advice on how to obtain model
statistics, I would greatly appreciate it.

Thank you,
Maryia
-- 
Maryia Bakhtsiyarava
Graduate student
Department of Geography, Environment and Society
University of Minnesota, Twin Cities

Research Assistant
TerraPop Project
Minnesota Population Center

414 Social Sciences, 267 19th Ave S, Minneapolis, MN 55455

	[[alternative HTML version deleted]]


From ruettenauer at sowi.uni-kl.de  Mon Feb 15 09:33:44 2016
From: ruettenauer at sowi.uni-kl.de (=?iso-8859-1?Q?Tobias_R=FCttenauer?=)
Date: Mon, 15 Feb 2016 09:33:44 +0100
Subject: [R-sig-Geo] LM test for spatial dependence with panel data
Message-ID: <001501d167cb$950379b0$bf0a6d10$@sowi.uni-kl.de>

Dear Roger,

thanks for your answer!

 
> > Dear list members,
> >
> > I'm currently estimating a fixed effects panel model and I want to
> > control for spatial dependence. Thus, I also estimated two spatial
> > fe-models, one with a spatial error term and one with a spatial error
> > term and spatial lag variable. Both lambda and rho are highly
> > significant and the independent variables of the models differ
> considerably.
> >
> > However, I would like to control the model specifications with a
> > Lagrange Multiplier test. More precisely, I would like to test for
> > spatial lag dependence (while allowing possible spatial error
> > dependence) and for spatial error dependence (while allowing possible
> > spatial lag dependence) like described by Anselin/ Bera/ Florax/ Yoon
> > (1996), which is possible for cross-sectional data using lm.LMtests
> > (spdep). Is there a possibility to estimate a similar test for panel
> > data? If I'm not mistaking, the splm-implemented tests do not account
for
> spatial lag dependence?
> >
> 
> You may be able to test the pooled model only using lm() on the data and
> taking a Kronecker product of your spatial weights by a time-dimensioned
> identity matrix, and using the function for cross-sectional models, but I
guess
> that this is not what you want. 

I mean, one could argue that a cross-sectional spatial dependence also leads
to spatially correlated variations over time, but this is not necessarily
the case. So you are right, it would be the best to implement an appropriate
test (if feasible).

> You'd need to identify an appropriate test in
> the literature, and see whether it can be implemented (and whether then it
> actually works). In many cases, significant lag and error processes
together
> are related to missing variables, and to spatial processes not matching
the
> spatial units - aggregates - you are using.

You mean the error-correlation is a result of one or more omitted variables
that operate independently from the spatial relationship I modeled in the
spatial weights matrix? Then, it may be an idea to compare different
distance/neighborhood measures? Or do you mean it is a problem of the
aggregates itself (like too large spatial units)? 

Thanks again,
Tobi

> 
> Hope this helps,
> 
> Roger
> 
> > Thank you very much in advance for your help!
> >
> > Best,
> > Tobi
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics, Helleveien 30, N-
> 5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412


From cryan at binghamton.edu  Fri Feb 12 23:59:33 2016
From: cryan at binghamton.edu (Christopher W. Ryan)
Date: Fri, 12 Feb 2016 17:59:33 -0500
Subject: [R-sig-Geo] removing internal boundaries from a spatstat window
 that was created from three adjacent counties
Message-ID: <56BE63D5.5010707@binghamton.edu>

In spatstat, I want to create a single window from three adjacent
counties in New York State, USA.  My original data is a shapefile,
"cty036" showing all the New York State county boundaries.  Here's what
I've done so far:

========== begin code =========
library(shapefiles)
library(spatstat)
library(maptools)
library(sp)
library(RColorBrewer)
library(rgdal)

nysArea <- readOGR("C:/DATA/GeographicData", "cty036")

nysAreaUTM <- spTransform(nysArea, CRS("+proj=utm +zone=18 +ellps=GRS80
+units=m +no_defs"))

sremsAreaUTM <- subset(nysAreaUTM, NAME=="Broome" | NAME=="Tioga" |
NAME=="Chenango")

sremsWindow <- as(sremsAreaUTM, "owin")
======== end code =============


This works pretty well, producing a 3-county owin object. But the
dividing lines between the counties are shown in the window, whenever I
plot it or plot subsequent point patterns that use the window.  In
essence, in plots it looks like 3 polygons instead of one big one. I'd
prefer not to have the inter-county boundaries be visible--I'd rather
have just one big polygon for the whole area. How can I remove them?  Or
should I create the window differently from the get-go?

Thanks.

--Chris
-- 
Christopher W. Ryan, MD, MS
cryanatbinghamtondotedu
https://www.linkedin.com/in/ryancw

Early success is a terrible teacher. You?re essentially being rewarded
for a lack of preparation, so when you find yourself in a situation
where you must prepare, you can?t do it. You don?t know how.
--Chris Hadfield, An Astronaut's Guide to Life on Earth


From yoshida.gisc at gmail.com  Mon Feb 15 15:39:48 2016
From: yoshida.gisc at gmail.com (Takahiro Yoshida)
Date: Mon, 15 Feb 2016 23:39:48 +0900
Subject: [R-sig-Geo]  slope of regression line in moran scatter plot
Message-ID: <CABx47OZV0ofj11PSx46JK-qjxx0hho2feuk2qL6jRGXHnt6tYA@mail.gmail.com>

Dear list members,

In moran scatter plot, I checked
[1] Slope of lm((spatial lagged variable) ~ (variable)): moran coefficient
(spdep:::moran.plot),
[2] Slope of lm((spatial lagged standardized variable) ~ (standardized
variable)): moran coefficient, and
[3] Slope of lm((standardized spatial lagged variable) ~ (standardized
variable)): correlation coefficient.
However, I think Anselin (1999) remark case [3] is moran coefficient. Is it
true?

Anselin, L. (1999) Interactive techniques and exploratory spatial data
analysis. In: Longley P.A., Goodchild M.F., Maguire D.J., Rhind D.W. (eds)
Geographic information system: Principles, techniques, management and
applications, 253?266, Wiley, New York.

Thanks and regards,

Takahiro

--
Takahiro Yoshida
Ph.D. student
Real Estate & Spatial Statistics Laboratory
University of Tsukuba, Japan
E-mail: yoshida.takahiro at sk.tsukuba.ac.jp

	[[alternative HTML version deleted]]


From corey.sparks at utsa.edu  Mon Feb 15 16:13:12 2016
From: corey.sparks at utsa.edu (Corey Sparks)
Date: Mon, 15 Feb 2016 15:13:12 +0000
Subject: [R-sig-Geo] R-sig-Geo Digest, Vol 150, Issue 14
In-Reply-To: <mailman.9.1455534002.2471.r-sig-geo@r-project.org>
References: <mailman.9.1455534002.2471.r-sig-geo@r-project.org>
Message-ID: <E50069C2-014A-4912-BE27-177D5D017506@utsa.edu>

Hi Maryia,
What function are you using to fit the models? If you're using the fitting routines in spdep, (lagsarlm, errorsarlm, sacsarlm, spautolm) then the AIC prints for each model using the summary() function. You can also get a pseudo R^2 using the summary(fit, Nagelkerke=T) option

for example:
require(spdep)
data(oldcol)
COL.lag.eig <- lagsarlm(CRIME ~ INC + HOVAL, data=COL.OLD,
nb2listw(COL.nb, style="W"), method="eigen", quiet=FALSE)
summary(COL.lag.eig, Nagelkerke=T)

shows both the AIC and the pseudo R^2

Hope this helps

Corey Sparks, PhD
Associate Professor
Graduate Advisor of Record
Department of Demography
The University of Texas at San Antonio
501 West Cesar E Chavez Blvd
corey.sparks 'at' utsa.edu
coreysparks.weebly.com

On Feb 15, 2016, at 5:00 AM, r-sig-geo-request at r-project.org wrote:

Date: Sun, 14 Feb 2016 20:58:42 -0600
From: Maryia Bakhtsiyarava <bakht013 at umn.edu>
To: R-sig-geo Mailing List <r-sig-geo at r-project.org>
Subject: [R-sig-Geo] AIC/R^2 in splm
Message-ID:
<CAKFowAiRdSkFHdAr3qp6zeH2_wvMXZNetwv+tjAGZRUX9CUEdg at mail.gmail.com>
Content-Type: text/plain; charset="UTF-8"

Dear list members,

I am estimating a spatial lag model with time-period fixed effects using
package splm. I would like to obtain some goodness-of-fit measures for my
models but I cannot figure out how to do it. The traditional AIC extraction
function doesn't work for a an object of class "splm".

The only thing I can extract is the log likelihood, using which in theory I
can calculate AIC, but even in that case I am not sure about the degrees of
freedom to use in the calculation (do I count time dummies, lag and
intercept as parameters?). I tried df.residual(model) but I got NULL.

Is there another way to obtain AIC and/or R^2? I am sure people encountered
this problem before, so if you have any advice on how to obtain model
statistics, I would greatly appreciate it.

Thank you,
Maryia
--
Maryia Bakhtsiyarava
Graduate student
Department of Geography, Environment and Society
University of Minnesota, Twin Cities

Research Assistant
TerraPop Project
Minnesota Population Center

414 Social Sciences, 267 19th Ave S, Minneapolis, MN 55455

[[alternative HTML version deleted]]



------------------------------

Message: 3
Date: Mon, 15 Feb 2016 09:33:44 +0100
From: Tobias R?ttenauer <ruettenauer at sowi.uni-kl.de>
To: <Roger.Bivand at nhh.no>
Cc: R-sig-Geo at r-project.org
Subject: Re: [R-sig-Geo] LM test for spatial dependence with panel
data
Message-ID: <001501d167cb$950379b0$bf0a6d10$@sowi.uni-kl.de>
Content-Type: text/plain; charset="iso-8859-1"

Dear Roger,

thanks for your answer!


Dear list members,

I'm currently estimating a fixed effects panel model and I want to
control for spatial dependence. Thus, I also estimated two spatial
fe-models, one with a spatial error term and one with a spatial error
term and spatial lag variable. Both lambda and rho are highly
significant and the independent variables of the models differ
considerably.

However, I would like to control the model specifications with a
Lagrange Multiplier test. More precisely, I would like to test for
spatial lag dependence (while allowing possible spatial error
dependence) and for spatial error dependence (while allowing possible
spatial lag dependence) like described by Anselin/ Bera/ Florax/ Yoon
(1996), which is possible for cross-sectional data using lm.LMtests
(spdep). Is there a possibility to estimate a similar test for panel
data? If I'm not mistaking, the splm-implemented tests do not account
for
spatial lag dependence?


You may be able to test the pooled model only using lm() on the data and
taking a Kronecker product of your spatial weights by a time-dimensioned
identity matrix, and using the function for cross-sectional models, but I
guess
that this is not what you want.

I mean, one could argue that a cross-sectional spatial dependence also leads
to spatially correlated variations over time, but this is not necessarily
the case. So you are right, it would be the best to implement an appropriate
test (if feasible).

You'd need to identify an appropriate test in
the literature, and see whether it can be implemented (and whether then it
actually works). In many cases, significant lag and error processes
together
are related to missing variables, and to spatial processes not matching
the
spatial units - aggregates - you are using.

You mean the error-correlation is a result of one or more omitted variables
that operate independently from the spatial relationship I modeled in the
spatial weights matrix? Then, it may be an idea to compare different
distance/neighborhood measures? Or do you mean it is a problem of the
aggregates itself (like too large spatial units)?

Thanks again,
Tobi


Hope this helps,

Roger

Thank you very much in advance for your help!

Best,
Tobi

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Roger Bivand
Department of Economics, Norwegian School of Economics, Helleveien 30, N-
5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412



------------------------------

Subject: Digest Footer

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

------------------------------

End of R-sig-Geo Digest, Vol 150, Issue 14
******************************************



	[[alternative HTML version deleted]]


From timothee.giraud at ums-riate.fr  Mon Feb 15 17:29:22 2016
From: timothee.giraud at ums-riate.fr (=?UTF-8?Q?Timoth=c3=a9e_Giraud?=)
Date: Mon, 15 Feb 2016 17:29:22 +0100
Subject: [R-sig-Geo] Geographic/Spatial Clustering - pyCluster for R?
Message-ID: <56C1FCE2.8010909@ums-riate.fr>

Hello,
You could have a look at the ClustGeo package :
 >ClustGeo: Clustering of Observations with Geographical Constraints
 >Functions which allow to integrate geographical constraints in Ward 
hierarchical clustering. Geographical maps of typologies obtained can be 
displayed with the use of shapefiles.


From Dominik.Schneider at colorado.edu  Mon Feb 15 21:37:31 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Mon, 15 Feb 2016 13:37:31 -0700
Subject: [R-sig-Geo] different projection transformation R and gdal
	commandline
Message-ID: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>

Hi,
I'm struggling to use a custom projection. I am seeing differences with
someone using python proj4 bindings and when I compared my R results with
my commandline results I got even more confused. the coordinate
transformation is different for the two different methods.

could someone explain to me which one is wrong and why?
Thanks

R:
e=c(-112.25,-104.125,33,43.75)
box=as(extent(e),'SpatialPolygons')
proj4string(box)='+proj=longlat +datum=WGS84'
pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98
+x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
xmin(spTransform(box,CRS(pstring)))
## [1] -1306471
ymin(spTransform(box,CRS(pstring)))
## [1] -713442.3

commandline:
iMac:~ $ gdaltransform -s_srs "+proj=longlat +datum=WGS84" -t_srs
"+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0
+y_0
=0  +ellps=sphere  +a=6370000 +b=6370000 +units=m +no_defs"
-112.25 33.
-1306675.75472246 -629522.472322824 0

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Mon Feb 15 21:57:09 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Mon, 15 Feb 2016 13:57:09 -0700
Subject: [R-sig-Geo] different projection transformation R and gdal
	commandline
In-Reply-To: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
References: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
Message-ID: <CAHYDKLZYvetwuaiGLwCmxafmTTHn3V+A8uN-ebtsaQxT4=LwFA@mail.gmail.com>

Sorry, forgot to add the details. rgdal and gdal 1.11.3 were installed from
kyngchaos.com

> sessionInfo()
R version 3.2.3 (2015-12-10)
Platform: x86_64-apple-darwin14.5.0 (64-bit)
Running under: OS X 10.11.3 (El Capitan)

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods
base

other attached packages:
 [1] rasterVis_0.37      latticeExtra_0.6-26 lattice_0.20-33
broom_0.4.0
 [5] tidyr_0.3.1         dplyr_0.4.3         doMC_1.3.4
 iterators_1.0.8
 [9] foreach_1.4.3       ncdf4_1.15          gridExtra_2.0.0
spdep_0.5-92
[13] Matrix_1.2-3        ipred_0.9-5         MASS_7.3-45
RColorBrewer_1.1-2
[17] rgdal_1.0-7         stringr_1.0.0       ggplot2_2.0.0       plyr_1.8.3

[21] reshape2_1.4.1      raster_2.5-2        sp_1.2-1
 gstat_1.1-0
[25] ProjectTemplate_0.6

loaded via a namespace (and not attached):
 [1] zoo_1.7-12       splines_3.2.3    colorspace_1.2-6 spacetime_1.1-5
 [5] survival_2.38-3  prodlim_1.5.7    hexbin_1.27.1    DBI_0.3.1
 [9] lava_1.4.1       munsell_0.4.2    gtable_0.1.2     codetools_0.2-14
[13] coda_0.18-1      psych_1.5.8      labeling_0.3     class_7.3-14
[17] xts_0.9-7        Rcpp_0.12.2      scales_0.3.0     FNN_1.1
[21] deldir_0.1-9     mnormt_1.5-3     digest_0.6.8     stringi_1.0-1
[25] grid_3.2.3       tools_3.2.3      LearnBayes_2.15  magrittr_1.5
[29] lazyeval_0.1.10  assertthat_0.1   R6_2.1.1         rpart_4.1-10
[33] boot_1.3-17      intervals_0.15.1 nnet_7.3-11      nlme_3.1-122


Dominik Schneider
c 518.956.3978


On Mon, Feb 15, 2016 at 1:37 PM, Dominik Schneider <
dominik.schneider at colorado.edu> wrote:

> Hi,
> I'm struggling to use a custom projection. I am seeing differences with
> someone using python proj4 bindings and when I compared my R results with
> my commandline results I got even more confused. the coordinate
> transformation is different for the two different methods.
>
> could someone explain to me which one is wrong and why?
> Thanks
>
> R:
> e=c(-112.25,-104.125,33,43.75)
> box=as(extent(e),'SpatialPolygons')
> proj4string(box)='+proj=longlat +datum=WGS84'
> pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98
> +x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
> xmin(spTransform(box,CRS(pstring)))
> ## [1] -1306471
> ymin(spTransform(box,CRS(pstring)))
> ## [1] -713442.3
>
> commandline:
> iMac:~ $ gdaltransform -s_srs "+proj=longlat +datum=WGS84" -t_srs
> "+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0
> +y_0
> =0  +ellps=sphere  +a=6370000 +b=6370000 +units=m +no_defs"
> -112.25 33.
> -1306675.75472246 -629522.472322824 0
>
>

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Mon Feb 15 22:59:21 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Mon, 15 Feb 2016 22:59:21 +0100
Subject: [R-sig-Geo] different projection transformation R and gdal
 commandline
In-Reply-To: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
References: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
Message-ID: <56C24A39.90007@uni-marburg.de>

Hi Dominik,

If you use the gdalUtils package  there is no significant difference in 
the results using CLI or  R:

library(gdalUtils)
gdaltransform(s_srs="+proj=longlat +datum=WGS84", t_srs="+proj=lcc 
+lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0  
+ellps=sphere  +a=6370000 +b=6370000 +units=m 
+no_defs",coords=matrix(c(-112.25,33.0), ncol = 2))
          [,1]      [,2] [,3]
[1,] -1306676 -629522.5    0


If I use  spTransform I can reproduce your results:


loc <- c(-112.25,33.0)
loc <- data.frame(matrix(unlist(loc), nrow=1, 
byrow=T),stringsAsFactors=FALSE)
colnames(loc)<-c("lon","lat")
coordinates(loc)<- ~lon+lat
proj4string(loc)<- CRS("+proj=longlat +datum=WGS84 +no_defs")
loc<-spTransform(loc,CRS('+proj=lcc +lat_1=28 +lat_2=50 
+lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0 +ellps=sphere 
+a=6370000 +b=6370000 +units=m +no_defs'))
loc at coords
        lon     lat
1 -1306471 -629424

I suggest to focus on the sptransform() function

cheers Chris

 > sessionInfo()
R version 3.2.3 (2015-12-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 14.04.3 LTS

locale:
  [1] LC_CTYPE=de_DE.UTF-8       LC_NUMERIC=C LC_TIME=de_DE.UTF-8        
LC_COLLATE=de_DE.UTF-8
  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=de_DE.UTF-8 
LC_PAPER=de_DE.UTF-8       LC_NAME=C
  [9] LC_ADDRESS=C               LC_TELEPHONE=C 
LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods base

other attached packages:
[1] gdalUtils_2.0.1.7 raster_2.5-2      sp_1.2-2

loaded via a namespace (and not attached):
  [1] rgdal_1.1-3       tools_3.2.3       Rcpp_0.12.3 R.methodsS3_1.7.0 
codetools_0.2-14  grid_3.2.3
  [7] iterators_1.0.8   foreach_1.4.3     R.utils_2.2.0 
R.oo_1.19.0       lattice_0.20-33




Am 15.02.2016 um 21:37 schrieb Dominik Schneider:
> Hi,
> I'm struggling to use a custom projection. I am seeing differences with
> someone using python proj4 bindings and when I compared my R results with
> my commandline results I got even more confused. the coordinate
> transformation is different for the two different methods.
>
> could someone explain to me which one is wrong and why?
> Thanks
>
> R:
> e=c(-112.25,-104.125,33,43.75)
> box=as(extent(e),'SpatialPolygons')
> proj4string(box)='+proj=longlat +datum=WGS84'
> pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98
> +x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
> xmin(spTransform(box,CRS(pstring)))
> ## [1] -1306471
> ymin(spTransform(box,CRS(pstring)))
> ## [1] -713442.3
>
> commandline:
> iMac:~ $ gdaltransform -s_srs "+proj=longlat +datum=WGS84" -t_srs
> "+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0
> +y_0
> =0  +ellps=sphere  +a=6370000 +b=6370000 +units=m +no_defs"
> -112.25 33.
> -1306675.75472246 -629522.472322824 0
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From r.turner at auckland.ac.nz  Mon Feb 15 23:03:26 2016
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 16 Feb 2016 11:03:26 +1300
Subject: [R-sig-Geo] removing internal boundaries from a spatstat window
 that was created from three adjacent counties
In-Reply-To: <56BE63D5.5010707@binghamton.edu>
References: <56BE63D5.5010707@binghamton.edu>
Message-ID: <56C24B2E.3030001@auckland.ac.nz>


On 13/02/16 11:59, Christopher W. Ryan wrote:

> In spatstat, I want to create a single window from three adjacent
> counties in New York State, USA.  My original data is a shapefile,
> "cty036" showing all the New York State county boundaries.  Here's what
> I've done so far:
>
> ========== begin code =========
> library(shapefiles)
> library(spatstat)
> library(maptools)
> library(sp)
> library(RColorBrewer)
> library(rgdal)
>
> nysArea <- readOGR("C:/DATA/GeographicData", "cty036")
>
> nysAreaUTM <- spTransform(nysArea, CRS("+proj=utm +zone=18 +ellps=GRS80
> +units=m +no_defs"))
>
> sremsAreaUTM <- subset(nysAreaUTM, NAME=="Broome" | NAME=="Tioga" |
> NAME=="Chenango")
>
> sremsWindow <- as(sremsAreaUTM, "owin")
> ======== end code =============
>
>
> This works pretty well, producing a 3-county owin object. But the
> dividing lines between the counties are shown in the window, whenever I
> plot it or plot subsequent point patterns that use the window.  In
> essence, in plots it looks like 3 polygons instead of one big one. I'd
> prefer not to have the inter-county boundaries be visible--I'd rather
> have just one big polygon for the whole area. How can I remove them?  Or
> should I create the window differently from the get-go?
>
> Thanks.

I think it probable that your owin object has come out as a multiple 
polygon.  Look at length(sremsWindow$bdry) --- this is probably 3 (or more).

I would guess that the internal boundaries actually consist of *pairs*
of closely juxtaposed lines --- which look like single lines when plotted.

Have you read the spatstat vignette "shapefiles"?  That might give you 
some guidance as to how to proceed.

I would have thought the automatic repair process that spatstat now uses 
would fix up this problem.  What version of spatstat are you using?

You *might* be able to fix things up by doing (something like):

W1 <- owin(poly=sremsWindow$bdry[[1]])
W2 <- owin(poly=sremsWindow$bdry[[2]])
W3 <- owin(poly=sremsWindow$bdry[[3]])

W  <- union.owin(W1,W2,W3)

But if my guess about the internal boundaries actually being pairs of 
line is correct, this may not work.

It's hard to say without having your sremsWindow object to experiment on.

Or perhaps you need to extract the three counties separately as owin
objects and the apply union.owin() to the three results.  (Again, if my 
guess is correct, this may not work.)

Adrian or Ege may be able to propose a more efficient/effective solution.

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From yoshida.takahiro at sk.tsukuba.ac.jp  Tue Feb 16 10:45:22 2016
From: yoshida.takahiro at sk.tsukuba.ac.jp (Takahiro Yoshida)
Date: Tue, 16 Feb 2016 18:45:22 +0900 (JST)
Subject: [R-sig-Geo] slope of regression line in moran scatter plot
Message-ID: <61312.158.210.92.164.1455615922.risu@infoshako.sk.tsukuba.ac.jp>

I am sorry. I forgot to add the R-Codes.
Best,

Takahiro

####################
library(spdep)
data(baltimore)
# head(baltimore)

plot(baltimore$X, baltimore$Y)
nb <- knn2nb(knearneigh(cbind(baltimore$X, baltimore$Y), k=4))
listW <- nb2listw(nb, style="W")
W <- listw2mat(listW)

y <- baltimore$PRICE 	# as variable
Wy <- W %*% y 		# as spatially lagged variable
Z_y <- scale(y)		# as standardized?variable
Z_Wy <- scale(Wy)		# as standardized spatially lagged variable
WZ_y <- W %*% Z_y		# as spatially lagged standardized variable


## Correration coefficient
cor(y, Wy)
## (Global) Moran's I
moran.test(y, listW, randomisation=F, alternative="two.sided")


par(mfrow=c(1,3))
## Moran scatterplot
# Case [1]: lm((spatially lagged variable) ~ (variable))
# equal to moran.plot(y, listW)
plot(y, Wy, xlab="variable", ylab="spatially lagged variable",
	main=paste("[1] slope of line:", round(coef(lm(Wy~y))[2], 3)))
abline(lm(Wy~y))
abline(v=mean(y), lty=2); abline(h=mean(Wy), lty=2)

# Case [2]: lm((spatially lagged standardized variable) ~ (standardized?var
iable))
# equal to moran.plot(y, listW)
plot(Z_y, WZ_y, xlab="standardized?variable", ylab="spatially lagged standa
rdized variable",
	main=paste("[2] slope of line:", round(coef(lm(WZ_y~Z_y))[2], 3)))
abline(lm(WZ_y~Z_y))
abline(v=mean(Z_y), lty=2); abline(h=mean(WZ_y), lty=2)

# Case [3]: lm((standardized spatially lagged variable) ~ (standardized?var
iable))
# equal to moran.plot(y, listW)
plot(Z_y, Z_Wy, xlab="standardized?variable", ylab="standardized spatially 
lagged variable",
	main=paste("[3] slope of line:", round(coef(lm(Z_Wy~Z_y))[2], 3)))
abline(lm(Z_Wy~Z_y))
abline(v=mean(Z_y), lty=2); abline(h=mean(Z_Wy), lty=2)

par(mfrow=c(1,1))
####################


2016-02-15 23:39 GMT+09:00 Takahiro Yoshida :
Dear list members,

In moran scatter plot, I checked
[1] Slope of lm((spatial lagged variable) ~ (variable)): moran coefficient
(spdep:::moran.plot),
[2] Slope of lm((spatial lagged standardized variable) ~ (standardized
variable)): moran coefficient, and
[3] Slope of lm((standardized spatial lagged variable) ~ (standardized
variable)): correlation coefficient.
However, I think Anselin (1999) remark case [3] is moran coefficient. Is
it true?

Anselin, L. (1999) Interactive techniques and exploratory spatial data
analysis. In: Longley P.A., Goodchild M.F., Maguire D.J., Rhind D.W. (eds)
Geographic information system: Principles, techniques, management and
applications, 253&#8211;266, Wiley, New York.

Thanks and regards,

Takahiro

--
Takahiro Yoshida
Ph.D. student
Real Estate & Spatial Statistics Laboratory
University of Tsukuba, Japan
E-mail: yoshida.takahiro at sk.tsukuba.ac.jp


From Dominik.Schneider at colorado.edu  Tue Feb 16 17:27:31 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 16 Feb 2016 09:27:31 -0700
Subject: [R-sig-Geo] different projection transformation R and gdal
	commandline
In-Reply-To: <56C24834.6020305@uni-marburg.de>
References: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
	<56C24834.6020305@uni-marburg.de>
Message-ID: <CAHYDKLaDhT96PHJS_tMcjYnwn=hNEVeHnt-RKg-TTVahYptTQQ@mail.gmail.com>

Hi Chris,
Thanks for confirming this. I'm not surprised that gdalUtils gives the same
answer as the gdal utilities - my understanding is that gdalUtils is
basically the equivalent to calling the commandline utilities via system().
I'm hoping that someone can shed light on spTransform since I use that a
lot for transforming points and polygons.
ds


On Mon, Feb 15, 2016 at 2:50 PM, Chris Reudenbach <reudenbach at uni-marburg.de
> wrote:

> Hi Dominik,
>
> If you use the gdalUtils package  there is no significant difference in
> the results using CLI or  R:
>
> library(gdalUtils)
> gdaltransform(s_srs="+proj=longlat +datum=WGS84", t_srs="+proj=lcc
> +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0
> +ellps=sphere  +a=6370000 +b=6370000 +units=m
> +no_defs",coords=matrix(c(-112.25,33.0), ncol = 2))
>          [,1]      [,2] [,3]
> [1,] -1306676 -629522.5    0
>
>
> If I use  spTransform I can reproduce your results:
>
>
> loc <- c(-112.25,33.0)
> loc <- data.frame(matrix(unlist(loc), nrow=1,
> byrow=T),stringsAsFactors=FALSE)
> colnames(loc)<-c("lon","lat")
> coordinates(loc)<- ~lon+lat
> proj4string(loc)<- CRS("+proj=longlat +datum=WGS84 +no_defs")
> loc<-spTransform(loc,CRS('+proj=lcc +lat_1=28 +lat_2=50
> +lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0 +ellps=sphere +a=6370000
> +b=6370000 +units=m +no_defs'))
> loc at coords
>        lon     lat
> 1 -1306471 -629424
>
> I suggest to focus on the sptransform() function
>
> cheers Chris
>
> > sessionInfo()
> R version 3.2.3 (2015-12-10)
> Platform: x86_64-pc-linux-gnu (64-bit)
> Running under: Ubuntu 14.04.3 LTS
>
> locale:
>  [1] LC_CTYPE=de_DE.UTF-8       LC_NUMERIC=C LC_TIME=de_DE.UTF-8
> LC_COLLATE=de_DE.UTF-8
>  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=de_DE.UTF-8
> LC_PAPER=de_DE.UTF-8       LC_NAME=C
>  [9] LC_ADDRESS=C               LC_TELEPHONE=C LC_MEASUREMENT=de_DE.UTF-8
> LC_IDENTIFICATION=C
>
> attached base packages:
> [1] stats     graphics  grDevices utils     datasets  methods base
>
> other attached packages:
> [1] gdalUtils_2.0.1.7 raster_2.5-2      sp_1.2-2
>
> loaded via a namespace (and not attached):
>  [1] rgdal_1.1-3       tools_3.2.3       Rcpp_0.12.3 R.methodsS3_1.7.0
> codetools_0.2-14  grid_3.2.3
>  [7] iterators_1.0.8   foreach_1.4.3     R.utils_2.2.0 R.oo_1.19.0
>  lattice_0.20-33
>
>
>
>
>
>
> Am 15.02.2016 um 21:37 schrieb Dominik Schneider:
>
>> Hi,
>> I'm struggling to use a custom projection. I am seeing differences with
>> someone using python proj4 bindings and when I compared my R results with
>> my commandline results I got even more confused. the coordinate
>> transformation is different for the two different methods.
>>
>> could someone explain to me which one is wrong and why?
>> Thanks
>>
>> R:
>> e=c(-112.25,-104.125,33,43.75)
>> box=as(extent(e),'SpatialPolygons')
>> proj4string(box)='+proj=longlat +datum=WGS84'
>> pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98
>> +x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
>> xmin(spTransform(box,CRS(pstring)))
>> ## [1] -1306471
>> ymin(spTransform(box,CRS(pstring)))
>> ## [1] -713442.3
>>
>> commandline:
>> iMac:~ $ gdaltransform -s_srs "+proj=longlat +datum=WGS84" -t_srs
>> "+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0
>> +y_0
>> =0  +ellps=sphere  +a=6370000 +b=6370000 +units=m +no_defs"
>> -112.25 33.
>> -1306675.75472246 -629522.472322824 0
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>

	[[alternative HTML version deleted]]


From mahmutcavur at gmail.com  Tue Feb 16 17:33:49 2016
From: mahmutcavur at gmail.com (Mahmut Cavur)
Date: Tue, 16 Feb 2016 18:33:49 +0200
Subject: [R-sig-Geo] R Techniques on uDig GIS
Message-ID: <CAAsu1aWfJiWWR44OFobK9fSci4tHZam80B=n7Wakcu92hN8ytg@mail.gmail.com>

Hello Dear All,

I am a Phd Candidate at METU in Turkey studying about geospatial analysis.
I have a study to embedd several R techniques into a GIS software (uDig-
Free and Open Source). Actually the study aims to provide a framework and
methodology for developers to embed any geospatai R techniques into a GIS
software and design and create a user-friendly GUI for end users. The study
will be continously developed.

I just want to announce that the GIS and SDA users who are interested such
a study can visit the web site to get more idea about that. In addition, I
will share the more stable source code and integrated software in the
following days for interested users.


*Web Site Link:   http://sda4udig.com/ <http://sda4udig.com/>*


-- 
Sayg?lar?mla,
Best Regards,
*------------------------------------------------*
*Mahmut ?AVUR*
*Genel M?d?r / General Manager*
Kuzgun Bili?im / Kuzgun Informatics
ODT? Teknokent Galyum Blok Kat 2
No:18 ?ankaya/Ankara
*Cep (Mobile): 0546 2101301*
*Web:* kuzgunbilisim.com.tr
*Mail:* mahmutcavur at kuzgunbilisim.com

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Wed Feb 17 01:05:05 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 16 Feb 2016 17:05:05 -0700
Subject: [R-sig-Geo] different projection transformation R and gdal
	commandline
In-Reply-To: <CAHYDKLaDhT96PHJS_tMcjYnwn=hNEVeHnt-RKg-TTVahYptTQQ@mail.gmail.com>
References: <CAHYDKLYF2fsEbq0C8vttVQL1nw5rw3Fj56BE7dwAz2GEA1D=+A@mail.gmail.com>
	<56C24834.6020305@uni-marburg.de>
	<CAHYDKLaDhT96PHJS_tMcjYnwn=hNEVeHnt-RKg-TTVahYptTQQ@mail.gmail.com>
Message-ID: <CAHYDKLaPx7seigQGEdeKdupnKq3K=ywD9a0Jq+wpj7pXK+K=dw@mail.gmail.com>

Oh, silly me. doing plot(spTransform(box,CRS(pstring))) and it's obvious
what's happening. The projection rotates the polygon such that for the
corners y1,x1 and y2,x2   y1 != y2. But ymin(spTransform(box,CRS(pstring)))
still gives you the smallest coordinate regardless of which corner it is.

Using spatial points its easier to see.

e=c(-112.25,-104.125,33,43.75)
box=as(extent(e),'SpatialPoints')
proj4string(box)='+proj=longlat +datum=WGS84'
pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98
+x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
coordinates(spTransform(box,CRS(pstring)))
##             x         y
##[1,] -1306471.3 -629424.0
##[2,] -1122174.4  531025.6
##[3,]  -563451.2 -713442.3
##[4,]  -483968.2  458859.3




On Tue, Feb 16, 2016 at 9:27 AM, Dominik Schneider <
dominik.schneider at colorado.edu> wrote:

> Hi Chris,
> Thanks for confirming this. I'm not surprised that gdalUtils gives the
> same answer as the gdal utilities - my understanding is that gdalUtils is
> basically the equivalent to calling the commandline utilities via system().
> I'm hoping that someone can shed light on spTransform since I use that a
> lot for transforming points and polygons.
> ds
>
>
> On Mon, Feb 15, 2016 at 2:50 PM, Chris Reudenbach <
> reudenbach at uni-marburg.de> wrote:
>
>> Hi Dominik,
>>
>> If you use the gdalUtils package  there is no significant difference in
>> the results using CLI or  R:
>>
>> library(gdalUtils)
>> gdaltransform(s_srs="+proj=longlat +datum=WGS84", t_srs="+proj=lcc
>> +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0
>> +ellps=sphere  +a=6370000 +b=6370000 +units=m
>> +no_defs",coords=matrix(c(-112.25,33.0), ncol = 2))
>>          [,1]      [,2] [,3]
>> [1,] -1306676 -629522.5    0
>>
>>
>> If I use  spTransform I can reproduce your results:
>>
>>
>> loc <- c(-112.25,33.0)
>> loc <- data.frame(matrix(unlist(loc), nrow=1,
>> byrow=T),stringsAsFactors=FALSE)
>> colnames(loc)<-c("lon","lat")
>> coordinates(loc)<- ~lon+lat
>> proj4string(loc)<- CRS("+proj=longlat +datum=WGS84 +no_defs")
>> loc<-spTransform(loc,CRS('+proj=lcc +lat_1=28 +lat_2=50
>> +lat_0=39.70001220694445 +lon_0=-98 +x_0=0 +y_0=0 +ellps=sphere +a=6370000
>> +b=6370000 +units=m +no_defs'))
>> loc at coords
>>        lon     lat
>> 1 -1306471 -629424
>>
>> I suggest to focus on the sptransform() function
>>
>> cheers Chris
>>
>> > sessionInfo()
>> R version 3.2.3 (2015-12-10)
>> Platform: x86_64-pc-linux-gnu (64-bit)
>> Running under: Ubuntu 14.04.3 LTS
>>
>> locale:
>>  [1] LC_CTYPE=de_DE.UTF-8       LC_NUMERIC=C LC_TIME=de_DE.UTF-8
>> LC_COLLATE=de_DE.UTF-8
>>  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=de_DE.UTF-8
>> LC_PAPER=de_DE.UTF-8       LC_NAME=C
>>  [9] LC_ADDRESS=C               LC_TELEPHONE=C LC_MEASUREMENT=de_DE.UTF-8
>> LC_IDENTIFICATION=C
>>
>> attached base packages:
>> [1] stats     graphics  grDevices utils     datasets  methods base
>>
>> other attached packages:
>> [1] gdalUtils_2.0.1.7 raster_2.5-2      sp_1.2-2
>>
>> loaded via a namespace (and not attached):
>>  [1] rgdal_1.1-3       tools_3.2.3       Rcpp_0.12.3 R.methodsS3_1.7.0
>> codetools_0.2-14  grid_3.2.3
>>  [7] iterators_1.0.8   foreach_1.4.3     R.utils_2.2.0 R.oo_1.19.0
>>  lattice_0.20-33
>>
>>
>>
>>
>>
>>
>> Am 15.02.2016 um 21:37 schrieb Dominik Schneider:
>>
>>> Hi,
>>> I'm struggling to use a custom projection. I am seeing differences with
>>> someone using python proj4 bindings and when I compared my R results with
>>> my commandline results I got even more confused. the coordinate
>>> transformation is different for the two different methods.
>>>
>>> could someone explain to me which one is wrong and why?
>>> Thanks
>>>
>>> R:
>>> e=c(-112.25,-104.125,33,43.75)
>>> box=as(extent(e),'SpatialPolygons')
>>> proj4string(box)='+proj=longlat +datum=WGS84'
>>> pstring='+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445
>>> +lon_0=-98
>>> +x_0=0 +y_0=0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs'
>>> xmin(spTransform(box,CRS(pstring)))
>>> ## [1] -1306471
>>> ymin(spTransform(box,CRS(pstring)))
>>> ## [1] -713442.3
>>>
>>> commandline:
>>> iMac:~ $ gdaltransform -s_srs "+proj=longlat +datum=WGS84" -t_srs
>>> "+proj=lcc +lat_1=28 +lat_2=50 +lat_0=39.70001220694445 +lon_0=-98 +x_0=0
>>> +y_0
>>> =0  +ellps=sphere  +a=6370000 +b=6370000 +units=m +no_defs"
>>> -112.25 33.
>>> -1306675.75472246 -629522.472322824 0
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>>
>>
>

	[[alternative HTML version deleted]]


From thi_veloso at yahoo.com.br  Wed Feb 17 02:51:48 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 17 Feb 2016 01:51:48 +0000 (UTC)
Subject: [R-sig-Geo] Calculate percent cover in a raster
References: <69556754.4238749.1455673908362.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <69556754.4238749.1455673908362.JavaMail.yahoo@mail.yahoo.com>

Hi all,

I have a raster at 0.5 degree resolution with monthly totals of rainfall, which range from 50 mm to 600 mm:

require(raster)

## scratch a raster and fill some random values
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
r[] <- round(runif(22 * 20, min=50, max=600), digits=0)


How can I calculate the percentage area of the raster covered with some rainfall ranges? 

Let's say for example 0 to 100, 101 to 200, 201 to 300, 301 to 400, 401 to 500 and finally 501 to 600 mm? 
Thanks in advance,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


From btupper at bigelow.org  Wed Feb 17 03:47:37 2016
From: btupper at bigelow.org (Ben Tupper)
Date: Tue, 16 Feb 2016 21:47:37 -0500
Subject: [R-sig-Geo] Calculate percent cover in a raster
In-Reply-To: <69556754.4238749.1455673908362.JavaMail.yahoo@mail.yahoo.com>
References: <69556754.4238749.1455673908362.JavaMail.yahoo.ref@mail.yahoo.com>
	<69556754.4238749.1455673908362.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <01C90C14-9359-4159-BF9E-50FC7DA64EAE@bigelow.org>

Hi,

I think you can use raster::reclassify() or raster::cut() to bin your rainfall.

intervals <- seq(from = 0, to = 600, by = 100)
ix <- cut(r, breaks = intervals)
tx <- table(as.vector(ix))
tx

  1   2   3   4   5   6 
 46  64  85  76 100  69 

tx/sum(tx)*100

       1        2        3        4        5        6 
10.45455 14.54545 19.31818 17.27273 22.72727 15.68182 

Is that what you are looking for?


Cheers,
Ben

> On Feb 16, 2016, at 8:51 PM, Thiago V. dos Santos <thi_veloso at yahoo.com.br> wrote:
> 
> Hi all,
> 
> I have a raster at 0.5 degree resolution with monthly totals of rainfall, which range from 50 mm to 600 mm:
> 
> require(raster)
> 
> ## scratch a raster and fill some random values
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> r[] <- round(runif(22 * 20, min=50, max=600), digits=0)
> 
> 
> How can I calculate the percentage area of the raster covered with some rainfall ranges? 
> 
> Let's say for example 0 to 100, 101 to 200, 201 to 300, 301 to 400, 401 to 500 and finally 501 to 600 mm? 
> Thanks in advance,
> -- Thiago V. dos Santos
> 
> PhD student
> Land and Atmospheric Science
> University of Minnesota
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From thi_veloso at yahoo.com.br  Wed Feb 17 04:44:31 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 17 Feb 2016 03:44:31 +0000 (UTC)
Subject: [R-sig-Geo] Calculate percent cover in a raster
In-Reply-To: <01C90C14-9359-4159-BF9E-50FC7DA64EAE@bigelow.org>
References: <69556754.4238749.1455673908362.JavaMail.yahoo.ref@mail.yahoo.com>
	<69556754.4238749.1455673908362.JavaMail.yahoo@mail.yahoo.com>
	<01C90C14-9359-4159-BF9E-50FC7DA64EAE@bigelow.org>
Message-ID: <59742759.4342058.1455680671486.JavaMail.yahoo@mail.yahoo.com>

Hi Ben,

Thanks for your suggestion - it works great.

What I ended up using was this:

require(raster)

## scratch a raster and fill some random values
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
r[] <- round(runif(22 * 20, min=0, max=600), digits=0)

# Count raster cells (excluding NA's) and set intervals
ncells <- sum(!is.na(r[]))
intervals <- seq(0, 600, 100)

# Count frequencies and calculate percentage
t <- table(cut(as.vector(r), intervals, include.lowest=TRUE))
t <- t/ncells * 100

# Take a look at it
df <- data.frame(t)
print(df)


 Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota



On Tuesday, February 16, 2016 9:14 PM, Ben Tupper <btupper at bigelow.org> wrote:
Hi,

I think you can use raster::reclassify() or raster::cut() to bin your rainfall.

intervals <- seq(from = 0, to = 600, by = 100)
ix <- cut(r, breaks = intervals)
tx <- table(as.vector(ix))
tx

  1   2   3   4   5   6 
46  64  85  76 100  69 

tx/sum(tx)*100

       1        2        3        4        5        6 
10.45455 14.54545 19.31818 17.27273 22.72727 15.68182 

Is that what you are looking for?


Cheers,
Ben


> On Feb 16, 2016, at 8:51 PM, Thiago V. dos Santos <thi_veloso at yahoo.com.br> wrote:
> 
> Hi all,
> 
> I have a raster at 0.5 degree resolution with monthly totals of rainfall, which range from 50 mm to 600 mm:
> 
> require(raster)
> 
> ## scratch a raster and fill some random values
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> r[] <- round(runif(22 * 20, min=50, max=600), digits=0)
> 
> 
> How can I calculate the percentage area of the raster covered with some rainfall ranges? 
> 
> Let's say for example 0 to 100, 101 to 200, 201 to 300, 301 to 400, 401 to 500 and finally 501 to 600 mm? 
> Thanks in advance,
> -- Thiago V. dos Santos
> 
> PhD student
> Land and Atmospheric Science
> University of Minnesota
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

Ben Tupper
Bigelow Laboratory for Ocean Sciences
60 Bigelow Drive, P.O. Box 380
East Boothbay, Maine 04544
http://www.bigelow.org


From thi_veloso at yahoo.com.br  Wed Feb 17 10:25:02 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Wed, 17 Feb 2016 09:25:02 +0000 (UTC)
Subject: [R-sig-Geo] Count frequency in raster stacks
References: <1082480651.4332903.1455701102809.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>

Hi all,

I am trying to count the frequency of values in raster objects based on specified intervals. For example, I have a raster storing monthly rainfall totals ranging from 50 to 600 mm. And I need to know how many values fall in the interval 0-100, how many on 101-200, 201-300 and so on.

I managed to do it in a single raster:

require(raster)

## scratch a raster and fill some random values
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
r[] <- round(runif(22 * 20, min=0, max=600), digits=0)

# Count raster cells (excluding NA's) and set intervals
ncells <- sum(!is.na(r[]))
intervals <- seq(0, 600, 100)

# Count frequencies and calculate percentage
t <- table(cut(as.vector(r), intervals, include.lowest=TRUE)) / ncells * 100
df <- data.frame(round(t, digits=2))


However, how can I do the same for a raster stack, storing the count of each layer in a column of the resulting data frame? 
Thanks in advance,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


From lyndon.estes at gmail.com  Wed Feb 17 12:04:16 2016
From: lyndon.estes at gmail.com (Lyndon Estes)
Date: Wed, 17 Feb 2016 11:04:16 +0000
Subject: [R-sig-Geo] Count frequency in raster stacks
In-Reply-To: <1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>
References: <1082480651.4332903.1455701102809.JavaMail.yahoo.ref@mail.yahoo.com>
	<1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CALuVVaaQ=+85GCzNkdtgeP5BaaFJV8WJGA-a_Pj5F7su_TLbmg@mail.gmail.com>

Hi Thiago,

Something like this should work:

s <- stack(lapply(1:5, function(x) {
  r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
  r[] <- round(runif(22 * 20, min=0, max=600), digits=0)
  r
}))

intervals <- seq(0, 600, 100)

vals <- sapply(1:nlayers(s), function(x) {  # x <- 1
  # Count frequencies and calculate percentage
  ## note: don't use df or t as object names--they are both functions
  tab <- table(cut(as.vector(s[[x]]), intervals, include.lowest=TRUE))
  # ncells <- length(Which(!is.na(s[[x]]), cells = TRUE)) # alternative
  ncells <- sum(!is.na(s[[x]][]))
  DF <- data.frame(round(tab, digits=2))[, 2]
})

# set up a column that decribes the rainfall bins/intervals
ints <- cbind(intervals[-length(intervals)], intervals[-1])
bins <- apply(ints, 1, function(x) paste(x, collapse = "-"))

# bind to output
cbind.data.frame(bins, vals)


On Wed, Feb 17, 2016 at 4:27 AM Thiago V. dos Santos <
thi_veloso at yahoo.com.br> wrote:

> Hi all,
>
> I am trying to count the frequency of values in raster objects based on
> specified intervals. For example, I have a raster storing monthly rainfall
> totals ranging from 50 to 600 mm. And I need to know how many values fall
> in the interval 0-100, how many on 101-200, 201-300 and so on.
>
> I managed to do it in a single raster:
>
> require(raster)
>
> ## scratch a raster and fill some random values
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> r[] <- round(runif(22 * 20, min=0, max=600), digits=0)
>
> # Count raster cells (excluding NA's) and set intervals
> ncells <- sum(!is.na(r[]))
> intervals <- seq(0, 600, 100)
>
> # Count frequencies and calculate percentage
> t <- table(cut(as.vector(r), intervals, include.lowest=TRUE)) / ncells *
> 100
> df <- data.frame(round(t, digits=2))
>
>
> However, how can I do the same for a raster stack, storing the count of
> each layer in a column of the resulting data frame?
> Thanks in advance,
>  -- Thiago V. dos Santos
>
> PhD student
> Land and Atmospheric Science
> University of Minnesota
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From thi_veloso at yahoo.com.br  Thu Feb 18 01:54:16 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Thu, 18 Feb 2016 00:54:16 +0000 (UTC)
Subject: [R-sig-Geo] Count frequency in raster stacks
In-Reply-To: <CALuVVaaQ=+85GCzNkdtgeP5BaaFJV8WJGA-a_Pj5F7su_TLbmg@mail.gmail.com>
References: <1082480651.4332903.1455701102809.JavaMail.yahoo.ref@mail.yahoo.com>
	<1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>
	<CALuVVaaQ=+85GCzNkdtgeP5BaaFJV8WJGA-a_Pj5F7su_TLbmg@mail.gmail.com>
Message-ID: <144515162.4733055.1455756856460.JavaMail.yahoo@mail.yahoo.com>

Hi Lyndon,
You were right - it worked like a charm. Thank you so much.?Greetings,?-- Thiago V. dos Santos
PhD studentLand and Atmospheric ScienceUniversity of Minnesota 

    On Wednesday, February 17, 2016 5:04 AM, Lyndon Estes <lyndon.estes at gmail.com> wrote:
 

 Hi Thiago,?
Something like this should work:?
s <- stack(lapply(1:5, function(x) {? r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)? r[] <- round(runif(22 * 20, min=0, max=600), digits=0)? r}))
intervals <- seq(0, 600, 100)
vals <- sapply(1:nlayers(s), function(x) { ?# x <- 1? # Count frequencies and calculate percentage? ## note: don't use df or t as object names--they are both functions? tab <- table(cut(as.vector(s[[x]]), intervals, include.lowest=TRUE))? # ncells <- length(Which(!is.na(s[[x]]), cells = TRUE)) # alternative? ncells <- sum(!is.na(s[[x]][]))? DF <- data.frame(round(tab, digits=2))[, 2] ?})
# set up a column that decribes the rainfall bins/intervalsints <- cbind(intervals[-length(intervals)], intervals[-1])bins <- apply(ints, 1, function(x) paste(x, collapse = "-"))
# bind to outputcbind.data.frame(bins, vals)

On Wed, Feb 17, 2016 at 4:27 AM Thiago V. dos Santos <thi_veloso at yahoo.com.br> wrote:

Hi all,

I am trying to count the frequency of values in raster objects based on specified intervals. For example, I have a raster storing monthly rainfall totals ranging from 50 to 600 mm. And I need to know how many values fall in the interval 0-100, how many on 101-200, 201-300 and so on.

I managed to do it in a single raster:

require(raster)

## scratch a raster and fill some random values
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
r[] <- round(runif(22 * 20, min=0, max=600), digits=0)

# Count raster cells (excluding NA's) and set intervals
ncells <- sum(!is.na(r[]))
intervals <- seq(0, 600, 100)

# Count frequencies and calculate percentage
t <- table(cut(as.vector(r), intervals, include.lowest=TRUE)) / ncells * 100
df <- data.frame(round(t, digits=2))


However, how can I do the same for a raster stack, storing the count of each layer in a column of the resulting data frame?
Thanks in advance,
?-- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



  
	[[alternative HTML version deleted]]


From r.hijmans at gmail.com  Thu Feb 18 06:02:30 2016
From: r.hijmans at gmail.com (Robert J. Hijmans)
Date: Wed, 17 Feb 2016 21:02:30 -0800
Subject: [R-sig-Geo] Count frequency in raster stacks
In-Reply-To: <144515162.4733055.1455756856460.JavaMail.yahoo@mail.yahoo.com>
References: <1082480651.4332903.1455701102809.JavaMail.yahoo.ref@mail.yahoo.com>
	<1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>
	<CALuVVaaQ=+85GCzNkdtgeP5BaaFJV8WJGA-a_Pj5F7su_TLbmg@mail.gmail.com>
	<144515162.4733055.1455756856460.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CANtt_hy4DzN8ESoW43DaKvZWGoNNDPZej9W6DbzPZJdHkd_e9w@mail.gmail.com>

Here is a more direct (and safer) way:

library(raster)
set.seed(0)
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
s <- stack(lapply(1:5, function(x) {setValues(r, round(runif(22 * 20,
min=0, max=600), digits=0))}))


intervals <- seq(0, 600, 100)

x <- cut(s, intervals, include.lowest=TRUE)
freq(x, merge=TRUE)



On Wed, Feb 17, 2016 at 4:54 PM, Thiago V. dos Santos
<thi_veloso at yahoo.com.br> wrote:
> Hi Lyndon,
> You were right - it worked like a charm. Thank you so much. Greetings, -- Thiago V. dos Santos
> PhD studentLand and Atmospheric ScienceUniversity of Minnesota
>
>     On Wednesday, February 17, 2016 5:04 AM, Lyndon Estes <lyndon.estes at gmail.com> wrote:
>
>
>  Hi Thiago,
> Something like this should work:
> s <- stack(lapply(1:5, function(x) {  r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)  r[] <- round(runif(22 * 20, min=0, max=600), digits=0)  r}))
> intervals <- seq(0, 600, 100)
> vals <- sapply(1:nlayers(s), function(x) {  # x <- 1  # Count frequencies and calculate percentage  ## note: don't use df or t as object names--they are both functions  tab <- table(cut(as.vector(s[[x]]), intervals, include.lowest=TRUE))  # ncells <- length(Which(!is.na(s[[x]]), cells = TRUE)) # alternative  ncells <- sum(!is.na(s[[x]][]))  DF <- data.frame(round(tab, digits=2))[, 2]  })
> # set up a column that decribes the rainfall bins/intervalsints <- cbind(intervals[-length(intervals)], intervals[-1])bins <- apply(ints, 1, function(x) paste(x, collapse = "-"))
> # bind to outputcbind.data.frame(bins, vals)
>
> On Wed, Feb 17, 2016 at 4:27 AM Thiago V. dos Santos <thi_veloso at yahoo.com.br> wrote:
>
> Hi all,
>
> I am trying to count the frequency of values in raster objects based on specified intervals. For example, I have a raster storing monthly rainfall totals ranging from 50 to 600 mm. And I need to know how many values fall in the interval 0-100, how many on 101-200, 201-300 and so on.
>
> I managed to do it in a single raster:
>
> require(raster)
>
> ## scratch a raster and fill some random values
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> r[] <- round(runif(22 * 20, min=0, max=600), digits=0)
>
> # Count raster cells (excluding NA's) and set intervals
> ncells <- sum(!is.na(r[]))
> intervals <- seq(0, 600, 100)
>
> # Count frequencies and calculate percentage
> t <- table(cut(as.vector(r), intervals, include.lowest=TRUE)) / ncells * 100
> df <- data.frame(round(t, digits=2))
>
>
> However, how can I do the same for a raster stack, storing the count of each layer in a column of the resulting data frame?
> Thanks in advance,
>  -- Thiago V. dos Santos
>
> PhD student
> Land and Atmospheric Science
> University of Minnesota
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From johnwasige at gmail.com  Thu Feb 18 10:25:02 2016
From: johnwasige at gmail.com (John Wasige)
Date: Thu, 18 Feb 2016 10:25:02 +0100
Subject: [R-sig-Geo] Intersect shapefiles
Message-ID: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>

?Dear all,

I have three shapefiles that I want to intersect. Any body with an idea on
how to do the intersection? Shapefiles below;
library(rgdal)
library(rgeos)
library(maptools)
library(sp)
###shape1
Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/Rain_poly_merge.shp",
layer="Rain_poly_merge")
Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))

###shape2
Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2002.shp",
layer="Rain_poly_merge")
Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))

###shape3
Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2008.shp",
layer="Rain_poly_merge")
Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))

	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Thu Feb 18 11:04:54 2016
From: loic.dutrieux at wur.nl (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Thu, 18 Feb 2016 11:04:54 +0100
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
Message-ID: <56C59746.3080901@wur.nl>

Hi,

Have you tried gIntersection from the rgeos package.

Given 3 SpatialPolygon* objects you can probably do something like:

sp12 <- gIntersection(sp1, sp2)
sp123 <- gIntersection(sp12, sp3)

Cheers,
Lo?c

On 02/18/2016 10:25 AM, John Wasige wrote:
> ?Dear all,
>
> I have three shapefiles that I want to intersect. Any body with an idea on
> how to do the intersection? Shapefiles below;
> library(rgdal)
> library(rgeos)
> library(maptools)
> library(sp)
> ###shape1
> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/Rain_poly_merge.shp",
> layer="Rain_poly_merge")
> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>
> ###shape2
> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2002.shp",
> layer="Rain_poly_merge")
> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>
> ###shape3
> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2008.shp",
> layer="Rain_poly_merge")
> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From barbosa at uevora.pt  Thu Feb 18 12:58:40 2016
From: barbosa at uevora.pt (A. Marcia BARBOSA)
Date: Thu, 18 Feb 2016 11:58:40 +0000
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <56C59746.3080901@wur.nl>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
Message-ID: <CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>

Check out also function joinPolys in the PBSmapping package
(http://www.inside-r.org/packages/cran/pbsmapping/docs/joinPolys)


- - -
A. M?rcia BARBOSA, post-doctoral fellow
CIBIO/InBIO - University of ?vora (Portugal)
http://modtools.wordpress.com/barbosa



2016-02-18 10:04 GMT+00:00 Lo?c Dutrieux <loic.dutrieux at wur.nl>:

> Hi,
>
> Have you tried gIntersection from the rgeos package.
>
> Given 3 SpatialPolygon* objects you can probably do something like:
>
> sp12 <- gIntersection(sp1, sp2)
> sp123 <- gIntersection(sp12, sp3)
>
> Cheers,
> Lo?c
>
>
> On 02/18/2016 10:25 AM, John Wasige wrote:
>
>> ?Dear all,
>>
>> I have three shapefiles that I want to intersect. Any body with an idea on
>> how to do the intersection? Shapefiles below;
>> library(rgdal)
>> library(rgeos)
>> library(maptools)
>> library(sp)
>> ###shape1
>> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/Rain_poly_merge.shp",
>> layer="Rain_poly_merge")
>> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>>
>> ###shape2
>> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2002.shp",
>> layer="Rain_poly_merge")
>> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>>
>> ###shape3
>> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/yield_maize_average2008.shp",
>> layer="Rain_poly_merge")
>> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Thu Feb 18 15:23:34 2016
From: englishchristophera at gmail.com (chris english)
Date: Thu, 18 Feb 2016 16:23:34 +0200
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
Message-ID: <CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>

John,

As Loic suggests, rgeos::gIntersection will get you there. Look closely at
his naming of objects and your example code using spTransform. With his
approach, each object has its own name; whereas your approach overwrites
Rain_poly_merge the second and third time and the final object (third) is
the 2008 maize yield. So read your shapefiles into differently named
objects and use Loic's approach.

Chris

On Thu, Feb 18, 2016 at 1:58 PM, A. Marcia BARBOSA <barbosa at uevora.pt>
wrote:

> Check out also function joinPolys in the PBSmapping package
> (http://www.inside-r.org/packages/cran/pbsmapping/docs/joinPolys)
>
>
> - - -
> A. M?rcia BARBOSA, post-doctoral fellow
> CIBIO/InBIO - University of ?vora (Portugal)
> http://modtools.wordpress.com/barbosa
>
>
>
> 2016-02-18 10:04 GMT+00:00 Lo?c Dutrieux <loic.dutrieux at wur.nl>:
>
> > Hi,
> >
> > Have you tried gIntersection from the rgeos package.
> >
> > Given 3 SpatialPolygon* objects you can probably do something like:
> >
> > sp12 <- gIntersection(sp1, sp2)
> > sp123 <- gIntersection(sp12, sp3)
> >
> > Cheers,
> > Lo?c
> >
> >
> > On 02/18/2016 10:25 AM, John Wasige wrote:
> >
> >> ?Dear all,
> >>
> >> I have three shapefiles that I want to intersect. Any body with an idea
> on
> >> how to do the intersection? Shapefiles below;
> >> library(rgdal)
> >> library(rgeos)
> >> library(maptools)
> >> library(sp)
> >> ###shape1
> >> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/Rain_poly_merge.shp",
> >> layer="Rain_poly_merge")
> >> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
> >>
> >> ###shape2
> >> Rain_poly_merge <-
> readOGR(dsn="G:/EPIC_CUP/yield_maize_average2002.shp",
> >> layer="Rain_poly_merge")
> >> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
> >>
> >> ###shape3
> >> Rain_poly_merge <-
> readOGR(dsn="G:/EPIC_CUP/yield_maize_average2008.shp",
> >> layer="Rain_poly_merge")
> >> Rain_poly_merge <- spTransform(Rain_poly_merge, CRS("+init=epsg:4326"))
> >>
> >>         [[alternative HTML version deleted]]
> >>
> >> _______________________________________________
> >> R-sig-Geo mailing list
> >> R-sig-Geo at r-project.org
> >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>
> >>
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From johnwasige at gmail.com  Thu Feb 18 15:39:30 2016
From: johnwasige at gmail.com (John Wasige)
Date: Thu, 18 Feb 2016 15:39:30 +0100
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
Message-ID: <CAJgdCD5Z=ZV-dFHUAhMprYQRhhrFYJzB9ytbYDVeg6JYeb3wiQ@mail.gmail.com>

Thanks so much

On Thu, Feb 18, 2016 at 3:23 PM, chris english <
englishchristophera at gmail.com> wrote:

> John,
>
> As Loic suggests, rgeos::gIntersection will get you there. Look closely at
> his naming of objects and your example code using spTransform. With his
> approach, each object has its own name; whereas your approach overwrites
> Rain_poly_merge the second and third time and the final object (third) is
> the 2008 maize yield. So read your shapefiles into differently named
> objects and use Loic's approach.
>
> Chris
>
> On Thu, Feb 18, 2016 at 1:58 PM, A. Marcia BARBOSA <barbosa at uevora.pt>
> wrote:
>
> > Check out also function joinPolys in the PBSmapping package
> > (http://www.inside-r.org/packages/cran/pbsmapping/docs/joinPolys)
> >
> >
> > - - -
> > A. M?rcia BARBOSA, post-doctoral fellow
> > CIBIO/InBIO - University of ?vora (Portugal)
> > http://modtools.wordpress.com/barbosa
> >
> >
> >
> > 2016-02-18 10:04 GMT+00:00 Lo?c Dutrieux <loic.dutrieux at wur.nl>:
> >
> > > Hi,
> > >
> > > Have you tried gIntersection from the rgeos package.
> > >
> > > Given 3 SpatialPolygon* objects you can probably do something like:
> > >
> > > sp12 <- gIntersection(sp1, sp2)
> > > sp123 <- gIntersection(sp12, sp3)
> > >
> > > Cheers,
> > > Lo?c
> > >
> > >
> > > On 02/18/2016 10:25 AM, John Wasige wrote:
> > >
> > >> ?Dear all,
> > >>
> > >> I have three shapefiles that I want to intersect. Any body with an
> idea
> > on
> > >> how to do the intersection? Shapefiles below;
> > >> library(rgdal)
> > >> library(rgeos)
> > >> library(maptools)
> > >> library(sp)
> > >> ###shape1
> > >> Rain_poly_merge <- readOGR(dsn="G:/EPIC_CUP/Rain_poly_merge.shp",
> > >> layer="Rain_poly_merge")
> > >> Rain_poly_merge <- spTransform(Rain_poly_merge,
> CRS("+init=epsg:4326"))
> > >>
> > >> ###shape2
> > >> Rain_poly_merge <-
> > readOGR(dsn="G:/EPIC_CUP/yield_maize_average2002.shp",
> > >> layer="Rain_poly_merge")
> > >> Rain_poly_merge <- spTransform(Rain_poly_merge,
> CRS("+init=epsg:4326"))
> > >>
> > >> ###shape3
> > >> Rain_poly_merge <-
> > readOGR(dsn="G:/EPIC_CUP/yield_maize_average2008.shp",
> > >> layer="Rain_poly_merge")
> > >> Rain_poly_merge <- spTransform(Rain_poly_merge,
> CRS("+init=epsg:4326"))
> > >>
> > >>         [[alternative HTML version deleted]]
> > >>
> > >> _______________________________________________
> > >> R-sig-Geo mailing list
> > >> R-sig-Geo at r-project.org
> > >> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >>
> > >>
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
John Wasige
"There are no REGRATES in LIFE, just lessons (Jennifer Aniston)?

	[[alternative HTML version deleted]]


From jworrall at fs.fed.us  Thu Feb 18 16:55:06 2016
From: jworrall at fs.fed.us (Worrall, James -FS)
Date: Thu, 18 Feb 2016 15:55:06 +0000
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
Message-ID: <558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>


I would have thought gUnaryUnion, but then I can't understand from the documentation what the difference is between that and gIntersection.

-----Original Message-----
From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of chris english
Sent: Thursday, February 18, 2016 7:24 AM

John,

As Loic suggests, rgeos::gIntersection will get you there. Look closely at his naming of objects and your example code using spTransform. With his approach, each object has its own name; whereas your approach overwrites Rain_poly_merge the second and third time and the final object (third) is the 2008 maize yield. So read your shapefiles into differently named objects and use Loic's approach.

Chris





This electronic message contains information generated by the USDA solely for the intended recipients. Any unauthorized interception of this message or the use or disclosure of the information it contains may violate the law and subject the violator to civil or criminal penalties. If you believe you have received this message in error, please notify the sender and delete the email immediately.

From milan.kili11 at gmail.com  Thu Feb 18 17:05:07 2016
From: milan.kili11 at gmail.com (Milan Kilibarda)
Date: Thu, 18 Feb 2016 17:05:07 +0100
Subject: [R-sig-Geo] GeoMLA workshop and conference, 21-24 June 2016,
	Belgrade - 2nd Announcement
Message-ID: <CAPSaU-_1r+X-iaUbbrqH9GmTm6s8YpzvpEQjiq_iCgP-F92P7A@mail.gmail.com>

Dear Colleagues,

In the period 21-24 June 2016, we are organizing an International
conference and a series of workshops entitled:

"GeoMLA: Geostatistics and Machine Learning Applications in Climate
and Environmental Sciences".

Location: University of Belgrade - Faculty of Civil Engineering Belgrade, Serbia

URL: http://geomla.org

The meeting will open with three parallel workshops (21-22 June 2016):

Mikhail Kanevski: "Machine learning of geospatial data: achievements
and new trends"
Tomislav Hengl: "Automated mapping in 2D, 3D, and 2D+T using machine learning"
Milan Kilibarda: "Spatial and spatio-temporal prediction and
visualization of climate elements in R"


After the workshops we will run a two-days conference (23-24 June
2016) with several keynote speakers / leading researchers in the
field:

prof. Dr. Mikhail Kanevski, Universite de Lausanne, Facult? des
g?osciences et de l'environnement, Lausanne, Switzerland
prof. Dr. Wolfgang Wagner, Technical University of Wien, Department of
Geodesy and geoinformation
Dr. Ivana Cvijanovi?, Lawrence Livermore National Laboratory, CA USA
Dr. Ole Einar Tveito, Norwegian Meteorological Institute, Climatology
Division, Oslo Norway
Dr. Andreas Papritz, ETH Zurich, Department of Environmental Systems Science


A special issue with a selection of papers from the conference will
follow in September 2016.

IMPORTANT DEADLINES:

April 1st  2016 - abstract submission deadline

April 15th  2016 - early registration payment deadline


The GeoMLA flyer is available at:

http://geomla.grf.bg.ac.rs/site_media/static/GeoMLA_flyer_2016.pdf

You may please forward it to like-minded individuals and organizations
and encourage them to participate.

On behalf of the Organizing Committee of GeoMLA,

-- 
Dr. Milan Kilibarda
Assistant professor
University of Belgrade,
Faculty of Civil Engineering,
Department of Geodesy and Geoinformatics,
Address: Bulevar kralja Aleksandra 73  11000 Belgrade, Serbia,
Mail:  kili at grf.bg.ac.rs
Web: http://www.grf.bg.ac.rs/fakultet/pro/e?nid=168 ;
http://osgl.grf.bg.ac.rs/ ;  http://dailymeteo.org/
Pub: http://scholar.google.com/citations?user=Zl2MZ3AAAAAJ&hl=en
tel:+381 11 3218630


From tech_dev at wildintellect.com  Thu Feb 18 17:59:14 2016
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Thu, 18 Feb 2016 08:59:14 -0800
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
	<558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
Message-ID: <56C5F862.6070403@wildintellect.com>

Union creates a merged shape including all parts of input objects.

Intersection creates a shape of the overlapping portions of input objects.

I'm not clear on the goal from the initial email so I don't know which
is better in this case.

Enjoy,
Alex

On 02/18/2016 07:55 AM, Worrall, James -FS wrote:
> 
> I would have thought gUnaryUnion, but then I can't understand from the documentation what the difference is between that and gIntersection.
> 
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of chris english
> Sent: Thursday, February 18, 2016 7:24 AM
> 
> John,
> 
> As Loic suggests, rgeos::gIntersection will get you there. Look closely at his naming of objects and your example code using spTransform. With his approach, each object has its own name; whereas your approach overwrites Rain_poly_merge the second and third time and the final object (third) is the 2008 maize yield. So read your shapefiles into differently named objects and use Loic's approach.
> 
> Chris
> 
> 
> 
> 
> 
> This electronic message contains information generated by the USDA solely for the intended recipients. Any unauthorized interception of this message or the use or disclosure of the information it contains may violate the law and subject the violator to civil or criminal penalties. If you believe you have received this message in error, please notify the sender and delete the email immediately.
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From jworrall at fs.fed.us  Thu Feb 18 19:10:10 2016
From: jworrall at fs.fed.us (Worrall, James -FS)
Date: Thu, 18 Feb 2016 18:10:10 +0000
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <56C5F862.6070403@wildintellect.com>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
	<558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
	<56C5F862.6070403@wildintellect.com>
Message-ID: <558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>

Such a clear and simple explanation - thank you.  I wish the function documentation was written like that.

-----Original Message-----
From: Alex Mandel [mailto:tech_dev at wildintellect.com] 
Sent: Thursday, February 18, 2016 9:59 AM
To: Worrall, James -FS <jworrall at fs.fed.us>; chris english <englishchristophera at gmail.com>; A. Marcia BARBOSA <barbosa at uevora.pt>
Cc: Help R-Sig_Geo <r-sig-geo at r-project.org>
Subject: Re: [R-sig-Geo] Intersect shapefiles

Union creates a merged shape including all parts of input objects.

Intersection creates a shape of the overlapping portions of input objects.

I'm not clear on the goal from the initial email so I don't know which is better in this case.

Enjoy,
Alex

On 02/18/2016 07:55 AM, Worrall, James -FS wrote:
> 
> I would have thought gUnaryUnion, but then I can't understand from the documentation what the difference is between that and gIntersection.
> 
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of 
> chris english
> Sent: Thursday, February 18, 2016 7:24 AM
> 
> John,
> 
> As Loic suggests, rgeos::gIntersection will get you there. Look closely at his naming of objects and your example code using spTransform. With his approach, each object has its own name; whereas your approach overwrites Rain_poly_merge the second and third time and the final object (third) is the 2008 maize yield. So read your shapefiles into differently named objects and use Loic's approach.
> 
> Chris
> 
> 
> 
> 
> 
> This electronic message contains information generated by the USDA solely for the intended recipients. Any unauthorized interception of this message or the use or disclosure of the information it contains may violate the law and subject the violator to civil or criminal penalties. If you believe you have received this message in error, please notify the sender and delete the email immediately.
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 


From englishchristophera at gmail.com  Thu Feb 18 19:49:42 2016
From: englishchristophera at gmail.com (chris english)
Date: Thu, 18 Feb 2016 20:49:42 +0200
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
	<558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
	<56C5F862.6070403@wildintellect.com>
	<558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>
Message-ID: <CAASFQpQD3yq71cB1U424KvO6gg1JeO0ORubi9OsOyHLoOu4FyA@mail.gmail.com>

And so for John 's completion we should ask: Union or intersection? I
assume union but of course could be wrong. What i especially like about the
sp and rgeos documentation is that if you take the time to run the examples
in the documentation you just might see your use case. Or, rather likely.
Chris
On Feb 18, 2016 8:11 PM, "Worrall, James -FS" <jworrall at fs.fed.us> wrote:

> Such a clear and simple explanation - thank you.  I wish the function
> documentation was written like that.
>
> -----Original Message-----
> From: Alex Mandel [mailto:tech_dev at wildintellect.com]
> Sent: Thursday, February 18, 2016 9:59 AM
> To: Worrall, James -FS <jworrall at fs.fed.us>; chris english <
> englishchristophera at gmail.com>; A. Marcia BARBOSA <barbosa at uevora.pt>
> Cc: Help R-Sig_Geo <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Intersect shapefiles
>
> Union creates a merged shape including all parts of input objects.
>
> Intersection creates a shape of the overlapping portions of input objects.
>
> I'm not clear on the goal from the initial email so I don't know which is
> better in this case.
>
> Enjoy,
> Alex
>
> On 02/18/2016 07:55 AM, Worrall, James -FS wrote:
> >
> > I would have thought gUnaryUnion, but then I can't understand from the
> documentation what the difference is between that and gIntersection.
> >
> > -----Original Message-----
> > From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> > chris english
> > Sent: Thursday, February 18, 2016 7:24 AM
> >
> > John,
> >
> > As Loic suggests, rgeos::gIntersection will get you there. Look closely
> at his naming of objects and your example code using spTransform. With his
> approach, each object has its own name; whereas your approach overwrites
> Rain_poly_merge the second and third time and the final object (third) is
> the 2008 maize yield. So read your shapefiles into differently named
> objects and use Loic's approach.
> >
> > Chris
> >
> >
> >
> >
> >
> > This electronic message contains information generated by the USDA
> solely for the intended recipients. Any unauthorized interception of this
> message or the use or disclosure of the information it contains may violate
> the law and subject the violator to civil or criminal penalties. If you
> believe you have received this message in error, please notify the sender
> and delete the email immediately.
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Thu Feb 18 20:00:45 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 18 Feb 2016 20:00:45 +0100
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
	<558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
	<56C5F862.6070403@wildintellect.com>
	<558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>
Message-ID: <alpine.LFD.2.20.1602181931440.9437@reclus.nhh.no>

On Thu, 18 Feb 2016, Worrall, James -FS wrote:

> Such a clear and simple explanation - thank you.  I wish the function 
> documentation was written like that.

Please feel free to contribute; the description section shall be short, 
what you seem to want is in the details a little further down the page:

"Returns an sp object with intersecting geometries merged. If geometries 
do not intersect then both are returned as distinct subgeometries."

Note that gUnion is a binary operator (union of two objects) while 
gUnaryUnion is a unary operator with an id argument to map input 
subgeometries to output subgeometries.

I guess this is easier to grasp than the JTS original describing the 
binary union operator: "Computes a Geometry representing all the points in 
this Geometry and other" at

http://www.vividsolutions.com/jts/javadoc/com/vividsolutions/jts/geom/Geometry.html#union%28com.vividsolutions.jts.geom.Geometry%29

Roger

>
> -----Original Message-----
> From: Alex Mandel [mailto:tech_dev at wildintellect.com]
> Sent: Thursday, February 18, 2016 9:59 AM
> To: Worrall, James -FS <jworrall at fs.fed.us>; chris english <englishchristophera at gmail.com>; A. Marcia BARBOSA <barbosa at uevora.pt>
> Cc: Help R-Sig_Geo <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Intersect shapefiles
>
> Union creates a merged shape including all parts of input objects.
>
> Intersection creates a shape of the overlapping portions of input objects.
>
> I'm not clear on the goal from the initial email so I don't know which is better in this case.
>
> Enjoy,
> Alex
>
> On 02/18/2016 07:55 AM, Worrall, James -FS wrote:
>>
>> I would have thought gUnaryUnion, but then I can't understand from the documentation what the difference is between that and gIntersection.
>>
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
>> chris english
>> Sent: Thursday, February 18, 2016 7:24 AM
>>
>> John,
>>
>> As Loic suggests, rgeos::gIntersection will get you there. Look closely at his naming of objects and your example code using spTransform. With his approach, each object has its own name; whereas your approach overwrites Rain_poly_merge the second and third time and the final object (third) is the 2008 maize yield. So read your shapefiles into differently named objects and use Loic's approach.
>>
>> Chris
>>
>>
>>
>>
>>
>> This electronic message contains information generated by the USDA solely for the intended recipients. Any unauthorized interception of this message or the use or disclosure of the information it contains may violate the law and subject the violator to civil or criminal penalties. If you believe you have received this message in error, please notify the sender and delete the email immediately.
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412


From jworrall at fs.fed.us  Thu Feb 18 22:07:41 2016
From: jworrall at fs.fed.us (Worrall, James -FS)
Date: Thu, 18 Feb 2016 21:07:41 +0000
Subject: [R-sig-Geo] Intersect shapefiles
In-Reply-To: <alpine.LFD.2.20.1602181931440.9437@reclus.nhh.no>
References: <CAJgdCD4rMt1A9CoZqhfMyJp2Kidwn4Fqja6KuqXnjysPcbkAtw@mail.gmail.com>
	<56C59746.3080901@wur.nl>
	<CAP9xbzxdZ7yAHoThJq1bCbEcMLRxbBdq5HkWf8OgfB4oncHidg@mail.gmail.com>
	<CAASFQpSH8Sbh-HgLyGbQDDfdn5biv6H2XjzncwkVaY=NbOZHBA@mail.gmail.com>
	<558ED6D2BF4F5742885443480CC85E3301867747@001FSN2MPN1-061.001f.mgd2.msft.net>
	<56C5F862.6070403@wildintellect.com>
	<558ED6D2BF4F5742885443480CC85E3301867776@001FSN2MPN1-061.001f.mgd2.msft.net>
	<alpine.LFD.2.20.1602181931440.9437@reclus.nhh.no>
Message-ID: <558ED6D2BF4F5742885443480CC85E33018677BB@001FSN2MPN1-061.001f.mgd2.msft.net>



> -----Original Message-----
> From: Roger Bivand [mailto:Roger.Bivand at nhh.no]
> Sent: Thursday, February 18, 2016 12:01 PM
> To: Worrall, James -FS <jworrall at fs.fed.us>
> Cc: Help R-Sig_Geo <r-sig-geo at r-project.org>
> Subject: Re: [R-sig-Geo] Intersect shapefiles
>
> Please feel free to contribute; the description section shall be short, what you
> seem to want is in the details a little further down the page:
>
> "Returns an sp object with intersecting geometries merged. If geometries do
> not intersect then both are returned as distinct subgeometries."

I think this was the confusing part to me, but I am easily confused.  If two polygons overlap, in my mind the two polygons are intersecting geometries, and thus gIntersection should return the two polygons, in their entirety, merged.  Of course, this is the same as gUnion, so that doesn't make sense.

I made some simple polygons and tested to make sure gIntersection and gUnion behave as I now think they do.

Maybe it would be clearer to say something like, "Returns an sp object with intersecting (overlapping) portions of intersecting geometries merged.  Non-intersecting portions of intersecting geometries are removed.  If geometries do not intersect then both are returned as distinct subgeometries."

> I guess this is easier to grasp than the JTS original describing the binary union
> operator: "Computes a Geometry representing all the points in this Geometry
> and other" at
>
> http://www.vividsolutions.com/jts/javadoc/com/vividsolutions/jts/geom/Geo
> metry.html#union%28com.vividsolutions.jts.geom.Geometry%29
>
Yes indeed!




This electronic message contains information generated by the USDA solely for the intended recipients. Any unauthorized interception of this message or the use or disclosure of the information it contains may violate the law and subject the violator to civil or criminal penalties. If you believe you have received this message in error, please notify the sender and delete the email immediately.


From thi_veloso at yahoo.com.br  Fri Feb 19 01:37:54 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Fri, 19 Feb 2016 00:37:54 +0000 (UTC)
Subject: [R-sig-Geo] Count frequency in raster stacks
In-Reply-To: <CANtt_hy4DzN8ESoW43DaKvZWGoNNDPZej9W6DbzPZJdHkd_e9w@mail.gmail.com>
References: <1082480651.4332903.1455701102809.JavaMail.yahoo.ref@mail.yahoo.com>
	<1082480651.4332903.1455701102809.JavaMail.yahoo@mail.yahoo.com>
	<CALuVVaaQ=+85GCzNkdtgeP5BaaFJV8WJGA-a_Pj5F7su_TLbmg@mail.gmail.com>
	<144515162.4733055.1455756856460.JavaMail.yahoo@mail.yahoo.com>
	<CANtt_hy4DzN8ESoW43DaKvZWGoNNDPZej9W6DbzPZJdHkd_e9w@mail.gmail.com>
Message-ID: <859603796.5216557.1455842274251.JavaMail.yahoo@mail.yahoo.com>

Nice, Robert! Thanks for showing up and contributing to this question!?Greetings,?-- Thiago V. dos Santos
PhD studentLand and Atmospheric ScienceUniversity of Minnesota 

    On Wednesday, February 17, 2016 11:02 PM, Robert J. Hijmans <r.hijmans at gmail.com> wrote:
 

 Here is a more direct (and safer) way:

library(raster)
set.seed(0)
r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
s <- stack(lapply(1:5, function(x) {setValues(r, round(runif(22 * 20,
min=0, max=600), digits=0))}))


intervals <- seq(0, 600, 100)

x <- cut(s, intervals, include.lowest=TRUE)
freq(x, merge=TRUE)



On Wed, Feb 17, 2016 at 4:54 PM, Thiago V. dos Santos
<thi_veloso at yahoo.com.br> wrote:
> Hi Lyndon,
> You were right - it worked like a charm. Thank you so much. Greetings, -- Thiago V. dos Santos
> PhD studentLand and Atmospheric ScienceUniversity of Minnesota
>
>? ? On Wednesday, February 17, 2016 5:04 AM, Lyndon Estes <lyndon.estes at gmail.com> wrote:
>
>
>? Hi Thiago,
> Something like this should work:
> s <- stack(lapply(1:5, function(x) {? r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)? r[] <- round(runif(22 * 20, min=0, max=600), digits=0)? r}))
> intervals <- seq(0, 600, 100)
> vals <- sapply(1:nlayers(s), function(x) {? # x <- 1? # Count frequencies and calculate percentage? ## note: don't use df or t as object names--they are both functions? tab <- table(cut(as.vector(s[[x]]), intervals, include.lowest=TRUE))? # ncells <- length(Which(!is.na(s[[x]]), cells = TRUE)) # alternative? ncells <- sum(!is.na(s[[x]][]))? DF <- data.frame(round(tab, digits=2))[, 2]? })
> # set up a column that decribes the rainfall bins/intervalsints <- cbind(intervals[-length(intervals)], intervals[-1])bins <- apply(ints, 1, function(x) paste(x, collapse = "-"))
> # bind to outputcbind.data.frame(bins, vals)
>
> On Wed, Feb 17, 2016 at 4:27 AM Thiago V. dos Santos <thi_veloso at yahoo.com.br> wrote:
>
> Hi all,
>
> I am trying to count the frequency of values in raster objects based on specified intervals. For example, I have a raster storing monthly rainfall totals ranging from 50 to 600 mm. And I need to know how many values fall in the interval 0-100, how many on 101-200, 201-300 and so on.
>
> I managed to do it in a single raster:
>
> require(raster)
>
> ## scratch a raster and fill some random values
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> r[] <- round(runif(22 * 20, min=0, max=600), digits=0)
>
> # Count raster cells (excluding NA's) and set intervals
> ncells <- sum(!is.na(r[]))
> intervals <- seq(0, 600, 100)
>
> # Count frequencies and calculate percentage
> t <- table(cut(as.vector(r), intervals, include.lowest=TRUE)) / ncells * 100
> df <- data.frame(round(t, digits=2))
>
>
> However, how can I do the same for a raster stack, storing the count of each layer in a column of the resulting data frame?
> Thanks in advance,
>? -- Thiago V. dos Santos
>
> PhD student
> Land and Atmospheric Science
> University of Minnesota
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>
>? ? ? ? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

  
	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Fri Feb 19 01:59:00 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Thu, 18 Feb 2016 17:59:00 -0700
Subject: [R-sig-Geo] calculate "regional" slope
Message-ID: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>

I need to calculate slope at different scales. In the case below, r is a
0.5deg resolution raster and I want the slope for 1.5 deg centered on each
of those 0.5 deg pixels. I'm trying to estimate which side of mountain
range each pixel is on. So the resulting raster would have the same number
of pixels as r. The edges can be NA.
any suggestions would be appreciated. Thanks


r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
setValues(r,rnorm(440))

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Fri Feb 19 08:17:02 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Fri, 19 Feb 2016 08:17:02 +0100
Subject: [R-sig-Geo] gstat: BLAS/LAPACK routine 'DPOTRF' gave error code
	-4
In-Reply-To: <c182b2c0e4a14b8baa95f585c8dbbafb@EXCH01.staff.ad.cqu.edu.au>
References: <c182b2c0e4a14b8baa95f585c8dbbafb@EXCH01.staff.ad.cqu.edu.au>
Message-ID: <56C6C16E.9020006@uni-muenster.de>

Yeboah,

It looks like this problem has been solved in the development version of
gstat, on https://github.com/edzer/gstat

Let me know if you have trouble installing from source/github, in which
case I will do a CRAN submission.

Best regards,

On 19/02/16 06:14, Yeboah Gyasi-Agyei wrote:
> Dear Edzer,
> 
>  
> 
> I?ve been using gstat for sometime now and my code has been running
> well. I today downloaded R version 3.2.2 and 3.2.3 and this code line on
> conditional simulation is generating the error message below.
> 
>  
> 
>  OK <- krige(z ~ 1, ConDat, Gridat,model = Model2D,nsim=1,nmax = 50,
> nmin = 5, maxdist = 100)
> 
>   drawing 1 GLS realisation of beta...
> 
>   [using conditional Gaussian simulation]
> 
>  
> 
> Error in predict.gstat(g, newdata = newdata, block = block, nsim = nsim,  :
> 
>   BLAS/LAPACK routine 'DPOTRF' gave error code -4
> 
>  
> 
> However there is no problem with ordinary kriging when nsim=0. The
> attached file contains ConDat, Gridat and Model2D.
> 
>  
> 
> From a search on the web  I noticed that other "programs / code" got
> similar errors and the cause was generally due to some arrays being
> incomplete, or the size of the array is not big enough.
> 
>  
> 
> Please advise and thanks for your help.
> 
>  
> 
> Yeboah
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160219/5248f94d/attachment.bin>

From englishchristophera at gmail.com  Fri Feb 19 12:09:05 2016
From: englishchristophera at gmail.com (chris english)
Date: Fri, 19 Feb 2016 13:09:05 +0200
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
Message-ID: <CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>

Dominik,

r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
 vals <- sample.int(1e3,440)
r[ ] <- vals
#raster::terrain
terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
Ah, but it appears you want up sampling to 1.5 degrees rather than 0.5 deg.
so maybe spatial.tools::projectRaster_rigorous then raster:terrain.

I'm inclined to end that last so maybe with a question mark. Sorry for an
essentially inconclusive response but I was happy to find terrain in any
case.
Chris

On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
Dominik.Schneider at colorado.edu> wrote:

> I need to calculate slope at different scales. In the case below, r is a
> 0.5deg resolution raster and I want the slope for 1.5 deg centered on each
> of those 0.5 deg pixels. I'm trying to estimate which side of mountain
> range each pixel is on. So the resulting raster would have the same number
> of pixels as r. The edges can be NA.
> any suggestions would be appreciated. Thanks
>
>
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
> setValues(r,rnorm(440))
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Fri Feb 19 16:08:44 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Fri, 19 Feb 2016 09:08:44 -0600
Subject: [R-sig-Geo] How to speed up the projection of a raster
Message-ID: <CABkCotR+oAsyZKSw3ryL6bww216eRgvDrZK_aSbjdpLgP-N5VQ@mail.gmail.com>

Dear list members,

I am trying to reproject a raster (see the code below), however the process
is too slow.  What I need to do to speed up the process? It took me seconds
to do the task in QGIS, but I prefer to do other raster projections in r.

Thank you very much in advance.

> ras = raster("lc.grd")
> ras

class       : RasterLayer
dimensions  : 16118, 21959, 353935162  (nrow, ncol, ncell)
resolution  : 98.4252, 98.4252  (x, y)
extent      : 183871.7, 2345191, 88600.88, 1675018  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=43 +lat_2=45.5 +lat_0=41.75 +lon_0=-120.5
+x_0=399999.9999999999 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=ft
+no_defs
data source :
C:\Users\Manuel\Documents\Documentos_personales\Clases_y_Cursos\Clases\ICOMVIS\03_Evaluacion_del_Habitat\Practicos\Practica_03_Seleccion_de_habitat_Paisaje\oregon\lc.grd
names       : w001001
values      : 0, 95  (min, max)
attributes  :
       ID   COUNT       RED     GREEN      BLUE
 from:  0   60051 0.0000000 0.0000000 0.0000000
 to  : 95 2481857 0.4392157 0.6392157 0.7294118
                    LAND_COVER OPACITY
                  Unclassified       1
 Emergent Herbaceuous Wetlands       1



> rasp = projectRaster(ras, crs = "+proj=longlat +datum=WGS84", method =
"ngb")

-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Fri Feb 19 16:55:32 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Fri, 19 Feb 2016 08:55:32 -0700
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
Message-ID: <CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>

Thanks for the suggestion Chris.  I'm familiar with gdaldem, which
raster::terrain is based on, to compute slope from a dem. I now realize
that my example isnt a good one because neighbors=8 would achieve what I
described. However I actually want some flexibility such that I can
specifiy neighbors=16 so that it uses the next "ring" of cells.

I played around with focal() with weight argument =
matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out how to solve
for a directional slope.

On Fri, Feb 19, 2016 at 4:09 AM, chris english <
englishchristophera at gmail.com> wrote:

> Dominik,
>
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>  vals <- sample.int(1e3,440)
> r[ ] <- vals
> #raster::terrain
> terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
> Ah, but it appears you want up sampling to 1.5 degrees rather than 0.5 deg.
> so maybe spatial.tools::projectRaster_rigorous then raster:terrain.
>
> I'm inclined to end that last so maybe with a question mark. Sorry for an
> essentially inconclusive response but I was happy to find terrain in any
> case.
> Chris
>
> On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
> Dominik.Schneider at colorado.edu> wrote:
>
>> I need to calculate slope at different scales. In the case below, r is a
>> 0.5deg resolution raster and I want the slope for 1.5 deg centered on each
>> of those 0.5 deg pixels. I'm trying to estimate which side of mountain
>> range each pixel is on. So the resulting raster would have the same number
>> of pixels as r. The edges can be NA.
>> any suggestions would be appreciated. Thanks
>>
>>
>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>> setValues(r,rnorm(440))
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Fri Feb 19 16:59:46 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Fri, 19 Feb 2016 08:59:46 -0700
Subject: [R-sig-Geo] How to speed up the projection of a raster
In-Reply-To: <CABkCotR+oAsyZKSw3ryL6bww216eRgvDrZK_aSbjdpLgP-N5VQ@mail.gmail.com>
References: <CABkCotR+oAsyZKSw3ryL6bww216eRgvDrZK_aSbjdpLgP-N5VQ@mail.gmail.com>
Message-ID: <CAF1jk_=bMv9WJw3OqoCM-tkML3+Y7tv+sKBO97vTAiaPE67v4Q@mail.gmail.com>

Manual,
I generally find gdal directly (which is what's used by qgis) to be faster
than the raster package.  I would use either:
1. gdalUtils package which essentially just provides r-style syntax to the
gdal commandline utilities
2. use system() with the gdal commandline utility command given as a string
to this function.
I use os x so not sure if things are the same on windows, if that's your OS.
gl
ds


On Fri, Feb 19, 2016 at 8:08 AM, Manuel Sp?nola <mspinola10 at gmail.com>
wrote:

> Dear list members,
>
> I am trying to reproject a raster (see the code below), however the process
> is too slow.  What I need to do to speed up the process? It took me seconds
> to do the task in QGIS, but I prefer to do other raster projections in r.
>
> Thank you very much in advance.
>
> > ras = raster("lc.grd")
> > ras
>
> class       : RasterLayer
> dimensions  : 16118, 21959, 353935162  (nrow, ncol, ncell)
> resolution  : 98.4252, 98.4252  (x, y)
> extent      : 183871.7, 2345191, 88600.88, 1675018  (xmin, xmax, ymin,
> ymax)
> coord. ref. : +proj=lcc +lat_1=43 +lat_2=45.5 +lat_0=41.75 +lon_0=-120.5
> +x_0=399999.9999999999 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=ft
> +no_defs
> data source :
>
> C:\Users\Manuel\Documents\Documentos_personales\Clases_y_Cursos\Clases\ICOMVIS\03_Evaluacion_del_Habitat\Practicos\Practica_03_Seleccion_de_habitat_Paisaje\oregon\lc.grd
> names       : w001001
> values      : 0, 95  (min, max)
> attributes  :
>        ID   COUNT       RED     GREEN      BLUE
>  from:  0   60051 0.0000000 0.0000000 0.0000000
>  to  : 95 2481857 0.4392157 0.6392157 0.7294118
>                     LAND_COVER OPACITY
>                   Unclassified       1
>  Emergent Herbaceuous Wetlands       1
>
>
>
> > rasp = projectRaster(ras, crs = "+proj=longlat +datum=WGS84", method =
> "ngb")
>
> --
> *Manuel Sp?nola, Ph.D.*
> Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
> Universidad Nacional
> Apartado 1350-3000
> Heredia
> COSTA RICA
> mspinola at una.ac.cr
> mspinola10 at gmail.com
> Tel?fono: (506) 2277-3598
> Fax: (506) 2237-7036
> Personal website: Lobito de r?o <
> https://sites.google.com/site/lobitoderio/>
> Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From ruettenauer at sowi.uni-kl.de  Fri Feb 19 19:37:05 2016
From: ruettenauer at sowi.uni-kl.de (=?iso-8859-1?Q?Tobias_R=FCttenauer?=)
Date: Fri, 19 Feb 2016 19:37:05 +0100
Subject: [R-sig-Geo] AIC/R^2 in splm
Message-ID: <003601d16b44$888f5ce0$99ae16a0$@sowi.uni-kl.de>


> -----Urspr?ngliche Nachricht-----
> Von: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] Im Auftrag von
> Maryia Bakhtsiyarava
> Gesendet: Montag, 15. Februar 2016 03:59
> An: R-sig-geo Mailing List <r-sig-geo at r-project.org>
> Betreff: [R-sig-Geo] AIC/R^2 in splm
> 
> Dear list members,
> 
> I am estimating a spatial lag model with time-period fixed effects using
> package splm. I would like to obtain some goodness-of-fit measures for my
> models but I cannot figure out how to do it. The traditional AIC
extraction
> function doesn't work for a an object of class "splm".

Most extract functions do not support "splm" class. You can try to access
the functions for objects of a similar class and rearrange it for splm.

> 
> The only thing I can extract is the log likelihood, using which in theory
I can
> calculate AIC, but even in that case I am not sure about the degrees of
> freedom to use in the calculation (do I count time dummies, lag and
intercept
> as parameters?). I tried df.residual(model) but I got NULL.

If you use the same data for different models (having the same number of
time dummies), it does not matter if you include or exclude these dummies. 

> 
> Is there another way to obtain AIC and/or R^2? I am sure people
> encountered this problem before, so if you have any advice on how to
obtain
> model statistics, I would greatly appreciate it.

If you receive the log Likelihood in your spml model output (
summary(fesar.mod)$logLik ), you can use the following function to calculate
the AIC (it includes the spatial lag as one parameter and the spatial error
as one parameter):

#### AIC function for spml ####

godf.spml<-function(object, k=2, criterion=c("AIC", "BIC"),  ...){
  s<-summary(object)
  l<-s$logLik[1,1]
  np<- length(coef(s))
  N<- nrow(s$model)
  if(criterion=="AIC"){
    aic<- -2*l+k*np
    names(aic)<-"AIC"
    return(aic)
  }
  if(criterion=="BIC"){
    bic<- -2*l+log(N)*np
    names(bic)<-"BIC"
    if(k!=2){
      warning("parameter <k> not used for BIC")
    }
    return(bic)
  }
}

Example:

require(splm)
fesar.mod<-spml(formula= y~x1+x2, data=data.pd, ...)
godf.spml(fesar.mod, criterion="AIC")


If your spml model output does not contain a value for logLik, see here how
to fix this:
http://r-sig-geo.2731867.n2.nabble.com/spml-and-logLik-help-td7581581.html

There is an R squared reported in the model output:

summary(fesar.mod)$rsqr

Unfortunately it is not documented what kind of (Pseudo)-R squared this is
(to my knowledge).

Best
Tobi

> 
> Thank you,
> Maryia
> --
> Maryia Bakhtsiyarava
> Graduate student
> Department of Geography, Environment and Society University of
> Minnesota, Twin Cities
> 
> Research Assistant
> TerraPop Project
> Minnesota Population Center
> 
> 414 Social Sciences, 267 19th Ave S, Minneapolis, MN 55455
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From reudenbach at uni-marburg.de  Fri Feb 19 22:00:19 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Fri, 19 Feb 2016 22:00:19 +0100
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
	<CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
Message-ID: <5C5CA5D0-5E76-4E8C-AA84-DA844EA5AE31@uni-marburg.de>

Dominik,

If you want to deal with bigger data sets in a fast and more flexible way I strongly suggest to use GRASS7. Rgrass7 provides a very good "r-ish" wrapper to use it from R. If You are interested i 'll post a typical setup and example for your question. Please note you need obligatory a GRASS 7 installation on your system.

Cheers Chris 


Am 19. Februar 2016 16:55:32 MEZ, schrieb Dominik Schneider <Dominik.Schneider at colorado.edu>:
>Thanks for the suggestion Chris.  I'm familiar with gdaldem, which
>raster::terrain is based on, to compute slope from a dem. I now realize
>that my example isnt a good one because neighbors=8 would achieve what
>I
>described. However I actually want some flexibility such that I can
>specifiy neighbors=16 so that it uses the next "ring" of cells.
>
>I played around with focal() with weight argument =
>matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out how to
>solve
>for a directional slope.
>
>On Fri, Feb 19, 2016 at 4:09 AM, chris english <
>englishchristophera at gmail.com> wrote:
>
>> Dominik,
>>
>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>  vals <- sample.int(1e3,440)
>> r[ ] <- vals
>> #raster::terrain
>> terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
>> Ah, but it appears you want up sampling to 1.5 degrees rather than
>0.5 deg.
>> so maybe spatial.tools::projectRaster_rigorous then raster:terrain.
>>
>> I'm inclined to end that last so maybe with a question mark. Sorry
>for an
>> essentially inconclusive response but I was happy to find terrain in
>any
>> case.
>> Chris
>>
>> On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
>> Dominik.Schneider at colorado.edu> wrote:
>>
>>> I need to calculate slope at different scales. In the case below, r
>is a
>>> 0.5deg resolution raster and I want the slope for 1.5 deg centered
>on each
>>> of those 0.5 deg pixels. I'm trying to estimate which side of
>mountain
>>> range each pixel is on. So the resulting raster would have the same
>number
>>> of pixels as r. The edges can be NA.
>>> any suggestions would be appreciated. Thanks
>>>
>>>
>>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>> setValues(r,rnorm(440))
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>	[[alternative HTML version deleted]]
>
>_______________________________________________
>R-sig-Geo mailing list
>R-sig-Geo at r-project.org
>https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Diese Nachricht wurde von meinem Android-Mobiltelefon mit K-9 Mail gesendet.
	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Fri Feb 19 22:50:35 2016
From: englishchristophera at gmail.com (chris english)
Date: Fri, 19 Feb 2016 23:50:35 +0200
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
	<CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
Message-ID: <CAASFQpT=gXDqSYPxjF=Ee1P2dCqkqzjuOkSuhgZC6koDeyftAw@mail.gmail.com>

Dominik,
Sorry, I'm still trying to understand your 0.05 to 1.5 degree part of your
problem.

Otherwise, I think you are limited to 8 neighbors as this reflects the
documentation as I read it.

Even Roualt perhaps would be up in arms; but, there's nothing saying you
can't do a 16 vs 8 neighbor. You'd have to examine the impacts thereafter,
but basically you'd be amending some gdal (probably a line or two of code)
for your purposes.

There are a bunch of things to consider, theoretical and practical; but,
why 16 better than 8. And more importantly as you relax, as a matter of
rings (in this case), would your analytical result be better? Or
potentially have any remainder meaning at all, I.e. I don't know my
neighbor's neighbor's neighbor (does that get us out to 16?).
And so generalizing beyond some given point might yield not much on a knn
influence/likeness basis.

I think we're first better off dialing back in on what you mean by regional
or the 0.5 to 1.5 resolution and then neighborhood size (4, 8,16?).

Of course another approach to this "what side of the mountain am I on" is
to transect along the z. I.e. roll your dem on it's side.

Anyway, clarify the 0.5/1.5 so I don't go too far astray.
Chris
Thanks for the suggestion Chris.  I'm familiar with gdaldem, which
raster::terrain is based on, to compute slope from a dem. I now realize
that my example isnt a good one because neighbors=8 would achieve what I
described. However I actually want some flexibility such that I can
specifiy neighbors=16 so that it uses the next "ring" of cells.

I played around with focal() with weight argument =
matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out how to solve
for a directional slope.

On Fri, Feb 19, 2016 at 4:09 AM, chris english <
englishchristophera at gmail.com> wrote:

> Dominik,
>
> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>  vals <- sample.int(1e3,440)
> r[ ] <- vals
> #raster::terrain
> terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
> Ah, but it appears you want up sampling to 1.5 degrees rather than 0.5 deg.
> so maybe spatial.tools::projectRaster_rigorous then raster:terrain.
>
> I'm inclined to end that last so maybe with a question mark. Sorry for an
> essentially inconclusive response but I was happy to find terrain in any
> case.
> Chris
>
> On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
> Dominik.Schneider at colorado.edu> wrote:
>
>> I need to calculate slope at different scales. In the case below, r is a
>> 0.5deg resolution raster and I want the slope for 1.5 deg centered on each
>> of those 0.5 deg pixels. I'm trying to estimate which side of mountain
>> range each pixel is on. So the resulting raster would have the same number
>> of pixels as r. The edges can be NA.
>> any suggestions would be appreciated. Thanks
>>
>>
>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>> setValues(r,rnorm(440))
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Sat Feb 20 01:08:23 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Fri, 19 Feb 2016 17:08:23 -0700
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAASFQpT=gXDqSYPxjF=Ee1P2dCqkqzjuOkSuhgZC6koDeyftAw@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
	<CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
	<CAASFQpT=gXDqSYPxjF=Ee1P2dCqkqzjuOkSuhgZC6koDeyftAw@mail.gmail.com>
Message-ID: <CAF1jk_mm0BCTsLLX36XkHQcgoWdYcOdzewt4n1j8PytVT5MuXQ@mail.gmail.com>

Chris R,
I'd be happy to use grass7 but I can't get it to run on my mac. osx
10.11.3. I have a working qgis from kyngchaos, installed pandoc and cairo
on top of that, and disabled sip but the grass7.app just hangs when I try
to open it.
Chris E,
I will try to clarify. Rather than thinking about "side of a mountain",
think about "side of a mountain **range**".  The point of calculating a
regional slope is that if I am on the west side of a continental divide but
on the east side of mountain, the function still returns a value indicating
west-facing.  so maybe it's easier to think in meters.   lets assume my DEM
is a 500m grid. the slope calculation would give a local value at 500m.
This local slope might be east facing, but I am interested in the overall
slope across 10km to indicate which way e.g. the watershed is draining.
What do you mean with "transect along the z. I.e. roll your dem on it's
side."?


On Fri, Feb 19, 2016 at 2:50 PM, chris english <
englishchristophera at gmail.com> wrote:

> Dominik,
> Sorry, I'm still trying to understand your 0.05 to 1.5 degree part of your
> problem.
>
> Otherwise, I think you are limited to 8 neighbors as this reflects the
> documentation as I read it.
>
> Even Roualt perhaps would be up in arms; but, there's nothing saying you
> can't do a 16 vs 8 neighbor. You'd have to examine the impacts thereafter,
> but basically you'd be amending some gdal (probably a line or two of code)
> for your purposes.
>
> There are a bunch of things to consider, theoretical and practical; but,
> why 16 better than 8. And more importantly as you relax, as a matter of
> rings (in this case), would your analytical result be better? Or
> potentially have any remainder meaning at all, I.e. I don't know my
> neighbor's neighbor's neighbor (does that get us out to 16?).
> And so generalizing beyond some given point might yield not much on a knn
> influence/likeness basis.
>
> I think we're first better off dialing back in on what you mean by
> regional or the 0.5 to 1.5 resolution and then neighborhood size (4, 8,16?).
>
> Of course another approach to this "what side of the mountain am I on" is
> to transect along the z. I.e. roll your dem on it's side.
>
> Anyway, clarify the 0.5/1.5 so I don't go too far astray.
> Chris
> Thanks for the suggestion Chris.  I'm familiar with gdaldem, which
> raster::terrain is based on, to compute slope from a dem. I now realize
> that my example isnt a good one because neighbors=8 would achieve what I
> described. However I actually want some flexibility such that I can
> specifiy neighbors=16 so that it uses the next "ring" of cells.
>
> I played around with focal() with weight argument =
> matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out how to solve
> for a directional slope.
>
> On Fri, Feb 19, 2016 at 4:09 AM, chris english <
> englishchristophera at gmail.com> wrote:
>
>> Dominik,
>>
>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>  vals <- sample.int(1e3,440)
>> r[ ] <- vals
>> #raster::terrain
>> terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
>> Ah, but it appears you want up sampling to 1.5 degrees rather than 0.5
>> deg.
>> so maybe spatial.tools::projectRaster_rigorous then raster:terrain.
>>
>> I'm inclined to end that last so maybe with a question mark. Sorry for an
>> essentially inconclusive response but I was happy to find terrain in any
>> case.
>> Chris
>>
>> On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
>> Dominik.Schneider at colorado.edu> wrote:
>>
>>> I need to calculate slope at different scales. In the case below, r is a
>>> 0.5deg resolution raster and I want the slope for 1.5 deg centered on
>>> each
>>> of those 0.5 deg pixels. I'm trying to estimate which side of mountain
>>> range each pixel is on. So the resulting raster would have the same
>>> number
>>> of pixels as r. The edges can be NA.
>>> any suggestions would be appreciated. Thanks
>>>
>>>
>>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>> setValues(r,rnorm(440))
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>

	[[alternative HTML version deleted]]


From englishchristophera at gmail.com  Sat Feb 20 08:49:50 2016
From: englishchristophera at gmail.com (chris english)
Date: Sat, 20 Feb 2016 09:49:50 +0200
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAF1jk_mm0BCTsLLX36XkHQcgoWdYcOdzewt4n1j8PytVT5MuXQ@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
	<CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
	<CAASFQpT=gXDqSYPxjF=Ee1P2dCqkqzjuOkSuhgZC6koDeyftAw@mail.gmail.com>
	<CAF1jk_mm0BCTsLLX36XkHQcgoWdYcOdzewt4n1j8PytVT5MuXQ@mail.gmail.com>
Message-ID: <CAASFQpQWgs5NcPEGEN+=bixVDTf44q=dbdvTyw5irvq=pCexFw@mail.gmail.com>

Dominik,
There's mention of grass not working on osx 10.11 and a work around
grassmac.wikidot.com

I was generally using PCRaster when I was doing watershed/flood
re-creations to handle the watershed delineations and the like and don't
have an opinion on Grass.

Yeah, that transect was maybe a silly idea but it generalizes surface to
line, sort of like Mauana volcano is a cake you've cut in half. And the
line is outline.

Chris
On Feb 20, 2016 2:09 AM, "Dominik Schneider" <Dominik.Schneider at colorado.edu>
wrote:

> Chris R,
> I'd be happy to use grass7 but I can't get it to run on my mac. osx
> 10.11.3. I have a working qgis from kyngchaos, installed pandoc and cairo
> on top of that, and disabled sip but the grass7.app just hangs when I try
> to open it.
> Chris E,
> I will try to clarify. Rather than thinking about "side of a mountain",
> think about "side of a mountain **range**".  The point of calculating a
> regional slope is that if I am on the west side of a continental divide but
> on the east side of mountain, the function still returns a value indicating
> west-facing.  so maybe it's easier to think in meters.   lets assume my DEM
> is a 500m grid. the slope calculation would give a local value at 500m.
> This local slope might be east facing, but I am interested in the overall
> slope across 10km to indicate which way e.g. the watershed is draining.
> What do you mean with "transect along the z. I.e. roll your dem on it's
> side."?
>
>
> On Fri, Feb 19, 2016 at 2:50 PM, chris english <
> englishchristophera at gmail.com> wrote:
>
>> Dominik,
>> Sorry, I'm still trying to understand your 0.05 to 1.5 degree part of
>> your problem.
>>
>> Otherwise, I think you are limited to 8 neighbors as this reflects the
>> documentation as I read it.
>>
>> Even Roualt perhaps would be up in arms; but, there's nothing saying you
>> can't do a 16 vs 8 neighbor. You'd have to examine the impacts thereafter,
>> but basically you'd be amending some gdal (probably a line or two of code)
>> for your purposes.
>>
>> There are a bunch of things to consider, theoretical and practical; but,
>> why 16 better than 8. And more importantly as you relax, as a matter of
>> rings (in this case), would your analytical result be better? Or
>> potentially have any remainder meaning at all, I.e. I don't know my
>> neighbor's neighbor's neighbor (does that get us out to 16?).
>> And so generalizing beyond some given point might yield not much on a knn
>> influence/likeness basis.
>>
>> I think we're first better off dialing back in on what you mean by
>> regional or the 0.5 to 1.5 resolution and then neighborhood size (4, 8,16?).
>>
>> Of course another approach to this "what side of the mountain am I on" is
>> to transect along the z. I.e. roll your dem on it's side.
>>
>> Anyway, clarify the 0.5/1.5 so I don't go too far astray.
>> Chris
>> Thanks for the suggestion Chris.  I'm familiar with gdaldem, which
>> raster::terrain is based on, to compute slope from a dem. I now realize
>> that my example isnt a good one because neighbors=8 would achieve what I
>> described. However I actually want some flexibility such that I can
>> specifiy neighbors=16 so that it uses the next "ring" of cells.
>>
>> I played around with focal() with weight argument =
>> matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out how to solve
>> for a directional slope.
>>
>> On Fri, Feb 19, 2016 at 4:09 AM, chris english <
>> englishchristophera at gmail.com> wrote:
>>
>>> Dominik,
>>>
>>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>>  vals <- sample.int(1e3,440)
>>> r[ ] <- vals
>>> #raster::terrain
>>> terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
>>> Ah, but it appears you want up sampling to 1.5 degrees rather than 0.5
>>> deg.
>>> so maybe spatial.tools::projectRaster_rigorous then raster:terrain.
>>>
>>> I'm inclined to end that last so maybe with a question mark. Sorry for an
>>> essentially inconclusive response but I was happy to find terrain in any
>>> case.
>>> Chris
>>>
>>> On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider <
>>> Dominik.Schneider at colorado.edu> wrote:
>>>
>>>> I need to calculate slope at different scales. In the case below, r is a
>>>> 0.5deg resolution raster and I want the slope for 1.5 deg centered on
>>>> each
>>>> of those 0.5 deg pixels. I'm trying to estimate which side of mountain
>>>> range each pixel is on. So the resulting raster would have the same
>>>> number
>>>> of pixels as r. The edges can be NA.
>>>> any suggestions would be appreciated. Thanks
>>>>
>>>>
>>>> r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33, ymx=-22)
>>>> setValues(r,rnorm(440))
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Sat Feb 20 11:14:41 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Sat, 20 Feb 2016 11:14:41 +0100
Subject: [R-sig-Geo] calculate "regional" slope
In-Reply-To: <CAASFQpQWgs5NcPEGEN+=bixVDTf44q=dbdvTyw5irvq=pCexFw@mail.gmail.com>
References: <CAF1jk_mQ0Jv1u+a7HnxwUDiBSo3RX1QHXgYaFjq+Cur3QX5_hg@mail.gmail.com>
	<CAASFQpShC9gNg2BZewB5ePpu3u7cUHH2eDjrq7fxPmx-xJGEOw@mail.gmail.com>
	<CAF1jk_nr2YKV+kX+3R6yBVgyX7cOypBrLdG_nBG2+PGrbTXvjg@mail.gmail.com>
	<CAASFQpT=gXDqSYPxjF=Ee1P2dCqkqzjuOkSuhgZC6koDeyftAw@mail.gmail.com>
	<CAF1jk_mm0BCTsLLX36XkHQcgoWdYcOdzewt4n1j8PytVT5MuXQ@mail.gmail.com>
	<CAASFQpQWgs5NcPEGEN+=bixVDTf44q=dbdvTyw5irvq=pCexFw@mail.gmail.com>
Message-ID: <56C83C91.7060109@uni-marburg.de>

Dominik,

probably I did not catch exactly what  are your issues.

If you want to perform a multiscale analysis of the digital relief you 
should not focus on a 4,8,16 or more neighbors analysis. This would be 
helpful for a least cost path analysis or a single scale but multi 
neighborhood analysis.

If you have problems with your OS and just for getting an idea  you may 
use landserf  the great java tool of Jo Wood http://www.landserf.org/

As far as I understand your question I think a straightforward way would 
be to resample your elevation data in several steps to a coarser 
resolution and derive the information (aspect, watershed) you need. If 
you really want to have the information "on the other side of a 
mountain" You have to define what other side means. Most commonly it 
means something as behind the highest ridge.

But If you want to perform typical hydrological or morphometric analysis 
of the relief I would strongly suggest  the "mature" GIS software 
packages as GRASS7  SAGA GIS 2.12+ or also PCraster. All of them have 
very fast and very  well validated and reliable tools. PCRaster is more 
optimized with respect to the dynamics, while SAGA GIS and GRASS are 
more sophisticated in order to the implemented algorithms. GRASS is most 
optimized with respect to time consuming calculations. So if you "just" 
want to derive the information of the watersheds on different scales you 
can easily use all of these software packages.

There are some more aspects you should mention. If you need to analyze 
let's say 8 tiles of 5 deg SRTM data R is not able to deal with it.  
Even with PCRaster and SAGA you will need a lot of patience.

Maybe a final thought: we are dealing in students courses since some 
years using R and the mentioned GIS packages on all major OS platforms. 
Instead of struggling all the time with not satisfying work arounds for 
OSX you may think about a second partitions with Linux (or even 
Windows).  In the end this will save a lot of time...

If you need any support with one the mentioned topcis please let me know.

cheers Chris R


Am 20.02.2016 um 08:49 schrieb chris english:
>
> Dominik,
> There's mention of grass not working on osx 10.11 and a work around
> grassmac.wikidot.com <http://grassmac.wikidot.com>
>
> I was generally using PCRaster when I was doing watershed/flood 
> re-creations to handle the watershed delineations and the like and 
> don't have an opinion on Grass.
>
> Yeah, that transect was maybe a silly idea but it generalizes surface 
> to line, sort of like Mauana volcano is a cake you've cut in half. And 
> the line is outline.
>
> Chris
>
> On Feb 20, 2016 2:09 AM, "Dominik Schneider" 
> <Dominik.Schneider at colorado.edu 
> <mailto:Dominik.Schneider at colorado.edu>> wrote:
>
>     Chris R,
>     I'd be happy to use grass7 but I can't get it to run on my mac.
>     osx 10.11.3. I have a working qgis from kyngchaos, installed
>     pandoc and cairo on top of that, and disabled sip but the
>     grass7.app just hangs when I try to open it.
>     Chris E,
>     I will try to clarify. Rather than thinking about "side of a
>     mountain", think about "side of a mountain **range**".  The point
>     of calculating a regional slope is that if I am on the west side
>     of a continental divide but on the east side of mountain, the
>     function still returns a value indicating west-facing.  so maybe
>     it's easier to think in meters.   lets assume my DEM is a 500m
>     grid. the slope calculation would give a local value at 500m. This
>     local slope might be east facing, but I am interested in the
>     overall slope across 10km to indicate which way e.g. the watershed
>     is draining.
>     What do you mean with "transect along the z. I.e. roll your dem on
>     it's side."?
>
>
>     On Fri, Feb 19, 2016 at 2:50 PM, chris english
>     <englishchristophera at gmail.com
>     <mailto:englishchristophera at gmail.com>> wrote:
>
>         Dominik,
>         Sorry, I'm still trying to understand your 0.05 to 1.5 degree
>         part of your problem.
>
>         Otherwise, I think you are limited to 8 neighbors as this
>         reflects the documentation as I read it.
>
>         Even Roualt perhaps would be up in arms; but, there's nothing
>         saying you can't do a 16 vs 8 neighbor. You'd have to examine
>         the impacts thereafter, but basically you'd be amending some
>         gdal (probably a line or two of code) for your purposes.
>
>         There are a bunch of things to consider, theoretical and
>         practical; but, why 16 better than 8. And more importantly as
>         you relax, as a matter of rings (in this case), would your
>         analytical result be better? Or potentially have any remainder
>         meaning at all, I.e. I don't know my neighbor's neighbor's
>         neighbor (does that get us out to 16?).
>         And so generalizing beyond some given point might yield not
>         much on a knn influence/likeness basis.
>
>         I think we're first better off dialing back in on what you
>         mean by regional or the 0.5 to 1.5 resolution and then
>         neighborhood size (4, 8,16?).
>
>         Of course another approach to this "what side of the mountain
>         am I on" is to transect along the z. I.e. roll your dem on
>         it's side.
>
>         Anyway, clarify the 0.5/1.5 so I don't go too far astray.
>         Chris
>
>         Thanks for the suggestion Chris. I'm familiar with gdaldem,
>         which raster::terrain is based on, to compute slope from a
>         dem. I now realize that my example isnt a good one because
>         neighbors=8 would achieve what I described. However I actually
>         want some flexibility such that I can specifiy neighbors=16 so
>         that it uses the next "ring" of cells.
>
>         I played around with focal() with weight argument =
>         matrix(rep(c(1,0,0,0,1),5),byrow=T) but couldn't figure out
>         how to solve for a directional slope.
>
>         On Fri, Feb 19, 2016 at 4:09 AM, chris english
>         <englishchristophera at gmail.com
>         <mailto:englishchristophera at gmail.com>> wrote:
>
>             Dominik,
>
>             r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48, ymn=-33,
>             ymx=-22)
>              vals <- sample.int <http://sample.int>(1e3,440)
>             r[ ] <- vals
>             #raster::terrain
>             terr_r <- terrain(r, opt='slope', unit='degrees', neighbors=8)
>             Ah, but it appears you want up sampling to 1.5 degrees
>             rather than 0.5 deg.
>             so maybe spatial.tools::projectRaster_rigorous then
>             raster:terrain.
>
>             I'm inclined to end that last so maybe with a question
>             mark. Sorry for an
>             essentially inconclusive response but I was happy to find
>             terrain in any case.
>             Chris
>
>             On Fri, Feb 19, 2016 at 2:59 AM, Dominik Schneider
>             <Dominik.Schneider at colorado.edu
>             <mailto:Dominik.Schneider at colorado.edu>> wrote:
>
>                 I need to calculate slope at different scales. In the
>                 case below, r is a
>                 0.5deg resolution raster and I want the slope for 1.5
>                 deg centered on each
>                 of those 0.5 deg pixels. I'm trying to estimate which
>                 side of mountain
>                 range each pixel is on. So the resulting raster would
>                 have the same number
>                 of pixels as r. The edges can be NA.
>                 any suggestions would be appreciated. Thanks
>
>
>                 r <- raster(nrows=22, ncols=20, xmn=-58, xmx=-48,
>                 ymn=-33, ymx=-22)
>                 setValues(r,rnorm(440))
>
>                         [[alternative HTML version deleted]]
>
>                 _______________________________________________
>                 R-sig-Geo mailing list
>                 R-sig-Geo at r-project.org <mailto:R-sig-Geo at r-project.org>
>                 https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
>
>


	[[alternative HTML version deleted]]


From mspinola10 at gmail.com  Sun Feb 21 18:13:13 2016
From: mspinola10 at gmail.com (=?UTF-8?Q?Manuel_Sp=C3=ADnola?=)
Date: Sun, 21 Feb 2016 11:13:13 -0600
Subject: [R-sig-Geo] Values in a raster disappear when using reproject
	(plotKML, program = "GDAL")
Message-ID: <CABkCotQ1eD=P2+Gxy2aAcZmRq3WDCJ3=47AGM=tH6Tem3Te9aw@mail.gmail.com>

Dear list members,

When reprojecting a raster using the function "reproject" from plotKML
using program GDAL I lost the values from the raster layer (I used this
option to speed up the process in comparison to projectRaster from the
Raster package). Is there a way to keep the values from the raster? The
raster is categorical, each value correspond to land cover type.

> ras = raster("lc.tif")
> ras
class       : RasterLayer
dimensions  : 16118, 21959, 353935162  (nrow, ncol, ncell)
resolution  : 98.4252, 98.4252  (x, y)
extent      : 183871.7, 2345191, 88600.88, 1675018  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=lcc +lat_1=43 +lat_2=45.5 +lat_0=41.75 +lon_0=-120.5
+x_0=399999.9999999999 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=ft
+no_defs
data source :
C:\Users\Manuel\Documents\Documentos_personales\Clases_y_Cursos\Clases\ICOMVIS\03_Evaluacion_del_Habitat\Practicos\Practica_03_Seleccion_de_habitat_Paisaje\oregon\lc.tif
names       : lc
values      : 0, 95  (min, max)
attributes  :
       ID category
 from:  0    60051
 to  : 95  2481857


>rasp = reproject(ras, CRS("+proj=longlat +datum=WGS84"), program = "GDAL",
method = "nearest")
>rasp
class       : RasterLayer
dimensions  : 12941, 24966, 323085006  (nrow, ncol, ncell)
resolution  : 0.00034231, 0.00034231  (x, y)
extent      : -124.9617, -116.4156, 41.91483, 46.34466  (xmin, xmax, ymin,
ymax)
coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
+towgs84=0,0,0
data source :
C:\Users\Manuel\AppData\Local\Temp\Rtmpkh9ze0\file14a81d003f19_ll.tif
names       : lc



Manuel



-- 
*Manuel Sp?nola, Ph.D.*
Instituto Internacional en Conservaci?n y Manejo de Vida Silvestre
Universidad Nacional
Apartado 1350-3000
Heredia
COSTA RICA
mspinola at una.ac.cr
mspinola10 at gmail.com
Tel?fono: (506) 2277-3598
Fax: (506) 2237-7036
Personal website: Lobito de r?o <https://sites.google.com/site/lobitoderio/>
Institutional website: ICOMVIS <http://www.icomvis.una.ac.cr/>

	[[alternative HTML version deleted]]


From sohrab.abbasnejad at yahoo.com  Sun Feb 21 21:10:51 2016
From: sohrab.abbasnejad at yahoo.com (Sohrab Abbasnejad)
Date: Sun, 21 Feb 2016 20:10:51 +0000 (UTC)
Subject: [R-sig-Geo] Population-weighted Centroids of Polygons in R
References: <135789261.7728379.1456085451088.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <135789261.7728379.1456085451088.JavaMail.yahoo@mail.yahoo.com>

Dear all,
I have a set of spatial polygons and several blocks of population (with fixed area but a different number of people in each). I have used the "over" method from "sp" package to identify the blocks which are located inside these polygons.
Now, utilizing R, I wish to assign to each of these polygons a centroid in terms of the population using some kind of distance (Euclidean/shortest path, etc.). In fact, I am looking for the exact coordinates of a population-weighted centroid for each of my polygons.
Any ideas would be welcome. I truly appreciate your time.
Sincerely,Sohrab
	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Sun Feb 21 23:44:28 2016
From: loic.dutrieux at wur.nl (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Sun, 21 Feb 2016 23:44:28 +0100
Subject: [R-sig-Geo] Population-weighted Centroids of Polygons in R
In-Reply-To: <135789261.7728379.1456085451088.JavaMail.yahoo@mail.yahoo.com>
References: <135789261.7728379.1456085451088.JavaMail.yahoo.ref@mail.yahoo.com>
	<135789261.7728379.1456085451088.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <56CA3DCC.9080307@wur.nl>

Hi Sohrab,

I don't think there is a method for weighted centroids specifically.
What if you get the centroid coordinates of each "block" using 
gCentroid() and calculate a weighted average of the coordinates of every 
centroid?
See an example below assuming your blocks are a 
SpatialPolygonsDataFrame. It's quite a simple approach; not sure how 
valid it would be with more complex features though (eg: with holes, etc)...

Cheers,
Lo?c

library(rgeos)
library(sp)

# Generate SpatialPolygonsDataFrame object (blocks with population data)
cds1 <- rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
cds2 <- rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
sp <- spPolygons(cds1, cds2)
spdf <- SpatialPolygonsDataFrame(sp, data.frame(pop = c(25,32)))

# Get centroid of every polygon
centroids <- gCentroid(spdf, byid = TRUE)

# Get a dataframe with coordinates of centroids and weights
df <- cbind(data.frame(centroids), spdf at data)

# SpatialPoints corresponding to Weighted centroid
SpatialPoints(data.frame(x = weighted.mean(df$x, df$pop), y = 
weighted.mean(df$y, df$pop)))

On 02/21/2016 09:10 PM, Sohrab Abbasnejad via R-sig-Geo wrote:
> Dear all,
> I have a set of spatial polygons and several blocks of population (with fixed area but a different number of people in each). I have used the "over" method from "sp" package to identify the blocks which are located inside these polygons.
> Now, utilizing R, I wish to assign to each of these polygons a centroid in terms of the population using some kind of distance (Euclidean/shortest path, etc.). In fact, I am looking for the exact coordinates of a population-weighted centroid for each of my polygons.
> Any ideas would be welcome. I truly appreciate your time.
> Sincerely,Sohrab
> 	[[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From luca.candeloro at gmail.com  Mon Feb 22 09:13:24 2016
From: luca.candeloro at gmail.com (Luca Candeloro)
Date: Mon, 22 Feb 2016 09:13:24 +0100
Subject: [R-sig-Geo] igraph and spatial
Message-ID: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>

Dear all,
plotting graphs with given vertex coordinates is possible inside igraph
plot function.
I would like to transform vilsualized edges into SpatialLinesDataFrame, so
that they could be exported in .shp file...
Any suggestion?
thanks in advance,
Luca

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Mon Feb 22 09:30:40 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 22 Feb 2016 08:30:40 +0000
Subject: [R-sig-Geo] igraph and spatial
In-Reply-To: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
References: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
Message-ID: <CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>

On Mon, 22 Feb 2016 at 19:13 Luca Candeloro <luca.candeloro at gmail.com>
wrote:

> Dear all,
> plotting graphs with given vertex coordinates is possible inside igraph
> plot function.
> I would like to transform vilsualized edges into SpatialLinesDataFrame, so
> that they could be exported in .shp file...
> Any suggestion?
>

Can you please provide a working igraph example that we can start with?

Do you want coordinates as seen in a particular plot, or can it be more
arbitrary?

Cheers, Mike.



> thanks in advance,
> Luca
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From tyatabe at ucdavis.edu  Sat Feb 20 01:48:30 2016
From: tyatabe at ucdavis.edu (Tadaishi Yatabe-Rodriguez)
Date: Fri, 19 Feb 2016 16:48:30 -0800
Subject: [R-sig-Geo] kernel density: units of bandwidth
Message-ID: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>

Hello community,

I did a lovely kernel density from a point pattern, but now I'm wondering
what was the actual bandwidth I used. The value I used was 0.2770598, but
what does this mean? I suppose it's an area, but what is the unit? Is there
a way to transform this into a meaningful area unit?

Thanks,

Tada

-- 
*Tadaishi Yatabe*
DVM, MPVM, PhD (C)
Center for Animal Disease Modeling and Surveillance (CADMS)
Department of Medicine and Epidemiology
School of Veterinary Medicine
University of California Davis

http://tadaishi.wix.com/tada

	[[alternative HTML version deleted]]


From diego.pavonjordan at gmail.com  Mon Feb 22 10:48:42 2016
From: diego.pavonjordan at gmail.com (Diego Pavon)
Date: Mon, 22 Feb 2016 11:48:42 +0200
Subject: [R-sig-Geo] ploting Kernel results (adhabitatHR) with ggplot2
Message-ID: <CAD93_Fq3oVq-A_Cgo_D+36DQA+19C7qTrwS4+38miUWnXwfk2Q@mail.gmail.com>

Dear All

I am new user of R as a GIS software and I would like to ask you about how
to plot the results of a Kernel estimation with ggplot2 (amazing package!).

So, I have a number of locations (latitude and longitude coordinates) and I
wanted to do a kernel 50% of those locations. I used the adhabitatHR
package to do so. I read in the help file of ggplot that it is required to
have the input as a data.frame. So, after running the kernelUD command I
get an object of class estUD with all the parameters of the kernel
analysis. However this can't be understood by ggplot2.

summary(AccgenK.kernel)Object of class estUD
Coordinates:
            min     max
Var2   163706.1 8481877
Var1 -1286076.5 7378685
Is projected: TRUE
proj4string :
[+init=epsg:3035 +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000
+y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
+no_defs]
Number of points: 9600
Grid attributes:
     cellcentre.offset cellsize cells.dim
Var2          207029.9 86647.61        96
Var1        -1242752.7 86647.61       100
Data attributes:
       ud
 Min.   :0.000e+00
 1st Qu.:0.000e+00
 Median :0.000e+00
 Mean   :1.387e-14
 3rd Qu.:3.890e-17
 Max.   :5.162e-13



I can transform this object to a data.frame:

kernel.df<-as.data.frame(AccgenK.kernel)

And I get this:

str(kernel.df)'data.frame':	9600 obs. of  3 variables:
 $ ud  : num  0 0 0 0 0 0 0 0 0 0 ...
 $ Var2: num  207030 207030 207030 207030 207030 ...
 $ Var1: num  7335361 7248713 7162065 7075418 6988770 ...>
head(kernel.df)  ud     Var2    Var1
1  0 207029.9 7335361
2  0 207029.9 7248713
3  0 207029.9 7162065
4  0 207029.9 7075418
5  0 207029.9 6988770
6  0 207029.9 6902123


But when I try to plot this with ggplot2... nothing happens.

p <- ggmap(glgmap)
p <- p + geom_point(aes(x=X, y=Y, col = Killed, shape = Killed), alpha= 0.5,
                    data = Accgen,
                    size = 4)
p <- p + xlab("Longitude") + ylab("Latitude")
p <- p + theme(text = element_text(size = 15))
p <- p + scale_color_manual(values=c('royalblue', 'firebrick')) +
labs(title = substitute(paste(italic('Turdus merula'))))
p <- p + geom_polygon(data = kernel.df, aes(x = Var1, y = Var2))
p


I have also tried to create a SpatialPolygondataFrame:

ver75_AccgenK <- getverticeshr(AccgenK.kernel, 75, unout= "km2")

But then, this data.frame has only the area of the polygon...

> as.data.frame(ver75_AccgenK)                 id    area
homerange homerange 2914920


I can plot this using only the plot command, but I would like to use
ggplot and all the features that it provides.

So, does anyone know how can I plot this kernel polygon with ggplot? I
have found this earlier post:

https://stat.ethz.ch/pipermail/r-sig-geo/2010-April/008143.html


but I fail to understand how he did it...

Thank you very much for your time and help.

Best

Diego



















-- 
*Diego Pav?n Jord?n*

*Finnish Museum of Natural History*
*PO BOX 17 *

*Helsinki. Finland*



*0445061210https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
<https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html>http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
<http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile>https://helsinki.academia.edu/DiegoPavon
<https://helsinki.academia.edu/DiegoPavon>*

	[[alternative HTML version deleted]]


From roman.lustrik at gmail.com  Mon Feb 22 10:58:46 2016
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 22 Feb 2016 10:58:46 +0100
Subject: [R-sig-Geo] ploting Kernel results (adhabitatHR) with ggplot2
In-Reply-To: <CAD93_Fq3oVq-A_Cgo_D+36DQA+19C7qTrwS4+38miUWnXwfk2Q@mail.gmail.com>
References: <CAD93_Fq3oVq-A_Cgo_D+36DQA+19C7qTrwS4+38miUWnXwfk2Q@mail.gmail.com>
Message-ID: <CAHT1vpi0TPbFHgPzCVaofPPbPw9Zf3=+BnAGqfoMHUz61LxwMw@mail.gmail.com>

Hi,

can you provide a reproducible example?

Cheers,
Roman

On Mon, Feb 22, 2016 at 10:48 AM, Diego Pavon <diego.pavonjordan at gmail.com>
wrote:

> Dear All
>
> I am new user of R as a GIS software and I would like to ask you about how
> to plot the results of a Kernel estimation with ggplot2 (amazing package!).
>
> So, I have a number of locations (latitude and longitude coordinates) and I
> wanted to do a kernel 50% of those locations. I used the adhabitatHR
> package to do so. I read in the help file of ggplot that it is required to
> have the input as a data.frame. So, after running the kernelUD command I
> get an object of class estUD with all the parameters of the kernel
> analysis. However this can't be understood by ggplot2.
>
> summary(AccgenK.kernel)Object of class estUD
> Coordinates:
>             min     max
> Var2   163706.1 8481877
> Var1 -1286076.5 7378685
> Is projected: TRUE
> proj4string :
> [+init=epsg:3035 +proj=laea +lat_0=52 +lon_0=10 +x_0=4321000
> +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m
> +no_defs]
> Number of points: 9600
> Grid attributes:
>      cellcentre.offset cellsize cells.dim
> Var2          207029.9 86647.61        96
> Var1        -1242752.7 86647.61       100
> Data attributes:
>        ud
>  Min.   :0.000e+00
>  1st Qu.:0.000e+00
>  Median :0.000e+00
>  Mean   :1.387e-14
>  3rd Qu.:3.890e-17
>  Max.   :5.162e-13
>
>
>
> I can transform this object to a data.frame:
>
> kernel.df<-as.data.frame(AccgenK.kernel)
>
> And I get this:
>
> str(kernel.df)'data.frame':     9600 obs. of  3 variables:
>  $ ud  : num  0 0 0 0 0 0 0 0 0 0 ...
>  $ Var2: num  207030 207030 207030 207030 207030 ...
>  $ Var1: num  7335361 7248713 7162065 7075418 6988770 ...>
> head(kernel.df)  ud     Var2    Var1
> 1  0 207029.9 7335361
> 2  0 207029.9 7248713
> 3  0 207029.9 7162065
> 4  0 207029.9 7075418
> 5  0 207029.9 6988770
> 6  0 207029.9 6902123
>
>
> But when I try to plot this with ggplot2... nothing happens.
>
> p <- ggmap(glgmap)
> p <- p + geom_point(aes(x=X, y=Y, col = Killed, shape = Killed), alpha=
> 0.5,
>                     data = Accgen,
>                     size = 4)
> p <- p + xlab("Longitude") + ylab("Latitude")
> p <- p + theme(text = element_text(size = 15))
> p <- p + scale_color_manual(values=c('royalblue', 'firebrick')) +
> labs(title = substitute(paste(italic('Turdus merula'))))
> p <- p + geom_polygon(data = kernel.df, aes(x = Var1, y = Var2))
> p
>
>
> I have also tried to create a SpatialPolygondataFrame:
>
> ver75_AccgenK <- getverticeshr(AccgenK.kernel, 75, unout= "km2")
>
> But then, this data.frame has only the area of the polygon...
>
> > as.data.frame(ver75_AccgenK)                 id    area
> homerange homerange 2914920
>
>
> I can plot this using only the plot command, but I would like to use
> ggplot and all the features that it provides.
>
> So, does anyone know how can I plot this kernel polygon with ggplot? I
> have found this earlier post:
>
> https://stat.ethz.ch/pipermail/r-sig-geo/2010-April/008143.html
>
>
> but I fail to understand how he did it...
>
> Thank you very much for your time and help.
>
> Best
>
> Diego
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> --
> *Diego Pav?n Jord?n*
>
> *Finnish Museum of Natural History*
> *PO BOX 17 *
>
> *Helsinki. Finland*
>
>
>
> *0445061210
> https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
> <
> https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
> >
> http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
> <
> http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
> >https://helsinki.academia.edu/DiegoPavon
> <https://helsinki.academia.edu/DiegoPavon>*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo




-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From roman.lustrik at gmail.com  Mon Feb 22 10:24:29 2016
From: roman.lustrik at gmail.com (=?UTF-8?Q?Roman_Lu=C5=A1trik?=)
Date: Mon, 22 Feb 2016 10:24:29 +0100
Subject: [R-sig-Geo] kernel density: units of bandwidth
In-Reply-To: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
References: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
Message-ID: <CAHT1vpgbbn-TaeBeaeFyZT7rOy5OV_eU28jbsHHPCH8O_Ycx-Q@mail.gmail.com>

Hi,

have you seen https://en.wikipedia.org/wiki/Kernel_density_estimation and
the section on how to select binwidth
<https://en.wikipedia.org/wiki/Kernel_density_estimation#Practical_estimation_of_the_bandwidth>
?

lp,
Roman


On Sat, Feb 20, 2016 at 1:48 AM, Tadaishi Yatabe-Rodriguez <
tyatabe at ucdavis.edu> wrote:

> Hello community,
>
> I did a lovely kernel density from a point pattern, but now I'm wondering
> what was the actual bandwidth I used. The value I used was 0.2770598, but
> what does this mean? I suppose it's an area, but what is the unit? Is there
> a way to transform this into a meaningful area unit?
>
> Thanks,
>
> Tada
>
> --
> *Tadaishi Yatabe*
> DVM, MPVM, PhD (C)
> Center for Animal Disease Modeling and Surveillance (CADMS)
> Department of Medicine and Epidemiology
> School of Veterinary Medicine
> University of California Davis
>
> http://tadaishi.wix.com/tada
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
In God we trust, all others bring data.

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Mon Feb 22 18:50:53 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Mon, 22 Feb 2016 10:50:53 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a reference
 system implicit in a .nc file
Message-ID: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>

Dear all,

Im trying to overlap these points:
https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0

and a wrld_simpl object:
library(maptools)
data(wrld_simpl)

Over this raster layer
https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0

This rastr comes from a .nc file without a reference system. The author of
that .nc file gave me the following data about the .nc.

The projection is *Lambert conformal conic* projection
CEN_LAT = 38.0
CEN_LON = -100.0
TRUELAT1 = 25.
TRUELAT2 = 45.

However, despite i have gone through many sites in the internet, i cant
figure it out:

a) if that is all the data i need to set a reference system for my points
and the wrld_simp object.

b) how to change a typical CRS object with such data

Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")

Where do i enter the TRUELAT and CENLAT values?
Are there any site that explains easily what the fields in the CRS mean and
how to change them?

Thanks in advance.
-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From tech_dev at wildintellect.com  Mon Feb 22 19:04:22 2016
From: tech_dev at wildintellect.com (Alex M)
Date: Mon, 22 Feb 2016 10:04:22 -0800
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
Message-ID: <56CB4DA6.1080502@wildintellect.com>

On 02/22/2016 09:50 AM, Agus Camacho wrote:
> Dear all,
> 
> Im trying to overlap these points:
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> 
> and a wrld_simpl object:
> library(maptools)
> data(wrld_simpl)
> 
> Over this raster layer
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> 
> This rastr comes from a .nc file without a reference system. The author of
> that .nc file gave me the following data about the .nc.
> 
> The projection is *Lambert conformal conic* projection
> CEN_LAT = 38.0
> CEN_LON = -100.0
> TRUELAT1 = 25.
> TRUELAT2 = 45.
> 
> However, despite i have gone through many sites in the internet, i cant
> figure it out:
> 
> a) if that is all the data i need to set a reference system for my points
> and the wrld_simp object.
> 
> b) how to change a typical CRS object with such data
> 
> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> 
> Where do i enter the TRUELAT and CENLAT values?
> Are there any site that explains easily what the fields in the CRS mean and
> how to change them?
> 
> Thanks in advance.
> 

https://github.com/OSGeo/proj.4/wiki/GenParms
https://trac.osgeo.org/proj/wiki/GenParms

I believe:
+lat_0  = CEN_LAT   Latitude of origin
+lat_1  = TRUELAT1   Latitude of first standard parallel
+lat_2  = TRUELAT2   Latitude of second standard parallel
+lon_0  = CEN_LON   Central meridian

proj strings are defined by the proj4 libary. It's website listed above
and the associated mailing lists or gis stackexchange would be the
places to get help on it.
https://lists.osgeo.org/mailman/listinfo/metacrs

It often helps to browse similar projections on
http://spatialreference.org/
http://epsg.io/

Enjoy,
Alex


From agus.camacho at gmail.com  Mon Feb 22 19:19:41 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Mon, 22 Feb 2016 11:19:41 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CB4DA6.1080502@wildintellect.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
Message-ID: <CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>

Thanks Alex, but the locations still fall in the sea when i plot them using
your recommended Solution. I looked at the sites you proposed and they have
other values for lat_1, lat_0, etc..

2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:

> On 02/22/2016 09:50 AM, Agus Camacho wrote:
> > Dear all,
> >
> > Im trying to overlap these points:
> >
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> >
> > and a wrld_simpl object:
> > library(maptools)
> > data(wrld_simpl)
> >
> > Over this raster layer
> >
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> >
> > This rastr comes from a .nc file without a reference system. The author
> of
> > that .nc file gave me the following data about the .nc.
> >
> > The projection is *Lambert conformal conic* projection
> > CEN_LAT = 38.0
> > CEN_LON = -100.0
> > TRUELAT1 = 25.
> > TRUELAT2 = 45.
> >
> > However, despite i have gone through many sites in the internet, i cant
> > figure it out:
> >
> > a) if that is all the data i need to set a reference system for my points
> > and the wrld_simp object.
> >
> > b) how to change a typical CRS object with such data
> >
> > Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> >
> > Where do i enter the TRUELAT and CENLAT values?
> > Are there any site that explains easily what the fields in the CRS mean
> and
> > how to change them?
> >
> > Thanks in advance.
> >
>
> https://github.com/OSGeo/proj.4/wiki/GenParms
> https://trac.osgeo.org/proj/wiki/GenParms
>
> I believe:
> +lat_0  = CEN_LAT   Latitude of origin
> +lat_1  = TRUELAT1   Latitude of first standard parallel
> +lat_2  = TRUELAT2   Latitude of second standard parallel
> +lon_0  = CEN_LON   Central meridian
>
> proj strings are defined by the proj4 libary. It's website listed above
> and the associated mailing lists or gis stackexchange would be the
> places to get help on it.
> https://lists.osgeo.org/mailman/listinfo/metacrs
>
> It often helps to browse similar projections on
> http://spatialreference.org/
> http://epsg.io/
>
> Enjoy,
> Alex
>
>


-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Mon Feb 22 19:21:05 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Mon, 22 Feb 2016 11:21:05 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
Message-ID: <CALsJ7pRN4sf1-bktOnCPihGRrtOv9grCLwAkKFk=7j+9GFuoTQ@mail.gmail.com>

but its ok, ill ask in another mail list.

2016-02-22 11:19 GMT-07:00 Agus Camacho <agus.camacho at gmail.com>:

> Thanks Alex, but the locations still fall in the sea when i plot them
> using your recommended Solution. I looked at the sites you proposed and
> they have other values for lat_1, lat_0, etc..
>
> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>
>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>> > Dear all,
>> >
>> > Im trying to overlap these points:
>> >
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>> >
>> > and a wrld_simpl object:
>> > library(maptools)
>> > data(wrld_simpl)
>> >
>> > Over this raster layer
>> >
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>> >
>> > This rastr comes from a .nc file without a reference system. The author
>> of
>> > that .nc file gave me the following data about the .nc.
>> >
>> > The projection is *Lambert conformal conic* projection
>> > CEN_LAT = 38.0
>> > CEN_LON = -100.0
>> > TRUELAT1 = 25.
>> > TRUELAT2 = 45.
>> >
>> > However, despite i have gone through many sites in the internet, i cant
>> > figure it out:
>> >
>> > a) if that is all the data i need to set a reference system for my
>> points
>> > and the wrld_simp object.
>> >
>> > b) how to change a typical CRS object with such data
>> >
>> > Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>> >
>> > Where do i enter the TRUELAT and CENLAT values?
>> > Are there any site that explains easily what the fields in the CRS mean
>> and
>> > how to change them?
>> >
>> > Thanks in advance.
>> >
>>
>> https://github.com/OSGeo/proj.4/wiki/GenParms
>> https://trac.osgeo.org/proj/wiki/GenParms
>>
>> I believe:
>> +lat_0  = CEN_LAT   Latitude of origin
>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>> +lon_0  = CEN_LON   Central meridian
>>
>> proj strings are defined by the proj4 libary. It's website listed above
>> and the associated mailing lists or gis stackexchange would be the
>> places to get help on it.
>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>
>> It often helps to browse similar projections on
>> http://spatialreference.org/
>> http://epsg.io/
>>
>> Enjoy,
>> Alex
>>
>>
>
>
> --
> Agust?n Camacho Guerrero.
> Doutor em Zoologia.
> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> Bioci?ncias, USP.
> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> S?o Paulo - SP, CEP: 05508-090, Brasil.
>



-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From r.turner at auckland.ac.nz  Mon Feb 22 21:08:44 2016
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 23 Feb 2016 09:08:44 +1300
Subject: [R-sig-Geo] [FORGED]  kernel density: units of bandwidth
In-Reply-To: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
References: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
Message-ID: <56CB6ACC.7060608@auckland.ac.nz>

On 20/02/16 13:48, Tadaishi Yatabe-Rodriguez wrote:
> Hello community,
>
> I did a lovely kernel density from a point pattern, but now I'm wondering
> what was the actual bandwidth I used. The value I used was 0.2770598, but
> what does this mean? I suppose it's an area, but what is the unit? Is there
> a way to transform this into a meaningful area unit?

As the help for density.ppp tells you, sigma is the standard deviation 
of the isotropic Gaussian "smoothing kernel" (i.e. density function with
mean c(0,0) and standard deviation of both "X" and "Y" equal to sigma, 
and cov(X,Y) = 0).  Consequently the units of sigma are the units in 
which X and Y are measured.

Thus if, for example, your point coordinates are in metres, then the 
units of sigma are metres.  (So sigma is measured not in area but in 
length or distance.)

HTH

cheers,

Rolf Turner

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From r.turner at auckland.ac.nz  Mon Feb 22 22:53:52 2016
From: r.turner at auckland.ac.nz (Rolf Turner)
Date: Tue, 23 Feb 2016 10:53:52 +1300
Subject: [R-sig-Geo] [FORGED] Re: [FORGED] kernel density: units of
 bandwidth
In-Reply-To: <CAMtcdVjMds3m1vgnUTUTnsysP7E=ZwnurbOSaKv6c-j3WD27ZQ@mail.gmail.com>
References: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
	<56CB6ACC.7060608@auckland.ac.nz>
	<CAMtcdVjMds3m1vgnUTUTnsysP7E=ZwnurbOSaKv6c-j3WD27ZQ@mail.gmail.com>
Message-ID: <56CB8370.9080701@auckland.ac.nz>

On 23/02/16 10:34, Tadaishi Yatabe-Rodriguez wrote:

> Thanks, Rolf. This ,makes it clearer. I've another question though: the
> ppp object I get the Kernel density from is not projected, then what
> would be the unit of projection of this un-projected object? The
> projection of the object from which it was created from (e.g.
> SpatialPoints object)?
>
> Thanks again,

You should probably keep this discussion on-list; others who subscribe 
to the list are much more knowledgeable than I and may have useful 
contributions to make (and may correct my errors).  I have taken the 
liberty of including the list in my reply.

I think that your question is not well-posed.  The density.ppm() 
function treats the coordinates of points as Euclidean coordinates (with 
the same units on both the x and y axes).  If your point pattern is 
"un-protected" then I presume that x and y are in longitude and latitude 
in which case the coordinates are not Euclidean and the x and y axis 
units are different, since longitude and latitude are constructed in 
different ways.

If the region in question is "small" (and not too near either pole, I 
guess) then this probably doesn't make much difference, and the units of 
sigma would, roughly speaking, be "degrees".  Otherwise it seems to me 
there is no meaningful answer to your question.

It would probably be best to project your data before forming the ppp 
object.

Ege has been doing some work on point patterns on the sphere which might 
possibly be of relevance here.  He may feel like chiming in on this issue.

cheers,

Rolf

-- 
Technical Editor ANZJS
Department of Statistics
University of Auckland
Phone: +64-9-373-7599 ext. 88276


From tech_dev at wildintellect.com  Tue Feb 23 07:25:59 2016
From: tech_dev at wildintellect.com (Alex Mandel)
Date: Mon, 22 Feb 2016 22:25:59 -0800
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
Message-ID: <56CBFB77.4020707@wildintellect.com>

I made an attempt at it too. Investigating the original data, I'm not
sure that the projection information supplied is correct for the data
linked. When I load up the data in a unprojected space, the coordinates
don't look at all similar to any Lambert projected data I have, they
actually look like Lat/Lon in some unprojected coordinate system,
perhaps a different spheroid than expected.

-Alex

On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
> Hi
> 
> I tried to make it work but I had to give up. I wanted to reproject the Lamberth conformal conic coordinates to long-lat but it didn't work.
> 
> Perhaps someone can see what I did wrong. Here is what I did (data in R binary format and figure in png format both attached):
> 
> library(raster)
> library(maptools)
> data(wrld_simpl)
> 
> r <- raster("raster.grd")
> projection(r)
> ## > NA
> 
> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep = ",")
> coordinates(uro) <- ~lon+lat
> 
> ## Set projections for the 3 data sets
> 
> ## Lamberth's confocal conic projection with given parameters
> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0 +ellps=WGS84"
> projection(r)
> 
> ## Assume that lon, lat are geographical coordinates (degrees decimal)
> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
> 
> ## wrld_simpl is in geographical coordinates
> proj4string(wrld_simpl)
> 
> ## Make figure in png format
> ## Of course plotting data with 2 different projections will give
> ## some distortions
> pdf("uro.png")
> 
> plot(r)
> points(uro)
> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of 'r'
> 
> dev.off()
> 
> extent(r)
> ## class       : Extent 
> ## xmin        : -131.4368 
> ## xmax        : -68.56323 
> ## ymin        : 12.35567 
> ## ymax        : 50.26619 
> 
> ## Reproject the raster to long-lat
> ## This doesn't work (collapsed domain)
> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
> 
> ## Because
>> extent(rp)
> ## class       : Extent 
> ## xmin        : -100.0015 
> ## xmax        : -99.68557 
> ## ymin        : 37.70658 
> ## ymax        : 38.00046 
> 
> ## Save data in R binary format
> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
> 
> 
> Yours sincerely / Med venlig hilsen
> 
> Frede Aakmann T?gersen
> Specialist, M.Sc., Ph.D.
> Plant Performance & Modeling
> 
> Technology & Service Solutions
> T +45 9730 5135
> M +45 2547 6050
> frtog at vestas.com
> http://www.vestas.com
> 
> Company reg. name: Vestas Wind Systems A/S
> This e-mail is subject to our e-mail disclaimer statement.
> Please refer to www.vestas.com/legal/notice
> If you have received this e-mail in error please contact the sender. 
> 
> 
> 
> -----Original Message-----
> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Agus Camacho
> Sent: 22. februar 2016 19:20
> To: tech at wildintellect.com
> Cc: r-sig-geo
> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a reference system implicit in a .nc file
> 
> Thanks Alex, but the locations still fall in the sea when i plot them using
> your recommended Solution. I looked at the sites you proposed and they have
> other values for lat_1, lat_0, etc..
> 
> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
> 
>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>> Dear all,
>>>
>>> Im trying to overlap these points:
>>>
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>
>>> and a wrld_simpl object:
>>> library(maptools)
>>> data(wrld_simpl)
>>>
>>> Over this raster layer
>>>
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>
>>> This rastr comes from a .nc file without a reference system. The author
>> of
>>> that .nc file gave me the following data about the .nc.
>>>
>>> The projection is *Lambert conformal conic* projection
>>> CEN_LAT = 38.0
>>> CEN_LON = -100.0
>>> TRUELAT1 = 25.
>>> TRUELAT2 = 45.
>>>
>>> However, despite i have gone through many sites in the internet, i cant
>>> figure it out:
>>>
>>> a) if that is all the data i need to set a reference system for my points
>>> and the wrld_simp object.
>>>
>>> b) how to change a typical CRS object with such data
>>>
>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>
>>> Where do i enter the TRUELAT and CENLAT values?
>>> Are there any site that explains easily what the fields in the CRS mean
>> and
>>> how to change them?
>>>
>>> Thanks in advance.
>>>
>>
>> https://github.com/OSGeo/proj.4/wiki/GenParms
>> https://trac.osgeo.org/proj/wiki/GenParms
>>
>> I believe:
>> +lat_0  = CEN_LAT   Latitude of origin
>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>> +lon_0  = CEN_LON   Central meridian
>>
>> proj strings are defined by the proj4 libary. It's website listed above
>> and the associated mailing lists or gis stackexchange would be the
>> places to get help on it.
>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>
>> It often helps to browse similar projections on
>> http://spatialreference.org/
>> http://epsg.io/
>>
>> Enjoy,
>> Alex
>>
>>
> 
>


From Roger.Bivand at nhh.no  Tue Feb 23 10:08:44 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 23 Feb 2016 10:08:44 +0100
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CBFB77.4020707@wildintellect.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
Message-ID: <alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>

On Tue, 23 Feb 2016, Alex Mandel wrote:

> I made an attempt at it too. Investigating the original data, I'm not
> sure that the projection information supplied is correct for the data
> linked. When I load up the data in a unprojected space, the coordinates
> don't look at all similar to any Lambert projected data I have, they
> actually look like Lat/Lon in some unprojected coordinate system,
> perhaps a different spheroid than expected.

Does anyone have a link to the original data? Is is possible that this is 
the General Oblique Transformation used by modellers - that is something 
that feels like longlat but is recentred and oblique? Example at the very 
end of my GEOSTAT talk last year (slides 81-83):

http://geostat-course.org/system/files/geostat_talk_150817.pdf

Roger

>
> -Alex
>
> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>> Hi
>> 
>> I tried to make it work but I had to give up. I wanted to reproject the Lamberth conformal conic coordinates to long-lat but it didn't work.
>> 
>> Perhaps someone can see what I did wrong. Here is what I did (data in R binary format and figure in png format both attached):
>> 
>> library(raster)
>> library(maptools)
>> data(wrld_simpl)
>> 
>> r <- raster("raster.grd")
>> projection(r)
>> ## > NA
>> 
>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep = ",")
>> coordinates(uro) <- ~lon+lat
>> 
>> ## Set projections for the 3 data sets
>> 
>> ## Lamberth's confocal conic projection with given parameters
>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0 +ellps=WGS84"
>> projection(r)
>> 
>> ## Assume that lon, lat are geographical coordinates (degrees decimal)
>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>> 
>> ## wrld_simpl is in geographical coordinates
>> proj4string(wrld_simpl)
>> 
>> ## Make figure in png format
>> ## Of course plotting data with 2 different projections will give
>> ## some distortions
>> pdf("uro.png")
>> 
>> plot(r)
>> points(uro)
>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of 'r'
>> 
>> dev.off()
>> 
>> extent(r)
>> ## class       : Extent 
>> ## xmin        : -131.4368 
>> ## xmax        : -68.56323 
>> ## ymin        : 12.35567 
>> ## ymax        : 50.26619 
>> 
>> ## Reproject the raster to long-lat
>> ## This doesn't work (collapsed domain)
>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
>> 
>> ## Because
>>> extent(rp)
>> ## class       : Extent 
>> ## xmin        : -100.0015 
>> ## xmax        : -99.68557 
>> ## ymin        : 37.70658 
>> ## ymax        : 38.00046 
>> 
>> ## Save data in R binary format
>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>> 
>> 
>> Yours sincerely / Med venlig hilsen
>> 
>> Frede Aakmann T?gersen
>> Specialist, M.Sc., Ph.D.
>> Plant Performance & Modeling
>> 
>> Technology & Service Solutions
>> T +45 9730 5135
>> M +45 2547 6050
>> frtog at vestas.com
>> http://www.vestas.com
>> 
>> Company reg. name: Vestas Wind Systems A/S
>> This e-mail is subject to our e-mail disclaimer statement.
>> Please refer to www.vestas.com/legal/notice
>> If you have received this e-mail in error please contact the sender. 
>> 
>> 
>> 
>> -----Original Message-----
>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of Agus Camacho
>> Sent: 22. februar 2016 19:20
>> To: tech at wildintellect.com
>> Cc: r-sig-geo
>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a reference system implicit in a .nc file
>> 
>> Thanks Alex, but the locations still fall in the sea when i plot them using
>> your recommended Solution. I looked at the sites you proposed and they have
>> other values for lat_1, lat_0, etc..
>> 
>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>> 
>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>> Dear all,
>>>>
>>>> Im trying to overlap these points:
>>>>
>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>
>>>> and a wrld_simpl object:
>>>> library(maptools)
>>>> data(wrld_simpl)
>>>>
>>>> Over this raster layer
>>>>
>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>
>>>> This rastr comes from a .nc file without a reference system. The author
>>> of
>>>> that .nc file gave me the following data about the .nc.
>>>>
>>>> The projection is *Lambert conformal conic* projection
>>>> CEN_LAT = 38.0
>>>> CEN_LON = -100.0
>>>> TRUELAT1 = 25.
>>>> TRUELAT2 = 45.
>>>>
>>>> However, despite i have gone through many sites in the internet, i cant
>>>> figure it out:
>>>>
>>>> a) if that is all the data i need to set a reference system for my points
>>>> and the wrld_simp object.
>>>>
>>>> b) how to change a typical CRS object with such data
>>>>
>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>
>>>> Where do i enter the TRUELAT and CENLAT values?
>>>> Are there any site that explains easily what the fields in the CRS mean
>>> and
>>>> how to change them?
>>>>
>>>> Thanks in advance.
>>>>
>>>
>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>
>>> I believe:
>>> +lat_0  = CEN_LAT   Latitude of origin
>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>> +lon_0  = CEN_LON   Central meridian
>>>
>>> proj strings are defined by the proj4 libary. It's website listed above
>>> and the associated mailing lists or gis stackexchange would be the
>>> places to get help on it.
>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>
>>> It often helps to browse similar projections on
>>> http://spatialreference.org/
>>> http://epsg.io/
>>>
>>> Enjoy,
>>> Alex
>>>
>>>
>> 
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From mdsumner at gmail.com  Tue Feb 23 10:25:41 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 23 Feb 2016 09:25:41 +0000
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
Message-ID: <CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>

On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:

> On Tue, 23 Feb 2016, Alex Mandel wrote:
>
> > I made an attempt at it too. Investigating the original data, I'm not
> > sure that the projection information supplied is correct for the data
> > linked. When I load up the data in a unprojected space, the coordinates
> > don't look at all similar to any Lambert projected data I have, they
> > actually look like Lat/Lon in some unprojected coordinate system,
> > perhaps a different spheroid than expected.
>
> Does anyone have a link to the original data? Is is possible that this is
> the General Oblique Transformation used by modellers - that is something
> that feels like longlat but is recentred and oblique? Example at the very
> end of my GEOSTAT talk last year (slides 81-83):
>
> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>
> Roger
>
>
For what it is worth, the General Oblique Transformation is not the only
example - it's very common for modellers to have a mesh that has the
"mostly-properties" of a projection, but is not actually describable with
standard transform + affine parameters. The main cases that I've seen are
polar stereographic, equal area or oblique Mercator. Often they really are
simple transforms and you can reconstruct without loss, but it's not
usually possible to tell without exploration. It's an interesting
dis-connect to see code that builds a mesh with certain properties, then
only stores longitudes and latitudes - when it could be done with standard
tools and be stored and used much more efficiently.

(I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
terminology conflated in this context too. )

I'm also interested to explore the original data.

Cheers, Mike.



> >
> > -Alex
> >
> > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
> >> Hi
> >>
> >> I tried to make it work but I had to give up. I wanted to reproject the
> Lamberth conformal conic coordinates to long-lat but it didn't work.
> >>
> >> Perhaps someone can see what I did wrong. Here is what I did (data in R
> binary format and figure in png format both attached):
> >>
> >> library(raster)
> >> library(maptools)
> >> data(wrld_simpl)
> >>
> >> r <- raster("raster.grd")
> >> projection(r)
> >> ## > NA
> >>
> >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep = ",")
> >> coordinates(uro) <- ~lon+lat
> >>
> >> ## Set projections for the 3 data sets
> >>
> >> ## Lamberth's confocal conic projection with given parameters
> >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0
> +ellps=WGS84"
> >> projection(r)
> >>
> >> ## Assume that lon, lat are geographical coordinates (degrees decimal)
> >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
> >>
> >> ## wrld_simpl is in geographical coordinates
> >> proj4string(wrld_simpl)
> >>
> >> ## Make figure in png format
> >> ## Of course plotting data with 2 different projections will give
> >> ## some distortions
> >> pdf("uro.png")
> >>
> >> plot(r)
> >> points(uro)
> >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of 'r'
> >>
> >> dev.off()
> >>
> >> extent(r)
> >> ## class       : Extent
> >> ## xmin        : -131.4368
> >> ## xmax        : -68.56323
> >> ## ymin        : 12.35567
> >> ## ymax        : 50.26619
> >>
> >> ## Reproject the raster to long-lat
> >> ## This doesn't work (collapsed domain)
> >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
> +ellps=WGS84 +towgs84=0,0,0")
> >>
> >> ## Because
> >>> extent(rp)
> >> ## class       : Extent
> >> ## xmin        : -100.0015
> >> ## xmax        : -99.68557
> >> ## ymin        : 37.70658
> >> ## ymax        : 38.00046
> >>
> >> ## Save data in R binary format
> >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
> >>
> >>
> >> Yours sincerely / Med venlig hilsen
> >>
> >> Frede Aakmann T?gersen
> >> Specialist, M.Sc., Ph.D.
> >> Plant Performance & Modeling
> >>
> >> Technology & Service Solutions
> >> T +45 9730 5135
> >> M +45 2547 6050
> >> frtog at vestas.com
> >> http://www.vestas.com
> >>
> >> Company reg. name: Vestas Wind Systems A/S
> >> This e-mail is subject to our e-mail disclaimer statement.
> >> Please refer to www.vestas.com/legal/notice
> >> If you have received this e-mail in error please contact the sender.
> >>
> >>
> >>
> >> -----Original Message-----
> >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> Agus Camacho
> >> Sent: 22. februar 2016 19:20
> >> To: tech at wildintellect.com
> >> Cc: r-sig-geo
> >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
> reference system implicit in a .nc file
> >>
> >> Thanks Alex, but the locations still fall in the sea when i plot them
> using
> >> your recommended Solution. I looked at the sites you proposed and they
> have
> >> other values for lat_1, lat_0, etc..
> >>
> >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
> >>
> >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
> >>>> Dear all,
> >>>>
> >>>> Im trying to overlap these points:
> >>>>
> >>>
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> >>>>
> >>>> and a wrld_simpl object:
> >>>> library(maptools)
> >>>> data(wrld_simpl)
> >>>>
> >>>> Over this raster layer
> >>>>
> >>>
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> >>>>
> >>>> This rastr comes from a .nc file without a reference system. The
> author
> >>> of
> >>>> that .nc file gave me the following data about the .nc.
> >>>>
> >>>> The projection is *Lambert conformal conic* projection
> >>>> CEN_LAT = 38.0
> >>>> CEN_LON = -100.0
> >>>> TRUELAT1 = 25.
> >>>> TRUELAT2 = 45.
> >>>>
> >>>> However, despite i have gone through many sites in the internet, i
> cant
> >>>> figure it out:
> >>>>
> >>>> a) if that is all the data i need to set a reference system for my
> points
> >>>> and the wrld_simp object.
> >>>>
> >>>> b) how to change a typical CRS object with such data
> >>>>
> >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> >>>>
> >>>> Where do i enter the TRUELAT and CENLAT values?
> >>>> Are there any site that explains easily what the fields in the CRS
> mean
> >>> and
> >>>> how to change them?
> >>>>
> >>>> Thanks in advance.
> >>>>
> >>>
> >>> https://github.com/OSGeo/proj.4/wiki/GenParms
> >>> https://trac.osgeo.org/proj/wiki/GenParms
> >>>
> >>> I believe:
> >>> +lat_0  = CEN_LAT   Latitude of origin
> >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
> >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
> >>> +lon_0  = CEN_LON   Central meridian
> >>>
> >>> proj strings are defined by the proj4 libary. It's website listed above
> >>> and the associated mailing lists or gis stackexchange would be the
> >>> places to get help on it.
> >>> https://lists.osgeo.org/mailman/listinfo/metacrs
> >>>
> >>> It often helps to browse similar projections on
> >>> http://spatialreference.org/
> >>> http://epsg.io/
> >>>
> >>> Enjoy,
> >>> Alex
> >>>
> >>>
> >>
> >>
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Roger Bivand
> Department of Economics, Norwegian School of Economics,
> Helleveien 30, N-5045 Bergen, Norway.
> voice: +47 55 95 93 55; fax +47 55 95 91 00
> e-mail: Roger.Bivand at nhh.no
> http://orcid.org/0000-0003-2392-6140
> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> http://depsy.org/person/434412
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From C.E.Regan at sms.ed.ac.uk  Tue Feb 23 10:33:20 2016
From: C.E.Regan at sms.ed.ac.uk (Charlotte Regan)
Date: Tue, 23 Feb 2016 09:33:20 +0000
Subject: [R-sig-Geo] Home range overlaps calculated using BA are sometimes >1
Message-ID: <20160223093320.211416odsi3eokf4@www.staffmail.ed.ac.uk>

Hi there,

I'm using kerneloverlaphr from adehabitatHR to estimate the home range  
overlap between pairs of sheep. I really need an overlap measure that  
scales between 0 and 1 and therefore settled on BA, but I'm finding  
that in a few cases the overlap is greater than 1. It seems to be  
happening when an individual's UD is compared to itself.

My code is as below:

spdf<-SpatialPointsDataFrame(census[,12:13],census[,1:2])
UDs<-kernelUD(spdf[,1],same4all=TRUE,grid=200,extent=4)
overlaps<-kerneloverlaphr(UDs,method="BA",percent=70)

I noticed that there's been a post asking the same question before  
(https://stat.ethz.ch/pipermail/r-sig-geo/2011-February/010875.html),  
but an answer wasn't posted to the thread.

Apologies if it's just some failure in my coding/understanding, but  
thank you very much for any help you can provide!

Thanks,

Charlotte Regan

-- 
The University of Edinburgh is a charitable body, registered in
Scotland, with registration number SC005336.


From tyatabe at ucdavis.edu  Mon Feb 22 22:58:23 2016
From: tyatabe at ucdavis.edu (Tadaishi Yatabe-Rodriguez)
Date: Mon, 22 Feb 2016 13:58:23 -0800
Subject: [R-sig-Geo] [FORGED] Re: [FORGED] kernel density: units of
	bandwidth
In-Reply-To: <56CB8370.9080701@auckland.ac.nz>
References: <CAMtcdViDr1WP4kDJ3AfQC86Di+1gEn+dQ9m4miyUGj7B7zwfxw@mail.gmail.com>
	<56CB6ACC.7060608@auckland.ac.nz>
	<CAMtcdVjMds3m1vgnUTUTnsysP7E=ZwnurbOSaKv6c-j3WD27ZQ@mail.gmail.com>
	<56CB8370.9080701@auckland.ac.nz>
Message-ID: <CAMtcdVhO4-iCB6b1SL=8b8Ynw01WkVo2g73ni+Qi7Ai04Tx4xA@mail.gmail.com>

Sorry, Rolf. I didn't realize I was replying only to you!
Thanks for your reply. I'll project before making the ppp object that I'll
use in my Kernel.

Thanks,

T

On Mon, Feb 22, 2016 at 1:53 PM, Rolf Turner <r.turner at auckland.ac.nz>
wrote:

> On 23/02/16 10:34, Tadaishi Yatabe-Rodriguez wrote:
>
> Thanks, Rolf. This ,makes it clearer. I've another question though: the
>> ppp object I get the Kernel density from is not projected, then what
>> would be the unit of projection of this un-projected object? The
>> projection of the object from which it was created from (e.g.
>> SpatialPoints object)?
>>
>> Thanks again,
>>
>
> You should probably keep this discussion on-list; others who subscribe to
> the list are much more knowledgeable than I and may have useful
> contributions to make (and may correct my errors).  I have taken the
> liberty of including the list in my reply.
>
> I think that your question is not well-posed.  The density.ppm() function
> treats the coordinates of points as Euclidean coordinates (with the same
> units on both the x and y axes).  If your point pattern is "un-protected"
> then I presume that x and y are in longitude and latitude in which case the
> coordinates are not Euclidean and the x and y axis units are different,
> since longitude and latitude are constructed in different ways.
>
> If the region in question is "small" (and not too near either pole, I
> guess) then this probably doesn't make much difference, and the units of
> sigma would, roughly speaking, be "degrees".  Otherwise it seems to me
> there is no meaningful answer to your question.
>
> It would probably be best to project your data before forming the ppp
> object.
>
> Ege has been doing some work on point patterns on the sphere which might
> possibly be of relevance here.  He may feel like chiming in on this issue.
>
> cheers,
>
> Rolf
>
>
> --
> Technical Editor ANZJS
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>



-- 
*Tadaishi Yatabe*
DVM, MPVM, PhD (C)
Center for Animal Disease Modeling and Surveillance (CADMS)
Department of Medicine and Epidemiology
School of Veterinary Medicine
University of California Davis

http://tadaishi.wix.com/tada

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Tue Feb 23 19:27:46 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 11:27:46 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
Message-ID: <CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>

Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
more giant crab this time.

The creator of the .nc file also looked at this webpage:
http://www.pkrc.net/wrf-lambert.html
It seemed like the right proj4 string might be this one:

+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
    +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs

However this projection also does not allow me to adequately plot the
locations on the raster.

Here is the .nc file. it contains several layers.

https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0



2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:

> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>
> > On Tue, 23 Feb 2016, Alex Mandel wrote:
> >
> > > I made an attempt at it too. Investigating the original data, I'm not
> > > sure that the projection information supplied is correct for the data
> > > linked. When I load up the data in a unprojected space, the coordinates
> > > don't look at all similar to any Lambert projected data I have, they
> > > actually look like Lat/Lon in some unprojected coordinate system,
> > > perhaps a different spheroid than expected.
> >
> > Does anyone have a link to the original data? Is is possible that this is
> > the General Oblique Transformation used by modellers - that is something
> > that feels like longlat but is recentred and oblique? Example at the very
> > end of my GEOSTAT talk last year (slides 81-83):
> >
> > http://geostat-course.org/system/files/geostat_talk_150817.pdf
> >
> > Roger
> >
> >
> For what it is worth, the General Oblique Transformation is not the only
> example - it's very common for modellers to have a mesh that has the
> "mostly-properties" of a projection, but is not actually describable with
> standard transform + affine parameters. The main cases that I've seen are
> polar stereographic, equal area or oblique Mercator. Often they really are
> simple transforms and you can reconstruct without loss, but it's not
> usually possible to tell without exploration. It's an interesting
> dis-connect to see code that builds a mesh with certain properties, then
> only stores longitudes and latitudes - when it could be done with standard
> tools and be stored and used much more efficiently.
>
> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
> terminology conflated in this context too. )
>
> I'm also interested to explore the original data.
>
> Cheers, Mike.
>
>
>
> > >
> > > -Alex
> > >
> > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
> > >> Hi
> > >>
> > >> I tried to make it work but I had to give up. I wanted to reproject
> the
> > Lamberth conformal conic coordinates to long-lat but it didn't work.
> > >>
> > >> Perhaps someone can see what I did wrong. Here is what I did (data in
> R
> > binary format and figure in png format both attached):
> > >>
> > >> library(raster)
> > >> library(maptools)
> > >> data(wrld_simpl)
> > >>
> > >> r <- raster("raster.grd")
> > >> projection(r)
> > >> ## > NA
> > >>
> > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep = ",")
> > >> coordinates(uro) <- ~lon+lat
> > >>
> > >> ## Set projections for the 3 data sets
> > >>
> > >> ## Lamberth's confocal conic projection with given parameters
> > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0
> > +ellps=WGS84"
> > >> projection(r)
> > >>
> > >> ## Assume that lon, lat are geographical coordinates (degrees decimal)
> > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
> > >>
> > >> ## wrld_simpl is in geographical coordinates
> > >> proj4string(wrld_simpl)
> > >>
> > >> ## Make figure in png format
> > >> ## Of course plotting data with 2 different projections will give
> > >> ## some distortions
> > >> pdf("uro.png")
> > >>
> > >> plot(r)
> > >> points(uro)
> > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of 'r'
> > >>
> > >> dev.off()
> > >>
> > >> extent(r)
> > >> ## class       : Extent
> > >> ## xmin        : -131.4368
> > >> ## xmax        : -68.56323
> > >> ## ymin        : 12.35567
> > >> ## ymax        : 50.26619
> > >>
> > >> ## Reproject the raster to long-lat
> > >> ## This doesn't work (collapsed domain)
> > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
> > +ellps=WGS84 +towgs84=0,0,0")
> > >>
> > >> ## Because
> > >>> extent(rp)
> > >> ## class       : Extent
> > >> ## xmin        : -100.0015
> > >> ## xmax        : -99.68557
> > >> ## ymin        : 37.70658
> > >> ## ymax        : 38.00046
> > >>
> > >> ## Save data in R binary format
> > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
> > >>
> > >>
> > >> Yours sincerely / Med venlig hilsen
> > >>
> > >> Frede Aakmann T?gersen
> > >> Specialist, M.Sc., Ph.D.
> > >> Plant Performance & Modeling
> > >>
> > >> Technology & Service Solutions
> > >> T +45 9730 5135
> > >> M +45 2547 6050
> > >> frtog at vestas.com
> > >> http://www.vestas.com
> > >>
> > >> Company reg. name: Vestas Wind Systems A/S
> > >> This e-mail is subject to our e-mail disclaimer statement.
> > >> Please refer to www.vestas.com/legal/notice
> > >> If you have received this e-mail in error please contact the sender.
> > >>
> > >>
> > >>
> > >> -----Original Message-----
> > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
> > Agus Camacho
> > >> Sent: 22. februar 2016 19:20
> > >> To: tech at wildintellect.com
> > >> Cc: r-sig-geo
> > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
> > reference system implicit in a .nc file
> > >>
> > >> Thanks Alex, but the locations still fall in the sea when i plot them
> > using
> > >> your recommended Solution. I looked at the sites you proposed and they
> > have
> > >> other values for lat_1, lat_0, etc..
> > >>
> > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
> > >>
> > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
> > >>>> Dear all,
> > >>>>
> > >>>> Im trying to overlap these points:
> > >>>>
> > >>>
> >
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> > >>>>
> > >>>> and a wrld_simpl object:
> > >>>> library(maptools)
> > >>>> data(wrld_simpl)
> > >>>>
> > >>>> Over this raster layer
> > >>>>
> > >>>
> >
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> > >>>>
> > >>>> This rastr comes from a .nc file without a reference system. The
> > author
> > >>> of
> > >>>> that .nc file gave me the following data about the .nc.
> > >>>>
> > >>>> The projection is *Lambert conformal conic* projection
> > >>>> CEN_LAT = 38.0
> > >>>> CEN_LON = -100.0
> > >>>> TRUELAT1 = 25.
> > >>>> TRUELAT2 = 45.
> > >>>>
> > >>>> However, despite i have gone through many sites in the internet, i
> > cant
> > >>>> figure it out:
> > >>>>
> > >>>> a) if that is all the data i need to set a reference system for my
> > points
> > >>>> and the wrld_simp object.
> > >>>>
> > >>>> b) how to change a typical CRS object with such data
> > >>>>
> > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> > >>>>
> > >>>> Where do i enter the TRUELAT and CENLAT values?
> > >>>> Are there any site that explains easily what the fields in the CRS
> > mean
> > >>> and
> > >>>> how to change them?
> > >>>>
> > >>>> Thanks in advance.
> > >>>>
> > >>>
> > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
> > >>> https://trac.osgeo.org/proj/wiki/GenParms
> > >>>
> > >>> I believe:
> > >>> +lat_0  = CEN_LAT   Latitude of origin
> > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
> > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
> > >>> +lon_0  = CEN_LON   Central meridian
> > >>>
> > >>> proj strings are defined by the proj4 libary. It's website listed
> above
> > >>> and the associated mailing lists or gis stackexchange would be the
> > >>> places to get help on it.
> > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
> > >>>
> > >>> It often helps to browse similar projections on
> > >>> http://spatialreference.org/
> > >>> http://epsg.io/
> > >>>
> > >>> Enjoy,
> > >>> Alex
> > >>>
> > >>>
> > >>
> > >>
> > >
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > Roger Bivand
> > Department of Economics, Norwegian School of Economics,
> > Helleveien 30, N-5045 Bergen, Norway.
> > voice: +47 55 95 93 55; fax +47 55 95 91 00
> > e-mail: Roger.Bivand at nhh.no
> > http://orcid.org/0000-0003-2392-6140
> > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> > http://depsy.org/person/434412
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From Roger.Bivand at nhh.no  Tue Feb 23 19:56:34 2016
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 23 Feb 2016 19:56:34 +0100
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
Message-ID: <alpine.LFD.2.20.1602231939490.9884@reclus.nhh.no>

On Tue, 23 Feb 2016, Agus Camacho wrote:

> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
> more giant crab this time.
>
> The creator of the .nc file also looked at this webpage:
> http://www.pkrc.net/wrf-lambert.html
> It seemed like the right proj4 string might be this one:
>
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>    +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>
> However this projection also does not allow me to adequately plot the
> locations on the raster.
>
> Here is the .nc file. it contains several layers.
>
> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>

Thanks for the link. The proj4 string is missing +units=km (the spherical 
axes are certainly not in metres), but is wrong anyway.

This says:

> gI <- GDALinfo("results_us_future_output_none_0.nc")
Error in .local(.Object, ...) :
   No UNIDATA NC_GLOBAL:Conventions attribute

The values of the coordinate variables are:

library(ncdf4)
r <- nc_open("results_us_future_output_none_0.nc")
pts <- cbind(c(ncvar_get(r, "lon")), c(ncvar_get(r, "lat")))

> summary(pts)
        V1                V2
  Min.   :-151.30   Min.   :12.36
  1st Qu.:-120.44   1st Qu.:25.45
  Median :-100.00   Median :35.72
  Mean   :-100.00   Mean   :35.71
  3rd Qu.: -79.56   3rd Qu.:45.91
  Max.   : -48.70   Max.   :58.33

which are obviously not a grid:

pts1 <- SpatialPoints(pts)
plot(pts1)
# gridded(pts1) <- TRUE fails miserably

This is definitely not lcc, irrespective of what the originator says.

Mike - any forensics?

Roger

>
>
> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>
>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>
>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>
>>>> I made an attempt at it too. Investigating the original data, I'm not
>>>> sure that the projection information supplied is correct for the data
>>>> linked. When I load up the data in a unprojected space, the coordinates
>>>> don't look at all similar to any Lambert projected data I have, they
>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>> perhaps a different spheroid than expected.
>>>
>>> Does anyone have a link to the original data? Is is possible that this is
>>> the General Oblique Transformation used by modellers - that is something
>>> that feels like longlat but is recentred and oblique? Example at the very
>>> end of my GEOSTAT talk last year (slides 81-83):
>>>
>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>
>>> Roger
>>>
>>>
>> For what it is worth, the General Oblique Transformation is not the only
>> example - it's very common for modellers to have a mesh that has the
>> "mostly-properties" of a projection, but is not actually describable with
>> standard transform + affine parameters. The main cases that I've seen are
>> polar stereographic, equal area or oblique Mercator. Often they really are
>> simple transforms and you can reconstruct without loss, but it's not
>> usually possible to tell without exploration. It's an interesting
>> dis-connect to see code that builds a mesh with certain properties, then
>> only stores longitudes and latitudes - when it could be done with standard
>> tools and be stored and used much more efficiently.
>>
>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>> terminology conflated in this context too. )
>>
>> I'm also interested to explore the original data.
>>
>> Cheers, Mike.
>>
>>
>>
>>>>
>>>> -Alex
>>>>
>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>> Hi
>>>>>
>>>>> I tried to make it work but I had to give up. I wanted to reproject
>> the
>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>
>>>>> Perhaps someone can see what I did wrong. Here is what I did (data in
>> R
>>> binary format and figure in png format both attached):
>>>>>
>>>>> library(raster)
>>>>> library(maptools)
>>>>> data(wrld_simpl)
>>>>>
>>>>> r <- raster("raster.grd")
>>>>> projection(r)
>>>>> ## > NA
>>>>>
>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep = ",")
>>>>> coordinates(uro) <- ~lon+lat
>>>>>
>>>>> ## Set projections for the 3 data sets
>>>>>
>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0
>>> +ellps=WGS84"
>>>>> projection(r)
>>>>>
>>>>> ## Assume that lon, lat are geographical coordinates (degrees decimal)
>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>
>>>>> ## wrld_simpl is in geographical coordinates
>>>>> proj4string(wrld_simpl)
>>>>>
>>>>> ## Make figure in png format
>>>>> ## Of course plotting data with 2 different projections will give
>>>>> ## some distortions
>>>>> pdf("uro.png")
>>>>>
>>>>> plot(r)
>>>>> points(uro)
>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of 'r'
>>>>>
>>>>> dev.off()
>>>>>
>>>>> extent(r)
>>>>> ## class       : Extent
>>>>> ## xmin        : -131.4368
>>>>> ## xmax        : -68.56323
>>>>> ## ymin        : 12.35567
>>>>> ## ymax        : 50.26619
>>>>>
>>>>> ## Reproject the raster to long-lat
>>>>> ## This doesn't work (collapsed domain)
>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>
>>>>> ## Because
>>>>>> extent(rp)
>>>>> ## class       : Extent
>>>>> ## xmin        : -100.0015
>>>>> ## xmax        : -99.68557
>>>>> ## ymin        : 37.70658
>>>>> ## ymax        : 38.00046
>>>>>
>>>>> ## Save data in R binary format
>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>
>>>>>
>>>>> Yours sincerely / Med venlig hilsen
>>>>>
>>>>> Frede Aakmann T?gersen
>>>>> Specialist, M.Sc., Ph.D.
>>>>> Plant Performance & Modeling
>>>>>
>>>>> Technology & Service Solutions
>>>>> T +45 9730 5135
>>>>> M +45 2547 6050
>>>>> frtog at vestas.com
>>>>> http://www.vestas.com
>>>>>
>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>> Please refer to www.vestas.com/legal/notice
>>>>> If you have received this e-mail in error please contact the sender.
>>>>>
>>>>>
>>>>>
>>>>> -----Original Message-----
>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf Of
>>> Agus Camacho
>>>>> Sent: 22. februar 2016 19:20
>>>>> To: tech at wildintellect.com
>>>>> Cc: r-sig-geo
>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>>> reference system implicit in a .nc file
>>>>>
>>>>> Thanks Alex, but the locations still fall in the sea when i plot them
>>> using
>>>>> your recommended Solution. I looked at the sites you proposed and they
>>> have
>>>>> other values for lat_1, lat_0, etc..
>>>>>
>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>
>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>> Dear all,
>>>>>>>
>>>>>>> Im trying to overlap these points:
>>>>>>>
>>>>>>
>>>
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>>>>
>>>>>>> and a wrld_simpl object:
>>>>>>> library(maptools)
>>>>>>> data(wrld_simpl)
>>>>>>>
>>>>>>> Over this raster layer
>>>>>>>
>>>>>>
>>>
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>>>>
>>>>>>> This rastr comes from a .nc file without a reference system. The
>>> author
>>>>>> of
>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>
>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>> CEN_LAT = 38.0
>>>>>>> CEN_LON = -100.0
>>>>>>> TRUELAT1 = 25.
>>>>>>> TRUELAT2 = 45.
>>>>>>>
>>>>>>> However, despite i have gone through many sites in the internet, i
>>> cant
>>>>>>> figure it out:
>>>>>>>
>>>>>>> a) if that is all the data i need to set a reference system for my
>>> points
>>>>>>> and the wrld_simp object.
>>>>>>>
>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>
>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>
>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>> Are there any site that explains easily what the fields in the CRS
>>> mean
>>>>>> and
>>>>>>> how to change them?
>>>>>>>
>>>>>>> Thanks in advance.
>>>>>>>
>>>>>>
>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>
>>>>>> I believe:
>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>
>>>>>> proj strings are defined by the proj4 libary. It's website listed
>> above
>>>>>> and the associated mailing lists or gis stackexchange would be the
>>>>>> places to get help on it.
>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>
>>>>>> It often helps to browse similar projections on
>>>>>> http://spatialreference.org/
>>>>>> http://epsg.io/
>>>>>>
>>>>>> Enjoy,
>>>>>> Alex
>>>>>>
>>>>>>
>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>> --
>>> Roger Bivand
>>> Department of Economics, Norwegian School of Economics,
>>> Helleveien 30, N-5045 Bergen, Norway.
>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> e-mail: Roger.Bivand at nhh.no
>>> http://orcid.org/0000-0003-2392-6140
>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> http://depsy.org/person/434412
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>
>
>

-- 
Roger Bivand
Department of Economics, Norwegian School of Economics,
Helleveien 30, N-5045 Bergen, Norway.
voice: +47 55 95 93 55; fax +47 55 95 91 00
e-mail: Roger.Bivand at nhh.no
http://orcid.org/0000-0003-2392-6140
https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
http://depsy.org/person/434412

From Dominik.Schneider at colorado.edu  Tue Feb 23 20:07:05 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 23 Feb 2016 12:07:05 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
Message-ID: <CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>

This looks like WRF <http://www.wrf-model.org/index.php> data. I just dealt
with this.
The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
+a=6370000 +b=6370000 +units=m

+proj=lcc which is usually what wrf is run with.
The tricky part is:
+lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
because every WRF run is different (the WRF Preprocessing System optimizes
the projection for the domain).
and then there is probably no shift so you need(?) +x_0=0 +y_0=0

This gives:
+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
+a=6370000 +b=6370000 +units=m +no_defs

But, wrf users like to give out lat and  long so you need to assign it:
+proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs

and then reproject the lat/long to lcc coordinates using this string:
+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
+a=6370000 +b=6370000 +units=m +no_defs

One word of caution, make sure you received the correct coordinates. Some
variables are run cell center while some are run at cell edge. It looks
like from your .nc file it was made by your collaborator so I assume they
are right.

That said, another word of caution, I found that the XLAT and XLONG
variables from WRF output aren't very precise. There is a "geogrid" file
from the preprocessing system that has the domain corners, resolution, nrow
and ncol from which you can make a better grid using the native projection
system (in my case it was a 4km grid). I suggest you try to get those.

I hope this helps... I have to run but wanted to save people too much head
scratching. I can get you running with more help tonight if you need.
Dominik


On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
wrote:

> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
> more giant crab this time.
>
> The creator of the .nc file also looked at this webpage:
> http://www.pkrc.net/wrf-lambert.html
> It seemed like the right proj4 string might be this one:
>
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>
> However this projection also does not allow me to adequately plot the
> locations on the raster.
>
> Here is the .nc file. it contains several layers.
>
>
> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>
>
>
> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>
> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
> >
> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
> > >
> > > > I made an attempt at it too. Investigating the original data, I'm not
> > > > sure that the projection information supplied is correct for the data
> > > > linked. When I load up the data in a unprojected space, the
> coordinates
> > > > don't look at all similar to any Lambert projected data I have, they
> > > > actually look like Lat/Lon in some unprojected coordinate system,
> > > > perhaps a different spheroid than expected.
> > >
> > > Does anyone have a link to the original data? Is is possible that this
> is
> > > the General Oblique Transformation used by modellers - that is
> something
> > > that feels like longlat but is recentred and oblique? Example at the
> very
> > > end of my GEOSTAT talk last year (slides 81-83):
> > >
> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
> > >
> > > Roger
> > >
> > >
> > For what it is worth, the General Oblique Transformation is not the only
> > example - it's very common for modellers to have a mesh that has the
> > "mostly-properties" of a projection, but is not actually describable with
> > standard transform + affine parameters. The main cases that I've seen are
> > polar stereographic, equal area or oblique Mercator. Often they really
> are
> > simple transforms and you can reconstruct without loss, but it's not
> > usually possible to tell without exploration. It's an interesting
> > dis-connect to see code that builds a mesh with certain properties, then
> > only stores longitudes and latitudes - when it could be done with
> standard
> > tools and be stored and used much more efficiently.
> >
> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
> > terminology conflated in this context too. )
> >
> > I'm also interested to explore the original data.
> >
> > Cheers, Mike.
> >
> >
> >
> > > >
> > > > -Alex
> > > >
> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
> > > >> Hi
> > > >>
> > > >> I tried to make it work but I had to give up. I wanted to reproject
> > the
> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
> > > >>
> > > >> Perhaps someone can see what I did wrong. Here is what I did (data
> in
> > R
> > > binary format and figure in png format both attached):
> > > >>
> > > >> library(raster)
> > > >> library(maptools)
> > > >> data(wrld_simpl)
> > > >>
> > > >> r <- raster("raster.grd")
> > > >> projection(r)
> > > >> ## > NA
> > > >>
> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
> ",")
> > > >> coordinates(uro) <- ~lon+lat
> > > >>
> > > >> ## Set projections for the 3 data sets
> > > >>
> > > >> ## Lamberth's confocal conic projection with given parameters
> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0 +lat_2=45.0
> > > +ellps=WGS84"
> > > >> projection(r)
> > > >>
> > > >> ## Assume that lon, lat are geographical coordinates (degrees
> decimal)
> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
> > > >>
> > > >> ## wrld_simpl is in geographical coordinates
> > > >> proj4string(wrld_simpl)
> > > >>
> > > >> ## Make figure in png format
> > > >> ## Of course plotting data with 2 different projections will give
> > > >> ## some distortions
> > > >> pdf("uro.png")
> > > >>
> > > >> plot(r)
> > > >> points(uro)
> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
> 'r'
> > > >>
> > > >> dev.off()
> > > >>
> > > >> extent(r)
> > > >> ## class       : Extent
> > > >> ## xmin        : -131.4368
> > > >> ## xmax        : -68.56323
> > > >> ## ymin        : 12.35567
> > > >> ## ymax        : 50.26619
> > > >>
> > > >> ## Reproject the raster to long-lat
> > > >> ## This doesn't work (collapsed domain)
> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
> > > +ellps=WGS84 +towgs84=0,0,0")
> > > >>
> > > >> ## Because
> > > >>> extent(rp)
> > > >> ## class       : Extent
> > > >> ## xmin        : -100.0015
> > > >> ## xmax        : -99.68557
> > > >> ## ymin        : 37.70658
> > > >> ## ymax        : 38.00046
> > > >>
> > > >> ## Save data in R binary format
> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
> > > >>
> > > >>
> > > >> Yours sincerely / Med venlig hilsen
> > > >>
> > > >> Frede Aakmann T?gersen
> > > >> Specialist, M.Sc., Ph.D.
> > > >> Plant Performance & Modeling
> > > >>
> > > >> Technology & Service Solutions
> > > >> T +45 9730 5135
> > > >> M +45 2547 6050
> > > >> frtog at vestas.com
> > > >> http://www.vestas.com
> > > >>
> > > >> Company reg. name: Vestas Wind Systems A/S
> > > >> This e-mail is subject to our e-mail disclaimer statement.
> > > >> Please refer to www.vestas.com/legal/notice
> > > >> If you have received this e-mail in error please contact the sender.
> > > >>
> > > >>
> > > >>
> > > >> -----Original Message-----
> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On Behalf
> Of
> > > Agus Camacho
> > > >> Sent: 22. februar 2016 19:20
> > > >> To: tech at wildintellect.com
> > > >> Cc: r-sig-geo
> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
> > > reference system implicit in a .nc file
> > > >>
> > > >> Thanks Alex, but the locations still fall in the sea when i plot
> them
> > > using
> > > >> your recommended Solution. I looked at the sites you proposed and
> they
> > > have
> > > >> other values for lat_1, lat_0, etc..
> > > >>
> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
> > > >>
> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
> > > >>>> Dear all,
> > > >>>>
> > > >>>> Im trying to overlap these points:
> > > >>>>
> > > >>>
> > >
> >
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> > > >>>>
> > > >>>> and a wrld_simpl object:
> > > >>>> library(maptools)
> > > >>>> data(wrld_simpl)
> > > >>>>
> > > >>>> Over this raster layer
> > > >>>>
> > > >>>
> > >
> >
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> > > >>>>
> > > >>>> This rastr comes from a .nc file without a reference system. The
> > > author
> > > >>> of
> > > >>>> that .nc file gave me the following data about the .nc.
> > > >>>>
> > > >>>> The projection is *Lambert conformal conic* projection
> > > >>>> CEN_LAT = 38.0
> > > >>>> CEN_LON = -100.0
> > > >>>> TRUELAT1 = 25.
> > > >>>> TRUELAT2 = 45.
> > > >>>>
> > > >>>> However, despite i have gone through many sites in the internet, i
> > > cant
> > > >>>> figure it out:
> > > >>>>
> > > >>>> a) if that is all the data i need to set a reference system for my
> > > points
> > > >>>> and the wrld_simp object.
> > > >>>>
> > > >>>> b) how to change a typical CRS object with such data
> > > >>>>
> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> > > >>>>
> > > >>>> Where do i enter the TRUELAT and CENLAT values?
> > > >>>> Are there any site that explains easily what the fields in the CRS
> > > mean
> > > >>> and
> > > >>>> how to change them?
> > > >>>>
> > > >>>> Thanks in advance.
> > > >>>>
> > > >>>
> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
> > > >>>
> > > >>> I believe:
> > > >>> +lat_0  = CEN_LAT   Latitude of origin
> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
> > > >>> +lon_0  = CEN_LON   Central meridian
> > > >>>
> > > >>> proj strings are defined by the proj4 libary. It's website listed
> > above
> > > >>> and the associated mailing lists or gis stackexchange would be the
> > > >>> places to get help on it.
> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
> > > >>>
> > > >>> It often helps to browse similar projections on
> > > >>> http://spatialreference.org/
> > > >>> http://epsg.io/
> > > >>>
> > > >>> Enjoy,
> > > >>> Alex
> > > >>>
> > > >>>
> > > >>
> > > >>
> > > >
> > > > _______________________________________________
> > > > R-sig-Geo mailing list
> > > > R-sig-Geo at r-project.org
> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> > >
> > > --
> > > Roger Bivand
> > > Department of Economics, Norwegian School of Economics,
> > > Helleveien 30, N-5045 Bergen, Norway.
> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
> > > e-mail: Roger.Bivand at nhh.no
> > > http://orcid.org/0000-0003-2392-6140
> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> > > http://depsy.org/person/434412
> > > _______________________________________________
> > > R-sig-Geo mailing list
> > > R-sig-Geo at r-project.org
> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> > --
> > Dr. Michael Sumner
> > Software and Database Engineer
> > Australian Antarctic Division
> > 203 Channel Highway
> > Kingston Tasmania 7050 Australia
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
>
>
>
> --
> Agust?n Camacho Guerrero.
> Doutor em Zoologia.
> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> Bioci?ncias, USP.
> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> S?o Paulo - SP, CEP: 05508-090, Brasil.
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Tue Feb 23 21:11:01 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 13:11:01 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
Message-ID: <CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>

Thanks for that Dominik,

Giving that projection to either the locations, the raster layer generated
from the .nc file, or both, still did not work. I keep having locations
that should be on land falling far on the sea. Might this be a problem
derived from using raster with a file whose original grid distances are not
constant?

Here is a link with the original file which has the original coordinate
data.

https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0


2016-02-23 12:07 GMT-07:00 Dominik Schneider <Dominik.Schneider at colorado.edu
>:

> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
> dealt with this.
> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
> +a=6370000 +b=6370000 +units=m
>
> +proj=lcc which is usually what wrf is run with.
> The tricky part is:
> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> because every WRF run is different (the WRF Preprocessing System optimizes
> the projection for the domain).
> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>
> This gives:
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
> +a=6370000 +b=6370000 +units=m +no_defs
>
> But, wrf users like to give out lat and  long so you need to assign it:
> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>
> and then reproject the lat/long to lcc coordinates using this string:
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
> +a=6370000 +b=6370000 +units=m +no_defs
>
> One word of caution, make sure you received the correct coordinates. Some
> variables are run cell center while some are run at cell edge. It looks
> like from your .nc file it was made by your collaborator so I assume they
> are right.
>
> That said, another word of caution, I found that the XLAT and XLONG
> variables from WRF output aren't very precise. There is a "geogrid" file
> from the preprocessing system that has the domain corners, resolution, nrow
> and ncol from which you can make a better grid using the native projection
> system (in my case it was a 4km grid). I suggest you try to get those.
>
> I hope this helps... I have to run but wanted to save people too much head
> scratching. I can get you running with more help tonight if you need.
> Dominik
>
>
> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
> wrote:
>
>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>> more giant crab this time.
>>
>> The creator of the .nc file also looked at this webpage:
>> http://www.pkrc.net/wrf-lambert.html
>> It seemed like the right proj4 string might be this one:
>>
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>
>> However this projection also does not allow me to adequately plot the
>> locations on the raster.
>>
>> Here is the .nc file. it contains several layers.
>>
>>
>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>
>>
>>
>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>
>> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> >
>> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
>> > >
>> > > > I made an attempt at it too. Investigating the original data, I'm
>> not
>> > > > sure that the projection information supplied is correct for the
>> data
>> > > > linked. When I load up the data in a unprojected space, the
>> coordinates
>> > > > don't look at all similar to any Lambert projected data I have, they
>> > > > actually look like Lat/Lon in some unprojected coordinate system,
>> > > > perhaps a different spheroid than expected.
>> > >
>> > > Does anyone have a link to the original data? Is is possible that
>> this is
>> > > the General Oblique Transformation used by modellers - that is
>> something
>> > > that feels like longlat but is recentred and oblique? Example at the
>> very
>> > > end of my GEOSTAT talk last year (slides 81-83):
>> > >
>> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
>> > >
>> > > Roger
>> > >
>> > >
>> > For what it is worth, the General Oblique Transformation is not the only
>> > example - it's very common for modellers to have a mesh that has the
>> > "mostly-properties" of a projection, but is not actually describable
>> with
>> > standard transform + affine parameters. The main cases that I've seen
>> are
>> > polar stereographic, equal area or oblique Mercator. Often they really
>> are
>> > simple transforms and you can reconstruct without loss, but it's not
>> > usually possible to tell without exploration. It's an interesting
>> > dis-connect to see code that builds a mesh with certain properties, then
>> > only stores longitudes and latitudes - when it could be done with
>> standard
>> > tools and be stored and used much more efficiently.
>> >
>> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>> > terminology conflated in this context too. )
>> >
>> > I'm also interested to explore the original data.
>> >
>> > Cheers, Mike.
>> >
>> >
>> >
>> > > >
>> > > > -Alex
>> > > >
>> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>> > > >> Hi
>> > > >>
>> > > >> I tried to make it work but I had to give up. I wanted to reproject
>> > the
>> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
>> > > >>
>> > > >> Perhaps someone can see what I did wrong. Here is what I did (data
>> in
>> > R
>> > > binary format and figure in png format both attached):
>> > > >>
>> > > >> library(raster)
>> > > >> library(maptools)
>> > > >> data(wrld_simpl)
>> > > >>
>> > > >> r <- raster("raster.grd")
>> > > >> projection(r)
>> > > >> ## > NA
>> > > >>
>> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>> ",")
>> > > >> coordinates(uro) <- ~lon+lat
>> > > >>
>> > > >> ## Set projections for the 3 data sets
>> > > >>
>> > > >> ## Lamberth's confocal conic projection with given parameters
>> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>> +lat_2=45.0
>> > > +ellps=WGS84"
>> > > >> projection(r)
>> > > >>
>> > > >> ## Assume that lon, lat are geographical coordinates (degrees
>> decimal)
>> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>> > > >>
>> > > >> ## wrld_simpl is in geographical coordinates
>> > > >> proj4string(wrld_simpl)
>> > > >>
>> > > >> ## Make figure in png format
>> > > >> ## Of course plotting data with 2 different projections will give
>> > > >> ## some distortions
>> > > >> pdf("uro.png")
>> > > >>
>> > > >> plot(r)
>> > > >> points(uro)
>> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>> 'r'
>> > > >>
>> > > >> dev.off()
>> > > >>
>> > > >> extent(r)
>> > > >> ## class       : Extent
>> > > >> ## xmin        : -131.4368
>> > > >> ## xmax        : -68.56323
>> > > >> ## ymin        : 12.35567
>> > > >> ## ymax        : 50.26619
>> > > >>
>> > > >> ## Reproject the raster to long-lat
>> > > >> ## This doesn't work (collapsed domain)
>> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>> > > +ellps=WGS84 +towgs84=0,0,0")
>> > > >>
>> > > >> ## Because
>> > > >>> extent(rp)
>> > > >> ## class       : Extent
>> > > >> ## xmin        : -100.0015
>> > > >> ## xmax        : -99.68557
>> > > >> ## ymin        : 37.70658
>> > > >> ## ymax        : 38.00046
>> > > >>
>> > > >> ## Save data in R binary format
>> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>> > > >>
>> > > >>
>> > > >> Yours sincerely / Med venlig hilsen
>> > > >>
>> > > >> Frede Aakmann T?gersen
>> > > >> Specialist, M.Sc., Ph.D.
>> > > >> Plant Performance & Modeling
>> > > >>
>> > > >> Technology & Service Solutions
>> > > >> T +45 9730 5135
>> > > >> M +45 2547 6050
>> > > >> frtog at vestas.com
>> > > >> http://www.vestas.com
>> > > >>
>> > > >> Company reg. name: Vestas Wind Systems A/S
>> > > >> This e-mail is subject to our e-mail disclaimer statement.
>> > > >> Please refer to www.vestas.com/legal/notice
>> > > >> If you have received this e-mail in error please contact the
>> sender.
>> > > >>
>> > > >>
>> > > >>
>> > > >> -----Original Message-----
>> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>> Behalf Of
>> > > Agus Camacho
>> > > >> Sent: 22. februar 2016 19:20
>> > > >> To: tech at wildintellect.com
>> > > >> Cc: r-sig-geo
>> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>> > > reference system implicit in a .nc file
>> > > >>
>> > > >> Thanks Alex, but the locations still fall in the sea when i plot
>> them
>> > > using
>> > > >> your recommended Solution. I looked at the sites you proposed and
>> they
>> > > have
>> > > >> other values for lat_1, lat_0, etc..
>> > > >>
>> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>> > > >>
>> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>> > > >>>> Dear all,
>> > > >>>>
>> > > >>>> Im trying to overlap these points:
>> > > >>>>
>> > > >>>
>> > >
>> >
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>> > > >>>>
>> > > >>>> and a wrld_simpl object:
>> > > >>>> library(maptools)
>> > > >>>> data(wrld_simpl)
>> > > >>>>
>> > > >>>> Over this raster layer
>> > > >>>>
>> > > >>>
>> > >
>> >
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>> > > >>>>
>> > > >>>> This rastr comes from a .nc file without a reference system. The
>> > > author
>> > > >>> of
>> > > >>>> that .nc file gave me the following data about the .nc.
>> > > >>>>
>> > > >>>> The projection is *Lambert conformal conic* projection
>> > > >>>> CEN_LAT = 38.0
>> > > >>>> CEN_LON = -100.0
>> > > >>>> TRUELAT1 = 25.
>> > > >>>> TRUELAT2 = 45.
>> > > >>>>
>> > > >>>> However, despite i have gone through many sites in the internet,
>> i
>> > > cant
>> > > >>>> figure it out:
>> > > >>>>
>> > > >>>> a) if that is all the data i need to set a reference system for
>> my
>> > > points
>> > > >>>> and the wrld_simp object.
>> > > >>>>
>> > > >>>> b) how to change a typical CRS object with such data
>> > > >>>>
>> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>> > > >>>>
>> > > >>>> Where do i enter the TRUELAT and CENLAT values?
>> > > >>>> Are there any site that explains easily what the fields in the
>> CRS
>> > > mean
>> > > >>> and
>> > > >>>> how to change them?
>> > > >>>>
>> > > >>>> Thanks in advance.
>> > > >>>>
>> > > >>>
>> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
>> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
>> > > >>>
>> > > >>> I believe:
>> > > >>> +lat_0  = CEN_LAT   Latitude of origin
>> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>> > > >>> +lon_0  = CEN_LON   Central meridian
>> > > >>>
>> > > >>> proj strings are defined by the proj4 libary. It's website listed
>> > above
>> > > >>> and the associated mailing lists or gis stackexchange would be the
>> > > >>> places to get help on it.
>> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
>> > > >>>
>> > > >>> It often helps to browse similar projections on
>> > > >>> http://spatialreference.org/
>> > > >>> http://epsg.io/
>> > > >>>
>> > > >>> Enjoy,
>> > > >>> Alex
>> > > >>>
>> > > >>>
>> > > >>
>> > > >>
>> > > >
>> > > > _______________________________________________
>> > > > R-sig-Geo mailing list
>> > > > R-sig-Geo at r-project.org
>> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >
>> > > --
>> > > Roger Bivand
>> > > Department of Economics, Norwegian School of Economics,
>> > > Helleveien 30, N-5045 Bergen, Norway.
>> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
>> > > e-mail: Roger.Bivand at nhh.no
>> > > http://orcid.org/0000-0003-2392-6140
>> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> > > http://depsy.org/person/434412
>> > > _______________________________________________
>> > > R-sig-Geo mailing list
>> > > R-sig-Geo at r-project.org
>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> > --
>> > Dr. Michael Sumner
>> > Software and Database Engineer
>> > Australian Antarctic Division
>> > 203 Channel Highway
>> > Kingston Tasmania 7050 Australia
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>
>>
>> --
>> Agust?n Camacho Guerrero.
>> Doutor em Zoologia.
>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>> Bioci?ncias, USP.
>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
>


-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From sohrab.abbasnejad at yahoo.com  Tue Feb 23 21:14:21 2016
From: sohrab.abbasnejad at yahoo.com (Sohrab Abbasnejad)
Date: Tue, 23 Feb 2016 20:14:21 +0000 (UTC)
Subject: [R-sig-Geo] Population-weighted Centroids of Polygons in R
In-Reply-To: <56CA3DCC.9080307@wur.nl>
References: <56CA3DCC.9080307@wur.nl>
Message-ID: <1656941122.8938477.1456258461337.JavaMail.yahoo@mail.yahoo.com>

Hi?Lo?c,

Thank you so much for your reply. I went through the approach that you have already proposed. I believe it's a great idea.?
I'd like to emphasize that the coordinates of the centroid of each block is available. The idea is how to relate these centroids to the corresponding population of the blocks (which are all inside a larger polygon, of course) and to find a global centroid for the large polygon which could reflect the effect of the population density in the blocks.
I also wonder if I can find way to compute the "weighted average" using a kind of distance function.

In this regard, any suggestions would be welcome.
Thanks for your time.

Sincerely,Sohrab 

    On Sunday, February 21, 2016 11:45 PM, Lo?c Dutrieux <loic.dutrieux at wur.nl> wrote:
 

 Hi Sohrab,

I don't think there is a method for weighted centroids specifically.
What if you get the centroid coordinates of each "block" using 
gCentroid() and calculate a weighted average of the coordinates of every 
centroid?
See an example below assuming your blocks are a 
SpatialPolygonsDataFrame. It's quite a simple approach; not sure how 
valid it would be with more complex features though (eg: with holes, etc)...

Cheers,
Lo?c

library(rgeos)
library(sp)

# Generate SpatialPolygonsDataFrame object (blocks with population data)
cds1 <- rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
cds2 <- rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
sp <- spPolygons(cds1, cds2)
spdf <- SpatialPolygonsDataFrame(sp, data.frame(pop = c(25,32)))

# Get centroid of every polygon
centroids <- gCentroid(spdf, byid = TRUE)

# Get a dataframe with coordinates of centroids and weights
df <- cbind(data.frame(centroids), spdf at data)

# SpatialPoints corresponding to Weighted centroid
SpatialPoints(data.frame(x = weighted.mean(df$x, df$pop), y = 
weighted.mean(df$y, df$pop)))

On 02/21/2016 09:10 PM, Sohrab Abbasnejad via R-sig-Geo wrote:
> Dear all,
> I have a set of spatial polygons and several blocks of population (with fixed area but a different number of people in each). I have used the "over" method from "sp" package to identify the blocks which are located inside these polygons.
> Now, utilizing R, I wish to assign to each of these polygons a centroid in terms of the population using some kind of distance (Euclidean/shortest path, etc.). In fact, I am looking for the exact coordinates of a population-weighted centroid for each of my polygons.
> Any ideas would be welcome. I truly appreciate your time.
> Sincerely,Sohrab
> ??? [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at r-project.org
https://stat.ethz.ch/mailman/listinfo/r-sig-geo

  
	[[alternative HTML version deleted]]


From Jose.M.Pavia at uv.es  Tue Feb 23 21:47:53 2016
From: Jose.M.Pavia at uv.es (Jose M. Pavia)
Date: Tue, 23 Feb 2016 21:47:53 +0100 (CET)
Subject: [R-sig-Geo] Population-weighted Centroids of Polygons in R
In-Reply-To: <1656941122.8938477.1456258461337.JavaMail.yahoo@mail.yahoo.com>
References: <1656941122.8938477.1456258461337.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <6643863179pavia@uv.es>

If I understand your problem. You can compute a global centroid for the large polygon directly as a weighted average.

If Pi is the population of block i
and (xi, yi) are the coordinates of the centroid of block i.

the weighted average centroid of the polygon will be:

x_w = sum(xi*Pi)/sum(Pi)
y_w = sum(yi*Pi)/sum(Pi)

where the sum is over all the blocks in the corresponding polygon.

best regards
jm

> Hi?Lo?c,
> 
> Thank you so much for your reply. I went through the approach that you have already proposed. I believe it's a great idea.?
> I'd like to emphasize that the coordinates of the centroid of each block is available. The idea is how to relate these centroids to the corresponding population of the blocks (which are all inside a larger polygon, of course) and to find a global centroid for the large polygon which could reflect the effect of the population density in the blocks.
> I also wonder if I can find way to compute the "weighted average" using a kind of distance function.
> 
> In this regard, any suggestions would be welcome.
> Thanks for your time.
> 
> Sincerely,Sohrab 
> 
>     On Sunday, February 21, 2016 11:45 PM, Lo?c Dutrieux <loic.dutrieux at wur.nl> wrote:
>  
> 
>  Hi Sohrab,
> 
> I don't think there is a method for weighted centroids specifically.
> What if you get the centroid coordinates of each "block" using 
> gCentroid() and calculate a weighted average of the coordinates of every 
> centroid?
> See an example below assuming your blocks are a 
> SpatialPolygonsDataFrame. It's quite a simple approach; not sure how 
> valid it would be with more complex features though (eg: with holes, etc)..
> 
> Cheers,
> Lo?c
> 
> library(rgeos)
> library(sp)
> 
> # Generate SpatialPolygonsDataFrame object (blocks with population data)
> cds1 <- rbind(c(-180,-20), c(-160,5), c(-60, 0), c(-160,-60), c(-180,-20))
> cds2 <- rbind(c(80,0), c(100,60), c(120,0), c(120,-55), c(80,0))
> sp <- spPolygons(cds1, cds2)
> spdf <- SpatialPolygonsDataFrame(sp, data.frame(pop = c(25,32)))
> 
> # Get centroid of every polygon
> centroids <- gCentroid(spdf, byid = TRUE)
> 
> # Get a dataframe with coordinates of centroids and weights
> df <- cbind(data.frame(centroids), spdf at data)
> 
> # SpatialPoints corresponding to Weighted centroid
> SpatialPoints(data.frame(x = weighted.mean(df$x, df$pop), y = 
> weighted.mean(df$y, df$pop)))
> 
> On 02/21/2016 09:10 PM, Sohrab Abbasnejad via R-sig-Geo wrote:
> > Dear all,
> > I have a set of spatial polygons and several blocks of population (with fixed area but a different number of people in each). I have used the "over" method from "sp" package to identify the blocks which are located inside these polygons.
> > Now, utilizing R, I wish to assign to each of these polygons a centroid in terms of the population using some kind of distance (Euclidean/shortest path, etc.). In fact, I am looking for the exact coordinates of a population-weighted centroid for each of my polygons.
> > Any ideas would be welcome. I truly appreciate your time.
> > Sincerely,Sohrab
> > ??? [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
>   
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


--
Jose M. Pavia
Quantitative Methods' Professor
Universitat de Valencia
Av Tarongers, s/n
46022 Valencia, Spain
Phone: +34 963 828 404
Fax: +34 963 828 415
e-mail: pavia at uv.es
http://www.epo-uv.es/

The combination of some data and an aching desire for
an answer does not ensure that a reasonable answer can
be extracted from a given body of data.~ John Tukey


CONFIDENTIALITY CLAUSE
This message has been sent from a Universitat de Valencia
email account for the institution?s own purposes. Its content
and any files transmitted with it are intended solely for
the use of the individual or entity to whom they are addressed
and are considered confidential, except where justified by their
specific nature. If you are not the named addressee, you should
not disseminate, distribute or copy this email without consent.
If you received this email in error, please notify the sender
immediately and delete this email from your system. Please
check out terms of use and privacy policies regarding
the sending of emails (http://links.uv.es/BBz6HG5,
http://links.uv.es/GAk63v0 ) at the Universitat de Valencia
institutional website. Any incident arising from the
reception of our e-mails and, specifically from security and
confidentiality issues, can be communicated to lopd at uv.es.


From reudenbach at uni-marburg.de  Tue Feb 23 22:22:31 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Tue, 23 Feb 2016 22:22:31 +0100
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
Message-ID: <56CCCD97.5040901@uni-marburg.de>

Augustin

just quick and dirty if you run gdalinfo("geo_em.d01.nc") your are 
getting the information about the corner coordinates the subdatasets and 
so on. Together with Dominiks suggestion you can do something like this:

library(gdalUtils)
library(raster)
Sys.setenv(GDAL_NETCDF_BOTTOMUP="YES")
wrffake<- "+proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m 
+no_defs"
x<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
                   of="GTiff",
                   ot="Byte",
                   output_Raster=TRUE,
                   verbose=TRUE)
wrfExt<-extent(-151.29639,-48.703613,12.355667,50.26619)
extent(x) <- extent(wrfExt)
projection(x) <- wrffake
plot(x)

Some remarks:
(1) I just took the first pair of  coordinates as derived from 
gdalinfo("geo_em.d01.nc")
you will find 4 different coordinate pairs (i did not proof which one is 
right

The data is staggered (as outlined by Dominik) So some of the corner 
coordinates belongs to the staggered data and the others coordinates  to 
the unstaggered ones. You will find them marked

If you have installed the netcdf libs you easily can use ncview 
geo_em.d01.nc or ncdump -h geo_em.d01.nc to view the data or get more 
information of the header.

Hope this helps

cheers Chris



Am 23.02.2016 um 21:11 schrieb Agus Camacho:
> Thanks for that Dominik,
>
> Giving that projection to either the locations, the raster layer generated
> from the .nc file, or both, still did not work. I keep having locations
> that should be on land falling far on the sea. Might this be a problem
> derived from using raster with a file whose original grid distances are not
> constant?
>
> Here is a link with the original file which has the original coordinate
> data.
>
> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>
>
> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <Dominik.Schneider at colorado.edu
>> :
>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>> dealt with this.
>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>> +a=6370000 +b=6370000 +units=m
>>
>> +proj=lcc which is usually what wrf is run with.
>> The tricky part is:
>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> because every WRF run is different (the WRF Preprocessing System optimizes
>> the projection for the domain).
>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>
>> This gives:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
>> +a=6370000 +b=6370000 +units=m +no_defs
>>
>> But, wrf users like to give out lat and  long so you need to assign it:
>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> and then reproject the lat/long to lcc coordinates using this string:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
>> +a=6370000 +b=6370000 +units=m +no_defs
>>
>> One word of caution, make sure you received the correct coordinates. Some
>> variables are run cell center while some are run at cell edge. It looks
>> like from your .nc file it was made by your collaborator so I assume they
>> are right.
>>
>> That said, another word of caution, I found that the XLAT and XLONG
>> variables from WRF output aren't very precise. There is a "geogrid" file
>> from the preprocessing system that has the domain corners, resolution, nrow
>> and ncol from which you can make a better grid using the native projection
>> system (in my case it was a 4km grid). I suggest you try to get those.
>>
>> I hope this helps... I have to run but wanted to save people too much head
>> scratching. I can get you running with more help tonight if you need.
>> Dominik
>>
>>
>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>> wrote:
>>
>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>>> more giant crab this time.
>>>
>>> The creator of the .nc file also looked at this webpage:
>>> http://www.pkrc.net/wrf-lambert.html
>>> It seemed like the right proj4 string might be this one:
>>>
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>
>>> However this projection also does not allow me to adequately plot the
>>> locations on the raster.
>>>
>>> Here is the .nc file. it contains several layers.
>>>
>>>
>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>
>>>
>>>
>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>
>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>
>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>>>
>>>>>> I made an attempt at it too. Investigating the original data, I'm
>>> not
>>>>>> sure that the projection information supplied is correct for the
>>> data
>>>>>> linked. When I load up the data in a unprojected space, the
>>> coordinates
>>>>>> don't look at all similar to any Lambert projected data I have, they
>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>>>> perhaps a different spheroid than expected.
>>>>> Does anyone have a link to the original data? Is is possible that
>>> this is
>>>>> the General Oblique Transformation used by modellers - that is
>>> something
>>>>> that feels like longlat but is recentred and oblique? Example at the
>>> very
>>>>> end of my GEOSTAT talk last year (slides 81-83):
>>>>>
>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>>>
>>>>> Roger
>>>>>
>>>>>
>>>> For what it is worth, the General Oblique Transformation is not the only
>>>> example - it's very common for modellers to have a mesh that has the
>>>> "mostly-properties" of a projection, but is not actually describable
>>> with
>>>> standard transform + affine parameters. The main cases that I've seen
>>> are
>>>> polar stereographic, equal area or oblique Mercator. Often they really
>>> are
>>>> simple transforms and you can reconstruct without loss, but it's not
>>>> usually possible to tell without exploration. It's an interesting
>>>> dis-connect to see code that builds a mesh with certain properties, then
>>>> only stores longitudes and latitudes - when it could be done with
>>> standard
>>>> tools and be stored and used much more efficiently.
>>>>
>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>> terminology conflated in this context too. )
>>>>
>>>> I'm also interested to explore the original data.
>>>>
>>>> Cheers, Mike.
>>>>
>>>>
>>>>
>>>>>> -Alex
>>>>>>
>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>>>> Hi
>>>>>>>
>>>>>>> I tried to make it work but I had to give up. I wanted to reproject
>>>> the
>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>>> Perhaps someone can see what I did wrong. Here is what I did (data
>>> in
>>>> R
>>>>> binary format and figure in png format both attached):
>>>>>>> library(raster)
>>>>>>> library(maptools)
>>>>>>> data(wrld_simpl)
>>>>>>>
>>>>>>> r <- raster("raster.grd")
>>>>>>> projection(r)
>>>>>>> ## > NA
>>>>>>>
>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>> ",")
>>>>>>> coordinates(uro) <- ~lon+lat
>>>>>>>
>>>>>>> ## Set projections for the 3 data sets
>>>>>>>
>>>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>> +lat_2=45.0
>>>>> +ellps=WGS84"
>>>>>>> projection(r)
>>>>>>>
>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>>> decimal)
>>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>>>
>>>>>>> ## wrld_simpl is in geographical coordinates
>>>>>>> proj4string(wrld_simpl)
>>>>>>>
>>>>>>> ## Make figure in png format
>>>>>>> ## Of course plotting data with 2 different projections will give
>>>>>>> ## some distortions
>>>>>>> pdf("uro.png")
>>>>>>>
>>>>>>> plot(r)
>>>>>>> points(uro)
>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>> 'r'
>>>>>>> dev.off()
>>>>>>>
>>>>>>> extent(r)
>>>>>>> ## class       : Extent
>>>>>>> ## xmin        : -131.4368
>>>>>>> ## xmax        : -68.56323
>>>>>>> ## ymin        : 12.35567
>>>>>>> ## ymax        : 50.26619
>>>>>>>
>>>>>>> ## Reproject the raster to long-lat
>>>>>>> ## This doesn't work (collapsed domain)
>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>>> ## Because
>>>>>>>> extent(rp)
>>>>>>> ## class       : Extent
>>>>>>> ## xmin        : -100.0015
>>>>>>> ## xmax        : -99.68557
>>>>>>> ## ymin        : 37.70658
>>>>>>> ## ymax        : 38.00046
>>>>>>>
>>>>>>> ## Save data in R binary format
>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>>>
>>>>>>>
>>>>>>> Yours sincerely / Med venlig hilsen
>>>>>>>
>>>>>>> Frede Aakmann T?gersen
>>>>>>> Specialist, M.Sc., Ph.D.
>>>>>>> Plant Performance & Modeling
>>>>>>>
>>>>>>> Technology & Service Solutions
>>>>>>> T +45 9730 5135
>>>>>>> M +45 2547 6050
>>>>>>> frtog at vestas.com
>>>>>>> http://www.vestas.com
>>>>>>>
>>>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>>>> Please refer to www.vestas.com/legal/notice
>>>>>>> If you have received this e-mail in error please contact the
>>> sender.
>>>>>>>
>>>>>>>
>>>>>>> -----Original Message-----
>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>> Behalf Of
>>>>> Agus Camacho
>>>>>>> Sent: 22. februar 2016 19:20
>>>>>>> To: tech at wildintellect.com
>>>>>>> Cc: r-sig-geo
>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>>>>> reference system implicit in a .nc file
>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>>> them
>>>>> using
>>>>>>> your recommended Solution. I looked at the sites you proposed and
>>> they
>>>>> have
>>>>>>> other values for lat_1, lat_0, etc..
>>>>>>>
>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>>>
>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>>>> Dear all,
>>>>>>>>>
>>>>>>>>> Im trying to overlap these points:
>>>>>>>>>
>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>>>>>> and a wrld_simpl object:
>>>>>>>>> library(maptools)
>>>>>>>>> data(wrld_simpl)
>>>>>>>>>
>>>>>>>>> Over this raster layer
>>>>>>>>>
>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>>>>>> This rastr comes from a .nc file without a reference system. The
>>>>> author
>>>>>>>> of
>>>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>>>
>>>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>>>> CEN_LAT = 38.0
>>>>>>>>> CEN_LON = -100.0
>>>>>>>>> TRUELAT1 = 25.
>>>>>>>>> TRUELAT2 = 45.
>>>>>>>>>
>>>>>>>>> However, despite i have gone through many sites in the internet,
>>> i
>>>>> cant
>>>>>>>>> figure it out:
>>>>>>>>>
>>>>>>>>> a) if that is all the data i need to set a reference system for
>>> my
>>>>> points
>>>>>>>>> and the wrld_simp object.
>>>>>>>>>
>>>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>>>
>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>>>
>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>>>> Are there any site that explains easily what the fields in the
>>> CRS
>>>>> mean
>>>>>>>> and
>>>>>>>>> how to change them?
>>>>>>>>>
>>>>>>>>> Thanks in advance.
>>>>>>>>>
>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>>>
>>>>>>>> I believe:
>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>>>
>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
>>>> above
>>>>>>>> and the associated mailing lists or gis stackexchange would be the
>>>>>>>> places to get help on it.
>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>>>
>>>>>>>> It often helps to browse similar projections on
>>>>>>>> http://spatialreference.org/
>>>>>>>> http://epsg.io/
>>>>>>>>
>>>>>>>> Enjoy,
>>>>>>>> Alex
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> --
>>>>> Roger Bivand
>>>>> Department of Economics, Norwegian School of Economics,
>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>> e-mail: Roger.Bivand at nhh.no
>>>>> http://orcid.org/0000-0003-2392-6140
>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>> http://depsy.org/person/434412
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> --
>>>> Dr. Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> 203 Channel Highway
>>>> Kingston Tasmania 7050 Australia
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>> --
>>> Agust?n Camacho Guerrero.
>>> Doutor em Zoologia.
>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>> Bioci?ncias, USP.
>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>
>>>          [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>


From agus.camacho at gmail.com  Tue Feb 23 23:32:54 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 15:32:54 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CCCD97.5040901@uni-marburg.de>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<56CCCD97.5040901@uni-marburg.de>
Message-ID: <CALsJ7pR5CDridxW+kDwwnaf2S0q=oAqqyi_mwChTDNhw1MyQ3g@mail.gmail.com>

Thanks Chris, but:

> gdalinfo("geo_em.d01.nc")
NULL

In addition:

x<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
                  of="GTiff",
                  ot="Byte",
                  output_Raster=TRUE,
                  verbose=TRUE)
> x
NULL

Also, when i try to install the netcdf lib:

> install.packages("netcdf")
Installing package into ?C:/Users/Agus/Documents/R/win-library/3.2?
(as ?lib? is unspecified)
Warning in install.packages :
  package ?netcdf? is not available (for R version 3.2.3)


It seems to me that it might be necessary to know the original projection
of the locations, in order to reproject them to the projection of the .nc
file, right? or then, reproject the raster to the same projection of
wrld_simpl?

Also, when i try to reproject wrld_simpl to the proj specified by Dominik,
i have this error;

require(sp)
wrld_transf <- spTransform(wrld_simpl, CRS("+proj=lcc +lat_1=25.0
+lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere +a=6370000 +b=6370000
+units=m +no_defs"))
non finite transformation detected:
     [,1] [,2] [,3] [,4]
Error in .spTransform_Polygon(input[[i]], to_args = to_args, from_args =
from_args,  :
  failure in Polygons 145 Polygon 1 points




2016-02-23 14:22 GMT-07:00 Chris Reudenbach <reudenbach at uni-marburg.de>:

> Augustin
>
> just quick and dirty if you run gdalinfo("geo_em.d01.nc") your are
> getting the information about the corner coordinates the subdatasets and so
> on. Together with Dominiks suggestion you can do something like this:
>
> library(gdalUtils)
> library(raster)
> Sys.setenv(GDAL_NETCDF_BOTTOMUP="YES")
> wrffake<- "+proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m
> +no_defs"
> x<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
>                   of="GTiff",
>                   ot="Byte",
>                   output_Raster=TRUE,
>                   verbose=TRUE)
> wrfExt<-extent(-151.29639,-48.703613,12.355667,50.26619)
> extent(x) <- extent(wrfExt)
> projection(x) <- wrffake
> plot(x)
>
> Some remarks:
> (1) I just took the first pair of  coordinates as derived from gdalinfo("
> geo_em.d01.nc")
> you will find 4 different coordinate pairs (i did not proof which one is
> right
>
> The data is staggered (as outlined by Dominik) So some of the corner
> coordinates belongs to the staggered data and the others coordinates  to
> the unstaggered ones. You will find them marked
>
> If you have installed the netcdf libs you easily can use ncview
> geo_em.d01.nc or ncdump -h geo_em.d01.nc to view the data or get more
> information of the header.
>
> Hope this helps
>
> cheers Chris
>
>
>
> Am 23.02.2016 um 21:11 schrieb Agus Camacho:
>
>> Thanks for that Dominik,
>>
>> Giving that projection to either the locations, the raster layer generated
>> from the .nc file, or both, still did not work. I keep having locations
>> that should be on land falling far on the sea. Might this be a problem
>> derived from using raster with a file whose original grid distances are
>> not
>> constant?
>>
>> Here is a link with the original file which has the original coordinate
>> data.
>>
>> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>>
>>
>> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
>> Dominik.Schneider at colorado.edu
>>
>>> :
>>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>>>
>>> dealt with this.
>>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m
>>>
>>> +proj=lcc which is usually what wrf is run with.
>>> The tricky part is:
>>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> because every WRF run is different (the WRF Preprocessing System
>>> optimizes
>>> the projection for the domain).
>>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>>
>>> This gives:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> But, wrf users like to give out lat and  long so you need to assign it:
>>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> and then reproject the lat/long to lcc coordinates using this string:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> One word of caution, make sure you received the correct coordinates. Some
>>> variables are run cell center while some are run at cell edge. It looks
>>> like from your .nc file it was made by your collaborator so I assume they
>>> are right.
>>>
>>> That said, another word of caution, I found that the XLAT and XLONG
>>> variables from WRF output aren't very precise. There is a "geogrid" file
>>> from the preprocessing system that has the domain corners, resolution,
>>> nrow
>>> and ncol from which you can make a better grid using the native
>>> projection
>>> system (in my case it was a 4km grid). I suggest you try to get those.
>>>
>>> I hope this helps... I have to run but wanted to save people too much
>>> head
>>> scratching. I can get you running with more help tonight if you need.
>>> Dominik
>>>
>>>
>>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>>> wrote:
>>>
>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>>>> more giant crab this time.
>>>>
>>>> The creator of the .nc file also looked at this webpage:
>>>> http://www.pkrc.net/wrf-lambert.html
>>>> It seemed like the right proj4 string might be this one:
>>>>
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>>
>>>> However this projection also does not allow me to adequately plot the
>>>> locations on the raster.
>>>>
>>>> Here is the .nc file. it contains several layers.
>>>>
>>>>
>>>>
>>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>>
>>>>
>>>>
>>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>>
>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>>
>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>>>>
>>>>>> I made an attempt at it too. Investigating the original data, I'm
>>>>>>>
>>>>>> not
>>>>
>>>>> sure that the projection information supplied is correct for the
>>>>>>>
>>>>>> data
>>>>
>>>>> linked. When I load up the data in a unprojected space, the
>>>>>>>
>>>>>> coordinates
>>>>
>>>>> don't look at all similar to any Lambert projected data I have, they
>>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>>>>> perhaps a different spheroid than expected.
>>>>>>>
>>>>>> Does anyone have a link to the original data? Is is possible that
>>>>>>
>>>>> this is
>>>>
>>>>> the General Oblique Transformation used by modellers - that is
>>>>>>
>>>>> something
>>>>
>>>>> that feels like longlat but is recentred and oblique? Example at the
>>>>>>
>>>>> very
>>>>
>>>>> end of my GEOSTAT talk last year (slides 81-83):
>>>>>>
>>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>>> For what it is worth, the General Oblique Transformation is not the
>>>>> only
>>>>> example - it's very common for modellers to have a mesh that has the
>>>>> "mostly-properties" of a projection, but is not actually describable
>>>>>
>>>> with
>>>>
>>>>> standard transform + affine parameters. The main cases that I've seen
>>>>>
>>>> are
>>>>
>>>>> polar stereographic, equal area or oblique Mercator. Often they really
>>>>>
>>>> are
>>>>
>>>>> simple transforms and you can reconstruct without loss, but it's not
>>>>> usually possible to tell without exploration. It's an interesting
>>>>> dis-connect to see code that builds a mesh with certain properties,
>>>>> then
>>>>> only stores longitudes and latitudes - when it could be done with
>>>>>
>>>> standard
>>>>
>>>>> tools and be stored and used much more efficiently.
>>>>>
>>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>>> terminology conflated in this context too. )
>>>>>
>>>>> I'm also interested to explore the original data.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>> -Alex
>>>>>>>
>>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>>>>
>>>>>>>> Hi
>>>>>>>>
>>>>>>>> I tried to make it work but I had to give up. I wanted to reproject
>>>>>>>>
>>>>>>> the
>>>>>
>>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>>
>>>>>>> Perhaps someone can see what I did wrong. Here is what I did (data
>>>>>>>>
>>>>>>> in
>>>>
>>>>> R
>>>>>
>>>>>> binary format and figure in png format both attached):
>>>>>>
>>>>>>> library(raster)
>>>>>>>> library(maptools)
>>>>>>>> data(wrld_simpl)
>>>>>>>>
>>>>>>>> r <- raster("raster.grd")
>>>>>>>> projection(r)
>>>>>>>> ## > NA
>>>>>>>>
>>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>>>>>>>
>>>>>>> ",")
>>>>
>>>>> coordinates(uro) <- ~lon+lat
>>>>>>>>
>>>>>>>> ## Set projections for the 3 data sets
>>>>>>>>
>>>>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>>>>>>>
>>>>>>> +lat_2=45.0
>>>>
>>>>> +ellps=WGS84"
>>>>>>
>>>>>>> projection(r)
>>>>>>>>
>>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>>>>>>>>
>>>>>>> decimal)
>>>>
>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>>>>
>>>>>>>> ## wrld_simpl is in geographical coordinates
>>>>>>>> proj4string(wrld_simpl)
>>>>>>>>
>>>>>>>> ## Make figure in png format
>>>>>>>> ## Of course plotting data with 2 different projections will give
>>>>>>>> ## some distortions
>>>>>>>> pdf("uro.png")
>>>>>>>>
>>>>>>>> plot(r)
>>>>>>>> points(uro)
>>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>>>>>>>
>>>>>>> 'r'
>>>>
>>>>> dev.off()
>>>>>>>>
>>>>>>>> extent(r)
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -131.4368
>>>>>>>> ## xmax        : -68.56323
>>>>>>>> ## ymin        : 12.35567
>>>>>>>> ## ymax        : 50.26619
>>>>>>>>
>>>>>>>> ## Reproject the raster to long-lat
>>>>>>>> ## This doesn't work (collapsed domain)
>>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>>>>>>
>>>>>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>>
>>>>>>> ## Because
>>>>>>>>
>>>>>>>>> extent(rp)
>>>>>>>>>
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -100.0015
>>>>>>>> ## xmax        : -99.68557
>>>>>>>> ## ymin        : 37.70658
>>>>>>>> ## ymax        : 38.00046
>>>>>>>>
>>>>>>>> ## Save data in R binary format
>>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>>>>
>>>>>>>>
>>>>>>>> Yours sincerely / Med venlig hilsen
>>>>>>>>
>>>>>>>> Frede Aakmann T?gersen
>>>>>>>> Specialist, M.Sc., Ph.D.
>>>>>>>> Plant Performance & Modeling
>>>>>>>>
>>>>>>>> Technology & Service Solutions
>>>>>>>> T +45 9730 5135
>>>>>>>> M +45 2547 6050
>>>>>>>> frtog at vestas.com
>>>>>>>> http://www.vestas.com
>>>>>>>>
>>>>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>>>>> Please refer to www.vestas.com/legal/notice
>>>>>>>> If you have received this e-mail in error please contact the
>>>>>>>>
>>>>>>> sender.
>>>>
>>>>>
>>>>>>>>
>>>>>>>> -----Original Message-----
>>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>>>>>>>
>>>>>>> Behalf Of
>>>>
>>>>> Agus Camacho
>>>>>>
>>>>>>> Sent: 22. februar 2016 19:20
>>>>>>>> To: tech at wildintellect.com
>>>>>>>> Cc: r-sig-geo
>>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>>>>>>>>
>>>>>>> reference system implicit in a .nc file
>>>>>>
>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>>>>>>>>
>>>>>>> them
>>>>
>>>>> using
>>>>>>
>>>>>>> your recommended Solution. I looked at the sites you proposed and
>>>>>>>>
>>>>>>> they
>>>>
>>>>> have
>>>>>>
>>>>>>> other values for lat_1, lat_0, etc..
>>>>>>>>
>>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>>>>
>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>>>>
>>>>>>>>>> Dear all,
>>>>>>>>>>
>>>>>>>>>> Im trying to overlap these points:
>>>>>>>>>>
>>>>>>>>>>
>>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>
>>>>> and a wrld_simpl object:
>>>>>>>>>> library(maptools)
>>>>>>>>>> data(wrld_simpl)
>>>>>>>>>>
>>>>>>>>>> Over this raster layer
>>>>>>>>>>
>>>>>>>>>>
>>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>
>>>>> This rastr comes from a .nc file without a reference system. The
>>>>>>>>>>
>>>>>>>>> author
>>>>>>
>>>>>>> of
>>>>>>>>>
>>>>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>>>>
>>>>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>>>>> CEN_LAT = 38.0
>>>>>>>>>> CEN_LON = -100.0
>>>>>>>>>> TRUELAT1 = 25.
>>>>>>>>>> TRUELAT2 = 45.
>>>>>>>>>>
>>>>>>>>>> However, despite i have gone through many sites in the internet,
>>>>>>>>>>
>>>>>>>>> i
>>>>
>>>>> cant
>>>>>>
>>>>>>> figure it out:
>>>>>>>>>>
>>>>>>>>>> a) if that is all the data i need to set a reference system for
>>>>>>>>>>
>>>>>>>>> my
>>>>
>>>>> points
>>>>>>
>>>>>>> and the wrld_simp object.
>>>>>>>>>>
>>>>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>>>>
>>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>>>>
>>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>>>>> Are there any site that explains easily what the fields in the
>>>>>>>>>>
>>>>>>>>> CRS
>>>>
>>>>> mean
>>>>>>
>>>>>>> and
>>>>>>>>>
>>>>>>>>>> how to change them?
>>>>>>>>>>
>>>>>>>>>> Thanks in advance.
>>>>>>>>>>
>>>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>>>>
>>>>>>>>> I believe:
>>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>>>>
>>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
>>>>>>>>>
>>>>>>>> above
>>>>>
>>>>>> and the associated mailing lists or gis stackexchange would be the
>>>>>>>>> places to get help on it.
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>>>>
>>>>>>>>> It often helps to browse similar projections on
>>>>>>>>> http://spatialreference.org/
>>>>>>>>> http://epsg.io/
>>>>>>>>>
>>>>>>>>> Enjoy,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> http://orcid.org/0000-0003-2392-6140
>>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>>> http://depsy.org/person/434412
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>> --
>>>>> Dr. Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> 203 Channel Highway
>>>>> Kingston Tasmania 7050 Australia
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>
>>>> --
>>>> Agust?n Camacho Guerrero.
>>>> Doutor em Zoologia.
>>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>>> Bioci?ncias, USP.
>>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>>
>>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Tue Feb 23 23:36:23 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Tue, 23 Feb 2016 23:36:23 +0100
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CCCD97.5040901@uni-marburg.de>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<56CCCD97.5040901@uni-marburg.de>
Message-ID: <56CCDEE7.80300@uni-marburg.de>

Agus

sorry I did miss the crucial part:

if you are doing as suggestest you have to define manually the 
Lambertian ymin xmax ymin ymax using the header information of the nc file.

here an example for the unstaggered  data

library(gdalUtils)
library(raster)
library(proj4)
library(mapview)

r<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
                   of="GTiff",
                   ot="Byte",
                   output_Raster=TRUE,
                   verbose=TRUE)

finfo <- gdalinfo("geo_em.d01.nc")
##extract parameters
lat_1=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#TRUELAT1", 
finfo))],"=")[[1]][2])
lat_2=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#TRUELAT2", 
finfo))],"=")[[1]][2])
lat0=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#CEN_LAT", 
finfo))],"=")[[1]][2])
lon0=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#CEN_LON", 
finfo))],"=")[[1]][2])
dx=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#DX", 
finfo))],"=")[[1]][2])
dy=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#DY", 
finfo))],"=")[[1]][2])
y=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#SOUTH-NORTH_PATCH_END_UNSTAG", 
finfo))],"=")[[1]][2])
x=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#WEST-EAST_PATCH_END_UNSTAG", 
finfo))],"=")[[1]][2])
x_0=0
y_0=0

## generate compliant prj4 string
projLcc=paste("+proj=lcc +lat_1=",lat_1," +lat_2=",lat_2,
            " +lat_0=",lat0," +lon_0=",lon0, " +x_0=",x_0," 
+y_0=",y_0,sep="")

## project centre coordinates
tr <- ptransform(cbind(lon0, lat0)/180*pi,'+proj=longlat +datum=WGS84 
+no_defs',proj)

## calculate extent using the Lambertian units (m)
xmin=as.integer(tr[1,1]-(x/2*dx-dx))
xmax=as.integer(tr[1,1]+(x/2*dx-dx))
ymin=as.integer(tr[1,2]-(y/2*dy-dy))
ymax=as.integer(tr[1,2]+(y/2*dy-dy))
wrfLccExt<-extent(xmin,xmax,ymin,ymax)
extent(r) <- extent(wrfLccExt)
projection(r) <- projLcc
mapview(r)


cheers Chris


Am 23.02.2016 um 22:22 schrieb Chris Reudenbach:
> Augustin
>
> just quick and dirty if you run gdalinfo("geo_em.d01.nc") your are 
> getting the information about the corner coordinates the subdatasets 
> and so on. Together with Dominiks suggestion you can do something like 
> this:
>
> library(gdalUtils)
> library(raster)
> Sys.setenv(GDAL_NETCDF_BOTTOMUP="YES")
> wrffake<- "+proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m 
> +no_defs"
> x<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
>                   of="GTiff",
>                   ot="Byte",
>                   output_Raster=TRUE,
>                   verbose=TRUE)
> wrfExt<-extent(-151.29639,-48.703613,12.355667,50.26619)
> extent(x) <- extent(wrfExt)
> projection(x) <- wrffake
> plot(x)
>
> Some remarks:
> (1) I just took the first pair of  coordinates as derived from 
> gdalinfo("geo_em.d01.nc")
> you will find 4 different coordinate pairs (i did not proof which one 
> is right
>
> The data is staggered (as outlined by Dominik) So some of the corner 
> coordinates belongs to the staggered data and the others coordinates  
> to the unstaggered ones. You will find them marked
>
> If you have installed the netcdf libs you easily can use ncview 
> geo_em.d01.nc or ncdump -h geo_em.d01.nc to view the data or get more 
> information of the header.
>
> Hope this helps
>
> cheers Chris
>
>
>
> Am 23.02.2016 um 21:11 schrieb Agus Camacho:
>> Thanks for that Dominik,
>>
>> Giving that projection to either the locations, the raster layer 
>> generated
>> from the .nc file, or both, still did not work. I keep having locations
>> that should be on land falling far on the sea. Might this be a problem
>> derived from using raster with a file whose original grid distances 
>> are not
>> constant?
>>
>> Here is a link with the original file which has the original coordinate
>> data.
>>
>> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>>
>>
>> 2016-02-23 12:07 GMT-07:00 Dominik Schneider 
>> <Dominik.Schneider at colorado.edu
>>> :
>>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>>> dealt with this.
>>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m
>>>
>>> +proj=lcc which is usually what wrf is run with.
>>> The tricky part is:
>>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> because every WRF run is different (the WRF Preprocessing System 
>>> optimizes
>>> the projection for the domain).
>>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>>
>>> This gives:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 
>>> +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> But, wrf users like to give out lat and  long so you need to assign it:
>>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> and then reproject the lat/long to lcc coordinates using this string:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 
>>> +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> One word of caution, make sure you received the correct coordinates. 
>>> Some
>>> variables are run cell center while some are run at cell edge. It looks
>>> like from your .nc file it was made by your collaborator so I assume 
>>> they
>>> are right.
>>>
>>> That said, another word of caution, I found that the XLAT and XLONG
>>> variables from WRF output aren't very precise. There is a "geogrid" 
>>> file
>>> from the preprocessing system that has the domain corners, 
>>> resolution, nrow
>>> and ncol from which you can make a better grid using the native 
>>> projection
>>> system (in my case it was a 4km grid). I suggest you try to get those.
>>>
>>> I hope this helps... I have to run but wanted to save people too 
>>> much head
>>> scratching. I can get you running with more help tonight if you need.
>>> Dominik
>>>
>>>
>>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>>> wrote:
>>>
>>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill 
>>>> bring
>>>> more giant crab this time.
>>>>
>>>> The creator of the .nc file also looked at this webpage:
>>>> http://www.pkrc.net/wrf-lambert.html
>>>> It seemed like the right proj4 string might be this one:
>>>>
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>>
>>>> However this projection also does not allow me to adequately plot the
>>>> locations on the raster.
>>>>
>>>> Here is the .nc file. it contains several layers.
>>>>
>>>>
>>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0 
>>>>
>>>>
>>>>
>>>>
>>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>>
>>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> 
>>>>> wrote:
>>>>>
>>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>>>>
>>>>>>> I made an attempt at it too. Investigating the original data, I'm
>>>> not
>>>>>>> sure that the projection information supplied is correct for the
>>>> data
>>>>>>> linked. When I load up the data in a unprojected space, the
>>>> coordinates
>>>>>>> don't look at all similar to any Lambert projected data I have, 
>>>>>>> they
>>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>>>>> perhaps a different spheroid than expected.
>>>>>> Does anyone have a link to the original data? Is is possible that
>>>> this is
>>>>>> the General Oblique Transformation used by modellers - that is
>>>> something
>>>>>> that feels like longlat but is recentred and oblique? Example at the
>>>> very
>>>>>> end of my GEOSTAT talk last year (slides 81-83):
>>>>>>
>>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>> For what it is worth, the General Oblique Transformation is not 
>>>>> the only
>>>>> example - it's very common for modellers to have a mesh that has the
>>>>> "mostly-properties" of a projection, but is not actually describable
>>>> with
>>>>> standard transform + affine parameters. The main cases that I've seen
>>>> are
>>>>> polar stereographic, equal area or oblique Mercator. Often they 
>>>>> really
>>>> are
>>>>> simple transforms and you can reconstruct without loss, but it's not
>>>>> usually possible to tell without exploration. It's an interesting
>>>>> dis-connect to see code that builds a mesh with certain 
>>>>> properties, then
>>>>> only stores longitudes and latitudes - when it could be done with
>>>> standard
>>>>> tools and be stored and used much more efficiently.
>>>>>
>>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>>> terminology conflated in this context too. )
>>>>>
>>>>> I'm also interested to explore the original data.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>>>> -Alex
>>>>>>>
>>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>>>>> Hi
>>>>>>>>
>>>>>>>> I tried to make it work but I had to give up. I wanted to 
>>>>>>>> reproject
>>>>> the
>>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>>>> Perhaps someone can see what I did wrong. Here is what I did (data
>>>> in
>>>>> R
>>>>>> binary format and figure in png format both attached):
>>>>>>>> library(raster)
>>>>>>>> library(maptools)
>>>>>>>> data(wrld_simpl)
>>>>>>>>
>>>>>>>> r <- raster("raster.grd")
>>>>>>>> projection(r)
>>>>>>>> ## > NA
>>>>>>>>
>>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>>> ",")
>>>>>>>> coordinates(uro) <- ~lon+lat
>>>>>>>>
>>>>>>>> ## Set projections for the 3 data sets
>>>>>>>>
>>>>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>>> +lat_2=45.0
>>>>>> +ellps=WGS84"
>>>>>>>> projection(r)
>>>>>>>>
>>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>>>> decimal)
>>>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>>>>
>>>>>>>> ## wrld_simpl is in geographical coordinates
>>>>>>>> proj4string(wrld_simpl)
>>>>>>>>
>>>>>>>> ## Make figure in png format
>>>>>>>> ## Of course plotting data with 2 different projections will give
>>>>>>>> ## some distortions
>>>>>>>> pdf("uro.png")
>>>>>>>>
>>>>>>>> plot(r)
>>>>>>>> points(uro)
>>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>>> 'r'
>>>>>>>> dev.off()
>>>>>>>>
>>>>>>>> extent(r)
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -131.4368
>>>>>>>> ## xmax        : -68.56323
>>>>>>>> ## ymin        : 12.35567
>>>>>>>> ## ymax        : 50.26619
>>>>>>>>
>>>>>>>> ## Reproject the raster to long-lat
>>>>>>>> ## This doesn't work (collapsed domain)
>>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>>>> ## Because
>>>>>>>>> extent(rp)
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -100.0015
>>>>>>>> ## xmax        : -99.68557
>>>>>>>> ## ymin        : 37.70658
>>>>>>>> ## ymax        : 38.00046
>>>>>>>>
>>>>>>>> ## Save data in R binary format
>>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>>>>
>>>>>>>>
>>>>>>>> Yours sincerely / Med venlig hilsen
>>>>>>>>
>>>>>>>> Frede Aakmann T?gersen
>>>>>>>> Specialist, M.Sc., Ph.D.
>>>>>>>> Plant Performance & Modeling
>>>>>>>>
>>>>>>>> Technology & Service Solutions
>>>>>>>> T +45 9730 5135
>>>>>>>> M +45 2547 6050
>>>>>>>> frtog at vestas.com
>>>>>>>> http://www.vestas.com
>>>>>>>>
>>>>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>>>>> Please refer to www.vestas.com/legal/notice
>>>>>>>> If you have received this e-mail in error please contact the
>>>> sender.
>>>>>>>>
>>>>>>>>
>>>>>>>> -----Original Message-----
>>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>>> Behalf Of
>>>>>> Agus Camacho
>>>>>>>> Sent: 22. februar 2016 19:20
>>>>>>>> To: tech at wildintellect.com
>>>>>>>> Cc: r-sig-geo
>>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl 
>>>>>>>> to a
>>>>>> reference system implicit in a .nc file
>>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>>>> them
>>>>>> using
>>>>>>>> your recommended Solution. I looked at the sites you proposed and
>>>> they
>>>>>> have
>>>>>>>> other values for lat_1, lat_0, etc..
>>>>>>>>
>>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>>>>
>>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>>>>> Dear all,
>>>>>>>>>>
>>>>>>>>>> Im trying to overlap these points:
>>>>>>>>>>
>>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0 
>>>>
>>>>>>>>>> and a wrld_simpl object:
>>>>>>>>>> library(maptools)
>>>>>>>>>> data(wrld_simpl)
>>>>>>>>>>
>>>>>>>>>> Over this raster layer
>>>>>>>>>>
>>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0 
>>>>
>>>>>>>>>> This rastr comes from a .nc file without a reference system. The
>>>>>> author
>>>>>>>>> of
>>>>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>>>>
>>>>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>>>>> CEN_LAT = 38.0
>>>>>>>>>> CEN_LON = -100.0
>>>>>>>>>> TRUELAT1 = 25.
>>>>>>>>>> TRUELAT2 = 45.
>>>>>>>>>>
>>>>>>>>>> However, despite i have gone through many sites in the internet,
>>>> i
>>>>>> cant
>>>>>>>>>> figure it out:
>>>>>>>>>>
>>>>>>>>>> a) if that is all the data i need to set a reference system for
>>>> my
>>>>>> points
>>>>>>>>>> and the wrld_simp object.
>>>>>>>>>>
>>>>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>>>>
>>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>>>>
>>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>>>>> Are there any site that explains easily what the fields in the
>>>> CRS
>>>>>> mean
>>>>>>>>> and
>>>>>>>>>> how to change them?
>>>>>>>>>>
>>>>>>>>>> Thanks in advance.
>>>>>>>>>>
>>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>>>>
>>>>>>>>> I believe:
>>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>>>>
>>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
>>>>> above
>>>>>>>>> and the associated mailing lists or gis stackexchange would be 
>>>>>>>>> the
>>>>>>>>> places to get help on it.
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>>>>
>>>>>>>>> It often helps to browse similar projections on
>>>>>>>>> http://spatialreference.org/
>>>>>>>>> http://epsg.io/
>>>>>>>>>
>>>>>>>>> Enjoy,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> -- 
>>>>>> Roger Bivand
>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> http://orcid.org/0000-0003-2392-6140
>>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>>> http://depsy.org/person/434412
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> -- 
>>>>> Dr. Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> 203 Channel Highway
>>>>> Kingston Tasmania 7050 Australia
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>> -- 
>>>> Agust?n Camacho Guerrero.
>>>> Doutor em Zoologia.
>>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>>> Bioci?ncias, USP.
>>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From agus.camacho at gmail.com  Tue Feb 23 23:41:17 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 15:41:17 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CCDEE7.80300@uni-marburg.de>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<56CCCD97.5040901@uni-marburg.de> <56CCDEE7.80300@uni-marburg.de>
Message-ID: <CALsJ7pRn-Mp251QLUB8OTn6D-Wu+H1rRdDgrjTm94ueH7+DcvA@mail.gmail.com>

Thanks again, but with gdalinfo  and gdal_translate giving NULL after
running to the end, i just cant do that..

2016-02-23 15:36 GMT-07:00 Chris Reudenbach <reudenbach at uni-marburg.de>:

> Agus
>
> sorry I did miss the crucial part:
>
> if you are doing as suggestest you have to define manually the Lambertian
> ymin xmax ymin ymax using the header information of the nc file.
>
> here an example for the unstaggered  data
>
> library(gdalUtils)
> library(raster)
> library(proj4)
> library(mapview)
>
> r<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
>                   of="GTiff",
>                   ot="Byte",
>                   output_Raster=TRUE,
>                   verbose=TRUE)
>
> finfo <- gdalinfo("geo_em.d01.nc")
> ##extract parameters
> lat_1=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#TRUELAT1",
> finfo))],"=")[[1]][2])
> lat_2=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#TRUELAT2",
> finfo))],"=")[[1]][2])
> lat0=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#CEN_LAT",
> finfo))],"=")[[1]][2])
> lon0=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#CEN_LON",
> finfo))],"=")[[1]][2])
> dx=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#DX",
> finfo))],"=")[[1]][2])
> dy=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#DY",
> finfo))],"=")[[1]][2])
> y=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#SOUTH-NORTH_PATCH_END_UNSTAG",
> finfo))],"=")[[1]][2])
> x=as.numeric(strsplit(finfo[which(grepl("NC_GLOBAL#WEST-EAST_PATCH_END_UNSTAG",
> finfo))],"=")[[1]][2])
> x_0=0
> y_0=0
>
> ## generate compliant prj4 string
> projLcc=paste("+proj=lcc +lat_1=",lat_1," +lat_2=",lat_2,
>            " +lat_0=",lat0," +lon_0=",lon0, " +x_0=",x_0,"
> +y_0=",y_0,sep="")
>
> ## project centre coordinates
> tr <- ptransform(cbind(lon0, lat0)/180*pi,'+proj=longlat +datum=WGS84
> +no_defs',proj)
>
> ## calculate extent using the Lambertian units (m)
> xmin=as.integer(tr[1,1]-(x/2*dx-dx))
> xmax=as.integer(tr[1,1]+(x/2*dx-dx))
> ymin=as.integer(tr[1,2]-(y/2*dy-dy))
> ymax=as.integer(tr[1,2]+(y/2*dy-dy))
> wrfLccExt<-extent(xmin,xmax,ymin,ymax)
> extent(r) <- extent(wrfLccExt)
> projection(r) <- projLcc
> mapview(r)
>
>
> cheers Chris
>
>
>
> Am 23.02.2016 um 22:22 schrieb Chris Reudenbach:
>
>> Augustin
>>
>> just quick and dirty if you run gdalinfo("geo_em.d01.nc") your are
>> getting the information about the corner coordinates the subdatasets and so
>> on. Together with Dominiks suggestion you can do something like this:
>>
>> library(gdalUtils)
>> library(raster)
>> Sys.setenv(GDAL_NETCDF_BOTTOMUP="YES")
>> wrffake<- "+proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m
>> +no_defs"
>> x<-gdal_translate('NETCDF:"geo_em.d01.nc":LANDMASK', 'landmask.tif',
>>                   of="GTiff",
>>                   ot="Byte",
>>                   output_Raster=TRUE,
>>                   verbose=TRUE)
>> wrfExt<-extent(-151.29639,-48.703613,12.355667,50.26619)
>> extent(x) <- extent(wrfExt)
>> projection(x) <- wrffake
>> plot(x)
>>
>> Some remarks:
>> (1) I just took the first pair of  coordinates as derived from gdalinfo("
>> geo_em.d01.nc")
>> you will find 4 different coordinate pairs (i did not proof which one is
>> right
>>
>> The data is staggered (as outlined by Dominik) So some of the corner
>> coordinates belongs to the staggered data and the others coordinates  to
>> the unstaggered ones. You will find them marked
>>
>> If you have installed the netcdf libs you easily can use ncview
>> geo_em.d01.nc or ncdump -h geo_em.d01.nc to view the data or get more
>> information of the header.
>>
>> Hope this helps
>>
>> cheers Chris
>>
>>
>>
>> Am 23.02.2016 um 21:11 schrieb Agus Camacho:
>>
>>> Thanks for that Dominik,
>>>
>>> Giving that projection to either the locations, the raster layer
>>> generated
>>> from the .nc file, or both, still did not work. I keep having locations
>>> that should be on land falling far on the sea. Might this be a problem
>>> derived from using raster with a file whose original grid distances are
>>> not
>>> constant?
>>>
>>> Here is a link with the original file which has the original coordinate
>>> data.
>>>
>>> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>>>
>>>
>>> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
>>> Dominik.Schneider at colorado.edu
>>>
>>>> :
>>>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>>>> dealt with this.
>>>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>>>> +a=6370000 +b=6370000 +units=m
>>>>
>>>> +proj=lcc which is usually what wrf is run with.
>>>> The tricky part is:
>>>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>>> because every WRF run is different (the WRF Preprocessing System
>>>> optimizes
>>>> the projection for the domain).
>>>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>>>
>>>> This gives:
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>>> +ellps=sphere
>>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>>
>>>> But, wrf users like to give out lat and  long so you need to assign it:
>>>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>>
>>>> and then reproject the lat/long to lcc coordinates using this string:
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>>> +ellps=sphere
>>>> +a=6370000 +b=6370000 +units=m +no_defs
>>>>
>>>> One word of caution, make sure you received the correct coordinates.
>>>> Some
>>>> variables are run cell center while some are run at cell edge. It looks
>>>> like from your .nc file it was made by your collaborator so I assume
>>>> they
>>>> are right.
>>>>
>>>> That said, another word of caution, I found that the XLAT and XLONG
>>>> variables from WRF output aren't very precise. There is a "geogrid" file
>>>> from the preprocessing system that has the domain corners, resolution,
>>>> nrow
>>>> and ncol from which you can make a better grid using the native
>>>> projection
>>>> system (in my case it was a 4km grid). I suggest you try to get those.
>>>>
>>>> I hope this helps... I have to run but wanted to save people too much
>>>> head
>>>> scratching. I can get you running with more help tonight if you need.
>>>> Dominik
>>>>
>>>>
>>>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>>>> wrote:
>>>>
>>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill
>>>>> bring
>>>>> more giant crab this time.
>>>>>
>>>>> The creator of the .nc file also looked at this webpage:
>>>>> http://www.pkrc.net/wrf-lambert.html
>>>>> It seemed like the right proj4 string might be this one:
>>>>>
>>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>>>
>>>>> However this projection also does not allow me to adequately plot the
>>>>> locations on the raster.
>>>>>
>>>>> Here is the .nc file. it contains several layers.
>>>>>
>>>>>
>>>>>
>>>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>>>
>>>>>
>>>>>
>>>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>>>
>>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>>>
>>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>>>>>
>>>>>>> I made an attempt at it too. Investigating the original data, I'm
>>>>>>>>
>>>>>>> not
>>>>>
>>>>>> sure that the projection information supplied is correct for the
>>>>>>>>
>>>>>>> data
>>>>>
>>>>>> linked. When I load up the data in a unprojected space, the
>>>>>>>>
>>>>>>> coordinates
>>>>>
>>>>>> don't look at all similar to any Lambert projected data I have, they
>>>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>>>>>> perhaps a different spheroid than expected.
>>>>>>>>
>>>>>>> Does anyone have a link to the original data? Is is possible that
>>>>>>>
>>>>>> this is
>>>>>
>>>>>> the General Oblique Transformation used by modellers - that is
>>>>>>>
>>>>>> something
>>>>>
>>>>>> that feels like longlat but is recentred and oblique? Example at the
>>>>>>>
>>>>>> very
>>>>>
>>>>>> end of my GEOSTAT talk last year (slides 81-83):
>>>>>>>
>>>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>>>>>
>>>>>>> Roger
>>>>>>>
>>>>>>>
>>>>>>> For what it is worth, the General Oblique Transformation is not the
>>>>>> only
>>>>>> example - it's very common for modellers to have a mesh that has the
>>>>>> "mostly-properties" of a projection, but is not actually describable
>>>>>>
>>>>> with
>>>>>
>>>>>> standard transform + affine parameters. The main cases that I've seen
>>>>>>
>>>>> are
>>>>>
>>>>>> polar stereographic, equal area or oblique Mercator. Often they really
>>>>>>
>>>>> are
>>>>>
>>>>>> simple transforms and you can reconstruct without loss, but it's not
>>>>>> usually possible to tell without exploration. It's an interesting
>>>>>> dis-connect to see code that builds a mesh with certain properties,
>>>>>> then
>>>>>> only stores longitudes and latitudes - when it could be done with
>>>>>>
>>>>> standard
>>>>>
>>>>>> tools and be stored and used much more efficiently.
>>>>>>
>>>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>>>> terminology conflated in this context too. )
>>>>>>
>>>>>> I'm also interested to explore the original data.
>>>>>>
>>>>>> Cheers, Mike.
>>>>>>
>>>>>>
>>>>>>
>>>>>> -Alex
>>>>>>>>
>>>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>>>>>
>>>>>>>>> Hi
>>>>>>>>>
>>>>>>>>> I tried to make it work but I had to give up. I wanted to reproject
>>>>>>>>>
>>>>>>>> the
>>>>>>
>>>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>>>
>>>>>>>> Perhaps someone can see what I did wrong. Here is what I did (data
>>>>>>>>>
>>>>>>>> in
>>>>>
>>>>>> R
>>>>>>
>>>>>>> binary format and figure in png format both attached):
>>>>>>>
>>>>>>>> library(raster)
>>>>>>>>> library(maptools)
>>>>>>>>> data(wrld_simpl)
>>>>>>>>>
>>>>>>>>> r <- raster("raster.grd")
>>>>>>>>> projection(r)
>>>>>>>>> ## > NA
>>>>>>>>>
>>>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>>>>>>>>
>>>>>>>> ",")
>>>>>
>>>>>> coordinates(uro) <- ~lon+lat
>>>>>>>>>
>>>>>>>>> ## Set projections for the 3 data sets
>>>>>>>>>
>>>>>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>>>>>>>>
>>>>>>>> +lat_2=45.0
>>>>>
>>>>>> +ellps=WGS84"
>>>>>>>
>>>>>>>> projection(r)
>>>>>>>>>
>>>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>>>>>>>>>
>>>>>>>> decimal)
>>>>>
>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>>>>>
>>>>>>>>> ## wrld_simpl is in geographical coordinates
>>>>>>>>> proj4string(wrld_simpl)
>>>>>>>>>
>>>>>>>>> ## Make figure in png format
>>>>>>>>> ## Of course plotting data with 2 different projections will give
>>>>>>>>> ## some distortions
>>>>>>>>> pdf("uro.png")
>>>>>>>>>
>>>>>>>>> plot(r)
>>>>>>>>> points(uro)
>>>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>>>>>>>>
>>>>>>>> 'r'
>>>>>
>>>>>> dev.off()
>>>>>>>>>
>>>>>>>>> extent(r)
>>>>>>>>> ## class       : Extent
>>>>>>>>> ## xmin        : -131.4368
>>>>>>>>> ## xmax        : -68.56323
>>>>>>>>> ## ymin        : 12.35567
>>>>>>>>> ## ymax        : 50.26619
>>>>>>>>>
>>>>>>>>> ## Reproject the raster to long-lat
>>>>>>>>> ## This doesn't work (collapsed domain)
>>>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>>>>>>>
>>>>>>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>>>
>>>>>>>> ## Because
>>>>>>>>>
>>>>>>>>>> extent(rp)
>>>>>>>>>>
>>>>>>>>> ## class       : Extent
>>>>>>>>> ## xmin        : -100.0015
>>>>>>>>> ## xmax        : -99.68557
>>>>>>>>> ## ymin        : 37.70658
>>>>>>>>> ## ymax        : 38.00046
>>>>>>>>>
>>>>>>>>> ## Save data in R binary format
>>>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> Yours sincerely / Med venlig hilsen
>>>>>>>>>
>>>>>>>>> Frede Aakmann T?gersen
>>>>>>>>> Specialist, M.Sc., Ph.D.
>>>>>>>>> Plant Performance & Modeling
>>>>>>>>>
>>>>>>>>> Technology & Service Solutions
>>>>>>>>> T +45 9730 5135
>>>>>>>>> M +45 2547 6050
>>>>>>>>> frtog at vestas.com
>>>>>>>>> http://www.vestas.com
>>>>>>>>>
>>>>>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>>>>>> Please refer to www.vestas.com/legal/notice
>>>>>>>>> If you have received this e-mail in error please contact the
>>>>>>>>>
>>>>>>>> sender.
>>>>>
>>>>>>
>>>>>>>>>
>>>>>>>>> -----Original Message-----
>>>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>>>>>>>>
>>>>>>>> Behalf Of
>>>>>
>>>>>> Agus Camacho
>>>>>>>
>>>>>>>> Sent: 22. februar 2016 19:20
>>>>>>>>> To: tech at wildintellect.com
>>>>>>>>> Cc: r-sig-geo
>>>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>>>>>>>>>
>>>>>>>> reference system implicit in a .nc file
>>>>>>>
>>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>>>>>>>>>
>>>>>>>> them
>>>>>
>>>>>> using
>>>>>>>
>>>>>>>> your recommended Solution. I looked at the sites you proposed and
>>>>>>>>>
>>>>>>>> they
>>>>>
>>>>>> have
>>>>>>>
>>>>>>>> other values for lat_1, lat_0, etc..
>>>>>>>>>
>>>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>>>>>
>>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>>>>>
>>>>>>>>>>> Dear all,
>>>>>>>>>>>
>>>>>>>>>>> Im trying to overlap these points:
>>>>>>>>>>>
>>>>>>>>>>>
>>>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>>
>>>>>> and a wrld_simpl object:
>>>>>>>>>>> library(maptools)
>>>>>>>>>>> data(wrld_simpl)
>>>>>>>>>>>
>>>>>>>>>>> Over this raster layer
>>>>>>>>>>>
>>>>>>>>>>>
>>>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>>
>>>>>> This rastr comes from a .nc file without a reference system. The
>>>>>>>>>>>
>>>>>>>>>> author
>>>>>>>
>>>>>>>> of
>>>>>>>>>>
>>>>>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>>>>>
>>>>>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>>>>>> CEN_LAT = 38.0
>>>>>>>>>>> CEN_LON = -100.0
>>>>>>>>>>> TRUELAT1 = 25.
>>>>>>>>>>> TRUELAT2 = 45.
>>>>>>>>>>>
>>>>>>>>>>> However, despite i have gone through many sites in the internet,
>>>>>>>>>>>
>>>>>>>>>> i
>>>>>
>>>>>> cant
>>>>>>>
>>>>>>>> figure it out:
>>>>>>>>>>>
>>>>>>>>>>> a) if that is all the data i need to set a reference system for
>>>>>>>>>>>
>>>>>>>>>> my
>>>>>
>>>>>> points
>>>>>>>
>>>>>>>> and the wrld_simp object.
>>>>>>>>>>>
>>>>>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>>>>>
>>>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>>>>>
>>>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>>>>>> Are there any site that explains easily what the fields in the
>>>>>>>>>>>
>>>>>>>>>> CRS
>>>>>
>>>>>> mean
>>>>>>>
>>>>>>>> and
>>>>>>>>>>
>>>>>>>>>>> how to change them?
>>>>>>>>>>>
>>>>>>>>>>> Thanks in advance.
>>>>>>>>>>>
>>>>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>>>>>
>>>>>>>>>> I believe:
>>>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>>>>>
>>>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
>>>>>>>>>>
>>>>>>>>> above
>>>>>>
>>>>>>> and the associated mailing lists or gis stackexchange would be the
>>>>>>>>>> places to get help on it.
>>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>>>>>
>>>>>>>>>> It often helps to browse similar projections on
>>>>>>>>>> http://spatialreference.org/
>>>>>>>>>> http://epsg.io/
>>>>>>>>>>
>>>>>>>>>> Enjoy,
>>>>>>>>>> Alex
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>> R-sig-Geo mailing list
>>>>>>>> R-sig-Geo at r-project.org
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>>
>>>>>>> --
>>>>>>> Roger Bivand
>>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>>> http://orcid.org/0000-0003-2392-6140
>>>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>>>> http://depsy.org/person/434412
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>>
>>>>>> --
>>>>>> Dr. Michael Sumner
>>>>>> Software and Database Engineer
>>>>>> Australian Antarctic Division
>>>>>> 203 Channel Highway
>>>>>> Kingston Tasmania 7050 Australia
>>>>>>
>>>>>>          [[alternative HTML version deleted]]
>>>>>>
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>>
>>>>>>
>>>>>
>>>>> --
>>>>> Agust?n Camacho Guerrero.
>>>>> Doutor em Zoologia.
>>>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>>>> Bioci?ncias, USP.
>>>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>>
>>>>
>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From mdsumner at gmail.com  Wed Feb 24 00:24:46 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 23 Feb 2016 23:24:46 +0000
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
Message-ID: <CAAcGz9_D8ms+WGXxOtF_9pjfUVxscH7iRaBFYHsWmQpEf-kHfw@mail.gmail.com>

On Wed, 24 Feb 2016 at 06:07 Dominik Schneider <
Dominik.Schneider at colorado.edu> wrote:

> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
> dealt with this.
> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
> +a=6370000 +b=6370000 +units=m
>
> +proj=lcc which is usually what wrf is run with.
> The tricky part is:
> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> because every WRF run is different (the WRF Preprocessing System optimizes
> the projection for the domain).
> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>
> This gives:
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
> +a=6370000 +b=6370000 +units=m +no_defs
>
>
This looks right to me:

library(raster)
library(rgdal)
prj <- "+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
+ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs"

r <- raster("results_us_future_output_none_0.nc", varname = "dctmx")
## use  print(r) to see the nc header dump

## lons/lats from NetCDF
lon <- raster("results_us_future_output_none_0.nc", varname = "lon")
lat <- raster("results_us_future_output_none_0.nc", varname = "lat")

## the true projected coordinates (??)
xy <- project(cbind(values(lon), values(lat)), prj)

## looks right
plot(xy, pch = ".")

## this fails, so it's not exactly right
##grd <- rasterFromXYZ(cbind(xy, 0)

## could use sp::points2grid tools to control tolerances, or just fudge it

ex <- extent(xy)
resolution <- c(round(max(diff(sort(unique(xy[,1]))))),
round(max(diff(sort(unique(xy[,2]))))))
ex <- ex + c(-1, 1, -1, 1) * rep(resolution / 2, 2)

## finally
mp <- setExtent(r, ex)
projection(mp) <- prj

library(maptools)
data(wrld_simpl)
namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
"Canada", "Mexico")), prj)

plot(mp)
plot(namer, add = TRUE)


("Why does this crucial metadata get thrown away?", he sighs . . .)

HTH




> But, wrf users like to give out lat and  long so you need to assign it:
> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>
> and then reproject the lat/long to lcc coordinates using this string:
> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0 +ellps=sphere
> +a=6370000 +b=6370000 +units=m +no_defs
>
> One word of caution, make sure you received the correct coordinates. Some
> variables are run cell center while some are run at cell edge. It looks
> like from your .nc file it was made by your collaborator so I assume they
> are right.
>
> That said, another word of caution, I found that the XLAT and XLONG
> variables from WRF output aren't very precise. There is a "geogrid" file
> from the preprocessing system that has the domain corners, resolution, nrow
> and ncol from which you can make a better grid using the native projection
> system (in my case it was a 4km grid). I suggest you try to get those.
>
> I hope this helps... I have to run but wanted to save people too much head
> scratching. I can get you running with more help tonight if you need.
> Dominik
>
>
> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
> wrote:
>
>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>> more giant crab this time.
>>
>> The creator of the .nc file also looked at this webpage:
>> http://www.pkrc.net/wrf-lambert.html
>> It seemed like the right proj4 string might be this one:
>>
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>
>> However this projection also does not allow me to adequately plot the
>> locations on the raster.
>>
>> Here is the .nc file. it contains several layers.
>>
>>
>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>
>>
>>
>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>
>> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>> >
>> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
>> > >
>> > > > I made an attempt at it too. Investigating the original data, I'm
>> not
>> > > > sure that the projection information supplied is correct for the
>> data
>> > > > linked. When I load up the data in a unprojected space, the
>> coordinates
>> > > > don't look at all similar to any Lambert projected data I have, they
>> > > > actually look like Lat/Lon in some unprojected coordinate system,
>> > > > perhaps a different spheroid than expected.
>> > >
>> > > Does anyone have a link to the original data? Is is possible that
>> this is
>> > > the General Oblique Transformation used by modellers - that is
>> something
>> > > that feels like longlat but is recentred and oblique? Example at the
>> very
>> > > end of my GEOSTAT talk last year (slides 81-83):
>> > >
>> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
>> > >
>> > > Roger
>> > >
>> > >
>> > For what it is worth, the General Oblique Transformation is not the only
>> > example - it's very common for modellers to have a mesh that has the
>> > "mostly-properties" of a projection, but is not actually describable
>> with
>> > standard transform + affine parameters. The main cases that I've seen
>> are
>> > polar stereographic, equal area or oblique Mercator. Often they really
>> are
>> > simple transforms and you can reconstruct without loss, but it's not
>> > usually possible to tell without exploration. It's an interesting
>> > dis-connect to see code that builds a mesh with certain properties, then
>> > only stores longitudes and latitudes - when it could be done with
>> standard
>> > tools and be stored and used much more efficiently.
>> >
>> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>> > terminology conflated in this context too. )
>> >
>> > I'm also interested to explore the original data.
>> >
>> > Cheers, Mike.
>> >
>> >
>> >
>> > > >
>> > > > -Alex
>> > > >
>> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>> > > >> Hi
>> > > >>
>> > > >> I tried to make it work but I had to give up. I wanted to reproject
>> > the
>> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
>> > > >>
>> > > >> Perhaps someone can see what I did wrong. Here is what I did (data
>> in
>> > R
>> > > binary format and figure in png format both attached):
>> > > >>
>> > > >> library(raster)
>> > > >> library(maptools)
>> > > >> data(wrld_simpl)
>> > > >>
>> > > >> r <- raster("raster.grd")
>> > > >> projection(r)
>> > > >> ## > NA
>> > > >>
>> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>> ",")
>> > > >> coordinates(uro) <- ~lon+lat
>> > > >>
>> > > >> ## Set projections for the 3 data sets
>> > > >>
>> > > >> ## Lamberth's confocal conic projection with given parameters
>> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>> +lat_2=45.0
>> > > +ellps=WGS84"
>> > > >> projection(r)
>> > > >>
>> > > >> ## Assume that lon, lat are geographical coordinates (degrees
>> decimal)
>> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>> > > >>
>> > > >> ## wrld_simpl is in geographical coordinates
>> > > >> proj4string(wrld_simpl)
>> > > >>
>> > > >> ## Make figure in png format
>> > > >> ## Of course plotting data with 2 different projections will give
>> > > >> ## some distortions
>> > > >> pdf("uro.png")
>> > > >>
>> > > >> plot(r)
>> > > >> points(uro)
>> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>> 'r'
>> > > >>
>> > > >> dev.off()
>> > > >>
>> > > >> extent(r)
>> > > >> ## class       : Extent
>> > > >> ## xmin        : -131.4368
>> > > >> ## xmax        : -68.56323
>> > > >> ## ymin        : 12.35567
>> > > >> ## ymax        : 50.26619
>> > > >>
>> > > >> ## Reproject the raster to long-lat
>> > > >> ## This doesn't work (collapsed domain)
>> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>> > > +ellps=WGS84 +towgs84=0,0,0")
>> > > >>
>> > > >> ## Because
>> > > >>> extent(rp)
>> > > >> ## class       : Extent
>> > > >> ## xmin        : -100.0015
>> > > >> ## xmax        : -99.68557
>> > > >> ## ymin        : 37.70658
>> > > >> ## ymax        : 38.00046
>> > > >>
>> > > >> ## Save data in R binary format
>> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>> > > >>
>> > > >>
>> > > >> Yours sincerely / Med venlig hilsen
>> > > >>
>> > > >> Frede Aakmann T?gersen
>> > > >> Specialist, M.Sc., Ph.D.
>> > > >> Plant Performance & Modeling
>> > > >>
>> > > >> Technology & Service Solutions
>> > > >> T +45 9730 5135
>> > > >> M +45 2547 6050
>> > > >> frtog at vestas.com
>> > > >> http://www.vestas.com
>> > > >>
>> > > >> Company reg. name: Vestas Wind Systems A/S
>> > > >> This e-mail is subject to our e-mail disclaimer statement.
>> > > >> Please refer to www.vestas.com/legal/notice
>> > > >> If you have received this e-mail in error please contact the
>> sender.
>> > > >>
>> > > >>
>> > > >>
>> > > >> -----Original Message-----
>> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>> Behalf Of
>> > > Agus Camacho
>> > > >> Sent: 22. februar 2016 19:20
>> > > >> To: tech at wildintellect.com
>> > > >> Cc: r-sig-geo
>> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to a
>> > > reference system implicit in a .nc file
>> > > >>
>> > > >> Thanks Alex, but the locations still fall in the sea when i plot
>> them
>> > > using
>> > > >> your recommended Solution. I looked at the sites you proposed and
>> they
>> > > have
>> > > >> other values for lat_1, lat_0, etc..
>> > > >>
>> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>> > > >>
>> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>> > > >>>> Dear all,
>> > > >>>>
>> > > >>>> Im trying to overlap these points:
>> > > >>>>
>> > > >>>
>> > >
>> >
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>> > > >>>>
>> > > >>>> and a wrld_simpl object:
>> > > >>>> library(maptools)
>> > > >>>> data(wrld_simpl)
>> > > >>>>
>> > > >>>> Over this raster layer
>> > > >>>>
>> > > >>>
>> > >
>> >
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>> > > >>>>
>> > > >>>> This rastr comes from a .nc file without a reference system. The
>> > > author
>> > > >>> of
>> > > >>>> that .nc file gave me the following data about the .nc.
>> > > >>>>
>> > > >>>> The projection is *Lambert conformal conic* projection
>> > > >>>> CEN_LAT = 38.0
>> > > >>>> CEN_LON = -100.0
>> > > >>>> TRUELAT1 = 25.
>> > > >>>> TRUELAT2 = 45.
>> > > >>>>
>> > > >>>> However, despite i have gone through many sites in the internet,
>> i
>> > > cant
>> > > >>>> figure it out:
>> > > >>>>
>> > > >>>> a) if that is all the data i need to set a reference system for
>> my
>> > > points
>> > > >>>> and the wrld_simp object.
>> > > >>>>
>> > > >>>> b) how to change a typical CRS object with such data
>> > > >>>>
>> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>> > > >>>>
>> > > >>>> Where do i enter the TRUELAT and CENLAT values?
>> > > >>>> Are there any site that explains easily what the fields in the
>> CRS
>> > > mean
>> > > >>> and
>> > > >>>> how to change them?
>> > > >>>>
>> > > >>>> Thanks in advance.
>> > > >>>>
>> > > >>>
>> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
>> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
>> > > >>>
>> > > >>> I believe:
>> > > >>> +lat_0  = CEN_LAT   Latitude of origin
>> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>> > > >>> +lon_0  = CEN_LON   Central meridian
>> > > >>>
>> > > >>> proj strings are defined by the proj4 libary. It's website listed
>> > above
>> > > >>> and the associated mailing lists or gis stackexchange would be the
>> > > >>> places to get help on it.
>> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
>> > > >>>
>> > > >>> It often helps to browse similar projections on
>> > > >>> http://spatialreference.org/
>> > > >>> http://epsg.io/
>> > > >>>
>> > > >>> Enjoy,
>> > > >>> Alex
>> > > >>>
>> > > >>>
>> > > >>
>> > > >>
>> > > >
>> > > > _______________________________________________
>> > > > R-sig-Geo mailing list
>> > > > R-sig-Geo at r-project.org
>> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> > >
>> > > --
>> > > Roger Bivand
>> > > Department of Economics, Norwegian School of Economics,
>> > > Helleveien 30, N-5045 Bergen, Norway.
>> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
>> > > e-mail: Roger.Bivand at nhh.no
>> > > http://orcid.org/0000-0003-2392-6140
>> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> > > http://depsy.org/person/434412
>> > > _______________________________________________
>> > > R-sig-Geo mailing list
>> > > R-sig-Geo at r-project.org
>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>> > --
>> > Dr. Michael Sumner
>> > Software and Database Engineer
>> > Australian Antarctic Division
>> > 203 Channel Highway
>> > Kingston Tasmania 7050 Australia
>> >
>> >         [[alternative HTML version deleted]]
>> >
>> > _______________________________________________
>> > R-sig-Geo mailing list
>> > R-sig-Geo at r-project.org
>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >
>>
>>
>>
>> --
>> Agust?n Camacho Guerrero.
>> Doutor em Zoologia.
>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>> Bioci?ncias, USP.
>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> --
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Wed Feb 24 00:30:49 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 16:30:49 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CAAcGz9_D8ms+WGXxOtF_9pjfUVxscH7iRaBFYHsWmQpEf-kHfw@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CAAcGz9_D8ms+WGXxOtF_9pjfUVxscH7iRaBFYHsWmQpEf-kHfw@mail.gmail.com>
Message-ID: <CALsJ7pRVKRXMXtLED4n+Fm4CsMg3hRE2w2QCj4B-_NJO+newsQ@mail.gmail.com>

Thanks Michael, that was a good job and despite the map looks nice now, the
locations cant still be plotted adequately, either as raw lon lat or as
spatial points with different projections.


x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
x=x[,1:3]
colnames(x)
coordinates(x)=~lon+lat
projection(x)="+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
x=spTransform(x, CRS("+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
+lon_0=-100.0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs"))
points(x)

2016-02-23 16:24 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:

>
>
> On Wed, 24 Feb 2016 at 06:07 Dominik Schneider <
> Dominik.Schneider at colorado.edu> wrote:
>
>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>> dealt with this.
>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>> +a=6370000 +b=6370000 +units=m
>>
>> +proj=lcc which is usually what wrf is run with.
>> The tricky part is:
>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> because every WRF run is different (the WRF Preprocessing System
>> optimizes the projection for the domain).
>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>
>> This gives:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>>
> This looks right to me:
>
> library(raster)
> library(rgdal)
> prj <- "+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs"
>
> r <- raster("results_us_future_output_none_0.nc", varname = "dctmx")
> ## use  print(r) to see the nc header dump
>
> ## lons/lats from NetCDF
> lon <- raster("results_us_future_output_none_0.nc", varname = "lon")
> lat <- raster("results_us_future_output_none_0.nc", varname = "lat")
>
> ## the true projected coordinates (??)
> xy <- project(cbind(values(lon), values(lat)), prj)
>
> ## looks right
> plot(xy, pch = ".")
>
> ## this fails, so it's not exactly right
> ##grd <- rasterFromXYZ(cbind(xy, 0)
>
> ## could use sp::points2grid tools to control tolerances, or just fudge it
>
> ex <- extent(xy)
> resolution <- c(round(max(diff(sort(unique(xy[,1]))))),
> round(max(diff(sort(unique(xy[,2]))))))
> ex <- ex + c(-1, 1, -1, 1) * rep(resolution / 2, 2)
>
> ## finally
> mp <- setExtent(r, ex)
> projection(mp) <- prj
>
> library(maptools)
> data(wrld_simpl)
> namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
> "Canada", "Mexico")), prj)
>
> plot(mp)
> plot(namer, add = TRUE)
>
>
> ("Why does this crucial metadata get thrown away?", he sighs . . .)
>
> HTH
>
>
>
>
>> But, wrf users like to give out lat and  long so you need to assign it:
>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> and then reproject the lat/long to lcc coordinates using this string:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> One word of caution, make sure you received the correct coordinates. Some
>> variables are run cell center while some are run at cell edge. It looks
>> like from your .nc file it was made by your collaborator so I assume they
>> are right.
>>
>> That said, another word of caution, I found that the XLAT and XLONG
>> variables from WRF output aren't very precise. There is a "geogrid" file
>> from the preprocessing system that has the domain corners, resolution, nrow
>> and ncol from which you can make a better grid using the native projection
>> system (in my case it was a 4km grid). I suggest you try to get those.
>>
>> I hope this helps... I have to run but wanted to save people too much
>> head scratching. I can get you running with more help tonight if you need.
>> Dominik
>>
>>
>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>> wrote:
>>
>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>>> more giant crab this time.
>>>
>>> The creator of the .nc file also looked at this webpage:
>>> http://www.pkrc.net/wrf-lambert.html
>>> It seemed like the right proj4 string might be this one:
>>>
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>
>>> However this projection also does not allow me to adequately plot the
>>> locations on the raster.
>>>
>>> Here is the .nc file. it contains several layers.
>>>
>>>
>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>
>>>
>>>
>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>
>>> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> >
>>> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
>>> > >
>>> > > > I made an attempt at it too. Investigating the original data, I'm
>>> not
>>> > > > sure that the projection information supplied is correct for the
>>> data
>>> > > > linked. When I load up the data in a unprojected space, the
>>> coordinates
>>> > > > don't look at all similar to any Lambert projected data I have,
>>> they
>>> > > > actually look like Lat/Lon in some unprojected coordinate system,
>>> > > > perhaps a different spheroid than expected.
>>> > >
>>> > > Does anyone have a link to the original data? Is is possible that
>>> this is
>>> > > the General Oblique Transformation used by modellers - that is
>>> something
>>> > > that feels like longlat but is recentred and oblique? Example at the
>>> very
>>> > > end of my GEOSTAT talk last year (slides 81-83):
>>> > >
>>> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>> > >
>>> > > Roger
>>> > >
>>> > >
>>> > For what it is worth, the General Oblique Transformation is not the
>>> only
>>> > example - it's very common for modellers to have a mesh that has the
>>> > "mostly-properties" of a projection, but is not actually describable
>>> with
>>> > standard transform + affine parameters. The main cases that I've seen
>>> are
>>> > polar stereographic, equal area or oblique Mercator. Often they really
>>> are
>>> > simple transforms and you can reconstruct without loss, but it's not
>>> > usually possible to tell without exploration. It's an interesting
>>> > dis-connect to see code that builds a mesh with certain properties,
>>> then
>>> > only stores longitudes and latitudes - when it could be done with
>>> standard
>>> > tools and be stored and used much more efficiently.
>>> >
>>> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>> > terminology conflated in this context too. )
>>> >
>>> > I'm also interested to explore the original data.
>>> >
>>> > Cheers, Mike.
>>> >
>>> >
>>> >
>>> > > >
>>> > > > -Alex
>>> > > >
>>> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>> > > >> Hi
>>> > > >>
>>> > > >> I tried to make it work but I had to give up. I wanted to
>>> reproject
>>> > the
>>> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
>>> > > >>
>>> > > >> Perhaps someone can see what I did wrong. Here is what I did
>>> (data in
>>> > R
>>> > > binary format and figure in png format both attached):
>>> > > >>
>>> > > >> library(raster)
>>> > > >> library(maptools)
>>> > > >> data(wrld_simpl)
>>> > > >>
>>> > > >> r <- raster("raster.grd")
>>> > > >> projection(r)
>>> > > >> ## > NA
>>> > > >>
>>> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>> ",")
>>> > > >> coordinates(uro) <- ~lon+lat
>>> > > >>
>>> > > >> ## Set projections for the 3 data sets
>>> > > >>
>>> > > >> ## Lamberth's confocal conic projection with given parameters
>>> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>> +lat_2=45.0
>>> > > +ellps=WGS84"
>>> > > >> projection(r)
>>> > > >>
>>> > > >> ## Assume that lon, lat are geographical coordinates (degrees
>>> decimal)
>>> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>> > > >>
>>> > > >> ## wrld_simpl is in geographical coordinates
>>> > > >> proj4string(wrld_simpl)
>>> > > >>
>>> > > >> ## Make figure in png format
>>> > > >> ## Of course plotting data with 2 different projections will give
>>> > > >> ## some distortions
>>> > > >> pdf("uro.png")
>>> > > >>
>>> > > >> plot(r)
>>> > > >> points(uro)
>>> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>> 'r'
>>> > > >>
>>> > > >> dev.off()
>>> > > >>
>>> > > >> extent(r)
>>> > > >> ## class       : Extent
>>> > > >> ## xmin        : -131.4368
>>> > > >> ## xmax        : -68.56323
>>> > > >> ## ymin        : 12.35567
>>> > > >> ## ymax        : 50.26619
>>> > > >>
>>> > > >> ## Reproject the raster to long-lat
>>> > > >> ## This doesn't work (collapsed domain)
>>> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>> > > +ellps=WGS84 +towgs84=0,0,0")
>>> > > >>
>>> > > >> ## Because
>>> > > >>> extent(rp)
>>> > > >> ## class       : Extent
>>> > > >> ## xmin        : -100.0015
>>> > > >> ## xmax        : -99.68557
>>> > > >> ## ymin        : 37.70658
>>> > > >> ## ymax        : 38.00046
>>> > > >>
>>> > > >> ## Save data in R binary format
>>> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>> > > >>
>>> > > >>
>>> > > >> Yours sincerely / Med venlig hilsen
>>> > > >>
>>> > > >> Frede Aakmann T?gersen
>>> > > >> Specialist, M.Sc., Ph.D.
>>> > > >> Plant Performance & Modeling
>>> > > >>
>>> > > >> Technology & Service Solutions
>>> > > >> T +45 9730 5135
>>> > > >> M +45 2547 6050
>>> > > >> frtog at vestas.com
>>> > > >> http://www.vestas.com
>>> > > >>
>>> > > >> Company reg. name: Vestas Wind Systems A/S
>>> > > >> This e-mail is subject to our e-mail disclaimer statement.
>>> > > >> Please refer to www.vestas.com/legal/notice
>>> > > >> If you have received this e-mail in error please contact the
>>> sender.
>>> > > >>
>>> > > >>
>>> > > >>
>>> > > >> -----Original Message-----
>>> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>> Behalf Of
>>> > > Agus Camacho
>>> > > >> Sent: 22. februar 2016 19:20
>>> > > >> To: tech at wildintellect.com
>>> > > >> Cc: r-sig-geo
>>> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to
>>> a
>>> > > reference system implicit in a .nc file
>>> > > >>
>>> > > >> Thanks Alex, but the locations still fall in the sea when i plot
>>> them
>>> > > using
>>> > > >> your recommended Solution. I looked at the sites you proposed and
>>> they
>>> > > have
>>> > > >> other values for lat_1, lat_0, etc..
>>> > > >>
>>> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>> > > >>
>>> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>> > > >>>> Dear all,
>>> > > >>>>
>>> > > >>>> Im trying to overlap these points:
>>> > > >>>>
>>> > > >>>
>>> > >
>>> >
>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>> > > >>>>
>>> > > >>>> and a wrld_simpl object:
>>> > > >>>> library(maptools)
>>> > > >>>> data(wrld_simpl)
>>> > > >>>>
>>> > > >>>> Over this raster layer
>>> > > >>>>
>>> > > >>>
>>> > >
>>> >
>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>> > > >>>>
>>> > > >>>> This rastr comes from a .nc file without a reference system. The
>>> > > author
>>> > > >>> of
>>> > > >>>> that .nc file gave me the following data about the .nc.
>>> > > >>>>
>>> > > >>>> The projection is *Lambert conformal conic* projection
>>> > > >>>> CEN_LAT = 38.0
>>> > > >>>> CEN_LON = -100.0
>>> > > >>>> TRUELAT1 = 25.
>>> > > >>>> TRUELAT2 = 45.
>>> > > >>>>
>>> > > >>>> However, despite i have gone through many sites in the
>>> internet, i
>>> > > cant
>>> > > >>>> figure it out:
>>> > > >>>>
>>> > > >>>> a) if that is all the data i need to set a reference system for
>>> my
>>> > > points
>>> > > >>>> and the wrld_simp object.
>>> > > >>>>
>>> > > >>>> b) how to change a typical CRS object with such data
>>> > > >>>>
>>> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>> > > >>>>
>>> > > >>>> Where do i enter the TRUELAT and CENLAT values?
>>> > > >>>> Are there any site that explains easily what the fields in the
>>> CRS
>>> > > mean
>>> > > >>> and
>>> > > >>>> how to change them?
>>> > > >>>>
>>> > > >>>> Thanks in advance.
>>> > > >>>>
>>> > > >>>
>>> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
>>> > > >>>
>>> > > >>> I believe:
>>> > > >>> +lat_0  = CEN_LAT   Latitude of origin
>>> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>> > > >>> +lon_0  = CEN_LON   Central meridian
>>> > > >>>
>>> > > >>> proj strings are defined by the proj4 libary. It's website listed
>>> > above
>>> > > >>> and the associated mailing lists or gis stackexchange would be
>>> the
>>> > > >>> places to get help on it.
>>> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>> > > >>>
>>> > > >>> It often helps to browse similar projections on
>>> > > >>> http://spatialreference.org/
>>> > > >>> http://epsg.io/
>>> > > >>>
>>> > > >>> Enjoy,
>>> > > >>> Alex
>>> > > >>>
>>> > > >>>
>>> > > >>
>>> > > >>
>>> > > >
>>> > > > _______________________________________________
>>> > > > R-sig-Geo mailing list
>>> > > > R-sig-Geo at r-project.org
>>> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >
>>> > > --
>>> > > Roger Bivand
>>> > > Department of Economics, Norwegian School of Economics,
>>> > > Helleveien 30, N-5045 Bergen, Norway.
>>> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> > > e-mail: Roger.Bivand at nhh.no
>>> > > http://orcid.org/0000-0003-2392-6140
>>> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> > > http://depsy.org/person/434412
>>> > > _______________________________________________
>>> > > R-sig-Geo mailing list
>>> > > R-sig-Geo at r-project.org
>>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>> > --
>>> > Dr. Michael Sumner
>>> > Software and Database Engineer
>>> > Australian Antarctic Division
>>> > 203 Channel Highway
>>> > Kingston Tasmania 7050 Australia
>>> >
>>> >         [[alternative HTML version deleted]]
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>>
>>>
>>>
>>> --
>>> Agust?n Camacho Guerrero.
>>> Doutor em Zoologia.
>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>> Bioci?ncias, USP.
>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>


-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From Dominik.Schneider at colorado.edu  Wed Feb 24 05:09:18 2016
From: Dominik.Schneider at colorado.edu (Dominik Schneider)
Date: Tue, 23 Feb 2016 21:09:18 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pRVKRXMXtLED4n+Fm4CsMg3hRE2w2QCj4B-_NJO+newsQ@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CAAcGz9_D8ms+WGXxOtF_9pjfUVxscH7iRaBFYHsWmQpEf-kHfw@mail.gmail.com>
	<CALsJ7pRVKRXMXtLED4n+Fm4CsMg3hRE2w2QCj4B-_NJO+newsQ@mail.gmail.com>
Message-ID: <CAF1jk_nj-8sJkf+HA0y3UUiScTUbVeVkbEs1wLvpwPMbfcqBDQ@mail.gmail.com>

just glancing through the email chain. looks like you were able to get
things plotted....but you are still having an issue with some points?

here is a link for information regarding the grid staggering used in WRF.
http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_V3/users_guide_chap3.htm

> Some remarks:
> (1) I just took the first pair of  coordinates as derived from gdalinfo("
> geo_em.d01.nc")
> you will find 4 different coordinate pairs (i did not proof which one is
> right
> The data is staggered (as outlined by Dominik) So some of the corner
> coordinates belongs to the staggered data and the others coordinates  to
> the unstaggered ones.



On Tue, Feb 23, 2016 at 4:30 PM, Agus Camacho <agus.camacho at gmail.com>
wrote:

> Thanks Michael, that was a good job and despite the map looks nice now,
> the locations cant still be plotted adequately, either as raw lon lat or as
> spatial points with different projections.
>
>
> x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
> Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
> x=x[,1:3]
> colnames(x)
> coordinates(x)=~lon+lat
> projection(x)="+proj=lcc +lat_1=48 +lat_2=33 +lon_0=-100 +ellps=WGS84"
> x=spTransform(x, CRS("+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
> +lon_0=-100.0 +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs"))
> points(x)
>
> 2016-02-23 16:24 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>
>>
>>
>> On Wed, 24 Feb 2016 at 06:07 Dominik Schneider <
>> Dominik.Schneider at colorado.edu> wrote:
>>
>>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>>> dealt with this.
>>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m
>>>
>>> +proj=lcc which is usually what wrf is run with.
>>> The tricky part is:
>>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> because every WRF run is different (the WRF Preprocessing System
>>> optimizes the projection for the domain).
>>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>>
>>> This gives:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>>
>> This looks right to me:
>>
>> library(raster)
>> library(rgdal)
>> prj <- "+proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs"
>>
>> r <- raster("results_us_future_output_none_0.nc", varname = "dctmx")
>> ## use  print(r) to see the nc header dump
>>
>> ## lons/lats from NetCDF
>> lon <- raster("results_us_future_output_none_0.nc", varname = "lon")
>> lat <- raster("results_us_future_output_none_0.nc", varname = "lat")
>>
>> ## the true projected coordinates (??)
>> xy <- project(cbind(values(lon), values(lat)), prj)
>>
>> ## looks right
>> plot(xy, pch = ".")
>>
>> ## this fails, so it's not exactly right
>> ##grd <- rasterFromXYZ(cbind(xy, 0)
>>
>> ## could use sp::points2grid tools to control tolerances, or just fudge it
>>
>> ex <- extent(xy)
>> resolution <- c(round(max(diff(sort(unique(xy[,1]))))),
>> round(max(diff(sort(unique(xy[,2]))))))
>> ex <- ex + c(-1, 1, -1, 1) * rep(resolution / 2, 2)
>>
>> ## finally
>> mp <- setExtent(r, ex)
>> projection(mp) <- prj
>>
>> library(maptools)
>> data(wrld_simpl)
>> namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
>> "Canada", "Mexico")), prj)
>>
>> plot(mp)
>> plot(namer, add = TRUE)
>>
>>
>> ("Why does this crucial metadata get thrown away?", he sighs . . .)
>>
>> HTH
>>
>>
>>
>>
>>> But, wrf users like to give out lat and  long so you need to assign it:
>>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> and then reproject the lat/long to lcc coordinates using this string:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> One word of caution, make sure you received the correct coordinates.
>>> Some variables are run cell center while some are run at cell edge. It
>>> looks like from your .nc file it was made by your collaborator so I assume
>>> they are right.
>>>
>>> That said, another word of caution, I found that the XLAT and XLONG
>>> variables from WRF output aren't very precise. There is a "geogrid" file
>>> from the preprocessing system that has the domain corners, resolution, nrow
>>> and ncol from which you can make a better grid using the native projection
>>> system (in my case it was a 4km grid). I suggest you try to get those.
>>>
>>> I hope this helps... I have to run but wanted to save people too much
>>> head scratching. I can get you running with more help tonight if you need.
>>> Dominik
>>>
>>>
>>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>>> wrote:
>>>
>>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill
>>>> bring
>>>> more giant crab this time.
>>>>
>>>> The creator of the .nc file also looked at this webpage:
>>>> http://www.pkrc.net/wrf-lambert.html
>>>> It seemed like the right proj4 string might be this one:
>>>>
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>>
>>>> However this projection also does not allow me to adequately plot the
>>>> locations on the raster.
>>>>
>>>> Here is the .nc file. it contains several layers.
>>>>
>>>>
>>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>>
>>>>
>>>>
>>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>>
>>>> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no>
>>>> wrote:
>>>> >
>>>> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>> > >
>>>> > > > I made an attempt at it too. Investigating the original data, I'm
>>>> not
>>>> > > > sure that the projection information supplied is correct for the
>>>> data
>>>> > > > linked. When I load up the data in a unprojected space, the
>>>> coordinates
>>>> > > > don't look at all similar to any Lambert projected data I have,
>>>> they
>>>> > > > actually look like Lat/Lon in some unprojected coordinate system,
>>>> > > > perhaps a different spheroid than expected.
>>>> > >
>>>> > > Does anyone have a link to the original data? Is is possible that
>>>> this is
>>>> > > the General Oblique Transformation used by modellers - that is
>>>> something
>>>> > > that feels like longlat but is recentred and oblique? Example at
>>>> the very
>>>> > > end of my GEOSTAT talk last year (slides 81-83):
>>>> > >
>>>> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>> > >
>>>> > > Roger
>>>> > >
>>>> > >
>>>> > For what it is worth, the General Oblique Transformation is not the
>>>> only
>>>> > example - it's very common for modellers to have a mesh that has the
>>>> > "mostly-properties" of a projection, but is not actually describable
>>>> with
>>>> > standard transform + affine parameters. The main cases that I've seen
>>>> are
>>>> > polar stereographic, equal area or oblique Mercator. Often they
>>>> really are
>>>> > simple transforms and you can reconstruct without loss, but it's not
>>>> > usually possible to tell without exploration. It's an interesting
>>>> > dis-connect to see code that builds a mesh with certain properties,
>>>> then
>>>> > only stores longitudes and latitudes - when it could be done with
>>>> standard
>>>> > tools and be stored and used much more efficiently.
>>>> >
>>>> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>> > terminology conflated in this context too. )
>>>> >
>>>> > I'm also interested to explore the original data.
>>>> >
>>>> > Cheers, Mike.
>>>> >
>>>> >
>>>> >
>>>> > > >
>>>> > > > -Alex
>>>> > > >
>>>> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>> > > >> Hi
>>>> > > >>
>>>> > > >> I tried to make it work but I had to give up. I wanted to
>>>> reproject
>>>> > the
>>>> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>> > > >>
>>>> > > >> Perhaps someone can see what I did wrong. Here is what I did
>>>> (data in
>>>> > R
>>>> > > binary format and figure in png format both attached):
>>>> > > >>
>>>> > > >> library(raster)
>>>> > > >> library(maptools)
>>>> > > >> data(wrld_simpl)
>>>> > > >>
>>>> > > >> r <- raster("raster.grd")
>>>> > > >> projection(r)
>>>> > > >> ## > NA
>>>> > > >>
>>>> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>>> ",")
>>>> > > >> coordinates(uro) <- ~lon+lat
>>>> > > >>
>>>> > > >> ## Set projections for the 3 data sets
>>>> > > >>
>>>> > > >> ## Lamberth's confocal conic projection with given parameters
>>>> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>>> +lat_2=45.0
>>>> > > +ellps=WGS84"
>>>> > > >> projection(r)
>>>> > > >>
>>>> > > >> ## Assume that lon, lat are geographical coordinates (degrees
>>>> decimal)
>>>> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>> > > >>
>>>> > > >> ## wrld_simpl is in geographical coordinates
>>>> > > >> proj4string(wrld_simpl)
>>>> > > >>
>>>> > > >> ## Make figure in png format
>>>> > > >> ## Of course plotting data with 2 different projections will give
>>>> > > >> ## some distortions
>>>> > > >> pdf("uro.png")
>>>> > > >>
>>>> > > >> plot(r)
>>>> > > >> points(uro)
>>>> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent
>>>> of 'r'
>>>> > > >>
>>>> > > >> dev.off()
>>>> > > >>
>>>> > > >> extent(r)
>>>> > > >> ## class       : Extent
>>>> > > >> ## xmin        : -131.4368
>>>> > > >> ## xmax        : -68.56323
>>>> > > >> ## ymin        : 12.35567
>>>> > > >> ## ymax        : 50.26619
>>>> > > >>
>>>> > > >> ## Reproject the raster to long-lat
>>>> > > >> ## This doesn't work (collapsed domain)
>>>> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>> > > +ellps=WGS84 +towgs84=0,0,0")
>>>> > > >>
>>>> > > >> ## Because
>>>> > > >>> extent(rp)
>>>> > > >> ## class       : Extent
>>>> > > >> ## xmin        : -100.0015
>>>> > > >> ## xmax        : -99.68557
>>>> > > >> ## ymin        : 37.70658
>>>> > > >> ## ymax        : 38.00046
>>>> > > >>
>>>> > > >> ## Save data in R binary format
>>>> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>> > > >>
>>>> > > >>
>>>> > > >> Yours sincerely / Med venlig hilsen
>>>> > > >>
>>>> > > >> Frede Aakmann T?gersen
>>>> > > >> Specialist, M.Sc., Ph.D.
>>>> > > >> Plant Performance & Modeling
>>>> > > >>
>>>> > > >> Technology & Service Solutions
>>>> > > >> T +45 9730 5135
>>>> > > >> M +45 2547 6050
>>>> > > >> frtog at vestas.com
>>>> > > >> http://www.vestas.com
>>>> > > >>
>>>> > > >> Company reg. name: Vestas Wind Systems A/S
>>>> > > >> This e-mail is subject to our e-mail disclaimer statement.
>>>> > > >> Please refer to www.vestas.com/legal/notice
>>>> > > >> If you have received this e-mail in error please contact the
>>>> sender.
>>>> > > >>
>>>> > > >>
>>>> > > >>
>>>> > > >> -----Original Message-----
>>>> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>>> Behalf Of
>>>> > > Agus Camacho
>>>> > > >> Sent: 22. februar 2016 19:20
>>>> > > >> To: tech at wildintellect.com
>>>> > > >> Cc: r-sig-geo
>>>> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl
>>>> to a
>>>> > > reference system implicit in a .nc file
>>>> > > >>
>>>> > > >> Thanks Alex, but the locations still fall in the sea when i plot
>>>> them
>>>> > > using
>>>> > > >> your recommended Solution. I looked at the sites you proposed
>>>> and they
>>>> > > have
>>>> > > >> other values for lat_1, lat_0, etc..
>>>> > > >>
>>>> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>> > > >>
>>>> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>> > > >>>> Dear all,
>>>> > > >>>>
>>>> > > >>>> Im trying to overlap these points:
>>>> > > >>>>
>>>> > > >>>
>>>> > >
>>>> >
>>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>> > > >>>>
>>>> > > >>>> and a wrld_simpl object:
>>>> > > >>>> library(maptools)
>>>> > > >>>> data(wrld_simpl)
>>>> > > >>>>
>>>> > > >>>> Over this raster layer
>>>> > > >>>>
>>>> > > >>>
>>>> > >
>>>> >
>>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>> > > >>>>
>>>> > > >>>> This rastr comes from a .nc file without a reference system.
>>>> The
>>>> > > author
>>>> > > >>> of
>>>> > > >>>> that .nc file gave me the following data about the .nc.
>>>> > > >>>>
>>>> > > >>>> The projection is *Lambert conformal conic* projection
>>>> > > >>>> CEN_LAT = 38.0
>>>> > > >>>> CEN_LON = -100.0
>>>> > > >>>> TRUELAT1 = 25.
>>>> > > >>>> TRUELAT2 = 45.
>>>> > > >>>>
>>>> > > >>>> However, despite i have gone through many sites in the
>>>> internet, i
>>>> > > cant
>>>> > > >>>> figure it out:
>>>> > > >>>>
>>>> > > >>>> a) if that is all the data i need to set a reference system
>>>> for my
>>>> > > points
>>>> > > >>>> and the wrld_simp object.
>>>> > > >>>>
>>>> > > >>>> b) how to change a typical CRS object with such data
>>>> > > >>>>
>>>> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>> > > >>>>
>>>> > > >>>> Where do i enter the TRUELAT and CENLAT values?
>>>> > > >>>> Are there any site that explains easily what the fields in the
>>>> CRS
>>>> > > mean
>>>> > > >>> and
>>>> > > >>>> how to change them?
>>>> > > >>>>
>>>> > > >>>> Thanks in advance.
>>>> > > >>>>
>>>> > > >>>
>>>> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
>>>> > > >>>
>>>> > > >>> I believe:
>>>> > > >>> +lat_0  = CEN_LAT   Latitude of origin
>>>> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>> > > >>> +lon_0  = CEN_LON   Central meridian
>>>> > > >>>
>>>> > > >>> proj strings are defined by the proj4 libary. It's website
>>>> listed
>>>> > above
>>>> > > >>> and the associated mailing lists or gis stackexchange would be
>>>> the
>>>> > > >>> places to get help on it.
>>>> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>> > > >>>
>>>> > > >>> It often helps to browse similar projections on
>>>> > > >>> http://spatialreference.org/
>>>> > > >>> http://epsg.io/
>>>> > > >>>
>>>> > > >>> Enjoy,
>>>> > > >>> Alex
>>>> > > >>>
>>>> > > >>>
>>>> > > >>
>>>> > > >>
>>>> > > >
>>>> > > > _______________________________________________
>>>> > > > R-sig-Geo mailing list
>>>> > > > R-sig-Geo at r-project.org
>>>> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> > >
>>>> > > --
>>>> > > Roger Bivand
>>>> > > Department of Economics, Norwegian School of Economics,
>>>> > > Helleveien 30, N-5045 Bergen, Norway.
>>>> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>> > > e-mail: Roger.Bivand at nhh.no
>>>> > > http://orcid.org/0000-0003-2392-6140
>>>> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>> > > http://depsy.org/person/434412
>>>> > > _______________________________________________
>>>> > > R-sig-Geo mailing list
>>>> > > R-sig-Geo at r-project.org
>>>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >
>>>> > --
>>>> > Dr. Michael Sumner
>>>> > Software and Database Engineer
>>>> > Australian Antarctic Division
>>>> > 203 Channel Highway
>>>> > Kingston Tasmania 7050 Australia
>>>> >
>>>> >         [[alternative HTML version deleted]]
>>>> >
>>>> > _______________________________________________
>>>> > R-sig-Geo mailing list
>>>> > R-sig-Geo at r-project.org
>>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >
>>>>
>>>>
>>>>
>>>> --
>>>> Agust?n Camacho Guerrero.
>>>> Doutor em Zoologia.
>>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>>> Bioci?ncias, USP.
>>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>> --
>> Dr. Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> 203 Channel Highway
>> Kingston Tasmania 7050 Australia
>>
>>
>
>
> --
> Agust?n Camacho Guerrero.
> Doutor em Zoologia.
> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> Bioci?ncias, USP.
> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> S?o Paulo - SP, CEP: 05508-090, Brasil.
>

	[[alternative HTML version deleted]]


From agus.camacho at gmail.com  Wed Feb 24 05:12:32 2016
From: agus.camacho at gmail.com (Agus Camacho)
Date: Tue, 23 Feb 2016 21:12:32 -0700
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
Message-ID: <CALsJ7pSiAkuiQj5L3QYQrSv9iXr0siJ0F5jjWeQ+EbMVRsb6WA@mail.gmail.com>

With the help of everybody i finally got this to work, so here is a script
that does the job of reprojecting both, a raster layer obtained from a .nc
and some locations in order to overplot them using plot.raster or mapview.
Im using a combination of the advices of Dominik, Michael and Chris.


require(ncdf4)
require(raster)


setwd("C:/~")


r=raster("geo_em.d01.nc",
              varname="dctmx")# days of ctmax events

# Set extent and projections of rasters for plotting
# chris gave me the orig data fom the nc file because i could not install
gdal
xmin= -3545999
xmax= 3546000
ymin = -2286000
ymax=2286000
pr<- "+proj=lcc +lat_1=25 +lat_2=45 +lat_0=38.000008 +lon_0=-100 +x_0=0
+y_0=0"

wrfLccExt<-extent(xmin,xmax,ymin,ymax)

extent(r) <- extent(wrfLccExt)
projection(r) <- pr

# get and prepare  urosaurus locations

x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
x=x[,1:3]
colnames(x)
coordinates(x)=~lon+lat
proj4string(x)<- CRS("+proj=longlat +datum=WGS84")
x=spTransform(x, pr)


# get prepare and plot wrld_simpl
require(maptools)
require(sp)
data(wrld_simpl)
namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
"Canada", "Mexico")), prj)

#plot with raster
plot(r, cex.main=.7,legend=F)
points(x)
plot(namer, add = TRUE)

# plot with mapview (cool!)
m=mapview(r)
u=mapview(x)
m+u


Thanks to all!
Agus

2016-02-23 13:11 GMT-07:00 Agus Camacho <agus.camacho at gmail.com>:

> Thanks for that Dominik,
>
> Giving that projection to either the locations, the raster layer generated
> from the .nc file, or both, still did not work. I keep having locations
> that should be on land falling far on the sea. Might this be a problem
> derived from using raster with a file whose original grid distances are not
> constant?
>
> Here is a link with the original file which has the original coordinate
> data.
>
> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>
>
> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
> Dominik.Schneider at colorado.edu>:
>
>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>> dealt with this.
>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>> +a=6370000 +b=6370000 +units=m
>>
>> +proj=lcc which is usually what wrf is run with.
>> The tricky part is:
>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> because every WRF run is different (the WRF Preprocessing System
>> optimizes the projection for the domain).
>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>
>> This gives:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> But, wrf users like to give out lat and  long so you need to assign it:
>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> and then reproject the lat/long to lcc coordinates using this string:
>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>
>> One word of caution, make sure you received the correct coordinates. Some
>> variables are run cell center while some are run at cell edge. It looks
>> like from your .nc file it was made by your collaborator so I assume they
>> are right.
>>
>> That said, another word of caution, I found that the XLAT and XLONG
>> variables from WRF output aren't very precise. There is a "geogrid" file
>> from the preprocessing system that has the domain corners, resolution, nrow
>> and ncol from which you can make a better grid using the native projection
>> system (in my case it was a 4km grid). I suggest you try to get those.
>>
>> I hope this helps... I have to run but wanted to save people too much
>> head scratching. I can get you running with more help tonight if you need.
>> Dominik
>>
>>
>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>> wrote:
>>
>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>>> more giant crab this time.
>>>
>>> The creator of the .nc file also looked at this webpage:
>>> http://www.pkrc.net/wrf-lambert.html
>>> It seemed like the right proj4 string might be this one:
>>>
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>     +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>
>>> However this projection also does not allow me to adequately plot the
>>> locations on the raster.
>>>
>>> Here is the .nc file. it contains several layers.
>>>
>>>
>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>
>>>
>>>
>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>
>>> > On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>> >
>>> > > On Tue, 23 Feb 2016, Alex Mandel wrote:
>>> > >
>>> > > > I made an attempt at it too. Investigating the original data, I'm
>>> not
>>> > > > sure that the projection information supplied is correct for the
>>> data
>>> > > > linked. When I load up the data in a unprojected space, the
>>> coordinates
>>> > > > don't look at all similar to any Lambert projected data I have,
>>> they
>>> > > > actually look like Lat/Lon in some unprojected coordinate system,
>>> > > > perhaps a different spheroid than expected.
>>> > >
>>> > > Does anyone have a link to the original data? Is is possible that
>>> this is
>>> > > the General Oblique Transformation used by modellers - that is
>>> something
>>> > > that feels like longlat but is recentred and oblique? Example at the
>>> very
>>> > > end of my GEOSTAT talk last year (slides 81-83):
>>> > >
>>> > > http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>> > >
>>> > > Roger
>>> > >
>>> > >
>>> > For what it is worth, the General Oblique Transformation is not the
>>> only
>>> > example - it's very common for modellers to have a mesh that has the
>>> > "mostly-properties" of a projection, but is not actually describable
>>> with
>>> > standard transform + affine parameters. The main cases that I've seen
>>> are
>>> > polar stereographic, equal area or oblique Mercator. Often they really
>>> are
>>> > simple transforms and you can reconstruct without loss, but it's not
>>> > usually possible to tell without exploration. It's an interesting
>>> > dis-connect to see code that builds a mesh with certain properties,
>>> then
>>> > only stores longitudes and latitudes - when it could be done with
>>> standard
>>> > tools and be stored and used much more efficiently.
>>> >
>>> > (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>> > terminology conflated in this context too. )
>>> >
>>> > I'm also interested to explore the original data.
>>> >
>>> > Cheers, Mike.
>>> >
>>> >
>>> >
>>> > > >
>>> > > > -Alex
>>> > > >
>>> > > > On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>> > > >> Hi
>>> > > >>
>>> > > >> I tried to make it work but I had to give up. I wanted to
>>> reproject
>>> > the
>>> > > Lamberth conformal conic coordinates to long-lat but it didn't work.
>>> > > >>
>>> > > >> Perhaps someone can see what I did wrong. Here is what I did
>>> (data in
>>> > R
>>> > > binary format and figure in png format both attached):
>>> > > >>
>>> > > >> library(raster)
>>> > > >> library(maptools)
>>> > > >> data(wrld_simpl)
>>> > > >>
>>> > > >> r <- raster("raster.grd")
>>> > > >> projection(r)
>>> > > >> ## > NA
>>> > > >>
>>> > > >> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>> ",")
>>> > > >> coordinates(uro) <- ~lon+lat
>>> > > >>
>>> > > >> ## Set projections for the 3 data sets
>>> > > >>
>>> > > >> ## Lamberth's confocal conic projection with given parameters
>>> > > >> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>> +lat_2=45.0
>>> > > +ellps=WGS84"
>>> > > >> projection(r)
>>> > > >>
>>> > > >> ## Assume that lon, lat are geographical coordinates (degrees
>>> decimal)
>>> > > >> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>> > > >>
>>> > > >> ## wrld_simpl is in geographical coordinates
>>> > > >> proj4string(wrld_simpl)
>>> > > >>
>>> > > >> ## Make figure in png format
>>> > > >> ## Of course plotting data with 2 different projections will give
>>> > > >> ## some distortions
>>> > > >> pdf("uro.png")
>>> > > >>
>>> > > >> plot(r)
>>> > > >> points(uro)
>>> > > >> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>> 'r'
>>> > > >>
>>> > > >> dev.off()
>>> > > >>
>>> > > >> extent(r)
>>> > > >> ## class       : Extent
>>> > > >> ## xmin        : -131.4368
>>> > > >> ## xmax        : -68.56323
>>> > > >> ## ymin        : 12.35567
>>> > > >> ## ymax        : 50.26619
>>> > > >>
>>> > > >> ## Reproject the raster to long-lat
>>> > > >> ## This doesn't work (collapsed domain)
>>> > > >> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>> > > +ellps=WGS84 +towgs84=0,0,0")
>>> > > >>
>>> > > >> ## Because
>>> > > >>> extent(rp)
>>> > > >> ## class       : Extent
>>> > > >> ## xmin        : -100.0015
>>> > > >> ## xmax        : -99.68557
>>> > > >> ## ymin        : 37.70658
>>> > > >> ## ymax        : 38.00046
>>> > > >>
>>> > > >> ## Save data in R binary format
>>> > > >> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>> > > >>
>>> > > >>
>>> > > >> Yours sincerely / Med venlig hilsen
>>> > > >>
>>> > > >> Frede Aakmann T?gersen
>>> > > >> Specialist, M.Sc., Ph.D.
>>> > > >> Plant Performance & Modeling
>>> > > >>
>>> > > >> Technology & Service Solutions
>>> > > >> T +45 9730 5135
>>> > > >> M +45 2547 6050
>>> > > >> frtog at vestas.com
>>> > > >> http://www.vestas.com
>>> > > >>
>>> > > >> Company reg. name: Vestas Wind Systems A/S
>>> > > >> This e-mail is subject to our e-mail disclaimer statement.
>>> > > >> Please refer to www.vestas.com/legal/notice
>>> > > >> If you have received this e-mail in error please contact the
>>> sender.
>>> > > >>
>>> > > >>
>>> > > >>
>>> > > >> -----Original Message-----
>>> > > >> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>> Behalf Of
>>> > > Agus Camacho
>>> > > >> Sent: 22. februar 2016 19:20
>>> > > >> To: tech at wildintellect.com
>>> > > >> Cc: r-sig-geo
>>> > > >> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to
>>> a
>>> > > reference system implicit in a .nc file
>>> > > >>
>>> > > >> Thanks Alex, but the locations still fall in the sea when i plot
>>> them
>>> > > using
>>> > > >> your recommended Solution. I looked at the sites you proposed and
>>> they
>>> > > have
>>> > > >> other values for lat_1, lat_0, etc..
>>> > > >>
>>> > > >> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>> > > >>
>>> > > >>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>> > > >>>> Dear all,
>>> > > >>>>
>>> > > >>>> Im trying to overlap these points:
>>> > > >>>>
>>> > > >>>
>>> > >
>>> >
>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>> > > >>>>
>>> > > >>>> and a wrld_simpl object:
>>> > > >>>> library(maptools)
>>> > > >>>> data(wrld_simpl)
>>> > > >>>>
>>> > > >>>> Over this raster layer
>>> > > >>>>
>>> > > >>>
>>> > >
>>> >
>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>> > > >>>>
>>> > > >>>> This rastr comes from a .nc file without a reference system. The
>>> > > author
>>> > > >>> of
>>> > > >>>> that .nc file gave me the following data about the .nc.
>>> > > >>>>
>>> > > >>>> The projection is *Lambert conformal conic* projection
>>> > > >>>> CEN_LAT = 38.0
>>> > > >>>> CEN_LON = -100.0
>>> > > >>>> TRUELAT1 = 25.
>>> > > >>>> TRUELAT2 = 45.
>>> > > >>>>
>>> > > >>>> However, despite i have gone through many sites in the
>>> internet, i
>>> > > cant
>>> > > >>>> figure it out:
>>> > > >>>>
>>> > > >>>> a) if that is all the data i need to set a reference system for
>>> my
>>> > > points
>>> > > >>>> and the wrld_simp object.
>>> > > >>>>
>>> > > >>>> b) how to change a typical CRS object with such data
>>> > > >>>>
>>> > > >>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>> > > >>>>
>>> > > >>>> Where do i enter the TRUELAT and CENLAT values?
>>> > > >>>> Are there any site that explains easily what the fields in the
>>> CRS
>>> > > mean
>>> > > >>> and
>>> > > >>>> how to change them?
>>> > > >>>>
>>> > > >>>> Thanks in advance.
>>> > > >>>>
>>> > > >>>
>>> > > >>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>> > > >>> https://trac.osgeo.org/proj/wiki/GenParms
>>> > > >>>
>>> > > >>> I believe:
>>> > > >>> +lat_0  = CEN_LAT   Latitude of origin
>>> > > >>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>> > > >>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>> > > >>> +lon_0  = CEN_LON   Central meridian
>>> > > >>>
>>> > > >>> proj strings are defined by the proj4 libary. It's website listed
>>> > above
>>> > > >>> and the associated mailing lists or gis stackexchange would be
>>> the
>>> > > >>> places to get help on it.
>>> > > >>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>> > > >>>
>>> > > >>> It often helps to browse similar projections on
>>> > > >>> http://spatialreference.org/
>>> > > >>> http://epsg.io/
>>> > > >>>
>>> > > >>> Enjoy,
>>> > > >>> Alex
>>> > > >>>
>>> > > >>>
>>> > > >>
>>> > > >>
>>> > > >
>>> > > > _______________________________________________
>>> > > > R-sig-Geo mailing list
>>> > > > R-sig-Geo at r-project.org
>>> > > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> > >
>>> > > --
>>> > > Roger Bivand
>>> > > Department of Economics, Norwegian School of Economics,
>>> > > Helleveien 30, N-5045 Bergen, Norway.
>>> > > voice: +47 55 95 93 55; fax +47 55 95 91 00
>>> > > e-mail: Roger.Bivand at nhh.no
>>> > > http://orcid.org/0000-0003-2392-6140
>>> > > https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>> > > http://depsy.org/person/434412
>>> > > _______________________________________________
>>> > > R-sig-Geo mailing list
>>> > > R-sig-Geo at r-project.org
>>> > > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>> > --
>>> > Dr. Michael Sumner
>>> > Software and Database Engineer
>>> > Australian Antarctic Division
>>> > 203 Channel Highway
>>> > Kingston Tasmania 7050 Australia
>>> >
>>> >         [[alternative HTML version deleted]]
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>>
>>>
>>>
>>> --
>>> Agust?n Camacho Guerrero.
>>> Doutor em Zoologia.
>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>> Bioci?ncias, USP.
>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>
>
> --
> Agust?n Camacho Guerrero.
> Doutor em Zoologia.
> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> Bioci?ncias, USP.
> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> S?o Paulo - SP, CEP: 05508-090, Brasil.
>



-- 
Agust?n Camacho Guerrero.
Doutor em Zoologia.
Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
Bioci?ncias, USP.
Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
S?o Paulo - SP, CEP: 05508-090, Brasil.

	[[alternative HTML version deleted]]


From reudenbach at uni-marburg.de  Wed Feb 24 09:36:22 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Wed, 24 Feb 2016 09:36:22 +0100
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CALsJ7pSiAkuiQj5L3QYQrSv9iXr0siJ0F5jjWeQ+EbMVRsb6WA@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<CALsJ7pSiAkuiQj5L3QYQrSv9iXr0siJ0F5jjWeQ+EbMVRsb6WA@mail.gmail.com>
Message-ID: <56CD6B86.5090605@uni-marburg.de>

Agus,

sorry for the addon but I think I have to provide a correction of the 
corner coordinates (e.g. the extent values):

In the example that you have posted below I did calculate the extent 
using the domain center coordinate and the WRF grid resolution in meter 
and the number of rows and cols.

Since Dominik provides a link to the file description of the netcdf file 
I think it is more accurate to reproject the  corner coordinates  as 
given by the netcdf header variables (NC_GLOBAL#corner_lats, 
NC_GLOBAL#corner_lons). Assuming that your variable "dctmx" (which I can 
not identfy it in the nc file)  is of type "Mass" (staggered = M) the 
correct corner coordinates are stored as the first 4 entrys of the dump 
snippet below:

lats<-" 
NC_GLOBAL#corner_lats={12.355667,50.26619,50.26619,12.355667,12.308136,50.18787,50.18787,12.308136,12.210785,50.403816,50.403816,12.210785,12.163345,50.325382,50.325382,12.163345}" 

lons<-" 
NC_GLOBAL#corner_lons={-131.43678,-151.29639,-48.703613,-68.563232,-131.5851,-151.51157,-48.488434,-68.414917,-131.38828,-151.41891,-48.581085,-68.611725,-131.53641,-151.63441,-48.36557,-68.463593}"

after cleaning and converting the strings you may calculate the corner 
coordinates:


library(proj4)
## project mass corner coordinates to lambertian
llMass <- ptransform(cbind(clon[1],clat[1])/180*pi,'+proj=longlat 
+datum=WGS84 +no_defs',proj)
ulMass <- ptransform(cbind(clon[2],clat[2])/180*pi,'+proj=longlat 
+datum=WGS84 +no_defs',proj)
lrMass <- ptransform(cbind(clon[3],clat[3])/180*pi,'+proj=longlat 
+datum=WGS84 +no_defs',proj)
urMass <- ptransform(cbind(clon[4],clat[4])/180*pi,'+proj=longlat 
+datum=WGS84 +no_defs',proj)
wrfLccExtMass<-extent(ulMass[1],lrMass[1],llMass[2],ulMass[2])


According to this the correct extent for mass variables should be:

extent(wrfLccExtMass)
class       : Extent
xmin        : -3575343
xmax        : 3575342
ymin        : -2293058
ymax        : 2306330


hope this is correct now

cheers Chris

Am 24.02.2016 um 05:12 schrieb Agus Camacho:
> With the help of everybody i finally got this to work, so here is a script
> that does the job of reprojecting both, a raster layer obtained from a .nc
> and some locations in order to overplot them using plot.raster or mapview.
> Im using a combination of the advices of Dominik, Michael and Chris.
>
>
> require(ncdf4)
> require(raster)
>
>
> setwd("C:/~")
>
>
> r=raster("geo_em.d01.nc",
>                varname="dctmx")# days of ctmax events
>
> # Set extent and projections of rasters for plotting
> # chris gave me the orig data fom the nc file because i could not install
> gdal
> xmin= -3545999
> xmax= 3546000
> ymin = -2286000
> ymax=2286000
> pr<- "+proj=lcc +lat_1=25 +lat_2=45 +lat_0=38.000008 +lon_0=-100 +x_0=0
> +y_0=0"
>
> wrfLccExt<-extent(xmin,xmax,ymin,ymax)
>
> extent(r) <- extent(wrfLccExt)
> projection(r) <- pr
>
> # get and prepare  urosaurus locations
>
> x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
> Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
> x=x[,1:3]
> colnames(x)
> coordinates(x)=~lon+lat
> proj4string(x)<- CRS("+proj=longlat +datum=WGS84")
> x=spTransform(x, pr)
>
>
> # get prepare and plot wrld_simpl
> require(maptools)
> require(sp)
> data(wrld_simpl)
> namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
> "Canada", "Mexico")), prj)
>
> #plot with raster
> plot(r, cex.main=.7,legend=F)
> points(x)
> plot(namer, add = TRUE)
>
> # plot with mapview (cool!)
> m=mapview(r)
> u=mapview(x)
> m+u
>
>
> Thanks to all!
> Agus
>
> 2016-02-23 13:11 GMT-07:00 Agus Camacho <agus.camacho at gmail.com>:
>
>> Thanks for that Dominik,
>>
>> Giving that projection to either the locations, the raster layer generated
>> from the .nc file, or both, still did not work. I keep having locations
>> that should be on land falling far on the sea. Might this be a problem
>> derived from using raster with a file whose original grid distances are not
>> constant?
>>
>> Here is a link with the original file which has the original coordinate
>> data.
>>
>> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>>
>>
>> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
>> Dominik.Schneider at colorado.edu>:
>>
>>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>>> dealt with this.
>>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>>> +a=6370000 +b=6370000 +units=m
>>>
>>> +proj=lcc which is usually what wrf is run with.
>>> The tricky part is:
>>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> because every WRF run is different (the WRF Preprocessing System
>>> optimizes the projection for the domain).
>>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>>>
>>> This gives:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> But, wrf users like to give out lat and  long so you need to assign it:
>>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> and then reproject the lat/long to lcc coordinates using this string:
>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>>>
>>> One word of caution, make sure you received the correct coordinates. Some
>>> variables are run cell center while some are run at cell edge. It looks
>>> like from your .nc file it was made by your collaborator so I assume they
>>> are right.
>>>
>>> That said, another word of caution, I found that the XLAT and XLONG
>>> variables from WRF output aren't very precise. There is a "geogrid" file
>>> from the preprocessing system that has the domain corners, resolution, nrow
>>> and ncol from which you can make a better grid using the native projection
>>> system (in my case it was a 4km grid). I suggest you try to get those.
>>>
>>> I hope this helps... I have to run but wanted to save people too much
>>> head scratching. I can get you running with more help tonight if you need.
>>> Dominik
>>>
>>>
>>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com>
>>> wrote:
>>>
>>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill bring
>>>> more giant crab this time.
>>>>
>>>> The creator of the .nc file also looked at this webpage:
>>>> http://www.pkrc.net/wrf-lambert.html
>>>> It seemed like the right proj4 string might be this one:
>>>>
>>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>>>>
>>>> However this projection also does not allow me to adequately plot the
>>>> locations on the raster.
>>>>
>>>> Here is the .nc file. it contains several layers.
>>>>
>>>>
>>>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>>>>
>>>>
>>>>
>>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>>>>
>>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no> wrote:
>>>>>
>>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>>>>>>
>>>>>>> I made an attempt at it too. Investigating the original data, I'm
>>>> not
>>>>>>> sure that the projection information supplied is correct for the
>>>> data
>>>>>>> linked. When I load up the data in a unprojected space, the
>>>> coordinates
>>>>>>> don't look at all similar to any Lambert projected data I have,
>>>> they
>>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>>>>>>> perhaps a different spheroid than expected.
>>>>>> Does anyone have a link to the original data? Is is possible that
>>>> this is
>>>>>> the General Oblique Transformation used by modellers - that is
>>>> something
>>>>>> that feels like longlat but is recentred and oblique? Example at the
>>>> very
>>>>>> end of my GEOSTAT talk last year (slides 81-83):
>>>>>>
>>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>>>>>>
>>>>>> Roger
>>>>>>
>>>>>>
>>>>> For what it is worth, the General Oblique Transformation is not the
>>>> only
>>>>> example - it's very common for modellers to have a mesh that has the
>>>>> "mostly-properties" of a projection, but is not actually describable
>>>> with
>>>>> standard transform + affine parameters. The main cases that I've seen
>>>> are
>>>>> polar stereographic, equal area or oblique Mercator. Often they really
>>>> are
>>>>> simple transforms and you can reconstruct without loss, but it's not
>>>>> usually possible to tell without exploration. It's an interesting
>>>>> dis-connect to see code that builds a mesh with certain properties,
>>>> then
>>>>> only stores longitudes and latitudes - when it could be done with
>>>> standard
>>>>> tools and be stored and used much more efficiently.
>>>>>
>>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>>>>> terminology conflated in this context too. )
>>>>>
>>>>> I'm also interested to explore the original data.
>>>>>
>>>>> Cheers, Mike.
>>>>>
>>>>>
>>>>>
>>>>>>> -Alex
>>>>>>>
>>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>>>>>>>> Hi
>>>>>>>>
>>>>>>>> I tried to make it work but I had to give up. I wanted to
>>>> reproject
>>>>> the
>>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
>>>>>>>> Perhaps someone can see what I did wrong. Here is what I did
>>>> (data in
>>>>> R
>>>>>> binary format and figure in png format both attached):
>>>>>>>> library(raster)
>>>>>>>> library(maptools)
>>>>>>>> data(wrld_simpl)
>>>>>>>>
>>>>>>>> r <- raster("raster.grd")
>>>>>>>> projection(r)
>>>>>>>> ## > NA
>>>>>>>>
>>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>>>> ",")
>>>>>>>> coordinates(uro) <- ~lon+lat
>>>>>>>>
>>>>>>>> ## Set projections for the 3 data sets
>>>>>>>>
>>>>>>>> ## Lamberth's confocal conic projection with given parameters
>>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>>>> +lat_2=45.0
>>>>>> +ellps=WGS84"
>>>>>>>> projection(r)
>>>>>>>>
>>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>>>> decimal)
>>>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>>>>>>>>
>>>>>>>> ## wrld_simpl is in geographical coordinates
>>>>>>>> proj4string(wrld_simpl)
>>>>>>>>
>>>>>>>> ## Make figure in png format
>>>>>>>> ## Of course plotting data with 2 different projections will give
>>>>>>>> ## some distortions
>>>>>>>> pdf("uro.png")
>>>>>>>>
>>>>>>>> plot(r)
>>>>>>>> points(uro)
>>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>>>> 'r'
>>>>>>>> dev.off()
>>>>>>>>
>>>>>>>> extent(r)
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -131.4368
>>>>>>>> ## xmax        : -68.56323
>>>>>>>> ## ymin        : 12.35567
>>>>>>>> ## ymax        : 50.26619
>>>>>>>>
>>>>>>>> ## Reproject the raster to long-lat
>>>>>>>> ## This doesn't work (collapsed domain)
>>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>>>>>> +ellps=WGS84 +towgs84=0,0,0")
>>>>>>>> ## Because
>>>>>>>>> extent(rp)
>>>>>>>> ## class       : Extent
>>>>>>>> ## xmin        : -100.0015
>>>>>>>> ## xmax        : -99.68557
>>>>>>>> ## ymin        : 37.70658
>>>>>>>> ## ymax        : 38.00046
>>>>>>>>
>>>>>>>> ## Save data in R binary format
>>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>>>>>>>>
>>>>>>>>
>>>>>>>> Yours sincerely / Med venlig hilsen
>>>>>>>>
>>>>>>>> Frede Aakmann T?gersen
>>>>>>>> Specialist, M.Sc., Ph.D.
>>>>>>>> Plant Performance & Modeling
>>>>>>>>
>>>>>>>> Technology & Service Solutions
>>>>>>>> T +45 9730 5135
>>>>>>>> M +45 2547 6050
>>>>>>>> frtog at vestas.com
>>>>>>>> http://www.vestas.com
>>>>>>>>
>>>>>>>> Company reg. name: Vestas Wind Systems A/S
>>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>>>>>>>> Please refer to www.vestas.com/legal/notice
>>>>>>>> If you have received this e-mail in error please contact the
>>>> sender.
>>>>>>>>
>>>>>>>>
>>>>>>>> -----Original Message-----
>>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>>>> Behalf Of
>>>>>> Agus Camacho
>>>>>>>> Sent: 22. februar 2016 19:20
>>>>>>>> To: tech at wildintellect.com
>>>>>>>> Cc: r-sig-geo
>>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to
>>>> a
>>>>>> reference system implicit in a .nc file
>>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>>>> them
>>>>>> using
>>>>>>>> your recommended Solution. I looked at the sites you proposed and
>>>> they
>>>>>> have
>>>>>>>> other values for lat_1, lat_0, etc..
>>>>>>>>
>>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>>>>>>>>
>>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>>>>>>>>>> Dear all,
>>>>>>>>>>
>>>>>>>>>> Im trying to overlap these points:
>>>>>>>>>>
>>>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>>>>>>>>>> and a wrld_simpl object:
>>>>>>>>>> library(maptools)
>>>>>>>>>> data(wrld_simpl)
>>>>>>>>>>
>>>>>>>>>> Over this raster layer
>>>>>>>>>>
>>>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>>>>>>>>>> This rastr comes from a .nc file without a reference system. The
>>>>>> author
>>>>>>>>> of
>>>>>>>>>> that .nc file gave me the following data about the .nc.
>>>>>>>>>>
>>>>>>>>>> The projection is *Lambert conformal conic* projection
>>>>>>>>>> CEN_LAT = 38.0
>>>>>>>>>> CEN_LON = -100.0
>>>>>>>>>> TRUELAT1 = 25.
>>>>>>>>>> TRUELAT2 = 45.
>>>>>>>>>>
>>>>>>>>>> However, despite i have gone through many sites in the
>>>> internet, i
>>>>>> cant
>>>>>>>>>> figure it out:
>>>>>>>>>>
>>>>>>>>>> a) if that is all the data i need to set a reference system for
>>>> my
>>>>>> points
>>>>>>>>>> and the wrld_simp object.
>>>>>>>>>>
>>>>>>>>>> b) how to change a typical CRS object with such data
>>>>>>>>>>
>>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>>>>>>>>>>
>>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>>>>>>>>>> Are there any site that explains easily what the fields in the
>>>> CRS
>>>>>> mean
>>>>>>>>> and
>>>>>>>>>> how to change them?
>>>>>>>>>>
>>>>>>>>>> Thanks in advance.
>>>>>>>>>>
>>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>>>>>>>>>
>>>>>>>>> I believe:
>>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>>>>>>>>> +lon_0  = CEN_LON   Central meridian
>>>>>>>>>
>>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
>>>>> above
>>>>>>>>> and the associated mailing lists or gis stackexchange would be
>>>> the
>>>>>>>>> places to get help on it.
>>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>>>>>>>>>
>>>>>>>>> It often helps to browse similar projections on
>>>>>>>>> http://spatialreference.org/
>>>>>>>>> http://epsg.io/
>>>>>>>>>
>>>>>>>>> Enjoy,
>>>>>>>>> Alex
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> R-sig-Geo mailing list
>>>>>>> R-sig-Geo at r-project.org
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>> --
>>>>>> Roger Bivand
>>>>>> Department of Economics, Norwegian School of Economics,
>>>>>> Helleveien 30, N-5045 Bergen, Norway.
>>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>>>>>> e-mail: Roger.Bivand at nhh.no
>>>>>> http://orcid.org/0000-0003-2392-6140
>>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>>>>>> http://depsy.org/person/434412
>>>>>> _______________________________________________
>>>>>> R-sig-Geo mailing list
>>>>>> R-sig-Geo at r-project.org
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>> --
>>>>> Dr. Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> 203 Channel Highway
>>>>> Kingston Tasmania 7050 Australia
>>>>>
>>>>>          [[alternative HTML version deleted]]
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>>
>>>>
>>>> --
>>>> Agust?n Camacho Guerrero.
>>>> Doutor em Zoologia.
>>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>>>> Bioci?ncias, USP.
>>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>>>
>>>>          [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>
>> --
>> Agust?n Camacho Guerrero.
>> Doutor em Zoologia.
>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>> Bioci?ncias, USP.
>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>>
>
>


From tyatabe at ucdavis.edu  Tue Feb 23 21:22:26 2016
From: tyatabe at ucdavis.edu (Tadaishi Yatabe-Rodriguez)
Date: Tue, 23 Feb 2016 12:22:26 -0800
Subject: [R-sig-Geo] Multiplying a raster object
Message-ID: <CAMtcdVjEdxZbcaU8VcMeu2jJ2bEb4mV20=ZGJHEJ=bFqq8yosw@mail.gmail.com>

Hi community,

I have a raster object of a kernel density, where the linear unit is meter,
and when I plot it it gives me very small density values (units per sq
meter, I suppose). I figure that if I multiply it, say by a 1000, it will
give density values in units per sq km. It looks good on the legend, but I
wonder: is this a correct thing to do? I wonder this because when I add the
values of the raster it does not add up to the number of points in my
original ppp object from which I created the density.

Thanks,

Tada

-- 
*Tadaishi Yatabe*
DVM, MPVM, PhD (C)
Center for Animal Disease Modeling and Surveillance (CADMS)
Department of Medicine and Epidemiology
School of Veterinary Medicine
University of California Davis

http://tadaishi.wix.com/tada

	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Wed Feb 24 13:56:17 2016
From: loic.dutrieux at wur.nl (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Wed, 24 Feb 2016 13:56:17 +0100
Subject: [R-sig-Geo] Multiplying a raster object
In-Reply-To: <CAMtcdVjEdxZbcaU8VcMeu2jJ2bEb4mV20=ZGJHEJ=bFqq8yosw@mail.gmail.com>
References: <CAMtcdVjEdxZbcaU8VcMeu2jJ2bEb4mV20=ZGJHEJ=bFqq8yosw@mail.gmail.com>
Message-ID: <56CDA871.60101@wur.nl>



On 02/23/2016 09:22 PM, Tadaishi Yatabe-Rodriguez wrote:
> Hi community,
>
> I have a raster object of a kernel density, where the linear unit is meter,
> and when I plot it it gives me very small density values (units per sq
> meter, I suppose). I figure that if I multiply it, say by a 1000, it will
> give density values in units per sq km.

I don't know much about kernel densities, but if you want to convert 
units/m^2 to units/km^2 you'd have to multiply by 1 000 000 instead of 
1000. Hope that helps explaining the incoherence in your results.

> It looks good on the legend, but I
> wonder: is this a correct thing to do? I wonder this because when I add the
> values of the raster it does not add up to the number of points in my
> original ppp object from which I created the density.
>
> Thanks,
>
> Tada
>


From alobolistas at gmail.com  Wed Feb 24 18:26:28 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Wed, 24 Feb 2016 18:26:28 +0100
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
Message-ID: <CAG4NRe+WCmztmiiXCxT=WZ3-gppFjJFrV4QJcSUi+Ypi-sqXzw@mail.gmail.com>

Hi!

When I make an insetMap for an small country, I get a very
uggly "X" marking its position:

require(rgdal)
require(raster)
require(mapmisc)
nica <- getData("GADM", country="NIC", level=0)
nicabg <- openmap(nica, path="landscape")
map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
plot(nicabg,axes=TRUE)
plot(nica,add=TRUE)
insetMap(nica,"bottomleft", width=0.3)

is there a way to set another symbol or at least making it smaller?

Also, despite the help page says that
"Additional arguments passed to legend" are accepted, I do not find
any to actually work.
For example, cannot set the exact values of x,y for positioning the
inset map. And cannot use locate() to put it wherever I want to.

Thanks

Agus


From johnbaums at gmail.com  Thu Feb 25 00:36:53 2016
From: johnbaums at gmail.com (John Baumgartner)
Date: Thu, 25 Feb 2016 10:36:53 +1100
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
In-Reply-To: <CAG4NRe+WCmztmiiXCxT=WZ3-gppFjJFrV4QJcSUi+Ypi-sqXzw@mail.gmail.com>
References: <CAG4NRe+WCmztmiiXCxT=WZ3-gppFjJFrV4QJcSUi+Ypi-sqXzw@mail.gmail.com>
Message-ID: <CACpmSOtAFKDwS-Ph=yNag-YHrwNJELM7rg=F6_xxL_mMwg2+Sg@mail.gmail.com>

On Thu, Feb 25, 2016 at 4:26 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>
> Hi!
>
> When I make an insetMap for an small country, I get a very
> uggly "X" marking its position:
>
> require(rgdal)
> require(raster)
> require(mapmisc)
> nica <- getData("GADM", country="NIC", level=0)
> nicabg <- openmap(nica, path="landscape")
> map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
> plot(nicabg,axes=TRUE)
> plot(nica,add=TRUE)
> insetMap(nica,"bottomleft", width=0.3)
>
> is there a way to set another symbol or at least making it smaller?

Not quite what you asked for, but you could try TeachingDemos::subplots,
which you might find to be a little more flexible.

E.g.

library(TeachingDemos)
library(rgdal)

download.file(file.path('http://www.naturalearthdata.com/http/',
                        'www.naturalearthdata.com/download/110m/physical',
                        'ne_110m_land.zip'), f <- tempfile())
unzip(f, exdir=tempdir())
world <- readOGR(tempdir(), 'ne_110m_land')

plot(nica, col='gray90', border='black', axes=TRUE, xlim=c(-88, -81.5))
subplot({
  plot(world, col=1, xlim=c(-120, 30), ylim=c(-30, 40))
  box()
  points(coordinates(nica), pch=20, cex=2, col='red')
}, 'bottomright', inset=c(0.01, 0.01), size=c(1, 1))

>
> Also, despite the help page says that
> "Additional arguments passed to legend" are accepted, I do not find
> any to actually work.
> For example, cannot set the exact values of x,y for positioning the
> inset map. And cannot use locate() to put it wherever I want to.

The "additional arguments" are for scaleBar, which is also documented
at ?insetMap.
Note that there is no ellipsis (...) arg for insetMap.

>
> Thanks
>
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mathieu.rajerison at gmail.com  Thu Feb 25 11:39:20 2016
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 25 Feb 2016 11:39:20 +0100
Subject: [R-sig-Geo] igraph and spatial
In-Reply-To: <CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
References: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
	<CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
Message-ID: <CAGfc75nVOKK=_yptaEpM6+bqyX1ePUxc_ZbUXEOT=zkeHdfmiw@mail.gmail.com>

Hi,

Recently, I used igraph with spatial objects.

Once you have the coordinates of the nodes composing an edge, you can
transform it into a spatiallines object with this function :

makeLineFromCoords <- function(coords, i) {
  Sl1 = Line(coords)
  S1 = Lines(list(Sl1), ID=as.character(i))
  Sl = SpatialLines(list(S1))
  return(Sl)
}

For all the routing stuff within R, this resource by B. Rowlingson is quite
inspiring :
http://rstudio-pubs-static.s3.amazonaws.com/1572_7599552b60454033a0d5c5e6d2e34ffb.html

best,

Mathieu

2016-02-22 9:30 GMT+01:00 Michael Sumner <mdsumner at gmail.com>:

> On Mon, 22 Feb 2016 at 19:13 Luca Candeloro <luca.candeloro at gmail.com>
> wrote:
>
> > Dear all,
> > plotting graphs with given vertex coordinates is possible inside igraph
> > plot function.
> > I would like to transform vilsualized edges into SpatialLinesDataFrame,
> so
> > that they could be exported in .shp file...
> > Any suggestion?
> >
>
> Can you please provide a working igraph example that we can start with?
>
> Do you want coordinates as seen in a particular plot, or can it be more
> arbitrary?
>
> Cheers, Mike.
>
>
>
> > thanks in advance,
> > Luca
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>

	[[alternative HTML version deleted]]


From mathieu.rajerison at gmail.com  Thu Feb 25 11:55:00 2016
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 25 Feb 2016 11:55:00 +0100
Subject: [R-sig-Geo] igraph and spatial
In-Reply-To: <CAHF6YnmZiJZtVgbbjLzFcyYDSpOPp00sgQyvOqc+tywiJEcv7w@mail.gmail.com>
References: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
	<CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
	<CAGfc75nVOKK=_yptaEpM6+bqyX1ePUxc_ZbUXEOT=zkeHdfmiw@mail.gmail.com>
	<CAHF6YnmZiJZtVgbbjLzFcyYDSpOPp00sgQyvOqc+tywiJEcv7w@mail.gmail.com>
Message-ID: <CAGfc75kr6n1qNZUb6FYdyqUtsZ6QNQ-bsHGkU-6wdY+4OR_Rcg@mail.gmail.com>

For curved lines, you could use the bezier library.

In this example, I generate a bezier line with random curvature within a
specific range :

from = mst.bh[i, 1] # coordinates of the source node
to = mst.bh[i, 2] # coordinates of the target node

d = sqrt((coords[from, 1] - coords[to, 1])^2 + (coords[from, 2] -
coords[to, 2])^2) # the distance bewteen the two nodes

midpoint = c((coords[from, 1] + coords[to, 1])/2 + ifelse(runif(1,-1,1) >
0, 1, -1) * runif(1,0,d/3),
                 (coords[from, 2] + coords[to, 2])/2 + ifelse(runif(1,-1,1)
> 0, 1, -1) * runif(1,0,d/3))

 b = bezier(t=t <- seq(0, 1, length=100), p=rbind(coords[from, ], midpoint,
coords[to, ]))

rowname = paste(from, to, sep="_")
l = makeLineFromCoords(b, rowname)

2016-02-25 11:44 GMT+01:00 Luca Candeloro <luca.candeloro at gmail.com>:

> Thank you Mathieu,
> in the way you propose, however, you get straight lines...
> I'd like instead to have curved edges.
> any suggestions?
> cheers, luca
>
> 2016-02-25 11:39 GMT+01:00 Mathieu Rajerison <mathieu.rajerison at gmail.com>
> :
>
>> Hi,
>>
>> Recently, I used igraph with spatial objects.
>>
>> Once you have the coordinates of the nodes composing an edge, you can
>> transform it into a spatiallines object with this function :
>>
>> makeLineFromCoords <- function(coords, i) {
>>   Sl1 = Line(coords)
>>   S1 = Lines(list(Sl1), ID=as.character(i))
>>   Sl = SpatialLines(list(S1))
>>   return(Sl)
>> }
>>
>> For all the routing stuff within R, this resource by B. Rowlingson is
>> quite inspiring :
>>
>> http://rstudio-pubs-static.s3.amazonaws.com/1572_7599552b60454033a0d5c5e6d2e34ffb.html
>>
>> best,
>>
>> Mathieu
>>
>> 2016-02-22 9:30 GMT+01:00 Michael Sumner <mdsumner at gmail.com>:
>>
>>> On Mon, 22 Feb 2016 at 19:13 Luca Candeloro <luca.candeloro at gmail.com>
>>> wrote:
>>>
>>> > Dear all,
>>> > plotting graphs with given vertex coordinates is possible inside igraph
>>> > plot function.
>>> > I would like to transform vilsualized edges into
>>> SpatialLinesDataFrame, so
>>> > that they could be exported in .shp file...
>>> > Any suggestion?
>>> >
>>>
>>> Can you please provide a working igraph example that we can start with?
>>>
>>> Do you want coordinates as seen in a particular plot, or can it be more
>>> arbitrary?
>>>
>>> Cheers, Mike.
>>>
>>>
>>>
>>> > thanks in advance,
>>> > Luca
>>> >
>>> >         [[alternative HTML version deleted]]
>>> >
>>> > _______________________________________________
>>> > R-sig-Geo mailing list
>>> > R-sig-Geo at r-project.org
>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>> >
>>> --
>>> Dr. Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> 203 Channel Highway
>>> Kingston Tasmania 7050 Australia
>>>
>>>         [[alternative HTML version deleted]]
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>>
>>
>

	[[alternative HTML version deleted]]


From mathieu.rajerison at gmail.com  Thu Feb 25 12:03:41 2016
From: mathieu.rajerison at gmail.com (Mathieu Rajerison)
Date: Thu, 25 Feb 2016 12:03:41 +0100
Subject: [R-sig-Geo] igraph and spatial
In-Reply-To: <CAGfc75kr6n1qNZUb6FYdyqUtsZ6QNQ-bsHGkU-6wdY+4OR_Rcg@mail.gmail.com>
References: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
	<CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
	<CAGfc75nVOKK=_yptaEpM6+bqyX1ePUxc_ZbUXEOT=zkeHdfmiw@mail.gmail.com>
	<CAHF6YnmZiJZtVgbbjLzFcyYDSpOPp00sgQyvOqc+tywiJEcv7w@mail.gmail.com>
	<CAGfc75kr6n1qNZUb6FYdyqUtsZ6QNQ-bsHGkU-6wdY+4OR_Rcg@mail.gmail.com>
Message-ID: <CAGfc75m9wAU3qb4oXXmiXtW5eDzz343dm4C2W_Q1tiu4pxk0Bw@mail.gmail.com>

In this example, I generate a bezier line with random curvature within a
specific range :

from = mst.bh[i, 1] # coordinates of the source node
to = mst.bh[i, 2] # coordinates of the target node

d = sqrt((coords[from, 1] - coords[to, 1])^2 + (coords[from, 2] -
coords[to, 2])^2) # the distance bewteen the two nodes

midpoint = c((coords[from, 1] + coords[to, 1])/2 + ifelse(runif(1,-1,1) >
0, 1, -1) * runif(1,0,d/3),
                 (coords[from, 2] + coords[to, 2])/2 + ifelse(runif(1,-1,1)
> 0, 1, -1) * runif(1,0,d/3))

 b = bezier(t=t <- seq(0, 1, length=100), p=rbind(coords[from, ], midpoint,
coords[to, ]))

rowname = paste(from, to, sep="_")
l = makeLineFromCoords(b, rowname)

2016-02-25 11:55 GMT+01:00 Mathieu Rajerison <mathieu.rajerison at gmail.com>:

> For curved lines, you could use the bezier library.
>
> In this example, I generate a bezier line with random curvature within a
> specific range :
>
> from = mst.bh[i, 1] # coordinates of the source node
> to = mst.bh[i, 2] # coordinates of the target node
>
> d = sqrt((coords[from, 1] - coords[to, 1])^2 + (coords[from, 2] -
> coords[to, 2])^2) # the distance bewteen the two nodes
>
> midpoint = c((coords[from, 1] + coords[to, 1])/2 + ifelse(runif(1,-1,1) >
> 0, 1, -1) * runif(1,0,d/3),
>                  (coords[from, 2] + coords[to, 2])/2 +
> ifelse(runif(1,-1,1) > 0, 1, -1) * runif(1,0,d/3))
>
>  b = bezier(t=t <- seq(0, 1, length=100), p=rbind(coords[from, ],
> midpoint, coords[to, ]))
>
> rowname = paste(from, to, sep="_")
> l = makeLineFromCoords(b, rowname)
>
> 2016-02-25 11:44 GMT+01:00 Luca Candeloro <luca.candeloro at gmail.com>:
>
>> Thank you Mathieu,
>> in the way you propose, however, you get straight lines...
>> I'd like instead to have curved edges.
>> any suggestions?
>> cheers, luca
>>
>> 2016-02-25 11:39 GMT+01:00 Mathieu Rajerison <mathieu.rajerison at gmail.com
>> >:
>>
>>> Hi,
>>>
>>> Recently, I used igraph with spatial objects.
>>>
>>> Once you have the coordinates of the nodes composing an edge, you can
>>> transform it into a spatiallines object with this function :
>>>
>>> makeLineFromCoords <- function(coords, i) {
>>>   Sl1 = Line(coords)
>>>   S1 = Lines(list(Sl1), ID=as.character(i))
>>>   Sl = SpatialLines(list(S1))
>>>   return(Sl)
>>> }
>>>
>>> For all the routing stuff within R, this resource by B. Rowlingson is
>>> quite inspiring :
>>>
>>> http://rstudio-pubs-static.s3.amazonaws.com/1572_7599552b60454033a0d5c5e6d2e34ffb.html
>>>
>>> best,
>>>
>>> Mathieu
>>>
>>> 2016-02-22 9:30 GMT+01:00 Michael Sumner <mdsumner at gmail.com>:
>>>
>>>> On Mon, 22 Feb 2016 at 19:13 Luca Candeloro <luca.candeloro at gmail.com>
>>>> wrote:
>>>>
>>>> > Dear all,
>>>> > plotting graphs with given vertex coordinates is possible inside
>>>> igraph
>>>> > plot function.
>>>> > I would like to transform vilsualized edges into
>>>> SpatialLinesDataFrame, so
>>>> > that they could be exported in .shp file...
>>>> > Any suggestion?
>>>> >
>>>>
>>>> Can you please provide a working igraph example that we can start with?
>>>>
>>>> Do you want coordinates as seen in a particular plot, or can it be more
>>>> arbitrary?
>>>>
>>>> Cheers, Mike.
>>>>
>>>>
>>>>
>>>> > thanks in advance,
>>>> > Luca
>>>> >
>>>> >         [[alternative HTML version deleted]]
>>>> >
>>>> > _______________________________________________
>>>> > R-sig-Geo mailing list
>>>> > R-sig-Geo at r-project.org
>>>> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>> >
>>>> --
>>>> Dr. Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> 203 Channel Highway
>>>> Kingston Tasmania 7050 Australia
>>>>
>>>>         [[alternative HTML version deleted]]
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>>
>>>
>>
>

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Thu Feb 25 16:44:12 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 25 Feb 2016 16:44:12 +0100
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
In-Reply-To: <CACpmSOtAFKDwS-Ph=yNag-YHrwNJELM7rg=F6_xxL_mMwg2+Sg@mail.gmail.com>
References: <CAG4NRe+WCmztmiiXCxT=WZ3-gppFjJFrV4QJcSUi+Ypi-sqXzw@mail.gmail.com>
	<CACpmSOtAFKDwS-Ph=yNag-YHrwNJELM7rg=F6_xxL_mMwg2+Sg@mail.gmail.com>
Message-ID: <CAG4NReKsMBoKKzrs-X06ef-E6GuDRbHc7t+_JQBzR3uenTyyVw@mail.gmail.com>

Thanks,

Do you know why your solution does not work on a raster layer?
i.e.

require(rgdal)
require(raster)
require(mapmisc)
require(TeachingDemos)

nicabg2 <- openmap(nica,path="cartodb")
plot(nicabg2)
subplot({
    plot(world, col=1, xlim=c(-120, 30), ylim=c(-30, 40))
    box()
    points(coordinates(nica), pch=20, cex=2, col='red')
}, 'bottomright', inset=c(0.01, 0.01), size=c(1, 1))

Agus

On Thu, Feb 25, 2016 at 12:36 AM, John Baumgartner <johnbaums at gmail.com> wrote:
> On Thu, Feb 25, 2016 at 4:26 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
>>
>> Hi!
>>
>> When I make an insetMap for an small country, I get a very
>> uggly "X" marking its position:
>>
>> require(rgdal)
>> require(raster)
>> require(mapmisc)
>> nica <- getData("GADM", country="NIC", level=0)
>> nicabg <- openmap(nica, path="landscape")
>> map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
>> plot(nicabg,axes=TRUE)
>> plot(nica,add=TRUE)
>> insetMap(nica,"bottomleft", width=0.3)
>>
>> is there a way to set another symbol or at least making it smaller?
>
> Not quite what you asked for, but you could try TeachingDemos::subplots,
> which you might find to be a little more flexible.
>
> E.g.
>
> library(TeachingDemos)
> library(rgdal)
>
> download.file(file.path('http://www.naturalearthdata.com/http/',
>                         'www.naturalearthdata.com/download/110m/physical',
>                         'ne_110m_land.zip'), f <- tempfile())
> unzip(f, exdir=tempdir())
> world <- readOGR(tempdir(), 'ne_110m_land')
>
> plot(nica, col='gray90', border='black', axes=TRUE, xlim=c(-88, -81.5))
> subplot({
>   plot(world, col=1, xlim=c(-120, 30), ylim=c(-30, 40))
>   box()
>   points(coordinates(nica), pch=20, cex=2, col='red')
> }, 'bottomright', inset=c(0.01, 0.01), size=c(1, 1))
>
>>
>> Also, despite the help page says that
>> "Additional arguments passed to legend" are accepted, I do not find
>> any to actually work.
>> For example, cannot set the exact values of x,y for positioning the
>> inset map. And cannot use locate() to put it wherever I want to.
>
> The "additional arguments" are for scaleBar, which is also documented
> at ?insetMap.
> Note that there is no ellipsis (...) arg for insetMap.
>
>>
>> Thanks
>>
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mikesynan at gmail.com  Thu Feb 25 17:20:47 2016
From: mikesynan at gmail.com (Michael Synan)
Date: Thu, 25 Feb 2016 11:20:47 -0500
Subject: [R-sig-Geo] Multiple time point + variable regression
In-Reply-To: <CAPBL36Z4QYOUwZwGqUdUGPypUAkNksmBB8LpHW9czk=pBSH62g@mail.gmail.com>
References: <CAPBL36Z4QYOUwZwGqUdUGPypUAkNksmBB8LpHW9czk=pBSH62g@mail.gmail.com>
Message-ID: <CAPBL36ax+84mVMJB_qfQ4dyr5c-JEsbcikUM-SGNgUQu1VEV9g@mail.gmail.com>

Hello all,

Apologies in advance if this request is not properly posed, this is my
first post. I want to get r squared (i think) for the following data:

- land values (X) for properties across multiple years
- geojson of particular regions (ZONE) and the year they were established

I want to show the degree to which increases in X over time are determined
by establishment of ZONE.

Can someone perhaps point me in the correct general direction? The
literature is extensive, but I'm having trouble finding examples for this
particular problem.

Best regards,
Michael

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Thu Feb 25 18:11:22 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Thu, 25 Feb 2016 18:11:22 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
Message-ID: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>

Is there any way to download the raster layers
of openmap() with an increased resolution?
I find the quality of the labels very low,
or am I doing something wrong? i.e.

require(raster)
require(mapmisc)
nica <- getData("GADM", country="NIC", level=0)
nicabg <- openmap(nica, path="landscape")
plot(nicabg)

Thanks

Agus


From patrick.brown at utoronto.ca  Thu Feb 25 18:46:53 2016
From: patrick.brown at utoronto.ca (Patrick Brown)
Date: Thu, 25 Feb 2016 12:46:53 -0500
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
Message-ID: <CA+j2mtWo24txJgcymHPovtpurX-JV92e1ace_NJc-qY0YfRv0g@mail.gmail.com>

Hello all, my first post here!


mapmisc (1.4.8 from r-forge) now allows


require(rgdal)
require(raster)
require(mapmisc)
nica <- getData("GADM", country="NIC", level=0)
nicabg <- openmap(nica, path="landscape")
map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
plot(nicabg,axes=TRUE)
plot(nica,add=TRUE)
loc = insetMap(nica,pos=c(-85,12), width=0.3, col=NA, lty=0)
points(loc)

p


From b.rowlingson at lancaster.ac.uk  Thu Feb 25 18:49:47 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Thu, 25 Feb 2016 17:49:47 +0000
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
Message-ID: <CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>

On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Is there any way to download the raster layers
> of openmap() with an increased resolution?
> I find the quality of the labels very low,
> or am I doing something wrong? i.e.
>
> require(raster)
> require(mapmisc)
> nica <- getData("GADM", country="NIC", level=0)
> nicabg <- openmap(nica, path="landscape")
> plot(nicabg)

 Map tiles from OpenStreetMap and other map tile providers are images
designed to be shown at a fixed resolution. When you plot them in an R
graphics window you could be stretching them so that each pixel in the
original maps to 1.273 pixels on your screen. So some kind of
interpolation or nearest neighbour replacement has to be done, and
this makes text labels look bad. Other line work will look bad too.

 If you try and download more map tiles at a higher resolution then
you'll find the labels are now way too small, because what you've
downloaded are map tiles designed for a higher zoom level on a web
browser. Web map browsers have a fixed set of zoom values that
correspond to the resolution of the map tiles. With an R window, you
are free to choose odd zoom factors that give the ugly behaviour.

 If you can resize your R window exactly right then you might get
something that looks good!

 The alternative is to build a background map yourself from
OpenStreetMap *vector* data and some code and some styling. Or use a
map tile provider that doesn't have text labels and add them to
selected places with R graphics commands. Lines and polygons will
still be stretched and a bit "jaggy" but our eyes don't notice this as
much as badly scaled text.

Barry


From reudenbach at uni-marburg.de  Thu Feb 25 19:42:36 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Thu, 25 Feb 2016 19:42:36 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
	<CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
Message-ID: <56CF4B1C.5020401@uni-marburg.de>

Hi,

if you just want to map the data, mapview could be an option that among 
others avoid the pixel stretching.

require(mapview)
require(raster)
nica <- getData("GADM", country="NIC", level=0)

mapview(nica)

mapview(nica,zcol = "POP2000", color = "#FFA500", lwd= 5, alpha.regions 
= 0.4)


cheers Chris



Am 25.02.2016 um 18:49 schrieb Barry Rowlingson:
> On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com> wrote:
>> Is there any way to download the raster layers
>> of openmap() with an increased resolution?
>> I find the quality of the labels very low,
>> or am I doing something wrong? i.e.
>>
>> require(raster)
>> require(mapmisc)
>> nica <- getData("GADM", country="NIC", level=0)
>> nicabg <- openmap(nica, path="landscape")
>> plot(nicabg)
>   Map tiles from OpenStreetMap and other map tile providers are images
> designed to be shown at a fixed resolution. When you plot them in an R
> graphics window you could be stretching them so that each pixel in the
> original maps to 1.273 pixels on your screen. So some kind of
> interpolation or nearest neighbour replacement has to be done, and
> this makes text labels look bad. Other line work will look bad too.
>
>   If you try and download more map tiles at a higher resolution then
> you'll find the labels are now way too small, because what you've
> downloaded are map tiles designed for a higher zoom level on a web
> browser. Web map browsers have a fixed set of zoom values that
> correspond to the resolution of the map tiles. With an R window, you
> are free to choose odd zoom factors that give the ugly behaviour.
>
>   If you can resize your R window exactly right then you might get
> something that looks good!
>
>   The alternative is to build a background map yourself from
> OpenStreetMap *vector* data and some code and some styling. Or use a
> map tile provider that doesn't have text labels and add them to
> selected places with R graphics commands. Lines and polygons will
> still be stretched and a bit "jaggy" but our eyes don't notice this as
> much as badly scaled text.
>
> Barry
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From mdsumner at gmail.com  Fri Feb 26 05:59:51 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 26 Feb 2016 04:59:51 +0000
Subject: [R-sig-Geo] igraph and spatial
In-Reply-To: <CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
References: <CAHF6Yn=VZDxtPv97rE_a8O=AfG+UbcNh8hBL1ps2Awz1tPEkPg@mail.gmail.com>
	<CAAcGz98yzsnGUkXWGK1i7TqAZhtWjwOkNeF1_UVHUNw_8bn+zw@mail.gmail.com>
Message-ID: <CAAcGz98vgMkrYFJ7dfNLw0_QrfhwHaTHR+GBfRZSCz=b1KCuXA@mail.gmail.com>

On Mon, 22 Feb 2016 7:30 pm Michael Sumner <mdsumner at gmail.com> wrote:

> On Mon, 22 Feb 2016 at 19:13 Luca Candeloro <luca.candeloro at gmail.com>
> wrote:
>
>> Dear all,
>> plotting graphs with given vertex coordinates is possible inside igraph
>> plot function.
>> I would like to transform vilsualized edges into SpatialLinesDataFrame, so
>> that they could be exported in .shp file...
>> Any suggestion?
>>
>
> Can you please provide a working igraph example that we can start with?
>
> Do you want coordinates as seen in a particular plot, or can it be more
> arbitrary?
>
> Cheers, Mike.
>
>
>

Try shp2graph on CRAN.

Mike

thanks in advance,
>> Luca
>>
>>         [[alternative HTML version deleted]]
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
> --
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From tyatabe at ucdavis.edu  Thu Feb 25 18:32:33 2016
From: tyatabe at ucdavis.edu (Tadaishi Yatabe-Rodriguez)
Date: Thu, 25 Feb 2016 09:32:33 -0800
Subject: [R-sig-Geo] Multiplying a raster object
In-Reply-To: <56CDA871.60101@wur.nl>
References: <CAMtcdVjEdxZbcaU8VcMeu2jJ2bEb4mV20=ZGJHEJ=bFqq8yosw@mail.gmail.com>
	<56CDA871.60101@wur.nl>
Message-ID: <CAMtcdVhh32vCgChHzcUip-goWvnJsBzbY0Ob6S0xbzrQ7cxdHQ@mail.gmail.com>

Thanks Loic,

That helps a lot, actually. I used the wrong factor for transforming.
Still adding the values of my raster don't add up to the points of the
original ppp object. So I suppose there are better approaches than
multiplying the raster by factor. If someone else wants to chip in on this
it'll be great.

Thanks again,

Tada

On Wed, Feb 24, 2016 at 4:56 AM, Lo?c Dutrieux <loic.dutrieux at wur.nl> wrote:

>
>
> On 02/23/2016 09:22 PM, Tadaishi Yatabe-Rodriguez wrote:
>
>> Hi community,
>>
>> I have a raster object of a kernel density, where the linear unit is
>> meter,
>> and when I plot it it gives me very small density values (units per sq
>> meter, I suppose). I figure that if I multiply it, say by a 1000, it will
>> give density values in units per sq km.
>>
>
> I don't know much about kernel densities, but if you want to convert
> units/m^2 to units/km^2 you'd have to multiply by 1 000 000 instead of
> 1000. Hope that helps explaining the incoherence in your results.
>
> It looks good on the legend, but I
>> wonder: is this a correct thing to do? I wonder this because when I add
>> the
>> values of the raster it does not add up to the number of points in my
>> original ppp object from which I created the density.
>>
>> Thanks,
>>
>> Tada
>>
>>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Tadaishi Yatabe*
DVM, MPVM, PhD (C)
Center for Animal Disease Modeling and Surveillance (CADMS)
Department of Medicine and Epidemiology
School of Veterinary Medicine
University of California Davis

http://tadaishi.wix.com/tada

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Fri Feb 26 11:02:49 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Feb 2016 11:02:49 +0100
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
In-Reply-To: <CA+j2mtWo24txJgcymHPovtpurX-JV92e1ace_NJc-qY0YfRv0g@mail.gmail.com>
References: <CA+j2mtWo24txJgcymHPovtpurX-JV92e1ace_NJc-qY0YfRv0g@mail.gmail.com>
Message-ID: <CAG4NReLSTb7TTjYo114D=ieAp8eXpMU2Pt5hap_9ndx1E6+PFA@mail.gmail.com>

Much better now!

nica <- getData("GADM", country="NIC", level=0)
nicabg <- openmap(nica, path="landscape")
map.new(nicabg,1,mar=c(2, 2, 2, 0) + 0.1)
plot(nicabg,axes=TRUE)
plot(nica,add=TRUE)
loc <- insetMap(nica,pos=c(-89.9,8.5), width=0.3, col=NA, lty=0,pch=".")
points(loc)

Just 2 questions:
1. In the example you provide, the resulting mark is too thick. I've
made a thinner version with pch=".", but
it would nice having the option of just drawing the central point and
not the window.
2. Is there a way to calculate the size of the plotting window so that
there is no wasted white space
between the map and the axes? I can do this by hand, but then cannot
read the size.

Thanks

On Thu, Feb 25, 2016 at 6:46 PM, Patrick Brown
<patrick.brown at utoronto.ca> wrote:
> Hello all, my first post here!
>
>
> mapmisc (1.4.8 from r-forge) now allows
>
>
> require(rgdal)
> require(raster)
> require(mapmisc)
> nica <- getData("GADM", country="NIC", level=0)
> nicabg <- openmap(nica, path="landscape")
> map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
> plot(nicabg,axes=TRUE)
> plot(nica,add=TRUE)
> loc = insetMap(nica,pos=c(-85,12), width=0.3, col=NA, lty=0)
> points(loc)
>
> p
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From alobolistas at gmail.com  Fri Feb 26 12:20:39 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Feb 2016 12:20:39 +0100
Subject: [R-sig-Geo] odd behaviour of llgridlines() regarding axes labels
Message-ID: <CAG4NReJp5Bm=OCYpJxoxFb_vuEsOjZMfmLzWP-jSE7c678CpMA@mail.gmail.com>

I see an odd behaviour of llgridlines() regarding axes labels:

require(rgdal)
require(raster)
a <- extent(c(-90,-81.5625,8.407168,16.63619))
a <- as(a, 'SpatialPolygons')
projection(a) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
+towgs84=0,0,0"

No axis labels on x axis:
plot(a,axes=FALSE)
llgridlines(a, plotLines=TRUE, plotLabels=TRUE)

#same with:
plot(a,axes=FALSE,mar=c(4, 3, 2, 3)+0.1)
llgridlines(a, plotLines=TRUE, plotLabels=TRUE)

#and 2 vertical axes with:
plot(a,axes=TRUE)
llgridlines(a, plotLines=TRUE, plotLabels=TRUE)

Any hint?

Thanks
Agus


From alobolistas at gmail.com  Fri Feb 26 12:27:34 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Feb 2016 12:27:34 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <56CF4B1C.5020401@uni-marburg.de>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
	<CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
	<56CF4B1C.5020401@uni-marburg.de>
Message-ID: <CAG4NRe+MAFOmi=ZzTmhDVZQwn1K-xYLay16nYw-+04h+MhNCLw@mail.gmail.com>

Stunning!
Can I remove the buttons for saving to a bmp file?
What attribution should be used for publishing?
Agus

On Thu, Feb 25, 2016 at 7:42 PM, Chris Reudenbach
<reudenbach at uni-marburg.de> wrote:
> Hi,
>
> if you just want to map the data, mapview could be an option that among
> others avoid the pixel stretching.
>
> require(mapview)
> require(raster)
> nica <- getData("GADM", country="NIC", level=0)
>
> mapview(nica)
>
> mapview(nica,zcol = "POP2000", color = "#FFA500", lwd= 5, alpha.regions =
> 0.4)
>
>
> cheers Chris
>
>
>
>
> Am 25.02.2016 um 18:49 schrieb Barry Rowlingson:
>>
>> On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com>
>> wrote:
>>>
>>> Is there any way to download the raster layers
>>> of openmap() with an increased resolution?
>>> I find the quality of the labels very low,
>>> or am I doing something wrong? i.e.
>>>
>>> require(raster)
>>> require(mapmisc)
>>> nica <- getData("GADM", country="NIC", level=0)
>>> nicabg <- openmap(nica, path="landscape")
>>> plot(nicabg)
>>
>>   Map tiles from OpenStreetMap and other map tile providers are images
>> designed to be shown at a fixed resolution. When you plot them in an R
>> graphics window you could be stretching them so that each pixel in the
>> original maps to 1.273 pixels on your screen. So some kind of
>> interpolation or nearest neighbour replacement has to be done, and
>> this makes text labels look bad. Other line work will look bad too.
>>
>>   If you try and download more map tiles at a higher resolution then
>> you'll find the labels are now way too small, because what you've
>> downloaded are map tiles designed for a higher zoom level on a web
>> browser. Web map browsers have a fixed set of zoom values that
>> correspond to the resolution of the map tiles. With an R window, you
>> are free to choose odd zoom factors that give the ugly behaviour.
>>
>>   If you can resize your R window exactly right then you might get
>> something that looks good!
>>
>>   The alternative is to build a background map yourself from
>> OpenStreetMap *vector* data and some code and some styling. Or use a
>> map tile provider that doesn't have text labels and add them to
>> selected places with R graphics commands. Lines and polygons will
>> still be stretched and a bit "jaggy" but our eyes don't notice this as
>> much as badly scaled text.
>>
>> Barry
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From mdsumner at gmail.com  Fri Feb 26 12:45:47 2016
From: mdsumner at gmail.com (Michael Sumner)
Date: Fri, 26 Feb 2016 11:45:47 +0000
Subject: [R-sig-Geo] odd behaviour of llgridlines() regarding axes labels
In-Reply-To: <CAG4NReJp5Bm=OCYpJxoxFb_vuEsOjZMfmLzWP-jSE7c678CpMA@mail.gmail.com>
References: <CAG4NReJp5Bm=OCYpJxoxFb_vuEsOjZMfmLzWP-jSE7c678CpMA@mail.gmail.com>
Message-ID: <CAAcGz98UPSoXY9FQ15Y_3a_8nQOPceoaRJrhAGViQ0cj__QLjA@mail.gmail.com>

1) is ok with xpd clipping turned off

op <- par(xpd = NA)
plot(a,axes=FALSE)
llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
par(op)

2)  same
op <- par(xpd = NA)
plot(a,axes=FALSE,mar=c(4, 3, 2, 3)+0.1)
llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
par(op)

3)  Consider using graticule package instead? You can control the extents
independently of the meridian/parallel lines (and optionally provided a
target projection. )

You have to give it the longs/lats you want, there's no automatic detection
from an object or plot - but for me that's the price of control over what I
get.

install.packages("graticule")
library(graticule)
plot(a,axes=TRUE)
library(graticule)
g <- graticule(seq(-90, -82, by = 2), seq(10, 16, by = 2), xlim =
par("usr")[1:2], ylim = par("usr")[3:4])
plot(g, add = TRUE, lty = 2)

Cheers, Mike.


On Fri, 26 Feb 2016 at 22:21 Agustin Lobo <alobolistas at gmail.com> wrote:

> I see an odd behaviour of llgridlines() regarding axes labels:
>
> require(rgdal)
> require(raster)
> a <- extent(c(-90,-81.5625,8.407168,16.63619))
> a <- as(a, 'SpatialPolygons')
> projection(a) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
> +towgs84=0,0,0"
>
> No axis labels on x axis:
> plot(a,axes=FALSE)
> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>
> #same with:
> plot(a,axes=FALSE,mar=c(4, 3, 2, 3)+0.1)
> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>
> #and 2 vertical axes with:
> plot(a,axes=TRUE)
> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>
> Any hint?
>
> Thanks
> Agus
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
-- 
Dr. Michael Sumner
Software and Database Engineer
Australian Antarctic Division
203 Channel Highway
Kingston Tasmania 7050 Australia

	[[alternative HTML version deleted]]


From alobolistas at gmail.com  Fri Feb 26 14:15:12 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Fri, 26 Feb 2016 14:15:12 +0100
Subject: [R-sig-Geo] odd behaviour of llgridlines() regarding axes labels
In-Reply-To: <CAAcGz98UPSoXY9FQ15Y_3a_8nQOPceoaRJrhAGViQ0cj__QLjA@mail.gmail.com>
References: <CAG4NReJp5Bm=OCYpJxoxFb_vuEsOjZMfmLzWP-jSE7c678CpMA@mail.gmail.com>
	<CAAcGz98UPSoXY9FQ15Y_3a_8nQOPceoaRJrhAGViQ0cj__QLjA@mail.gmail.com>
Message-ID: <CAG4NReL1PF7ff0nkfq=Z_+QDKp5_gkVsAC0n-G2FPeAMYLveDw@mail.gmail.com>

Thanks, that fixes it.
I will try graticules as well.
Agus

On Fri, Feb 26, 2016 at 12:45 PM, Michael Sumner <mdsumner at gmail.com> wrote:
> 1) is ok with xpd clipping turned off
>
> op <- par(xpd = NA)
> plot(a,axes=FALSE)
> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
> par(op)
>
> 2)  same
> op <- par(xpd = NA)
> plot(a,axes=FALSE,mar=c(4, 3, 2, 3)+0.1)
> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
> par(op)
>
> 3)  Consider using graticule package instead? You can control the extents
> independently of the meridian/parallel lines (and optionally provided a
> target projection. )
>
> You have to give it the longs/lats you want, there's no automatic detection
> from an object or plot - but for me that's the price of control over what I
> get.
>
> install.packages("graticule")
> library(graticule)
> plot(a,axes=TRUE)
> library(graticule)
> g <- graticule(seq(-90, -82, by = 2), seq(10, 16, by = 2), xlim =
> par("usr")[1:2], ylim = par("usr")[3:4])
> plot(g, add = TRUE, lty = 2)
>
> Cheers, Mike.
>
>
> On Fri, 26 Feb 2016 at 22:21 Agustin Lobo <alobolistas at gmail.com> wrote:
>
>> I see an odd behaviour of llgridlines() regarding axes labels:
>>
>> require(rgdal)
>> require(raster)
>> a <- extent(c(-90,-81.5625,8.407168,16.63619))
>> a <- as(a, 'SpatialPolygons')
>> projection(a) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84
>> +towgs84=0,0,0"
>>
>> No axis labels on x axis:
>> plot(a,axes=FALSE)
>> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>>
>> #same with:
>> plot(a,axes=FALSE,mar=c(4, 3, 2, 3)+0.1)
>> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>>
>> #and 2 vertical axes with:
>> plot(a,axes=TRUE)
>> llgridlines(a, plotLines=TRUE, plotLabels=TRUE)
>>
>> Any hint?
>>
>> Thanks
>> Agus
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
> --
> Dr. Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> 203 Channel Highway
> Kingston Tasmania 7050 Australia
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From patrick.brown at utoronto.ca  Fri Feb 26 15:27:32 2016
From: patrick.brown at utoronto.ca (Patrick Brown)
Date: Fri, 26 Feb 2016 09:27:32 -0500
Subject: [R-sig-Geo] Problems with mapmisc::insetMap()
Message-ID: <CA+j2mtU2nd8N6nSujV=6RGPOCdz_bOvYvB4VZ5xxwNNau2dyxg@mail.gmail.com>

Hi.

1- `insetMap` returns a matrix of x and y coordinates, you needn't
plot all of them.

```
 nica <- getData("GADM", country="NIC", level=0)
 nicabg <- openmap(nica, path="landscape")
 map.new(nicabg,1,mar=c(2, 2, 2, 0) + 0.1)
 plot(nicabg,axes=TRUE)
 plot(nica,add=TRUE)
 loc <- insetMap(nica,pos=c(-89.9,8.5), width=0.3, col=NA, lty=0,pch=".")
 points(loc[1,1], loc[1,2], pch=3)
```

2- `dev.size()` gives you the size of the plotting window.  the best
way to control the plot size is to save it to a file.

```
png("myfile.png", height=400, width=300)
plot(nicabg)
dev.off()
```

p

On Fri, Feb 26, 2016 at 5:02 AM, Agustin Lobo <alobolistas at gmail.com> wrote:
> Much better now!
>
> nica <- getData("GADM", country="NIC", level=0)
> nicabg <- openmap(nica, path="landscape")
> map.new(nicabg,1,mar=c(2, 2, 2, 0) + 0.1)
> plot(nicabg,axes=TRUE)
> plot(nica,add=TRUE)
> loc <- insetMap(nica,pos=c(-89.9,8.5), width=0.3, col=NA, lty=0,pch=".")
> points(loc)
>
> Just 2 questions:
> 1. In the example you provide, the resulting mark is too thick. I've
> made a thinner version with pch=".", but
> it would nice having the option of just drawing the central point and
> not the window.
> 2. Is there a way to calculate the size of the plotting window so that
> there is no wasted white space
> between the map and the axes? I can do this by hand, but then cannot
> read the size.
>
> Thanks
>
> On Thu, Feb 25, 2016 at 6:46 PM, Patrick Brown
> <patrick.brown at utoronto.ca> wrote:
>> Hello all, my first post here!
>>
>>
>> mapmisc (1.4.8 from r-forge) now allows
>>
>>
>> require(rgdal)
>> require(raster)
>> require(mapmisc)
>> nica <- getData("GADM", country="NIC", level=0)
>> nicabg <- openmap(nica, path="landscape")
>> map.new(nicabg, 0.7,mar=c(2, 2, 2, 0) + 0.1)
>> plot(nicabg,axes=TRUE)
>> plot(nica,add=TRUE)
>> loc = insetMap(nica,pos=c(-85,12), width=0.3, col=NA, lty=0)
>> points(loc)
>>
>> p
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From reudenbach at uni-marburg.de  Fri Feb 26 15:32:31 2016
From: reudenbach at uni-marburg.de (Chris Reudenbach)
Date: Fri, 26 Feb 2016 15:32:31 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <CAG4NRe+MAFOmi=ZzTmhDVZQwn1K-xYLay16nYw-+04h+MhNCLw@mail.gmail.com>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
	<CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
	<56CF4B1C.5020401@uni-marburg.de>
	<CAG4NRe+MAFOmi=ZzTmhDVZQwn1K-xYLay16nYw-+04h+MhNCLw@mail.gmail.com>
Message-ID: <56D061FF.6030509@uni-marburg.de>

Agus,

Mapview is using leaflet as engine. Due to this you will have the 
control icons on the map because first of all it is designed for 
interactive mapping within RStudio/R.

I think there are two different approaches to save your maps:

If you want to have a dump of the mapviewobject (but including the 
graphical buttons) you'll find a descriptat stackoverflow
http://stackoverflow.com/questions/31336898/how-to-save-leaflet-in-rstudio-map-as-png-or-jpg-file


You may also use  the spplot function from mapview which is designed for 
basic static mapping and to make usable the adavantages of spplot.

Note even if you are dealing with the mapview map object the spplot 
function  uses the Openstreetmap package for retrieving  the background 
maps  (e.g. 
http://www.inside-r.org/packages/cran/OpenStreetMap/docs/openmap). You 
can use the spplot syntax for designing your maps. Up to now this static 
plotting function is still pretty  basic but you may have a try:
spplot(mapView(nica["POP2000"]),colorkey=FALSE,  lwd= 15, alpha.regions 
= 0.9,
map.type="stamen-watercolor" )

I think for using the spplot it is better to install the current stable 
from github:
library(devtools)
install_github("environmentalinformatics-marburg/mapview", ref = "master")


cheers chris


Am 26.02.2016 um 12:27 schrieb Agustin Lobo:
> Stunning!
> Can I remove the buttons for saving to a bmp file?
> What attribution should be used for publishing?
> Agus
>
> On Thu, Feb 25, 2016 at 7:42 PM, Chris Reudenbach
> <reudenbach at uni-marburg.de> wrote:
>> Hi,
>>
>> if you just want to map the data, mapview could be an option that among
>> others avoid the pixel stretching.
>>
>> require(mapview)
>> require(raster)
>> nica <- getData("GADM", country="NIC", level=0)
>>
>> mapview(nica)
>>
>> mapview(nica,zcol = "POP2000", color = "#FFA500", lwd= 5, alpha.regions =
>> 0.4)
>>
>>
>> cheers Chris
>>
>>
>>
>>
>> Am 25.02.2016 um 18:49 schrieb Barry Rowlingson:
>>> On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com>
>>> wrote:
>>>> Is there any way to download the raster layers
>>>> of openmap() with an increased resolution?
>>>> I find the quality of the labels very low,
>>>> or am I doing something wrong? i.e.
>>>>
>>>> require(raster)
>>>> require(mapmisc)
>>>> nica <- getData("GADM", country="NIC", level=0)
>>>> nicabg <- openmap(nica, path="landscape")
>>>> plot(nicabg)
>>>    Map tiles from OpenStreetMap and other map tile providers are images
>>> designed to be shown at a fixed resolution. When you plot them in an R
>>> graphics window you could be stretching them so that each pixel in the
>>> original maps to 1.273 pixels on your screen. So some kind of
>>> interpolation or nearest neighbour replacement has to be done, and
>>> this makes text labels look bad. Other line work will look bad too.
>>>
>>>    If you try and download more map tiles at a higher resolution then
>>> you'll find the labels are now way too small, because what you've
>>> downloaded are map tiles designed for a higher zoom level on a web
>>> browser. Web map browsers have a fixed set of zoom values that
>>> correspond to the resolution of the map tiles. With an R window, you
>>> are free to choose odd zoom factors that give the ugly behaviour.
>>>
>>>    If you can resize your R window exactly right then you might get
>>> something that looks good!
>>>
>>>    The alternative is to build a background map yourself from
>>> OpenStreetMap *vector* data and some code and some styling. Or use a
>>> map tile provider that doesn't have text labels and add them to
>>> selected places with R graphics commands. Lines and polygons will
>>> still be stretched and a bit "jaggy" but our eyes don't notice this as
>>> much as badly scaled text.
>>>
>>> Barry
>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From jgrn at illinois.edu  Fri Feb 26 16:17:04 2016
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Fri, 26 Feb 2016 15:17:04 +0000
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <56CD6B86.5090605@uni-marburg.de>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<CALsJ7pSiAkuiQj5L3QYQrSv9iXr0siJ0F5jjWeQ+EbMVRsb6WA@mail.gmail.com>
	<56CD6B86.5090605@uni-marburg.de>
Message-ID: <CABG0rfsis0A6v3=YzrPomR6X7Xz6t4OftY7QN-VP35vhrdU3kg@mail.gmail.com>

Folks:

Just noticed this thread -- I see I didn't include a "--config" option with
any of the gdalUtils functions (it isn't one of the documented parameters
on the individual utility website, but it seems it would have allowed you
to run the GDAL_NETCDF_BOTTOMUP without setting a system environment
variable -- see
http://lists.osgeo.org/pipermail/gdal-dev/2014-July/039452.html).  If I
make this tweak and pushed it to r-forge, would one of you be willing to
see if it solves the problem?

I assume this will be something that would be needed for any gdal utility
that allows an "of" to be set?

--j

On Wed, Feb 24, 2016 at 2:37 AM Chris Reudenbach <reudenbach at uni-marburg.de>
wrote:

> Agus,
>
> sorry for the addon but I think I have to provide a correction of the
> corner coordinates (e.g. the extent values):
>
> In the example that you have posted below I did calculate the extent
> using the domain center coordinate and the WRF grid resolution in meter
> and the number of rows and cols.
>
> Since Dominik provides a link to the file description of the netcdf file
> I think it is more accurate to reproject the  corner coordinates  as
> given by the netcdf header variables (NC_GLOBAL#corner_lats,
> NC_GLOBAL#corner_lons). Assuming that your variable "dctmx" (which I can
> not identfy it in the nc file)  is of type "Mass" (staggered = M) the
> correct corner coordinates are stored as the first 4 entrys of the dump
> snippet below:
>
> lats<-"
>
> NC_GLOBAL#corner_lats={12.355667,50.26619,50.26619,12.355667,12.308136,50.18787,50.18787,12.308136,12.210785,50.403816,50.403816,12.210785,12.163345,50.325382,50.325382,12.163345}"
>
> lons<-"
>
> NC_GLOBAL#corner_lons={-131.43678,-151.29639,-48.703613,-68.563232,-131.5851,-151.51157,-48.488434,-68.414917,-131.38828,-151.41891,-48.581085,-68.611725,-131.53641,-151.63441,-48.36557,-68.463593}"
>
> after cleaning and converting the strings you may calculate the corner
> coordinates:
>
>
> library(proj4)
> ## project mass corner coordinates to lambertian
> llMass <- ptransform(cbind(clon[1],clat[1])/180*pi,'+proj=longlat
> +datum=WGS84 +no_defs',proj)
> ulMass <- ptransform(cbind(clon[2],clat[2])/180*pi,'+proj=longlat
> +datum=WGS84 +no_defs',proj)
> lrMass <- ptransform(cbind(clon[3],clat[3])/180*pi,'+proj=longlat
> +datum=WGS84 +no_defs',proj)
> urMass <- ptransform(cbind(clon[4],clat[4])/180*pi,'+proj=longlat
> +datum=WGS84 +no_defs',proj)
> wrfLccExtMass<-extent(ulMass[1],lrMass[1],llMass[2],ulMass[2])
>
>
> According to this the correct extent for mass variables should be:
>
> extent(wrfLccExtMass)
> class       : Extent
> xmin        : -3575343
> xmax        : 3575342
> ymin        : -2293058
> ymax        : 2306330
>
>
> hope this is correct now
>
> cheers Chris
>
> Am 24.02.2016 um 05:12 schrieb Agus Camacho:
> > With the help of everybody i finally got this to work, so here is a
> script
> > that does the job of reprojecting both, a raster layer obtained from a
> .nc
> > and some locations in order to overplot them using plot.raster or
> mapview.
> > Im using a combination of the advices of Dominik, Michael and Chris.
> >
> >
> > require(ncdf4)
> > require(raster)
> >
> >
> > setwd("C:/~")
> >
> >
> > r=raster("geo_em.d01.nc",
> >                varname="dctmx")# days of ctmax events
> >
> > # Set extent and projections of rasters for plotting
> > # chris gave me the orig data fom the nc file because i could not install
> > gdal
> > xmin= -3545999
> > xmax= 3546000
> > ymin = -2286000
> > ymax=2286000
> > pr<- "+proj=lcc +lat_1=25 +lat_2=45 +lat_0=38.000008 +lon_0=-100 +x_0=0
> > +y_0=0"
> >
> > wrfLccExt<-extent(xmin,xmax,ymin,ymax)
> >
> > extent(r) <- extent(wrfLccExt)
> > projection(r) <- pr
> >
> > # get and prepare  urosaurus locations
> >
> > x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
> > Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
> > x=x[,1:3]
> > colnames(x)
> > coordinates(x)=~lon+lat
> > proj4string(x)<- CRS("+proj=longlat +datum=WGS84")
> > x=spTransform(x, pr)
> >
> >
> > # get prepare and plot wrld_simpl
> > require(maptools)
> > require(sp)
> > data(wrld_simpl)
> > namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
> > "Canada", "Mexico")), prj)
> >
> > #plot with raster
> > plot(r, cex.main=.7,legend=F)
> > points(x)
> > plot(namer, add = TRUE)
> >
> > # plot with mapview (cool!)
> > m=mapview(r)
> > u=mapview(x)
> > m+u
> >
> >
> > Thanks to all!
> > Agus
> >
> > 2016-02-23 13:11 GMT-07:00 Agus Camacho <agus.camacho at gmail.com>:
> >
> >> Thanks for that Dominik,
> >>
> >> Giving that projection to either the locations, the raster layer
> generated
> >> from the .nc file, or both, still did not work. I keep having locations
> >> that should be on land falling far on the sea. Might this be a problem
> >> derived from using raster with a file whose original grid distances are
> not
> >> constant?
> >>
> >> Here is a link with the original file which has the original coordinate
> >> data.
> >>
> >> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
> >>
> >>
> >> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
> >> Dominik.Schneider at colorado.edu>:
> >>
> >>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
> >>> dealt with this.
> >>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
> >>> +a=6370000 +b=6370000 +units=m
> >>>
> >>> +proj=lcc which is usually what wrf is run with.
> >>> The tricky part is:
> >>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> >>> because every WRF run is different (the WRF Preprocessing System
> >>> optimizes the projection for the domain).
> >>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
> >>>
> >>> This gives:
> >>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> >>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
> >>>
> >>> But, wrf users like to give out lat and  long so you need to assign it:
> >>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
> >>>
> >>> and then reproject the lat/long to lcc coordinates using this string:
> >>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
> >>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
> >>>
> >>> One word of caution, make sure you received the correct coordinates.
> Some
> >>> variables are run cell center while some are run at cell edge. It looks
> >>> like from your .nc file it was made by your collaborator so I assume
> they
> >>> are right.
> >>>
> >>> That said, another word of caution, I found that the XLAT and XLONG
> >>> variables from WRF output aren't very precise. There is a "geogrid"
> file
> >>> from the preprocessing system that has the domain corners, resolution,
> nrow
> >>> and ncol from which you can make a better grid using the native
> projection
> >>> system (in my case it was a 4km grid). I suggest you try to get those.
> >>>
> >>> I hope this helps... I have to run but wanted to save people too much
> >>> head scratching. I can get you running with more help tonight if you
> need.
> >>> Dominik
> >>>
> >>>
> >>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <agus.camacho at gmail.com
> >
> >>> wrote:
> >>>
> >>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill
> bring
> >>>> more giant crab this time.
> >>>>
> >>>> The creator of the .nc file also looked at this webpage:
> >>>> http://www.pkrc.net/wrf-lambert.html
> >>>> It seemed like the right proj4 string might be this one:
> >>>>
> >>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
> >>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
> >>>>
> >>>> However this projection also does not allow me to adequately plot the
> >>>> locations on the raster.
> >>>>
> >>>> Here is the .nc file. it contains several layers.
> >>>>
> >>>>
> >>>>
> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
> >>>>
> >>>>
> >>>>
> >>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
> >>>>
> >>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no>
> wrote:
> >>>>>
> >>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
> >>>>>>
> >>>>>>> I made an attempt at it too. Investigating the original data, I'm
> >>>> not
> >>>>>>> sure that the projection information supplied is correct for the
> >>>> data
> >>>>>>> linked. When I load up the data in a unprojected space, the
> >>>> coordinates
> >>>>>>> don't look at all similar to any Lambert projected data I have,
> >>>> they
> >>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
> >>>>>>> perhaps a different spheroid than expected.
> >>>>>> Does anyone have a link to the original data? Is is possible that
> >>>> this is
> >>>>>> the General Oblique Transformation used by modellers - that is
> >>>> something
> >>>>>> that feels like longlat but is recentred and oblique? Example at the
> >>>> very
> >>>>>> end of my GEOSTAT talk last year (slides 81-83):
> >>>>>>
> >>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
> >>>>>>
> >>>>>> Roger
> >>>>>>
> >>>>>>
> >>>>> For what it is worth, the General Oblique Transformation is not the
> >>>> only
> >>>>> example - it's very common for modellers to have a mesh that has the
> >>>>> "mostly-properties" of a projection, but is not actually describable
> >>>> with
> >>>>> standard transform + affine parameters. The main cases that I've seen
> >>>> are
> >>>>> polar stereographic, equal area or oblique Mercator. Often they
> really
> >>>> are
> >>>>> simple transforms and you can reconstruct without loss, but it's not
> >>>>> usually possible to tell without exploration. It's an interesting
> >>>>> dis-connect to see code that builds a mesh with certain properties,
> >>>> then
> >>>>> only stores longitudes and latitudes - when it could be done with
> >>>> standard
> >>>>> tools and be stored and used much more efficiently.
> >>>>>
> >>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
> >>>>> terminology conflated in this context too. )
> >>>>>
> >>>>> I'm also interested to explore the original data.
> >>>>>
> >>>>> Cheers, Mike.
> >>>>>
> >>>>>
> >>>>>
> >>>>>>> -Alex
> >>>>>>>
> >>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
> >>>>>>>> Hi
> >>>>>>>>
> >>>>>>>> I tried to make it work but I had to give up. I wanted to
> >>>> reproject
> >>>>> the
> >>>>>> Lamberth conformal conic coordinates to long-lat but it didn't work.
> >>>>>>>> Perhaps someone can see what I did wrong. Here is what I did
> >>>> (data in
> >>>>> R
> >>>>>> binary format and figure in png format both attached):
> >>>>>>>> library(raster)
> >>>>>>>> library(maptools)
> >>>>>>>> data(wrld_simpl)
> >>>>>>>>
> >>>>>>>> r <- raster("raster.grd")
> >>>>>>>> projection(r)
> >>>>>>>> ## > NA
> >>>>>>>>
> >>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
> >>>> ",")
> >>>>>>>> coordinates(uro) <- ~lon+lat
> >>>>>>>>
> >>>>>>>> ## Set projections for the 3 data sets
> >>>>>>>>
> >>>>>>>> ## Lamberth's confocal conic projection with given parameters
> >>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
> >>>> +lat_2=45.0
> >>>>>> +ellps=WGS84"
> >>>>>>>> projection(r)
> >>>>>>>>
> >>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
> >>>> decimal)
> >>>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
> >>>>>>>>
> >>>>>>>> ## wrld_simpl is in geographical coordinates
> >>>>>>>> proj4string(wrld_simpl)
> >>>>>>>>
> >>>>>>>> ## Make figure in png format
> >>>>>>>> ## Of course plotting data with 2 different projections will give
> >>>>>>>> ## some distortions
> >>>>>>>> pdf("uro.png")
> >>>>>>>>
> >>>>>>>> plot(r)
> >>>>>>>> points(uro)
> >>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
> >>>> 'r'
> >>>>>>>> dev.off()
> >>>>>>>>
> >>>>>>>> extent(r)
> >>>>>>>> ## class       : Extent
> >>>>>>>> ## xmin        : -131.4368
> >>>>>>>> ## xmax        : -68.56323
> >>>>>>>> ## ymin        : 12.35567
> >>>>>>>> ## ymax        : 50.26619
> >>>>>>>>
> >>>>>>>> ## Reproject the raster to long-lat
> >>>>>>>> ## This doesn't work (collapsed domain)
> >>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
> >>>>>> +ellps=WGS84 +towgs84=0,0,0")
> >>>>>>>> ## Because
> >>>>>>>>> extent(rp)
> >>>>>>>> ## class       : Extent
> >>>>>>>> ## xmin        : -100.0015
> >>>>>>>> ## xmax        : -99.68557
> >>>>>>>> ## ymin        : 37.70658
> >>>>>>>> ## ymax        : 38.00046
> >>>>>>>>
> >>>>>>>> ## Save data in R binary format
> >>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> Yours sincerely / Med venlig hilsen
> >>>>>>>>
> >>>>>>>> Frede Aakmann T?gersen
> >>>>>>>> Specialist, M.Sc., Ph.D.
> >>>>>>>> Plant Performance & Modeling
> >>>>>>>>
> >>>>>>>> Technology & Service Solutions
> >>>>>>>> T +45 9730 5135
> >>>>>>>> M +45 2547 6050
> >>>>>>>> frtog at vestas.com
> >>>>>>>> http://www.vestas.com
> >>>>>>>>
> >>>>>>>> Company reg. name: Vestas Wind Systems A/S
> >>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
> >>>>>>>> Please refer to www.vestas.com/legal/notice
> >>>>>>>> If you have received this e-mail in error please contact the
> >>>> sender.
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> -----Original Message-----
> >>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
> >>>> Behalf Of
> >>>>>> Agus Camacho
> >>>>>>>> Sent: 22. februar 2016 19:20
> >>>>>>>> To: tech at wildintellect.com
> >>>>>>>> Cc: r-sig-geo
> >>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to
> >>>> a
> >>>>>> reference system implicit in a .nc file
> >>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
> >>>> them
> >>>>>> using
> >>>>>>>> your recommended Solution. I looked at the sites you proposed and
> >>>> they
> >>>>>> have
> >>>>>>>> other values for lat_1, lat_0, etc..
> >>>>>>>>
> >>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
> >>>>>>>>
> >>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
> >>>>>>>>>> Dear all,
> >>>>>>>>>>
> >>>>>>>>>> Im trying to overlap these points:
> >>>>>>>>>>
> >>>>
> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
> >>>>>>>>>> and a wrld_simpl object:
> >>>>>>>>>> library(maptools)
> >>>>>>>>>> data(wrld_simpl)
> >>>>>>>>>>
> >>>>>>>>>> Over this raster layer
> >>>>>>>>>>
> >>>>
> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
> >>>>>>>>>> This rastr comes from a .nc file without a reference system. The
> >>>>>> author
> >>>>>>>>> of
> >>>>>>>>>> that .nc file gave me the following data about the .nc.
> >>>>>>>>>>
> >>>>>>>>>> The projection is *Lambert conformal conic* projection
> >>>>>>>>>> CEN_LAT = 38.0
> >>>>>>>>>> CEN_LON = -100.0
> >>>>>>>>>> TRUELAT1 = 25.
> >>>>>>>>>> TRUELAT2 = 45.
> >>>>>>>>>>
> >>>>>>>>>> However, despite i have gone through many sites in the
> >>>> internet, i
> >>>>>> cant
> >>>>>>>>>> figure it out:
> >>>>>>>>>>
> >>>>>>>>>> a) if that is all the data i need to set a reference system for
> >>>> my
> >>>>>> points
> >>>>>>>>>> and the wrld_simp object.
> >>>>>>>>>>
> >>>>>>>>>> b) how to change a typical CRS object with such data
> >>>>>>>>>>
> >>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
> >>>>>>>>>>
> >>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
> >>>>>>>>>> Are there any site that explains easily what the fields in the
> >>>> CRS
> >>>>>> mean
> >>>>>>>>> and
> >>>>>>>>>> how to change them?
> >>>>>>>>>>
> >>>>>>>>>> Thanks in advance.
> >>>>>>>>>>
> >>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
> >>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
> >>>>>>>>>
> >>>>>>>>> I believe:
> >>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
> >>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
> >>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
> >>>>>>>>> +lon_0  = CEN_LON   Central meridian
> >>>>>>>>>
> >>>>>>>>> proj strings are defined by the proj4 libary. It's website listed
> >>>>> above
> >>>>>>>>> and the associated mailing lists or gis stackexchange would be
> >>>> the
> >>>>>>>>> places to get help on it.
> >>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
> >>>>>>>>>
> >>>>>>>>> It often helps to browse similar projections on
> >>>>>>>>> http://spatialreference.org/
> >>>>>>>>> http://epsg.io/
> >>>>>>>>>
> >>>>>>>>> Enjoy,
> >>>>>>>>> Alex
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>
> >>>>>>> _______________________________________________
> >>>>>>> R-sig-Geo mailing list
> >>>>>>> R-sig-Geo at r-project.org
> >>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>> --
> >>>>>> Roger Bivand
> >>>>>> Department of Economics, Norwegian School of Economics,
> >>>>>> Helleveien 30, N-5045 Bergen, Norway.
> >>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
> >>>>>> e-mail: Roger.Bivand at nhh.no
> >>>>>> http://orcid.org/0000-0003-2392-6140
> >>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
> >>>>>> http://depsy.org/person/434412
> >>>>>> _______________________________________________
> >>>>>> R-sig-Geo mailing list
> >>>>>> R-sig-Geo at r-project.org
> >>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>> --
> >>>>> Dr. Michael Sumner
> >>>>> Software and Database Engineer
> >>>>> Australian Antarctic Division
> >>>>> 203 Channel Highway
> >>>>> Kingston Tasmania 7050 Australia
> >>>>>
> >>>>>          [[alternative HTML version deleted]]
> >>>>>
> >>>>> _______________________________________________
> >>>>> R-sig-Geo mailing list
> >>>>> R-sig-Geo at r-project.org
> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>>
> >>>>
> >>>>
> >>>> --
> >>>> Agust?n Camacho Guerrero.
> >>>> Doutor em Zoologia.
> >>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> >>>> Bioci?ncias, USP.
> >>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> >>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
> >>>>
> >>>>          [[alternative HTML version deleted]]
> >>>>
> >>>> _______________________________________________
> >>>> R-sig-Geo mailing list
> >>>> R-sig-Geo at r-project.org
> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> >>>>
> >>>
> >>
> >> --
> >> Agust?n Camacho Guerrero.
> >> Doutor em Zoologia.
> >> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
> >> Bioci?ncias, USP.
> >> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
> >> S?o Paulo - SP, CEP: 05508-090, Brasil.
> >>
> >
> >
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

	[[alternative HTML version deleted]]


From thi_veloso at yahoo.com.br  Fri Feb 26 21:49:40 2016
From: thi_veloso at yahoo.com.br (Thiago V. dos Santos)
Date: Fri, 26 Feb 2016 20:49:40 +0000 (UTC)
Subject: [R-sig-Geo] Error running Mann-Kendall trend test on a raster stack
References: <1030783680.11714.1456519780832.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1030783680.11714.1456519780832.JavaMail.yahoo@mail.yahoo.com>

Dear colleagues,

I have a raster stack with 89 layers, each layer representing yearly precipitation.

I am trying to use the function rkt (from package "rkt") to detect a possible trend in my precipitation time series.

Its usage is pretty simple, and this is how it runs on a data frame:

--------------------------------
library(rkt)

# generate some random data
myDF <- data.frame(Date = seq.Date(as.Date("2011-01-01"), as.Date("2099-01-01"), by='year'),
value = runif(89,0,1200))

# extract year from date, as numeric
myDF$year <- as.numeric(format(myDF$Date, "%Y"))

# run mann-kendall test
kenn <- rkt(myDF$year, myDF$value)
kenn

--------------------------------

Now, this is my attempt to apply this test on a raster stack, using a calc function:

--------------------------------
library(raster)

# Create the date sequence
idx <- myDF$Date

# Create raster stack and apply the date
r <- raster(ncol=50, nrow=50)
s <- stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r), 0, 1200))))
s <- setZ(s, idx)
s

# Now I define a function
tsfun <- function(x) {
    year <- as.numeric(substr(getZ(x), 1, 4))
    r.kenn <- rkt(year, x)
    return(r.kenn)
}

# I apply the function
raster.kenn <- calc(s, fun=tsfun)

--------------------------------


And the error message I get is:

Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) : 
cannot use this function

What am I doing wrong here?
Greetings,
 -- Thiago V. dos Santos

PhD student
Land and Atmospheric Science
University of Minnesota


From tim.appelhans at gmail.com  Sat Feb 27 07:47:40 2016
From: tim.appelhans at gmail.com (Tim Appelhans)
Date: Sat, 27 Feb 2016 19:47:40 +1300
Subject: [R-sig-Geo] Error running Mann-Kendall trend test on a raster
 stack
In-Reply-To: <1030783680.11714.1456519780832.JavaMail.yahoo@mail.yahoo.com>
References: <1030783680.11714.1456519780832.JavaMail.yahoo.ref@mail.yahoo.com>
	<1030783680.11714.1456519780832.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <56D1468C.4050903@gmail.com>

Dear Thiago,
have a look at the gimms package, available on CRAN. The function of 
interest is significantTau().

https://github.com/environmentalinformatics-marburg/gimms/blob/master/R/significantTau.R

Hope this helps,
Tim

On 27.02.2016 09:49, Thiago V. dos Santos wrote:
> Dear colleagues,
>
> I have a raster stack with 89 layers, each layer representing yearly precipitation.
>
> I am trying to use the function rkt (from package "rkt") to detect a possible trend in my precipitation time series.
>
> Its usage is pretty simple, and this is how it runs on a data frame:
>
> --------------------------------
> library(rkt)
>
> # generate some random data
> myDF <- data.frame(Date = seq.Date(as.Date("2011-01-01"), as.Date("2099-01-01"), by='year'),
> value = runif(89,0,1200))
>
> # extract year from date, as numeric
> myDF$year <- as.numeric(format(myDF$Date, "%Y"))
>
> # run mann-kendall test
> kenn <- rkt(myDF$year, myDF$value)
> kenn
>
> --------------------------------
>
> Now, this is my attempt to apply this test on a raster stack, using a calc function:
>
> --------------------------------
> library(raster)
>
> # Create the date sequence
> idx <- myDF$Date
>
> # Create raster stack and apply the date
> r <- raster(ncol=50, nrow=50)
> s <- stack(lapply(1:length(idx), function(x) setValues(r, runif(ncell(r), 0, 1200))))
> s <- setZ(s, idx)
> s
>
> # Now I define a function
> tsfun <- function(x) {
>      year <- as.numeric(substr(getZ(x), 1, 4))
>      r.kenn <- rkt(year, x)
>      return(r.kenn)
> }
>
> # I apply the function
> raster.kenn <- calc(s, fun=tsfun)
>
> --------------------------------
>
>
> And the error message I get is:
>
> Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
> cannot use this function
>
> What am I doing wrong here?
> Greetings,
>   -- Thiago V. dos Santos
>
> PhD student
> Land and Atmospheric Science
> University of Minnesota
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo

-- 
#####################################
Tim Appelhans
Department of Geography
Environmental Informatics
Philipps Universit?t Marburg
Deutschhausstra?e 12
Raum 00A08
35032 Marburg (Paketpost: 35037 Marburg)
Germany

Tel +49 (0) 6421 28-25957

http://environmentalinformatics-marburg.de/


From jgrn at illinois.edu  Sat Feb 27 08:07:58 2016
From: jgrn at illinois.edu (Jonathan Greenberg)
Date: Sat, 27 Feb 2016 07:07:58 +0000
Subject: [R-sig-Geo] adapting spatial points and wrld_smpl to a
 reference system implicit in a .nc file
In-Reply-To: <CABG0rfsis0A6v3=YzrPomR6X7Xz6t4OftY7QN-VP35vhrdU3kg@mail.gmail.com>
References: <CALsJ7pQJf0Fr11QxUBy+WCGrd03SO484qZjxFFEfyeCN_qVUQw@mail.gmail.com>
	<56CB4DA6.1080502@wildintellect.com>
	<CALsJ7pR1NDMyQk5mWN09srXs7di3xkwhsnsSdybrGikPhUZ7iw@mail.gmail.com>
	<HE1PR04MB1276BCCCBCCA813F7955D118DBA40@HE1PR04MB1276.eurprd04.prod.outlook.com>
	<56CBFB77.4020707@wildintellect.com>
	<alpine.LFD.2.20.1602231001540.30237@reclus.nhh.no>
	<CAAcGz9-6dPcdYPHT0QLoNKud8NK0L=6j9vrq-TF=4ua7LpzZzw@mail.gmail.com>
	<CALsJ7pQGxR_sb9-4-_D9JzFnzW9zB-XXMSgqP1AMOq7ffLhxCQ@mail.gmail.com>
	<CAF1jk_k7tZbr2A0PMfv6cf=yhfV=ReDNaS+AcE=RAh9Tt_xxkQ@mail.gmail.com>
	<CALsJ7pRwPA1aN11WvBEHnha7yeyOnCGA1DYuu=urfebcdgfLXA@mail.gmail.com>
	<CALsJ7pSiAkuiQj5L3QYQrSv9iXr0siJ0F5jjWeQ+EbMVRsb6WA@mail.gmail.com>
	<56CD6B86.5090605@uni-marburg.de>
	<CABG0rfsis0A6v3=YzrPomR6X7Xz6t4OftY7QN-VP35vhrdU3kg@mail.gmail.com>
Message-ID: <CABG0rfuQnO9vobgkog1He8L83pyqFXE_bqoJvc1Tn87Giugb-w@mail.gmail.com>

Folks:

I went ahead and pushed a new version of gdalUtils to r-forge:

install.packages("gdalUtils", repos="http://R-Forge.R-project.org")

gdal_translate has a new option to attempt to fix the issue above.  Can you
confirm if e.g.:

gdal_translate(...,config='GDAL_NETCDF_BOTTOMUP="YES"')
works for your application?

--j

On Fri, Feb 26, 2016 at 9:17 AM Jonathan Greenberg <jgrn at illinois.edu>
wrote:

> Folks:
>
> Just noticed this thread -- I see I didn't include a "--config" option
> with any of the gdalUtils functions (it isn't one of the documented
> parameters on the individual utility website, but it seems it would have
> allowed you to run the GDAL_NETCDF_BOTTOMUP without setting a system
> environment variable -- see
> http://lists.osgeo.org/pipermail/gdal-dev/2014-July/039452.html).  If I
> make this tweak and pushed it to r-forge, would one of you be willing to
> see if it solves the problem?
>
> I assume this will be something that would be needed for any gdal utility
> that allows an "of" to be set?
>
> --j
>
> On Wed, Feb 24, 2016 at 2:37 AM Chris Reudenbach <
> reudenbach at uni-marburg.de> wrote:
>
>> Agus,
>>
>> sorry for the addon but I think I have to provide a correction of the
>> corner coordinates (e.g. the extent values):
>>
>> In the example that you have posted below I did calculate the extent
>> using the domain center coordinate and the WRF grid resolution in meter
>> and the number of rows and cols.
>>
>> Since Dominik provides a link to the file description of the netcdf file
>> I think it is more accurate to reproject the  corner coordinates  as
>> given by the netcdf header variables (NC_GLOBAL#corner_lats,
>> NC_GLOBAL#corner_lons). Assuming that your variable "dctmx" (which I can
>> not identfy it in the nc file)  is of type "Mass" (staggered = M) the
>> correct corner coordinates are stored as the first 4 entrys of the dump
>> snippet below:
>>
>> lats<-"
>>
>> NC_GLOBAL#corner_lats={12.355667,50.26619,50.26619,12.355667,12.308136,50.18787,50.18787,12.308136,12.210785,50.403816,50.403816,12.210785,12.163345,50.325382,50.325382,12.163345}"
>>
>> lons<-"
>>
>> NC_GLOBAL#corner_lons={-131.43678,-151.29639,-48.703613,-68.563232,-131.5851,-151.51157,-48.488434,-68.414917,-131.38828,-151.41891,-48.581085,-68.611725,-131.53641,-151.63441,-48.36557,-68.463593}"
>>
>> after cleaning and converting the strings you may calculate the corner
>> coordinates:
>>
>>
>> library(proj4)
>> ## project mass corner coordinates to lambertian
>> llMass <- ptransform(cbind(clon[1],clat[1])/180*pi,'+proj=longlat
>> +datum=WGS84 +no_defs',proj)
>> ulMass <- ptransform(cbind(clon[2],clat[2])/180*pi,'+proj=longlat
>> +datum=WGS84 +no_defs',proj)
>> lrMass <- ptransform(cbind(clon[3],clat[3])/180*pi,'+proj=longlat
>> +datum=WGS84 +no_defs',proj)
>> urMass <- ptransform(cbind(clon[4],clat[4])/180*pi,'+proj=longlat
>> +datum=WGS84 +no_defs',proj)
>> wrfLccExtMass<-extent(ulMass[1],lrMass[1],llMass[2],ulMass[2])
>>
>>
>> According to this the correct extent for mass variables should be:
>>
>> extent(wrfLccExtMass)
>> class       : Extent
>> xmin        : -3575343
>> xmax        : 3575342
>> ymin        : -2293058
>> ymax        : 2306330
>>
>>
>> hope this is correct now
>>
>> cheers Chris
>>
>> Am 24.02.2016 um 05:12 schrieb Agus Camacho:
>> > With the help of everybody i finally got this to work, so here is a
>> script
>> > that does the job of reprojecting both, a raster layer obtained from a
>> .nc
>> > and some locations in order to overplot them using plot.raster or
>> mapview.
>> > Im using a combination of the advices of Dominik, Michael and Chris.
>> >
>> >
>> > require(ncdf4)
>> > require(raster)
>> >
>> >
>> > setwd("C:/~")
>> >
>> >
>> > r=raster("geo_em.d01.nc",
>> >                varname="dctmx")# days of ctmax events
>> >
>> > # Set extent and projections of rasters for plotting
>> > # chris gave me the orig data fom the nc file because i could not
>> install
>> > gdal
>> > xmin= -3545999
>> > xmax= 3546000
>> > ymin = -2286000
>> > ymax=2286000
>> > pr<- "+proj=lcc +lat_1=25 +lat_2=45 +lat_0=38.000008 +lon_0=-100 +x_0=0
>> > +y_0=0"
>> >
>> > wrfLccExt<-extent(xmin,xmax,ymin,ymax)
>> >
>> > extent(r) <- extent(wrfLccExt)
>> > projection(r) <- pr
>> >
>> > # get and prepare  urosaurus locations
>> >
>> > x=read.csv("C:/Users/Agus/Dropbox/Functional Biogeography -
>> > Copy/scripts/class 4 maxent model/clean urosaurus records.csv")
>> > x=x[,1:3]
>> > colnames(x)
>> > coordinates(x)=~lon+lat
>> > proj4string(x)<- CRS("+proj=longlat +datum=WGS84")
>> > x=spTransform(x, pr)
>> >
>> >
>> > # get prepare and plot wrld_simpl
>> > require(maptools)
>> > require(sp)
>> > data(wrld_simpl)
>> > namer <- spTransform(subset(wrld_simpl, NAME %in% c("United States",
>> > "Canada", "Mexico")), prj)
>> >
>> > #plot with raster
>> > plot(r, cex.main=.7,legend=F)
>> > points(x)
>> > plot(namer, add = TRUE)
>> >
>> > # plot with mapview (cool!)
>> > m=mapview(r)
>> > u=mapview(x)
>> > m+u
>> >
>> >
>> > Thanks to all!
>> > Agus
>> >
>> > 2016-02-23 13:11 GMT-07:00 Agus Camacho <agus.camacho at gmail.com>:
>> >
>> >> Thanks for that Dominik,
>> >>
>> >> Giving that projection to either the locations, the raster layer
>> generated
>> >> from the .nc file, or both, still did not work. I keep having locations
>> >> that should be on land falling far on the sea. Might this be a problem
>> >> derived from using raster with a file whose original grid distances
>> are not
>> >> constant?
>> >>
>> >> Here is a link with the original file which has the original coordinate
>> >> data.
>> >>
>> >> https://www.dropbox.com/s/qpt5twtunhy3x3x/geo_em.d01.nc?dl=0
>> >>
>> >>
>> >> 2016-02-23 12:07 GMT-07:00 Dominik Schneider <
>> >> Dominik.Schneider at colorado.edu>:
>> >>
>> >>> This looks like WRF <http://www.wrf-model.org/index.php> data. I just
>> >>> dealt with this.
>> >>> The data is on a sphere as opposed to WGS84 so you need +ellps=sphere
>> >>> +a=6370000 +b=6370000 +units=m
>> >>>
>> >>> +proj=lcc which is usually what wrf is run with.
>> >>> The tricky part is:
>> >>> +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> >>> because every WRF run is different (the WRF Preprocessing System
>> >>> optimizes the projection for the domain).
>> >>> and then there is probably no shift so you need(?) +x_0=0 +y_0=0
>> >>>
>> >>> This gives:
>> >>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> >>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>> >>>
>> >>> But, wrf users like to give out lat and  long so you need to assign
>> it:
>> >>> +proj=longlat +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>> >>>
>> >>> and then reproject the lat/long to lcc coordinates using this string:
>> >>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0 +lon_0=-100.0
>> >>> +ellps=sphere +a=6370000 +b=6370000 +units=m +no_defs
>> >>>
>> >>> One word of caution, make sure you received the correct coordinates.
>> Some
>> >>> variables are run cell center while some are run at cell edge. It
>> looks
>> >>> like from your .nc file it was made by your collaborator so I assume
>> they
>> >>> are right.
>> >>>
>> >>> That said, another word of caution, I found that the XLAT and XLONG
>> >>> variables from WRF output aren't very precise. There is a "geogrid"
>> file
>> >>> from the preprocessing system that has the domain corners,
>> resolution, nrow
>> >>> and ncol from which you can make a better grid using the native
>> projection
>> >>> system (in my case it was a 4km grid). I suggest you try to get those.
>> >>>
>> >>> I hope this helps... I have to run but wanted to save people too much
>> >>> head scratching. I can get you running with more help tonight if you
>> need.
>> >>> Dominik
>> >>>
>> >>>
>> >>> On Tue, Feb 23, 2016 at 11:27 AM, Agus Camacho <
>> agus.camacho at gmail.com>
>> >>> wrote:
>> >>>
>> >>>> Thanks heaps to all for your effort. If I go to another GEOSTAT ill
>> bring
>> >>>> more giant crab this time.
>> >>>>
>> >>>> The creator of the .nc file also looked at this webpage:
>> >>>> http://www.pkrc.net/wrf-lambert.html
>> >>>> It seemed like the right proj4 string might be this one:
>> >>>>
>> >>>> +proj=lcc +lat_1=25.0 +lat_2=45.0 +lat_0=38.0
>> >>>>      +lon_0=-100.0 +a=6370 +b=6370 +towgs84=0,0,0 +no_defs
>> >>>>
>> >>>> However this projection also does not allow me to adequately plot the
>> >>>> locations on the raster.
>> >>>>
>> >>>> Here is the .nc file. it contains several layers.
>> >>>>
>> >>>>
>> >>>>
>> https://www.dropbox.com/s/yto3linsgom3zi7/results_us_future_output_none_0.nc?dl=0
>> >>>>
>> >>>>
>> >>>>
>> >>>> 2016-02-23 2:25 GMT-07:00 Michael Sumner <mdsumner at gmail.com>:
>> >>>>
>> >>>>> On Tue, 23 Feb 2016 at 20:09 Roger Bivand <Roger.Bivand at nhh.no>
>> wrote:
>> >>>>>
>> >>>>>> On Tue, 23 Feb 2016, Alex Mandel wrote:
>> >>>>>>
>> >>>>>>> I made an attempt at it too. Investigating the original data, I'm
>> >>>> not
>> >>>>>>> sure that the projection information supplied is correct for the
>> >>>> data
>> >>>>>>> linked. When I load up the data in a unprojected space, the
>> >>>> coordinates
>> >>>>>>> don't look at all similar to any Lambert projected data I have,
>> >>>> they
>> >>>>>>> actually look like Lat/Lon in some unprojected coordinate system,
>> >>>>>>> perhaps a different spheroid than expected.
>> >>>>>> Does anyone have a link to the original data? Is is possible that
>> >>>> this is
>> >>>>>> the General Oblique Transformation used by modellers - that is
>> >>>> something
>> >>>>>> that feels like longlat but is recentred and oblique? Example at
>> the
>> >>>> very
>> >>>>>> end of my GEOSTAT talk last year (slides 81-83):
>> >>>>>>
>> >>>>>> http://geostat-course.org/system/files/geostat_talk_150817.pdf
>> >>>>>>
>> >>>>>> Roger
>> >>>>>>
>> >>>>>>
>> >>>>> For what it is worth, the General Oblique Transformation is not the
>> >>>> only
>> >>>>> example - it's very common for modellers to have a mesh that has the
>> >>>>> "mostly-properties" of a projection, but is not actually describable
>> >>>> with
>> >>>>> standard transform + affine parameters. The main cases that I've
>> seen
>> >>>> are
>> >>>>> polar stereographic, equal area or oblique Mercator. Often they
>> really
>> >>>> are
>> >>>>> simple transforms and you can reconstruct without loss, but it's not
>> >>>>> usually possible to tell without exploration. It's an interesting
>> >>>>> dis-connect to see code that builds a mesh with certain properties,
>> >>>> then
>> >>>>> only stores longitudes and latitudes - when it could be done with
>> >>>> standard
>> >>>>> tools and be stored and used much more efficiently.
>> >>>>>
>> >>>>> (I've seen Lambert Conformal Conic and Lambert Azimuthal Equal Area
>> >>>>> terminology conflated in this context too. )
>> >>>>>
>> >>>>> I'm also interested to explore the original data.
>> >>>>>
>> >>>>> Cheers, Mike.
>> >>>>>
>> >>>>>
>> >>>>>
>> >>>>>>> -Alex
>> >>>>>>>
>> >>>>>>> On 02/22/2016 10:17 PM, Frede Aakmann T?gersen wrote:
>> >>>>>>>> Hi
>> >>>>>>>>
>> >>>>>>>> I tried to make it work but I had to give up. I wanted to
>> >>>> reproject
>> >>>>> the
>> >>>>>> Lamberth conformal conic coordinates to long-lat but it didn't
>> work.
>> >>>>>>>> Perhaps someone can see what I did wrong. Here is what I did
>> >>>> (data in
>> >>>>> R
>> >>>>>> binary format and figure in png format both attached):
>> >>>>>>>> library(raster)
>> >>>>>>>> library(maptools)
>> >>>>>>>> data(wrld_simpl)
>> >>>>>>>>
>> >>>>>>>> r <- raster("raster.grd")
>> >>>>>>>> projection(r)
>> >>>>>>>> ## > NA
>> >>>>>>>>
>> >>>>>>>> uro <- read.table("clean urosaurus records.csv", h = TRUE, sep =
>> >>>> ",")
>> >>>>>>>> coordinates(uro) <- ~lon+lat
>> >>>>>>>>
>> >>>>>>>> ## Set projections for the 3 data sets
>> >>>>>>>>
>> >>>>>>>> ## Lamberth's confocal conic projection with given parameters
>> >>>>>>>> crs(r) <- "+proj=lcc +lat_0=38.0 +lon_0=-100 +lat_1=25.0
>> >>>> +lat_2=45.0
>> >>>>>> +ellps=WGS84"
>> >>>>>>>> projection(r)
>> >>>>>>>>
>> >>>>>>>> ## Assume that lon, lat are geographical coordinates (degrees
>> >>>> decimal)
>> >>>>>>>> proj4string(uro) <- CRS("+proj=longlat +datum=WGS84")
>> >>>>>>>>
>> >>>>>>>> ## wrld_simpl is in geographical coordinates
>> >>>>>>>> proj4string(wrld_simpl)
>> >>>>>>>>
>> >>>>>>>> ## Make figure in png format
>> >>>>>>>> ## Of course plotting data with 2 different projections will give
>> >>>>>>>> ## some distortions
>> >>>>>>>> pdf("uro.png")
>> >>>>>>>>
>> >>>>>>>> plot(r)
>> >>>>>>>> points(uro)
>> >>>>>>>> plot(wrld_simpl, add = TRUE) # World will be clipped to extent of
>> >>>> 'r'
>> >>>>>>>> dev.off()
>> >>>>>>>>
>> >>>>>>>> extent(r)
>> >>>>>>>> ## class       : Extent
>> >>>>>>>> ## xmin        : -131.4368
>> >>>>>>>> ## xmax        : -68.56323
>> >>>>>>>> ## ymin        : 12.35567
>> >>>>>>>> ## ymax        : 50.26619
>> >>>>>>>>
>> >>>>>>>> ## Reproject the raster to long-lat
>> >>>>>>>> ## This doesn't work (collapsed domain)
>> >>>>>>>> rp <- projectRaster(r, crs = "+proj=longlat +datum=WGS84 +no_defs
>> >>>>>> +ellps=WGS84 +towgs84=0,0,0")
>> >>>>>>>> ## Because
>> >>>>>>>>> extent(rp)
>> >>>>>>>> ## class       : Extent
>> >>>>>>>> ## xmin        : -100.0015
>> >>>>>>>> ## xmax        : -99.68557
>> >>>>>>>> ## ymin        : 37.70658
>> >>>>>>>> ## ymax        : 38.00046
>> >>>>>>>>
>> >>>>>>>> ## Save data in R binary format
>> >>>>>>>> save(list = c("r", "uro", "wrld_simpl"), file = "uro.RData")
>> >>>>>>>>
>> >>>>>>>>
>> >>>>>>>> Yours sincerely / Med venlig hilsen
>> >>>>>>>>
>> >>>>>>>> Frede Aakmann T?gersen
>> >>>>>>>> Specialist, M.Sc., Ph.D.
>> >>>>>>>> Plant Performance & Modeling
>> >>>>>>>>
>> >>>>>>>> Technology & Service Solutions
>> >>>>>>>> T +45 9730 5135
>> >>>>>>>> M +45 2547 6050
>> >>>>>>>> frtog at vestas.com
>> >>>>>>>> http://www.vestas.com
>> >>>>>>>>
>> >>>>>>>> Company reg. name: Vestas Wind Systems A/S
>> >>>>>>>> This e-mail is subject to our e-mail disclaimer statement.
>> >>>>>>>> Please refer to www.vestas.com/legal/notice
>> >>>>>>>> If you have received this e-mail in error please contact the
>> >>>> sender.
>> >>>>>>>>
>> >>>>>>>>
>> >>>>>>>> -----Original Message-----
>> >>>>>>>> From: R-sig-Geo [mailto:r-sig-geo-bounces at r-project.org] On
>> >>>> Behalf Of
>> >>>>>> Agus Camacho
>> >>>>>>>> Sent: 22. februar 2016 19:20
>> >>>>>>>> To: tech at wildintellect.com
>> >>>>>>>> Cc: r-sig-geo
>> >>>>>>>> Subject: Re: [R-sig-Geo] adapting spatial points and wrld_smpl to
>> >>>> a
>> >>>>>> reference system implicit in a .nc file
>> >>>>>>>> Thanks Alex, but the locations still fall in the sea when i plot
>> >>>> them
>> >>>>>> using
>> >>>>>>>> your recommended Solution. I looked at the sites you proposed and
>> >>>> they
>> >>>>>> have
>> >>>>>>>> other values for lat_1, lat_0, etc..
>> >>>>>>>>
>> >>>>>>>> 2016-02-22 11:04 GMT-07:00 Alex M <tech_dev at wildintellect.com>:
>> >>>>>>>>
>> >>>>>>>>> On 02/22/2016 09:50 AM, Agus Camacho wrote:
>> >>>>>>>>>> Dear all,
>> >>>>>>>>>>
>> >>>>>>>>>> Im trying to overlap these points:
>> >>>>>>>>>>
>> >>>>
>> https://www.dropbox.com/s/awdclg4cvsdngej/clean%20urosaurus%20records.csv?dl=0
>> >>>>>>>>>> and a wrld_simpl object:
>> >>>>>>>>>> library(maptools)
>> >>>>>>>>>> data(wrld_simpl)
>> >>>>>>>>>>
>> >>>>>>>>>> Over this raster layer
>> >>>>>>>>>>
>> >>>>
>> https://www.dropbox.com/sh/qcw174tgogpnz7s/AAByDc3TeyFe3W4nEqTFix6Oa?dl=0
>> >>>>>>>>>> This rastr comes from a .nc file without a reference system.
>> The
>> >>>>>> author
>> >>>>>>>>> of
>> >>>>>>>>>> that .nc file gave me the following data about the .nc.
>> >>>>>>>>>>
>> >>>>>>>>>> The projection is *Lambert conformal conic* projection
>> >>>>>>>>>> CEN_LAT = 38.0
>> >>>>>>>>>> CEN_LON = -100.0
>> >>>>>>>>>> TRUELAT1 = 25.
>> >>>>>>>>>> TRUELAT2 = 45.
>> >>>>>>>>>>
>> >>>>>>>>>> However, despite i have gone through many sites in the
>> >>>> internet, i
>> >>>>>> cant
>> >>>>>>>>>> figure it out:
>> >>>>>>>>>>
>> >>>>>>>>>> a) if that is all the data i need to set a reference system for
>> >>>> my
>> >>>>>> points
>> >>>>>>>>>> and the wrld_simp object.
>> >>>>>>>>>>
>> >>>>>>>>>> b) how to change a typical CRS object with such data
>> >>>>>>>>>>
>> >>>>>>>>>> Ex.CRS ("+proj=lcc+lat_0=38.0+lon0_2=-100+ellps=WGS84")
>> >>>>>>>>>>
>> >>>>>>>>>> Where do i enter the TRUELAT and CENLAT values?
>> >>>>>>>>>> Are there any site that explains easily what the fields in the
>> >>>> CRS
>> >>>>>> mean
>> >>>>>>>>> and
>> >>>>>>>>>> how to change them?
>> >>>>>>>>>>
>> >>>>>>>>>> Thanks in advance.
>> >>>>>>>>>>
>> >>>>>>>>> https://github.com/OSGeo/proj.4/wiki/GenParms
>> >>>>>>>>> https://trac.osgeo.org/proj/wiki/GenParms
>> >>>>>>>>>
>> >>>>>>>>> I believe:
>> >>>>>>>>> +lat_0  = CEN_LAT   Latitude of origin
>> >>>>>>>>> +lat_1  = TRUELAT1   Latitude of first standard parallel
>> >>>>>>>>> +lat_2  = TRUELAT2   Latitude of second standard parallel
>> >>>>>>>>> +lon_0  = CEN_LON   Central meridian
>> >>>>>>>>>
>> >>>>>>>>> proj strings are defined by the proj4 libary. It's website
>> listed
>> >>>>> above
>> >>>>>>>>> and the associated mailing lists or gis stackexchange would be
>> >>>> the
>> >>>>>>>>> places to get help on it.
>> >>>>>>>>> https://lists.osgeo.org/mailman/listinfo/metacrs
>> >>>>>>>>>
>> >>>>>>>>> It often helps to browse similar projections on
>> >>>>>>>>> http://spatialreference.org/
>> >>>>>>>>> http://epsg.io/
>> >>>>>>>>>
>> >>>>>>>>> Enjoy,
>> >>>>>>>>> Alex
>> >>>>>>>>>
>> >>>>>>>>>
>> >>>>>>>>
>> >>>>>>> _______________________________________________
>> >>>>>>> R-sig-Geo mailing list
>> >>>>>>> R-sig-Geo at r-project.org
>> >>>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>>>> --
>> >>>>>> Roger Bivand
>> >>>>>> Department of Economics, Norwegian School of Economics,
>> >>>>>> Helleveien 30, N-5045 Bergen, Norway.
>> >>>>>> voice: +47 55 95 93 55; fax +47 55 95 91 00
>> >>>>>> e-mail: Roger.Bivand at nhh.no
>> >>>>>> http://orcid.org/0000-0003-2392-6140
>> >>>>>> https://scholar.google.no/citations?user=AWeghB0AAAAJ&hl=en
>> >>>>>> http://depsy.org/person/434412
>> >>>>>> _______________________________________________
>> >>>>>> R-sig-Geo mailing list
>> >>>>>> R-sig-Geo at r-project.org
>> >>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>>> --
>> >>>>> Dr. Michael Sumner
>> >>>>> Software and Database Engineer
>> >>>>> Australian Antarctic Division
>> >>>>> 203 Channel Highway
>> >>>>> Kingston Tasmania 7050 Australia
>> >>>>>
>> >>>>>          [[alternative HTML version deleted]]
>> >>>>>
>> >>>>> _______________________________________________
>> >>>>> R-sig-Geo mailing list
>> >>>>> R-sig-Geo at r-project.org
>> >>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>>>
>> >>>>
>> >>>>
>> >>>> --
>> >>>> Agust?n Camacho Guerrero.
>> >>>> Doutor em Zoologia.
>> >>>> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>> >>>> Bioci?ncias, USP.
>> >>>> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>> >>>> S?o Paulo - SP, CEP: 05508-090, Brasil.
>> >>>>
>> >>>>          [[alternative HTML version deleted]]
>> >>>>
>> >>>> _______________________________________________
>> >>>> R-sig-Geo mailing list
>> >>>> R-sig-Geo at r-project.org
>> >>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>> >>>>
>> >>>
>> >>
>> >> --
>> >> Agust?n Camacho Guerrero.
>> >> Doutor em Zoologia.
>> >> Laborat?rio de Herpetologia, Departamento de Zoologia, Instituto de
>> >> Bioci?ncias, USP.
>> >> Rua do Mat?o, trav. 14, n? 321, Cidade Universit?ria,
>> >> S?o Paulo - SP, CEP: 05508-090, Brasil.
>> >>
>> >
>> >
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

	[[alternative HTML version deleted]]


From loic.dutrieux at wur.nl  Sat Feb 27 12:16:39 2016
From: loic.dutrieux at wur.nl (=?UTF-8?Q?Lo=c3=afc_Dutrieux?=)
Date: Sat, 27 Feb 2016 12:16:39 +0100
Subject: [R-sig-Geo] Error running Mann-Kendall trend test on a raster
 stack
In-Reply-To: <56D1468C.4050903@gmail.com>
References: <1030783680.11714.1456519780832.JavaMail.yahoo.ref@mail.yahoo.com>
	<1030783680.11714.1456519780832.JavaMail.yahoo@mail.yahoo.com>
	<56D1468C.4050903@gmail.com>
Message-ID: <56D18597.4020700@wur.nl>

Hi Thiago,

A few calc tips inline that you can use together with Tim's suggestion.

On 02/27/2016 07:47 AM, Tim Appelhans wrote:
> Dear Thiago,
> have a look at the gimms package, available on CRAN. The function of
> interest is significantTau().
>
> https://github.com/environmentalinformatics-marburg/gimms/blob/master/R/significantTau.R
>
>
> Hope this helps,
> Tim
>
> On 27.02.2016 09:49, Thiago V. dos Santos wrote:
>> Dear colleagues,
>>
>> I have a raster stack with 89 layers, each layer representing yearly
>> precipitation.
>>
>> I am trying to use the function rkt (from package "rkt") to detect a
>> possible trend in my precipitation time series.
>>
>> Its usage is pretty simple, and this is how it runs on a data frame:
>>
>> --------------------------------
>> library(rkt)
>>
>> # generate some random data
>> myDF <- data.frame(Date = seq.Date(as.Date("2011-01-01"),
>> as.Date("2099-01-01"), by='year'),
>> value = runif(89,0,1200))
>>
>> # extract year from date, as numeric
>> myDF$year <- as.numeric(format(myDF$Date, "%Y"))
>>
>> # run mann-kendall test
>> kenn <- rkt(myDF$year, myDF$value)
>> kenn
>>
>> --------------------------------
>>
>> Now, this is my attempt to apply this test on a raster stack, using a
>> calc function:
>>
>> --------------------------------
>> library(raster)
>>
>> # Create the date sequence
>> idx <- myDF$Date
>>
>> # Create raster stack and apply the date
>> r <- raster(ncol=50, nrow=50)
>> s <- stack(lapply(1:length(idx), function(x) setValues(r,
>> runif(ncell(r), 0, 1200))))
>> s <- setZ(s, idx)
>> s
>>
>> # Now I define a function
>> tsfun <- function(x) {
>>      year <- as.numeric(substr(getZ(x), 1, 4))
>>      r.kenn <- rkt(year, x)
>>      return(r.kenn)
>> }

You can't call getZ() on x. Within the calc function environment x is a 
numeric vector not a RasterBrick.
If you do it outside of the function and refer to it within the function 
it should work.
dates <- getZ(s) # then use the dates variable in the function.

You can only store numerics in raster cells, and r.kenn is a full 
object. You need to choose which numerics contained in that object you 
want the function to return and subset the object accordingly.

Functions passed to calc should work on numeric vectors and ideally they 
should also be vectorized. It's not always easy to vectorize a function 
though; so in such case you can set the forceapply= argument to TRUE. I 
believe that may cost a bit of speed though.

Cheers,
Lo?c

>>
>> # I apply the function
>> raster.kenn <- calc(s, fun=tsfun)
>>
>> --------------------------------
>>
>>
>> And the error message I get is:
>>
>> Error in .calcTest(x[1:5], fun, na.rm, forcefun, forceapply) :
>> cannot use this function
Always loved that very informative error message from calc :)
>>
>> What am I doing wrong here?
>> Greetings,
>>   -- Thiago V. dos Santos
>>
>> PhD student
>> Land and Atmospheric Science
>> University of Minnesota
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>


From alobolistas at gmail.com  Sun Feb 28 18:30:26 2016
From: alobolistas at gmail.com (Agustin Lobo)
Date: Sun, 28 Feb 2016 18:30:26 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <56D061FF.6030509@uni-marburg.de>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
	<CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
	<56CF4B1C.5020401@uni-marburg.de>
	<CAG4NRe+MAFOmi=ZzTmhDVZQwn1K-xYLay16nYw-+04h+MhNCLw@mail.gmail.com>
	<56D061FF.6030509@uni-marburg.de>
Message-ID: <CAG4NReL3sv+JYdbO8BypUsf2Sb5t-Uity1+4UY2O_+Tq43Wq9A@mail.gmail.com>

I get an error at installing from github on MacOSX10.9.5 that I have reported
to https://github.com/environmentalinformatics-marburg/mapview/issues
and it is being dealt there.

With the cran version mapview_1.0.0, I have problems to select the
type of map, I always get the OSM one. I've tried both
nica <- getData("GADM", country="NIC", level=0)
spplot(mapView(nica["ISO"]),colorkey=FALSE,
       map.type="Thunderforest.Landscape")
as in your example and
spplot(mapView(nica["ISO"],map.types="Thunderforest.Landscape"),
     colorkey=FALSE)

Note that mapView() selects the correct map:
mapView(nica,map.types="Thunderforest.Landscape" )

Also, it seems to me that the mapView() display is always projected
(perhaps Pseudo Mercator epsg:3857 ?) even if the spatial object used
in mapView() has another CRS.
In other words
mapView(nica)
is displayed on Pseudo Mercator even if
projection(nica)
[1] "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

Am I wrong?

Finally, is there a way of including an scale bar? Actually, this
option would be interesting even for interactive display.

Thanks
Agus

On Fri, Feb 26, 2016 at 3:32 PM, Chris Reudenbach
<reudenbach at uni-marburg.de> wrote:
> Agus,
>
> Mapview is using leaflet as engine. Due to this you will have the control
> icons on the map because first of all it is designed for interactive mapping
> within RStudio/R.
>
> I think there are two different approaches to save your maps:
>
> If you want to have a dump of the mapviewobject (but including the graphical
> buttons) you'll find a descriptat stackoverflow
> http://stackoverflow.com/questions/31336898/how-to-save-leaflet-in-rstudio-map-as-png-or-jpg-file
>
>
> You may also use  the spplot function from mapview which is designed for
> basic static mapping and to make usable the adavantages of spplot.
>
> Note even if you are dealing with the mapview map object the spplot function
> uses the Openstreetmap package for retrieving  the background maps  (e.g.
> http://www.inside-r.org/packages/cran/OpenStreetMap/docs/openmap). You can
> use the spplot syntax for designing your maps. Up to now this static
> plotting function is still pretty  basic but you may have a try:
> spplot(mapView(nica["POP2000"]),colorkey=FALSE,  lwd= 15, alpha.regions =
> 0.9,
> map.type="stamen-watercolor" )
>
> I think for using the spplot it is better to install the current stable from
> github:
> library(devtools)
> install_github("environmentalinformatics-marburg/mapview", ref = "master")
>
>
> cheers chris
>
>
>
> Am 26.02.2016 um 12:27 schrieb Agustin Lobo:
>>
>> Stunning!
>> Can I remove the buttons for saving to a bmp file?
>> What attribution should be used for publishing?
>> Agus
>>
>> On Thu, Feb 25, 2016 at 7:42 PM, Chris Reudenbach
>> <reudenbach at uni-marburg.de> wrote:
>>>
>>> Hi,
>>>
>>> if you just want to map the data, mapview could be an option that among
>>> others avoid the pixel stretching.
>>>
>>> require(mapview)
>>> require(raster)
>>> nica <- getData("GADM", country="NIC", level=0)
>>>
>>> mapview(nica)
>>>
>>> mapview(nica,zcol = "POP2000", color = "#FFA500", lwd= 5, alpha.regions =
>>> 0.4)
>>>
>>>
>>> cheers Chris
>>>
>>>
>>>
>>>
>>> Am 25.02.2016 um 18:49 schrieb Barry Rowlingson:
>>>>
>>>> On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com>
>>>> wrote:
>>>>>
>>>>> Is there any way to download the raster layers
>>>>> of openmap() with an increased resolution?
>>>>> I find the quality of the labels very low,
>>>>> or am I doing something wrong? i.e.
>>>>>
>>>>> require(raster)
>>>>> require(mapmisc)
>>>>> nica <- getData("GADM", country="NIC", level=0)
>>>>> nicabg <- openmap(nica, path="landscape")
>>>>> plot(nicabg)
>>>>
>>>>    Map tiles from OpenStreetMap and other map tile providers are images
>>>> designed to be shown at a fixed resolution. When you plot them in an R
>>>> graphics window you could be stretching them so that each pixel in the
>>>> original maps to 1.273 pixels on your screen. So some kind of
>>>> interpolation or nearest neighbour replacement has to be done, and
>>>> this makes text labels look bad. Other line work will look bad too.
>>>>
>>>>    If you try and download more map tiles at a higher resolution then
>>>> you'll find the labels are now way too small, because what you've
>>>> downloaded are map tiles designed for a higher zoom level on a web
>>>> browser. Web map browsers have a fixed set of zoom values that
>>>> correspond to the resolution of the map tiles. With an R window, you
>>>> are free to choose odd zoom factors that give the ugly behaviour.
>>>>
>>>>    If you can resize your R window exactly right then you might get
>>>> something that looks good!
>>>>
>>>>    The alternative is to build a background map yourself from
>>>> OpenStreetMap *vector* data and some code and some styling. Or use a
>>>> map tile provider that doesn't have text labels and add them to
>>>> selected places with R graphics commands. Lines and polygons will
>>>> still be stretched and a bit "jaggy" but our eyes don't notice this as
>>>> much as badly scaled text.
>>>>
>>>> Barry
>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>
>>> _______________________________________________
>>> R-sig-Geo mailing list
>>> R-sig-Geo at r-project.org
>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From edzer.pebesma at uni-muenster.de  Sun Feb 28 20:33:46 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Sun, 28 Feb 2016 20:33:46 +0100
Subject: [R-sig-Geo] resolution of openmap() raster layers
In-Reply-To: <CAG4NReL3sv+JYdbO8BypUsf2Sb5t-Uity1+4UY2O_+Tq43Wq9A@mail.gmail.com>
References: <CAG4NRe+4Zr04+sh=RWw=cYg=+h=iQCg4cxyOrZDLtZNLcw4Uvw@mail.gmail.com>
	<CANVKczOqc-OAJEiL2T+cOi0piiCxAQCHZvaGf62SXNQdhFhLUg@mail.gmail.com>
	<56CF4B1C.5020401@uni-marburg.de>
	<CAG4NRe+MAFOmi=ZzTmhDVZQwn1K-xYLay16nYw-+04h+MhNCLw@mail.gmail.com>
	<56D061FF.6030509@uni-marburg.de>
	<CAG4NReL3sv+JYdbO8BypUsf2Sb5t-Uity1+4UY2O_+Tq43Wq9A@mail.gmail.com>
Message-ID: <56D34B9A.7020505@uni-muenster.de>

Please don't reply to an existing thread with a new topic!

On 28/02/16 18:30, Agustin Lobo wrote:
> I get an error at installing from github on MacOSX10.9.5 that I have reported
> to https://github.com/environmentalinformatics-marburg/mapview/issues
> and it is being dealt there.
> 
> With the cran version mapview_1.0.0, I have problems to select the
> type of map, I always get the OSM one. I've tried both
> nica <- getData("GADM", country="NIC", level=0)
> spplot(mapView(nica["ISO"]),colorkey=FALSE,
>        map.type="Thunderforest.Landscape")
> as in your example and
> spplot(mapView(nica["ISO"],map.types="Thunderforest.Landscape"),
>      colorkey=FALSE)
> 
> Note that mapView() selects the correct map:
> mapView(nica,map.types="Thunderforest.Landscape" )

Why raise this here again?

> 
> Also, it seems to me that the mapView() display is always projected
> (perhaps Pseudo Mercator epsg:3857 ?) even if the spatial object used
> in mapView() has another CRS.
> In other words
> mapView(nica)
> is displayed on Pseudo Mercator even if
> projection(nica)
> [1] "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
> 
> Am I wrong?

The mapview docs at
http://environmentalinformatics-marburg.github.io/web-presentations/20150723_mapView.html
(linked from the github main page) say "Note that in order to render
properly, all layers need to be re-projected to leaflet?s underlying web
mercator projection".

Welcome to the world of web maps! leaflet, ggmap, RGoogleMaps all do
this; mapview builds on leaflet.

You probably also noted issue #13 which I filed a week before yours,
https://github.com/environmentalinformatics-marburg/mapview/issues/13
which discusses mapview support for other projections.

Even although there is a proj4leaflet extension, there is right now
hardly any tile server (backdrop) support for non-web mercator projections.

> 
> Finally, is there a way of including an scale bar? Actually, this
> option would be interesting even for interactive display.

Looks like leaflet has support for this but that the R leaflet package
doesn't -- http://leafletjs.com/reference.html#control-scale -- maybe
something you can contribute to leaflet and/or mapview?

> 
> Thanks
> Agus
> 
> On Fri, Feb 26, 2016 at 3:32 PM, Chris Reudenbach
> <reudenbach at uni-marburg.de> wrote:
>> Agus,
>>
>> Mapview is using leaflet as engine. Due to this you will have the control
>> icons on the map because first of all it is designed for interactive mapping
>> within RStudio/R.
>>
>> I think there are two different approaches to save your maps:
>>
>> If you want to have a dump of the mapviewobject (but including the graphical
>> buttons) you'll find a descriptat stackoverflow
>> http://stackoverflow.com/questions/31336898/how-to-save-leaflet-in-rstudio-map-as-png-or-jpg-file
>>
>>
>> You may also use  the spplot function from mapview which is designed for
>> basic static mapping and to make usable the adavantages of spplot.
>>
>> Note even if you are dealing with the mapview map object the spplot function
>> uses the Openstreetmap package for retrieving  the background maps  (e.g.
>> http://www.inside-r.org/packages/cran/OpenStreetMap/docs/openmap). You can
>> use the spplot syntax for designing your maps. Up to now this static
>> plotting function is still pretty  basic but you may have a try:
>> spplot(mapView(nica["POP2000"]),colorkey=FALSE,  lwd= 15, alpha.regions =
>> 0.9,
>> map.type="stamen-watercolor" )
>>
>> I think for using the spplot it is better to install the current stable from
>> github:
>> library(devtools)
>> install_github("environmentalinformatics-marburg/mapview", ref = "master")
>>
>>
>> cheers chris
>>
>>
>>
>> Am 26.02.2016 um 12:27 schrieb Agustin Lobo:
>>>
>>> Stunning!
>>> Can I remove the buttons for saving to a bmp file?
>>> What attribution should be used for publishing?
>>> Agus
>>>
>>> On Thu, Feb 25, 2016 at 7:42 PM, Chris Reudenbach
>>> <reudenbach at uni-marburg.de> wrote:
>>>>
>>>> Hi,
>>>>
>>>> if you just want to map the data, mapview could be an option that among
>>>> others avoid the pixel stretching.
>>>>
>>>> require(mapview)
>>>> require(raster)
>>>> nica <- getData("GADM", country="NIC", level=0)
>>>>
>>>> mapview(nica)
>>>>
>>>> mapview(nica,zcol = "POP2000", color = "#FFA500", lwd= 5, alpha.regions =
>>>> 0.4)
>>>>
>>>>
>>>> cheers Chris
>>>>
>>>>
>>>>
>>>>
>>>> Am 25.02.2016 um 18:49 schrieb Barry Rowlingson:
>>>>>
>>>>> On Thu, Feb 25, 2016 at 5:11 PM, Agustin Lobo <alobolistas at gmail.com>
>>>>> wrote:
>>>>>>
>>>>>> Is there any way to download the raster layers
>>>>>> of openmap() with an increased resolution?
>>>>>> I find the quality of the labels very low,
>>>>>> or am I doing something wrong? i.e.
>>>>>>
>>>>>> require(raster)
>>>>>> require(mapmisc)
>>>>>> nica <- getData("GADM", country="NIC", level=0)
>>>>>> nicabg <- openmap(nica, path="landscape")
>>>>>> plot(nicabg)
>>>>>
>>>>>    Map tiles from OpenStreetMap and other map tile providers are images
>>>>> designed to be shown at a fixed resolution. When you plot them in an R
>>>>> graphics window you could be stretching them so that each pixel in the
>>>>> original maps to 1.273 pixels on your screen. So some kind of
>>>>> interpolation or nearest neighbour replacement has to be done, and
>>>>> this makes text labels look bad. Other line work will look bad too.
>>>>>
>>>>>    If you try and download more map tiles at a higher resolution then
>>>>> you'll find the labels are now way too small, because what you've
>>>>> downloaded are map tiles designed for a higher zoom level on a web
>>>>> browser. Web map browsers have a fixed set of zoom values that
>>>>> correspond to the resolution of the map tiles. With an R window, you
>>>>> are free to choose odd zoom factors that give the ugly behaviour.
>>>>>
>>>>>    If you can resize your R window exactly right then you might get
>>>>> something that looks good!
>>>>>
>>>>>    The alternative is to build a background map yourself from
>>>>> OpenStreetMap *vector* data and some code and some styling. Or use a
>>>>> map tile provider that doesn't have text labels and add them to
>>>>> selected places with R graphics commands. Lines and polygons will
>>>>> still be stretched and a bit "jaggy" but our eyes don't notice this as
>>>>> much as badly scaled text.
>>>>>
>>>>> Barry
>>>>>
>>>>> _______________________________________________
>>>>> R-sig-Geo mailing list
>>>>> R-sig-Geo at r-project.org
>>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>>>>
>>>> _______________________________________________
>>>> R-sig-Geo mailing list
>>>> R-sig-Geo at r-project.org
>>>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>>
>>
>> _______________________________________________
>> R-sig-Geo mailing list
>> R-sig-Geo at r-project.org
>> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160228/4cd44144/attachment.bin>

From diego.pavonjordan at gmail.com  Mon Feb 29 08:34:02 2016
From: diego.pavonjordan at gmail.com (Diego Pavon)
Date: Mon, 29 Feb 2016 09:34:02 +0200
Subject: [R-sig-Geo] Plotting Kernel results with ggplot2
Message-ID: <CAD93_Fr7vHrbj5hXMO1nQTtM7jz=bO_00b1rJrurPCo54X2Mmg@mail.gmail.com>

Hello list

I am trying to do a Kernel analysis of bird ring recoveries and I would
like to plot the kernel contour in ggplot. I have found that the command
'stat_density_2d()' can do this kernels. However, when I plot it, it draws
all the kernels from 10%... 90%.  See example below:

# Simulate data
xy <- data.frame(x = runif(30), y = runif(30))
coordinates(xy) <- ~ x + y
plot(xy)
class(xy)

# Transform SpatialPoints into a data.frame to be used in ggplot2
xy.df <- as.data.frame(xy)
head(xy.df)
str(xy.df)

# Make the plot
p <- ggplot(data=xy.df, aes(background="white"))
p <- p + geom_point(aes(x=x, y=y),
                    data = xy.df,
                    size = 4)
p <- p + xlab("X") + ylab("Y")
p <- p + theme(text = element_text(size = 15))
p

# This makes the kernels
p2 <- p + stat_density_2d(data = xy.df, aes(x=x, y=y), col = 'red', alpha =
0.6)
p2


However, I am only interested in drawing the lines for the kernel 50% and
75% and not all of them.

Does anyone has an idea how to select only those lines (in my case 50 and
75%) to be plotted and omit the rest?

Thank you very much in advance for you time and help.

Best

Diego


-- 
*Diego Pav?n Jord?n*

*Finnish Museum of Natural History*
*PO BOX 17 *

*Helsinki. Finland*



*0445061210https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
<https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html>http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
<http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile>https://helsinki.academia.edu/DiegoPavon
<https://helsinki.academia.edu/DiegoPavon>*

	[[alternative HTML version deleted]]


From b.rowlingson at lancaster.ac.uk  Mon Feb 29 11:21:37 2016
From: b.rowlingson at lancaster.ac.uk (Barry Rowlingson)
Date: Mon, 29 Feb 2016 10:21:37 +0000
Subject: [R-sig-Geo] Plotting Kernel results with ggplot2
In-Reply-To: <CAD93_Fr7vHrbj5hXMO1nQTtM7jz=bO_00b1rJrurPCo54X2Mmg@mail.gmail.com>
References: <CAD93_Fr7vHrbj5hXMO1nQTtM7jz=bO_00b1rJrurPCo54X2Mmg@mail.gmail.com>
Message-ID: <CANVKczPr=hj2wMi6iN9zx2JNSU_4bfQm=E2f5D_WUSoGHpZOQg@mail.gmail.com>

I think you will have to take off the ggplot2 training wheels and do
it another way. Here's the outline:

1. Use kde2d to compute your kernel on a grid - you'll have to choose
the bandwidth and grid size, ggplot2 usually makes those decisions for
you. Something like:

k = kde2d(xy.df$x, xy.df$y,h=0.3,n=200)


 2. Convert the gridded density to contour lines with

cc = contourLines(k,levels=c(.25,.75))

 with whatever levels you want. Now I'm not sure what you mean by
"50%" and "75%" - do you mean contours at that fraction of the peak
value? Find the max of k$z if you do and work with that. The absolute
values of k$z are dependent on the cell size since it should integrate
to 1 over the area. Or do you want contours that contain 50% and 75%
of the points? That's not quite so simple.

 3. Convert the `cc` output to something ggplot can handle.
`contourLines` returns a list with one element per contour line (loop
or segment) with the level, x, and y coordinates. Suspect you need to
`cbind` all the coordinates with the level and the index to get
something like:

 index level x y
  1      0.75 0.123 0.545
 [etc for contour 1]
  2     0.5 .5345 .9123
  [etc for contour 2]

and then you can feed this to geom_path, grouped by index and coloured
by level.... There's probably a solution for this already somewhere...

Barry



On Mon, Feb 29, 2016 at 7:34 AM, Diego Pavon
<diego.pavonjordan at gmail.com> wrote:
> Hello list
>
> I am trying to do a Kernel analysis of bird ring recoveries and I would
> like to plot the kernel contour in ggplot. I have found that the command
> 'stat_density_2d()' can do this kernels. However, when I plot it, it draws
> all the kernels from 10%... 90%.  See example below:
>
> # Simulate data
> xy <- data.frame(x = runif(30), y = runif(30))
> coordinates(xy) <- ~ x + y
> plot(xy)
> class(xy)
>
> # Transform SpatialPoints into a data.frame to be used in ggplot2
> xy.df <- as.data.frame(xy)
> head(xy.df)
> str(xy.df)
>
> # Make the plot
> p <- ggplot(data=xy.df, aes(background="white"))
> p <- p + geom_point(aes(x=x, y=y),
>                     data = xy.df,
>                     size = 4)
> p <- p + xlab("X") + ylab("Y")
> p <- p + theme(text = element_text(size = 15))
> p
>
> # This makes the kernels
> p2 <- p + stat_density_2d(data = xy.df, aes(x=x, y=y), col = 'red', alpha =
> 0.6)
> p2
>
>
> However, I am only interested in drawing the lines for the kernel 50% and
> 75% and not all of them.
>
> Does anyone has an idea how to select only those lines (in my case 50 and
> 75%) to be plotted and omit the rest?
>
> Thank you very much in advance for you time and help.
>
> Best
>
> Diego
>
>
> --
> *Diego Pav?n Jord?n*
>
> *Finnish Museum of Natural History*
> *PO BOX 17 *
>
> *Helsinki. Finland*
>
>
>
> *0445061210https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
> <https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html>http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
> <http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile>https://helsinki.academia.edu/DiegoPavon
> <https://helsinki.academia.edu/DiegoPavon>*
>
>         [[alternative HTML version deleted]]
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo


From diego.pavonjordan at gmail.com  Mon Feb 29 16:01:05 2016
From: diego.pavonjordan at gmail.com (Diego Pavon)
Date: Mon, 29 Feb 2016 17:01:05 +0200
Subject: [R-sig-Geo] Plotting Kernel results with ggplot2
In-Reply-To: <CANVKczPr=hj2wMi6iN9zx2JNSU_4bfQm=E2f5D_WUSoGHpZOQg@mail.gmail.com>
References: <CAD93_Fr7vHrbj5hXMO1nQTtM7jz=bO_00b1rJrurPCo54X2Mmg@mail.gmail.com>
	<CANVKczPr=hj2wMi6iN9zx2JNSU_4bfQm=E2f5D_WUSoGHpZOQg@mail.gmail.com>
Message-ID: <CAD93_FoXqw1K4yt56p-SVk5LeQui533jtgMbwWehtzdREAycsg@mail.gmail.com>

Hello Barry,

Yes. What I meant was to have the contours that have 50% and 75% of the
points. But as far as I understood, this is what a kernel analysis does,
right? Gives you the minimum area (smallest polygon) containing the level
specified (50% of the data points, 75% of data points...)?

If I do the kernel analysis with the kernelUD() function in the adhabitatHR
package, I can easily get the contour and the polygon to be plotted even on
a map from 'library(rworldmap)':

xy <- data.frame(x = runif(30), y = runif(30))
coordinates(xy) <- ~ x + y
plot(xy)
class(xy)

library(adehabitatHR)
# calculates the Kernel
kernel.sim<-kernelUD(xy, h = "href", grid = 100,
                          same4all = FALSE,
                          kern = c("bivnorm", "epa"), extent = 1,
                          boundary = NULL)

image(kernel.sim)
str(kernel.sim)
summary(kernel.sim)

# gets the polygon of the kernel to be drawn
ver.sim50 <- getverticeshr(kernel.sim, 50) ## 50 %
ver.sim50
ver.sim75 <- getverticeshr(kernel.sim, 75) ## 75 %
ver.sim75

plot(ver.sim50, add = TRUE, lty = 2, lwd = 3)
plot(ver.sim75, add = TRUE, lty = 3, lwd = 3)
points(xy, pch=16, cex=0.5, col='royalblue4')

# GET THE COORDIMATES OF THE CENTROIDS (center of the polygon)
coordinates(ver.sim)

#Draw the centroids
points(coordinates(ver.sim50), pch=16, cex=1.5, col='olivedrab4')


However, I can't plot these contours, kernels, polygons, etc in ggplot2. Of
course ot would be handier if there would be a way to just plot in ggplot2
the results from the kernel analysis shown above.

Do you have any idea about this?

Thank you very much

Diego







2016-02-29 12:21 GMT+02:00 Barry Rowlingson <b.rowlingson at lancaster.ac.uk>:

> I think you will have to take off the ggplot2 training wheels and do
> it another way. Here's the outline:
>
> 1. Use kde2d to compute your kernel on a grid - you'll have to choose
> the bandwidth and grid size, ggplot2 usually makes those decisions for
> you. Something like:
>
> k = kde2d(xy.df$x, xy.df$y,h=0.3,n=200)
>
>
>  2. Convert the gridded density to contour lines with
>
> cc = contourLines(k,levels=c(.25,.75))
>
>  with whatever levels you want. Now I'm not sure what you mean by
> "50%" and "75%" - do you mean contours at that fraction of the peak
> value? Find the max of k$z if you do and work with that. The absolute
> values of k$z are dependent on the cell size since it should integrate
> to 1 over the area. Or do you want contours that contain 50% and 75%
> of the points? That's not quite so simple.
>
>  3. Convert the `cc` output to something ggplot can handle.
> `contourLines` returns a list with one element per contour line (loop
> or segment) with the level, x, and y coordinates. Suspect you need to
> `cbind` all the coordinates with the level and the index to get
> something like:
>
>  index level x y
>   1      0.75 0.123 0.545
>  [etc for contour 1]
>   2     0.5 .5345 .9123
>   [etc for contour 2]
>
> and then you can feed this to geom_path, grouped by index and coloured
> by level.... There's probably a solution for this already somewhere...
>
> Barry
>
>
>
> On Mon, Feb 29, 2016 at 7:34 AM, Diego Pavon
> <diego.pavonjordan at gmail.com> wrote:
> > Hello list
> >
> > I am trying to do a Kernel analysis of bird ring recoveries and I would
> > like to plot the kernel contour in ggplot. I have found that the command
> > 'stat_density_2d()' can do this kernels. However, when I plot it, it
> draws
> > all the kernels from 10%... 90%.  See example below:
> >
> > # Simulate data
> > xy <- data.frame(x = runif(30), y = runif(30))
> > coordinates(xy) <- ~ x + y
> > plot(xy)
> > class(xy)
> >
> > # Transform SpatialPoints into a data.frame to be used in ggplot2
> > xy.df <- as.data.frame(xy)
> > head(xy.df)
> > str(xy.df)
> >
> > # Make the plot
> > p <- ggplot(data=xy.df, aes(background="white"))
> > p <- p + geom_point(aes(x=x, y=y),
> >                     data = xy.df,
> >                     size = 4)
> > p <- p + xlab("X") + ylab("Y")
> > p <- p + theme(text = element_text(size = 15))
> > p
> >
> > # This makes the kernels
> > p2 <- p + stat_density_2d(data = xy.df, aes(x=x, y=y), col = 'red',
> alpha =
> > 0.6)
> > p2
> >
> >
> > However, I am only interested in drawing the lines for the kernel 50% and
> > 75% and not all of them.
> >
> > Does anyone has an idea how to select only those lines (in my case 50 and
> > 75%) to be plotted and omit the rest?
> >
> > Thank you very much in advance for you time and help.
> >
> > Best
> >
> > Diego
> >
> >
> > --
> > *Diego Pav?n Jord?n*
> >
> > *Finnish Museum of Natural History*
> > *PO BOX 17 *
> >
> > *Helsinki. Finland*
> >
> >
> >
> > *0445061210
> https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
> > <
> https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
> >
> http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
> > <
> http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
> >https://helsinki.academia.edu/DiegoPavon
> > <https://helsinki.academia.edu/DiegoPavon>*
> >
> >         [[alternative HTML version deleted]]
> >
> > _______________________________________________
> > R-sig-Geo mailing list
> > R-sig-Geo at r-project.org
> > https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>



-- 
*Diego Pav?n Jord?n*

*Finnish Museum of Natural History*
*PO BOX 17 *

*Helsinki. Finland*



*0445061210https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html
<https://tuhat.halvi.helsinki.fi/portal/en/persons/diego-pavon-jordan%288d5db37c-eddd-4fca-92cd-9c9956a42b4a%29.html>http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile
<http://www.linkedin.com/profile/view?id=170617924&trk=nav_responsive_tab_profile>https://helsinki.academia.edu/DiegoPavon
<https://helsinki.academia.edu/DiegoPavon>*

	[[alternative HTML version deleted]]


From raviteja2504 at gmail.com  Mon Feb 29 18:58:53 2016
From: raviteja2504 at gmail.com (Ravi Teja)
Date: Mon, 29 Feb 2016 23:28:53 +0530
Subject: [R-sig-Geo] How to plot Geohash on a Map using R
Message-ID: <CADeUTLLxeR++yGk_d+mFtsZmnycESch_roMRPkbdEzuKd_c8tA@mail.gmail.com>

Hi,

I want to plot the following Geo-hashes on a map with labels as the
percentage against each Geohash.

Geohash % distribution
ttngh 26.14%
ttnfu 17.67%
ttng5 12.31%
ttnfg 11.50%
ttnfv 14.10%
ttngk 7.33%
ttngm 2.14%
ttngj 6.06%
ttnft 1.32%
ttngs 0.75%
ttngn 0.27%
ttng7 0.20%
ttnge 0.15%
ttnfe 0.00%
ttnfs 0.04%
ttnfy 0.01%
Please let me know how this can be achieved.

Thanks,
Ravi

	[[alternative HTML version deleted]]


From edzer.pebesma at uni-muenster.de  Mon Feb 29 19:24:58 2016
From: edzer.pebesma at uni-muenster.de (Edzer Pebesma)
Date: Mon, 29 Feb 2016 19:24:58 +0100
Subject: [R-sig-Geo] How to plot Geohash on a Map using R
In-Reply-To: <CADeUTLLxeR++yGk_d+mFtsZmnycESch_roMRPkbdEzuKd_c8tA@mail.gmail.com>
References: <CADeUTLLxeR++yGk_d+mFtsZmnycESch_roMRPkbdEzuKd_c8tA@mail.gmail.com>
Message-ID: <56D48CFA.1000007@uni-muenster.de>

Ravi, a student of mine worked on geohash support for R; see

https://github.com/chk1/geohash

On 29/02/16 18:58, Ravi Teja wrote:
> Hi,
> 
> I want to plot the following Geo-hashes on a map with labels as the
> percentage against each Geohash.
> 
> Geohash % distribution
> ttngh 26.14%
> ttnfu 17.67%
> ttng5 12.31%
> ttnfg 11.50%
> ttnfv 14.10%
> ttngk 7.33%
> ttngm 2.14%
> ttngj 6.06%
> ttnft 1.32%
> ttngs 0.75%
> ttngn 0.27%
> ttng7 0.20%
> ttnge 0.15%
> ttnfe 0.00%
> ttnfs 0.04%
> ttnfy 0.01%
> Please let me know how this can be achieved.
> 
> Thanks,
> Ravi
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at r-project.org
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Edzer Pebesma
Institute for Geoinformatics  (ifgi),  University of M?nster
Heisenbergstra?e 2, 48149 M?nster, Germany; +49 251 83 33081
Journal of Statistical Software:   http://www.jstatsoft.org/
Computers & Geosciences:   http://elsevier.com/locate/cageo/
Spatial Statistics Society http://www.spatialstatistics.info

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 490 bytes
Desc: OpenPGP digital signature
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20160229/9ab61206/attachment.bin>

From cryan at binghamton.edu  Mon Feb 29 19:43:20 2016
From: cryan at binghamton.edu (Christopher W. Ryan)
Date: Mon, 29 Feb 2016 13:43:20 -0500
Subject: [R-sig-Geo] removing internal boundaries from a spatstat window
 that was created from three adjacent counties
In-Reply-To: <KL1PR02MB1189C7376ED4A40345A40013A4AD0@KL1PR02MB1189.apcprd02.prod.outlook.com>
References: <56BE63D5.5010707@binghamton.edu> <56C24B2E.3030001@auckland.ac.nz>
	<KL1PR02MB1189C7376ED4A40345A40013A4AD0@KL1PR02MB1189.apcprd02.prod.outlook.com>
Message-ID: <56D49148.40703@binghamton.edu>

Adrian, Rolf, et al--

Thanks so much; worked like a charm. Any value of r below 1 (meter, I
assume?) seemed to serve well.

Missing FAQ aside, your book is phenomenal. I'm working through it in
concert with my current project and learning a ton.

--Chris

Christopher W. Ryan, MD, MS
cryanatbinghamtondotedu
https://www.linkedin.com/in/ryancw

Early success is a terrible teacher. You?re essentially being rewarded
for a lack of preparation, so when you find yourself in a situation
where you must prepare, you can?t do it. You don?t know how.
--Chris Hadfield, An Astronaut's Guide to Life on Earth

Adrian Baddeley wrote:
> Dear Christopher
> 
> Try
>          newW <- closing(sremsWindow, r) 
> 
> where 'r' is a very small distance (slightly greater than the largest gap that you want to rub out).
> 
>  See closing.owin
> 
> (Dang, that should have been a FAQ in our book)
> 
> A
> 
> Prof Adrian Baddeley DSc FAA
> Department of Mathematics and Statistics
> Curtin University, Perth, Western Australia
> 
> ________________________________________
> From: Rolf Turner <r.turner at auckland.ac.nz>
> Sent: Tuesday, 16 February 2016 6:03 AM
> To: Christopher W. Ryan
> Cc: r-sig-geo at r-project.org; Adrian Baddeley; Ege Rubak
> Subject: Re: [R-sig-Geo] removing internal boundaries from a spatstat window that was created from three adjacent counties
> 
> On 13/02/16 11:59, Christopher W. Ryan wrote:
> 
>> In spatstat, I want to create a single window from three adjacent
>> counties in New York State, USA.  My original data is a shapefile,
>> "cty036" showing all the New York State county boundaries.  Here's what
>> I've done so far:
>>
>> ========== begin code =========
>> library(shapefiles)
>> library(spatstat)
>> library(maptools)
>> library(sp)
>> library(RColorBrewer)
>> library(rgdal)
>>
>> nysArea <- readOGR("C:/DATA/GeographicData", "cty036")
>>
>> nysAreaUTM <- spTransform(nysArea, CRS("+proj=utm +zone=18 +ellps=GRS80
>> +units=m +no_defs"))
>>
>> sremsAreaUTM <- subset(nysAreaUTM, NAME=="Broome" | NAME=="Tioga" |
>> NAME=="Chenango")
>>
>> sremsWindow <- as(sremsAreaUTM, "owin")
>> ======== end code =============
>>
>>
>> This works pretty well, producing a 3-county owin object. But the
>> dividing lines between the counties are shown in the window, whenever I
>> plot it or plot subsequent point patterns that use the window.  In
>> essence, in plots it looks like 3 polygons instead of one big one. I'd
>> prefer not to have the inter-county boundaries be visible--I'd rather
>> have just one big polygon for the whole area. How can I remove them?  Or
>> should I create the window differently from the get-go?
>>
>> Thanks.
> 
> I think it probable that your owin object has come out as a multiple
> polygon.  Look at length(sremsWindow$bdry) --- this is probably 3 (or more).
> 
> I would guess that the internal boundaries actually consist of *pairs*
> of closely juxtaposed lines --- which look like single lines when plotted.
> 
> Have you read the spatstat vignette "shapefiles"?  That might give you
> some guidance as to how to proceed.
> 
> I would have thought the automatic repair process that spatstat now uses
> would fix up this problem.  What version of spatstat are you using?
> 
> You *might* be able to fix things up by doing (something like):
> 
> W1 <- owin(poly=sremsWindow$bdry[[1]])
> W2 <- owin(poly=sremsWindow$bdry[[2]])
> W3 <- owin(poly=sremsWindow$bdry[[3]])
> 
> W  <- union.owin(W1,W2,W3)
> 
> But if my guess about the internal boundaries actually being pairs of
> line is correct, this may not work.
> 
> It's hard to say without having your sremsWindow object to experiment on.
> 
> Or perhaps you need to extract the three counties separately as owin
> objects and the apply union.owin() to the three results.  (Again, if my
> guess is correct, this may not work.)
> 
> Adrian or Ege may be able to propose a more efficient/effective solution.
> 
> cheers,
> 
> Rolf Turner
> 
> --
> Technical Editor ANZJS
> Department of Statistics
> University of Auckland
> Phone: +64-9-373-7599 ext. 88276
>


