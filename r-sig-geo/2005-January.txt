From =?iso-8859-1?Q?Jos=E9?=  Tue Jan  4 12:29:14 2005
From: =?iso-8859-1?Q?Jos=E9?= (=?iso-8859-1?Q?Jos=E9?=)
Date: Tue, 4 Jan 2005 12:29:14 +0100
Subject: [R-sig-Geo] How to mask out
Message-ID: <a06110403be002c9b6707@[158.49.31.67]>

Hello

I am traying to interpolate several rainfalls 
data over the Iberian Peninsula and display the 
results over a map of the Peninsula. I have used 
the akima package to make the interpolation and 
the maps package to draw the map. My cuestion is 
whow may I  mask out the output of the interp.new 
function (with extrapolation) with the iberian 
Peninsula map provided by the map package in 
order to restrict the image to the Iberian 
Peninsula ? . Any suggestions are wellcome

Thank in advance for your help

Agustin
-- 
Jos? Agust?n Garc?a
Departamento de F?sica, Universidad de Extremadura
06071 Badajoz, Spain
Tfn. +34-924-289536, Fax. +34-924-289651, email agustin at unex.es



From pzanis at geol.uoa.gr  Tue Jan  4 14:16:08 2005
From: pzanis at geol.uoa.gr (Prodromos Zanis)
Date: Tue,  4 Jan 2005 15:16:08 +0200
Subject: [R-sig-Geo] 3D kriging with gstat
Message-ID: <1104844568.41da971862581@webmail.uoa.gr>


Dear all,

 I want to do kriging with gstat for x,y,z coordinates (latitude, longtitude 
and altitude) to interpolate irregularly distributed temperature station data 
in order to produce a gridded dataset altidude corrected.

where can I find hints or examples on variogram modeling and kriging in 3D with 
gstat?

I look forward for you help. 

thanks and regards,
Prodromos Zanis

-- 
****************************************************
Dr. Prodromos Zanis
Centre for Atmospheric Physics and Climatology 
Academy of Athens
3rd September, Athens 15784, Greece
Tel. +30 210 8832048
Fax: +30 210 8832048
e-mail: pzanis at geol.uoa.gr
Web address: http://users.auth.gr/~zanis/



From paulojus at est.ufpr.br  Tue Jan  4 14:40:37 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Tue, 4 Jan 2005 11:40:37 -0200 (BRST)
Subject: [R-sig-Geo] 3D kriging with gstat
In-Reply-To: <1104844568.41da971862581@webmail.uoa.gr>
References: <1104844568.41da971862581@webmail.uoa.gr>
Message-ID: <Pine.LNX.4.58L0.0501041138480.32269@est.ufpr.br>


Dear Prodromos

there are several packges implementing geostatistical methogs (gstat,
spatial, fields, RandomFiwelds, geoR, geoRglm, ...)

For geoR you can see examples and tutorials at:
www.est.ufpr.br/geoR



On Tue, 4 Jan 2005, Prodromos Zanis wrote:

>
> Dear all,
>
>  I want to do kriging with gstat for x,y,z coordinates (latitude, longtitude
> and altitude) to interpolate irregularly distributed temperature station data
> in order to produce a gridded dataset altidude corrected.
>
> where can I find hints or examples on variogram modeling and kriging in 3D with
> gstat?
>
> I look forward for you help.
>
> thanks and regards,
> Prodromos Zanis
>
> --
> ****************************************************
> Dr. Prodromos Zanis
> Centre for Atmospheric Physics and Climatology
> Academy of Athens
> 3rd September, Athens 15784, Greece
> Tel. +30 210 8832048
> Fax: +30 210 8832048
> e-mail: pzanis at geol.uoa.gr
> Web address: http://users.auth.gr/~zanis/
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From e.pebesma at geog.uu.nl  Tue Jan  4 14:31:14 2005
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Tue, 04 Jan 2005 14:31:14 +0100
Subject: [R-sig-Geo] 3D kriging with gstat
In-Reply-To: <1104844568.41da971862581@webmail.uoa.gr>
References: <1104844568.41da971862581@webmail.uoa.gr>
Message-ID: <41DA9AA2.20205@geog.uu.nl>

Promodos, do you want to interpolate at each (x,y) location over a range
of z values? If yes, that is indeed 3D kriging.

If you want to make one single kriging prediction for each (x,y) 
location, but take the altitude of that location into account,
I would use the altitude as an external drift (or regressor)
variable. This is 2D universal kriging, by some called
external drift kriging. It can be done by the gstat package,
and several others, among which geoR.
--
Edzer

Prodromos Zanis wrote:
> Dear all,
> 
>  I want to do kriging with gstat for x,y,z coordinates (latitude, longtitude 
> and altitude) to interpolate irregularly distributed temperature station data 
> in order to produce a gridded dataset altidude corrected.
> 
> where can I find hints or examples on variogram modeling and kriging in 3D with 
> gstat?
> 
> I look forward for you help. 
> 
> thanks and regards,
> Prodromos Zanis
> 

-- 
Edzer



From nychka at cgd.ucar.edu  Tue Jan  4 16:39:57 2005
From: nychka at cgd.ucar.edu (Doug Nychka)
Date: Tue, 4 Jan 2005 08:39:57 -0700 (MST)
Subject: [R-sig-Geo] 3D kriging with gstat
In-Reply-To: <1104844568.41da971862581@webmail.uoa.gr>
Message-ID: <Pine.LNX.4.44.0501040837330.1189-100000@five-ten.cgd.ucar.edu>


Prodromos,

You might also consider the altitude entering just  as a linear term 
in elevation instead of a full spatial variable. Also don't forget that 
aspect (whether the slope faces north or South etc.) may be an important
covariate also. 

The easiest way to fit these kinds of models is to use back fitting ...



Doug


On Tue, 4 Jan 2005, Prodromos Zanis wrote:

> 
> Dear all,
> 
>  I want to do kriging with gstat for x,y,z coordinates (latitude, longtitude 
> and altitude) to interpolate irregularly distributed temperature station data 
> in order to produce a gridded dataset altidude corrected.
> 
> where can I find hints or examples on variogram modeling and kriging in 3D with 
> gstat?
> 
> I look forward for you help. 
> 
> thanks and regards,
> Prodromos Zanis
> 
> 

-- 
----------------------------------------------------------------------------- 
Doug Nychka
    
Institute for Mathematics Applied to Geosciences (IMAGe)             
Computing and Information Systems Laboratory           Email: nychka at ucar.edu 
National Center for Atmospheric Research               Voice: 303-497-1711 
PO Box 3000                                            FAX: 303-497-1333
Boulder, CO  80307-3000                                Web: www.cgd.ucar.edu/~nychka
                                              
Address for overnight mail: 1850 Table Mesa Drive, Boulder, CO 80305



From e.pebesma at geog.uu.nl  Tue Jan  4 20:47:12 2005
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Tue, 04 Jan 2005 20:47:12 +0100
Subject: [R-sig-Geo] How to mask out
In-Reply-To: <a06110403be002c9b6707@[158.49.31.67]>
References: <a06110403be002c9b6707@[158.49.31.67]>
Message-ID: <41DAF2C0.2060309@geog.uu.nl>

Jos?, you would have to do the following:
1. obtain the polygons the make up the Iberian peninsula
2. overlay the interpolation grid with the polygons:
   for each point on the grid, determine whether it is
   inside or outside the peninsula;
3. put these (logical) values in a matrix of the same
   form of the z argument in the list returned by interp.new
   (the matrix in the form that "image" likes)
4. using this logical matrix, say B, mask out the "outside"
   values in the interpolated matrix, say A$z, by
   > A$z[B] = NA

I don't know whether maps can give you the complete polygons,
I think they work from topology; if rings are formed on the
fly, I don't know how to get them. Try:

library(maps)
x = map("world", "spain")
polygon(cbind(x$x,x$y),col="red")

and you'll see that x does not contain one single polygon
for the big peninsula, but many fragments.

Points in polygon are not so hard to get in R.
My guess is that Roger might be able to help you further.
--
Edzer

Jos? Agust?n Garc?a Garc?a wrote:
> Hello
> 
> I am traying to interpolate several rainfalls data over the Iberian 
> Peninsula and display the results over a map of the Peninsula. I have 
> used the akima package to make the interpolation and the maps package to 
> draw the map. My cuestion is whow may I  mask out the output of the 
> interp.new function (with extrapolation) with the iberian Peninsula map 
> provided by the map package in order to restrict the image to the 
> Iberian Peninsula ? . Any suggestions are wellcome
> 
> Thank in advance for your help
> 
> Agustin

-- 
Edzer



From e.pebesma at geog.uu.nl  Tue Jan  4 21:03:50 2005
From: e.pebesma at geog.uu.nl (Edzer J. Pebesma)
Date: Tue, 04 Jan 2005 21:03:50 +0100
Subject: [R-sig-Geo] temperature interpolation -- was: 3D kriging with
	gstat
In-Reply-To: <Pine.LNX.4.44.0501040837330.1189-100000@five-ten.cgd.ucar.edu>
References: <Pine.LNX.4.44.0501040837330.1189-100000@five-ten.cgd.ucar.edu>
Message-ID: <41DAF6A6.9070308@geog.uu.nl>

Doug Nychka wrote:
> Prodromos,
> 
> You might also consider the altitude entering just  as a linear term 
> in elevation instead of a full spatial variable. Also don't forget that 
> aspect (whether the slope faces north or South etc.) may be an important
> covariate also. 
> 
> The easiest way to fit these kinds of models is to use back fitting ...
>
Doug, I think your linear term suggestion is identical to mine except
that we used completely different wording.

Your suggestion about back fitting triggered my curiousity though -- do
you mean using generalized additive models? If so, how then would you
deal with (residual) spatial correlation?

Best regards,
-- 
Edzer



From Roger.Bivand at nhh.no  Tue Jan  4 22:07:06 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 4 Jan 2005 22:07:06 +0100 (CET)
Subject: [R-sig-Geo] How to mask out
In-Reply-To: <41DAF2C0.2060309@geog.uu.nl>
Message-ID: <Pine.LNX.4.44.0501042125400.1229-100000@reclus.nhh.no>

On Tue, 4 Jan 2005, Edzer J. Pebesma wrote:

> Jos?, you would have to do the following:
> 1. obtain the polygons the make up the Iberian peninsula
> 2. overlay the interpolation grid with the polygons:
>    for each point on the grid, determine whether it is
>    inside or outside the peninsula;
> 3. put these (logical) values in a matrix of the same
>    form of the z argument in the list returned by interp.new
>    (the matrix in the form that "image" likes)
> 4. using this logical matrix, say B, mask out the "outside"
>    values in the interpolated matrix, say A$z, by
>    > A$z[B] = NA
> 
> I don't know whether maps can give you the complete polygons,
> I think they work from topology; if rings are formed on the
> fly, I don't know how to get them. Try:
> 
> library(maps)
> x = map("world", "spain")
> polygon(cbind(x$x,x$y),col="red")
> 
> and you'll see that x does not contain one single polygon
> for the big peninsula, but many fragments.
> 
> Points in polygon are not so hard to get in R.
> My guess is that Roger might be able to help you further.

Well, after that introduction, I'm going to have to!

If continental Spain is enough, then:

library(maps)
library(mapdata)
x <- map("worldHires", "Spain", exact=TRUE, fill=TRUE, plot=FALSE)

will extract just the polygon (with the arcs in the correct direction - 
fill=TRUE is needed for that, otherwise you get line segments in 
arbitrary directions). Then:

library(splancs)
grid <- gridpts(as.points(x), xs=0.1, ys=0.1)
plot.new()
plot.window(xlim=range(x$x), ylim=range(x$y))
polygon(x)
points(grid, pch=".")

gives a grid at 0.1 degree spacings. My guess would be that you actually 
need a projected polygon, and that you can generate your grid from your 
interp() output x and y components, and use the splancs package inout() 
to give a logical vector, having set extrap=TRUE in interp(). You will 
need to be careful overlaying the mask from inout() on the interpolated 
values, but it can be done. Unfortunately, mapproject() in package mapproj 
returns coordinates suited to plotting but not other use, so you may need 
to write the lat-lon coordinates of the polygon out, and use proj to 
project before reading them back in again.

Hope this helps,

Roger



> --
> Edzer
> 
> Jos? Agust?n Garc?a Garc?a wrote:
> > Hello
> > 
> > I am traying to interpolate several rainfalls data over the Iberian 
> > Peninsula and display the results over a map of the Peninsula. I have 
> > used the akima package to make the interpolation and the maps package to 
> > draw the map. My cuestion is whow may I  mask out the output of the 
> > interp.new function (with extrapolation) with the iberian Peninsula map 
> > provided by the map package in order to restrict the image to the 
> > Iberian Peninsula ? . Any suggestions are wellcome
> > 
> > Thank in advance for your help
> > 
> > Agustin
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From andersm at maths.lth.se  Wed Jan  5 17:14:42 2005
From: andersm at maths.lth.se (Anders Malmberg)
Date: Wed, 05 Jan 2005 17:14:42 +0100
Subject: [R-sig-Geo] Analytical covariance expression of backtransformed
	Box-Cox data
Message-ID: <41DC1272.9060602@maths.lth.se>

Dear Readers,

I have a question not related to R itself. It is of a theoretical 
nature. I hope this
is ok.

I am facing the problem where some spatial data follows the Gaussian 
distribution
after a Box-Cox transformation. I am using geoR and I understand that 
geoR (in the latest version)
for lambda \neq 0 or 0.5 calculates the mean and variance through simulation
(using backtransform.moments()).

If X is original data and Y is Box-Cox transformed data for which I have
estimates of the parameters in exponential covariance function, then
it should be that (mean=0),

cov(X_i,X_j)=E(X_i X_j) = E(f(Y_i) f(Y_j))

where "f" is the inverse of the Box-Cox transform. But this turns out to 
be quite messy.
Is it possible to find an analytical expression for any lambda?

Thanks in advance,

Anders



From olefc at daimi.au.dk  Thu Jan  6 10:04:21 2005
From: olefc at daimi.au.dk (Ole F. Christensen)
Date: Thu, 06 Jan 2005 10:04:21 +0100
Subject: [R-sig-Geo] Analytical covariance expression of backtransformed
	Box-Cox data
In-Reply-To: <41DC1272.9060602@maths.lth.se>
References: <41DC1272.9060602@maths.lth.se>
Message-ID: <41DCFF15.6000607@daimi.au.dk>

Dear Anders

As far as I know, an exact expression is not available in any nice form.
However you can create an approximation using a first order Taylor 
expansion of f around y_0=E[Y_i], assuming a constant mean,

f(y) \approx f(y_0)+ (y-y_0) f`(y_0)

and then use the approximation to calculate the covariance.

It may not be accurate, and you can improve on it by using a higher 
order Taylor approximation instead.

Do you actually need the covaraince cov(X_i,X_j) ? or do you only want 
mean and varinnce ?

Ole


Anders Malmberg wrote:

> Dear Readers,
>
> I have a question not related to R itself. It is of a theoretical 
> nature. I hope this
> is ok.
>
> I am facing the problem where some spatial data follows the Gaussian 
> distribution
> after a Box-Cox transformation. I am using geoR and I understand that 
> geoR (in the latest version)
> for lambda \neq 0 or 0.5 calculates the mean and variance through 
> simulation
> (using backtransform.moments()).
>
> If X is original data and Y is Box-Cox transformed data for which I have
> estimates of the parameters in exponential covariance function, then
> it should be that (mean=0),
>
> cov(X_i,X_j)=E(X_i X_j) = E(f(Y_i) f(Y_j))
>
> where "f" is the inverse of the Box-Cox transform. But this turns out 
> to be quite messy.
> Is it possible to find an analytical expression for any lambda?
>
> Thanks in advance,
>
> Anders
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

-- 
Ole F. Christensen
BiRC - Bioinformatics Research Center
University of Aarhus



From munroe.9 at osu.edu  Thu Jan  6 16:37:49 2005
From: munroe.9 at osu.edu (Darla Munroe)
Date: Thu, 6 Jan 2005 10:37:49 -0500
Subject: [R-sig-Geo] going from R to ESRI grids
Message-ID: <200501061539.j06FdwUd026597@defang10.net.ohio-state.edu>

An embedded and charset-unspecified text was scrubbed...
Name: not available
URL: <https://stat.ethz.ch/pipermail/r-sig-geo/attachments/20050106/386d932c/attachment.pl>

From tkeitt at mail.utexas.edu  Thu Jan  6 18:09:44 2005
From: tkeitt at mail.utexas.edu (Timothy H. Keitt)
Date: Thu, 06 Jan 2005 11:09:44 -0600
Subject: [R-sig-Geo] going from R to ESRI grids
In-Reply-To: <200501061539.j06FdwUd026597@defang10.net.ohio-state.edu>
References: <200501061539.j06FdwUd026597@defang10.net.ohio-state.edu>
Message-ID: <1105031384.7873.9.camel@workstation-5>

Are you using rgdal? It reads/writes data arrays transposed. It was a
design decision to avoid the overhead of transposing very large grids (R
is column major and GDAL is row major). We could add a switch I suppose.

THK

On Thu, 2005-01-06 at 09:37, Darla Munroe wrote:
> Just wondering if others have worked with this, and if I am missing
> something totally obvious to make this simpler, apologies for my ignorance -
> 
> 
>  
> 
> OK - it is my understanding that when you reshape a vector (nx1) into a
> matrix in R, it reads the matrix by columns, correct?  I discovered that if
> you read a vector into GRID, it will read the matrix by rows.  Therefore, it
> seems that if you want to take a column vector in R and reshape it to a
> matrix in R, you should take the transpose of that column vector before
> forming it to a matrix.  Correct?
> 
>  
> 
> SO - let's say for example I generated a random uniform column vector 16x1
> which I was assuming to represent a 4x4 grid, and then I created a 4x4
> neighborhood for that grid, then a matrix from that neighborhood (wrk16),
> and calculated a spatial moving average:
> 
>  
> 
> grid1 -> 0.3 * wrk16 %*% grid + grid
> 
>  
> 
> The result is again a 16x1 column vector - now let's say I want to output
> this and read it into GRID - should I reshape it into a 4x4 matrix of the
> transpose of the grid1 column vector?
> 
>  
> 
> That's the best I can figure out.  Seems logical.  BUT, I opened up a grid
> whose values I knew, and the southwest corner of the source data was the
> northwest corner of the resulting grid.  If I don't do a transpose, the data
> are definitely not correct.
> 
>  
> 
> Thank you,
> 
> Darla Munroe
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
-- 
Timothy H. Keitt
Section of Integrative Biology
University of Texas at Austin
http://www.keittlab.org/



From nychka at cgd.ucar.edu  Thu Jan  6 18:16:10 2005
From: nychka at cgd.ucar.edu (Doug Nychka)
Date: Thu, 6 Jan 2005 10:16:10 -0700 (MST)
Subject: [R-sig-Geo] going from R to ESRI grids
In-Reply-To: <200501061539.j06FdwUd026597@defang10.net.ohio-state.edu>
Message-ID: <Pine.LNX.4.44.0501061013500.1716-100000@five-ten.cgd.ucar.edu>


Darla, 

I wonder if part of the confusion is that the convention for the image 
plot in R is to use  the rows of the matrix as the x- coordinate and 
the columns as the y. 

Doug



From Roger.Bivand at nhh.no  Thu Jan  6 18:45:12 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 6 Jan 2005 18:45:12 +0100 (CET)
Subject: [R-sig-Geo] going from R to ESRI grids
In-Reply-To: <200501061539.j06FdwUd026597@defang10.net.ohio-state.edu>
Message-ID: <Pine.LNX.4.44.0501061837080.2708-100000@reclus.nhh.no>

On Thu, 6 Jan 2005, Darla Munroe wrote:

> Just wondering if others have worked with this, and if I am missing
> something totally obvious to make this simpler, apologies for my ignorance -
> 

These are the interesting differences in world-view, like oceanographers
reversing depth (1 to deep) from topographers (1 to high). Many
images/rasters have the rows in reverse order to matrices, and I think
this is what you've met.

> 
>  
> 
> OK - it is my understanding that when you reshape a vector (nx1) into a
> matrix in R, it reads the matrix by columns, correct?  I discovered that if
> you read a vector into GRID, it will read the matrix by rows.  Therefore, it
> seems that if you want to take a column vector in R and reshape it to a
> matrix in R, you should take the transpose of that column vector before
> forming it to a matrix.  Correct?
> 
>  
> 
> SO - let's say for example I generated a random uniform column vector 16x1
> which I was assuming to represent a 4x4 grid, and then I created a 4x4
> neighborhood for that grid, then a matrix from that neighborhood (wrk16),
> and calculated a spatial moving average:
> 
>  
> 
> grid1 -> 0.3 * wrk16 %*% grid + grid
> 
>  
> 
> The result is again a 16x1 column vector - now let's say I want to output
> this and read it into GRID - should I reshape it into a 4x4 matrix of the
> transpose of the grid1 column vector?
>  
> 
> That's the best I can figure out.  Seems logical.  BUT, I opened up a grid
> whose values I knew, and the southwest corner of the source data was the
> northwest corner of the resulting grid.  If I don't do a transpose, the data
> are definitely not correct.
> 
> 

Try grid1[nrow(grid1):1,] to reverse the row order, possibly after the 
transpose.  
 
Roger

> 
> Thank you,
> 
> Darla Munroe
> 
> 
> 	[[alternative HTML version deleted]]
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From RRoa at fisheries.gov.fk  Mon Jan 10 14:20:48 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Mon, 10 Jan 2005 11:20:48 -0200
Subject: [R-sig-Geo] Looking for geoR's illustrative session
Message-ID: <AEF7C40954294D42990B3F90C6C73A45BD0FD5@figmail.fig.fk>

Hi:
I was looking for geoR's Illustrative Session html file but the server
http://www.est.ufpr.br
where the material is located, seems to be down (at least Firefox 
reports site not found). Does anyone have the file? Can this great person 
please send me the file by email? Thanks in advance.
Cheers
Ruben



From paulojus at est.ufpr.br  Mon Jan 10 19:28:54 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Mon, 10 Jan 2005 16:28:54 -0200 (BRST)
Subject: [R-sig-Geo] Looking for geoR's illustrative session
In-Reply-To: <AEF7C40954294D42990B3F90C6C73A45BD0FD5@figmail.fig.fk>
References: <AEF7C40954294D42990B3F90C6C73A45BD0FD5@figmail.fig.fk>
Message-ID: <Pine.LNX.4.58L0.0501101628200.13165@est.ufpr.br>

Our server was down due to a failure in the equipment.
It is back and running again now

Best
P.J.


On Mon, 10 Jan 2005, Ruben Roa wrote:

> Hi:
> I was looking for geoR's Illustrative Session html file but the server
> http://www.est.ufpr.br
> where the material is located, seems to be down (at least Firefox
> reports site not found). Does anyone have the file? Can this great person
> please send me the file by email? Thanks in advance.
> Cheers
> Ruben
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From slist at oomvanlieshout.net  Mon Jan 17 15:59:03 2005
From: slist at oomvanlieshout.net (Sander Oom)
Date: Mon, 17 Jan 2005 16:59:03 +0200
Subject: [R-sig-Geo] Script to 'sample' several grids with result saved to
	text output?
Message-ID: <41EBD2B7.6090503@oomvanlieshout.net>

Dear R-geo and GRASS users,

-Before trying to reinvent the wheel I would like to check whether 
someone has tried this before.-

I have several rasters with environmental data. I also have point data, 
representing animal locations (collected with GPS collars).

I would like to use GRASS to 'sample' (apologies for the ArcInfo AML 
terminology, but it might help people to get what I need) the rasters 
with the point data and save the results in a text file for further 
analysis with R.

The resulting text file should contain a field/attribute of my choice 
from the points data file (some sort of ID for each point) and a 
field/attribute for each of the sampled rasters.

Preferably I would use an R script that calls GRASS, as both point data 
collection and further analysis is done within R. However a GRASS script 
working on input and output text files might also be sufficient.

Any help would be much appreciated,

Sander Oom.

PS: I am a total novice with GRASS.



From Roger.Bivand at nhh.no  Mon Jan 17 22:33:02 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 17 Jan 2005 22:33:02 +0100 (CET)
Subject: [R-sig-Geo] Re: [GRASSLIST:5390] Script to 'sample' several grids
	with resultsaved to text output?
In-Reply-To: <41EBD2B7.6090503@oomvanlieshout.net>
Message-ID: <Pine.LNX.4.44.0501172222470.771-100000@reclus.nhh.no>

On Mon, 17 Jan 2005, Sander Oom wrote:

> Dear R-geo and GRASS users,
> 
> -Before trying to reinvent the wheel I would like to check whether 
> someone has tried this before.-
> 
> I have several rasters with environmental data. I also have point data, 
> representing animal locations (collected with GPS collars).
> 
> I would like to use GRASS to 'sample' (apologies for the ArcInfo AML 
> terminology, but it might help people to get what I need) the rasters 
> with the point data and save the results in a text file for further 
> analysis with R.
> 
> The resulting text file should contain a field/attribute of my choice 
> from the points data file (some sort of ID for each point) and a 
> field/attribute for each of the sampled rasters.
> 
> Preferably I would use an R script that calls GRASS, as both point data 
> collection and further analysis is done within R. However a GRASS script 
> working on input and output text files might also be sufficient.

Something like the following works with GRASS 5.4 and R 2.0.1, using the 
spearfish test data set for GRASS 5.3:

> rtmp <- tempfile()
> system(paste("s.out.ascii bugsites | r.what -f vegcover,geology >", 
+ rtmp))
> system(paste("tail -5", rtmp))
601228|4917635||5|mixed forest|5|limestone
603146|4917453||3|coniferous forest|5|limestone
605627|4916428||3|coniferous forest|5|limestone
607098|4917437||3|coniferous forest|4|sandstone
608471|4915733||3|coniferous forest|8|claysand
> input <- scan(rtmp, sep="|", what=list(x=numeric(0), y=numeric(0), 
+ NULL, NULL, vegcover=character(0), NULL, geology=character(0)))
Read 90 records 
> str(input)
List of 7
 $ x       : num [1:90] 590232 590430 590529 590546 590612 ...
 $ y       : num [1:90] 4915039 4915204 4914625 4915353 4915320 ...
 $         : NULL
 $         : NULL
 $ vegcover: chr [1:90] "coniferous forest" "coniferous forest" 
"coniferous forest" "coniferous forest" ...
 $         : NULL
 $ geology : chr [1:90] "igneous" "igneous" "igneous" "sandstone" ...
> input1 <- data.frame(input[c(1,2,5,7)])
> str(input1)
`data.frame':   90 obs. of  4 variables:
 $ x       : num  590232 590430 590529 590546 590612 ...
 $ y       : num  4915039 4915204 4914625 4915353 4915320 ...
 $ vegcover: Factor w/ 4 levels "coniferous forest",..: 1 1 1 1 1 4 1 1 1 1
 $ geology : Factor w/ 5 levels "claysand","igneous",..: 2 2 2 5 5 5 5 3 2 5

If I had figured out how to read the output of r.what into s.in.ascii, 
storing the data as a sites file, then using the R GRASS package and 
sites.get() would have been neater, but this does work.

Hope this helps,

Roger Bivand

> 
> Any help would be much appreciated,
> 
> Sander Oom.
> 
> PS: I am a total novice with GRASS.
> 
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From hamish_nospam at yahoo.com  Tue Jan 18 00:28:43 2005
From: hamish_nospam at yahoo.com (Hamish)
Date: Tue, 18 Jan 2005 12:28:43 +1300
Subject: [R-sig-Geo] Re: [GRASSLIST:5390] Script to 'sample' several grids
 with result saved to text output?
In-Reply-To: <41EBD2B7.6090503@oomvanlieshout.net>
References: <41EBD2B7.6090503@oomvanlieshout.net>
Message-ID: <20050118122843.280405ef.hamish_nospam@yahoo.com>

> I have several rasters with environmental data. I also have point
> data, representing animal locations (collected with GPS collars).
> 
> I would like to use GRASS to 'sample' (apologies for the ArcInfo AML 
> terminology, but it might help people to get what I need) the rasters 
> with the point data and save the results in a text file for further 
> analysis with R.
> 
> The resulting text file should contain a field/attribute of my choice 
> from the points data file (some sort of ID for each point) and a 
> field/attribute for each of the sampled rasters.
> 
> Preferably I would use an R script that calls GRASS, as both point
> data collection and further analysis is done within R. However a GRASS
> script working on input and output text files might also be
> sufficient.



r.what does this nicely:

http://grass.ibiblio.org/grass57/manuals/html57_user/r.what.html


I guess r.what could/should be modified to read from a sites (vector
points) list and write to a new sites (vector points) list with queried
attributes. (currently just pipe from stdin & to stdout)
Easy to do in a script I guess.


Roger:
> If I had figured out how to read the output of r.what into s.in.ascii,
> storing the data as a sites file

I don't think that would be too hard with GRASS 5.7/6:
 v.in.ascii input=r_what_output.txt fs=',' cat=1 x=2 y=3

GRASS 5.0/5.4's s.in.ascii needs to rearrange column order though with
UNIX 'cut' and 'paste' commands first?



Hamish



From neteler at itc.it  Tue Jan 18 11:06:18 2005
From: neteler at itc.it (Markus Neteler)
Date: Tue, 18 Jan 2005 11:06:18 +0100
Subject: [R-sig-Geo] Re: [GRASSLIST:5402] Re: Script to 'sample' several
	grids with result saved to text output?
In-Reply-To: <20050118122843.280405ef.hamish_nospam@yahoo.com>
References: <20050118122843.280405ef.hamish_nospam@yahoo.com>
Message-ID: <20050118100618.GI2023@thuille.itc.it>

On Tue, Jan 18, 2005 at 12:28:43PM +1300, Hamish wrote:
> r.what does this nicely:
> 
> http://grass.ibiblio.org/grass57/manuals/html57_user/r.what.html
> 
> 
> I guess r.what could/should be modified to read from a sites (vector
> points) list and write to a new sites (vector points) list with queried
> attributes. (currently just pipe from stdin & to stdout)

Isn't this functionality already there?
 http://grass.itc.it/grass60/manuals/html60_user/v.what.rast.html

Markus



From slist at oomvanlieshout.net  Tue Jan 25 19:46:07 2005
From: slist at oomvanlieshout.net (Sander Oom)
Date: Tue, 25 Jan 2005 20:46:07 +0200
Subject: [R-sig-Geo] Hex GIS, (was) Moving-window ...
In-Reply-To: <s1c2f7cf.009@gwm.sc.edu>
References: <s1c2f7cf.009@gwm.sc.edu>
Message-ID: <41F693EF.9090102@oomvanlieshout.net>

Hi Dennis and Frank,

Could you en light me on possible references (papers, books) about the 
use of hexagons in spatial analysis? Did your search give any direction?

I am using the hexbin package (find it at bioconductor.org) and can 
highly recommend it. Nicholas (the maintainer) is currently updating the 
package!

Although hexbin and R are not a GIS, much of the 'GIS' functionality is 
available in R!!

Cheers,

Sander.

Frank Hardisty wrote:
> Denis and All,
> 
> The best thing out there is probably the "hexbin" package in R, based
> on Dan Carr's work. It's not a GIS, however. Hexagons do have some very
> nice properties for spatial analysis.
> 
> -Frank Hardisty
> 
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> Frank Hardisty
> Department of Geography
> University of South Carolina
> hardisty at sc.edu
> Office -- 803-777-5729 Fax -- 803-777-4972
> http://www.cla.sc.edu/geog/faculty/hardistf/
> 
>>>> <White.Denis at epamail.epa.gov> 12/17/04 12:18PM >>>
> Does anyone know of a GIS based on a regular hexagon tessellation
> rather
> than on squares or rectangles?  (There was a project twenty some years
> ago called System X developed for the Navy by Dean Lucas that started
> into commercialization but never finished as far as I know.)
> 
> r-sig-geo-bounces at stat.math.ethz.ch wrote on 2004-12-16 12:17:28:
> 
>> Stephane, have you tried how well this scales to, say, 1000x1000
>> matrices? Indeed, most basic raster GIS functionality is not
> available
> 
>> in R packages, and would be welcome. R code is efficient for small
>> problems, but for cases like this scales badly as Marius noted.
>>
>> We are actually working on an interface from R to the functionality
> of
> 
>> PCRaster (http://pcraster.geog.uu.nl -- yet another raster GIS), and
>> expect to have this working within a few months. PCRaster is not
> open
>> source, so it is unlikely to become a CRAN package straight away,
> but
>> still it may fill a need.
>>
>> This all depends on availability of sp, the long awaited package
> with
> S
>> classes for spatial point, line, grid, arc/node and polygon data.
> We're
>> working very hard on this, and most likely will announce a beta in
>> January. I expect a PCRasteR package to follow that soon.
>> -- 
>> Edzer
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
---------------------------------------------------------
Dr. Sander P. Oom
Animal, Plant and Environmental Sciences
University of the Witwatersrand
Private Bag 3
Wits 2050
South Africa

Tel (work)      +27 (0)11 717 64 04
Tel (home)      +27 (0)18 297 44 51
Fax             +27 (0)18 299 24 64

Email   sander at oomvanlieshout.net
Web     www.oomvanlieshout.net/sander



From HardistF at gwm.sc.edu  Tue Jan 25 20:23:41 2005
From: HardistF at gwm.sc.edu (Frank Hardisty)
Date: Tue, 25 Jan 2005 14:23:41 -0500
Subject: [R-sig-Geo] Hex GIS, (was) Moving-window ...
Message-ID: <s1f65679.033@gwm.sc.edu>

Sander and All,

For Dan Carr's work:

Most important is the R package mantained by Nicholas Lewin-Koh,
including documentation, which you mention. This is another area where R
is the leading edge!

Also, online at http://www.galaxy.gmu.edu/~dcarr/lib/v8n2.pdf

and 

Carr, D. B., A. R. Olsen, and D. White. 1992. "Hexagon Mosaic Maps for
Display of Univariate and Bivariate Geographical Data." Cartography and
Geographic Information Systems, Vol. 19, No. 4, pp. 228-236,271.

Carr, D. B. and L. W. Pickle. 1993. "Plot Production Issues and
Details: Smoothed Cancer Rates and Hexagon Mosaic Maps." Statistical
Computing & Graphics Newsletter, Vol. 4, No. 2, pp. 16-20.

Additionally, I have some Java code for generating hexagonal
spatio-temporal patterns with various properties which could potentially
be used with R spatial packages using rJava, SJava, or the like. I'm
happy to share this code with any interested parties.

regards,
-Frank Hardisty 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Frank Hardisty
Department of Geography
University of South Carolina
hardisty at sc.edu
Office -- 803-777-5729 
Fax -- 803-777-4972
http://people.cas.sc.edu/hardistf/

>>> Sander Oom <slist at oomvanlieshout.net> 01/25/05 01:46PM >>>
Hi Dennis and Frank,

Could you en light me on possible references (papers, books) about the

use of hexagons in spatial analysis? Did your search give any
direction?

I am using the hexbin package (find it at bioconductor.org) and can 
highly recommend it. Nicholas (the maintainer) is currently updating
the 
package!

Although hexbin and R are not a GIS, much of the 'GIS' functionality is

available in R!!

Cheers,

Sander.

Frank Hardisty wrote:
> Denis and All,
> 
> The best thing out there is probably the "hexbin" package in R,
based
> on Dan Carr's work. It's not a GIS, however. Hexagons do have some
very
> nice properties for spatial analysis.
> 
> -Frank Hardisty
> 
> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
> Frank Hardisty
> Department of Geography
> University of South Carolina
> hardisty at sc.edu 
> Office -- 803-777-5729 Fax -- 803-777-4972
> http://www.cla.sc.edu/geog/faculty/hardistf/ 
> 
>>>> <White.Denis at epamail.epa.gov> 12/17/04 12:18PM >>>
> Does anyone know of a GIS based on a regular hexagon tessellation
> rather
> than on squares or rectangles?  (There was a project twenty some
years
> ago called System X developed for the Navy by Dean Lucas that
started
> into commercialization but never finished as far as I know.)
> 
> r-sig-geo-bounces at stat.math.ethz.ch wrote on 2004-12-16 12:17:28:
> 
>> Stephane, have you tried how well this scales to, say, 1000x1000
>> matrices? Indeed, most basic raster GIS functionality is not
> available
> 
>> in R packages, and would be welcome. R code is efficient for small
>> problems, but for cases like this scales badly as Marius noted.
>>
>> We are actually working on an interface from R to the functionality
> of
> 
>> PCRaster (http://pcraster.geog.uu.nl -- yet another raster GIS),
and
>> expect to have this working within a few months. PCRaster is not
> open
>> source, so it is unlikely to become a CRAN package straight away,
> but
>> still it may fill a need.
>>
>> This all depends on availability of sp, the long awaited package
> with
> S
>> classes for spatial point, line, grid, arc/node and polygon data.
> We're
>> working very hard on this, and most likely will announce a beta in
>> January. I expect a PCRasteR package to follow that soon.
>> -- 
>> Edzer
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch 
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo 
> 

-- 
---------------------------------------------------------
Dr. Sander P. Oom
Animal, Plant and Environmental Sciences
University of the Witwatersrand
Private Bag 3
Wits 2050
South Africa

Tel (work)      +27 (0)11 717 64 04
Tel (home)      +27 (0)18 297 44 51
Fax             +27 (0)18 299 24 64

Email   sander at oomvanlieshout.net 
Web     www.oomvanlieshout.net/sander



From White.Denis at epamail.epa.gov  Tue Jan 25 20:29:41 2005
From: White.Denis at epamail.epa.gov (White.Denis at epamail.epa.gov)
Date: Tue, 25 Jan 2005 11:29:41 -0800
Subject: [R-sig-Geo] Hex GIS, (was) Moving-window ...
In-Reply-To: <41F693EF.9090102@oomvanlieshout.net>
Message-ID: <OF195D3425.379C0091-ON88256F94.0068C6CC-88256F94.006B1921@epamail.epa.gov>

Dear Sandor,

A major issue is fidelity of dynamical processes in different
topologies.  Frisch et al. and Toffoli and Margolis (see below) show
that the representation and implementation of Navier-Stokes equations in
a square rather than hexagonal lattice produce anisotropic anomalies.
Quite possibly there may be similar problems in the simulation of
discrete particle movement, such as organisms in a biological population
viability model, for example.

A number of other examples in percolation theory, self-avoiding walks,
survey sample design, and quantization (e.g., hexbin) show different
behavior for hexagon tessellations than for squares.

I hope this is a little introduction to the issues.

Denis

Frisch U, Hasslacher B, Pomeau Y. 1986. Lattice-gas automata for the
Navier-Stokes equations. Physics Review Letters 56:1505-1508.

Toffoli T, Margolis N.  1987.  Cellular automata machines.  MIT Press,
Cambridge.

r-sig-geo-bounces at stat.math.ethz.ch wrote on 2005-01-25 10:46:07:

> Hi Dennis and Frank,
>
> Could you en light me on possible references (papers, books) about the

> use of hexagons in spatial analysis? Did your search give any
direction?
>
> I am using the hexbin package (find it at bioconductor.org) and can
> highly recommend it. Nicholas (the maintainer) is currently updating
the
> package!
>
> Although hexbin and R are not a GIS, much of the 'GIS' functionality
is
> available in R!!
>
> Cheers,
>
> Sander.
>



From RRoa at fisheries.gov.fk  Wed Jan 26 19:28:25 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Wed, 26 Jan 2005 16:28:25 -0200
Subject: [R-sig-Geo] likfit problem in latest geoR and latest R
Message-ID: <AEF7C40954294D42990B3F90C6C73A450101646D@figmail.fig.fk>

Hi:

When i run:

mc96<-likfit(mc96,cov.model="gaussian",ini.cov.pars=c(1.1,30000),nugget=0.9,lambda=0,fixed.lambda=TRUE,hessian=TRUE)

in geoR 1.5-4 and R 2.0.1 Patched for Windows, i get the following error:

Error in lazyLoadDBFetch(key, datafile, compressed, envhook) :
                   internal error in decompress1

while if i run exactly the same command with the same data file in geoR 1.4-9 and R 1.9.1 for Windows, the command runs
perfectly well and i obtain good results.

What could be the problem with my updated combination of R and geoR?
Thanks.

Ruben



From paulojus at est.ufpr.br  Wed Jan 26 21:53:49 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 26 Jan 2005 18:53:49 -0200 (BRST)
Subject: [R-sig-Geo] likfit problem in latest geoR and latest R
In-Reply-To: <AEF7C40954294D42990B3F90C6C73A450101646D@figmail.fig.fk>
References: <AEF7C40954294D42990B3F90C6C73A450101646D@figmail.fig.fk>
Message-ID: <Pine.LNX.4.58L0.0501261852450.14241@est.ufpr.br>

Dear Ruben
Hard to tell fromk this.
Could you please send me a .RData with the mc96 object
(or any other way I can reproduce the code/problem here)?

Cheers
P.J.




On Wed, 26 Jan 2005, Ruben Roa wrote:

> Hi:
>
> When i run:
>
> mc96<-likfit(mc96,cov.model="gaussian",ini.cov.pars=c(1.1,30000),nugget=0.9,lambda=0,fixed.lambda=TRUE,hessian=TRUE)
>
> in geoR 1.5-4 and R 2.0.1 Patched for Windows, i get the following error:
>
> Error in lazyLoadDBFetch(key, datafile, compressed, envhook) :
>                    internal error in decompress1
>
> while if i run exactly the same command with the same data file in geoR 1.4-9 and R 1.9.1 for Windows, the command runs
> perfectly well and i obtain good results.
>
> What could be the problem with my updated combination of R and geoR?
> Thanks.
>
> Ruben
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From paulojus at est.ufpr.br  Thu Jan 27 02:06:54 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Wed, 26 Jan 2005 23:06:54 -0200 (BRST)
Subject: [R-sig-Geo] likfit problem in latest geoR and latest R
In-Reply-To: <AEF7C40954294D42990B3F90C6C73A450101646D@figmail.fig.fk>
References: <AEF7C40954294D42990B3F90C6C73A450101646D@figmail.fig.fk>
Message-ID: <Pine.LNX.4.58L0.0501262306060.14241@est.ufpr.br>

Ahhhh
it is just a typo in you original call

the argument is: fix.lambda
and not        : fixed.lambda




On Wed, 26 Jan 2005, Ruben Roa wrote:

> Hi:
>
> When i run:
>
> mc96<-likfit(mc96,cov.model="gaussian",ini.cov.pars=c(1.1,30000),nugget=0.9,lambda=0,fixed.lambda=TRUE,hessian=TRUE)
>
> in geoR 1.5-4 and R 2.0.1 Patched for Windows, i get the following error:
>
> Error in lazyLoadDBFetch(key, datafile, compressed, envhook) :
>                    internal error in decompress1
>
> while if i run exactly the same command with the same data file in geoR 1.4-9 and R 1.9.1 for Windows, the command runs
> perfectly well and i obtain good results.
>
> What could be the problem with my updated combination of R and geoR?
> Thanks.
>
> Ruben
>
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From RRoa at fisheries.gov.fk  Thu Jan 27 12:22:28 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Thu, 27 Jan 2005 09:22:28 -0200
Subject: [R-sig-Geo] likfit problem in latest geoR and latest R
Message-ID: <AEF7C40954294D42990B3F90C6C73A4501016472@figmail.fig.fk>

> -----Original Message-----
> From: Paulo Justiniano Ribeiro Jr [mailto:paulojus at est.ufpr.br]
> Sent: 26 January 2005 23:07
> To: Ruben Roa
> Cc: r-sig-geo at stat.math.ethz.ch
> Subject: Re: [R-sig-Geo] likfit problem in latest geoR and latest R
> 
> 
> Ahhhh
> it is just a typo in you original call
> 
> the argument is: fix.lambda
> and not        : fixed.lambda

Hi Paulo,
No, i made the typo in the mail message sent to the R-sig-Geo list but
not in R, so the problem with likfit in R 2.0.1 Patched is still there,
at least for my Windows XP machine. 
I installed R 2.0.1 not the patched version and then i run the command
again with the same data in the same computer with geoR 1.5-4 and it run 
perfectly well.
Cheers
Ruben



From paulojus at est.ufpr.br  Thu Jan 27 14:29:01 2005
From: paulojus at est.ufpr.br (Paulo Justiniano Ribeiro Jr)
Date: Thu, 27 Jan 2005 11:29:01 -0200 (BRST)
Subject: [R-sig-Geo] likfit problem in latest geoR and latest R
In-Reply-To: <AEF7C40954294D42990B3F90C6C73A4501016472@figmail.fig.fk>
References: <AEF7C40954294D42990B3F90C6C73A4501016472@figmail.fig.fk>
Message-ID: <Pine.LNX.4.58L0.0501271114550.7592@est.ufpr.br>

Hi Ruben

I run a Linux machine with:

R : Copyright 2005, The R Foundation for Statistical Computing
Version 2.0.1 Patched (2005-01-25), ISBN 3-900051-07-0

from which I get
> ml<-likfit(mc96,cov.model="gaussian",ini.cov.pars=c(1.1,30000),nugget=0.9,lambda=0,fix.lambda=TRUE,hessian=TRUE)

> ml
likfit: estimated model parameters:
       beta       tausq     sigmasq         phi
"    6.706" "    1.072" "    1.355" "30000.000"

likfit: maximised log-likelihood = -2434

So... it runs but ... the algorithm is not moving away from the initial
value for $\phi$.

So dividing the coordinates by 1000 we get something more resonable for
this data:

> mc96$coords <- mc96$coords / 1000
> ml<-likfit(mc96,cov.model="gaussian",ini.cov.pars=c(1.1,30),nugget=0.9,lambda=0,fix.lambda=TRUE,hessian=TRUE)
> ml
likfit: estimated model parameters:
    beta    tausq  sigmasq      phi
"6.6014" "0.7072" "1.2788" "6.3682"

likfit: maximised log-likelihood = -2422

This shows there is a numerical problems in finding the maximum due to the
vary diferent scales of the parameters.
There are 2 possible solutions:
1. re-scale the coordinates (as above)
2. pass arguments to optim() using the "..." mechanism

You shoud inspect thins more carefully trying different initial values to
be sure about convergence

Cheers
P.J,



On Thu, 27 Jan 2005, Ruben Roa wrote:

> > -----Original Message-----
> > From: Paulo Justiniano Ribeiro Jr [mailto:paulojus at est.ufpr.br]
> > Sent: 26 January 2005 23:07
> > To: Ruben Roa
> > Cc: r-sig-geo at stat.math.ethz.ch
> > Subject: Re: [R-sig-Geo] likfit problem in latest geoR and latest R
> >
> >
> > Ahhhh
> > it is just a typo in you original call
> >
> > the argument is: fix.lambda
> > and not        : fixed.lambda
>
> Hi Paulo,
> No, i made the typo in the mail message sent to the R-sig-Geo list but
> not in R, so the problem with likfit in R 2.0.1 Patched is still there,
> at least for my Windows XP machine.
> I installed R 2.0.1 not the patched version and then i run the command
> again with the same data in the same computer with geoR 1.5-4 and it run
> perfectly well.
> Cheers
> Ruben
>
>

Paulo Justiniano Ribeiro Jr
LEG (Laborat?rio de Estat?stica e Geoinforma??o)
Departamento de Estat?stica
Universidade Federal do Paran?
Caixa Postal 19.081
CEP 81.531-990
Curitiba, PR  -  Brasil
Tel: (+55) 41 361 3573
Fax: (+55) 41 361 3141
e-mail: paulojus at est.ufpr.br
http://www.est.ufpr.br/~paulojus



From RRoa at fisheries.gov.fk  Thu Jan 27 14:13:36 2005
From: RRoa at fisheries.gov.fk (Ruben Roa)
Date: Thu, 27 Jan 2005 11:13:36 -0200
Subject: [R-sig-Geo] Importance of sampling design in likelihood-based
	geostatistics
Message-ID: <AEF7C40954294D42990B3F90C6C73A4501344C01@figmail.fig.fk>

Hi:

I hope that this forum is appropriate for the sort of topic i have in mind.

In Diggle, Ribeiro, and Christensen (An Introduction to Model-Based Geostatistics, April 15, 2002) the 
sampling design is defined as the set of locations (the actual values and the labels), and in defining 
their statistical model they include the disclaimer: "Note in particular that this model does not specify 
the distribution of the sampling design, which as noted earlier is assumed to be independent of both [the 
spatial process being estimated] and [the taking of measurements on this process]." Earlier they had written 
"We shall assume either that the sampling design for [the locations] is deterministic or stochastic but 
independent of the [spatial] process [to be estimated]."

I understand that the first disclaimer and the assumption thereby stated are unnecessary because when the
sampling design is defined as the set of locations, then it is deterministic by construction. This is because 
all the locations in the spatial process to be estimated are known exactly (disregarding things such as GPS error)
so there is no distribution associated to them nor any subset of them. Maybe the probability distribution is associated not to the values of the locations but to the labels, but if the subset of locations is selected 
purposively then the labels are also deterministic.

I think this is important because the restriction that the locations to be sampled should be independent
of the spatial process (as stated above in Diggle, Ribeiro and Christensen) is too strong, and reduces the scope 
of likelihood-based geostatistics to only samples taken by scientists applying randomized or uniform designs.

Please correct me if i am wrong. Thanks.

Ruben



From spielvogel at dial.prd.fr  Fri Jan 28 18:13:58 2005
From: spielvogel at dial.prd.fr (Gilles Spielvogel)
Date: Fri, 28 Jan 2005 18:13:58 +0100
Subject: [R-sig-Geo] Problem with lagsarlm (spdep) with SparseM method
Message-ID: <2E714A74160C2A4EB39D8010E3F029E506BE7B@SERVEUR>

Hello,

when running the command:

lagsarc2<-lagsarlm(vary ~ varx , mydata, c2.listw, na.action=na.fail,
type="lag", method="SparseM", quiet=FALSE, zero.policy=TRUE)

R returns the following error:

Spatial lag model
Jacobian calculated using sparse matrix techniques using SparseM
Error in lm.fit(thisx, y) : `x' must be a matrix

The listw object I use comes originally from a queen contiguity GAL object
made with GeoDA. The command works perfectly if I use the option "eigen"
instead of "SparseM", but it takes a lot of time.

Does anyone have any idea about this problem ?

Thanks in advance for your help.

Gilles



From Roger.Bivand at nhh.no  Fri Jan 28 20:35:59 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Fri, 28 Jan 2005 20:35:59 +0100 (CET)
Subject: [R-sig-Geo] Problem with lagsarlm (spdep) with SparseM method
In-Reply-To: <2E714A74160C2A4EB39D8010E3F029E506BE7B@SERVEUR>
Message-ID: <Pine.LNX.4.44.0501282030480.22426-200000@reclus.nhh.no>

Dear Gilles,

Thanks for this bug report - it turned out that you must have an intercept 
and just one right hand side variable, and in calculating the drop-one 
log-likelihoods for testing, the "thisx" matrix was converted to a vector:

		thisx <- x[,-i]

but should have been:

		thisx <- x[,-i, drop = FALSE]

This is corrected in the attached file; could you try it, please, and let 
me know if this solves your problem (source("lag.spsarlm.R"))?

Best wishes,

Roger


On Fri, 28 Jan 2005, Gilles Spielvogel wrote:

> Hello,
> 
> when running the command:
> 
> lagsarc2<-lagsarlm(vary ~ varx , mydata, c2.listw, na.action=na.fail,
> type="lag", method="SparseM", quiet=FALSE, zero.policy=TRUE)
> 
> R returns the following error:
> 
> Spatial lag model
> Jacobian calculated using sparse matrix techniques using SparseM
> Error in lm.fit(thisx, y) : `x' must be a matrix
> 
> The listw object I use comes originally from a queen contiguity GAL object
> made with GeoDA. The command works perfectly if I use the option "eigen"
> instead of "SparseM", but it takes a lot of time.
> 
> Does anyone have any idea about this problem ?
> 
> Thanks in advance for your help.
> 
> Gilles
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no

-------------- next part --------------
# Copyright 1998-2004 by Roger Bivand and Andrew Bernat
#

lagsarlm <- function(formula, data = list(), listw, 
	na.action=na.fail, type="lag", method="eigen", quiet=TRUE, 
	zero.policy=FALSE, interval=c(-1,0.999), tol.solve=1.0e-10, 
	tol.opt=.Machine$double.eps^0.5, control, optim=FALSE) {
	mt <- terms(formula, data = data)
	mf <- lm(formula, data, na.action=na.action, 
		method="model.frame")
	na.act <- attr(mf, "na.action")
	if (!inherits(listw, "listw")) stop("No neighbourhood list")
	can.sim <- as.logical(NA)
	if (listw$style %in% c("W", "S")) 
		can.sim <- spdep:::can.be.simmed(listw)
	if (!is.null(na.act)) {
	    subset <- !(1:length(listw$neighbours) %in% na.act)
	    listw <- subset(listw, subset, zero.policy=zero.policy)
	}
	switch(type, lag = if (!quiet) cat("\nSpatial lag model\n"),
	    mixed = if (!quiet) cat("\nSpatial mixed autoregressive model\n"),
	    stop("\nUnknown model type\n"))
	if (!quiet) cat("Jacobian calculated using ")
	switch(method, 
		eigen = if (!quiet) cat("neighbourhood matrix eigenvalues\n"),
	        SparseM = {
		    if (listw$style %in% c("W", "S") && !can.sim)
		    stop("SparseM method requires symmetric weights")
		    if (listw$style %in% c("B", "C", "U") && 
			!(is.symmetric.glist(listw$neighbours, listw$weights)))
		    stop("SparseM method requires symmetric weights")
		    if (!quiet) cat("sparse matrix techniques using SparseM\n")
		},
		stop("...\nUnknown method\n"))
	y <- model.extract(mf, "response")
#	y <- model.response(mf, "numeric")
#	if (any(is.na(y))) stop("NAs in dependent variable")
	x <- model.matrix(mt, mf)
#	if (any(is.na(x))) stop("NAs in independent variable")
	if (NROW(x) != length(listw$neighbours))
		stop("Input data and weights have different dimensions")
	n <- NROW(x)
	m <- NCOL(x)
	xcolnames <- colnames(x)
	K <- ifelse(xcolnames[1] == "(Intercept)", 2, 1)
	wy <- lag.listw(listw, y, zero.policy=zero.policy)
	if (any(is.na(wy))) stop("NAs in lagged dependent variable")
	if (type != "lag") {
		# check if there are enough regressors
	        if (m > 1) {
			WX <- matrix(nrow=n,ncol=(m-(K-1)))
			for (k in K:m) {
				wx <- lag.listw(listw, x[,k], 
				    zero.policy=zero.policy)
				if (any(is.na(wx))) 
				    stop("NAs in lagged independent variable")
				WX[,(k-(K-1))] <- wx
			}
		}
		if (K == 2) {
         	    # unnormalized weight matrices
                	if (!(listw$style == "W")) {
 	      			intercept <- as.double(rep(1, n))
       	        		wx <- lag.listw(listw, intercept, 
					zero.policy = zero.policy)
                    		if (m > 1) {
                        		WX <- cbind(wx, WX)
                    		} else {
			      		WX <- matrix(wx, nrow = n, ncol = 1)
                    		}
                	} 
            	}   
		m1 <- m + 1
		mm <- NCOL(x) + NCOL(WX)
            	xxcolnames <- character(mm)
		for (k in 1:m) xxcolnames[k] <- xcolnames[k]
		for (k in m1:mm) 
		    xxcolnames[k] <- paste("lag.", xcolnames[k-mm+m], sep="")
		x <- cbind(x, WX)
		colnames(x) <- xxcolnames
		m <- NCOL(x)
		rm(wx, WX)
	}
	similar <- FALSE
	if (missing(control)) {
		control <- list(trace=0, fnscale=-1, factr=tol.opt,
			pgtol=tol.opt)
	}
	if (method == "eigen") {
		if (!quiet) cat("Computing eigenvalues ...\n")
		if (listw$style %in% c("W", "S") && can.sim) {
			eig <- eigenw(similar.listw(listw))
			similar <- TRUE
		} else eig <- eigenw(listw)
		if (!quiet) cat("\n")
#range inverted 031031, email from Salvati Nicola (and Rein Halbersma)
		if (is.complex(eig)) eig.range <- 1/range(Re(eig))
		else eig.range <- 1/range(eig)
		lm.null <- lm(y ~ x - 1)
		lm.w <- lm.fit(x, wy)
		e.null <- lm.null$residuals
		e.w <- lm.w$residuals
		e.a <- t(e.null) %*% e.null
		e.b <- t(e.w) %*% e.null
		e.c <- t(e.w) %*% e.w
		if (optim) {
		    lm.rho <- lm.fit(cbind(x, wy), y)
		    rho <- coef(lm.rho)[length(coef(lm.rho))]
		    if (rho < eig.range[1]+.Machine$double.eps) rho <- 0.0
		    if (rho > eig.range[2]-.Machine$double.eps) rho <- 0.0
		    opt <- optim(par=c(rho), sar.lag.mixed.f, 
			method="L-BFGS-B", 
			lower=eig.range[1]+.Machine$double.eps, 
			upper=eig.range[2]-.Machine$double.eps, 
			control=control, 
			eig=eig, e.a=e.a, e.b=e.b, e.c=e.c, n=n, quiet=quiet)
		    if (opt$convergence == 1) warning("iteration limit reached")
		    if (opt$convergence == 51) warning(opt$message)
		    if (opt$convergence == 52) warning(opt$message)
		    rho <- c(opt$par[1])
		    names(rho) <- "rho"
		    LL <- c(opt$value)
		} else {
		    opt <- optimize(sar.lag.mixed.f, 
			lower=eig.range[1]+.Machine$double.eps, 
			upper=eig.range[2]-.Machine$double.eps, maximum=TRUE,
			tol=tol.opt, eig=eig, e.a=e.a, e.b=e.b, e.c=e.c,
			n=n, quiet=quiet)
		    rho <- opt$maximum
		    names(rho) <- "rho"
		    LL <- opt$objective
		    optres <- opt
		}
	} else {
		opt <- dosparse(listw=listw, y=y, x=x, wy=wy, K=K, quiet=quiet,
			tol.opt=tol.opt, control=control, method=method, 
			interval=interval, can.sim=can.sim, optim=optim)
		rho <- c(opt$maximum)
		names(rho) <- "rho"
		LL <- c(opt$objective)
		similar <- opt$similar
		optres <- opt$opt
	}
	lm.lag <- lm((y - rho*wy) ~ x - 1)
	r <- residuals(lm.lag)
	fit <- y - r
	names(r) <- names(fit)
	coef.rho <- coefficients(lm.lag)
	names(coef.rho) <- colnames(x)
	SSE <- deviance(lm.lag)
	s2 <- SSE/n
	if (method != "eigen") {
		LLs <- opt$LLs
		lm.null <- opt$lm.null
		rest.se <- NULL
		rho.se <- NULL
		LMtest <- NULL
		ase <- FALSE
		varb <- FALSE
	} else {
		LLs <- NULL
		tr <- function(A) sum(diag(A))
# beware of complex eigenvalues!
		O <- (eig/(1-rho*eig))^2
		omega <- sum(O)
		if (is.complex(omega)) omega <- Re(omega)
		W <- listw2mat(listw)
		A <- solve(diag(n) - rho*W)
		AW <- A %*% W
		zero <- rbind(rep(0,length(coef.rho)))
		xtawxb <- s2*(t(x) %*% AW %*% x %*% coef.rho)
		V <- s2*(s2*tr(t(AW) %*% AW) +
			t(AW %*% x %*% coef.rho) %*%
			(AW %*% x %*% coef.rho)) + omega*s2^2
		inf1 <- rbind(n/2, s2*tr(AW), t(zero))
		inf2 <- rbind(s2*tr(AW), V, xtawxb)
		xtx <- s2*t(x) %*% x
		inf3 <- rbind(zero, t(xtawxb), xtx)
		inf <- cbind(inf1, inf2, inf3)
		varb <- (s2^2) * solve(inf, tol=tol.solve)
		rownames(varb) <- colnames(varb) <- 
			c("sigma", "rho", colnames(x))
		rest.se <- sqrt(diag(varb))[-c(1:2)]
		rho.se <- sqrt(varb[2,2])
		TW <- (W %*% W) + (t(W) %*% W)
		T22 <- sum(diag(TW))
		T21A <- sum(diag(TW %*% A))
		LMtest <- ((t(r) %*% W %*% r)/s2)^2
		LMtest <- LMtest/(T22 - ((T21A^2)*(rho.se^2)))
		ase <- TRUE
	}
	call <- match.call()
	ret <- structure(list(type=type, rho=rho, 
		coefficients=coef.rho, rest.se=rest.se, 
		LL=LL, s2=s2, SSE=SSE, parameters=(m+2), lm.model=lm.null,
		method=method, call=call, residuals=r, opt=optres,
		lm.target=lm.lag, fitted.values=fit,
		se.fit=NULL, formula=formula, similar=similar,
		ase=ase, LLs=LLs, rho.se=rho.se, LMtest=LMtest, 
		resvar=varb, zero.policy=zero.policy), class=c("sarlm"))
	if (zero.policy) {
		zero.regs <- attr(listw$neighbours, 
			"region.id")[which(card(listw$neighbours) == 0)]
		if (length(zero.regs) > 0)
			attr(ret, "zero.regs") <- zero.regs
	}
	if (!is.null(na.act))
		ret$na.action <- na.act
	ret
}

sar.lag.mixed.f <- function(rho, eig, e.a, e.b, e.c, n, quiet)
{
	SSE <- e.a - 2*rho*e.b + rho*rho*e.c
	s2 <- SSE/n
	if (is.complex(eig)) det <- Re(prod(1 - rho*eig)) 
	else det <- prod(1 - rho*eig)
	ret <- (log(det) - ((n/2)*log(2*pi)) - (n/2)*log(s2)
		- (1/(2*s2))*SSE)
	if (!quiet) cat("(eigen) rho:\t", rho, "\tfunction value:\t", ret, "\n")
	ret
}



sar.lag.mix.f.sM <- function(rho, W, I, e.a, e.b, e.c, n, tmpmax, quiet)
{
	SSE <- e.a - 2*rho*e.b + rho*rho*e.c
	s2 <- SSE/n
	Jacobian <- log(det(chol((I - rho * W), tmpmax=tmpmax))^2)
	gc(FALSE)
	ret <- (Jacobian
		- ((n/2)*log(2*pi)) - (n/2)*log(s2) - (1/(2*s2))*SSE)
	if (!quiet) 
	    cat("(SparseM) rho:\t", rho, "\tfunction value:\t", ret, "\n")
	ret
}

dosparse <- function (listw, y, x, wy, K, quiet, tol.opt, 
	control, method, interval, can.sim, optim) {
	similar <- FALSE
	m <- ncol(x)
	n <- nrow(x)
	if (method == "SparseM") {
		if (listw$style %in% c("W", "S") && can.sim) {
			W <- asMatrixCsrListw(similar.listw(listw))
			similar <- TRUE
		} else W <- asMatrixCsrListw(listw)
		I <- asMatrixCsrI(n)
		tmpmax <- sum(card(listw$neighbours)) + n
		# tmpmax and gc() calls: Danlin Yu 20041213
		gc(FALSE)
	}
	m <- ncol(x)
	n <- nrow(x)
	LLs <- vector(mode="list", length=length(K:m))
	j <- 1
	for (i in K:m) {
		# drop bug found by Gilles Spielvogel
		thisx <- x[,-i, drop = FALSE]
		lm.null <- lm.fit(thisx, y)
		lm.w <- lm.fit(thisx, wy)
		e.null <- lm.null$residuals
		e.w <- lm.w$residuals
		e.a <- t(e.null) %*% e.null
		e.b <- t(e.w) %*% e.null
		e.c <- t(e.w) %*% e.w
		if (optim) { 
			lm.rho <- lm.fit(cbind(thisx, wy), y)
			rho <- coef(lm.rho)[length(coef(lm.rho))]
			if (rho <= interval[1]) rho <- 0.0
			if (rho >= interval[2]) rho <- 0.0
			opt <- optim(par=c(rho), 
			    sar.lag.mix.f.sM, method="L-BFGS-B", 
			    lower=interval[1],
			    upper=interval[2],
			    control=control, 
			    W=W, I=I, e.a=e.a, e.b=e.b, e.c=e.c, n=n, 
			    tmpmax=tmpmax, quiet=quiet)
			if (opt$convergence == 1) 
				warning("iteration limit reached")
			if (opt$convergence == 51) warning(opt$message)
			if (opt$convergence == 52) warning(opt$message)
			LLs[[j]] <- c(opt$value)
		} else {
			LLs[[j]] <- optimize(sar.lag.mix.f.sM,
			interval=interval, maximum=TRUE, tol=tol.opt, W=W, I=I,
			e.a=e.a, e.b=e.b, e.c=e.c, n=n, tmpmax=tmpmax, 
			quiet=quiet)$objective
		}
		gc(FALSE)
		attr(LLs[[j]], "nall") <- n
		attr(LLs[[j]], "nobs") <- n
		attr(LLs[[j]], "df") <- (m+2)-1
		attr(LLs[[j]], "name") <- colnames(x)[i]
		class(LLs[[j]]) <- "logLik"
		j <- j + 1
	}
	lm.null <- lm(y ~ x - 1)
	lm.w <- lm.fit(x, wy)
	e.null <- lm.null$residuals
	e.w <- lm.w$residuals
	e.a <- t(e.null) %*% e.null
	e.b <- t(e.w) %*% e.null
	e.c <- t(e.w) %*% e.w
	sn <- listw2sn(listw)
	if (optim) {
		lm.rho <- lm.fit(cbind(x, wy), y)
		rho <- coef(lm.rho)[length(coef(lm.rho))]
		if (rho <= interval[1]) rho <- 0.0
		if (rho >= interval[2]) rho <- 0.0
		opt <- optim(par=c(rho), 
		    sar.lag.mix.f.sM, method="L-BFGS-B", 
		    lower=interval[1],
		    upper=interval[2],
		    control=control, 
		    W=W, I=I, e.a=e.a, e.b=e.b, e.c=e.c, n=n, 
		    tmpmax=tmpmax, quiet=quiet)	
		if (opt$convergence == 1) warning("iteration limit reached")
		if (opt$convergence == 51) warning(opt$message)
		if (opt$convergence == 52) warning(opt$message)
		maximum <- c(opt$par[1])
		objective <- c(opt$value)
	} else {
		opt <- optimize(sar.lag.mix.f.sM,
		    interval=interval, maximum=TRUE, tol=tol.opt, W=W, I=I,
		    e.a=e.a, e.b=e.b, e.c=e.c, n=n, tmpmax=tmpmax, quiet=quiet)
		maximum <- opt$maximum
		objective <- opt$objective
	}
	gc(FALSE)
	res <- list(maximum=maximum, objective=objective, LLs=LLs,
		lm.null=lm.null, similar=similar, opt=opt)
}


From spielvogel at dial.prd.fr  Fri Jan 28 20:31:31 2005
From: spielvogel at dial.prd.fr (Gilles Spielvogel)
Date: Fri, 28 Jan 2005 20:31:31 +0100
Subject: [R-sig-Geo] Problem with lagsarlm (spdep) with SparseM method
Message-ID: <2E714A74160C2A4EB39D8010E3F029E506BE7C@SERVEUR>

Regarding what I asked earlier: no error occurs if there are two exogenous
variables, and it does run incredibly faster (a few seconds instead of 15
minutes or so with the eigen method).
As far as I can understand, the problem I encountered comes from a sequence
in the sub-program dosparse, which says (in a loop over the columns of x):
	thisx<-x[,-i]
	lm.null<-lm.fit(thisx, y)
If x has only two columns (which is the case if there is only one variable
on the right hand side), thisx has only one column at each step of the loop
and is not seen as a matrix by the lm.fit function, which returns an error.

My questions are now:
- is my interpretation right ?
- is this a bug, or is this a desired feature ?
- if this a bug, is there a way to correct it and be able to run a lagsarlm
with one exogenous variable and the SparseM method ?

Thanks in advance.

Gilles 

-----Original Message-----
From: r-sig-geo-bounces at stat.math.ethz.ch
[mailto:r-sig-geo-bounces at stat.math.ethz.ch]On Behalf Of Gilles
Spielvogel
Sent: vendredi 28 janvier 2005 18:14
To: r-sig-geo at stat.math.ethz.ch
Subject: [R-sig-Geo] Problem with lagsarlm (spdep) with SparseM method


Hello,

when running the command:

lagsarc2<-lagsarlm(vary ~ varx , mydata, c2.listw, na.action=na.fail,
type="lag", method="SparseM", quiet=FALSE, zero.policy=TRUE)

R returns the following error:

Spatial lag model
Jacobian calculated using sparse matrix techniques using SparseM
Error in lm.fit(thisx, y) : `x' must be a matrix

The listw object I use comes originally from a queen contiguity GAL object
made with GeoDA. The command works perfectly if I use the option "eigen"
instead of "SparseM", but it takes a lot of time.

Does anyone have any idea about this problem ?

Thanks in advance for your help.

Gilles

_______________________________________________
R-sig-Geo mailing list
R-sig-Geo at stat.math.ethz.ch
https://stat.ethz.ch/mailman/listinfo/r-sig-geo



From Roger.Bivand at nhh.no  Sun Jan 30 14:34:16 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Sun, 30 Jan 2005 14:34:16 +0100 (CET)
Subject: [R-sig-Geo] Re: [R] New user...tips for spdep?
In-Reply-To: <BAY102-DAV15D03ACA7FE8E704C263C5BC7B0@phx.gbl>
Message-ID: <Pine.LNX.4.44.0501301415360.1715-100000@reclus.nhh.no>

On Sat, 29 Jan 2005, Mike Leahy wrote:

> Hello List,
> 
> I'm a very new user to the R system.  I'm only beginning to learn the
> basics, but so far I've been able to do little more than try a few examples,
> and of course begin reading the documentation.
> 
> My primary motivation for exploring R is the availability of tools like the
> 'spdep' package for calculating spatial statistics such as Geary's C and
> Moran's I, which I would like to use in an analysis for my thesis.  However,
> I am not really sure how to get started.  
> 

One place to start looking could be Luc Anselin's useful tutorial:

http://sal.agecon.uiuc.edu/csiss/pdf/rex1.pdf

>  
> 
> As a simple example, if I have a table with columns containing an ID field,
> X & Y coordinates, and an observation value, what steps should I follow to
> pre-process this data in order to use the moran() function?  I've been able
> to duplicate the example in the help documentation (e.g.,
> http://finzi.psych.upenn.edu/R/library/spdep/html/moran.html), but without
> understanding what the commands really do, I'm unable to proceed much
> further.  How might I figure out the data that gets loaded when I run
> 'data(oldcol)' for example?  
> 

In your case, you will need to make a neighbour list object to define what
you understand as the neighbours of your spatial units, for example by
triangulation (tri2nb()), distance bands (dnearneigh()), k-nearest
neighbours (knn2nb()), etc. These are decisions you have to take based on
your knowledge of the phenomena you are analysing. In any case, you would 
use the moran.test() or moran.mc() functions, rather than moran(), which 
just computes the statistic.

In Luc Anselin's example, the neighbour definitions are created in GeoDa, 
which reads shapefiles. In http://spatial.nhh.no/geo304/areal1-04s.pdf, 
they are created for grids and irregular polygons, not for simple points 
like yours. Have a look at the help pages for the point-based functions, 
and see whether any of them suit your purpose. You may have a distance 
range that you know suits your phenomena that you can use, or perhaps the 
triangulation and/or graph-based methods will be more appropriate.

Please feel free to contact me off-list. or to subscribe to the R-sig-geo 
list to follow this up.

(https://www.stat.math.ethz.ch/mailman/listinfo/r-sig-geo)

Roger Bivand

>  
> 
> Is there anyone that might be able to give me some tips, or point me in the
> right direction?
> 
>  
> 
> Thanks in advance for any suggestions.
> 
>  
> 
> Mike
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-help at stat.math.ethz.ch mailing list
> https://stat.ethz.ch/mailman/listinfo/r-help
> PLEASE do read the posting guide! http://www.R-project.org/posting-guide.html
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



From buczkowski at delta.sggw.waw.pl  Mon Jan 31 08:59:47 2005
From: buczkowski at delta.sggw.waw.pl (Rafal Buczkowski)
Date: Mon, 31 Jan 2005 08:59:47 +0100
Subject: [R-sig-Geo] Problem with locations in image() in GeoR
Message-ID: <000501c5076a$e4009b60$f701a8c0@x54>

Hello

I am doing kriging with:

krigres=krige.conv(geozadrz , geozadrz$coords, geozadrz$data, locs , 
borders=NULL, krigcont )

and I would like to use as locations frame of coordinates of points which 
cover the area I am interested in. Area is not a square. When I want to plot 
kriging results with:

image(krigres)

the following error appears

Error in image.default(x = c(3617675, 3617875, 3617975, 3618075, 3618175,  :
        dimensions of z are not length(x)(+1) times length(y)(+1)
In addition: Warning message:
data length [2703] is not a sub-multiple or multiple of the number of rows 
[29] in matrix

and after I reduced the number of rows of my locations to number which is 
multiple of 29 the following message appeared:

Error in image.default(x = c(3617675, 3617875, 3617975, 3618075, 3618175,  :
        dimensions of z are not length(x)(+1) times length(y)(+1)
In addition: Warning message:
data length [2703] is not a sub-multiple or multiple of the number of rows 
[29] in matrix

My list of coordinates is not a square. Does image() accept only square 
areas? I am using coordinates of points from my area to avoid doing kriging 
for points which out outside area of my research.

Thanks in advance for your help

Rafal Buczkowski



From Roger.Bivand at nhh.no  Mon Jan 31 09:34:56 2005
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Mon, 31 Jan 2005 09:34:56 +0100 (CET)
Subject: [R-sig-Geo] Problem with locations in image() in GeoR
In-Reply-To: <000501c5076a$e4009b60$f701a8c0@x54>
Message-ID: <Pine.LNX.4.44.0501310914220.2265-100000@reclus.nhh.no>

On Mon, 31 Jan 2005, Rafal Buczkowski wrote:

> Hello
> 
> I am doing kriging with:
> 
> krigres=krige.conv(geozadrz , geozadrz$coords, geozadrz$data, locs , 
> borders=NULL, krigcont )
> 
> and I would like to use as locations frame of coordinates of points which 
> cover the area I am interested in. Area is not a square. When I want to plot 
> kriging results with:
> 
> image(krigres)
> 
> the following error appears
> 
> Error in image.default(x = c(3617675, 3617875, 3617975, 3618075, 3618175,  :
>         dimensions of z are not length(x)(+1) times length(y)(+1)
> In addition: Warning message:
> data length [2703] is not a sub-multiple or multiple of the number of rows 
> [29] in matrix
> 
> and after I reduced the number of rows of my locations to number which is 
> multiple of 29 the following message appeared:
> 
> Error in image.default(x = c(3617675, 3617875, 3617975, 3618075, 3618175,  :
>         dimensions of z are not length(x)(+1) times length(y)(+1)
> In addition: Warning message:
> data length [2703] is not a sub-multiple or multiple of the number of rows 
> [29] in matrix
> 
> My list of coordinates is not a square. Does image() accept only square 
> areas? I am using coordinates of points from my area to avoid doing kriging 
> for points which out outside area of my research.

Yes, image only accepts rectangular areas, typically taking an xseq, yseq, 
and z list as input (xseq the grid centres eastings, yseq grid centre 
northings, and z the matrix with NA where there is no data). If you want 
to predict and then use image(), you need to insert the predictions into 
the full matrix, leaving NAs where there is no data.

An alternative is to use levelplot() in the lattice package, which takes a 
formula z ~ x + y, and fills in the NAs itself. Both approaches have their 
advantages and disadvantages. Some examples of using levelplot() are in 
some of my lecture notes (Week 41 in 
http://spatial.nhh.no/geo304/modules-h04.html).

You will find similar code and examples in the gstat package. Edzer
Pebesma's function xyz2img() in that package may be the the simplest way 
to go, it needs a data frame with x, y, and z columns, and outputs the 
kind of list image() likes.

Hope this helps,

Roger

> 
> Thanks in advance for your help
> 
> Rafal Buczkowski
> 
> _______________________________________________
> R-sig-Geo mailing list
> R-sig-Geo at stat.math.ethz.ch
> https://stat.ethz.ch/mailman/listinfo/r-sig-geo
> 

-- 
Roger Bivand
Economic Geography Section, Department of Economics, Norwegian School of
Economics and Business Administration, Breiviksveien 40, N-5045 Bergen,
Norway. voice: +47 55 95 93 55; fax +47 55 95 93 93
e-mail: Roger.Bivand at nhh.no



