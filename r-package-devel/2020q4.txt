From he|mut@@chuetz @end|ng |rom beb@c@@t  Thu Oct  1 12:52:46 2020
From: he|mut@@chuetz @end|ng |rom beb@c@@t (=?UTF-8?Q?Helmut_Sch=c3=bctz?=)
Date: Thu, 1 Oct 2020 12:52:46 +0200
Subject: [R-pkg-devel] CRAN badges in README
Message-ID: <4de8b5bd-7ae3-4339-2369-a88f86a49750@bebac.at>

Dear all,

we are using badges in README files of our packages on GitHub and CRAN. 
Recently wrong results are reported:

https://github.com/Helmut01/replicateBE#readme shows CRAN Error
https://cran.r-project.org/web/packages/replicateBE/readme/README.html 
shows CRAN Not OK
though OK at 
https://cran.r-project.org/web/checks/check_results_replicateBE.html

https://github.com/Detlew/Power2Stage#readme shows CRAN Not OK
though OK at 
https://cran.r-project.org/web/checks/check_results_Power2Stage.html

https://github.com/Detlew/PowerTOST#readme shows CRAN Error
https://cran.r-project.org/web/packages/PowerTOST/readme/README.html 
shows CRAN Not OK
though one NOTE at 
https://cran.r-project.org/web/checks/check_results_PowerTOST.html

All badges are linked with https://cranchecks.info/badges/worst/{package 
name}
I checked about 1 month ago and the first 2 showed CRAN OK and the last 
CRAN Note ? which was correct.

Any ideas?

Helmut

-- 
Ing. Helmut Sch?tz
BEBAC?? Consultancy Services for
Bioequivalence and Bioavailability Studies
Neubaugasse 36/11
1070 Vienna, Austria
E helmut.schuetz at bebac.at
W https://bebac.at/
F https://forum.bebac.at/


From georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk  Thu Oct  1 14:08:35 2020
From: georg|@bo@hn@kov @end|ng |rom m@nche@ter@@c@uk (Georgi Boshnakov)
Date: Thu, 1 Oct 2020 12:08:35 +0000
Subject: [R-pkg-devel] dependency fails checking a package on ASAN/UBSAN (on
 r-hub)
Message-ID: <AM0PR0102MB34434F9966EAA9062B3F13F1AE300@AM0PR0102MB3443.eurprd01.prod.exchangelabs.com>

Hi,

A package submitted on CRAN shows problems only on ASAN/UBSAN.
I  used 'r-hub' (rhub::check()) to check if my update has fixed that on that platform but
This is unsuccessful since a dependency fails to install.

The dependency in question is 'xml2'  so it surely can be installed one way or another but do I need to give additional parameters? The report from r-hub is at
HTML<https://builder.r-hub.io/status/rbibutils_1.3.tar.gz-74c7a41c4a1d4c36940fcc78b85e800b>


Georgi Boshnakov

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Thu Oct  1 14:14:48 2020
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Thu, 1 Oct 2020 07:14:48 -0500
Subject: [R-pkg-devel] CRAN Windows failure due to old pandoc ?
In-Reply-To: <24431.39310.24225.620883@rob.eddelbuettel.com>
References: <24431.16080.360859.499222@rob.eddelbuettel.com>
 <39defb0b-3e28-9276-502f-b545829d428b@gmail.com>
 <24431.29258.479690.841632@rob.eddelbuettel.com>
 <653d67db-c205-3d62-3164-7bbe889e39ca@gmail.com>
 <24431.39310.24225.620883@rob.eddelbuettel.com>
Message-ID: <24437.51256.710115.770873@rob.eddelbuettel.com>


On 26 September 2020 at 14:42, Dirk Eddelbuettel wrote:
| 
| On 26 September 2020 at 14:20, Duncan Murdoch wrote:
| | On 26/09/2020 12:54 p.m., Dirk Eddelbuettel wrote:
| | Hmmm, that's strange.  From what I can see you only get the --lua-filter 
| | if pandoc 2.0 is available:
| | 
| | https://github.com/rstudio/rmarkdown/blob/66d27e09befd5f0579f0f4e27c4b9325284b9b15/R/pandoc.R#L719
| | 
| | I think this is the current rmarkdown version.
| 
| I was using a different document driver which may not make that check.
| 
| In the meantime, I think I will just follow the usual advice 'stop doing that
| then' after complaining that it hurts and may just switch to a pdf vignette.

And with a little more, I convinced the maintainer of the markdown style in
question to adopt Duncan's suggested pandoc version fix offered by rmarkdown.

I never heard back from CRAN, neither via a direct message, nor here.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From c@@rd|@g@bor @end|ng |rom gm@||@com  Thu Oct  1 14:55:02 2020
From: c@@rd|@g@bor @end|ng |rom gm@||@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Thu, 1 Oct 2020 13:55:02 +0100
Subject: [R-pkg-devel] 
 dependency fails checking a package on ASAN/UBSAN (on r-hub)
In-Reply-To: <AM0PR0102MB34434F9966EAA9062B3F13F1AE300@AM0PR0102MB3443.eurprd01.prod.exchangelabs.com>
References: <AM0PR0102MB34434F9966EAA9062B3F13F1AE300@AM0PR0102MB3443.eurprd01.prod.exchangelabs.com>
Message-ID: <CABtg=KnfVw1jM32hj-0rixn=DgEAxKqRgZzKEWFzHcaJQCyGtA@mail.gmail.com>

It seems that Debian testing has a new version of libxml2, or maybe
the ICU is newer, and the xml package does not compile with this.

I am afraid that xml2 needs some fixes to solve this. It might be
enough to require C++11 support. If you don't want to wait for the
xml2 maintainer, then you can fork the repo, add C++11 support to your
fork, and then (temporarily) add a `Remotes` field to `DESCRIPTION`
that points to your fork.

Gabor

On Thu, Oct 1, 2020 at 1:08 PM Georgi Boshnakov
<georgi.boshnakov at manchester.ac.uk> wrote:
>
> Hi,
>
> A package submitted on CRAN shows problems only on ASAN/UBSAN.
> I  used 'r-hub' (rhub::check()) to check if my update has fixed that on that platform but
> This is unsuccessful since a dependency fails to install.
>
> The dependency in question is 'xml2'  so it surely can be installed one way or another but do I need to give additional parameters? The report from r-hub is at
> HTML<https://builder.r-hub.io/status/rbibutils_1.3.tar.gz-74c7a41c4a1d4c36940fcc78b85e800b>
>
>
> Georgi Boshnakov
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From zk@mv@r @end|ng |rom gm@||@com  Thu Oct  1 16:43:00 2020
From: zk@mv@r @end|ng |rom gm@||@com (Zhian N. Kamvar)
Date: Thu, 1 Oct 2020 07:43:00 -0700
Subject: [R-pkg-devel] CRAN badges in README
In-Reply-To: <4de8b5bd-7ae3-4339-2369-a88f86a49750@bebac.at>
References: <4de8b5bd-7ae3-4339-2369-a88f86a49750@bebac.at>
Message-ID: <9ee1575a-f3c8-0dbf-c9b9-5b3c2e556b57@gmail.com>

You might be having browser cache issues because I just looked and 
things are fine on this end. You can double check in another browser or 
clear the cache (usually via Preferences > Settings > Security).

FWIW, cran checks is an rhub/rOpenSci project: 
https://blog.r-hub.io/2019/06/10/cran-checks-api/, and not controlled by 
the CRAN team.

Best,

Zhian

On 10/1/20 3:52 AM, Helmut Sch?tz wrote:
> Dear all,
>
> we are using badges in README files of our packages on GitHub and 
> CRAN. Recently wrong results are reported:
>
> https://github.com/Helmut01/replicateBE#readme shows CRAN Error
> https://cran.r-project.org/web/packages/replicateBE/readme/README.html 
> shows CRAN Not OK
> though OK at 
> https://cran.r-project.org/web/checks/check_results_replicateBE.html
>
> https://github.com/Detlew/Power2Stage#readme shows CRAN Not OK
> though OK at 
> https://cran.r-project.org/web/checks/check_results_Power2Stage.html
>
> https://github.com/Detlew/PowerTOST#readme shows CRAN Error
> https://cran.r-project.org/web/packages/PowerTOST/readme/README.html 
> shows CRAN Not OK
> though one NOTE at 
> https://cran.r-project.org/web/checks/check_results_PowerTOST.html
>
> All badges are linked with 
> https://cranchecks.info/badges/worst/{package name}
> I checked about 1 month ago and the first 2 showed CRAN OK and the 
> last CRAN Note ? which was correct.
>
> Any ideas?
>
> Helmut
>


From he|mut@@chuetz @end|ng |rom beb@c@@t  Thu Oct  1 16:55:49 2020
From: he|mut@@chuetz @end|ng |rom beb@c@@t (=?UTF-8?Q?Helmut_Sch=c3=bctz?=)
Date: Thu, 1 Oct 2020 16:55:49 +0200
Subject: [R-pkg-devel] CRAN badges in README
In-Reply-To: <9ee1575a-f3c8-0dbf-c9b9-5b3c2e556b57@gmail.com>
References: <4de8b5bd-7ae3-4339-2369-a88f86a49750@bebac.at>
 <9ee1575a-f3c8-0dbf-c9b9-5b3c2e556b57@gmail.com>
Message-ID: <5d190a9c-f72b-23b7-f57f-49830e3a261d@bebac.at>

Dear Zhian,

Zhian N. Kamvar wrote on 2020-10-01 16:43:
> You might be having browser cache issues because I just looked and 
> things are fine on this end. You can double check in another browser 
> or clear the cache (usually via Preferences > Settings > Security).
>
> FWIW, cran checks is an rhub/rOpenSci project: 
> https://blog.r-hub.io/2019/06/10/cran-checks-api/, and not controlled 
> by the CRAN team.

Sorry, seems that rhub suffered from hiccups. All fine now without 
clearing the cache. Case closed.

All the best,
Helmut

-- 
Ing. Helmut Sch?tz
BEBAC?? Consultancy Services for
Bioequivalence and Bioavailability Studies
Neubaugasse 36/11
1070 Vienna, Austria
E helmut.schuetz at bebac.at
W https://bebac.at/
F https://forum.bebac.at/


From n|co|@@@bennett @end|ng |rom @t@t@m@th@ethz@ch  Thu Oct  1 20:46:50 2020
From: n|co|@@@bennett @end|ng |rom @t@t@m@th@ethz@ch (Bennett  Nicolas)
Date: Thu, 1 Oct 2020 18:46:50 +0000
Subject: [R-pkg-devel] Non-mainstream repository dependence for CRAN
 vignette building
Message-ID: <8E035DA3-66E3-4F03-B584-DAB0255F9BFD@stat.math.ethz.ch>

Dear list

I?m in the process of submitting a package to CRAN that uses a non-mainstream repository for several data packages that are too large for CRAN (~50 MB in total) and therefore live in a drat repository hosted by gh. Data from these packages is used during vignette building and unsurprisingly, CRAN checks throw a ?re-building of vignette? warning.

1. Is such a warning acceptable or is vignette re-build required to run through?
2. Is it allowed to create a set-up that essentially runs `install.packages()` during CRAN checks to make the non-mainstream repo packages available?
3. Are there any go-to solutions for such a scenario? I tried knitr caching, but was unsuccessful, to get that to work. What I?m currently doing is masking the package function that loads data and supplying the required data with the package. But this unnecessarily inflates package size (and adds complexity), as the data is already conveniently and separately available as an R package.

Best,
Nicolas

From M@x@Turgeon @end|ng |rom um@n|tob@@c@  Thu Oct  1 21:13:42 2020
From: M@x@Turgeon @end|ng |rom um@n|tob@@c@ (Max Turgeon)
Date: Thu, 1 Oct 2020 19:13:42 +0000
Subject: [R-pkg-devel] Non-mainstream repository dependence for CRAN
 vignette building
In-Reply-To: <8E035DA3-66E3-4F03-B584-DAB0255F9BFD@stat.math.ethz.ch>
References: <8E035DA3-66E3-4F03-B584-DAB0255F9BFD@stat.math.ethz.ch>
Message-ID: <YTXPR0101MB10696277C5552D04469634A09A300@YTXPR0101MB1069.CANPRD01.PROD.OUTLOOK.COM>

Hi Nicholas,

I see two potential solutions, maybe other people will suggest different ones:

  1. You can make the evaluation of the whole vignette dependent on the data packages being available. Here's an example from one of my packages: https://github.com/sahirbhatnagar/casebase/blob/3403e0451ba5f0bf122924729ba85a904cf16082/vignettes/smoothHazard.Rmd#L22-L27

  2. You create the vignette on your machine and add it to the package as a "static vignette". Here's a blog post on how to do it (it's also been discussed on this list before, have a look at the archive): http://www.markvanderloo.eu/yaRb/2019/01/11/add-a-static-pdf-vignette-to-an-r-package/

Each approach has its pros and cons. In the first solution, a potential issue is that the complete vignettes may rarely be available on a user's machine, unless they install the data package first and build from source. In the second solution, there's more maintenance for you.

Best,


Max Turgeon
Assistant Professor
Department of Statistics
Department of Computer Science
University of Manitoba
maxturgeon.ca<http://maxturgeon.ca>


________________________________
From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Bennett Nicolas <nicolas.bennett at stat.math.ethz.ch>
Sent: Thursday, October 1, 2020 1:46 PM
To: r-package-devel at r-project.org <r-package-devel at r-project.org>
Subject: [R-pkg-devel] Non-mainstream repository dependence for CRAN vignette building

********************************************************
Caution: This message was sent from outside the University of Manitoba.
********************************************************

Dear list

I?m in the process of submitting a package to CRAN that uses a non-mainstream repository for several data packages that are too large for CRAN (~50 MB in total) and therefore live in a drat repository hosted by gh. Data from these packages is used during vignette building and unsurprisingly, CRAN checks throw a ?re-building of vignette? warning.

1. Is such a warning acceptable or is vignette re-build required to run through?
2. Is it allowed to create a set-up that essentially runs `install.packages()` during CRAN checks to make the non-mainstream repo packages available?
3. Are there any go-to solutions for such a scenario? I tried knitr caching, but was unsuccessful, to get that to work. What I?m currently doing is masking the package function that loads data and supplying the required data with the package. But this unnecessarily inflates package size (and adds complexity), as the data is already conveniently and separately available as an R package.

Best,
Nicolas
______________________________________________
R-package-devel at r-project.org mailing list
https://stat.ethz.ch/mailman/listinfo/r-package-devel

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Fri Oct  2 20:50:45 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Fri, 2 Oct 2020 14:50:45 -0400
Subject: [R-pkg-devel] best practices for handling a mixed-licensed package
Message-ID: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>


   A collaborator is arguing that it's a good idea to license one small 
component of a package under the MIT license, while the rest of it 
remains GPL >=2.

   Suppose this is feasible.  How do I specify the license?  As far as I 
can tell from 
https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Licensing 
the DESCRIPTION file should have

License: file LICENSE
License_is_FOSS: yes
License_restricts_use: no

   But I can't figure out what should go in the LICENSE file. The one 
file that contains the MIT-licensed components contains the relevant 
license text in its body.

License: GPL (>=2) | MIT + file LICENSE

doesn't seem right, because these are not *alternative* licenses.  Would 
"GPL (>=2) + file LICENSE" be OK? We could explain the situation in 
LICENSE.note (WRE says "To include comments about the licensing rather 
than the body of a license, use a file named something like 
LICENSE.note. ")

   Could file LICENSE contain

The code in this package is licensed under GPL >=2 (see 
https://www.r-project.org/Licenses/GPL-2, 
https://www.r-project.org/Licenses/GPL-3, except for <FILE xxx>, which 
is under the MIT license (see <FILE xxx for details>).

?

  Happy for advice or pointers to other packages that have successfully 
done something similar.

Looks like igraphdata may have heterogeneous licensing? 
https://cran.r-project.org/web/packages/igraphdata/index.html


Related: 
https://stackoverflow.com/questions/4314708/if-an-r-packages-licence-x-is-do-all-the-content-in-that-package-have-to-be-li


From edd @end|ng |rom deb|@n@org  Fri Oct  2 21:21:57 2020
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 2 Oct 2020 14:21:57 -0500
Subject: [R-pkg-devel] Non-mainstream repository dependence for CRAN
 vignette building
In-Reply-To: <YTXPR0101MB10696277C5552D04469634A09A300@YTXPR0101MB1069.CANPRD01.PROD.OUTLOOK.COM>
References: <8E035DA3-66E3-4F03-B584-DAB0255F9BFD@stat.math.ethz.ch>
 <YTXPR0101MB10696277C5552D04469634A09A300@YTXPR0101MB1069.CANPRD01.PROD.OUTLOOK.COM>
Message-ID: <24439.32213.468460.302693@rob.eddelbuettel.com>


On 1 October 2020 at 19:13, Max Turgeon wrote:
| Hi Nicholas,
| 
| I see two potential solutions, maybe other people will suggest different ones:
| 
|   1. You can make the evaluation of the whole vignette dependent on the data packages being available. Here's an example from one of my packages: https://github.com/sahirbhatnagar/casebase/blob/3403e0451ba5f0bf122924729ba85a904cf16082/vignettes/smoothHazard.Rmd#L22-L27

For reference that is also outlined in the Anderson + Eddelbuettel, 2017, R
Journal article on 'hosting data packages via drat' which shows how to use
(optional) data packages via Additional_repositories.

https://journal.r-project.org/archive/2017/RJ-2017-026/index.html

Dirk

|   2. You create the vignette on your machine and add it to the package as a "static vignette". Here's a blog post on how to do it (it's also been discussed on this list before, have a look at the archive): http://www.markvanderloo.eu/yaRb/2019/01/11/add-a-static-pdf-vignette-to-an-r-package/
| 
| Each approach has its pros and cons. In the first solution, a potential issue is that the complete vignettes may rarely be available on a user's machine, unless they install the data package first and build from source. In the second solution, there's more maintenance for you.
| 
| Best,
| 
| 
| Max Turgeon
| Assistant Professor
| Department of Statistics
| Department of Computer Science
| University of Manitoba
| maxturgeon.ca<http://maxturgeon.ca>
| 
| 
| ________________________________
| From: R-package-devel <r-package-devel-bounces at r-project.org> on behalf of Bennett Nicolas <nicolas.bennett at stat.math.ethz.ch>
| Sent: Thursday, October 1, 2020 1:46 PM
| To: r-package-devel at r-project.org <r-package-devel at r-project.org>
| Subject: [R-pkg-devel] Non-mainstream repository dependence for CRAN vignette building
| 
| ********************************************************
| Caution: This message was sent from outside the University of Manitoba.
| ********************************************************
| 
| Dear list
| 
| I?m in the process of submitting a package to CRAN that uses a non-mainstream repository for several data packages that are too large for CRAN (~50 MB in total) and therefore live in a drat repository hosted by gh. Data from these packages is used during vignette building and unsurprisingly, CRAN checks throw a ?re-building of vignette? warning.
| 
| 1. Is such a warning acceptable or is vignette re-build required to run through?
| 2. Is it allowed to create a set-up that essentially runs `install.packages()` during CRAN checks to make the non-mainstream repo packages available?
| 3. Are there any go-to solutions for such a scenario? I tried knitr caching, but was unsuccessful, to get that to work. What I?m currently doing is masking the package function that loads data and supplying the required data with the package. But this unnecessarily inflates package size (and adds complexity), as the data is already conveniently and separately available as an R package.
| 
| Best,
| Nicolas
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel
| 
| 	[[alternative HTML version deleted]]
| 
| ______________________________________________
| R-package-devel at r-project.org mailing list
| https://stat.ethz.ch/mailman/listinfo/r-package-devel

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From h@w|ckh@m @end|ng |rom gm@||@com  Fri Oct  2 22:16:36 2020
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Fri, 2 Oct 2020 15:16:36 -0500
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
Message-ID: <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>

On Fri, Oct 2, 2020 at 1:51 PM Ben Bolker <bbolker at gmail.com> wrote:

>
>    A collaborator is arguing that it's a good idea to license one small
> component of a package under the MIT license, while the rest of it
> remains GPL >=2.
>
>    Suppose this is feasible.  How do I specify the license?  As far as I
> can tell from
> https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Licensing
> the DESCRIPTION file should have
>
> License: file LICENSE
> License_is_FOSS: yes
> License_restricts_use: no
>
>    But I can't figure out what should go in the LICENSE file. The one
> file that contains the MIT-licensed components contains the relevant
> license text in its body.
>
> License: GPL (>=2) | MIT + file LICENSE
>
> doesn't seem right, because these are not *alternative* licenses.  Would
> "GPL (>=2) + file LICENSE" be OK? We could explain the situation in
> LICENSE.note (WRE says "To include comments about the licensing rather
> than the body of a license, use a file named something like
> LICENSE.note. ")
>
>    Could file LICENSE contain
>
> The code in this package is licensed under GPL >=2 (see
> https://www.r-project.org/Licenses/GPL-2,
> https://www.r-project.org/Licenses/GPL-3, except for <FILE xxx>, which
> is under the MIT license (see <FILE xxx for details>).
> ?
>

I have some recommendations at
https://r-pkgs.org/license.html#code-you-bundle, but in brief use License:
GPL (>= 2) and then explain in LICENSE.note which components have more
liberal licenses.

Hadley

-- 
http://hadley.nz

	[[alternative HTML version deleted]]


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Fri Oct  2 23:44:48 2020
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Fri, 02 Oct 2020 14:44:48 -0700
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
Message-ID: <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>

Hadley offers what you _can_ do, but if you want clarity in the minds of _users_ I would beg you to split the code into two packages. People will likely either be afraid of the GPL bogey man and refrain from utilizing your MIT code as permitted or fail to honor the GPL terms correctly if both are in the same package.

On October 2, 2020 1:16:36 PM PDT, Hadley Wickham <h.wickham at gmail.com> wrote:
>On Fri, Oct 2, 2020 at 1:51 PM Ben Bolker <bbolker at gmail.com> wrote:
>
>>
>>    A collaborator is arguing that it's a good idea to license one
>small
>> component of a package under the MIT license, while the rest of it
>> remains GPL >=2.
>>
>>    Suppose this is feasible.  How do I specify the license?  As far
>as I
>> can tell from
>>
>https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Licensing
>> the DESCRIPTION file should have
>>
>> License: file LICENSE
>> License_is_FOSS: yes
>> License_restricts_use: no
>>
>>    But I can't figure out what should go in the LICENSE file. The one
>> file that contains the MIT-licensed components contains the relevant
>> license text in its body.
>>
>> License: GPL (>=2) | MIT + file LICENSE
>>
>> doesn't seem right, because these are not *alternative* licenses. 
>Would
>> "GPL (>=2) + file LICENSE" be OK? We could explain the situation in
>> LICENSE.note (WRE says "To include comments about the licensing
>rather
>> than the body of a license, use a file named something like
>> LICENSE.note. ")
>>
>>    Could file LICENSE contain
>>
>> The code in this package is licensed under GPL >=2 (see
>> https://www.r-project.org/Licenses/GPL-2,
>> https://www.r-project.org/Licenses/GPL-3, except for <FILE xxx>,
>which
>> is under the MIT license (see <FILE xxx for details>).
>> ?
>>
>
>I have some recommendations at
>https://r-pkgs.org/license.html#code-you-bundle, but in brief use
>License:
>GPL (>= 2) and then explain in LICENSE.note which components have more
>liberal licenses.
>
>Hadley

-- 
Sent from my phone. Please excuse my brevity.


From edd @end|ng |rom deb|@n@org  Sat Oct  3 00:26:33 2020
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Fri, 2 Oct 2020 17:26:33 -0500
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
 <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
Message-ID: <24439.43289.203562.58924@rob.eddelbuettel.com>


On 2 October 2020 at 14:44, Jeff Newmiller wrote:
| if you want clarity in the minds of _users_ I would beg you to split the code into two packages. People will likely either be afraid of the GPL bogey man and refrain from utilizing your MIT code as permitted or fail to honor the GPL terms correctly if both are in the same package.

Have you read R's own doc/COPYRIGHTS ?

   https://github.com/wch/r-source/blob/trunk/doc/COPYRIGHTS

In short the opposite of what you just suggest. 

Also, labels such as "more liberal" or "permissive" or "bogey man" are not
exactly unambiguous.  Different people can and do have different views here.
I would suggest using simpler terms such as "different". What matters is that
the licenses permit open source use while ensuring they are compatible which
is generally the case these days.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From h@w|ckh@m @end|ng |rom gm@||@com  Sat Oct  3 16:54:19 2020
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Sat, 3 Oct 2020 09:54:19 -0500
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <24439.43289.203562.58924@rob.eddelbuettel.com>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
 <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
 <24439.43289.203562.58924@rob.eddelbuettel.com>
Message-ID: <CABdHhvHht9ooT+Stt8Mms5GfKJoix-rYV9whwE8fDJawe_NfHw@mail.gmail.com>

On Fri, Oct 2, 2020 at 5:26 PM Dirk Eddelbuettel <edd at debian.org> wrote:

>
> On 2 October 2020 at 14:44, Jeff Newmiller wrote:
> | if you want clarity in the minds of _users_ I would beg you to split the
> code into two packages. People will likely either be afraid of the GPL
> bogey man and refrain from utilizing your MIT code as permitted or fail to
> honor the GPL terms correctly if both are in the same package.
>
> Have you read R's own doc/COPYRIGHTS ?
>
>    https://github.com/wch/r-source/blob/trunk/doc/COPYRIGHTS
>
> In short the opposite of what you just suggest.
>
> Also, labels such as "more liberal" or "permissive" or "bogey man" are not
> exactly unambiguous.  Different people can and do have different views
> here.
> I would suggest using simpler terms such as "different". What matters is
> that
> the licenses permit open source use while ensuring they are compatible
> which
> is generally the case these days.
>

I think this is a bit of an oversimplification, especially given that
"compatibility" is not symmetric. For example, you can include MIT license
code in a GPL licensed package; you can not include GPL licensed code
inside an MIT licensed package. There are some rough guidelines at
https://r-pkgs.org/license.html#license-compatibility.

Hadley

-- 
http://hadley.nz

	[[alternative HTML version deleted]]


From edd @end|ng |rom deb|@n@org  Sat Oct  3 18:02:02 2020
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Sat, 3 Oct 2020 11:02:02 -0500
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <CABdHhvHht9ooT+Stt8Mms5GfKJoix-rYV9whwE8fDJawe_NfHw@mail.gmail.com>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
 <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
 <24439.43289.203562.58924@rob.eddelbuettel.com>
 <CABdHhvHht9ooT+Stt8Mms5GfKJoix-rYV9whwE8fDJawe_NfHw@mail.gmail.com>
Message-ID: <24440.41082.779800.340676@rob.eddelbuettel.com>


On 3 October 2020 at 09:54, Hadley Wickham wrote:
| I think this is a bit of an oversimplification, especially given that
| "compatibility" is not symmetric. For example, you can include MIT license
| code in a GPL licensed package; you can not include GPL licensed code
| inside an MIT licensed package. There are some rough guidelines at
| https://r-pkgs.org/license.html#license-compatibility.

One approach for issues such as legal matters is to consult subject-matter
experts which is why I pointed (in a prior private message spawned by this
same thread) to sites such as

  https://tldrlegal.com/ 
  https://choosealicense.com/

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@  Sat Oct  3 18:45:54 2020
From: jdnewm|| @end|ng |rom dcn@d@v|@@c@@u@ (Jeff Newmiller)
Date: Sat, 03 Oct 2020 09:45:54 -0700
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <24440.41082.779800.340676@rob.eddelbuettel.com>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
 <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
 <24439.43289.203562.58924@rob.eddelbuettel.com>
 <CABdHhvHht9ooT+Stt8Mms5GfKJoix-rYV9whwE8fDJawe_NfHw@mail.gmail.com>
 <24440.41082.779800.340676@rob.eddelbuettel.com>
Message-ID: <A29CA957-9BC0-434E-AD67-9CE557BD3C94@dcn.davis.ca.us>

You are addressing interpretation of "a license", while my concern is not with the licenses themselves but with the identification of which code goes with which license. Assuming that you will need to retain lawyers to decide how to handle a license in a particular use case may be reasonable, but assuming you will also use them to parse the files in the package  seems rather less reasonable IMO when you have such a clear alternative (packaging).

On October 3, 2020 9:02:02 AM PDT, Dirk Eddelbuettel <edd at debian.org> wrote:
>
>On 3 October 2020 at 09:54, Hadley Wickham wrote:
>| I think this is a bit of an oversimplification, especially given that
>| "compatibility" is not symmetric. For example, you can include MIT
>license
>| code in a GPL licensed package; you can not include GPL licensed code
>| inside an MIT licensed package. There are some rough guidelines at
>| https://r-pkgs.org/license.html#license-compatibility.
>
>One approach for issues such as legal matters is to consult
>subject-matter
>experts which is why I pointed (in a prior private message spawned by
>this
>same thread) to sites such as
>
>  https://tldrlegal.com/ 
>  https://choosealicense.com/
>
>Dirk

-- 
Sent from my phone. Please excuse my brevity.


From h@w|ckh@m @end|ng |rom gm@||@com  Sun Oct  4 01:44:15 2020
From: h@w|ckh@m @end|ng |rom gm@||@com (Hadley Wickham)
Date: Sat, 3 Oct 2020 18:44:15 -0500
Subject: [R-pkg-devel] 
 best practices for handling a mixed-licensed package
In-Reply-To: <A29CA957-9BC0-434E-AD67-9CE557BD3C94@dcn.davis.ca.us>
References: <f20c4a70-0a64-9eeb-0ddc-95808d56c6c6@gmail.com>
 <CABdHhvGTDeUW8tUEhC0a0JKqLhS4=dHLdkEBRrOJgp-o1iOTPA@mail.gmail.com>
 <ACB42248-F5E8-4338-AC6E-E258BE9A8698@dcn.davis.ca.us>
 <24439.43289.203562.58924@rob.eddelbuettel.com>
 <CABdHhvHht9ooT+Stt8Mms5GfKJoix-rYV9whwE8fDJawe_NfHw@mail.gmail.com>
 <24440.41082.779800.340676@rob.eddelbuettel.com>
 <A29CA957-9BC0-434E-AD67-9CE557BD3C94@dcn.davis.ca.us>
Message-ID: <CABdHhvHu286pwwZPTGbeSwFT1-Xdq+7dJ+EKZDnnqWSDnsVGWg@mail.gmail.com>

This is why I recommend that if you copy an entire directory of code you
include the LICENSE file for that directory; if you copy a single file,
make the license clear at the comment in a top of the file. This is
standard practice in most open source communities.

If you?re writing open source code, I don?t think it?s necessary to retain
a lawyer in order to handle these commonplace issues. (OTOH if you?re
building a business on top of open source code, hiring a lawyer is
absolutely essential).

Hadley

On Saturday, October 3, 2020, Jeff Newmiller <jdnewmil at dcn.davis.ca.us>
wrote:

> You are addressing interpretation of "a license", while my concern is not
> with the licenses themselves but with the identification of which code goes
> with which license. Assuming that you will need to retain lawyers to decide
> how to handle a license in a particular use case may be reasonable, but
> assuming you will also use them to parse the files in the package  seems
> rather less reasonable IMO when you have such a clear alternative
> (packaging).
>
> On October 3, 2020 9:02:02 AM PDT, Dirk Eddelbuettel <edd at debian.org>
> wrote:
> >
> >On 3 October 2020 at 09:54, Hadley Wickham wrote:
> >| I think this is a bit of an oversimplification, especially given that
> >| "compatibility" is not symmetric. For example, you can include MIT
> >license
> >| code in a GPL licensed package; you can not include GPL licensed code
> >| inside an MIT licensed package. There are some rough guidelines at
> >| https://r-pkgs.org/license.html#license-compatibility.
> >
> >One approach for issues such as legal matters is to consult
> >subject-matter
> >experts which is why I pointed (in a prior private message spawned by
> >this
> >same thread) to sites such as
> >
> >  https://tldrlegal.com/
> >  https://choosealicense.com/
> >
> >Dirk
>
> --
> Sent from my phone. Please excuse my brevity.
>


-- 
http://hadley.nz

	[[alternative HTML version deleted]]


From r@@y@|@14 @end|ng |rom |mper|@|@@c@uk  Sun Oct  4 15:48:44 2020
From: r@@y@|@14 @end|ng |rom |mper|@|@@c@uk (Ayala Hernandez, Rafael)
Date: Sun, 4 Oct 2020 13:48:44 +0000
Subject: [R-pkg-devel] Windows builds not using latest BiocStyle version
Message-ID: <DB7PR06MB5881A0200AE218D2019D5A65CC0F0@DB7PR06MB5881.eurprd06.prod.outlook.com>

Dear all,

I am writing because I recently found that my NutrienTrackeR package was having build errors, failing at building the vignette.

I could trace the error to a bug in BiocStyle caused by a recent change in knitr, which was also causing a large number of Bioconductor packages to fail building.

The Bioconductor team pushed a new version of BiocStyle which fixed the error in all platforms for all packages that used BiocStyle for vignette output.

The change has been reflected on the build report of NutrienTrackeR (https://cran.r-project.org/web/checks/check_results_NutrienTrackeR.html) for Linux and MacOS platforms, but not for any of the Windows builds. Having a look at the build report for R-devel in Windows, it seems the latest build was done with R Under development (2020-09-28 r79268).

I am wondering if it is possible the Windows builds for NutrienTrackeR are failing because they are not using still the most recent version of BiocStyle, or if on the contrary I should rather just remove BiocStyle output to fix the error?

Thanks a lot in advance!

Best wishes,

Rafa

	[[alternative HTML version deleted]]


From c@r@@e@| @end|ng |rom |b|me@upv@e@  Mon Oct  5 18:43:01 2020
From: c@r@@e@| @end|ng |rom |b|me@upv@e@ (=?iso-8859-1?Q?Carlos_S=E1ez?=)
Date: Mon, 5 Oct 2020 18:43:01 +0200
Subject: [R-pkg-devel] EHRtemporalVariability package check warning,
 cannot fix
Message-ID: <1a4301d69b36$973c0280$c5b40780$@ibime.upv.es>

Hi,

 

Some weeks ago we received the CRAN notification to update our
EHRtemporalVariability package in light of some Warnings found on the
vignette compilation.

 

We managed to solve most by including the ?webshot? package in the Suggests
list in DESCRIPTION, since the Vignette is rendered in .html including
dynamic Plotly plots.

 

However, we cannot manage to solve the last one, and thus we cannot update
the package in CRAN. Local checks show no Warnings (only a Note due to
having 5.1MB file). Even updated R to the latest ver 4.0.2 and R tools to
the latest 4, and all checks ok. But submitting on winbuilder the Warning is
still there.

 

The logs are here:

 <https://win-builder.r-project.org/9IvFwBBcgDlI>
https://win-builder.r-project.org/9IvFwBBcgDlI

 

This is the error:

 

        Error(s) in re-building vignettes:

--- re-building 'EHRtemporalVariability.Rmd' using rmarkdown

Quitting from lines 35-36 (EHRtemporalVariability.Rmd) 

Error: processing vignette 'EHRtemporalVariability.Rmd' failed with
diagnostics:

argument is of length zero

--- failed re-building 'EHRtemporalVariability.Rmd'

 

The package is exactly that found in
https://github.com/hms-dbmi/EHRtemporalVariability

 

Those lines 35-36 are the first chunk in the .Rmd vignette file:

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning=FALSE)

```

Surprisingly, if removing this chunk and resubmitting, the same ?argument is
of length zero? error is present but in the following (now first) chunk of
code.

 

Any help would be really appreciated. We would kindly provide any additional
info that could help.

Best regards!

Carlos


	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Mon Oct  5 19:09:06 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 5 Oct 2020 13:09:06 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
Message-ID: <e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>

   Am I confused, or doing something wrong, or ... ?

   I have qpdf installed, and am running R CMD build with 
--compact-vignettes, but the PDF in the tarball doesn't seem to be 
compressed despite the fact that the output messages say "compacting 
vignettes ..."


   $ R CMD build --compact-vignettes lme4
* checking for file ?lme4/DESCRIPTION? ... OK
* preparing ?lme4?:
* checking DESCRIPTION meta-information ... OK
* cleaning src
* installing the package to process help pages
* saving partial Rd database
* creating vignettes ... OK
Warning: ?inst/doc? files
     ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
   ignored as vignettes have been rebuilt.
   Run R CMD build with --no-build-vignettes to prevent rebuilding.
* compacting vignettes and other PDF files
* cleaning src
* checking for LF line-endings in source and make files and shell scripts
* checking for empty or unneeded directories
* building ?lme4_1.1-24.tar.gz?

   The copy of lmer.pdf in the resulting tarball is 900K or so:

$ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
-rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf

   The previously built (and manually compacted) version of lmer.pdf in 
the tarball is 500K:

$ ls -l lme4/inst/doc/lmer.pdf
-rw-r--r-- 1 bolker bolker 495199 Oct  3 22:15 lme4/inst/doc/lmer.pdf

    Is 'R CMD build' confused by the presence of a pre-built PDF in the 
inst/doc directory? Or am I somehow mistaken about how this is supposed 
to work?

    I would just use --no-build-vignettes and submit the tarball with 
the previously built/compressed PDF, but I'm trying to avoid a
"Package has a VignetteBuilder field but no prebuilt vignette index" 
NOTE, which I assume is missing because I built without building 
vignettes ... ?

   As always, enlightenment is welcome.

   cheers
     Ben Bolker


From r@@y@|@14 @end|ng |rom |mper|@|@@c@uk  Mon Oct  5 19:37:50 2020
From: r@@y@|@14 @end|ng |rom |mper|@|@@c@uk (Ayala Hernandez, Rafael)
Date: Mon, 5 Oct 2020 17:37:50 +0000
Subject: [R-pkg-devel] EHRtemporalVariability package check warning,
 cannot fix
In-Reply-To: <1a4301d69b36$973c0280$c5b40780$@ibime.upv.es>
References: <1a4301d69b36$973c0280$c5b40780$@ibime.upv.es>
Message-ID: <DB7PR06MB5881462F13DC9DB718974FA1CC0C0@DB7PR06MB5881.eurprd06.prod.outlook.com>

Hi Carlos,

Your package seems to use BiocStyle to output the vignette. I have encountered a similar error with my NutrienTrackeR package. The issue was triggered by the latest update to the knitr package, which caused knitting of vignettes in BiocStyle output to fail.

The issue was resolved by the Bioconductor team by pushing a new version of BiocStyle. This fixed all packages dependent on BiocStyle on Bioconductor, and seems to also have fixed the build reports for NutrienTrackeR for all linux and MacOS builds.

However, it has not fixed the error for the windows builds (https://cran.r-project.org/web/checks/check_results_NutrienTrackeR.html) . The error seems very similar to what you are getting, also being triggered by the first line of code in the vignette. If the issue is the same as what I was having, it will be triggered no matter how many chunks you remove, since it is the underlying combination of updated knitr and possibly not latest BiocStyle which triggers it.

Perhaps winbuilder and the machine building CRAN packages under windows are still not using the latest BiocStyle version for some reason?

Best wishes,

Rafa
________________________________
De: R-package-devel <r-package-devel-bounces at r-project.org> en nombre de Carlos S?ez <carsaesi at ibime.upv.es>
Enviado: lunes, 5 de octubre de 2020 18:43
Para: r-package-devel at r-project.org <r-package-devel at r-project.org>
Asunto: [R-pkg-devel] EHRtemporalVariability package check warning, cannot fix


*******************
This email originates from outside Imperial. Do not click on links and attachments unless you recognise the sender.
If you trust the sender, add them to your safe senders list https://spam.ic.ac.uk/SpamConsole/Senders.aspx to disable email stamping for this address.
*******************
Hi,



Some weeks ago we received the CRAN notification to update our
EHRtemporalVariability package in light of some Warnings found on the
vignette compilation.



We managed to solve most by including the ?webshot? package in the Suggests
list in DESCRIPTION, since the Vignette is rendered in .html including
dynamic Plotly plots.



However, we cannot manage to solve the last one, and thus we cannot update
the package in CRAN. Local checks show no Warnings (only a Note due to
having 5.1MB file). Even updated R to the latest ver 4.0.2 and R tools to
the latest 4, and all checks ok. But submitting on winbuilder the Warning is
still there.



The logs are here:

 <https://win-builder.r-project.org/9IvFwBBcgDlI>
https://win-builder.r-project.org/9IvFwBBcgDlI



This is the error:



        Error(s) in re-building vignettes:

--- re-building 'EHRtemporalVariability.Rmd' using rmarkdown

Quitting from lines 35-36 (EHRtemporalVariability.Rmd)

Error: processing vignette 'EHRtemporalVariability.Rmd' failed with
diagnostics:

argument is of length zero

--- failed re-building 'EHRtemporalVariability.Rmd'



The package is exactly that found in
https://github.com/hms-dbmi/EHRtemporalVariability



Those lines 35-36 are the first chunk in the .Rmd vignette file:

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning=FALSE)

```

Surprisingly, if removing this chunk and resubmitting, the same ?argument is
of length zero? error is present but in the following (now first) chunk of
code.



Any help would be really appreciated. We would kindly provide any additional
info that could help.

Best regards!

Carlos


        [[alternative HTML version deleted]]


	[[alternative HTML version deleted]]


From j|ox @end|ng |rom mcm@@ter@c@  Wed Oct  7 22:10:41 2020
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Wed, 7 Oct 2020 16:10:41 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
Message-ID: <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>

Dear Ben,

I was hoping that someone would pick up on this problem, because I've 
experienced the same issue of --compact-vignettes apparently ignored, 
e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.

Best,
  John

John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/

On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>  ? Am I confused, or doing something wrong, or ... ?
> 
>  ? I have qpdf installed, and am running R CMD build with 
> --compact-vignettes, but the PDF in the tarball doesn't seem to be 
> compressed despite the fact that the output messages say "compacting 
> vignettes ..."
> 
> 
>  ? $ R CMD build --compact-vignettes lme4
> * checking for file ?lme4/DESCRIPTION? ... OK
> * preparing ?lme4?:
> * checking DESCRIPTION meta-information ... OK
> * cleaning src
> * installing the package to process help pages
> * saving partial Rd database
> * creating vignettes ... OK
> Warning: ?inst/doc? files
>  ??? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>  ? ignored as vignettes have been rebuilt.
>  ? Run R CMD build with --no-build-vignettes to prevent rebuilding.
> * compacting vignettes and other PDF files
> * cleaning src
> * checking for LF line-endings in source and make files and shell scripts
> * checking for empty or unneeded directories
> * building ?lme4_1.1-24.tar.gz?
> 
>  ? The copy of lmer.pdf in the resulting tarball is 900K or so:
> 
> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf
> 
>  ? The previously built (and manually compacted) version of lmer.pdf in 
> the tarball is 500K:
> 
> $ ls -l lme4/inst/doc/lmer.pdf
> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
> 
>  ?? Is 'R CMD build' confused by the presence of a pre-built PDF in the 
> inst/doc directory? Or am I somehow mistaken about how this is supposed 
> to work?
> 
>  ?? I would just use --no-build-vignettes and submit the tarball with 
> the previously built/compressed PDF, but I'm trying to avoid a
> "Package has a VignetteBuilder field but no prebuilt vignette index" 
> NOTE, which I assume is missing because I built without building 
> vignettes ... ?
> 
>  ? As always, enlightenment is welcome.
> 
>  ? cheers
>  ??? Ben Bolker
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Wed Oct  7 23:26:24 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 7 Oct 2020 17:26:24 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
Message-ID: <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>

   I hope so too. The (annoying) workaround is to compact the vignette 
yourself (using qpdf directly or using tools::compactPDF), then use 
no-build-vignettes.  The problem there is whatever's supposed to happen 
with building vignette indices.  The uuuuugly workaround, I guess, is to 
build the tarball, compact the vignettes oneself, then *replace* them in 
the tarball.  (Obviously I can automate that, but it seems as though it 
would be unnecessary if I knew what was going on ...)

   cheers
    Ben


On 10/7/20 4:10 PM, John Fox wrote:
> Dear Ben,
> 
> I was hoping that someone would pick up on this problem, because I've 
> experienced the same issue of --compact-vignettes apparently ignored, 
> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
> 
> Best,
>  ?John
> 
> John Fox, Professor Emeritus
> McMaster University
> Hamilton, Ontario, Canada
> web: https://socialsciences.mcmaster.ca/jfox/
> 
> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>> ?? Am I confused, or doing something wrong, or ... ?
>>
>> ?? I have qpdf installed, and am running R CMD build with 
>> --compact-vignettes, but the PDF in the tarball doesn't seem to be 
>> compressed despite the fact that the output messages say "compacting 
>> vignettes ..."
>>
>>
>> ?? $ R CMD build --compact-vignettes lme4
>> * checking for file ?lme4/DESCRIPTION? ... OK
>> * preparing ?lme4?:
>> * checking DESCRIPTION meta-information ... OK
>> * cleaning src
>> * installing the package to process help pages
>> * saving partial Rd database
>> * creating vignettes ... OK
>> Warning: ?inst/doc? files
>> ???? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>> ?? ignored as vignettes have been rebuilt.
>> ?? Run R CMD build with --no-build-vignettes to prevent rebuilding.
>> * compacting vignettes and other PDF files
>> * cleaning src
>> * checking for LF line-endings in source and make files and shell scripts
>> * checking for empty or unneeded directories
>> * building ?lme4_1.1-24.tar.gz?
>>
>> ?? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>
>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf
>>
>> ?? The previously built (and manually compacted) version of lmer.pdf 
>> in the tarball is 500K:
>>
>> $ ls -l lme4/inst/doc/lmer.pdf
>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
>>
>> ??? Is 'R CMD build' confused by the presence of a pre-built PDF in 
>> the inst/doc directory? Or am I somehow mistaken about how this is 
>> supposed to work?
>>
>> ??? I would just use --no-build-vignettes and submit the tarball with 
>> the previously built/compressed PDF, but I'm trying to avoid a
>> "Package has a VignetteBuilder field but no prebuilt vignette index" 
>> NOTE, which I assume is missing because I built without building 
>> vignettes ... ?
>>
>> ?? As always, enlightenment is welcome.
>>
>> ?? cheers
>> ???? Ben Bolker
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From j|ox @end|ng |rom mcm@@ter@c@  Thu Oct  8 00:03:19 2020
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Wed, 7 Oct 2020 18:03:19 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
Message-ID: <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>

Dear Ben,

On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>  ? I hope so too. The (annoying) workaround is to compact the vignette 
> yourself (using qpdf directly or using tools::compactPDF), then use 
> no-build-vignettes.? The problem there is whatever's supposed to happen 
> with building vignette indices.? The uuuuugly workaround, I guess, is to 
> build the tarball, compact the vignettes oneself, then *replace* them in 
> the tarball.? (Obviously I can automate that, but it seems as though it 
> would be unnecessary if I knew what was going on ...)

I've used both of these workarounds and agree that it would be nice to 
avoid them. After all, what is the --compact-vignettes argument for?

Best,
  John

> 
>  ? cheers
>  ?? Ben
> 
> 
> On 10/7/20 4:10 PM, John Fox wrote:
>> Dear Ben,
>>
>> I was hoping that someone would pick up on this problem, because I've 
>> experienced the same issue of --compact-vignettes apparently ignored, 
>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>
>> Best,
>> ??John
>>
>> John Fox, Professor Emeritus
>> McMaster University
>> Hamilton, Ontario, Canada
>> web: https://socialsciences.mcmaster.ca/jfox/
>>
>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>> ?? Am I confused, or doing something wrong, or ... ?
>>>
>>> ?? I have qpdf installed, and am running R CMD build with 
>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be 
>>> compressed despite the fact that the output messages say "compacting 
>>> vignettes ..."
>>>
>>>
>>> ?? $ R CMD build --compact-vignettes lme4
>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>> * preparing ?lme4?:
>>> * checking DESCRIPTION meta-information ... OK
>>> * cleaning src
>>> * installing the package to process help pages
>>> * saving partial Rd database
>>> * creating vignettes ... OK
>>> Warning: ?inst/doc? files
>>> ???? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>> ?? ignored as vignettes have been rebuilt.
>>> ?? Run R CMD build with --no-build-vignettes to prevent rebuilding.
>>> * compacting vignettes and other PDF files
>>> * cleaning src
>>> * checking for LF line-endings in source and make files and shell 
>>> scripts
>>> * checking for empty or unneeded directories
>>> * building ?lme4_1.1-24.tar.gz?
>>>
>>> ?? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>
>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf
>>>
>>> ?? The previously built (and manually compacted) version of lmer.pdf 
>>> in the tarball is 500K:
>>>
>>> $ ls -l lme4/inst/doc/lmer.pdf
>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
>>>
>>> ??? Is 'R CMD build' confused by the presence of a pre-built PDF in 
>>> the inst/doc directory? Or am I somehow mistaken about how this is 
>>> supposed to work?
>>>
>>> ??? I would just use --no-build-vignettes and submit the tarball with 
>>> the previously built/compressed PDF, but I'm trying to avoid a
>>> "Package has a VignetteBuilder field but no prebuilt vignette index" 
>>> NOTE, which I assume is missing because I built without building 
>>> vignettes ... ?
>>>
>>> ?? As always, enlightenment is welcome.
>>>
>>> ?? cheers
>>> ???? Ben Bolker
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct  8 02:31:56 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 7 Oct 2020 20:31:56 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
Message-ID: <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>

I don't know the answer to your question, but you can debug the 
--compact-vignettes option as follows.

debug(tools::compactPDF)
tools:::.build_packages(c("--compact-vignettes", "pkgdir"))

where "pkgdir" is the directory of the source of your package.  Add 
extra options to the build as separate elements of the argument to 
.build():  this function is called after args have been parsed.

When I do that, I see that it rejects the compaction, because none of 
mine benefit much from it:  it wants at least a 10% and 10K reduction. 
But Ben's example met those criteria.  When I trick it into accepting 
the compaction, it does put the compacted PDF into the tarball.

Duncan Murdoch

On 07/10/2020 6:03 p.m., John Fox wrote:
> Dear Ben,
> 
> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>   ? I hope so too. The (annoying) workaround is to compact the vignette
>> yourself (using qpdf directly or using tools::compactPDF), then use
>> no-build-vignettes.? The problem there is whatever's supposed to happen
>> with building vignette indices.? The uuuuugly workaround, I guess, is to
>> build the tarball, compact the vignettes oneself, then *replace* them in
>> the tarball.? (Obviously I can automate that, but it seems as though it
>> would be unnecessary if I knew what was going on ...)
> 
> I've used both of these workarounds and agree that it would be nice to
> avoid them. After all, what is the --compact-vignettes argument for?
> 
> Best,
>    John
> 
>>
>>   ? cheers
>>   ?? Ben
>>
>>
>> On 10/7/20 4:10 PM, John Fox wrote:
>>> Dear Ben,
>>>
>>> I was hoping that someone would pick up on this problem, because I've
>>> experienced the same issue of --compact-vignettes apparently ignored,
>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>>
>>> Best,
>>>  ??John
>>>
>>> John Fox, Professor Emeritus
>>> McMaster University
>>> Hamilton, Ontario, Canada
>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>
>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>  ?? Am I confused, or doing something wrong, or ... ?
>>>>
>>>>  ?? I have qpdf installed, and am running R CMD build with
>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>> compressed despite the fact that the output messages say "compacting
>>>> vignettes ..."
>>>>
>>>>
>>>>  ?? $ R CMD build --compact-vignettes lme4
>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>> * preparing ?lme4?:
>>>> * checking DESCRIPTION meta-information ... OK
>>>> * cleaning src
>>>> * installing the package to process help pages
>>>> * saving partial Rd database
>>>> * creating vignettes ... OK
>>>> Warning: ?inst/doc? files
>>>>  ???? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>  ?? ignored as vignettes have been rebuilt.
>>>>  ?? Run R CMD build with --no-build-vignettes to prevent rebuilding.
>>>> * compacting vignettes and other PDF files
>>>> * cleaning src
>>>> * checking for LF line-endings in source and make files and shell
>>>> scripts
>>>> * checking for empty or unneeded directories
>>>> * building ?lme4_1.1-24.tar.gz?
>>>>
>>>>  ?? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>
>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf
>>>>
>>>>  ?? The previously built (and manually compacted) version of lmer.pdf
>>>> in the tarball is 500K:
>>>>
>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
>>>>
>>>>  ??? Is 'R CMD build' confused by the presence of a pre-built PDF in
>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>> supposed to work?
>>>>
>>>>  ??? I would just use --no-build-vignettes and submit the tarball with
>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>> "Package has a VignetteBuilder field but no prebuilt vignette index"
>>>> NOTE, which I assume is missing because I built without building
>>>> vignettes ... ?
>>>>
>>>>  ?? As always, enlightenment is welcome.
>>>>
>>>>  ?? cheers
>>>>  ???? Ben Bolker
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From bbo|ker @end|ng |rom gm@||@com  Thu Oct  8 02:32:16 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 7 Oct 2020 20:32:16 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
Message-ID: <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>

   Thanks for the tip, I'll take a look.

   Given that three relatively experienced package authors all seem to 
have experienced similar issues, it seems that maybe this is worth 
figuring out/maybe I'm not just doing something boneheaded.

   cheers
     Ben

On 10/7/20 8:31 PM, Duncan Murdoch wrote:
> I don't know the answer to your question, but you can debug the 
> --compact-vignettes option as follows.
> 
> debug(tools::compactPDF)
> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
> 
> where "pkgdir" is the directory of the source of your package.? Add 
> extra options to the build as separate elements of the argument to 
> .build():? this function is called after args have been parsed.
> 
> When I do that, I see that it rejects the compaction, because none of 
> mine benefit much from it:? it wants at least a 10% and 10K reduction. 
> But Ben's example met those criteria.? When I trick it into accepting 
> the compaction, it does put the compacted PDF into the tarball.
> 
> Duncan Murdoch
> 
> On 07/10/2020 6:03 p.m., John Fox wrote:
>> Dear Ben,
>>
>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>> ? ? I hope so too. The (annoying) workaround is to compact the vignette
>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>> no-build-vignettes.? The problem there is whatever's supposed to happen
>>> with building vignette indices.? The uuuuugly workaround, I guess, is to
>>> build the tarball, compact the vignettes oneself, then *replace* them in
>>> the tarball.? (Obviously I can automate that, but it seems as though it
>>> would be unnecessary if I knew what was going on ...)
>>
>> I've used both of these workarounds and agree that it would be nice to
>> avoid them. After all, what is the --compact-vignettes argument for?
>>
>> Best,
>> ?? John
>>
>>>
>>> ? ? cheers
>>> ? ?? Ben
>>>
>>>
>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>> Dear Ben,
>>>>
>>>> I was hoping that someone would pick up on this problem, because I've
>>>> experienced the same issue of --compact-vignettes apparently ignored,
>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>>>
>>>> Best,
>>>> ???John
>>>>
>>>> John Fox, Professor Emeritus
>>>> McMaster University
>>>> Hamilton, Ontario, Canada
>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>
>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>> ??? Am I confused, or doing something wrong, or ... ?
>>>>>
>>>>> ??? I have qpdf installed, and am running R CMD build with
>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>> compressed despite the fact that the output messages say "compacting
>>>>> vignettes ..."
>>>>>
>>>>>
>>>>> ??? $ R CMD build --compact-vignettes lme4
>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>> * preparing ?lme4?:
>>>>> * checking DESCRIPTION meta-information ... OK
>>>>> * cleaning src
>>>>> * installing the package to process help pages
>>>>> * saving partial Rd database
>>>>> * creating vignettes ... OK
>>>>> Warning: ?inst/doc? files
>>>>> ????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>> ??? ignored as vignettes have been rebuilt.
>>>>> ??? Run R CMD build with --no-build-vignettes to prevent rebuilding.
>>>>> * compacting vignettes and other PDF files
>>>>> * cleaning src
>>>>> * checking for LF line-endings in source and make files and shell
>>>>> scripts
>>>>> * checking for empty or unneeded directories
>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>
>>>>> ??? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>
>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59 
>>>>> lme4/inst/doc/lmer.pdf
>>>>>
>>>>> ??? The previously built (and manually compacted) version of lmer.pdf
>>>>> in the tarball is 500K:
>>>>>
>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
>>>>>
>>>>> ???? Is 'R CMD build' confused by the presence of a pre-built PDF in
>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>> supposed to work?
>>>>>
>>>>> ???? I would just use --no-build-vignettes and submit the tarball with
>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>> "Package has a VignetteBuilder field but no prebuilt vignette index"
>>>>> NOTE, which I assume is missing because I built without building
>>>>> vignettes ... ?
>>>>>
>>>>> ??? As always, enlightenment is welcome.
>>>>>
>>>>> ??? cheers
>>>>> ????? Ben Bolker
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct  8 02:35:48 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Wed, 7 Oct 2020 20:35:48 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
Message-ID: <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>

On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>     Thanks for the tip, I'll take a look.
> 
>     Given that three relatively experienced package authors all seem to
> have experienced similar issues, it seems that maybe this is worth
> figuring out/maybe I'm not just doing something boneheaded.

Just to clarify:  I've never noticed the problem you mention.  I just 
know how to debug R CMD build.

Duncan

> 
>     cheers
>       Ben
> 
> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>> I don't know the answer to your question, but you can debug the
>> --compact-vignettes option as follows.
>>
>> debug(tools::compactPDF)
>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>
>> where "pkgdir" is the directory of the source of your package.? Add
>> extra options to the build as separate elements of the argument to
>> .build():? this function is called after args have been parsed.
>>
>> When I do that, I see that it rejects the compaction, because none of
>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>> But Ben's example met those criteria.? When I trick it into accepting
>> the compaction, it does put the compacted PDF into the tarball.
>>
>> Duncan Murdoch
>>
>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>> Dear Ben,
>>>
>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>  ? ? I hope so too. The (annoying) workaround is to compact the vignette
>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>> no-build-vignettes.? The problem there is whatever's supposed to happen
>>>> with building vignette indices.? The uuuuugly workaround, I guess, is to
>>>> build the tarball, compact the vignettes oneself, then *replace* them in
>>>> the tarball.? (Obviously I can automate that, but it seems as though it
>>>> would be unnecessary if I knew what was going on ...)
>>>
>>> I've used both of these workarounds and agree that it would be nice to
>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>
>>> Best,
>>>  ?? John
>>>
>>>>
>>>>  ? ? cheers
>>>>  ? ?? Ben
>>>>
>>>>
>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>> Dear Ben,
>>>>>
>>>>> I was hoping that someone would pick up on this problem, because I've
>>>>> experienced the same issue of --compact-vignettes apparently ignored,
>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>>>>
>>>>> Best,
>>>>>  ???John
>>>>>
>>>>> John Fox, Professor Emeritus
>>>>> McMaster University
>>>>> Hamilton, Ontario, Canada
>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>
>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>  ??? Am I confused, or doing something wrong, or ... ?
>>>>>>
>>>>>>  ??? I have qpdf installed, and am running R CMD build with
>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>> compressed despite the fact that the output messages say "compacting
>>>>>> vignettes ..."
>>>>>>
>>>>>>
>>>>>>  ??? $ R CMD build --compact-vignettes lme4
>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>> * preparing ?lme4?:
>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>> * cleaning src
>>>>>> * installing the package to process help pages
>>>>>> * saving partial Rd database
>>>>>> * creating vignettes ... OK
>>>>>> Warning: ?inst/doc? files
>>>>>>  ????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>  ??? ignored as vignettes have been rebuilt.
>>>>>>  ??? Run R CMD build with --no-build-vignettes to prevent rebuilding.
>>>>>> * compacting vignettes and other PDF files
>>>>>> * cleaning src
>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>> scripts
>>>>>> * checking for empty or unneeded directories
>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>
>>>>>>  ??? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>
>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>
>>>>>>  ??? The previously built (and manually compacted) version of lmer.pdf
>>>>>> in the tarball is 500K:
>>>>>>
>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
>>>>>>
>>>>>>  ???? Is 'R CMD build' confused by the presence of a pre-built PDF in
>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>> supposed to work?
>>>>>>
>>>>>>  ???? I would just use --no-build-vignettes and submit the tarball with
>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette index"
>>>>>> NOTE, which I assume is missing because I built without building
>>>>>> vignettes ... ?
>>>>>>
>>>>>>  ??? As always, enlightenment is welcome.
>>>>>>
>>>>>>  ??? cheers
>>>>>>  ????? Ben Bolker
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-package-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>


From bbo|ker @end|ng |rom gm@||@com  Thu Oct  8 02:42:08 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 7 Oct 2020 20:42:08 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
Message-ID: <7da46588-a58b-1a48-9e6c-22e8a2fdaaaa@gmail.com>



On 10/7/20 8:35 PM, Duncan Murdoch wrote:
> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>> ??? Thanks for the tip, I'll take a look.
>>
>> ??? Given that three relatively experienced package authors all seem to
>> have experienced similar issues, it seems that maybe this is worth
>> figuring out/maybe I'm not just doing something boneheaded.
> 
> Just to clarify:? I've never noticed the problem you mention.? I just 
> know how to debug R CMD build.

   I wasn't saying you had. My count of three was Bolker (me), Fox, Nash.

   cheers
     Ben

> 
> Duncan
> 
>>
>> ??? cheers
>> ????? Ben
>>
>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>> I don't know the answer to your question, but you can debug the
>>> --compact-vignettes option as follows.
>>>
>>> debug(tools::compactPDF)
>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>
>>> where "pkgdir" is the directory of the source of your package.? Add
>>> extra options to the build as separate elements of the argument to
>>> .build():? this function is called after args have been parsed.
>>>
>>> When I do that, I see that it rejects the compaction, because none of
>>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>>> But Ben's example met those criteria.? When I trick it into accepting
>>> the compaction, it does put the compacted PDF into the tarball.
>>>
>>> Duncan Murdoch
>>>
>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>> Dear Ben,
>>>>
>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>> ?? ? I hope so too. The (annoying) workaround is to compact the 
>>>>> vignette
>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>> no-build-vignettes.? The problem there is whatever's supposed to 
>>>>> happen
>>>>> with building vignette indices.? The uuuuugly workaround, I guess, 
>>>>> is to
>>>>> build the tarball, compact the vignettes oneself, then *replace* 
>>>>> them in
>>>>> the tarball.? (Obviously I can automate that, but it seems as 
>>>>> though it
>>>>> would be unnecessary if I knew what was going on ...)
>>>>
>>>> I've used both of these workarounds and agree that it would be nice to
>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>
>>>> Best,
>>>> ??? John
>>>>
>>>>>
>>>>> ?? ? cheers
>>>>> ?? ?? Ben
>>>>>
>>>>>
>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>> Dear Ben,
>>>>>>
>>>>>> I was hoping that someone would pick up on this problem, because I've
>>>>>> experienced the same issue of --compact-vignettes apparently ignored,
>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>>>>>
>>>>>> Best,
>>>>>> ????John
>>>>>>
>>>>>> John Fox, Professor Emeritus
>>>>>> McMaster University
>>>>>> Hamilton, Ontario, Canada
>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>
>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>> ???? Am I confused, or doing something wrong, or ... ?
>>>>>>>
>>>>>>> ???? I have qpdf installed, and am running R CMD build with
>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>>> compressed despite the fact that the output messages say "compacting
>>>>>>> vignettes ..."
>>>>>>>
>>>>>>>
>>>>>>> ???? $ R CMD build --compact-vignettes lme4
>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>> * preparing ?lme4?:
>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>> * cleaning src
>>>>>>> * installing the package to process help pages
>>>>>>> * saving partial Rd database
>>>>>>> * creating vignettes ... OK
>>>>>>> Warning: ?inst/doc? files
>>>>>>> ?????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>> ???? ignored as vignettes have been rebuilt.
>>>>>>> ???? Run R CMD build with --no-build-vignettes to prevent 
>>>>>>> rebuilding.
>>>>>>> * compacting vignettes and other PDF files
>>>>>>> * cleaning src
>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>> scripts
>>>>>>> * checking for empty or unneeded directories
>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>
>>>>>>> ???? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>>
>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>
>>>>>>> ???? The previously built (and manually compacted) version of 
>>>>>>> lmer.pdf
>>>>>>> in the tarball is 500K:
>>>>>>>
>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 
>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>
>>>>>>> ????? Is 'R CMD build' confused by the presence of a pre-built 
>>>>>>> PDF in
>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>>> supposed to work?
>>>>>>>
>>>>>>> ????? I would just use --no-build-vignettes and submit the 
>>>>>>> tarball with
>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette index"
>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>> vignettes ... ?
>>>>>>>
>>>>>>> ???? As always, enlightenment is welcome.
>>>>>>>
>>>>>>> ???? cheers
>>>>>>> ?????? Ben Bolker
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>


From bbo|ker @end|ng |rom gm@||@com  Thu Oct  8 04:06:13 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Wed, 7 Oct 2020 22:06:13 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
Message-ID: <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>

   OK, I think I see the problem. tl;dr use --compact-vignettes="both" 
when building the vignettes.

   --compact-vignettes  by default only tries qpdf.

   when the R CMD check --as-cran is run, it tries both qpdf and gs. 
Since gs (apparently, in this case) compresses more aggressively than 
qpdf, it succeeds in compressing further, and the check complains.

 From R CMD build --help:

  --compact-vignettes=  try to compact PDF files under inst/doc:
                         "no" (default), "qpdf", "gs", "gs+qpdf", "both"
   --compact-vignettes   same as --compact-vignettes=qpdf


   I don't know if this is worth documenting somewhere, or modifying the 
behaviour to make "both" the default for --compact-vignettes ?


On 10/7/20 8:35 PM, Duncan Murdoch wrote:
> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>> ??? Thanks for the tip, I'll take a look.
>>
>> ??? Given that three relatively experienced package authors all seem to
>> have experienced similar issues, it seems that maybe this is worth
>> figuring out/maybe I'm not just doing something boneheaded.
> 
> Just to clarify:? I've never noticed the problem you mention.? I just 
> know how to debug R CMD build.
> 
> Duncan
> 
>>
>> ??? cheers
>> ????? Ben
>>
>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>> I don't know the answer to your question, but you can debug the
>>> --compact-vignettes option as follows.
>>>
>>> debug(tools::compactPDF)
>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>
>>> where "pkgdir" is the directory of the source of your package.? Add
>>> extra options to the build as separate elements of the argument to
>>> .build():? this function is called after args have been parsed.
>>>
>>> When I do that, I see that it rejects the compaction, because none of
>>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>>> But Ben's example met those criteria.? When I trick it into accepting
>>> the compaction, it does put the compacted PDF into the tarball.
>>>
>>> Duncan Murdoch
>>>
>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>> Dear Ben,
>>>>
>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>> ?? ? I hope so too. The (annoying) workaround is to compact the 
>>>>> vignette
>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>> no-build-vignettes.? The problem there is whatever's supposed to 
>>>>> happen
>>>>> with building vignette indices.? The uuuuugly workaround, I guess, 
>>>>> is to
>>>>> build the tarball, compact the vignettes oneself, then *replace* 
>>>>> them in
>>>>> the tarball.? (Obviously I can automate that, but it seems as 
>>>>> though it
>>>>> would be unnecessary if I knew what was going on ...)
>>>>
>>>> I've used both of these workarounds and agree that it would be nice to
>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>
>>>> Best,
>>>> ??? John
>>>>
>>>>>
>>>>> ?? ? cheers
>>>>> ?? ?? Ben
>>>>>
>>>>>
>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>> Dear Ben,
>>>>>>
>>>>>> I was hoping that someone would pick up on this problem, because I've
>>>>>> experienced the same issue of --compact-vignettes apparently ignored,
>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and Windows.
>>>>>>
>>>>>> Best,
>>>>>> ????John
>>>>>>
>>>>>> John Fox, Professor Emeritus
>>>>>> McMaster University
>>>>>> Hamilton, Ontario, Canada
>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>
>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>> ???? Am I confused, or doing something wrong, or ... ?
>>>>>>>
>>>>>>> ???? I have qpdf installed, and am running R CMD build with
>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>>> compressed despite the fact that the output messages say "compacting
>>>>>>> vignettes ..."
>>>>>>>
>>>>>>>
>>>>>>> ???? $ R CMD build --compact-vignettes lme4
>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>> * preparing ?lme4?:
>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>> * cleaning src
>>>>>>> * installing the package to process help pages
>>>>>>> * saving partial Rd database
>>>>>>> * creating vignettes ... OK
>>>>>>> Warning: ?inst/doc? files
>>>>>>> ?????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>> ???? ignored as vignettes have been rebuilt.
>>>>>>> ???? Run R CMD build with --no-build-vignettes to prevent 
>>>>>>> rebuilding.
>>>>>>> * compacting vignettes and other PDF files
>>>>>>> * cleaning src
>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>> scripts
>>>>>>> * checking for empty or unneeded directories
>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>
>>>>>>> ???? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>>
>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>
>>>>>>> ???? The previously built (and manually compacted) version of 
>>>>>>> lmer.pdf
>>>>>>> in the tarball is 500K:
>>>>>>>
>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 
>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>
>>>>>>> ????? Is 'R CMD build' confused by the presence of a pre-built 
>>>>>>> PDF in
>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>>> supposed to work?
>>>>>>>
>>>>>>> ????? I would just use --no-build-vignettes and submit the 
>>>>>>> tarball with
>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette index"
>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>> vignettes ... ?
>>>>>>>
>>>>>>> ???? As always, enlightenment is welcome.
>>>>>>>
>>>>>>> ???? cheers
>>>>>>> ?????? Ben Bolker
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>> ______________________________________________
>>>> R-package-devel at r-project.org mailing list
>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>
>>>
>


From m@ech|er @end|ng |rom @t@t@m@th@ethz@ch  Thu Oct  8 09:20:16 2020
From: m@ech|er @end|ng |rom @t@t@m@th@ethz@ch (Martin Maechler)
Date: Thu, 8 Oct 2020 09:20:16 +0200
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <7da46588-a58b-1a48-9e6c-22e8a2fdaaaa@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <7da46588-a58b-1a48-9e6c-22e8a2fdaaaa@gmail.com>
Message-ID: <24446.48560.623988.234480@stat.math.ethz.ch>

>>>>> Ben Bolker 
>>>>>     on Wed, 7 Oct 2020 20:42:08 -0400 writes:

    > On 10/7/20 8:35 PM, Duncan Murdoch wrote:
    >> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
    >>> ??? Thanks for the tip, I'll take a look.
    >>> 
    >>> ??? Given that three relatively experienced package
    >>> authors all seem to have experienced similar issues, it
    >>> seems that maybe this is worth figuring out/maybe I'm
    >>> not just doing something boneheaded.
    >> 
    >> Just to clarify:? I've never noticed the problem you
    >> mention.? I just know how to debug R CMD build.

    >    I wasn't saying you had. My count of three was Bolker
    > (me), Fox, Nash.

    >    cheers Ben

    >> 
    >> Duncan

Thank you,  Ben, John (2x), and Duncan.

I agree this should be investigated and fixed if/where needed.
My personal experience is that PDF compaction "has worked for
me" mostly, but not always; I think I never had looked closely
when it did not work, and yes, I know I also had used manual
compaction when I was unhappy with the automatic one.

Given that lme4 takes relatively long, and also given Duncan
Murdoch's precise instruction on how to debug,
could you try to find a  as small as "possible"  repr.example?
Of course it needs a vignette whose pdf is relatively large or
rather "well compactable", but otherwise could also be an
artificial package.

Martin

    >>> 
    >>> ??? cheers ????? Ben
    >>> 
    >>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
    >>>> I don't know the answer to your question, but you can
    >>>> debug the --compact-vignettes option as follows.
    >>>> 
    >>>> debug(tools::compactPDF)
    >>>> tools:::.build_packages(c("--compact-vignettes",
    >>>> "pkgdir"))
    >>>> 
    >>>> where "pkgdir" is the directory of the source of your
    >>>> package.? Add extra options to the build as separate
    >>>> elements of the argument to .build():? this function is
    >>>> called after args have been parsed.
    >>>> 
    >>>> When I do that, I see that it rejects the compaction,
    >>>> because none of mine benefit much from it:? it wants at
    >>>> least a 10% and 10K reduction.  But Ben's example met
    >>>> those criteria.? When I trick it into accepting the
    >>>> compaction, it does put the compacted PDF into the
    >>>> tarball.
    >>>> 
    >>>> Duncan Murdoch
    >>>> 
    >>>> On 07/10/2020 6:03 p.m., John Fox wrote:
    >>>>> Dear Ben,
    >>>>> 
    >>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>> ?? ? I hope so too. The (annoying) workaround is to
    >>>>> compact the
>>>>> vignette
>>>>> yourself (using qpdf directly or using tools::compactPDF),
    >>>>> then use
>>>>> no-build-vignettes.? The problem there is whatever's
    >>>>> supposed to
>>>>> happen
>>>>> with building vignette indices.? The uuuuugly workaround,
    >>>>> I guess,
>>>>> is to
>>>>> build the tarball, compact the vignettes oneself, then
    >>>>> *replace*
>>>>> them in
>>>>> the tarball.? (Obviously I can automate that, but it seems
    >>>>> as
>>>>> though it
>>>>> would be unnecessary if I knew what was going on ...)
    >>>>> 
    >>>>> I've used both of these workarounds and agree that it
    >>>>> would be nice to avoid them. After all, what is the
    >>>>> --compact-vignettes argument for?
    >>>>> 
    >>>>> Best, ??? John
    >>>>> 
    >>>>>> 
>>>>> ?? ? cheers
>>>>> ?? ?? Ben
    >>>>>> 
    >>>>>> 
>>>>> On 10/7/20 4:10 PM, John Fox wrote:
    >>>>>>> Dear Ben,
    >>>>>>> 
    >>>>>>> I was hoping that someone would pick up on this
    >>>>>>> problem, because I've experienced the same issue of
    >>>>>>> --compact-vignettes apparently ignored, e.g., with
    >>>>>>> the Rcmdr package under R 4.0.2 on both macOS and
    >>>>>>> Windows.
    >>>>>>> 
    >>>>>>> Best, ????John
    >>>>>>> 
    >>>>>>> John Fox, Professor Emeritus McMaster University
    >>>>>>> Hamilton, Ontario, Canada web:
    >>>>>>> https://socialsciences.mcmaster.ca/jfox/
    >>>>>>> 
    >>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
    >>>>>>>> ???? Am I confused, or doing something wrong, or
    >>>>>>>> ... ?
    >>>>>>>> 
    >>>>>>>> ???? I have qpdf installed, and am running R CMD
    >>>>>>>> build with --compact-vignettes, but the PDF in the
    >>>>>>>> tarball doesn't seem to be compressed despite the
    >>>>>>>> fact that the output messages say "compacting
    >>>>>>>> vignettes ..."
    >>>>>>>> 
    >>>>>>>> 
    >>>>>>>> ???? $ R CMD build --compact-vignettes lme4 *
    >>>>>>>> checking for file ?lme4/DESCRIPTION? ... OK *
    >>>>>>>> preparing ?lme4?: * checking DESCRIPTION
    >>>>>>>> meta-information ... OK * cleaning src * installing
    >>>>>>>> the package to process help pages * saving partial
    >>>>>>>> Rd database * creating vignettes ... OK Warning:
    >>>>>>>> ?inst/doc? files ?????? ?lmerperf.html?,
    >>>>>>>> ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf? ????
    >>>>>>>> ignored as vignettes have been rebuilt.  ???? Run R
    >>>>>>>> CMD build with --no-build-vignettes to prevent
    >>>>>>>> rebuilding.  * compacting vignettes and other PDF
    >>>>>>>> files * cleaning src * checking for LF line-endings
    >>>>>>>> in source and make files and shell scripts *
    >>>>>>>> checking for empty or unneeded directories *
    >>>>>>>> building ?lme4_1.1-24.tar.gz?
    >>>>>>>> 
    >>>>>>>> ???? The copy of lmer.pdf in the resulting tarball
    >>>>>>>> is 900K or so:
    >>>>>>>> 
    >>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz
    >>>>>>>> lme4/inst/doc/lmer.pdf -rw-r--r-- bolker/bolker
    >>>>>>>> 907022 2020-10-05 12:59 lme4/inst/doc/lmer.pdf
    >>>>>>>> 
    >>>>>>>> ???? The previously built (and manually compacted)
    >>>>>>>> version of lmer.pdf in the tarball is 500K:
    >>>>>>>> 
    >>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf -rw-r--r-- 1 bolker
    >>>>>>>> bolker 495199 Oct? 3 22:15 lme4/inst/doc/lmer.pdf
    >>>>>>>> 
    >>>>>>>> ????? Is 'R CMD build' confused by the presence of
    >>>>>>>> a pre-built PDF in the inst/doc directory? Or am I
    >>>>>>>> somehow mistaken about how this is supposed to
    >>>>>>>> work?
    >>>>>>>> 
    >>>>>>>> ????? I would just use --no-build-vignettes and
    >>>>>>>> submit the tarball with the previously
    >>>>>>>> built/compressed PDF, but I'm trying to avoid a
    >>>>>>>> "Package has a VignetteBuilder field but no
    >>>>>>>> prebuilt vignette index" NOTE, which I assume is
    >>>>>>>> missing because I built without building vignettes
    >>>>>>>> ... ?
    >>>>>>>> 
    >>>>>>>> ???? As always, enlightenment is welcome.
    >>>>>>>> 
    >>>>>>>> ???? cheers ?????? Ben Bolker
    >>>>>>>> 
    >>>>>>>> ______________________________________________
    >>>>>>>> R-package-devel at r-project.org mailing list
    >>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
    >>>>> 
    >>>>> ______________________________________________
    >>>>> R-package-devel at r-project.org mailing list
    >>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
    >>>>> 
    >>>> 
    >> 

    > ______________________________________________
    > R-package-devel at r-project.org mailing list
    > https://stat.ethz.ch/mailman/listinfo/r-package-devel


From j|ox @end|ng |rom mcm@@ter@c@  Thu Oct  8 17:10:30 2020
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Thu, 8 Oct 2020 11:10:30 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
Message-ID: <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>

Dear Ben,

Actually, what I used was --compact-vignettes="both", with qpdf and gs 
installed on my Windows and Mac machines, and that apparently didn't 
work for me.

Best,
  John

On 2020-10-07 10:06 p.m., Ben Bolker wrote:
>  ? OK, I think I see the problem. tl;dr use --compact-vignettes="both" 
> when building the vignettes.
> 
>  ? --compact-vignettes? by default only tries qpdf.
> 
>  ? when the R CMD check --as-cran is run, it tries both qpdf and gs. 
> Since gs (apparently, in this case) compresses more aggressively than 
> qpdf, it succeeds in compressing further, and the check complains.
> 
>  From R CMD build --help:
> 
>  ?--compact-vignettes=? try to compact PDF files under inst/doc:
>  ??????????????????????? "no" (default), "qpdf", "gs", "gs+qpdf", "both"
>  ? --compact-vignettes?? same as --compact-vignettes=qpdf
> 
> 
>  ? I don't know if this is worth documenting somewhere, or modifying the 
> behaviour to make "both" the default for --compact-vignettes ?
> 
> 
> On 10/7/20 8:35 PM, Duncan Murdoch wrote:
>> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>>> ??? Thanks for the tip, I'll take a look.
>>>
>>> ??? Given that three relatively experienced package authors all seem to
>>> have experienced similar issues, it seems that maybe this is worth
>>> figuring out/maybe I'm not just doing something boneheaded.
>>
>> Just to clarify:? I've never noticed the problem you mention.? I just 
>> know how to debug R CMD build.
>>
>> Duncan
>>
>>>
>>> ??? cheers
>>> ????? Ben
>>>
>>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>>> I don't know the answer to your question, but you can debug the
>>>> --compact-vignettes option as follows.
>>>>
>>>> debug(tools::compactPDF)
>>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>>
>>>> where "pkgdir" is the directory of the source of your package.? Add
>>>> extra options to the build as separate elements of the argument to
>>>> .build():? this function is called after args have been parsed.
>>>>
>>>> When I do that, I see that it rejects the compaction, because none of
>>>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>>>> But Ben's example met those criteria.? When I trick it into accepting
>>>> the compaction, it does put the compacted PDF into the tarball.
>>>>
>>>> Duncan Murdoch
>>>>
>>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>>> Dear Ben,
>>>>>
>>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>>> ?? ? I hope so too. The (annoying) workaround is to compact the 
>>>>>> vignette
>>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>>> no-build-vignettes.? The problem there is whatever's supposed to 
>>>>>> happen
>>>>>> with building vignette indices.? The uuuuugly workaround, I guess, 
>>>>>> is to
>>>>>> build the tarball, compact the vignettes oneself, then *replace* 
>>>>>> them in
>>>>>> the tarball.? (Obviously I can automate that, but it seems as 
>>>>>> though it
>>>>>> would be unnecessary if I knew what was going on ...)
>>>>>
>>>>> I've used both of these workarounds and agree that it would be nice to
>>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>>
>>>>> Best,
>>>>> ??? John
>>>>>
>>>>>>
>>>>>> ?? ? cheers
>>>>>> ?? ?? Ben
>>>>>>
>>>>>>
>>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>>> Dear Ben,
>>>>>>>
>>>>>>> I was hoping that someone would pick up on this problem, because 
>>>>>>> I've
>>>>>>> experienced the same issue of --compact-vignettes apparently 
>>>>>>> ignored,
>>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and 
>>>>>>> Windows.
>>>>>>>
>>>>>>> Best,
>>>>>>> ????John
>>>>>>>
>>>>>>> John Fox, Professor Emeritus
>>>>>>> McMaster University
>>>>>>> Hamilton, Ontario, Canada
>>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>>
>>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>>> ???? Am I confused, or doing something wrong, or ... ?
>>>>>>>>
>>>>>>>> ???? I have qpdf installed, and am running R CMD build with
>>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>>>> compressed despite the fact that the output messages say 
>>>>>>>> "compacting
>>>>>>>> vignettes ..."
>>>>>>>>
>>>>>>>>
>>>>>>>> ???? $ R CMD build --compact-vignettes lme4
>>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>>> * preparing ?lme4?:
>>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>>> * cleaning src
>>>>>>>> * installing the package to process help pages
>>>>>>>> * saving partial Rd database
>>>>>>>> * creating vignettes ... OK
>>>>>>>> Warning: ?inst/doc? files
>>>>>>>> ?????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>>> ???? ignored as vignettes have been rebuilt.
>>>>>>>> ???? Run R CMD build with --no-build-vignettes to prevent 
>>>>>>>> rebuilding.
>>>>>>>> * compacting vignettes and other PDF files
>>>>>>>> * cleaning src
>>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>>> scripts
>>>>>>>> * checking for empty or unneeded directories
>>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>>
>>>>>>>> ???? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>>>
>>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>
>>>>>>>> ???? The previously built (and manually compacted) version of 
>>>>>>>> lmer.pdf
>>>>>>>> in the tarball is 500K:
>>>>>>>>
>>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 
>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>
>>>>>>>> ????? Is 'R CMD build' confused by the presence of a pre-built 
>>>>>>>> PDF in
>>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>>>> supposed to work?
>>>>>>>>
>>>>>>>> ????? I would just use --no-build-vignettes and submit the 
>>>>>>>> tarball with
>>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette 
>>>>>>>> index"
>>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>>> vignettes ... ?
>>>>>>>>
>>>>>>>> ???? As always, enlightenment is welcome.
>>>>>>>>
>>>>>>>> ???? cheers
>>>>>>>> ?????? Ben Bolker
>>>>>>>>
>>>>>>>> ______________________________________________
>>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>>> ______________________________________________
>>>>> R-package-devel at r-project.org mailing list
>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>
>>>>
>>


From bbo|ker @end|ng |rom gm@||@com  Thu Oct  8 17:14:04 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Thu, 8 Oct 2020 11:14:04 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
 <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
Message-ID: <2003a588-3b9c-4d0b-43e1-76d316ea60b7@gmail.com>

   Huh, weird. "both" worked for me.

   My debugging process involved instrumenting the compression function 
to report what it was doing (see below), rebuilding R, and running the 
build and check --as-cran processes again. (If the package you're 
experiencing problems with is public, feel free to point me to it and 
I'll try to take a look.)

   cheers
    Ben

Index: src/library/tools/R/admin.R
===================================================================
--- src/library/tools/R/admin.R	(revision 79311)
+++ src/library/tools/R/admin.R	(working copy)
@@ -1088,6 +1088,7 @@
          }
          if(!res && file.exists(tf)) {
              old <- file.size(p); new <-  file.size(tf)
+            cat(sprintf("compression: old=%f, new=%f, new/old=%f, 
old-new=%f",old, new, new/old,old-new),"\n")
              if(new/old < 0.9 && new < old - 1e4) {
                  file.copy(tf, p, overwrite = TRUE)
                  ans[p, ] <- c(old, new)


On 10/8/20 11:10 AM, John Fox wrote:
> Dear Ben,
> 
> Actually, what I used was --compact-vignettes="both", with qpdf and gs 
> installed on my Windows and Mac machines, and that apparently didn't 
> work for me.
> 
> Best,
>  ?John
> 
> On 2020-10-07 10:06 p.m., Ben Bolker wrote:
>> ?? OK, I think I see the problem. tl;dr use --compact-vignettes="both" 
>> when building the vignettes.
>>
>> ?? --compact-vignettes? by default only tries qpdf.
>>
>> ?? when the R CMD check --as-cran is run, it tries both qpdf and gs. 
>> Since gs (apparently, in this case) compresses more aggressively than 
>> qpdf, it succeeds in compressing further, and the check complains.
>>
>> ?From R CMD build --help:
>>
>> ??--compact-vignettes=? try to compact PDF files under inst/doc:
>> ???????????????????????? "no" (default), "qpdf", "gs", "gs+qpdf", "both"
>> ?? --compact-vignettes?? same as --compact-vignettes=qpdf
>>
>>
>> ?? I don't know if this is worth documenting somewhere, or modifying 
>> the behaviour to make "both" the default for --compact-vignettes ?
>>
>>
>> On 10/7/20 8:35 PM, Duncan Murdoch wrote:
>>> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>>>> ??? Thanks for the tip, I'll take a look.
>>>>
>>>> ??? Given that three relatively experienced package authors all seem to
>>>> have experienced similar issues, it seems that maybe this is worth
>>>> figuring out/maybe I'm not just doing something boneheaded.
>>>
>>> Just to clarify:? I've never noticed the problem you mention.? I just 
>>> know how to debug R CMD build.
>>>
>>> Duncan
>>>
>>>>
>>>> ??? cheers
>>>> ????? Ben
>>>>
>>>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>>>> I don't know the answer to your question, but you can debug the
>>>>> --compact-vignettes option as follows.
>>>>>
>>>>> debug(tools::compactPDF)
>>>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>>>
>>>>> where "pkgdir" is the directory of the source of your package.? Add
>>>>> extra options to the build as separate elements of the argument to
>>>>> .build():? this function is called after args have been parsed.
>>>>>
>>>>> When I do that, I see that it rejects the compaction, because none of
>>>>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>>>>> But Ben's example met those criteria.? When I trick it into accepting
>>>>> the compaction, it does put the compacted PDF into the tarball.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>>>> Dear Ben,
>>>>>>
>>>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>>>> ?? ? I hope so too. The (annoying) workaround is to compact the 
>>>>>>> vignette
>>>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>>>> no-build-vignettes.? The problem there is whatever's supposed to 
>>>>>>> happen
>>>>>>> with building vignette indices.? The uuuuugly workaround, I 
>>>>>>> guess, is to
>>>>>>> build the tarball, compact the vignettes oneself, then *replace* 
>>>>>>> them in
>>>>>>> the tarball.? (Obviously I can automate that, but it seems as 
>>>>>>> though it
>>>>>>> would be unnecessary if I knew what was going on ...)
>>>>>>
>>>>>> I've used both of these workarounds and agree that it would be 
>>>>>> nice to
>>>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>>>
>>>>>> Best,
>>>>>> ??? John
>>>>>>
>>>>>>>
>>>>>>> ?? ? cheers
>>>>>>> ?? ?? Ben
>>>>>>>
>>>>>>>
>>>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>>>> Dear Ben,
>>>>>>>>
>>>>>>>> I was hoping that someone would pick up on this problem, because 
>>>>>>>> I've
>>>>>>>> experienced the same issue of --compact-vignettes apparently 
>>>>>>>> ignored,
>>>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and 
>>>>>>>> Windows.
>>>>>>>>
>>>>>>>> Best,
>>>>>>>> ????John
>>>>>>>>
>>>>>>>> John Fox, Professor Emeritus
>>>>>>>> McMaster University
>>>>>>>> Hamilton, Ontario, Canada
>>>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>>>
>>>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>>>> ???? Am I confused, or doing something wrong, or ... ?
>>>>>>>>>
>>>>>>>>> ???? I have qpdf installed, and am running R CMD build with
>>>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>>>>> compressed despite the fact that the output messages say 
>>>>>>>>> "compacting
>>>>>>>>> vignettes ..."
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> ???? $ R CMD build --compact-vignettes lme4
>>>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>>>> * preparing ?lme4?:
>>>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>>>> * cleaning src
>>>>>>>>> * installing the package to process help pages
>>>>>>>>> * saving partial Rd database
>>>>>>>>> * creating vignettes ... OK
>>>>>>>>> Warning: ?inst/doc? files
>>>>>>>>> ?????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>>>> ???? ignored as vignettes have been rebuilt.
>>>>>>>>> ???? Run R CMD build with --no-build-vignettes to prevent 
>>>>>>>>> rebuilding.
>>>>>>>>> * compacting vignettes and other PDF files
>>>>>>>>> * cleaning src
>>>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>>>> scripts
>>>>>>>>> * checking for empty or unneeded directories
>>>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>>>
>>>>>>>>> ???? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>>>>
>>>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>
>>>>>>>>> ???? The previously built (and manually compacted) version of 
>>>>>>>>> lmer.pdf
>>>>>>>>> in the tarball is 500K:
>>>>>>>>>
>>>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15 
>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>
>>>>>>>>> ????? Is 'R CMD build' confused by the presence of a pre-built 
>>>>>>>>> PDF in
>>>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>>>>> supposed to work?
>>>>>>>>>
>>>>>>>>> ????? I would just use --no-build-vignettes and submit the 
>>>>>>>>> tarball with
>>>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette 
>>>>>>>>> index"
>>>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>>>> vignettes ... ?
>>>>>>>>>
>>>>>>>>> ???? As always, enlightenment is welcome.
>>>>>>>>>
>>>>>>>>> ???? cheers
>>>>>>>>> ?????? Ben Bolker
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-package-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>
>>>


From @|ngm@nn @end|ng |rom gm@||@com  Thu Oct  8 17:53:38 2020
From: @|ngm@nn @end|ng |rom gm@||@com (Henrik Singmann)
Date: Thu, 8 Oct 2020 17:53:38 +0200
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <2003a588-3b9c-4d0b-43e1-76d316ea60b7@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
 <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
 <2003a588-3b9c-4d0b-43e1-76d316ea60b7@gmail.com>
Message-ID: <CA+rDMK+OtwagOh-rT1WiFHcLoQ0Jf-MJS_q4NbdmBf+nsGg9iw@mail.gmail.com>

Hi both,

I am not sure if this might be the issue here, but I think on both
Linux and Windows I need to use the both option without quotation
marks: --compact-vignettes=both

Best,
Henrik


Am Do., 8. Okt. 2020 um 17:21 Uhr schrieb Ben Bolker <bbolker at gmail.com>:
>
>    Huh, weird. "both" worked for me.
>
>    My debugging process involved instrumenting the compression function
> to report what it was doing (see below), rebuilding R, and running the
> build and check --as-cran processes again. (If the package you're
> experiencing problems with is public, feel free to point me to it and
> I'll try to take a look.)
>
>    cheers
>     Ben
>
> Index: src/library/tools/R/admin.R
> ===================================================================
> --- src/library/tools/R/admin.R (revision 79311)
> +++ src/library/tools/R/admin.R (working copy)
> @@ -1088,6 +1088,7 @@
>           }
>           if(!res && file.exists(tf)) {
>               old <- file.size(p); new <-  file.size(tf)
> +            cat(sprintf("compression: old=%f, new=%f, new/old=%f,
> old-new=%f",old, new, new/old,old-new),"\n")
>               if(new/old < 0.9 && new < old - 1e4) {
>                   file.copy(tf, p, overwrite = TRUE)
>                   ans[p, ] <- c(old, new)
>
>
> On 10/8/20 11:10 AM, John Fox wrote:
> > Dear Ben,
> >
> > Actually, what I used was --compact-vignettes="both", with qpdf and gs
> > installed on my Windows and Mac machines, and that apparently didn't
> > work for me.
> >
> > Best,
> >   John
> >
> > On 2020-10-07 10:06 p.m., Ben Bolker wrote:
> >>    OK, I think I see the problem. tl;dr use --compact-vignettes="both"
> >> when building the vignettes.
> >>
> >>    --compact-vignettes  by default only tries qpdf.
> >>
> >>    when the R CMD check --as-cran is run, it tries both qpdf and gs.
> >> Since gs (apparently, in this case) compresses more aggressively than
> >> qpdf, it succeeds in compressing further, and the check complains.
> >>
> >>  From R CMD build --help:
> >>
> >>   --compact-vignettes=  try to compact PDF files under inst/doc:
> >>                          "no" (default), "qpdf", "gs", "gs+qpdf", "both"
> >>    --compact-vignettes   same as --compact-vignettes=qpdf
> >>
> >>
> >>    I don't know if this is worth documenting somewhere, or modifying
> >> the behaviour to make "both" the default for --compact-vignettes ?
> >>
> >>
> >> On 10/7/20 8:35 PM, Duncan Murdoch wrote:
> >>> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
> >>>>     Thanks for the tip, I'll take a look.
> >>>>
> >>>>     Given that three relatively experienced package authors all seem to
> >>>> have experienced similar issues, it seems that maybe this is worth
> >>>> figuring out/maybe I'm not just doing something boneheaded.
> >>>
> >>> Just to clarify:  I've never noticed the problem you mention.  I just
> >>> know how to debug R CMD build.
> >>>
> >>> Duncan
> >>>
> >>>>
> >>>>     cheers
> >>>>       Ben
> >>>>
> >>>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
> >>>>> I don't know the answer to your question, but you can debug the
> >>>>> --compact-vignettes option as follows.
> >>>>>
> >>>>> debug(tools::compactPDF)
> >>>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
> >>>>>
> >>>>> where "pkgdir" is the directory of the source of your package.  Add
> >>>>> extra options to the build as separate elements of the argument to
> >>>>> .build():  this function is called after args have been parsed.
> >>>>>
> >>>>> When I do that, I see that it rejects the compaction, because none of
> >>>>> mine benefit much from it:  it wants at least a 10% and 10K reduction.
> >>>>> But Ben's example met those criteria.  When I trick it into accepting
> >>>>> the compaction, it does put the compacted PDF into the tarball.
> >>>>>
> >>>>> Duncan Murdoch
> >>>>>
> >>>>> On 07/10/2020 6:03 p.m., John Fox wrote:
> >>>>>> Dear Ben,
> >>>>>>
> >>>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
> >>>>>>>      I hope so too. The (annoying) workaround is to compact the
> >>>>>>> vignette
> >>>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
> >>>>>>> no-build-vignettes.  The problem there is whatever's supposed to
> >>>>>>> happen
> >>>>>>> with building vignette indices.  The uuuuugly workaround, I
> >>>>>>> guess, is to
> >>>>>>> build the tarball, compact the vignettes oneself, then *replace*
> >>>>>>> them in
> >>>>>>> the tarball.  (Obviously I can automate that, but it seems as
> >>>>>>> though it
> >>>>>>> would be unnecessary if I knew what was going on ...)
> >>>>>>
> >>>>>> I've used both of these workarounds and agree that it would be
> >>>>>> nice to
> >>>>>> avoid them. After all, what is the --compact-vignettes argument for?
> >>>>>>
> >>>>>> Best,
> >>>>>>     John
> >>>>>>
> >>>>>>>
> >>>>>>>      cheers
> >>>>>>>       Ben
> >>>>>>>
> >>>>>>>
> >>>>>>> On 10/7/20 4:10 PM, John Fox wrote:
> >>>>>>>> Dear Ben,
> >>>>>>>>
> >>>>>>>> I was hoping that someone would pick up on this problem, because
> >>>>>>>> I've
> >>>>>>>> experienced the same issue of --compact-vignettes apparently
> >>>>>>>> ignored,
> >>>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and
> >>>>>>>> Windows.
> >>>>>>>>
> >>>>>>>> Best,
> >>>>>>>>     John
> >>>>>>>>
> >>>>>>>> John Fox, Professor Emeritus
> >>>>>>>> McMaster University
> >>>>>>>> Hamilton, Ontario, Canada
> >>>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
> >>>>>>>>
> >>>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
> >>>>>>>>>      Am I confused, or doing something wrong, or ... ?
> >>>>>>>>>
> >>>>>>>>>      I have qpdf installed, and am running R CMD build with
> >>>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
> >>>>>>>>> compressed despite the fact that the output messages say
> >>>>>>>>> "compacting
> >>>>>>>>> vignettes ..."
> >>>>>>>>>
> >>>>>>>>>
> >>>>>>>>>      $ R CMD build --compact-vignettes lme4
> >>>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
> >>>>>>>>> * preparing ?lme4?:
> >>>>>>>>> * checking DESCRIPTION meta-information ... OK
> >>>>>>>>> * cleaning src
> >>>>>>>>> * installing the package to process help pages
> >>>>>>>>> * saving partial Rd database
> >>>>>>>>> * creating vignettes ... OK
> >>>>>>>>> Warning: ?inst/doc? files
> >>>>>>>>>        ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
> >>>>>>>>>      ignored as vignettes have been rebuilt.
> >>>>>>>>>      Run R CMD build with --no-build-vignettes to prevent
> >>>>>>>>> rebuilding.
> >>>>>>>>> * compacting vignettes and other PDF files
> >>>>>>>>> * cleaning src
> >>>>>>>>> * checking for LF line-endings in source and make files and shell
> >>>>>>>>> scripts
> >>>>>>>>> * checking for empty or unneeded directories
> >>>>>>>>> * building ?lme4_1.1-24.tar.gz?
> >>>>>>>>>
> >>>>>>>>>      The copy of lmer.pdf in the resulting tarball is 900K or so:
> >>>>>>>>>
> >>>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
> >>>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
> >>>>>>>>> lme4/inst/doc/lmer.pdf
> >>>>>>>>>
> >>>>>>>>>      The previously built (and manually compacted) version of
> >>>>>>>>> lmer.pdf
> >>>>>>>>> in the tarball is 500K:
> >>>>>>>>>
> >>>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
> >>>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct  3 22:15
> >>>>>>>>> lme4/inst/doc/lmer.pdf
> >>>>>>>>>
> >>>>>>>>>       Is 'R CMD build' confused by the presence of a pre-built
> >>>>>>>>> PDF in
> >>>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
> >>>>>>>>> supposed to work?
> >>>>>>>>>
> >>>>>>>>>       I would just use --no-build-vignettes and submit the
> >>>>>>>>> tarball with
> >>>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
> >>>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette
> >>>>>>>>> index"
> >>>>>>>>> NOTE, which I assume is missing because I built without building
> >>>>>>>>> vignettes ... ?
> >>>>>>>>>
> >>>>>>>>>      As always, enlightenment is welcome.
> >>>>>>>>>
> >>>>>>>>>      cheers
> >>>>>>>>>        Ben Bolker
> >>>>>>>>>
> >>>>>>>>> ______________________________________________
> >>>>>>>>> R-package-devel at r-project.org mailing list
> >>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>
> >>>>>> ______________________________________________
> >>>>>> R-package-devel at r-project.org mailing list
> >>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
> >>>>>>
> >>>>>
> >>>
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Dr. Henrik Singmann
Lecturer, Experimental Psychology
University College London (UCL), UK
http://singmann.org


From murdoch@dunc@n @end|ng |rom gm@||@com  Thu Oct  8 18:06:12 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Thu, 8 Oct 2020 12:06:12 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
 <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
Message-ID: <1229eef2-c765-3d9c-edb2-d6abeeaf900b@gmail.com>

When I tried that on MacOS, it did the gs compression with gs_quality 
set to "none", which does nothing.  I don't know what quality CRAN uses, 
but for me setting the environment variable GS_QUALITY=screen made a big 
difference.

Duncan Murdoch

On 08/10/2020 11:10 a.m., John Fox wrote:
> Dear Ben,
> 
> Actually, what I used was --compact-vignettes="both", with qpdf and gs
> installed on my Windows and Mac machines, and that apparently didn't
> work for me.
> 
> Best,
>    John
> 
> On 2020-10-07 10:06 p.m., Ben Bolker wrote:
>>   ? OK, I think I see the problem. tl;dr use --compact-vignettes="both"
>> when building the vignettes.
>>
>>   ? --compact-vignettes? by default only tries qpdf.
>>
>>   ? when the R CMD check --as-cran is run, it tries both qpdf and gs.
>> Since gs (apparently, in this case) compresses more aggressively than
>> qpdf, it succeeds in compressing further, and the check complains.
>>
>>   From R CMD build --help:
>>
>>   ?--compact-vignettes=? try to compact PDF files under inst/doc:
>>   ??????????????????????? "no" (default), "qpdf", "gs", "gs+qpdf", "both"
>>   ? --compact-vignettes?? same as --compact-vignettes=qpdf
>>
>>
>>   ? I don't know if this is worth documenting somewhere, or modifying the
>> behaviour to make "both" the default for --compact-vignettes ?
>>
>>
>> On 10/7/20 8:35 PM, Duncan Murdoch wrote:
>>> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>>>>  ??? Thanks for the tip, I'll take a look.
>>>>
>>>>  ??? Given that three relatively experienced package authors all seem to
>>>> have experienced similar issues, it seems that maybe this is worth
>>>> figuring out/maybe I'm not just doing something boneheaded.
>>>
>>> Just to clarify:? I've never noticed the problem you mention.? I just
>>> know how to debug R CMD build.
>>>
>>> Duncan
>>>
>>>>
>>>>  ??? cheers
>>>>  ????? Ben
>>>>
>>>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>>>> I don't know the answer to your question, but you can debug the
>>>>> --compact-vignettes option as follows.
>>>>>
>>>>> debug(tools::compactPDF)
>>>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>>>
>>>>> where "pkgdir" is the directory of the source of your package.? Add
>>>>> extra options to the build as separate elements of the argument to
>>>>> .build():? this function is called after args have been parsed.
>>>>>
>>>>> When I do that, I see that it rejects the compaction, because none of
>>>>> mine benefit much from it:? it wants at least a 10% and 10K reduction.
>>>>> But Ben's example met those criteria.? When I trick it into accepting
>>>>> the compaction, it does put the compacted PDF into the tarball.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>>>> Dear Ben,
>>>>>>
>>>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>>>>  ?? ? I hope so too. The (annoying) workaround is to compact the
>>>>>>> vignette
>>>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>>>> no-build-vignettes.? The problem there is whatever's supposed to
>>>>>>> happen
>>>>>>> with building vignette indices.? The uuuuugly workaround, I guess,
>>>>>>> is to
>>>>>>> build the tarball, compact the vignettes oneself, then *replace*
>>>>>>> them in
>>>>>>> the tarball.? (Obviously I can automate that, but it seems as
>>>>>>> though it
>>>>>>> would be unnecessary if I knew what was going on ...)
>>>>>>
>>>>>> I've used both of these workarounds and agree that it would be nice to
>>>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>>>
>>>>>> Best,
>>>>>>  ??? John
>>>>>>
>>>>>>>
>>>>>>>  ?? ? cheers
>>>>>>>  ?? ?? Ben
>>>>>>>
>>>>>>>
>>>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>>>> Dear Ben,
>>>>>>>>
>>>>>>>> I was hoping that someone would pick up on this problem, because
>>>>>>>> I've
>>>>>>>> experienced the same issue of --compact-vignettes apparently
>>>>>>>> ignored,
>>>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and
>>>>>>>> Windows.
>>>>>>>>
>>>>>>>> Best,
>>>>>>>>  ????John
>>>>>>>>
>>>>>>>> John Fox, Professor Emeritus
>>>>>>>> McMaster University
>>>>>>>> Hamilton, Ontario, Canada
>>>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>>>
>>>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>>>>  ???? Am I confused, or doing something wrong, or ... ?
>>>>>>>>>
>>>>>>>>>  ???? I have qpdf installed, and am running R CMD build with
>>>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem to be
>>>>>>>>> compressed despite the fact that the output messages say
>>>>>>>>> "compacting
>>>>>>>>> vignettes ..."
>>>>>>>>>
>>>>>>>>>
>>>>>>>>>  ???? $ R CMD build --compact-vignettes lme4
>>>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>>>> * preparing ?lme4?:
>>>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>>>> * cleaning src
>>>>>>>>> * installing the package to process help pages
>>>>>>>>> * saving partial Rd database
>>>>>>>>> * creating vignettes ... OK
>>>>>>>>> Warning: ?inst/doc? files
>>>>>>>>>  ?????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>>>>  ???? ignored as vignettes have been rebuilt.
>>>>>>>>>  ???? Run R CMD build with --no-build-vignettes to prevent
>>>>>>>>> rebuilding.
>>>>>>>>> * compacting vignettes and other PDF files
>>>>>>>>> * cleaning src
>>>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>>>> scripts
>>>>>>>>> * checking for empty or unneeded directories
>>>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>>>
>>>>>>>>>  ???? The copy of lmer.pdf in the resulting tarball is 900K or so:
>>>>>>>>>
>>>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>
>>>>>>>>>  ???? The previously built (and manually compacted) version of
>>>>>>>>> lmer.pdf
>>>>>>>>> in the tarball is 500K:
>>>>>>>>>
>>>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15
>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>
>>>>>>>>>  ????? Is 'R CMD build' confused by the presence of a pre-built
>>>>>>>>> PDF in
>>>>>>>>> the inst/doc directory? Or am I somehow mistaken about how this is
>>>>>>>>> supposed to work?
>>>>>>>>>
>>>>>>>>>  ????? I would just use --no-build-vignettes and submit the
>>>>>>>>> tarball with
>>>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette
>>>>>>>>> index"
>>>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>>>> vignettes ... ?
>>>>>>>>>
>>>>>>>>>  ???? As always, enlightenment is welcome.
>>>>>>>>>
>>>>>>>>>  ???? cheers
>>>>>>>>>  ?????? Ben Bolker
>>>>>>>>>
>>>>>>>>> ______________________________________________
>>>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>> ______________________________________________
>>>>>> R-package-devel at r-project.org mailing list
>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>
>>>>>
>>>


From j|ox @end|ng |rom mcm@@ter@c@  Thu Oct  8 19:21:15 2020
From: j|ox @end|ng |rom mcm@@ter@c@ (John Fox)
Date: Thu, 8 Oct 2020 13:21:15 -0400
Subject: [R-pkg-devel] is R CMD build --compact-vignettes working as
 expected?
In-Reply-To: <1229eef2-c765-3d9c-edb2-d6abeeaf900b@gmail.com>
References: <28318_1601917804_095H9vQf016745_e34db7d9-28f0-36f3-0c8e-61e9586630d3@gmail.com>
 <6ae4e85e-bec1-19fd-efe9-61c8939b2416@mcmaster.ca>
 <fd783fc0-7024-9599-b219-22814e1c532b@gmail.com>
 <7e2538a1-8c1e-dd38-0741-5ba79c591668@mcmaster.ca>
 <776a00fd-694b-d5b9-87cf-e25d78d30eab@gmail.com>
 <3d06af38-dd61-ff8c-872f-cee9f26f4e1d@gmail.com>
 <def42f5f-53b3-1be0-1a95-44971323ba6e@gmail.com>
 <a0cb727b-779b-ec51-1669-f9af455bfd8f@gmail.com>
 <cddbf8eb-e834-1eb7-1044-06ac0070c745@mcmaster.ca>
 <1229eef2-c765-3d9c-edb2-d6abeeaf900b@gmail.com>
Message-ID: <de1e7856-be5f-b6e1-315a-12a8c01037a5@mcmaster.ca>

Dear all,

First, thank you to everyone who responded.

Let me be more specific about what I did, focusing on macOS (since I did 
most of this on Windows too):

(1) I observed the problem with the Rcmdr package, including version 
2.7-1, which is newly on CRAN. Presumably, it wouldn't be hard to 
duplicate what I did.

(2) I previously tried both --compact-vignettes="both", 
--compact-vignettes=both, and also just --compact-vignettes. R CMD build 
says that it's "* compacting vignettes and other PDF files", and R CMD 
check --as-cran doesn't complain, reporting "* checking sizes of PDF 
files under ?inst/doc? ... OK."

(3) Nothing changes when, following Duncan's advice, I set GS_QUALITY=screen

In the tarball built by R CMD build, the vignette in 
inst/doc/Getting-Started-with-the-Rcmdr.pdf is 1.6 MB. When I compacted 
the vignette with Adobe Acrobat, it was reduced to 395 KB.

Putting all of this together, I suspect that Acrobat may just do a 
better job than gs and qpdf.

Best,
  John


On 2020-10-08 12:06 p.m., Duncan Murdoch wrote:
> When I tried that on MacOS, it did the gs compression with gs_quality 
> set to "none", which does nothing.? I don't know what quality CRAN uses, 
> but for me setting the environment variable GS_QUALITY=screen made a big 
> difference.
> 
> Duncan Murdoch
> 
> On 08/10/2020 11:10 a.m., John Fox wrote:
>> Dear Ben,
>>
>> Actually, what I used was --compact-vignettes="both", with qpdf and gs
>> installed on my Windows and Mac machines, and that apparently didn't
>> work for me.
>>
>> Best,
>> ?? John
>>
>> On 2020-10-07 10:06 p.m., Ben Bolker wrote:
>>> ? ? OK, I think I see the problem. tl;dr use --compact-vignettes="both"
>>> when building the vignettes.
>>>
>>> ? ? --compact-vignettes? by default only tries qpdf.
>>>
>>> ? ? when the R CMD check --as-cran is run, it tries both qpdf and gs.
>>> Since gs (apparently, in this case) compresses more aggressively than
>>> qpdf, it succeeds in compressing further, and the check complains.
>>>
>>> ? From R CMD build --help:
>>>
>>> ? ?--compact-vignettes=? try to compact PDF files under inst/doc:
>>> ? ??????????????????????? "no" (default), "qpdf", "gs", "gs+qpdf", 
>>> "both"
>>> ? ? --compact-vignettes?? same as --compact-vignettes=qpdf
>>>
>>>
>>> ? ? I don't know if this is worth documenting somewhere, or modifying 
>>> the
>>> behaviour to make "both" the default for --compact-vignettes ?
>>>
>>>
>>> On 10/7/20 8:35 PM, Duncan Murdoch wrote:
>>>> On 07/10/2020 8:32 p.m., Ben Bolker wrote:
>>>>> ???? Thanks for the tip, I'll take a look.
>>>>>
>>>>> ???? Given that three relatively experienced package authors all 
>>>>> seem to
>>>>> have experienced similar issues, it seems that maybe this is worth
>>>>> figuring out/maybe I'm not just doing something boneheaded.
>>>>
>>>> Just to clarify:? I've never noticed the problem you mention.? I just
>>>> know how to debug R CMD build.
>>>>
>>>> Duncan
>>>>
>>>>>
>>>>> ???? cheers
>>>>> ?????? Ben
>>>>>
>>>>> On 10/7/20 8:31 PM, Duncan Murdoch wrote:
>>>>>> I don't know the answer to your question, but you can debug the
>>>>>> --compact-vignettes option as follows.
>>>>>>
>>>>>> debug(tools::compactPDF)
>>>>>> tools:::.build_packages(c("--compact-vignettes", "pkgdir"))
>>>>>>
>>>>>> where "pkgdir" is the directory of the source of your package.? Add
>>>>>> extra options to the build as separate elements of the argument to
>>>>>> .build():? this function is called after args have been parsed.
>>>>>>
>>>>>> When I do that, I see that it rejects the compaction, because none of
>>>>>> mine benefit much from it:? it wants at least a 10% and 10K 
>>>>>> reduction.
>>>>>> But Ben's example met those criteria.? When I trick it into accepting
>>>>>> the compaction, it does put the compacted PDF into the tarball.
>>>>>>
>>>>>> Duncan Murdoch
>>>>>>
>>>>>> On 07/10/2020 6:03 p.m., John Fox wrote:
>>>>>>> Dear Ben,
>>>>>>>
>>>>>>> On 2020-10-07 5:26 p.m., Ben Bolker wrote:
>>>>>>>> ??? ? I hope so too. The (annoying) workaround is to compact the
>>>>>>>> vignette
>>>>>>>> yourself (using qpdf directly or using tools::compactPDF), then use
>>>>>>>> no-build-vignettes.? The problem there is whatever's supposed to
>>>>>>>> happen
>>>>>>>> with building vignette indices.? The uuuuugly workaround, I guess,
>>>>>>>> is to
>>>>>>>> build the tarball, compact the vignettes oneself, then *replace*
>>>>>>>> them in
>>>>>>>> the tarball.? (Obviously I can automate that, but it seems as
>>>>>>>> though it
>>>>>>>> would be unnecessary if I knew what was going on ...)
>>>>>>>
>>>>>>> I've used both of these workarounds and agree that it would be 
>>>>>>> nice to
>>>>>>> avoid them. After all, what is the --compact-vignettes argument for?
>>>>>>>
>>>>>>> Best,
>>>>>>> ???? John
>>>>>>>
>>>>>>>>
>>>>>>>> ??? ? cheers
>>>>>>>> ??? ?? Ben
>>>>>>>>
>>>>>>>>
>>>>>>>> On 10/7/20 4:10 PM, John Fox wrote:
>>>>>>>>> Dear Ben,
>>>>>>>>>
>>>>>>>>> I was hoping that someone would pick up on this problem, because
>>>>>>>>> I've
>>>>>>>>> experienced the same issue of --compact-vignettes apparently
>>>>>>>>> ignored,
>>>>>>>>> e.g., with the Rcmdr package under R 4.0.2 on both macOS and
>>>>>>>>> Windows.
>>>>>>>>>
>>>>>>>>> Best,
>>>>>>>>> ?????John
>>>>>>>>>
>>>>>>>>> John Fox, Professor Emeritus
>>>>>>>>> McMaster University
>>>>>>>>> Hamilton, Ontario, Canada
>>>>>>>>> web: https://socialsciences.mcmaster.ca/jfox/
>>>>>>>>>
>>>>>>>>> On 2020-10-05 1:09 p.m., Ben Bolker wrote:
>>>>>>>>>> ????? Am I confused, or doing something wrong, or ... ?
>>>>>>>>>>
>>>>>>>>>> ????? I have qpdf installed, and am running R CMD build with
>>>>>>>>>> --compact-vignettes, but the PDF in the tarball doesn't seem 
>>>>>>>>>> to be
>>>>>>>>>> compressed despite the fact that the output messages say
>>>>>>>>>> "compacting
>>>>>>>>>> vignettes ..."
>>>>>>>>>>
>>>>>>>>>>
>>>>>>>>>> ????? $ R CMD build --compact-vignettes lme4
>>>>>>>>>> * checking for file ?lme4/DESCRIPTION? ... OK
>>>>>>>>>> * preparing ?lme4?:
>>>>>>>>>> * checking DESCRIPTION meta-information ... OK
>>>>>>>>>> * cleaning src
>>>>>>>>>> * installing the package to process help pages
>>>>>>>>>> * saving partial Rd database
>>>>>>>>>> * creating vignettes ... OK
>>>>>>>>>> Warning: ?inst/doc? files
>>>>>>>>>> ??????? ?lmerperf.html?, ?lmer.pdf?, ?PLSvGLS.pdf?, ?Theory.pdf?
>>>>>>>>>> ????? ignored as vignettes have been rebuilt.
>>>>>>>>>> ????? Run R CMD build with --no-build-vignettes to prevent
>>>>>>>>>> rebuilding.
>>>>>>>>>> * compacting vignettes and other PDF files
>>>>>>>>>> * cleaning src
>>>>>>>>>> * checking for LF line-endings in source and make files and shell
>>>>>>>>>> scripts
>>>>>>>>>> * checking for empty or unneeded directories
>>>>>>>>>> * building ?lme4_1.1-24.tar.gz?
>>>>>>>>>>
>>>>>>>>>> ????? The copy of lmer.pdf in the resulting tarball is 900K or 
>>>>>>>>>> so:
>>>>>>>>>>
>>>>>>>>>> $ tar ztvf lme4_1.1-24.tar.gz lme4/inst/doc/lmer.pdf
>>>>>>>>>> -rw-r--r-- bolker/bolker 907022 2020-10-05 12:59
>>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>>
>>>>>>>>>> ????? The previously built (and manually compacted) version of
>>>>>>>>>> lmer.pdf
>>>>>>>>>> in the tarball is 500K:
>>>>>>>>>>
>>>>>>>>>> $ ls -l lme4/inst/doc/lmer.pdf
>>>>>>>>>> -rw-r--r-- 1 bolker bolker 495199 Oct? 3 22:15
>>>>>>>>>> lme4/inst/doc/lmer.pdf
>>>>>>>>>>
>>>>>>>>>> ?????? Is 'R CMD build' confused by the presence of a pre-built
>>>>>>>>>> PDF in
>>>>>>>>>> the inst/doc directory? Or am I somehow mistaken about how 
>>>>>>>>>> this is
>>>>>>>>>> supposed to work?
>>>>>>>>>>
>>>>>>>>>> ?????? I would just use --no-build-vignettes and submit the
>>>>>>>>>> tarball with
>>>>>>>>>> the previously built/compressed PDF, but I'm trying to avoid a
>>>>>>>>>> "Package has a VignetteBuilder field but no prebuilt vignette
>>>>>>>>>> index"
>>>>>>>>>> NOTE, which I assume is missing because I built without building
>>>>>>>>>> vignettes ... ?
>>>>>>>>>>
>>>>>>>>>> ????? As always, enlightenment is welcome.
>>>>>>>>>>
>>>>>>>>>> ????? cheers
>>>>>>>>>> ??????? Ben Bolker
>>>>>>>>>>
>>>>>>>>>> ______________________________________________
>>>>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>>
>>>>>>> ______________________________________________
>>>>>>> R-package-devel at r-project.org mailing list
>>>>>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>>>>>
>>>>>>
>>>>
> 

-- 
John Fox, Professor Emeritus
McMaster University
Hamilton, Ontario, Canada
web: https://socialsciences.mcmaster.ca/jfox/


From r@@y@|@14 @end|ng |rom |mper|@|@@c@uk  Fri Oct  9 14:05:46 2020
From: r@@y@|@14 @end|ng |rom |mper|@|@@c@uk (Ayala Hernandez, Rafael)
Date: Fri, 9 Oct 2020 12:05:46 +0000
Subject: [R-pkg-devel] rlang not available on Windows builder machine with
 R-devel
Message-ID: <DB7PR06MB5881E0129641C6E132B2CCD9CC080@DB7PR06MB5881.eurprd06.prod.outlook.com>

Dear all,

My NutrienTrackeR package has recently failed to install on the Windows builder machine with R-devel, with an error saying 'rlang' is not available (https://www.r-project.org/nosvn/R.check/r-devel-windows-ix86+x86_64/NutrienTrackeR-00install.html).

Is this something I could fix on my side, or is it just on the builder machine's side?

Thanks a lot in advance

Best wishes,

Rafa

	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Fri Oct  9 14:30:02 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Fri, 9 Oct 2020 08:30:02 -0400
Subject: [R-pkg-devel] 
 rlang not available on Windows builder machine with R-devel
In-Reply-To: <DB7PR06MB5881E0129641C6E132B2CCD9CC080@DB7PR06MB5881.eurprd06.prod.outlook.com>
References: <DB7PR06MB5881E0129641C6E132B2CCD9CC080@DB7PR06MB5881.eurprd06.prod.outlook.com>
Message-ID: <0e574b00-3cd1-8176-dce4-d1887ea4b67d@gmail.com>

On 09/10/2020 8:05 a.m., Ayala Hernandez, Rafael wrote:
> Dear all,
> 
> My NutrienTrackeR package has recently failed to install on the Windows builder machine with R-devel, with an error saying 'rlang' is not available (https://www.r-project.org/nosvn/R.check/r-devel-windows-ix86+x86_64/NutrienTrackeR-00install.html).
> 
> Is this something I could fix on my side, or is it just on the builder machine's side?

Looks to me like it's just the CRAN machine that had a glitch. I 
wouldn't worry about it unless CRAN asks you to do something, or you're 
submitting a new version.  In the latter case, mention the failure in 
your submission message and say that you're assuming it's a problem on 
their end.

Duncan Murdoch


From ju||@n@c@nd|@ @end|ng |rom n|h@gov  Sat Oct 10 18:53:15 2020
From: ju||@n@c@nd|@ @end|ng |rom n|h@gov (Candia, Julian (NIH/NCI) [E])
Date: Sat, 10 Oct 2020 16:53:15 +0000
Subject: [R-pkg-devel] Static vignettes / bibtex warning in Debian
Message-ID: <B9D3F189-2B96-4D03-A43A-AC3F31D596ED@contoso.com>

Hello,

I?m trying to include a static vignette by embedding a pdf document in latex. The procedure is very simple and is discussed here: http://www.markvanderloo.eu/yaRb/2019/01/11/add-a-static-pdf-vignette-to-an-r-package
It essentially boils down to creating a .Rnw file with the following content:

\documentclass{article}
\usepackage{pdfpages}
%\VignetteIndexEntry{author2019mypaper}

\begin{document}
\includepdf[pages=-, fitpaper=true]{mypaper.pdf}
\end{document}

I built and checked the package with no issues. However, upon uploading to CRAN, Debian generates 1 warning:

Flavor: r-devel-linux-x86_64-debian-gcc
Check: package dependencies, Result: WARNING
  Requires (indirectly) orphaned package: 'bibtex'

I don?t know how to go around this issue. Essentially: how to add a static (pdf) vignette to a package that will pass all CRAN checks?
Your advice is much appreciated.

Thanks,
Juli?n


	[[alternative HTML version deleted]]


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Oct 11 01:28:34 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sat, 10 Oct 2020 19:28:34 -0400
Subject: [R-pkg-devel] Static vignettes / bibtex warning in Debian
In-Reply-To: <B9D3F189-2B96-4D03-A43A-AC3F31D596ED@contoso.com>
References: <B9D3F189-2B96-4D03-A43A-AC3F31D596ED@contoso.com>
Message-ID: <90117472-91c0-d085-d67e-9647f40f1e4d@gmail.com>

That WARNING is unlikely to be related to the vignette.  The problem is 
that you have Depends/Imports/Suggests for some R package that does the 
same for the bibtex package (possibly with one ore more other indirect 
steps).

Since this is only on one platform, it's probably not something you need 
to worry about:  that other package has probably been updated to drop 
the bibtex dependence, but Debian hasn't got the update yet.

I don't know how you determine which is the "guilty" package.  Maybe 
there are more hints in the check log?

Duncan Murdoch

On 10/10/2020 12:53 p.m., Candia, Julian (NIH/NCI) [E] via 
R-package-devel wrote:
> Hello,
> 
> I?m trying to include a static vignette by embedding a pdf document in latex. The procedure is very simple and is discussed here: http://www.markvanderloo.eu/yaRb/2019/01/11/add-a-static-pdf-vignette-to-an-r-package
> It essentially boils down to creating a .Rnw file with the following content:
> 
> \documentclass{article}
> \usepackage{pdfpages}
> %\VignetteIndexEntry{author2019mypaper}
> 
> \begin{document}
> \includepdf[pages=-, fitpaper=true]{mypaper.pdf}
> \end{document}
> 
> I built and checked the package with no issues. However, upon uploading to CRAN, Debian generates 1 warning:
> 
> Flavor: r-devel-linux-x86_64-debian-gcc
> Check: package dependencies, Result: WARNING
>    Requires (indirectly) orphaned package: 'bibtex'
> 
> I don?t know how to go around this issue. Essentially: how to add a static (pdf) vignette to a package that will pass all CRAN checks?
> Your advice is much appreciated.
> 
> Thanks,
> Juli?n
> 
> 
> 	[[alternative HTML version deleted]]
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org  Sun Oct 11 05:56:41 2020
From: @pencer@gr@ve@ @end|ng |rom e||ect|vede|en@e@org (Spencer Graves)
Date: Sat, 10 Oct 2020 22:56:41 -0500
Subject: [R-pkg-devel] How to remove rJava from Ecfun when it's not called
 directly or indirectly
Message-ID: <880055b4-85de-f314-c43f-ffc0b99289db@effectivedefense.org>

Hello, All:


	  "R CMD check Ecfun_0.2-4.tar.gz" fails under Windows 10 with "Error: 
package or namespace load failed for 'Ecfun': .onLoad failed in 
loadNamespace() for 'rJava'".


	  However, I cannot find where Ecfun calls rJava.  This is in:


https://github.com/sbgraves237/Ecfun

	
	  I get nothing from "grep 'rJava'" in the DESCRIPTION and NAMESPACE 
files plus in the man and R subdirectories.  I ran 
tools:package_dependencies recursively starting with Ecfun until I got 
all NULLs and could not find rJava anywhere.


	  Thanks,
	  Spencer Graves


00install.out


* installing *source* package 'Ecfun' ...
** using staged installation
** R
** inst
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** installing vignettes
** testing if installed package can be loaded from temporary location
*** arch - i386
Error: package or namespace load failed for 'Ecfun':
  .onLoad failed in loadNamespace() for 'rJava', details:
   call: inDL(x, as.logical(local), as.logical(now), ...)
   error: unable to load shared object 'C:/Program 
Files/R/R-4.0.2/library/rJava/libs/i386/rJava.dll':
   LoadLibrary failure:  %1 is not a valid Win32 application.

Error: loading failed
Execution halted
*** arch - x64
ERROR: loading failed for 'i386'
* removing 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/Ecfun'


00check.log


* using log directory 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck'
* using R version 4.0.2 (2020-06-22)
* using platform: x86_64-w64-mingw32 (64-bit)
* using session charset: ISO8859-1
* checking for file 'Ecfun/DESCRIPTION' ... OK
* this is package 'Ecfun' version '0.2-4'
* checking package namespace information ... OK
* checking package dependencies ... OK
* checking if this is a source package ... OK
* checking if there is a namespace ... OK
* checking for executable files ... OK
* checking for hidden files and directories ... OK
* checking for portable file names ... OK
* checking whether package 'Ecfun' can be installed ... ERROR
Installation failed.
See 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/00install.out' for 
details.
* DONE
Status: 1 ERROR


From jo@h@m@u|r|ch @end|ng |rom gm@||@com  Sun Oct 11 15:25:42 2020
From: jo@h@m@u|r|ch @end|ng |rom gm@||@com (Joshua Ulrich)
Date: Sun, 11 Oct 2020 08:25:42 -0500
Subject: [R-pkg-devel] 
 How to remove rJava from Ecfun when it's not called
 directly or indirectly
In-Reply-To: <880055b4-85de-f314-c43f-ffc0b99289db@effectivedefense.org>
References: <880055b4-85de-f314-c43f-ffc0b99289db@effectivedefense.org>
Message-ID: <CAPPM_gT+oG4Oz7m50rYBhz456XC8akA4HgEXUsZPKi=YNr3L+Q@mail.gmail.com>

On Sat, Oct 10, 2020 at 10:57 PM Spencer Graves
<spencer.graves at effectivedefense.org> wrote:
>
> Hello, All:
>
>
>           "R CMD check Ecfun_0.2-4.tar.gz" fails under Windows 10 with "Error:
> package or namespace load failed for 'Ecfun': .onLoad failed in
> loadNamespace() for 'rJava'".
>
>
>           However, I cannot find where Ecfun calls rJava.  This is in:
>
>
> https://github.com/sbgraves237/Ecfun
>
>
>           I get nothing from "grep 'rJava'" in the DESCRIPTION and NAMESPACE
> files plus in the man and R subdirectories.  I ran
> tools:package_dependencies recursively starting with Ecfun until I got
> all NULLs and could not find rJava anywhere.
>
You need to include suggested package dependencies in your search.

tools::package_dependencies("Ecfun",
  which = c("Depends", "Imports", "LinkingTo", "Suggests"),
  recursive = TRUE)

You will find rJava in that list of ~1650 dependencies.

>
>           Thanks,
>           Spencer Graves
>
>
> 00install.out
>
>
> * installing *source* package 'Ecfun' ...
> ** using staged installation
> ** R
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded from temporary location
> *** arch - i386
> Error: package or namespace load failed for 'Ecfun':
>   .onLoad failed in loadNamespace() for 'rJava', details:
>    call: inDL(x, as.logical(local), as.logical(now), ...)
>    error: unable to load shared object 'C:/Program
> Files/R/R-4.0.2/library/rJava/libs/i386/rJava.dll':
>    LoadLibrary failure:  %1 is not a valid Win32 application.
>
> Error: loading failed
> Execution halted
> *** arch - x64
> ERROR: loading failed for 'i386'
> * removing 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/Ecfun'
>
>
> 00check.log
>
>
> * using log directory 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck'
> * using R version 4.0.2 (2020-06-22)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: ISO8859-1
> * checking for file 'Ecfun/DESCRIPTION' ... OK
> * this is package 'Ecfun' version '0.2-4'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'Ecfun' can be installed ... ERROR
> Installation failed.
> See 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/00install.out' for
> details.
> * DONE
> Status: 1 ERROR
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel



-- 
Joshua Ulrich  |  about.me/joshuaulrich
FOSS Trading  |  www.fosstrading.com


From @|@t @end|ng |rom d|@root@org  Sun Oct 11 16:20:01 2020
From: @|@t @end|ng |rom d|@root@org (Al T)
Date: Sun, 11 Oct 2020 16:20:01 +0200
Subject: [R-pkg-devel] Procedure for the transfer or an R package
 maintainership
Message-ID: <20201011142000.i5lh4ra27p4v6ndx@localhost.localdomain>

Dear R-devel-community!


The current maintainer of the 'nephro' R-package
(https://cran.r-project.org/web/packages/nephro/index.html), Cristian
Pattaro, asked me if I'm willing to take over this work.  I'm very
interested in stepping in but since I've never done something similar
before I'd like to ask for some advice.


I read on stackoverflow
(https://stackoverflow.com/questions/39223320/transferring-maintainership-of-an-r-package-on-cran)
that the standard procedure is (in the following order):

* a message from the old maintainers' email address stating the change
  in maintainership

* a change in the DESCRIPTION file with the address of the new
  maintainer information.


But I'm interested in the steps afterwards (see also
https://stackoverflow.com/questions/64299121/what-do-i-have-to-do-if-im-taking-over-the-maintenance-of-a-gnu-r-package-publi):

* How can I 'link' this package to a new repository on the version
  control platform of my choice (e.g. https://gitlab.com/ or
  https://github.com)?

* How do the package update procedures on CRAN work (e.g. if I want to
  create a new version of the package)?

* How does the update procedure for the repository on r-forge (in my
  case: https://r-forge.r-project.org/projects/nephro/) work?  Is this
  identical to the CRAN-package?


I looked into https://cran.r-project.org/web/packages/policies.html as
well https://cran.r-project.org/doc/manuals/R-exts.html but I couldn't
find an answer to my questions.


Best wishes, 

Alex



-- 

    *Al T* <al.t at disroot.org>
    GPG: E1F0 908F 0365 2215 189D  2319 F0AF 5A02 49EB DEF5


From e@ @end|ng |rom enr|co@chum@nn@net  Sun Oct 11 17:34:21 2020
From: e@ @end|ng |rom enr|co@chum@nn@net (Enrico Schumann)
Date: Sun, 11 Oct 2020 17:34:21 +0200
Subject: [R-pkg-devel] 
 How to remove rJava from Ecfun when it's not called
 directly or indirectly
In-Reply-To: <880055b4-85de-f314-c43f-ffc0b99289db@effectivedefense.org>
 (Spencer Graves's message of "Sat, 10 Oct 2020 22:56:41 -0500")
References: <880055b4-85de-f314-c43f-ffc0b99289db@effectivedefense.org>
Message-ID: <87ft6k3hfm.fsf@enricoschumann.net>

On Sat, 10 Oct 2020, Spencer Graves writes:

> Hello, All:
>
>
> 	  "R CMD check Ecfun_0.2-4.tar.gz" fails under
> Windows 10 with "Error: package or namespace load
> failed for 'Ecfun': .onLoad failed in loadNamespace()
> for 'rJava'".
>
>
> 	  However, I cannot find where Ecfun calls rJava.  This is in:
>
>
> https://github.com/sbgraves237/Ecfun
>
> 	
> 	  I get nothing from "grep 'rJava'" in the
> DESCRIPTION and NAMESPACE files plus in the man and R
> subdirectories.  I ran tools:package_dependencies
> recursively starting with Ecfun until I got all NULLs
> and could not find rJava anywhere.
>
>
> 	  Thanks,
> 	  Spencer Graves
>
>
> 00install.out
>
>
> * installing *source* package 'Ecfun' ...
> ** using staged installation
> ** R
> ** inst
> ** byte-compile and prepare package for lazy loading
> ** help
> *** installing help indices
> ** building package indices
> ** installing vignettes
> ** testing if installed package can be loaded from temporary location
> *** arch - i386
> Error: package or namespace load failed for 'Ecfun':
>  .onLoad failed in loadNamespace() for 'rJava', details:
>   call: inDL(x, as.logical(local), as.logical(now), ...)
>   error: unable to load shared object 'C:/Program
> Files/R/R-4.0.2/library/rJava/libs/i386/rJava.dll':
>   LoadLibrary failure:  %1 is not a valid Win32 application.
>
> Error: loading failed
> Execution halted
> *** arch - x64
> ERROR: loading failed for 'i386'
> * removing 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/Ecfun'
>
>
> 00check.log
>
>
> * using log directory 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck'
> * using R version 4.0.2 (2020-06-22)
> * using platform: x86_64-w64-mingw32 (64-bit)
> * using session charset: ISO8859-1
> * checking for file 'Ecfun/DESCRIPTION' ... OK
> * this is package 'Ecfun' version '0.2-4'
> * checking package namespace information ... OK
> * checking package dependencies ... OK
> * checking if this is a source package ... OK
> * checking if there is a namespace ... OK
> * checking for executable files ... OK
> * checking for hidden files and directories ... OK
> * checking for portable file names ... OK
> * checking whether package 'Ecfun' can be installed ... ERROR
> Installation failed.
> See
> 'C:/Users/spenc/Documents/R/Ecfun/Ecfun.Rcheck/00install.out'
> for details.
> * DONE
> Status: 1 ERROR
>

Hello Spencer

Just a wild guess: the CRAN version of your package
does not list 'xlsx'; but your GitHub version does.
Now, 'xlsx' depends on 'rJava'.  So perhaps start there?

As I said, only a wild guess; but maybe it helps.

Kind regards
    Enrico

-- 
Enrico Schumann
Lucerne, Switzerland
http://enricoschumann.net


From murdoch@dunc@n @end|ng |rom gm@||@com  Sun Oct 11 19:08:26 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Sun, 11 Oct 2020 13:08:26 -0400
Subject: [R-pkg-devel] Procedure for the transfer or an R package
 maintainership
In-Reply-To: <20201011142000.i5lh4ra27p4v6ndx@localhost.localdomain>
References: <20201011142000.i5lh4ra27p4v6ndx@localhost.localdomain>
Message-ID: <fef1875c-f171-04ac-e9ed-ae00af6408f3@gmail.com>

On 11/10/2020 10:20 a.m., Al T wrote:
> Dear R-devel-community!
> 
> 
> The current maintainer of the 'nephro' R-package
> (https://cran.r-project.org/web/packages/nephro/index.html), Cristian
> Pattaro, asked me if I'm willing to take over this work.  I'm very
> interested in stepping in but since I've never done something similar
> before I'd like to ask for some advice.
> 
> 
> I read on stackoverflow
> (https://stackoverflow.com/questions/39223320/transferring-maintainership-of-an-r-package-on-cran)
> that the standard procedure is (in the following order):
> 
> * a message from the old maintainers' email address stating the change
>    in maintainership
> 
> * a change in the DESCRIPTION file with the address of the new
>    maintainer information.
> 
> 
> But I'm interested in the steps afterwards (see also
> https://stackoverflow.com/questions/64299121/what-do-i-have-to-do-if-im-taking-over-the-maintenance-of-a-gnu-r-package-publi):
> 
> * How can I 'link' this package to a new repository on the version
>    control platform of my choice (e.g. https://gitlab.com/ or
>    https://github.com)?

Just change any documentation in the package that points to the wrong 
place.  In particular, this will include the URL: field in the 
DESCRIPTION file, but it may show up in help pages or vignettes as well.

> 
> * How do the package update procedures on CRAN work (e.g. if I want to
>    create a new version of the package)?

That's described quite clearly here:

https://cran.r-project.org/web/packages/policies.html

And you *must* create a new version of the package for the maintainer 
change to take effect.  Depending on how many other changes you are 
planning for it, you could make the minimal changes now, and bigger ones 
a month or two later, or wait until everything is ready.
> 
> * How does the update procedure for the repository on r-forge (in my
>    case: https://r-forge.r-project.org/projects/nephro/) work?  Is this
>    identical to the CRAN-package?

r-forge uses Subversion, so to update the package there, just change 
your working copy and commit the changes.  You'll need to be registered 
as a project member with sufficient privileges to do this; that 
registration needs to be done by someone with admin permissions.
> 
> 
> I looked into https://cran.r-project.org/web/packages/policies.html as
> well https://cran.r-project.org/doc/manuals/R-exts.html but I couldn't
> find an answer to my questions.

Hopefully I've added enough info for you.

Duncan Murdoch


From bbo|ker @end|ng |rom gm@||@com  Mon Oct 12 22:03:26 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 16:03:26 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
Message-ID: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>

   Before I risk wasting the CRAN maintainers' time with a query, can 
anyone see what I'm missing here?  Everything I can see looks OK, with 
the possible exception of the 'NA' result for "CRAN incoming 
feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)

   Any help appreciated, as always.

   Ben Bolker




=====
Dear maintainer,

package lme4_1.1-24.tar.gz does not pass the incoming checks 
automatically, please see the following pre-tests:
Windows: 
<https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log>
Status: OK
Debian: 
<https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Debian/00check.log>
Status: OK

Last released version's CRAN status: ERROR: 2, NOTE: 5, OK: 5
See: <https://CRAN.R-project.org/web/checks/check_results_lme4.html>

Last released version's additional issues:
   gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>

CRAN Web: <https://cran.r-project.org/package=lme4>

Please fix all problems and resubmit a fixed version via the webform.
If you are not sure how to fix the problems shown, please ask for help 
on the R-package-devel mailing list:
<https://stat.ethz.ch/mailman/listinfo/r-package-devel>
If you are fairly certain the rejection is a false positive, please 
reply-all to this message and explain.

More details are given in the directory:
<https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/>
The files will be removed after roughly 7 days.

*** Strong rev. depends ***: afex agRee altmeta aods3 arm ARTool bapred 
bayesammi BayesLN BayesSenMC baystability BBRecapture BClustLonG BFpack 
blme blmeco blocksdesign BradleyTerry2 buildmer cAIC4 car carcass cgam 
chngpt ciTools clickR climwin CLME clusteredinterference clusterPower 
CMatching cpr cvms DClusterm dfmeta DHARMa diagmeta difR doremi 
eda4treeR EdSurvey effects embed epr ESTER ez faraway faux fence 
finalfit fishmethods fullfact gamm4 geex GHap glmertree glmmEP GLMMRR 
glmmsr glmmTMB GLMpack gorica groupedstats gtheory gvcR HelpersMG 
HeritSeq hmi iccbeta IDmeasurer IMTest inferference influence.ME 
intRvals isni jlctree joineRmeta joineRML JointModel jomo jstable 
JWileymisc KenSyn lefko3 lmem.qtler LMERConvenienceFunctions lmerTest 
lmSupport longpower LSAmitR macc MAGNAMWAR manymodelr MargCond marked 
mbest MDMR mediation MEMSS merDeriv merTools meta metamisc metan 
metaplus Metatron micemd MiRKAT misty mixAK MixedPsy MixMAP MixRF MLID 
mlma mlmRev mlVAR MMeM multiDimBio multil
  evelTools MultiRR MultisiteMediation mumm mvMISE MXM nanny omics 
OptimClassifier pamm panelr paramhetero PBImisc pbkrtest pcgen 
pedigreemm Phenotype phyr piecewiseSEM Plasmode PLmixed powerbydesign 
powerlmm predictmeans PrevMap prLogistic psfmi ptmixed qape r2mlm 
raincin Rcmdr refund reghelper regplot REndo reproducer rewie RLRsim 
robustBLME robustlmm rockchalk rosetta rpql rptR rr2 RRreg rsq rstanarm 
rstap rties RVAideMemoire RVFam sae semEff siland simr sjstats skpr 
SlaPMEG smicd SoyNAM SPCDAnalyze specr SPreFuGED squid stability 
standardize statgenGxE statgenSTA StroupGLMM structree Surrogate 
surrosurv swissMrP TcGSA themetagenomics tidygate tidyMicro tramME 
tukeytrend userfriendlyscience varTestnlme VCA VetResearchLMM warpMix 
WebPower welchADF WeMix

Best regards,
CRAN teams' auto-check service


Flavor: r-devel-windows-ix86+x86_64
Check: CRAN incoming feasibility, Result: NA
   Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'

Flavor: r-devel-windows-ix86+x86_64
Check: Overall checktime, Result: NOTE
   Overall checktime 23 min > 10 min

Flavor: r-devel-linux-x86_64-debian-gcc
Check: CRAN incoming feasibility, Result: Note_to_CRAN_maintainers
   Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'


From |uc@r @end|ng |rom |edor@project@org  Mon Oct 12 22:23:07 2020
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Mon, 12 Oct 2020 22:23:07 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
Message-ID: <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>

On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>
>    Before I risk wasting the CRAN maintainers' time with a query, can
> anyone see what I'm missing here?  Everything I can see looks OK, with
> the possible exception of the 'NA' result for "CRAN incoming
> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)
>
>    Any help appreciated, as always.
>
>    Ben Bolker

There are UBSAN issues:

> Last released version's additional issues:
>    gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>

-- 
I?aki ?car


From bbo|ker @end|ng |rom gm@||@com  Mon Oct 12 22:25:37 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 16:25:37 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
Message-ID: <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>

   Thanks, but I don't think that's the problem because:

    (1) Those are reported as being from the last released version, not 
this one.
    (2) As far as I can tell from my local tests, I'm pretty sure I've 
fixed these issues in the current release.
    (3) In my experience UBSAN tests don't generally get re-run for a 
while after the initial CRAN testing anyway ...

   cheers
     Ben


On 10/12/20 4:23 PM, I?aki Ucar wrote:
> On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>>
>>     Before I risk wasting the CRAN maintainers' time with a query, can
>> anyone see what I'm missing here?  Everything I can see looks OK, with
>> the possible exception of the 'NA' result for "CRAN incoming
>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)
>>
>>     Any help appreciated, as always.
>>
>>     Ben Bolker
> 
> There are UBSAN issues:
> 
>> Last released version's additional issues:
>>     gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>


From |uc@r @end|ng |rom |edor@project@org  Mon Oct 12 22:34:44 2020
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Mon, 12 Oct 2020 22:34:44 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
Message-ID: <CALEXWq030H=ytjVHLHaTOZs8Y8GSVxf6vNRYQVK=ueKAiCZtuA@mail.gmail.com>

You are right. I was too fast and didn't read "last released version".
Then the only suspicious thing I see is:

Overall checktime 23 min > 10 min

On Mon, 12 Oct 2020 at 22:25, Ben Bolker <bbolker at gmail.com> wrote:
>
>    Thanks, but I don't think that's the problem because:
>
>     (1) Those are reported as being from the last released version, not
> this one.
>     (2) As far as I can tell from my local tests, I'm pretty sure I've
> fixed these issues in the current release.
>     (3) In my experience UBSAN tests don't generally get re-run for a
> while after the initial CRAN testing anyway ...
>
>    cheers
>      Ben
>
>
> On 10/12/20 4:23 PM, I?aki Ucar wrote:
> > On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
> >>
> >>     Before I risk wasting the CRAN maintainers' time with a query, can
> >> anyone see what I'm missing here?  Everything I can see looks OK, with
> >> the possible exception of the 'NA' result for "CRAN incoming
> >> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)
> >>
> >>     Any help appreciated, as always.
> >>
> >>     Ben Bolker
> >
> > There are UBSAN issues:
> >
> >> Last released version's additional issues:
> >>     gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
> >



-- 
I?aki ?car


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct 12 22:40:46 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 12 Oct 2020 16:40:46 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
Message-ID: <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>

There's this one in 
https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log:

   Comparing 'lmer-1.Rout' to 'lmer-1.Rout.save' ...428d427
< boundary (singular) fit: see ?isSingular
430d428
< boundary (singular) fit: see ?isSingular

Those messages about the singular fit show up in

https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout 


but not in

https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout.save

The difference also doesn't show up in the x64 versions of the files.

Duncan Murdoch

On 12/10/2020 4:03 p.m., Ben Bolker wrote:
>     Before I risk wasting the CRAN maintainers' time with a query, can
> anyone see what I'm missing here?  Everything I can see looks OK, with
> the possible exception of the 'NA' result for "CRAN incoming
> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)
> 
>     Any help appreciated, as always.
> 
>     Ben Bolker
> 
> 
> 
> 
> =====
> Dear maintainer,
> 
> package lme4_1.1-24.tar.gz does not pass the incoming checks
> automatically, please see the following pre-tests:
> Windows:
> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log>
> Status: OK
> Debian:
> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Debian/00check.log>
> Status: OK
> 
> Last released version's CRAN status: ERROR: 2, NOTE: 5, OK: 5
> See: <https://CRAN.R-project.org/web/checks/check_results_lme4.html>
> 
> Last released version's additional issues:
>     gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
> 
> CRAN Web: <https://cran.r-project.org/package=lme4>
> 
> Please fix all problems and resubmit a fixed version via the webform.
> If you are not sure how to fix the problems shown, please ask for help
> on the R-package-devel mailing list:
> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
> If you are fairly certain the rejection is a false positive, please
> reply-all to this message and explain.
> 
> More details are given in the directory:
> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/>
> The files will be removed after roughly 7 days.
> 
> *** Strong rev. depends ***: afex agRee altmeta aods3 arm ARTool bapred
> bayesammi BayesLN BayesSenMC baystability BBRecapture BClustLonG BFpack
> blme blmeco blocksdesign BradleyTerry2 buildmer cAIC4 car carcass cgam
> chngpt ciTools clickR climwin CLME clusteredinterference clusterPower
> CMatching cpr cvms DClusterm dfmeta DHARMa diagmeta difR doremi
> eda4treeR EdSurvey effects embed epr ESTER ez faraway faux fence
> finalfit fishmethods fullfact gamm4 geex GHap glmertree glmmEP GLMMRR
> glmmsr glmmTMB GLMpack gorica groupedstats gtheory gvcR HelpersMG
> HeritSeq hmi iccbeta IDmeasurer IMTest inferference influence.ME
> intRvals isni jlctree joineRmeta joineRML JointModel jomo jstable
> JWileymisc KenSyn lefko3 lmem.qtler LMERConvenienceFunctions lmerTest
> lmSupport longpower LSAmitR macc MAGNAMWAR manymodelr MargCond marked
> mbest MDMR mediation MEMSS merDeriv merTools meta metamisc metan
> metaplus Metatron micemd MiRKAT misty mixAK MixedPsy MixMAP MixRF MLID
> mlma mlmRev mlVAR MMeM multiDimBio multil
>    evelTools MultiRR MultisiteMediation mumm mvMISE MXM nanny omics
> OptimClassifier pamm panelr paramhetero PBImisc pbkrtest pcgen
> pedigreemm Phenotype phyr piecewiseSEM Plasmode PLmixed powerbydesign
> powerlmm predictmeans PrevMap prLogistic psfmi ptmixed qape r2mlm
> raincin Rcmdr refund reghelper regplot REndo reproducer rewie RLRsim
> robustBLME robustlmm rockchalk rosetta rpql rptR rr2 RRreg rsq rstanarm
> rstap rties RVAideMemoire RVFam sae semEff siland simr sjstats skpr
> SlaPMEG smicd SoyNAM SPCDAnalyze specr SPreFuGED squid stability
> standardize statgenGxE statgenSTA StroupGLMM structree Surrogate
> surrosurv swissMrP TcGSA themetagenomics tidygate tidyMicro tramME
> tukeytrend userfriendlyscience varTestnlme VCA VetResearchLMM warpMix
> WebPower welchADF WeMix
> 
> Best regards,
> CRAN teams' auto-check service
> 
> 
> Flavor: r-devel-windows-ix86+x86_64
> Check: CRAN incoming feasibility, Result: NA
>     Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
> 
> Flavor: r-devel-windows-ix86+x86_64
> Check: Overall checktime, Result: NOTE
>     Overall checktime 23 min > 10 min
> 
> Flavor: r-devel-linux-x86_64-debian-gcc
> Check: CRAN incoming feasibility, Result: Note_to_CRAN_maintainers
>     Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>


From bbo|ker @end|ng |rom gm@||@com  Mon Oct 12 22:39:45 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 16:39:45 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <CALEXWq030H=ytjVHLHaTOZs8Y8GSVxf6vNRYQVK=ueKAiCZtuA@mail.gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
 <CALEXWq030H=ytjVHLHaTOZs8Y8GSVxf6vNRYQVK=ueKAiCZtuA@mail.gmail.com>
Message-ID: <3af5cc3b-3f05-19bb-ee7b-f9509f46f26e@gmail.com>



On 10/12/20 4:34 PM, I?aki Ucar wrote:
> You are right. I was too fast and didn't read "last released version".
> Then the only suspicious thing I see is:
> 
> Overall checktime 23 min > 10 min

   I agree that's unfortunate, but it doesn't seem grounds for summary 
rejection ... ?  (CRAN policy says "Checking the package should take as 
little CPU time as possible".)  You may be right: it does seem to be _de 
facto_ policy that any NOTE is grounds for rejection.  On the other 
hand, this package has had NOTEs about 'installed size is <large>" for a 
long time, which hasn't been grounds for rejection.

   cheers
    Ben Bolker


> 
> On Mon, 12 Oct 2020 at 22:25, Ben Bolker <bbolker at gmail.com> wrote:
>>
>>     Thanks, but I don't think that's the problem because:
>>
>>      (1) Those are reported as being from the last released version, not
>> this one.
>>      (2) As far as I can tell from my local tests, I'm pretty sure I've
>> fixed these issues in the current release.
>>      (3) In my experience UBSAN tests don't generally get re-run for a
>> while after the initial CRAN testing anyway ...
>>
>>     cheers
>>       Ben
>>
>>
>> On 10/12/20 4:23 PM, I?aki Ucar wrote:
>>> On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>>>>
>>>>      Before I risk wasting the CRAN maintainers' time with a query, can
>>>> anyone see what I'm missing here?  Everything I can see looks OK, with
>>>> the possible exception of the 'NA' result for "CRAN incoming
>>>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my fault???)
>>>>
>>>>      Any help appreciated, as always.
>>>>
>>>>      Ben Bolker
>>>
>>> There are UBSAN issues:
>>>
>>>> Last released version's additional issues:
>>>>      gcc-UBSAN <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>>
> 
> 
>


From |uc@r @end|ng |rom |edor@project@org  Mon Oct 12 22:51:01 2020
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Mon, 12 Oct 2020 22:51:01 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <3af5cc3b-3f05-19bb-ee7b-f9509f46f26e@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
 <CALEXWq030H=ytjVHLHaTOZs8Y8GSVxf6vNRYQVK=ueKAiCZtuA@mail.gmail.com>
 <3af5cc3b-3f05-19bb-ee7b-f9509f46f26e@gmail.com>
Message-ID: <CALEXWq1q0eJHuasPYXp3FRWg+a6hkcQ7x39MJro99AmVhbpPYA@mail.gmail.com>

On Mon, 12 Oct 2020 at 22:40, Ben Bolker <bbolker at gmail.com> wrote:
>
> On 10/12/20 4:34 PM, I?aki Ucar wrote:
> > You are right. I was too fast and didn't read "last released version".
> > Then the only suspicious thing I see is:
> >
> > Overall checktime 23 min > 10 min
>
>    I agree that's unfortunate, but it doesn't seem grounds for summary
> rejection ... ?  (CRAN policy says "Checking the package should take as
> little CPU time as possible".)  You may be right: it does seem to be _de
> facto_ policy that any NOTE is grounds for rejection.  On the other
> hand, this package has had NOTEs about 'installed size is <large>" for a
> long time, which hasn't been grounds for rejection.

Large size due to libs. But if data or docs go beyond 5MB, it would
probably be rejected. Likewise, I believe checking time is another one
of those NOTEs that are really hard lines.

-- 
I?aki ?car


From bbo|ker @end|ng |rom gm@||@com  Mon Oct 12 23:17:58 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 17:17:58 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
Message-ID: <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>



On 10/12/20 4:40 PM, Duncan Murdoch wrote:
> There's this one in 
> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log: 
> 
> 
>  ? Comparing 'lmer-1.Rout' to 'lmer-1.Rout.save' ...428d427
> < boundary (singular) fit: see ?isSingular
> 430d428
> < boundary (singular) fit: see ?isSingular
> 
> Those messages about the singular fit show up in
> 
> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout 
> 
> 
> but not in
> 
> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout.save 
> 
> 
> The difference also doesn't show up in the x64 versions of the files.

   OK, thanks.

   I did notice this in passing (I think), but I got confused by the 
format.  (Also, it doesn't even rise to the level of a NOTE ...)

   It took me a while to localize the problem (line numbers have to be 
computing _after_ throwing away the R header info, see source code of 
tools::Rdiff()).

    Having spent this long reading tea leaves, I think I'm going to 
write to the CRAN maintainers for clarification.

   * Refactoring all the tests to decrease the testing time 
significantly is certainly possible (at worst I can make a lot of stuff 
conditionally skipped on CRAN), but would be a nuisance that I'd rather 
save for the next release if possible.

   * Eliminating the two lines of variable output is easy, but it's 
mildly annoying to update the version number for this small a correction 
...

   Looks like from now on there will only be odd-numbered releases of 
lme4 on CRAN, since I seem guaranteed to make trivial errors with my 
first (odd-numbered) try each time and have to bump the version number 
when fixing them ...

    Ben Bolker


> 
> Duncan Murdoch
> 
> On 12/10/2020 4:03 p.m., Ben Bolker wrote:
>> ??? Before I risk wasting the CRAN maintainers' time with a query, can
>> anyone see what I'm missing here?? Everything I can see looks OK, with
>> the possible exception of the 'NA' result for "CRAN incoming
>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my 
>> fault???)
>>
>> ??? Any help appreciated, as always.
>>
>> ??? Ben Bolker
>>
>>
>>
>>
>> =====
>> Dear maintainer,
>>
>> package lme4_1.1-24.tar.gz does not pass the incoming checks
>> automatically, please see the following pre-tests:
>> Windows:
>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log> 
>>
>> Status: OK
>> Debian:
>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Debian/00check.log> 
>>
>> Status: OK
>>
>> Last released version's CRAN status: ERROR: 2, NOTE: 5, OK: 5
>> See: <https://CRAN.R-project.org/web/checks/check_results_lme4.html>
>>
>> Last released version's additional issues:
>> ??? gcc-UBSAN 
>> <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>
>> CRAN Web: <https://cran.r-project.org/package=lme4>
>>
>> Please fix all problems and resubmit a fixed version via the webform.
>> If you are not sure how to fix the problems shown, please ask for help
>> on the R-package-devel mailing list:
>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>> If you are fairly certain the rejection is a false positive, please
>> reply-all to this message and explain.
>>
>> More details are given in the directory:
>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/> 
>>
>> The files will be removed after roughly 7 days.
>>
>> *** Strong rev. depends ***: afex agRee altmeta aods3 arm ARTool bapred
>> bayesammi BayesLN BayesSenMC baystability BBRecapture BClustLonG BFpack
>> blme blmeco blocksdesign BradleyTerry2 buildmer cAIC4 car carcass cgam
>> chngpt ciTools clickR climwin CLME clusteredinterference clusterPower
>> CMatching cpr cvms DClusterm dfmeta DHARMa diagmeta difR doremi
>> eda4treeR EdSurvey effects embed epr ESTER ez faraway faux fence
>> finalfit fishmethods fullfact gamm4 geex GHap glmertree glmmEP GLMMRR
>> glmmsr glmmTMB GLMpack gorica groupedstats gtheory gvcR HelpersMG
>> HeritSeq hmi iccbeta IDmeasurer IMTest inferference influence.ME
>> intRvals isni jlctree joineRmeta joineRML JointModel jomo jstable
>> JWileymisc KenSyn lefko3 lmem.qtler LMERConvenienceFunctions lmerTest
>> lmSupport longpower LSAmitR macc MAGNAMWAR manymodelr MargCond marked
>> mbest MDMR mediation MEMSS merDeriv merTools meta metamisc metan
>> metaplus Metatron micemd MiRKAT misty mixAK MixedPsy MixMAP MixRF MLID
>> mlma mlmRev mlVAR MMeM multiDimBio multil
>> ?? evelTools MultiRR MultisiteMediation mumm mvMISE MXM nanny omics
>> OptimClassifier pamm panelr paramhetero PBImisc pbkrtest pcgen
>> pedigreemm Phenotype phyr piecewiseSEM Plasmode PLmixed powerbydesign
>> powerlmm predictmeans PrevMap prLogistic psfmi ptmixed qape r2mlm
>> raincin Rcmdr refund reghelper regplot REndo reproducer rewie RLRsim
>> robustBLME robustlmm rockchalk rosetta rpql rptR rr2 RRreg rsq rstanarm
>> rstap rties RVAideMemoire RVFam sae semEff siland simr sjstats skpr
>> SlaPMEG smicd SoyNAM SPCDAnalyze specr SPreFuGED squid stability
>> standardize statgenGxE statgenSTA StroupGLMM structree Surrogate
>> surrosurv swissMrP TcGSA themetagenomics tidygate tidyMicro tramME
>> tukeytrend userfriendlyscience varTestnlme VCA VetResearchLMM warpMix
>> WebPower welchADF WeMix
>>
>> Best regards,
>> CRAN teams' auto-check service
>>
>>
>> Flavor: r-devel-windows-ix86+x86_64
>> Check: CRAN incoming feasibility, Result: NA
>> ??? Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
>>
>> Flavor: r-devel-windows-ix86+x86_64
>> Check: Overall checktime, Result: NOTE
>> ??? Overall checktime 23 min > 10 min
>>
>> Flavor: r-devel-linux-x86_64-debian-gcc
>> Check: CRAN incoming feasibility, Result: Note_to_CRAN_maintainers
>> ??? Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
>


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Mon Oct 12 23:18:59 2020
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Mon, 12 Oct 2020 23:18:59 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
Message-ID: <865793e7-e492-2136-091b-c3eade2359ea@statistik.tu-dortmund.de>

Actually more than 23 minutes check time for a single package is really 
excessive, can you pls cut that down?

This comes from

** running tests for arch 'i386' ... [509s] OK
** running tests for arch 'x64' ... [501s] OK

so only tests take 1010 seconds already.

I see that lme4 is a really important package that may justify some 
extra check time, but this is really a lot.

Can you please reduce the check time in the tests? e.g. using toy data 
and few iterations? Or by running less important tests only 
conditionally if some environment variable is set that you only define 
on your machine?

Best,
Uwe Ligges

On 12.10.2020 22:25, Ben Bolker wrote:
>  ? Thanks, but I don't think that's the problem because:
> 
>  ?? (1) Those are reported as being from the last released version, not 
> this one.
>  ?? (2) As far as I can tell from my local tests, I'm pretty sure I've 
> fixed these issues in the current release.
>  ?? (3) In my experience UBSAN tests don't generally get re-run for a 
> while after the initial CRAN testing anyway ...
> 
>  ? cheers
>  ??? Ben
> 
> 
> On 10/12/20 4:23 PM, I?aki Ucar wrote:
>> On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>>>
>>> ??? Before I risk wasting the CRAN maintainers' time with a query, can
>>> anyone see what I'm missing here?? Everything I can see looks OK, with
>>> the possible exception of the 'NA' result for "CRAN incoming
>>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my 
>>> fault???)
>>>
>>> ??? Any help appreciated, as always.
>>>
>>> ??? Ben Bolker
>>
>> There are UBSAN issues:
>>
>>> Last released version's additional issues:
>>> ??? gcc-UBSAN 
>>> <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>
> 
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From bbo|ker @end|ng |rom gm@||@com  Mon Oct 12 23:29:10 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 17:29:10 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <865793e7-e492-2136-091b-c3eade2359ea@statistik.tu-dortmund.de>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
 <865793e7-e492-2136-091b-c3eade2359ea@statistik.tu-dortmund.de>
Message-ID: <64d1294a-eef5-22c3-5547-df0bd32de00b@gmail.com>


   Sure.  I assume I should aim for <10 minutes since that's the 
threshold for a NOTE ...  (for what it's worth the tests take a bit less 
than 25% as long on my Linux laptop, since an individual test run is 
more than twice as fast and we only have to check one architecture ...)

   Do I interpret correctly that the advice is to address this problem, 
bump the version number, and re-submit?

   cheers
    Ben Bolker

On 10/12/20 5:18 PM, Uwe Ligges wrote:
> Actually more than 23 minutes check time for a single package is really 
> excessive, can you pls cut that down?
> 
> This comes from
> 
> ** running tests for arch 'i386' ... [509s] OK
> ** running tests for arch 'x64' ... [501s] OK
> 
> so only tests take 1010 seconds already.
> 
> I see that lme4 is a really important package that may justify some 
> extra check time, but this is really a lot.
> 
> Can you please reduce the check time in the tests? e.g. using toy data 
> and few iterations? Or by running less important tests only 
> conditionally if some environment variable is set that you only define 
> on your machine?
> 
> Best,
> Uwe Ligges
> 
> On 12.10.2020 22:25, Ben Bolker wrote:
>> ?? Thanks, but I don't think that's the problem because:
>>
>> ??? (1) Those are reported as being from the last released version, 
>> not this one.
>> ??? (2) As far as I can tell from my local tests, I'm pretty sure I've 
>> fixed these issues in the current release.
>> ??? (3) In my experience UBSAN tests don't generally get re-run for a 
>> while after the initial CRAN testing anyway ...
>>
>> ?? cheers
>> ???? Ben
>>
>>
>> On 10/12/20 4:23 PM, I?aki Ucar wrote:
>>> On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>>>>
>>>> ??? Before I risk wasting the CRAN maintainers' time with a query, can
>>>> anyone see what I'm missing here?? Everything I can see looks OK, with
>>>> the possible exception of the 'NA' result for "CRAN incoming
>>>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my 
>>>> fault???)
>>>>
>>>> ??? Any help appreciated, as always.
>>>>
>>>> ??? Ben Bolker
>>>
>>> There are UBSAN issues:
>>>
>>>> Last released version's additional issues:
>>>> ??? gcc-UBSAN 
>>>> <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>>
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From murdoch@dunc@n @end|ng |rom gm@||@com  Mon Oct 12 23:53:01 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 12 Oct 2020 17:53:01 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
Message-ID: <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>

On 12/10/2020 5:17 p.m., Ben Bolker wrote:
> 
> 
> On 10/12/20 4:40 PM, Duncan Murdoch wrote:
>> There's this one in
>> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log:
>>
>>
>>   ? Comparing 'lmer-1.Rout' to 'lmer-1.Rout.save' ...428d427
>> < boundary (singular) fit: see ?isSingular
>> 430d428
>> < boundary (singular) fit: see ?isSingular
>>
>> Those messages about the singular fit show up in
>>
>> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout
>>
>>
>> but not in
>>
>> https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/examples_and_tests/tests_i386/lmer-1.Rout.save
>>
>>
>> The difference also doesn't show up in the x64 versions of the files.
> 
>     OK, thanks.
> 
>     I did notice this in passing (I think), but I got confused by the
> format.  (Also, it doesn't even rise to the level of a NOTE ...)

Yes, failing to match saved test output should be a fatal error, but 
isn't marked as one.

> 
>     It took me a while to localize the problem (line numbers have to be
> computing _after_ throwing away the R header info, see source code of
> tools::Rdiff()).

One of my favourite programs back in the days when I used Windows was 
Beyond Compare (https://www.scootersoftware.com/).  They've had a Mac 
version for a while now; it works well too (though I kind of prefer the 
old Windows UI a bit for some reason).  It made it really easy to find 
this difference, once I figured out which files to compare.  I didn't 
even recognize the line numbers in the CRAN report as line numbers at first.

>      Having spent this long reading tea leaves, I think I'm going to
> write to the CRAN maintainers for clarification.
> 
>     * Refactoring all the tests to decrease the testing time
> significantly is certainly possible (at worst I can make a lot of stuff
> conditionally skipped on CRAN), but would be a nuisance that I'd rather
> save for the next release if possible.
> 
>     * Eliminating the two lines of variable output is easy, but it's
> mildly annoying to update the version number for this small a correction
> ...

I'd say a mismatch in saved output isn't a small problem, it's either a 
too-sensitive test or something serious.

Duncan Murdoch

> 
>     Looks like from now on there will only be odd-numbered releases of
> lme4 on CRAN, since I seem guaranteed to make trivial errors with my
> first (odd-numbered) try each time and have to bump the version number
> when fixing them ...
> 
>      Ben Bolker
> 
> 
>>
>> Duncan Murdoch
>>
>> On 12/10/2020 4:03 p.m., Ben Bolker wrote:
>>>  ??? Before I risk wasting the CRAN maintainers' time with a query, can
>>> anyone see what I'm missing here?? Everything I can see looks OK, with
>>> the possible exception of the 'NA' result for "CRAN incoming
>>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my
>>> fault???)
>>>
>>>  ??? Any help appreciated, as always.
>>>
>>>  ??? Ben Bolker
>>>
>>>
>>>
>>>
>>> =====
>>> Dear maintainer,
>>>
>>> package lme4_1.1-24.tar.gz does not pass the incoming checks
>>> automatically, please see the following pre-tests:
>>> Windows:
>>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Windows/00check.log>
>>>
>>> Status: OK
>>> Debian:
>>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/Debian/00check.log>
>>>
>>> Status: OK
>>>
>>> Last released version's CRAN status: ERROR: 2, NOTE: 5, OK: 5
>>> See: <https://CRAN.R-project.org/web/checks/check_results_lme4.html>
>>>
>>> Last released version's additional issues:
>>>  ??? gcc-UBSAN
>>> <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>>
>>> CRAN Web: <https://cran.r-project.org/package=lme4>
>>>
>>> Please fix all problems and resubmit a fixed version via the webform.
>>> If you are not sure how to fix the problems shown, please ask for help
>>> on the R-package-devel mailing list:
>>> <https://stat.ethz.ch/mailman/listinfo/r-package-devel>
>>> If you are fairly certain the rejection is a false positive, please
>>> reply-all to this message and explain.
>>>
>>> More details are given in the directory:
>>> <https://win-builder.r-project.org/incoming_pretest/lme4_1.1-24_20201012_210730/>
>>>
>>> The files will be removed after roughly 7 days.
>>>
>>> *** Strong rev. depends ***: afex agRee altmeta aods3 arm ARTool bapred
>>> bayesammi BayesLN BayesSenMC baystability BBRecapture BClustLonG BFpack
>>> blme blmeco blocksdesign BradleyTerry2 buildmer cAIC4 car carcass cgam
>>> chngpt ciTools clickR climwin CLME clusteredinterference clusterPower
>>> CMatching cpr cvms DClusterm dfmeta DHARMa diagmeta difR doremi
>>> eda4treeR EdSurvey effects embed epr ESTER ez faraway faux fence
>>> finalfit fishmethods fullfact gamm4 geex GHap glmertree glmmEP GLMMRR
>>> glmmsr glmmTMB GLMpack gorica groupedstats gtheory gvcR HelpersMG
>>> HeritSeq hmi iccbeta IDmeasurer IMTest inferference influence.ME
>>> intRvals isni jlctree joineRmeta joineRML JointModel jomo jstable
>>> JWileymisc KenSyn lefko3 lmem.qtler LMERConvenienceFunctions lmerTest
>>> lmSupport longpower LSAmitR macc MAGNAMWAR manymodelr MargCond marked
>>> mbest MDMR mediation MEMSS merDeriv merTools meta metamisc metan
>>> metaplus Metatron micemd MiRKAT misty mixAK MixedPsy MixMAP MixRF MLID
>>> mlma mlmRev mlVAR MMeM multiDimBio multil
>>>  ?? evelTools MultiRR MultisiteMediation mumm mvMISE MXM nanny omics
>>> OptimClassifier pamm panelr paramhetero PBImisc pbkrtest pcgen
>>> pedigreemm Phenotype phyr piecewiseSEM Plasmode PLmixed powerbydesign
>>> powerlmm predictmeans PrevMap prLogistic psfmi ptmixed qape r2mlm
>>> raincin Rcmdr refund reghelper regplot REndo reproducer rewie RLRsim
>>> robustBLME robustlmm rockchalk rosetta rpql rptR rr2 RRreg rsq rstanarm
>>> rstap rties RVAideMemoire RVFam sae semEff siland simr sjstats skpr
>>> SlaPMEG smicd SoyNAM SPCDAnalyze specr SPreFuGED squid stability
>>> standardize statgenGxE statgenSTA StroupGLMM structree Surrogate
>>> surrosurv swissMrP TcGSA themetagenomics tidygate tidyMicro tramME
>>> tukeytrend userfriendlyscience varTestnlme VCA VetResearchLMM warpMix
>>> WebPower welchADF WeMix
>>>
>>> Best regards,
>>> CRAN teams' auto-check service
>>>
>>>
>>> Flavor: r-devel-windows-ix86+x86_64
>>> Check: CRAN incoming feasibility, Result: NA
>>>  ??? Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
>>>
>>> Flavor: r-devel-windows-ix86+x86_64
>>> Check: Overall checktime, Result: NOTE
>>>  ??? Overall checktime 23 min > 10 min
>>>
>>> Flavor: r-devel-linux-x86_64-debian-gcc
>>> Check: CRAN incoming feasibility, Result: Note_to_CRAN_maintainers
>>>  ??? Maintainer: 'Ben Bolker <bbolker+lme4 at gmail.com>'
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>>
>>


From bbo|ker @end|ng |rom gm@||@com  Tue Oct 13 00:14:43 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 18:14:43 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
Message-ID: <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>



> 
> I'd say a mismatch in saved output isn't a small problem, it's either a 
> too-sensitive test or something serious.
> 
> Duncan Murdoch
> 

   That's fair enough, but it would be nice if (1) this were a NOTE and 
(2) it were made explicit in the CRAN policy that, *except by special 
exception*, an unresolved NOTE is grounds for rejection.  This is 
broadly understood by experienced package maintainers but must sometimes 
come as a shock to newbies ...

    cheers
     Ben


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 13 00:36:32 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 12 Oct 2020 18:36:32 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
Message-ID: <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>

On 12/10/2020 6:14 p.m., Ben Bolker wrote:
> 
> 
>>
>> I'd say a mismatch in saved output isn't a small problem, it's either a
>> too-sensitive test or something serious.
>>
>> Duncan Murdoch
>>
> 
>     That's fair enough, but it would be nice if (1) this were a NOTE and

I don't think so.  As I said, I think it should be marked as an ERROR.

Duncan Murdoch

> (2) it were made explicit in the CRAN policy that, *except by special
> exception*, an unresolved NOTE is grounds for rejection.  This is
> broadly understood by experienced package maintainers but must sometimes
> come as a shock to newbies ...


From bbo|ker @end|ng |rom gm@||@com  Tue Oct 13 00:51:46 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 18:51:46 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
 <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
Message-ID: <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>



On 10/12/20 6:36 PM, Duncan Murdoch wrote:
> On 12/10/2020 6:14 p.m., Ben Bolker wrote:
>>
>>
>>>
>>> I'd say a mismatch in saved output isn't a small problem, it's either a
>>> too-sensitive test or something serious.
>>>
>>> Duncan Murdoch
>>>
>>
>> ??? That's fair enough, but it would be nice if (1) this were a NOTE and
> 
> I don't think so.? As I said, I think it should be marked as an ERROR.

   OK.  But it would probably be wise (if the CRAN maintainers actually 
wanted to do this) to crank it up from silent -> NOTE -> WARNING -> 
ERROR over the course of several releases so as not to have widespread 
test failures on CRAN right away ...


> 
> Duncan Murdoch
> 
>> (2) it were made explicit in the CRAN policy that, *except by special
>> exception*, an unresolved NOTE is grounds for rejection.? This is
>> broadly understood by experienced package maintainers but must sometimes
>> come as a shock to newbies ...
> 
>


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 13 01:37:31 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Mon, 12 Oct 2020 19:37:31 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
 <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
 <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>
Message-ID: <d5cb73ca-39be-f821-f375-2a76d2aa0b59@gmail.com>

On 12/10/2020 6:51 p.m., Ben Bolker wrote:
> 
> 
> On 10/12/20 6:36 PM, Duncan Murdoch wrote:
>> On 12/10/2020 6:14 p.m., Ben Bolker wrote:
>>>
>>>
>>>>
>>>> I'd say a mismatch in saved output isn't a small problem, it's either a
>>>> too-sensitive test or something serious.
>>>>
>>>> Duncan Murdoch
>>>>
>>>
>>>  ??? That's fair enough, but it would be nice if (1) this were a NOTE and
>>
>> I don't think so.? As I said, I think it should be marked as an ERROR.
> 
>     OK.  But it would probably be wise (if the CRAN maintainers actually
> wanted to do this) to crank it up from silent -> NOTE -> WARNING ->
> ERROR over the course of several releases so as not to have widespread
> test failures on CRAN right away ...

Do you think so?  Why would you put saved results into the package 
unless you want to test if they match?

Honestly, I thought this had always been a fatal error.

Duncan Murdoch


From bbo|ker @end|ng |rom gm@||@com  Tue Oct 13 01:47:21 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Mon, 12 Oct 2020 19:47:21 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <d5cb73ca-39be-f821-f375-2a76d2aa0b59@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
 <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
 <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>
 <d5cb73ca-39be-f821-f375-2a76d2aa0b59@gmail.com>
Message-ID: <fd450c3a-9b9c-a577-6868-cb02571fe6cb@gmail.com>



On 10/12/20 7:37 PM, Duncan Murdoch wrote:
> On 12/10/2020 6:51 p.m., Ben Bolker wrote:
>>
>>
>> On 10/12/20 6:36 PM, Duncan Murdoch wrote:
>>> On 12/10/2020 6:14 p.m., Ben Bolker wrote:
>>>>
>>>>
>>>>>
>>>>> I'd say a mismatch in saved output isn't a small problem, it's 
>>>>> either a
>>>>> too-sensitive test or something serious.
>>>>>
>>>>> Duncan Murdoch
>>>>>
>>>>
>>>> ???? That's fair enough, but it would be nice if (1) this were a 
>>>> NOTE and
>>>
>>> I don't think so.? As I said, I think it should be marked as an ERROR.
>>
>> ??? OK.? But it would probably be wise (if the CRAN maintainers actually
>> wanted to do this) to crank it up from silent -> NOTE -> WARNING ->
>> ERROR over the course of several releases so as not to have widespread
>> test failures on CRAN right away ...
> 
> Do you think so?? Why would you put saved results into the package 
> unless you want to test if they match?

   My point was just that it would be disruptive to switch the severity 
of such mismatches from 'message, no NOTE' to 'ERROR' in a single step - 
I'd imagine it could lead to a very large number of CRAN packages 
suddenly failing their tests.

   cheers
     Ben Bolker


> 
> Honestly, I thought this had always been a fatal error.
> 
> Duncan Murdoch


From ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de  Tue Oct 13 10:04:31 2020
From: ||gge@ @end|ng |rom @t@t|@t|k@tu-dortmund@de (Uwe Ligges)
Date: Tue, 13 Oct 2020 10:04:31 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <64d1294a-eef5-22c3-5547-df0bd32de00b@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <CALEXWq3oDey1J9Zk6Vkf9jFxs4yvDmgt+vZvj-qfHgXHHbkGaA@mail.gmail.com>
 <69d85f65-1ded-863f-6ec1-81426e48a28f@gmail.com>
 <865793e7-e492-2136-091b-c3eade2359ea@statistik.tu-dortmund.de>
 <64d1294a-eef5-22c3-5547-df0bd32de00b@gmail.com>
Message-ID: <8b646c17-8123-4347-d462-8fef42950e0e@statistik.tu-dortmund.de>



On 12.10.2020 23:29, Ben Bolker wrote:
> 
>  ? Sure.? I assume I should aim for <10 minutes since that's the 
> threshold for a NOTE ...? (for what it's worth the tests take a bit less 
> than 25% as long on my Linux laptop, since an individual test run is 
> more than twice as fast and we only have to check one architecture ...)
> 
>  ? Do I interpret correctly that the advice is to address this problem, 
> bump the version number, and re-submit?

Yes, please.

Best,
Uwe

>  ? cheers
>  ?? Ben Bolker
> 
> On 10/12/20 5:18 PM, Uwe Ligges wrote:
>> Actually more than 23 minutes check time for a single package is 
>> really excessive, can you pls cut that down?
>>
>> This comes from
>>
>> ** running tests for arch 'i386' ... [509s] OK
>> ** running tests for arch 'x64' ... [501s] OK
>>
>> so only tests take 1010 seconds already.
>>
>> I see that lme4 is a really important package that may justify some 
>> extra check time, but this is really a lot.
>>
>> Can you please reduce the check time in the tests? e.g. using toy data 
>> and few iterations? Or by running less important tests only 
>> conditionally if some environment variable is set that you only define 
>> on your machine?
>>
>> Best,
>> Uwe Ligges
>>
>> On 12.10.2020 22:25, Ben Bolker wrote:
>>> ?? Thanks, but I don't think that's the problem because:
>>>
>>> ??? (1) Those are reported as being from the last released version, 
>>> not this one.
>>> ??? (2) As far as I can tell from my local tests, I'm pretty sure 
>>> I've fixed these issues in the current release.
>>> ??? (3) In my experience UBSAN tests don't generally get re-run for a 
>>> while after the initial CRAN testing anyway ...
>>>
>>> ?? cheers
>>> ???? Ben
>>>
>>>
>>> On 10/12/20 4:23 PM, I?aki Ucar wrote:
>>>> On Mon, 12 Oct 2020 at 22:04, Ben Bolker <bbolker at gmail.com> wrote:
>>>>>
>>>>> ??? Before I risk wasting the CRAN maintainers' time with a query, can
>>>>> anyone see what I'm missing here?? Everything I can see looks OK, with
>>>>> the possible exception of the 'NA' result for "CRAN incoming
>>>>> feasibility" on r-devel-windows-ix86+x86_64 (which surely isn't my 
>>>>> fault???)
>>>>>
>>>>> ??? Any help appreciated, as always.
>>>>>
>>>>> ??? Ben Bolker
>>>>
>>>> There are UBSAN issues:
>>>>
>>>>> Last released version's additional issues:
>>>>> ??? gcc-UBSAN 
>>>>> <https://www.stats.ox.ac.uk/pub/bdr/memtests/gcc-UBSAN/lme4>
>>>>
>>>
>>> ______________________________________________
>>> R-package-devel at r-project.org mailing list
>>> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From |uc@r @end|ng |rom |edor@project@org  Tue Oct 13 11:33:22 2020
From: |uc@r @end|ng |rom |edor@project@org (=?UTF-8?Q?I=C3=B1aki_Ucar?=)
Date: Tue, 13 Oct 2020 11:33:22 +0200
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <fd450c3a-9b9c-a577-6868-cb02571fe6cb@gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
 <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
 <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>
 <d5cb73ca-39be-f821-f375-2a76d2aa0b59@gmail.com>
 <fd450c3a-9b9c-a577-6868-cb02571fe6cb@gmail.com>
Message-ID: <CALEXWq1dRC6er0aXrbDx0fZL8rquJY8_cLFkM5jfMe1_Eu2D8w@mail.gmail.com>

On Tue, 13 Oct 2020 at 01:47, Ben Bolker <bbolker at gmail.com> wrote:
>
>
>
> On 10/12/20 7:37 PM, Duncan Murdoch wrote:
> > On 12/10/2020 6:51 p.m., Ben Bolker wrote:
> >>
> >>
> >> On 10/12/20 6:36 PM, Duncan Murdoch wrote:
> >>> On 12/10/2020 6:14 p.m., Ben Bolker wrote:
> >>>>
> >>>>
> >>>>>
> >>>>> I'd say a mismatch in saved output isn't a small problem, it's
> >>>>> either a
> >>>>> too-sensitive test or something serious.
> >>>>>
> >>>>> Duncan Murdoch
> >>>>>
> >>>>
> >>>>      That's fair enough, but it would be nice if (1) this were a
> >>>> NOTE and
> >>>
> >>> I don't think so.  As I said, I think it should be marked as an ERROR.
> >>
> >>     OK.  But it would probably be wise (if the CRAN maintainers actually
> >> wanted to do this) to crank it up from silent -> NOTE -> WARNING ->
> >> ERROR over the course of several releases so as not to have widespread
> >> test failures on CRAN right away ...
> >
> > Do you think so?  Why would you put saved results into the package
> > unless you want to test if they match?
>
>    My point was just that it would be disruptive to switch the severity
> of such mismatches from 'message, no NOTE' to 'ERROR' in a single step -
> I'd imagine it could lead to a very large number of CRAN packages
> suddenly failing their tests.

Hold on, are we sure this is detected at all? The result of the tests
is reported as OK. The "singular fit" message goes to stderr, so my
guess is that it is not compared against the saved output at all.

-- 
I?aki ?car


From murdoch@dunc@n @end|ng |rom gm@||@com  Tue Oct 13 11:44:33 2020
From: murdoch@dunc@n @end|ng |rom gm@||@com (Duncan Murdoch)
Date: Tue, 13 Oct 2020 05:44:33 -0400
Subject: [R-pkg-devel] puzzling CRAN rejection
In-Reply-To: <CALEXWq1dRC6er0aXrbDx0fZL8rquJY8_cLFkM5jfMe1_Eu2D8w@mail.gmail.com>
References: <ec3246c1-17c2-c50c-19e7-158a0f95e9c1@gmail.com>
 <0cd4154b-5323-3936-09d1-292361932c43@gmail.com>
 <12d678f3-8d91-2634-c916-050eb6d62882@gmail.com>
 <85c26123-fddd-d1ea-09c9-9d6a8a00bb33@gmail.com>
 <c3593d1e-1ac0-21f5-cf94-0f45efcc60ef@gmail.com>
 <4fcadadc-c3fc-a9df-ebdf-31cccc0ead8d@gmail.com>
 <973d064b-6316-0e60-7f4a-a37543c5423e@gmail.com>
 <d5cb73ca-39be-f821-f375-2a76d2aa0b59@gmail.com>
 <fd450c3a-9b9c-a577-6868-cb02571fe6cb@gmail.com>
 <CALEXWq1dRC6er0aXrbDx0fZL8rquJY8_cLFkM5jfMe1_Eu2D8w@mail.gmail.com>
Message-ID: <26767715-82a9-a753-cafd-5127da0d03de@gmail.com>

On 13/10/2020 5:33 a.m., I?aki Ucar wrote:
> On Tue, 13 Oct 2020 at 01:47, Ben Bolker <bbolker at gmail.com> wrote:
>>
>>
>>
>> On 10/12/20 7:37 PM, Duncan Murdoch wrote:
>>> On 12/10/2020 6:51 p.m., Ben Bolker wrote:
>>>>
>>>>
>>>> On 10/12/20 6:36 PM, Duncan Murdoch wrote:
>>>>> On 12/10/2020 6:14 p.m., Ben Bolker wrote:
>>>>>>
>>>>>>
>>>>>>>
>>>>>>> I'd say a mismatch in saved output isn't a small problem, it's
>>>>>>> either a
>>>>>>> too-sensitive test or something serious.
>>>>>>>
>>>>>>> Duncan Murdoch
>>>>>>>
>>>>>>
>>>>>>       That's fair enough, but it would be nice if (1) this were a
>>>>>> NOTE and
>>>>>
>>>>> I don't think so.  As I said, I think it should be marked as an ERROR.
>>>>
>>>>      OK.  But it would probably be wise (if the CRAN maintainers actually
>>>> wanted to do this) to crank it up from silent -> NOTE -> WARNING ->
>>>> ERROR over the course of several releases so as not to have widespread
>>>> test failures on CRAN right away ...
>>>
>>> Do you think so?  Why would you put saved results into the package
>>> unless you want to test if they match?
>>
>>     My point was just that it would be disruptive to switch the severity
>> of such mismatches from 'message, no NOTE' to 'ERROR' in a single step -
>> I'd imagine it could lead to a very large number of CRAN packages
>> suddenly failing their tests.
> 
> Hold on, are we sure this is detected at all? The result of the tests
> is reported as OK. The "singular fit" message goes to stderr, so my
> guess is that it is not compared against the saved output at all.
> 

It is reported in the 00check.log file; I gave the link to the report.

I think it's a bug in the check code that the check log reports OK at 
the end, when (what should be) a fatal error has been displayed.

Duncan Murdoch


From @erg|o@|b@rr@ @end|ng |rom u@p@br  Tue Oct 13 17:07:46 2020
From: @erg|o@|b@rr@ @end|ng |rom u@p@br (Sergio Ibarra-Espinosa)
Date: Tue, 13 Oct 2020 12:07:46 -0300
Subject: [R-pkg-devel] Fortran with OpenMP on MACOS
Message-ID: <CACB4+8oaLfgUs27qFYp6dc0eH8cs540Hy7RX6FqTJVM0d6jwCA@mail.gmail.com>

Dear List,

I have a package that was archived (
https://cran-archive.r-project.org/web/checks/2020/2020-10-07_check_results_vein.html
) because I could not solve an issue with OpenMP and Fortran on MACOS.

I have seen that packages with C add precompilation conditions, for
instance:

https://github.com/tesujimath/R-OpenMPController/blob/86bd047e8bfdf3c87877336ff8e2d3b69327fe03/src/omp_set_num_threads_ptr.c#L12

#ifdef _OPENMP
  omp_set_num_threads(*np);
#endif

So, I tried adding those lines in #ifdef _OPENMP #endif in
fortran, with the flag -cpp and the MACROS recommended by the R EXTS manual:

USE_FC_TO_LINK =
PKG_FFLAGS = $(SHLIB_OPENMP_FFLAGS) *-cpp*
PKG_LIBS = $(SHLIB_OPENMP_FFLAGS)

But with R CMD Check i got the message:

Non-portable flags in variable 'PKG_FFLAGS': -cpp

I would be very grateful if someone provides me some guidelines. Thank you
so much

Best, Sergio


*Sergio Ibarra Espinosa*
Postdoc in Atmospheric Sciences, Universidade de S?o Paulo

+  <++8617643016295>55 11 934 909 778  | +55 11 974 253 791
<+55+11+974+253+791> | sergio.ibarra at usp.br

www.sergioibarra.blogspot.com | *Skype*: sergio_ibarra1
<https://mail.google.com/mail/u/0/#SignatureSanitizer_SafeHtmlFilter_>
Rua do Mat?o, 1226 - Cidade Universit?ria S?o Paulo-SP - Brasil - 05508-090
<http://github.com/ibarraespinosa>
<https://zoom.us/j/6527509021?pwd=VmlXQWliR1JSZGtpS0tJR1A2dUZpZz09>

	[[alternative HTML version deleted]]


From er|nm@hodge@@ @end|ng |rom gm@||@com  Tue Oct 13 17:41:25 2020
From: er|nm@hodge@@ @end|ng |rom gm@||@com (Erin Hodgess)
Date: Tue, 13 Oct 2020 09:41:25 -0600
Subject: [R-pkg-devel] Fortran with OpenMP on MACOS
In-Reply-To: <CACB4+8oaLfgUs27qFYp6dc0eH8cs540Hy7RX6FqTJVM0d6jwCA@mail.gmail.com>
References: <CACB4+8oaLfgUs27qFYp6dc0eH8cs540Hy7RX6FqTJVM0d6jwCA@mail.gmail.com>
Message-ID: <CACxE24kyL4Vs5kKxUWaEpq8tb5rDgFQW7jni3yDEvgmr+AaNkA@mail.gmail.com>

I?m sure that you have done this, but did you set a compiler option of
-fopenmp, please?

Thanks

On Tue, Oct 13, 2020 at 9:35 AM Sergio Ibarra-Espinosa <sergio.ibarra at usp.br>
wrote:

> Dear List,
>
> I have a package that was archived (
>
> https://cran-archive.r-project.org/web/checks/2020/2020-10-07_check_results_vein.html
> ) because I could not solve an issue with OpenMP and Fortran on MACOS.
>
> I have seen that packages with C add precompilation conditions, for
> instance:
>
>
> https://github.com/tesujimath/R-OpenMPController/blob/86bd047e8bfdf3c87877336ff8e2d3b69327fe03/src/omp_set_num_threads_ptr.c#L12
>
> #ifdef _OPENMP
>   omp_set_num_threads(*np);
> #endif
>
> So, I tried adding those lines in #ifdef _OPENMP #endif in
> fortran, with the flag -cpp and the MACROS recommended by the R EXTS
> manual:
>
> USE_FC_TO_LINK =
> PKG_FFLAGS = $(SHLIB_OPENMP_FFLAGS) *-cpp*
> PKG_LIBS = $(SHLIB_OPENMP_FFLAGS)
>
> But with R CMD Check i got the message:
>
> Non-portable flags in variable 'PKG_FFLAGS': -cpp
>
> I would be very grateful if someone provides me some guidelines. Thank you
> so much
>
> Best, Sergio
>
>
> *Sergio Ibarra Espinosa*
> Postdoc in Atmospheric Sciences, Universidade de S?o Paulo
>
> +  <++8617643016295>55 11 934 909 778  | +55 11 974 253 791
> <+55+11+974+253+791> | sergio.ibarra at usp.br
>
> www.sergioibarra.blogspot.com | *Skype*: sergio_ibarra1
> <https://mail.google.com/mail/u/0/#SignatureSanitizer_SafeHtmlFilter_>
> Rua do Mat?o, 1226
> <https://www.google.com/maps/search/Rua+do+Mat%C3%A3o,+1226?entry=gmail&source=g>
> - Cidade Universit?ria S?o Paulo-SP - Brasil - 05508-090
> <http://github.com/ibarraespinosa>
> <https://zoom.us/j/6527509021?pwd=VmlXQWliR1JSZGtpS0tJR1A2dUZpZz09>
>
>         [[alternative HTML version deleted]]
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>
-- 
Erin Hodgess, PhD
mailto: erinm.hodgess at gmail.com

	[[alternative HTML version deleted]]


From he|mut@@chuetz @end|ng |rom beb@c@@t  Tue Oct 13 17:54:58 2020
From: he|mut@@chuetz @end|ng |rom beb@c@@t (=?UTF-8?Q?Helmut_Sch=c3=bctz?=)
Date: Tue, 13 Oct 2020 17:54:58 +0200
Subject: [R-pkg-devel] rJava (broken installation?)
Message-ID: <df442db0-0a0e-c681-d5d6-8a1e673e9087@bebac.at>

Dear all,

in one of my packages I import from package xlsx, which itself imports 
rJava.
I have the current Java (jre1.8.0_261) installed:
  ? JAVA_VERSION="1.8.0_261"
  ? OS_NAME="Windows"
  ? OS_VERSION="5.2"
  ? OS_ARCH="amd64"

However:
  ? devtools::session_info("rJava")
  ? - Session info 
---------------------------------------------------------------
  ?? setting? value
  ?? version? R version 4.0.3 (2020-10-10)
  ?? os?????? Windows 7 x64 SP 1
  ?? system?? x86_64, mingw32
  ?? ui?????? Rgui
  ?? language EN
  ?? collate? German_Germany.1252
  ?? ctype??? German_Germany.1252
  ?? tz?????? Europe/Vienna
  ?? date???? 2020-10-13

  ? - Packages 
-------------------------------------------------------------------
  ?? ! package * version date?????? lib source
  ?? D rJava???? 0.9-13? 2020-07-06 [1] CRAN (R 4.0.2)

  ? [1] D:/Program Files/R/R-4.0.3/library

  ?? D -- DLL MD5 mismatch, broken installation.

I found only this: 
https://community.rstudio.com/t/error-dll-md5-mismatch-broken-installation/64141 
with no answer.

Deleted rJava from my library and made a new install, no avail.

The functions I need from xlsx work as intended but I'm worried a bit.

Helmut

-- 
Ing. Helmut Sch?tz
BEBAC?? Consultancy Services for
Bioequivalence and Bioavailability Studies
Neubaugasse 36/11
1070 Vienna, Austria
E helmut.schuetz at bebac.at
W https://bebac.at/
F https://forum.bebac.at/


From c@@rd|@g@bor @end|ng |rom gm@||@com  Tue Oct 13 18:01:21 2020
From: c@@rd|@g@bor @end|ng |rom gm@||@com (=?UTF-8?B?R8OhYm9yIENzw6FyZGk=?=)
Date: Tue, 13 Oct 2020 17:01:21 +0100
Subject: [R-pkg-devel] rJava (broken installation?)
In-Reply-To: <df442db0-0a0e-c681-d5d6-8a1e673e9087@bebac.at>
References: <df442db0-0a0e-c681-d5d6-8a1e673e9087@bebac.at>
Message-ID: <CABtg=Kn-7eNR4QR+usVEmSza9cZ6wYJFtw_DXHf86jcvd8FV6w@mail.gmail.com>

Make sure you quit from all R sessions before you reinstall rJava, and
also that it is not loaded in the current session.

You can also run tools::checkMD5sums("rJava") to check the MD5 sums.

Gabor

On Tue, Oct 13, 2020 at 4:55 PM Helmut Sch?tz <helmut.schuetz at bebac.at> wrote:
>
> Dear all,
>
> in one of my packages I import from package xlsx, which itself imports
> rJava.
> I have the current Java (jre1.8.0_261) installed:
>     JAVA_VERSION="1.8.0_261"
>     OS_NAME="Windows"
>     OS_VERSION="5.2"
>     OS_ARCH="amd64"
>
> However:
>     devtools::session_info("rJava")
>     - Session info
> ---------------------------------------------------------------
>      setting  value
>      version  R version 4.0.3 (2020-10-10)
>      os       Windows 7 x64 SP 1
>      system   x86_64, mingw32
>      ui       Rgui
>      language EN
>      collate  German_Germany.1252
>      ctype    German_Germany.1252
>      tz       Europe/Vienna
>      date     2020-10-13
>
>     - Packages
> -------------------------------------------------------------------
>      ! package * version date       lib source
>      D rJava     0.9-13  2020-07-06 [1] CRAN (R 4.0.2)
>
>     [1] D:/Program Files/R/R-4.0.3/library
>
>      D -- DLL MD5 mismatch, broken installation.
>
> I found only this:
> https://community.rstudio.com/t/error-dll-md5-mismatch-broken-installation/64141
> with no answer.
>
> Deleted rJava from my library and made a new install, no avail.
>
> The functions I need from xlsx work as intended but I'm worried a bit.
>
> Helmut
>
> --
> Ing. Helmut Sch?tz
> BEBAC ? Consultancy Services for
> Bioequivalence and Bioavailability Studies
> Neubaugasse 36/11
> 1070 Vienna, Austria
> E helmut.schuetz at bebac.at
> W https://bebac.at/
> F https://forum.bebac.at/
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


From edd @end|ng |rom deb|@n@org  Tue Oct 13 18:10:26 2020
From: edd @end|ng |rom deb|@n@org (Dirk Eddelbuettel)
Date: Tue, 13 Oct 2020 11:10:26 -0500
Subject: [R-pkg-devel] rJava (broken installation?)
In-Reply-To: <df442db0-0a0e-c681-d5d6-8a1e673e9087@bebac.at>
References: <df442db0-0a0e-c681-d5d6-8a1e673e9087@bebac.at>
Message-ID: <24453.53618.452090.751931@rob.eddelbuettel.com>


On 13 October 2020 at 17:54, Helmut Sch?tz wrote:
| in one of my packages I import from package xlsx, which itself imports 

In case you were unaware there is also openxlsx which may be sufficient for
your import/export needs, and which is does not need a Java toolchain.

Dirk

-- 
https://dirk.eddelbuettel.com | @eddelbuettel | edd at debian.org


From @erg|o@|b@rr@ @end|ng |rom u@p@br  Tue Oct 13 18:19:27 2020
From: @erg|o@|b@rr@ @end|ng |rom u@p@br (Sergio Ibarra-Espinosa)
Date: Tue, 13 Oct 2020 13:19:27 -0300
Subject: [R-pkg-devel] Fortran with OpenMP on MACOS
In-Reply-To: <CACxE24kyL4Vs5kKxUWaEpq8tb5rDgFQW7jni3yDEvgmr+AaNkA@mail.gmail.com>
References: <CACB4+8oaLfgUs27qFYp6dc0eH8cs540Hy7RX6FqTJVM0d6jwCA@mail.gmail.com>
 <CACxE24kyL4Vs5kKxUWaEpq8tb5rDgFQW7jni3yDEvgmr+AaNkA@mail.gmail.com>
Message-ID: <CACB4+8pzSaUY82ws9FHDeQJrPRJdLz4nMvemO-cFTiL1wpVxMw@mail.gmail.com>

I'm, sorry but I don't understand your question. To my understanding,
adding the mentioned MACROS should be enough to add the flag -fopenmp.
Actually, when I build the package, gfortran already uses the flag -fopenmp:

gfortran -fno-optimize-sibling-calls *-fopenmp* -fpic  -g -O2
-fdebug-prefix-map=/build/r-base-8T8CYO/r-base-4.0.3=.
-fstack-protector-strong  -c  get_threads.f90 -o get_threads.o




Em ter., 13 de out. de 2020 ?s 12:41, Erin Hodgess <erinm.hodgess at gmail.com>
escreveu:

>
> I?m sure that you have done this, but did you set a compiler option of
> -fopenmp, please?
>
> Thanks
>
> On Tue, Oct 13, 2020 at 9:35 AM Sergio Ibarra-Espinosa <
> sergio.ibarra at usp.br> wrote:
>
>> Dear List,
>>
>> I have a package that was archived (
>>
>> https://cran-archive.r-project.org/web/checks/2020/2020-10-07_check_results_vein.html
>> ) because I could not solve an issue with OpenMP and Fortran on MACOS.
>>
>> I have seen that packages with C add precompilation conditions, for
>> instance:
>>
>>
>> https://github.com/tesujimath/R-OpenMPController/blob/86bd047e8bfdf3c87877336ff8e2d3b69327fe03/src/omp_set_num_threads_ptr.c#L12
>>
>> #ifdef _OPENMP
>>   omp_set_num_threads(*np);
>> #endif
>>
>> So, I tried adding those lines in #ifdef _OPENMP #endif in
>> fortran, with the flag -cpp and the MACROS recommended by the R EXTS
>> manual:
>>
>> USE_FC_TO_LINK =
>> PKG_FFLAGS = $(SHLIB_OPENMP_FFLAGS) *-cpp*
>> PKG_LIBS = $(SHLIB_OPENMP_FFLAGS)
>>
>> But with R CMD Check i got the message:
>>
>> Non-portable flags in variable 'PKG_FFLAGS': -cpp
>>
>> I would be very grateful if someone provides me some guidelines. Thank you
>> so much
>>
>> Best, Sergio
>>
>>
>> *Sergio Ibarra Espinosa*
>> Postdoc in Atmospheric Sciences, Universidade de S?o Paulo
>>
>> +  <++8617643016295>55 11 934 909 778  | +55 11 974 253 791
>> <+55+11+974+253+791> | sergio.ibarra at usp.br
>>
>> www.sergioibarra.blogspot.com | *Skype*: sergio_ibarra1
>> <https://mail.google.com/mail/u/0/#SignatureSanitizer_SafeHtmlFilter_>
>> Rua do Mat?o, 1226
>> <https://www.google.com/maps/search/Rua+do+Mat%C3%A3o,+1226?entry=gmail&source=g>
>> - Cidade Universit?ria S?o Paulo-SP - Brasil - 05508-090
>> <http://github.com/ibarraespinosa>
>> <https://zoom.us/j/6527509021?pwd=VmlXQWliR1JSZGtpS0tJR1A2dUZpZz09>
>>
>>         [[alternative HTML version deleted]]
>>
>> ______________________________________________
>> R-package-devel at r-project.org mailing list
>> https://stat.ethz.ch/mailman/listinfo/r-package-devel
>>
> --
> Erin Hodgess, PhD
> mailto: erinm.hodgess at gmail.com
>

	[[alternative HTML version deleted]]


From bbo|ker @end|ng |rom gm@||@com  Tue Oct 13 18:46:11 2020
From: bbo|ker @end|ng |rom gm@||@com (Ben Bolker)
Date: Tue, 13 Oct 2020 12:46:11 -0400
Subject: [R-pkg-devel] checking windows timing?
Message-ID: <a9f3300c-ed86-7487-753f-416cb0fce7b7@gmail.com>


   Following up on my questions from yesterday:

   I've been advised to (drastically) reduce the checking time of my 
package on CRAN's Windows platform (currently at 23 min). I've gone 
through and added a lot of conditionals to skip tests on CRAN.  I could 
reduce it farther but I'm starting to encounter seriously diminishing 
returns, e.g.

  * do I condition out some particular test that takes 6 seconds? (e.g., 
a little slow, but not egregious)
  * do I put \dontrun{} around an example that takes 6 seconds [I'm a 
bit confused about this, but as I understand it CRAN checks with 
--run-donttest ? \dontrun{} also sometimes provokes complaints from 
CRAN, because "you should only use \dontrun{} for code that cannot be 
run by users" ...]

   I don't want to spend forever tweaking things, and I don't want to 
comment/condition out all of my tests, but I would really prefer to 
avoid bouncing from CRAN again. I don't know a *reliable* way to test 
whether CRAN-checking on Windows will take <10 mins or not ...

   I don't have a local Windows test platform.

   win-builder gives timings for long-running components, but not for 
the whole run.

   r-hub gives a time for the entire build (19 min in my case) - but 
this includes the time to set up the virtual machine, install all 
packages, etc..

   I can approximately predict that most examples and tests will take 
twice as long on CRAN's windows machines (and four times as long since 
tests, at least, are checked on both i386 and x86_64 architectures).

   Testing is currently taking 6 minutes on my local machine (newish 
Ubuntu 18.04 laptop), so I guess have more work to do, but I wonder if 
anyone has suggestions ...

   cheers
     Ben Bolker


From n@r@@ @end|ng |rom @t@n|ord@edu  Wed Oct 14 00:04:27 2020
From: n@r@@ @end|ng |rom @t@n|ord@edu (Balasubramanian Narasimhan)
Date: Tue, 13 Oct 2020 15:04:27 -0700
Subject: [R-pkg-devel] checking windows timing?
In-Reply-To: <a9f3300c-ed86-7487-753f-416cb0fce7b7@gmail.com>
References: <a9f3300c-ed86-7487-753f-416cb0fce7b7@gmail.com>
Message-ID: <08f09457-ecb8-b61c-3c5e-f214f709bdbe@stanford.edu>

FWIW, we dealt with the tests-taking-too-long problem for CVXR (which 
has a lot of tests) by mercilessly cutting out all tests on CRAN 
(testthat::skip_on_cran()) except for some fundamental ones on atoms, 
curvature, etc.? We then rely on Github actions (with NOT_CRAN = true) 
to run the full test suite on several platforms. Not perfect, but that's 
what worked for us.

-Naras

On 10/13/20 9:46 AM, Ben Bolker wrote:
>
> ? Following up on my questions from yesterday:
>
> ? I've been advised to (drastically) reduce the checking time of my 
> package on CRAN's Windows platform (currently at 23 min). I've gone 
> through and added a lot of conditionals to skip tests on CRAN.? I 
> could reduce it farther but I'm starting to encounter seriously 
> diminishing returns, e.g.
>
> ?* do I condition out some particular test that takes 6 seconds? 
> (e.g., a little slow, but not egregious)
> ?* do I put \dontrun{} around an example that takes 6 seconds [I'm a 
> bit confused about this, but as I understand it CRAN checks with 
> --run-donttest ? \dontrun{} also sometimes provokes complaints from 
> CRAN, because "you should only use \dontrun{} for code that cannot be 
> run by users" ...]
>
> ? I don't want to spend forever tweaking things, and I don't want to 
> comment/condition out all of my tests, but I would really prefer to 
> avoid bouncing from CRAN again. I don't know a *reliable* way to test 
> whether CRAN-checking on Windows will take <10 mins or not ...
>
> ? I don't have a local Windows test platform.
>
> ? win-builder gives timings for long-running components, but not for 
> the whole run.
>
> ? r-hub gives a time for the entire build (19 min in my case) - but 
> this includes the time to set up the virtual machine, install all 
> packages, etc..
>
> ? I can approximately predict that most examples and tests will take 
> twice as long on CRAN's windows machines (and four times as long since 
> tests, at least, are checked on both i386 and x86_64 architectures).
>
> ? Testing is currently taking 6 minutes on my local machine (newish 
> Ubuntu 18.04 laptop), so I guess have more work to do, but I wonder if 
> anyone has suggestions ...
>
> ? cheers
> ??? Ben Bolker
>
> ______________________________________________
> R-package-devel at r-project.org mailing list
> https://stat.ethz.ch/mailman/listinfo/r-package-devel


